var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(e&&(t=e(e=0)),t),s=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),c=(e,n)=>{let r={};for(var i in e)t(r,i,{get:e[i],enumerable:!0});return n||t(r,Symbol.toStringTag,{value:`Module`}),r},l=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},u=(n,r,a)=>(a=n==null?{}:e(i(n)),l(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n)),d=e=>a.call(e,`module.exports`)?e[`module.exports`]:l(t({},`__esModule`,{value:!0}),e);(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var f=window.L,p=new f.TileLayer(`https://a.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGF0aWFuYSIsImEiOiJjaW9nNWc2enkwMWk0dWRtM3Qwd3J5dHo2In0.42pdJNpJD8BAalQ3nM8KQg`,{id:`mapbox.Street`}),m=new f.TileLayer(`http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png`,{}),h=new f.TileLayer(`http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png`,{subdomains:`1234`}),g=new f.TileLayer(`https://{s}.tiles.mapquest.com/render/latest/vivid/{z}/{x}/{y}/256/png`,{subdomains:`abc`});new f.TileLayer(`http://otile{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png`,{subdomains:`1234`}),new f.TileLayer(`http://t{s}.tianditu.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}`,{subdomains:`01234567`}),new f.TileLayer(`http://t{s}.tianditu.cn/DataServer?T=img_w&X={x}&Y={y}&L={z}`,{subdomains:`01234567`}),new f.TileLayer(`http://t{s}.tianditu.cn/DataServer?T=ter_w&X={x}&Y={y}&L={z}`,{subdomains:`01234567`}),new f.TileLayer(`http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z=d{z}`,{subdomains:`1234`}),new f.TileLayer(`http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z=d{z}`,{subdomains:`1234`});var _=new f.TileLayer(`http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}`,{subdomains:`1234`}),v=new f.TileLayer(`http://emap{s}.mapabc.com/mapabc/maptile?&x={x}&y={y}&z={z}`,{subdomains:`0123`}),y=new f.TileLayer(`http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}`,{attribution:`点击地图任意处，获取百度和火星坐标`}),b=new f.TileLayer(`http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{y}/{x}`,{}),x=new f.TileLayer(`http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}`,{}),S=new f.TileLayer(`http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetColor/MapServer/tile/{z}/{y}/{x}`,{}),C=new f.TileLayer(` http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}`,{}),w=new f.TileLayer(`http://thematic.geoq.cn/arcgis/rest/services/ThematicMaps/administrative_division_boundaryandlabel/MapServer/tile/{z}/{y}/{x}`,{}),E=new f.TileLayer(`http://thematic.geoq.cn/arcgis/rest/services/ThematicMaps/administrative_division_boundary/MapServer/tile/{z}/{y}/{x}`,{}),D=new f.TileLayer(`http://thematic.geoq.cn/arcgis/rest/services/ThematicMaps/WorldHydroMap/MapServer/tile/{z}/{y}/{x}`,{});new f.TileLayer(`http://thematic.geoq.cn/arcgis/rest/services/ThematicMaps/Subway/MapServer/tile/{z}/{y}/{x}`,{});var O=new f.TileLayer(`http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png`,{}),k=new f.TileLayer(`http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.png`,{});new f.TileLayer(`http://{s}.tile.opentopomap.org/{z}/{x}/{y}.png`,{}),new f.TileLayer(`http://42.120.180.211:8080/mapservice?t=1&c={constiant}&x={x}&y={y}&z={z}&size=1&v=light`,{});var A=new f.TileLayer(`http://server.arcgisonline.com/arcgis/rest/services/world_imagery/mapserver/tile/{z}/{y}/{x}`,{}),j=new f.TileLayer(`http://khm0.googleapis.com/kh?v=203&hl=zh-CN&&x={x}&y={y}&z={z}`,{}),M=3.141592653589793*3e3/180,N=3.141592653589793,P=6378245,F=.006693421622965943,I=function(e,t){let n=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*M),r=Math.atan2(t,e)+3e-6*Math.cos(e*M);return[n*Math.cos(r)+.0065,n*Math.sin(r)+.006]},ee=function(e,t){if(B(e,t))return[e,t];{let n=R(e-105,t-35),r=z(e-105,t-35),i=t/180*N,a=Math.sin(i);a=1-F*a*a;let o=Math.sqrt(a);n=n*180/(P*(1-F)/(a*o)*N),r=r*180/(P/o*Math.cos(i)*N);let s=t+n;return[e+r,s]}},R=function(e,t){let n=-100+2*e+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return n+=(20*Math.sin(6*e*N)+20*Math.sin(2*e*N))*2/3,n+=(20*Math.sin(t*N)+40*Math.sin(t/3*N))*2/3,n+=(160*Math.sin(t/12*N)+320*Math.sin(t*N/30))*2/3,n},z=function(e,t){let n=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return n+=(20*Math.sin(6*e*N)+20*Math.sin(2*e*N))*2/3,n+=(20*Math.sin(e*N)+40*Math.sin(e/3*N))*2/3,n+=(150*Math.sin(e/12*N)+300*Math.sin(e/30*N))*2/3,n},B=function(e,t){return e<72.004||e>137.8347||t<.8293||t>55.8271||!1};function te(){return this._array=null,Promise.resolve()}function ne(){var e=this._array;return this._array=null,Promise.resolve(e?{done:!1,value:e}:{done:!0,value:void 0})}function re(e){return new V(e instanceof Uint8Array?e:new Uint8Array(e))}function V(e){this._array=e}V.prototype.read=ne,V.prototype.cancel=te;function ie(e){return fetch(e).then(function(e){return e.body&&e.body.getReader?e.body.getReader():e.arrayBuffer().then(re)})}function ae(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.responseType=`arraybuffer`,r.onload=function(){t(re(r.response))},r.onerror=n,r.ontimeout=n,r.open(`GET`,e,!0),r.send()})}function oe(e){return(typeof fetch==`function`?ie:ae)(e)}function se(e){return typeof e.read==`function`?e:e.getReader()}var ce=new Uint8Array;function H(){return this._source.cancel()}function le(e,t){if(!e.length)return t;if(!t.length)return e;var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function ue(){var e=this,t=e._array.subarray(e._index);return e._source.read().then(function(n){return e._array=ce,e._index=0,n.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:le(t,n.value)}})}function de(e){if((e|=0)<0)throw Error(`invalid length`);var t=this,n=this._array.length-this._index;if(this._index+e<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=e));var r=new Uint8Array(e);return r.set(this._array.subarray(this._index)),(function i(){return t._source.read().then(function(a){return a.done?(t._array=ce,t._index=0,n>0?r.subarray(0,n):null):n+a.value.length>=e?(t._array=a.value,t._index=e-n,r.set(a.value.subarray(0,e-n),n),r):(r.set(a.value,n),n+=a.value.length,i())})})()}function U(e){return typeof e.slice==`function`?e:new fe(typeof e.read==`function`?e:e.getReader())}function fe(e){this._source=e,this._array=ce,this._index=0}fe.prototype.read=ue,fe.prototype.slice=de,fe.prototype.cancel=H;function pe(){return this._source.cancel()}function me(e){return/^[nf]$/i.test(e)?!1:/^[yt]$/i.test(e)?!0:null}function W(e){return new Date(+e.substring(0,4),e.substring(4,6)-1,+e.substring(6,8))}function he(e){return!(e=e.trim())||isNaN(e=+e)?null:e}function ge(e){return e.trim()||null}var _e={B:he,C:ge,D:W,F:he,L:me,M:he,N:he};function G(){var e=this,t=1;return e._source.slice(e._recordLength).then(function(n){return n&&n[0]!==26?{done:!1,value:e._fields.reduce(function(r,i){return r[i.name]=_e[i.type](e._decode(n.subarray(t,t+=i.length))),r},{})}:{done:!0,value:void 0}})}function K(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function ve(e,t){return e=U(e),e.slice(32).then(function(n){var r=K(n);return e.slice(r.getUint16(8,!0)-32).then(function(n){return new ye(e,t,r,K(n))})})}function ye(e,t,n,r){this._source=e,this._decode=t.decode.bind(t),this._recordLength=n.getUint16(10,!0),this._fields=[];for(var i=0;r.getUint8(i)!==13;i+=32){for(var a=0;a<11&&r.getUint8(i+a)!==0;++a);this._fields.push({name:this._decode(new Uint8Array(r.buffer,r.byteOffset+i,a)),type:String.fromCharCode(r.getUint8(i+11)),length:r.getUint8(i+16)})}}var be=ye.prototype;be.read=G,be.cancel=pe;function xe(){return this._source.cancel()}function Se(e){var t=40,n,r=e.getInt32(36,!0),i=Array(r);for(n=0;n<r;++n,t+=16)i[n]=[e.getFloat64(t,!0),e.getFloat64(t+8,!0)];return{type:`MultiPoint`,coordinates:i}}function Ce(){return null}function we(e){return{type:`Point`,coordinates:[e.getFloat64(4,!0),e.getFloat64(12,!0)]}}function Te(e){var t=44,n,r=e.getInt32(36,!0),i=e.getInt32(40,!0),a=Array(r),o=Array(i),s=[],c=[];for(n=0;n<r;++n,t+=4)a[n]=e.getInt32(t,!0);for(n=0;n<i;++n,t+=16)o[n]=[e.getFloat64(t,!0),e.getFloat64(t+8,!0)];return a.forEach(function(e,t){var n=o.slice(e,a[t+1]);Ee(n)?s.push([n]):c.push(n)}),c.forEach(function(e){s.some(function(t){if(De(t[0],e))return t.push(e),!0})||s.push([e])}),s.length===1?{type:`Polygon`,coordinates:s[0]}:{type:`MultiPolygon`,coordinates:s}}function Ee(e){if((n=e.length)<4)return!1;for(var t=0,n,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r>=0}function De(e,t){for(var n=-1,r=t.length,i;++n<r;)if(i=Oe(e,t[n]))return i>0;return!1}function Oe(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var c=e[a],l=c[0],u=c[1],d=e[s],f=d[0],p=d[1];if(ke(c,d,t))return 0;u>r!=p>r&&n<(f-l)*(r-u)/(p-u)+l&&(i=-i)}return i}function ke(e,t,n){var r=n[0]-e[0],i=n[1]-e[1];if(r===0&&i===0)return!0;var a=t[0]-e[0],o=t[1]-e[1];if(a===0&&o===0)return!1;var s=(r*a+i*o)/(a*a+o*o);return s<0||s>1?!1:s===0||s===1?!0:s*a===r&&s*o===i}function Ae(e){var t=44,n,r=e.getInt32(36,!0),i=e.getInt32(40,!0),a=Array(r),o=Array(i);for(n=0;n<r;++n,t+=4)a[n]=e.getInt32(t,!0);for(n=0;n<i;++n,t+=16)o[n]=[e.getFloat64(t,!0),e.getFloat64(t+8,!0)];return r===1?{type:`LineString`,coordinates:o}:{type:`MultiLineString`,coordinates:a.map(function(e,t){return o.slice(e,a[t+1])})}}function je(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n}function Me(){var e=this;return++e._index,e._source.slice(12).then(function(t){if(t==null)return{done:!0,value:void 0};var n=K(t);function r(){return e._source.slice(4).then(function(a){return a==null?{done:!0,value:void 0}:(n=K(t=je(t.slice(4),a)),n.getInt32(0,!1)===e._index?i():r())})}function i(){var i=n.getInt32(4,!1)*2-4,a=n.getInt32(8,!0);return i<0||a&&a!==e._type?r():e._source.slice(i).then(function(n){return{done:!1,value:a?e._parse(K(je(t.slice(8),n))):null}})}return i()})}var Ne={0:Ce,1:we,3:Ae,5:Te,8:Se,11:we,13:Ae,15:Te,18:Se,21:we,23:Ae,25:Te,28:Se};function Pe(e){return e=U(e),e.slice(100).then(function(t){return new Fe(e,K(t))})}function Fe(e,t){var n=t.getInt32(32,!0);if(!(n in Ne))throw Error(`unsupported shape type: `+n);this._source=e,this._type=n,this._index=0,this._parse=Ne[n],this.bbox=[t.getFloat64(36,!0),t.getFloat64(44,!0),t.getFloat64(52,!0),t.getFloat64(60,!0)]}var Ie=Fe.prototype;Ie.read=Me,Ie.cancel=xe;function Le(){}function q(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(Le)}function Re(){var e=this;return Promise.all([e._dbf?e._dbf.read():{value:{}},e._shp.read()]).then(function(e){var t=e[0],n=e[1];return n.done?n:{done:!1,value:{type:`Feature`,properties:t.value,geometry:n.value}}})}function ze(e,t,n){return Promise.all([Pe(e),t&&ve(t,n)]).then(function(e){return new Be(e[0],e[1])})}function Be(e,t){this._shp=e,this._dbf=t,this.bbox=e.bbox}var Ve=Be.prototype;Ve.read=Re,Ve.cancel=q;function He(e,t,n){return typeof t==`string`?(/\.dbf$/.test(t)||(t+=`.dbf`),t=oe(t,n)):t instanceof ArrayBuffer||t instanceof Uint8Array?t=re(t):t!=null&&(t=se(t)),typeof e==`string`?(/\.shp$/.test(e)||(e+=`.shp`),t===void 0&&(t=oe(e.substring(0,e.length-4)+`.dbf`,n).catch(function(){})),e=oe(e,n)):e=e instanceof ArrayBuffer||e instanceof Uint8Array?re(e):se(e),Promise.all([e,t]).then(function(e){var t=e[0],r=e[1],i=`windows-1252`;return n&&n.encoding!=null&&(i=n.encoding),ze(t,r,r&&new TextDecoder(i))})}async function Ue(e,t){let n=await He(e,t),r=[];for(;;){let e=await n.read();if(e.done)break;r.push(e.value)}return{type:`FeatureCollection`,features:r}}async function We(e,t){return Ue(await e.arrayBuffer(),t?await t.arrayBuffer():void 0)}var Ge=s(((e,t)=>{t.exports.geometries={NULL:0,POINT:1,POLYLINE:3,POLYGON:5,MULTIPOINT:8,POINTZ:11,POLYLINEZ:13,POLYGONZ:15,MULTIPOINTZ:18,POINTM:21,POLYLINEM:23,POLYGONM:25,MULTIPOINTM:28,MULTIPATCH:31}})),Ke=s(((e,t)=>{t.exports={C:254,L:1,D:8,N:18,M:18,F:18,B:8}})),qe=s(((e,t)=>{t.exports.lpad=function(e,t,n){for(;e.length<t;)e=n+e;return e},t.exports.rpad=function(e,t,n){for(;e.length<t;)e+=n;return e},t.exports.writeField=function(e,t,n,r){for(var i=0;i<t;i++)e.setUint8(r,n.charCodeAt(i)),r++;return r}})),Je=s(((e,t)=>{var n=Ke(),r={string:`C`,number:`N`,boolean:`L`,null:`C`};t.exports.multi=i,t.exports.bytesPer=s,t.exports.obj=o;function i(e){var t={};e.forEach(n);function n(e){a(t,e)}return o(t)}function a(e,t){for(var n in t){var r=t[n]!==void 0&&t[n]!==null;(e[n]===void 0||r)&&(e[n]=t[n])}return e}function o(e){var t={},i=[];for(var a in e)t[a]=e[a]===null?`null`:typeof e[a];for(var o in t){var s=r[t[o]];s&&i.push({name:o,type:s,size:n[s]})}return i}function s(e){return e.reduce(function(e,t){return e+t.size},1)}})),Ye=s(((e,t)=>{Ke();var n=qe(),r=Je();t.exports=function(e,t){var i=t||r.multi(e),a=32*i.length+1,o=r.bytesPer(i),s=new ArrayBuffer(a+32+o*e.length+1),c=new Date,l=new DataView(s);l.setUint8(0,3),l.setUint8(1,c.getFullYear()-1900),l.setUint8(2,c.getMonth()),l.setUint8(3,c.getDate()),l.setUint32(4,e.length,!0);var u=a+32;return l.setUint16(8,u,!0),l.setUint16(10,o,!0),l.setInt8(32+a-1,13),i.forEach(function(e,t){e.name.split(``).slice(0,8).forEach(function(e,n){l.setInt8(32+t*32+n,e.charCodeAt(0))}),l.setInt8(32+t*32+11,e.type.charCodeAt(0)),l.setInt8(32+t*32+16,e.size),e.type==`N`&&l.setInt8(32+t*32+17,3)}),offset=a+32,e.forEach(function(e,t){l.setUint8(offset,32),offset++,i.forEach(function(t){var r=e[t.name];switch(r??=``,t.type){case`L`:l.setUint8(offset,r?84:70),offset++;break;case`D`:offset=n.writeField(l,8,n.lpad(r.toString(),8,` `),offset);break;case`N`:offset=n.writeField(l,t.size,n.lpad(r.toString(),t.size,` `).substr(0,18),offset);break;case`C`:offset=n.writeField(l,t.size,n.rpad(r.toString(),t.size,` `),offset);break;default:throw Error(`Unknown field type`)}})}),l.setUint8(offset,26),l}})),Xe=s(((e,t)=>{t.exports.structure=Ye()})),Ze=s(((e,t)=>{t.exports=`GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]`})),Qe=s(((e,t)=>{t.exports.enlarge=function(e,t){return t[0]<e.xmin&&(e.xmin=t[0]),t[0]>e.xmax&&(e.xmax=t[0]),t[1]<e.ymin&&(e.ymin=t[1]),t[1]>e.ymax&&(e.ymax=t[1]),e},t.exports.enlargeExtent=function(e,t){return t.xmax>e.xmax&&(e.xmax=t.xmax),t.xmin<e.xmin&&(e.xmin=t.xmin),t.ymax>e.ymax&&(e.ymax=t.ymax),t.ymin<e.ymin&&(e.ymin=t.ymin),e},t.exports.blank=function(){return{xmin:Number.MAX_VALUE,ymin:Number.MAX_VALUE,xmax:-Number.MAX_VALUE,ymax:-Number.MAX_VALUE}}})),$e=s(((e,t)=>{var n=Ge().jstypes;t.exports.geojson=r,t.exports.obj=a;function r(e){var t={};e.forEach(n);function n(e){i(t,e.properties)}return a(t)}function i(e,t){for(var n in t)e[n]=t[n];return e}function a(e){var t={},r=[];for(var i in e)t[i]=typeof e[i];for(var a in t)r.push({name:a,type:n[t[a]]});return r}})),et=s(((e,t)=>{t.exports={}})),tt=s(((e,t)=>{var n=Qe();t.exports.write=function(e,t,n,r){var i=28,a=100,o=0,s=0;e.forEach(function(e,t){n.setInt32(o,t),n.setInt32(o+4,10),n.setInt32(o+8,1,!0),n.setFloat64(o+12,e[0],!0),n.setFloat64(o+20,e[1],!0),r.setInt32(s,a/2),r.setInt32(s+4,10),s+=8,o+=i,a+=i})},t.exports.extent=function(e){return e.reduce(function(e,t){return n.enlarge(e,t)},n.blank())},t.exports.parts=function(e,t){return e.length},t.exports.shxLength=function(e){return e.length*8},t.exports.shpLength=function(e){return e.length*28}})),nt=s(((e,t)=>{var n=Qe(),r=Ge();t.exports.write=function(e,t,r,o,s){var c=0,l=0,u=100;e.forEach(d);function d(e,t){var d=a(e),f=i([e],s),p=d.length*16+48+(f-1)*4,m=d.reduce(function(e,t){return n.enlarge(e,t)},n.blank());o.setInt32(l,u/2),o.setInt32(l+4,p/2),l+=8,u+=p+8,r.setInt32(c,t+1),r.setInt32(c+4,p/2),r.setInt32(c+8,s,!0),r.setFloat64(c+12,m.xmin,!0),r.setFloat64(c+20,m.ymin,!0),r.setFloat64(c+28,m.xmax,!0),r.setFloat64(c+36,m.ymax,!0),r.setInt32(c+44,f,!0),r.setInt32(c+48,d.length,!0),r.setInt32(c+52,0,!0);for(var h=e.reduce(function(e,t){return Array.isArray(t[0][0])?e=e.concat(t):e.push(t),e},[]),g=1;g<f;g++)r.setInt32(c+52+g*4,h.reduce(function(e,t,n){return n<g?e+t.length:e},0),!0);d.forEach(function(e,t){r.setFloat64(c+56+t*16+(f-1)*4,e[0],!0),r.setFloat64(c+56+t*16+(f-1)*4+8,e[1],!0)}),c+=p+8}},t.exports.shpLength=function(e){return e.length*56+a(e).length*16},t.exports.shxLength=function(e){return e.length*8},t.exports.extent=function(e){return a(e).reduce(function(e,t){return n.enlarge(e,t)},n.blank())};function i(e,t){var n=1;return(t===r.geometries.POLYGON||t===r.geometries.POLYLINE)&&(n=e.reduce(function(e,t){return e+=t.length,Array.isArray(t[0][0][0])&&(e+=t.reduce(function(e,t){return e+t.length-1},0)),e},0)),n}t.exports.parts=i;function a(e,t){return t===void 0&&(t=[]),typeof e[0][0]==`object`?e.reduce(function(e,t){return e.concat(a(t))},t):e}})),rt=s(((e,t)=>{var n=Ge(),r=Xe(),i=Ze();Qe(),$e(),et();var a=tt(),o=nt(),s={1:a,5:o,3:o};t.exports=c;function c(e,t,a,o){var c=n.geometries[t],d=s[c],f=100+(d.parts(a,c)-a.length)*4+d.shpLength(a),p=100+d.shxLength(a),m=new ArrayBuffer(f),h=new DataView(m),g=new ArrayBuffer(p),_=new DataView(g),v=d.extent(a);l(h,c),l(_,c),u(v,h),u(v,_),d.write(a,v,new DataView(m,100),new DataView(g,100),c),h.setInt32(24,f/2),_.setInt32(24,50+a.length*4),o(null,{shp:h,shx:_,dbf:r.structure(e),prj:i})}function l(e,t){e.setInt32(0,9994),e.setInt32(28,1e3,!0),e.setInt32(32,t,!0)}function u(e,t){t.setFloat64(36,e.xmin,!0),t.setFloat64(44,e.ymin,!0),t.setFloat64(52,e.xmax,!0),t.setFloat64(60,e.ymax,!0)}})),it=s(((e,t)=>{t.exports.point=n(`Point`,`POINT`),t.exports.line=n(`LineString`,`POLYLINE`),t.exports.polygon=n(`Polygon`,`POLYGON`);function n(e,t){return function(n){var o=n.features.filter(a(e));return{geometries:t===`POLYGON`||t===`POLYLINE`?[o.map(r)]:o.map(r),properties:o.map(i),type:t}}}function r(e){return e.geometry.coordinates[0]!==void 0&&e.geometry.coordinates[0][0]!==void 0&&e.geometry.coordinates[0][0][0]!==void 0?e.geometry.coordinates[0]:e.geometry.coordinates}function i(e){return e.properties}function a(e){return function(t){return t.geometry.type===e}}})),at=s((e=>{var t=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=`;e.encode=function(e,n){for(var r=``,i,a,o,s,c,l,u,d=0;d<e.length;)i=e.charCodeAt(d++),a=e.charCodeAt(d++),o=e.charCodeAt(d++),s=i>>2,c=(i&3)<<4|a>>4,l=(a&15)<<2|o>>6,u=o&63,isNaN(a)?l=u=64:isNaN(o)&&(u=64),r=r+t.charAt(s)+t.charAt(c)+t.charAt(l)+t.charAt(u);return r},e.decode=function(e,n){var r=``,i,a,o,s,c,l,u,d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,``);d<e.length;)s=t.indexOf(e.charAt(d++)),c=t.indexOf(e.charAt(d++)),l=t.indexOf(e.charAt(d++)),u=t.indexOf(e.charAt(d++)),i=s<<2|c>>4,a=(c&15)<<4|l>>2,o=(l&3)<<6|u,r+=String.fromCharCode(i),l!=64&&(r+=String.fromCharCode(a)),u!=64&&(r+=String.fromCharCode(o));return r}})),ot=s((e=>{if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer=typeof ArrayBuffer<`u`&&typeof Uint8Array<`u`,e.nodebuffer=typeof Buffer<`u`,e.uint8array=typeof Uint8Array<`u`,typeof ArrayBuffer>`u`)e.blob=!1;else{var t=new ArrayBuffer(0);try{e.blob=new Blob([t],{type:`application/zip`}).size===0}catch{try{var n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);n.append(t),e.blob=n.getBlob(`application/zip`).size===0}catch{e.blob=!1}}}})),st=s((e=>{var t=typeof Uint8Array<`u`&&typeof Uint16Array<`u`&&typeof Int32Array<`u`;e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if(typeof n!=`object`)throw TypeError(n+`must be non-object`);for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray){e.set(t.subarray(n,n+r),i);return}for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r=0,i,a,o;for(t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],o.set(a,i),i+=a.length;return o}},r={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,r))},e.setTyped(t)})),ct=s((e=>{var t=st(),n=4,r=0,i=1,a=2;function o(e){for(var t=e.length;--t>=0;)e[t]=0}var s=0,c=1,l=2,u=3,d=258,f=29,p=256,m=p+1+f,h=30,g=19,_=2*m+1,v=15,y=16,b=7,x=256,S=16,C=17,w=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],k=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=512,j=Array((m+2)*2);o(j);var M=Array(h*2);o(M);var N=Array(A);o(N);var P=Array(d-u+1);o(P);var F=Array(f);o(F);var I=Array(h);o(I);function ee(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}var R,z,B;function te(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function ne(e){return e<256?N[e]:N[256+(e>>>7)]}function re(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function V(e,t,n){e.bi_valid>y-n?(e.bi_buf|=t<<e.bi_valid&65535,re(e,e.bi_buf),e.bi_buf=t>>y-e.bi_valid,e.bi_valid+=n-y):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function ie(e,t,n){V(e,n[t*2],n[t*2+1])}function ae(e,t){var n=0;do n|=e&1,e>>>=1,n<<=1;while(--t>0);return n>>>1}function oe(e){e.bi_valid===16?(re(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function se(e,t){var n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,c=t.stat_desc.max_length,l,u,d,f,p,m,h=0;for(f=0;f<=v;f++)e.bl_count[f]=0;for(n[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<_;l++)u=e.heap[l],f=n[n[u*2+1]*2+1]+1,f>c&&(f=c,h++),n[u*2+1]=f,!(u>r)&&(e.bl_count[f]++,p=0,u>=s&&(p=o[u-s]),m=n[u*2],e.opt_len+=m*(f+p),a&&(e.static_len+=m*(i[u*2+1]+p)));if(h!==0){do{for(f=c-1;e.bl_count[f]===0;)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[c]--,h-=2}while(h>0);for(f=c;f!==0;f--)for(u=e.bl_count[f];u!==0;)d=e.heap[--l],!(d>r)&&(n[d*2+1]!==f&&(e.opt_len+=(f-n[d*2+1])*n[d*2],n[d*2+1]=f),u--)}}function ce(e,t,n){var r=Array(v+1),i=0,a,o;for(a=1;a<=v;a++)r[a]=i=i+n[a-1]<<1;for(o=0;o<=t;o++){var s=e[o*2+1];s!==0&&(e[o*2]=ae(r[s]++,s))}}function H(){var e,t,n,r,i,a=Array(v+1);for(n=0,r=0;r<f-1;r++)for(F[r]=n,e=0;e<1<<E[r];e++)P[n++]=r;for(P[n-1]=r,i=0,r=0;r<16;r++)for(I[r]=i,e=0;e<1<<D[r];e++)N[i++]=r;for(i>>=7;r<h;r++)for(I[r]=i<<7,e=0;e<1<<D[r]-7;e++)N[256+ i++]=r;for(t=0;t<=v;t++)a[t]=0;for(e=0;e<=143;)j[e*2+1]=8,e++,a[8]++;for(;e<=255;)j[e*2+1]=9,e++,a[9]++;for(;e<=279;)j[e*2+1]=7,e++,a[7]++;for(;e<=287;)j[e*2+1]=8,e++,a[8]++;for(ce(j,m+1,a),e=0;e<h;e++)M[e*2+1]=5,M[e*2]=ae(e,5);R=new ee(j,E,p+1,m,v),z=new ee(M,D,0,h,v),B=new ee([],O,0,g,b)}function le(e){var t;for(t=0;t<m;t++)e.dyn_ltree[t*2]=0;for(t=0;t<h;t++)e.dyn_dtree[t*2]=0;for(t=0;t<g;t++)e.bl_tree[t*2]=0;e.dyn_ltree[x*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function ue(e){e.bi_valid>8?re(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function de(e,n,r,i){ue(e),i&&(re(e,r),re(e,~r)),t.arraySet(e.pending_buf,e.window,n,r,e.pending),e.pending+=r}function U(e,t,n,r){var i=t*2,a=n*2;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function fe(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&U(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!U(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function pe(e,t,n){var r,i,a=0,o,s;if(e.last_lit!==0)do r=e.pending_buf[e.d_buf+a*2]<<8|e.pending_buf[e.d_buf+a*2+1],i=e.pending_buf[e.l_buf+a],a++,r===0?ie(e,i,t):(o=P[i],ie(e,o+p+1,t),s=E[o],s!==0&&(i-=F[o],V(e,i,s)),r--,o=ne(r),ie(e,o,n),s=D[o],s!==0&&(r-=I[o],V(e,r,s)));while(a<e.last_lit);ie(e,x,t)}function me(e,t){var n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems,o,s,c=-1,l;for(e.heap_len=0,e.heap_max=_,o=0;o<a;o++)n[o*2]===0?n[o*2+1]=0:(e.heap[++e.heap_len]=c=o,e.depth[o]=0);for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[l*2]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[l*2+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)fe(e,n,o);l=a;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],fe(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=s,n[l*2]=n[o*2]+n[s*2],e.depth[l]=(e.depth[o]>=e.depth[s]?e.depth[o]:e.depth[s])+1,n[o*2+1]=n[s*2+1]=l,e.heap[1]=l++,fe(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],se(e,t),ce(n,c,e.bl_count)}function W(e,t,n){var r,i=-1,a,o=t[1],s=0,c=7,l=4;for(o===0&&(c=138,l=3),t[(n+1)*2+1]=65535,r=0;r<=n;r++)a=o,o=t[(r+1)*2+1],!(++s<c&&a===o)&&(s<l?e.bl_tree[a*2]+=s:a===0?s<=10?e.bl_tree[C*2]++:e.bl_tree[w*2]++:(a!==i&&e.bl_tree[a*2]++,e.bl_tree[S*2]++),s=0,i=a,o===0?(c=138,l=3):a===o?(c=6,l=3):(c=7,l=4))}function he(e,t,n){var r,i=-1,a,o=t[1],s=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(a=o,o=t[(r+1)*2+1],!(++s<c&&a===o)){if(s<l)do ie(e,a,e.bl_tree);while(--s!==0);else a===0?s<=10?(ie(e,C,e.bl_tree),V(e,s-3,3)):(ie(e,w,e.bl_tree),V(e,s-11,7)):(a!==i&&(ie(e,a,e.bl_tree),s--),ie(e,S,e.bl_tree),V(e,s-3,2));s=0,i=a,o===0?(c=138,l=3):a===o?(c=6,l=3):(c=7,l=4)}}function ge(e){var t;for(W(e,e.dyn_ltree,e.l_desc.max_code),W(e,e.dyn_dtree,e.d_desc.max_code),me(e,e.bl_desc),t=g-1;t>=3&&e.bl_tree[k[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t}function _e(e,t,n,r){var i;for(V(e,t-257,5),V(e,n-1,5),V(e,r-4,4),i=0;i<r;i++)V(e,e.bl_tree[k[i]*2+1],3);he(e,e.dyn_ltree,t-1),he(e,e.dyn_dtree,n-1)}function G(e){var t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(t&1&&e.dyn_ltree[n*2]!==0)return r;if(e.dyn_ltree[18]!==0||e.dyn_ltree[20]!==0||e.dyn_ltree[26]!==0)return i;for(n=32;n<p;n++)if(e.dyn_ltree[n*2]!==0)return i;return r}var K=!1;function ve(e){K||=(H(),!0),e.l_desc=new te(e.dyn_ltree,R),e.d_desc=new te(e.dyn_dtree,z),e.bl_desc=new te(e.bl_tree,B),e.bi_buf=0,e.bi_valid=0,le(e)}function ye(e,t,n,r){V(e,(s<<1)+(r?1:0),3),de(e,t,n,!0)}function be(e){V(e,c<<1,3),ie(e,x,j),oe(e)}function xe(e,t,r,i){var o,s,u=0;e.level>0?(e.strm.data_type===a&&(e.strm.data_type=G(e)),me(e,e.l_desc),me(e,e.d_desc),u=ge(e),o=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=o&&(o=s)):o=s=r+5,r+4<=o&&t!==-1?ye(e,t,r,i):e.strategy===n||s===o?(V(e,(c<<1)+(i?1:0),3),pe(e,j,M)):(V(e,(l<<1)+(i?1:0),3),_e(e,e.l_desc.max_code+1,e.d_desc.max_code+1,u+1),pe(e,e.dyn_ltree,e.dyn_dtree)),le(e),i&&ue(e)}function Se(e,t,n){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=n&255,e.last_lit++,t===0?e.dyn_ltree[n*2]++:(e.matches++,t--,e.dyn_ltree[(P[n]+p+1)*2]++,e.dyn_dtree[ne(t)*2]++),e.last_lit===e.lit_bufsize-1}e._tr_init=ve,e._tr_stored_block=ye,e._tr_flush_block=xe,e._tr_tally=Se,e._tr_align=be})),lt=s(((e,t)=>{function n(e,t,n,r){for(var i=e&65535|0,a=e>>>16&65535|0,o=0;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,a=a+i|0;while(--o);i%=65521,a%=65521}return i|a<<16|0}t.exports=n})),ut=s(((e,t)=>{function n(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t}var r=n();function i(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[(e^t[s])&255];return e^-1}t.exports=i})),dt=s(((e,t)=>{t.exports={2:`need dictionary`,1:`stream end`,0:``,"-1":`file error`,"-2":`stream error`,"-3":`data error`,"-4":`insufficient memory`,"-5":`buffer error`,"-6":`incompatible version`}})),ft=s((e=>{var t=st(),n=ct(),r=lt(),i=ut(),a=dt(),o=0,s=1,c=3,l=4,u=5,d=0,f=1,p=-2,m=-3,h=-5,g=-1,_=1,v=2,y=3,b=4,x=0,S=2,C=8,w=9,E=15,D=8,O=286,k=30,A=19,j=2*O+1,M=15,N=3,P=258,F=P+N+1,I=32,ee=42,R=69,z=73,B=91,te=103,ne=113,re=666,V=1,ie=2,ae=3,oe=4,se=3;function ce(e,t){return e.msg=a[t],t}function H(e){return(e<<1)-(e>4?9:0)}function le(e){for(var t=e.length;--t>=0;)e[t]=0}function ue(e){var n=e.state,r=n.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(t.arraySet(e.output,n.pending_buf,n.pending_out,r,e.next_out),e.next_out+=r,n.pending_out+=r,e.total_out+=r,e.avail_out-=r,n.pending-=r,n.pending===0&&(n.pending_out=0))}function de(e,t){n._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ue(e.strm)}function U(e,t){e.pending_buf[e.pending++]=t}function fe(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function pe(e,n,a,o){var s=e.avail_in;return s>o&&(s=o),s===0?0:(e.avail_in-=s,t.arraySet(n,e.input,e.next_in,s,a),e.state.wrap===1?e.adler=r(e.adler,n,s,a):e.state.wrap===2&&(e.adler=i(e.adler,n,s,a)),e.next_in+=s,e.total_in+=s,s)}function me(e,t){var n=e.max_chain_length,r=e.strstart,i,a,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-F?e.strstart-(e.w_size-F):0,l=e.window,u=e.w_mask,d=e.prev,f=e.strstart+P,p=l[r+o-1],m=l[r+o];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(i=t,l[i+o]!==m||l[i+o-1]!==p||l[i]!==l[r]||l[++i]!==l[r+1])continue;r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<f);if(a=P-(f-r),r=f-P,a>o){if(e.match_start=t,o=a,a>=s)break;p=l[r+o-1],m=l[r+o]}}while((t=d[t&u])>c&&--n!==0);return o<=e.lookahead?o:e.lookahead}function W(e){var n=e.w_size,r,i,a,o,s;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-F)){t.arraySet(e.window,e.window,n,n,0),e.match_start-=n,e.strstart-=n,e.block_start-=n,i=e.hash_size,r=i;do a=e.head[--r],e.head[r]=a>=n?a-n:0;while(--i);i=n,r=i;do a=e.prev[--r],e.prev[r]=a>=n?a-n:0;while(--i);o+=n}if(e.strm.avail_in===0)break;if(i=pe(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=N)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+N-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<N)););}while(e.lookahead<F&&e.strm.avail_in!==0)}function he(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(W(e),e.lookahead===0&&t===o)return V;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((e.strstart===0||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,de(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-F&&(de(e,!1),e.strm.avail_out===0))return V}return e.insert=0,t===l?(de(e,!0),e.strm.avail_out===0?ae:oe):(e.strstart>e.block_start&&(de(e,!1),e.strm.avail_out),V)}function ge(e,t){for(var r,i;;){if(e.lookahead<F){if(W(e),e.lookahead<F&&t===o)return V;if(e.lookahead===0)break}if(r=0,e.lookahead>=N&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-F&&(e.match_length=me(e,r)),e.match_length>=N)if(i=n._tr_tally(e,e.strstart-e.match_start,e.match_length-N),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=N){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(de(e,!1),e.strm.avail_out===0))return V}return e.insert=e.strstart<N-1?e.strstart:N-1,t===l?(de(e,!0),e.strm.avail_out===0?ae:oe):e.last_lit&&(de(e,!1),e.strm.avail_out===0)?V:ie}function _e(e,t){for(var r,i,a;;){if(e.lookahead<F){if(W(e),e.lookahead<F&&t===o)return V;if(e.lookahead===0)break}if(r=0,e.lookahead>=N&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=N-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-F&&(e.match_length=me(e,r),e.match_length<=5&&(e.strategy===_||e.match_length===N&&e.strstart-e.match_start>4096)&&(e.match_length=N-1)),e.prev_length>=N&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-N,i=n._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-N),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=N-1,e.strstart++,i&&(de(e,!1),e.strm.avail_out===0))return V}else if(e.match_available){if(i=n._tr_tally(e,0,e.window[e.strstart-1]),i&&de(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return V}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&=(i=n._tr_tally(e,0,e.window[e.strstart-1]),0),e.insert=e.strstart<N-1?e.strstart:N-1,t===l?(de(e,!0),e.strm.avail_out===0?ae:oe):e.last_lit&&(de(e,!1),e.strm.avail_out===0)?V:ie}function G(e,t){for(var r,i,a,s,c=e.window;;){if(e.lookahead<=P){if(W(e),e.lookahead<=P&&t===o)return V;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=N&&e.strstart>0&&(a=e.strstart-1,i=c[a],i===c[++a]&&i===c[++a]&&i===c[++a])){s=e.strstart+P;do;while(i===c[++a]&&i===c[++a]&&i===c[++a]&&i===c[++a]&&i===c[++a]&&i===c[++a]&&i===c[++a]&&i===c[++a]&&a<s);e.match_length=P-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=N?(r=n._tr_tally(e,1,e.match_length-N),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(de(e,!1),e.strm.avail_out===0))return V}return e.insert=0,t===l?(de(e,!0),e.strm.avail_out===0?ae:oe):e.last_lit&&(de(e,!1),e.strm.avail_out===0)?V:ie}function K(e,t){for(var r;;){if(e.lookahead===0&&(W(e),e.lookahead===0)){if(t===o)return V;break}if(e.match_length=0,r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(de(e,!1),e.strm.avail_out===0))return V}return e.insert=0,t===l?(de(e,!0),e.strm.avail_out===0?ae:oe):e.last_lit&&(de(e,!1),e.strm.avail_out===0)?V:ie}function ve(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var ye=[new ve(0,0,0,0,he),new ve(4,4,8,4,ge),new ve(4,5,16,8,ge),new ve(4,6,32,32,ge),new ve(4,4,16,16,_e),new ve(8,16,32,32,_e),new ve(8,16,128,128,_e),new ve(8,32,128,256,_e),new ve(32,128,258,1024,_e),new ve(32,258,258,4096,_e)];function be(e){e.window_size=2*e.w_size,le(e.head),e.max_lazy_match=ye[e.level].max_lazy,e.good_match=ye[e.level].good_length,e.nice_match=ye[e.level].nice_length,e.max_chain_length=ye[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=N-1,e.match_available=0,e.ins_h=0}function xe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(j*2),this.dyn_dtree=new t.Buf16((2*k+1)*2),this.bl_tree=new t.Buf16((2*A+1)*2),le(this.dyn_ltree),le(this.dyn_dtree),le(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(M+1),this.heap=new t.Buf16(2*O+1),le(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*O+1),le(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Se(e){var t;return!e||!e.state?ce(e,p):(e.total_in=e.total_out=0,e.data_type=S,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ee:ne,e.adler=t.wrap===2?0:1,t.last_flush=o,n._tr_init(t),d)}function Ce(e){var t=Se(e);return t===d&&be(e.state),t}function we(e,t){return!e||!e.state||e.state.wrap!==2?p:(e.state.gzhead=t,d)}function Te(e,n,r,i,a,o){if(!e)return p;var s=1;if(n===g&&(n=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),a<1||a>w||r!==C||i<8||i>15||n<0||n>9||o<0||o>b)return ce(e,p);i===8&&(i=9);var c=new xe;return e.state=c,c.strm=e,c.wrap=s,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=a+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+N-1)/N),c.window=new t.Buf8(c.w_size*2),c.head=new t.Buf16(c.hash_size),c.prev=new t.Buf16(c.w_size),c.lit_bufsize=1<<a+6,c.pending_buf_size=c.lit_bufsize*4,c.pending_buf=new t.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=n,c.strategy=o,c.method=r,Ce(e)}function Ee(e,t){return Te(e,t,C,E,D,x)}function De(e,t){var r,a,m,g;if(!e||!e.state||t>u||t<0)return e?ce(e,p):p;if(a=e.state,!e.output||!e.input&&e.avail_in!==0||a.status===re&&t!==l)return ce(e,e.avail_out===0?h:p);if(a.strm=e,r=a.last_flush,a.last_flush=t,a.status===ee)if(a.wrap===2)e.adler=0,U(a,31),U(a,139),U(a,8),a.gzhead?(U(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),U(a,a.gzhead.time&255),U(a,a.gzhead.time>>8&255),U(a,a.gzhead.time>>16&255),U(a,a.gzhead.time>>24&255),U(a,a.level===9?2:a.strategy>=v||a.level<2?4:0),U(a,a.gzhead.os&255),a.gzhead.extra&&a.gzhead.extra.length&&(U(a,a.gzhead.extra.length&255),U(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=i(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=R):(U(a,0),U(a,0),U(a,0),U(a,0),U(a,0),U(a,a.level===9?2:a.strategy>=v||a.level<2?4:0),U(a,se),a.status=ne);else{var _=C+(a.w_bits-8<<4)<<8,b=-1;b=a.strategy>=v||a.level<2?0:a.level<6?1:a.level===6?2:3,_|=b<<6,a.strstart!==0&&(_|=I),_+=31-_%31,a.status=ne,fe(a,_),a.strstart!==0&&(fe(a,e.adler>>>16),fe(a,e.adler&65535)),e.adler=1}if(a.status===R)if(a.gzhead.extra){for(m=a.pending;a.gzindex<(a.gzhead.extra.length&65535)&&!(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>m&&(e.adler=i(e.adler,a.pending_buf,a.pending-m,m)),ue(e),m=a.pending,a.pending===a.pending_buf_size));)U(a,a.gzhead.extra[a.gzindex]&255),a.gzindex++;a.gzhead.hcrc&&a.pending>m&&(e.adler=i(e.adler,a.pending_buf,a.pending-m,m)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=z)}else a.status=z;if(a.status===z)if(a.gzhead.name){m=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>m&&(e.adler=i(e.adler,a.pending_buf,a.pending-m,m)),ue(e),m=a.pending,a.pending===a.pending_buf_size)){g=1;break}g=a.gzindex<a.gzhead.name.length?a.gzhead.name.charCodeAt(a.gzindex++)&255:0,U(a,g)}while(g!==0);a.gzhead.hcrc&&a.pending>m&&(e.adler=i(e.adler,a.pending_buf,a.pending-m,m)),g===0&&(a.gzindex=0,a.status=B)}else a.status=B;if(a.status===B)if(a.gzhead.comment){m=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>m&&(e.adler=i(e.adler,a.pending_buf,a.pending-m,m)),ue(e),m=a.pending,a.pending===a.pending_buf_size)){g=1;break}g=a.gzindex<a.gzhead.comment.length?a.gzhead.comment.charCodeAt(a.gzindex++)&255:0,U(a,g)}while(g!==0);a.gzhead.hcrc&&a.pending>m&&(e.adler=i(e.adler,a.pending_buf,a.pending-m,m)),g===0&&(a.status=te)}else a.status=te;if(a.status===te&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&ue(e),a.pending+2<=a.pending_buf_size&&(U(a,e.adler&255),U(a,e.adler>>8&255),e.adler=0,a.status=ne)):a.status=ne),a.pending!==0){if(ue(e),e.avail_out===0)return a.last_flush=-1,d}else if(e.avail_in===0&&H(t)<=H(r)&&t!==l)return ce(e,h);if(a.status===re&&e.avail_in!==0)return ce(e,h);if(e.avail_in!==0||a.lookahead!==0||t!==o&&a.status!==re){var x=a.strategy===v?K(a,t):a.strategy===y?G(a,t):ye[a.level].func(a,t);if((x===ae||x===oe)&&(a.status=re),x===V||x===ae)return e.avail_out===0&&(a.last_flush=-1),d;if(x===ie&&(t===s?n._tr_align(a):t!==u&&(n._tr_stored_block(a,0,0,!1),t===c&&(le(a.head),a.lookahead===0&&(a.strstart=0,a.block_start=0,a.insert=0))),ue(e),e.avail_out===0))return a.last_flush=-1,d}return t===l?a.wrap<=0?f:(a.wrap===2?(U(a,e.adler&255),U(a,e.adler>>8&255),U(a,e.adler>>16&255),U(a,e.adler>>24&255),U(a,e.total_in&255),U(a,e.total_in>>8&255),U(a,e.total_in>>16&255),U(a,e.total_in>>24&255)):(fe(a,e.adler>>>16),fe(a,e.adler&65535)),ue(e),a.wrap>0&&(a.wrap=-a.wrap),a.pending===0?f:d):d}function Oe(e){var t;return!e||!e.state?p:(t=e.state.status,t!==ee&&t!==R&&t!==z&&t!==B&&t!==te&&t!==ne&&t!==re?ce(e,p):(e.state=null,t===ne?ce(e,m):d))}function ke(e,n){var i=n.length,a,o,s,c,l,u,f,m;if(!e||!e.state||(a=e.state,c=a.wrap,c===2||c===1&&a.status!==ee||a.lookahead))return p;for(c===1&&(e.adler=r(e.adler,n,i,0)),a.wrap=0,i>=a.w_size&&(c===0&&(le(a.head),a.strstart=0,a.block_start=0,a.insert=0),m=new t.Buf8(a.w_size),t.arraySet(m,n,i-a.w_size,a.w_size,0),n=m,i=a.w_size),l=e.avail_in,u=e.next_in,f=e.input,e.avail_in=i,e.next_in=0,e.input=n,W(a);a.lookahead>=N;){o=a.strstart,s=a.lookahead-(N-1);do a.ins_h=(a.ins_h<<a.hash_shift^a.window[o+N-1])&a.hash_mask,a.prev[o&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=o,o++;while(--s);a.strstart=o,a.lookahead=N-1,W(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=N-1,a.match_available=0,e.next_in=u,e.input=f,e.avail_in=l,a.wrap=c,d}e.deflateInit=Ee,e.deflateInit2=Te,e.deflateReset=Ce,e.deflateResetKeep=Se,e.deflateSetHeader=we,e.deflate=De,e.deflateEnd=Oe,e.deflateSetDictionary=ke,e.deflateInfo=`pako deflate (from Nodeca project)`})),pt=s((e=>{var t=st(),n=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var i=new t.Buf8(256),a=0;a<256;a++)i[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;i[254]=i[254]=1,e.string2buf=function(e){var n,r,i,a,o,s=e.length,c=0;for(a=0;a<s;a++)r=e.charCodeAt(a),(r&64512)==55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)==56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),c+=r<128?1:r<2048?2:r<65536?3:4;for(n=new t.Buf8(c),o=0,a=0;o<c;a++)r=e.charCodeAt(a),(r&64512)==55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)==56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),r<128?n[o++]=r:r<2048?(n[o++]=192|r>>>6,n[o++]=128|r&63):r<65536?(n[o++]=224|r>>>12,n[o++]=128|r>>>6&63,n[o++]=128|r&63):(n[o++]=240|r>>>18,n[o++]=128|r>>>12&63,n[o++]=128|r>>>6&63,n[o++]=128|r&63);return n};function o(e,i){if(i<65537&&(e.subarray&&r||!e.subarray&&n))return String.fromCharCode.apply(null,t.shrinkBuf(e,i));for(var a=``,o=0;o<i;o++)a+=String.fromCharCode(e[o]);return a}e.buf2binstring=function(e){return o(e,e.length)},e.binstring2buf=function(e){for(var n=new t.Buf8(e.length),r=0,i=n.length;r<i;r++)n[r]=e.charCodeAt(r);return n},e.buf2string=function(e,t){var n,r,a,s,c=t||e.length,l=Array(c*2);for(r=0,n=0;n<c;){if(a=e[n++],a<128){l[r++]=a;continue}if(s=i[a],s>4){l[r++]=65533,n+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&n<c;)a=a<<6|e[n++]&63,s--;if(s>1){l[r++]=65533;continue}a<65536?l[r++]=a:(a-=65536,l[r++]=55296|a>>10&1023,l[r++]=56320|a&1023)}return o(l,r)},e.utf8border=function(e,t){var n;for(t||=e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&(e[n]&192)==128;)n--;return n<0||n===0?t:n+i[e[n]]>t?n:t}})),mt=s(((e,t)=>{function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=``,this.state=null,this.data_type=2,this.adler=0}t.exports=n})),ht=s((e=>{var t=ft(),n=st(),r=pt(),i=dt(),a=mt(),o=Object.prototype.toString,s=0,c=4,l=0,u=1,d=2,f=-1,p=0,m=8;function h(e){if(!(this instanceof h))return new h(e);this.options=n.assign({level:f,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:``},e||{});var s=this.options;s.raw&&s.windowBits>0?s.windowBits=-s.windowBits:s.gzip&&s.windowBits>0&&s.windowBits<16&&(s.windowBits+=16),this.err=0,this.msg=``,this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var c=t.deflateInit2(this.strm,s.level,s.method,s.windowBits,s.memLevel,s.strategy);if(c!==l)throw Error(i[c]);if(s.header&&t.deflateSetHeader(this.strm,s.header),s.dictionary){var u=typeof s.dictionary==`string`?r.string2buf(s.dictionary):o.call(s.dictionary)===`[object ArrayBuffer]`?new Uint8Array(s.dictionary):s.dictionary;if(c=t.deflateSetDictionary(this.strm,u),c!==l)throw Error(i[c]);this._dict_set=!0}}h.prototype.push=function(e,i){var a=this.strm,f=this.options.chunkSize,p,m;if(this.ended)return!1;m=i===~~i?i:i===!0?c:s,typeof e==`string`?a.input=r.string2buf(e):o.call(e)===`[object ArrayBuffer]`?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(a.avail_out===0&&(a.output=new n.Buf8(f),a.next_out=0,a.avail_out=f),p=t.deflate(a,m),p!==u&&p!==l)return this.onEnd(p),this.ended=!0,!1;(a.avail_out===0||a.avail_in===0&&(m===c||m===d))&&(this.options.to===`string`?this.onData(r.buf2binstring(n.shrinkBuf(a.output,a.next_out))):this.onData(n.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||a.avail_out===0)&&p!==u);return m===c?(p=t.deflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===l):m===d?(this.onEnd(l),a.avail_out=0,!0):!0},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===l&&(this.options.to===`string`?this.result=this.chunks.join(``):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function g(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function _(e,t){return t||={},t.raw=!0,g(e,t)}function v(e,t){return t||={},t.gzip=!0,g(e,t)}e.Deflate=h,e.deflate=g,e.deflateRaw=_,e.gzip=v})),gt=s(((e,t)=>{var n=30,r=12;t.exports=function(e,t){var i=e.state,a=e.next_in,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,E,D,O=e.input,k;o=a+(e.avail_in-5),s=e.next_out,k=e.output,c=s-(t-e.avail_out),l=s+(e.avail_out-257),u=i.dmax,d=i.wsize,f=i.whave,p=i.wnext,m=i.window,h=i.hold,g=i.bits,_=i.lencode,v=i.distcode,y=(1<<i.lenbits)-1,b=(1<<i.distbits)-1;top:do{g<15&&(h+=O[a++]<<g,g+=8,h+=O[a++]<<g,g+=8),x=_[h&y];dolen:for(;;){if(S=x>>>24,h>>>=S,g-=S,S=x>>>16&255,S===0)k[s++]=x&65535;else if(S&16){C=x&65535,S&=15,S&&(g<S&&(h+=O[a++]<<g,g+=8),C+=h&(1<<S)-1,h>>>=S,g-=S),g<15&&(h+=O[a++]<<g,g+=8,h+=O[a++]<<g,g+=8),x=v[h&b];dodist:for(;;){if(S=x>>>24,h>>>=S,g-=S,S=x>>>16&255,S&16){if(w=x&65535,S&=15,g<S&&(h+=O[a++]<<g,g+=8,g<S&&(h+=O[a++]<<g,g+=8)),w+=h&(1<<S)-1,w>u){e.msg=`invalid distance too far back`,i.mode=n;break top}if(h>>>=S,g-=S,S=s-c,w>S){if(S=w-S,S>f&&i.sane){e.msg=`invalid distance too far back`,i.mode=n;break top}if(E=0,D=m,p===0){if(E+=d-S,S<C){C-=S;do k[s++]=m[E++];while(--S);E=s-w,D=k}}else if(p<S){if(E+=d+p-S,S-=p,S<C){C-=S;do k[s++]=m[E++];while(--S);if(E=0,p<C){S=p,C-=S;do k[s++]=m[E++];while(--S);E=s-w,D=k}}}else if(E+=p-S,S<C){C-=S;do k[s++]=m[E++];while(--S);E=s-w,D=k}for(;C>2;)k[s++]=D[E++],k[s++]=D[E++],k[s++]=D[E++],C-=3;C&&(k[s++]=D[E++],C>1&&(k[s++]=D[E++]))}else{E=s-w;do k[s++]=k[E++],k[s++]=k[E++],k[s++]=k[E++],C-=3;while(C>2);C&&(k[s++]=k[E++],C>1&&(k[s++]=k[E++]))}}else if(S&64){e.msg=`invalid distance code`,i.mode=n;break top}else{x=v[(x&65535)+(h&(1<<S)-1)];continue dodist}break}}else if(!(S&64)){x=_[(x&65535)+(h&(1<<S)-1)];continue dolen}else if(S&32){i.mode=r;break top}else{e.msg=`invalid literal/length code`,i.mode=n;break top}break}}while(a<o&&s<l);C=g>>3,a-=C,g-=C<<3,h&=(1<<g)-1,e.next_in=a,e.next_out=s,e.avail_in=a<o?5+(o-a):5-(a-o),e.avail_out=s<l?257+(l-s):257-(s-l),i.hold=h,i.bits=g}})),_t=s(((e,t)=>{var n=st(),r=15,i=852,a=592,o=0,s=1,c=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,p,m,h,g,_,v){var y=v.bits,b=0,x=0,S=0,C=0,w=0,E=0,D=0,O=0,k=0,A=0,j,M,N,P,F,I=null,ee=0,R,z=new n.Buf16(r+1),B=new n.Buf16(r+1),te=null,ne=0,re,V,ie;for(b=0;b<=r;b++)z[b]=0;for(x=0;x<m;x++)z[t[p+x]]++;for(w=y,C=r;C>=1&&z[C]===0;C--);if(w>C&&(w=C),C===0)return h[g++]=20971520,h[g++]=20971520,v.bits=1,0;for(S=1;S<C&&z[S]===0;S++);for(w<S&&(w=S),O=1,b=1;b<=r;b++)if(O<<=1,O-=z[b],O<0)return-1;if(O>0&&(e===o||C!==1))return-1;for(B[1]=0,b=1;b<r;b++)B[b+1]=B[b]+z[b];for(x=0;x<m;x++)t[p+x]!==0&&(_[B[t[p+x]]++]=x);if(e===o?(I=te=_,R=19):e===s?(I=l,ee-=257,te=u,ne-=257,R=256):(I=d,te=f,R=-1),A=0,x=0,b=S,F=g,E=w,D=0,N=-1,k=1<<w,P=k-1,e===s&&k>i||e===c&&k>a)return 1;for(var ae=0;;){ae++,re=b-D,_[x]<R?(V=0,ie=_[x]):_[x]>R?(V=te[ne+_[x]],ie=I[ee+_[x]]):(V=96,ie=0),j=1<<b-D,M=1<<E,S=M;do M-=j,h[F+(A>>D)+M]=re<<24|V<<16|ie|0;while(M!==0);for(j=1<<b-1;A&j;)j>>=1;if(j===0?A=0:(A&=j-1,A+=j),x++,--z[b]===0){if(b===C)break;b=t[p+_[x]]}if(b>w&&(A&P)!==N){for(D===0&&(D=w),F+=S,E=b-D,O=1<<E;E+D<C&&(O-=z[E+D],!(O<=0));)E++,O<<=1;if(k+=1<<E,e===s&&k>i||e===c&&k>a)return 1;N=A&P,h[N]=w<<24|E<<16|F-g|0}}return A!==0&&(h[F+A]=b-D<<24|4194304),v.bits=w,0}})),vt=s((e=>{var t=st(),n=lt(),r=ut(),i=gt(),a=_t(),o=0,s=1,c=2,l=4,u=5,d=6,f=0,p=1,m=2,h=-2,g=-3,_=-4,v=-5,y=8,b=1,x=2,S=3,C=4,w=5,E=6,D=7,O=8,k=9,A=10,j=11,M=12,N=13,P=14,F=15,I=16,ee=17,R=18,z=19,B=20,te=21,ne=22,re=23,V=24,ie=25,ae=26,oe=27,se=28,ce=29,H=30,le=31,ue=32,de=852,U=592,fe=15;function pe(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function me(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function W(e){var n;return!e||!e.state?h:(n=e.state,e.total_in=e.total_out=n.total=0,e.msg=``,n.wrap&&(e.adler=n.wrap&1),n.mode=b,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new t.Buf32(de),n.distcode=n.distdyn=new t.Buf32(U),n.sane=1,n.back=-1,f)}function he(e){var t;return!e||!e.state?h:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,W(e))}function ge(e,t){var n,r;return!e||!e.state||(r=e.state,t<0?(n=0,t=-t):(n=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15))?h:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,he(e))}function _e(e,t){var n,r;return e?(r=new me,e.state=r,r.window=null,n=ge(e,t),n!==f&&(e.state=null),n):h}function G(e){return _e(e,fe)}var K=!0,ve,ye;function be(e){if(K){var n;for(ve=new t.Buf32(512),ye=new t.Buf32(32),n=0;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(a(s,e.lens,0,288,ve,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;a(c,e.lens,0,32,ye,0,e.work,{bits:5}),K=!1}e.lencode=ve,e.lenbits=9,e.distcode=ye,e.distbits=5}function xe(e,n,r,i){var a,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new t.Buf8(o.wsize)),i>=o.wsize?(t.arraySet(o.window,n,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(a=o.wsize-o.wnext,a>i&&(a=i),t.arraySet(o.window,n,r-i,a,o.wnext),i-=a,i?(t.arraySet(o.window,n,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}function Se(e,de){var U,fe,me,W,he,ge,_e,G,K,ve,ye,Se,Ce,we,Te=0,Ee,De,Oe,ke,Ae,je,Me,Ne,Pe=new t.Buf8(4),Fe,Ie,Le=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return h;U=e.state,U.mode===M&&(U.mode=N),he=e.next_out,me=e.output,_e=e.avail_out,W=e.next_in,fe=e.input,ge=e.avail_in,G=U.hold,K=U.bits,ve=ge,ye=_e,Ne=f;inf_leave:for(;;)switch(U.mode){case b:if(U.wrap===0){U.mode=N;break}for(;K<16;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if(U.wrap&2&&G===35615){U.check=0,Pe[0]=G&255,Pe[1]=G>>>8&255,U.check=r(U.check,Pe,2,0),G=0,K=0,U.mode=x;break}if(U.flags=0,U.head&&(U.head.done=!1),!(U.wrap&1)||(((G&255)<<8)+(G>>8))%31){e.msg=`incorrect header check`,U.mode=H;break}if((G&15)!==y){e.msg=`unknown compression method`,U.mode=H;break}if(G>>>=4,K-=4,Me=(G&15)+8,U.wbits===0)U.wbits=Me;else if(Me>U.wbits){e.msg=`invalid window size`,U.mode=H;break}U.dmax=1<<Me,e.adler=U.check=1,U.mode=G&512?A:M,G=0,K=0;break;case x:for(;K<16;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if(U.flags=G,(U.flags&255)!==y){e.msg=`unknown compression method`,U.mode=H;break}if(U.flags&57344){e.msg=`unknown header flags set`,U.mode=H;break}U.head&&(U.head.text=G>>8&1),U.flags&512&&(Pe[0]=G&255,Pe[1]=G>>>8&255,U.check=r(U.check,Pe,2,0)),G=0,K=0,U.mode=S;case S:for(;K<32;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}U.head&&(U.head.time=G),U.flags&512&&(Pe[0]=G&255,Pe[1]=G>>>8&255,Pe[2]=G>>>16&255,Pe[3]=G>>>24&255,U.check=r(U.check,Pe,4,0)),G=0,K=0,U.mode=C;case C:for(;K<16;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}U.head&&(U.head.xflags=G&255,U.head.os=G>>8),U.flags&512&&(Pe[0]=G&255,Pe[1]=G>>>8&255,U.check=r(U.check,Pe,2,0)),G=0,K=0,U.mode=w;case w:if(U.flags&1024){for(;K<16;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}U.length=G,U.head&&(U.head.extra_len=G),U.flags&512&&(Pe[0]=G&255,Pe[1]=G>>>8&255,U.check=r(U.check,Pe,2,0)),G=0,K=0}else U.head&&(U.head.extra=null);U.mode=E;case E:if(U.flags&1024&&(Se=U.length,Se>ge&&(Se=ge),Se&&(U.head&&(Me=U.head.extra_len-U.length,U.head.extra||(U.head.extra=Array(U.head.extra_len)),t.arraySet(U.head.extra,fe,W,Se,Me)),U.flags&512&&(U.check=r(U.check,fe,Se,W)),ge-=Se,W+=Se,U.length-=Se),U.length))break inf_leave;U.length=0,U.mode=D;case D:if(U.flags&2048){if(ge===0)break inf_leave;Se=0;do Me=fe[W+ Se++],U.head&&Me&&U.length<65536&&(U.head.name+=String.fromCharCode(Me));while(Me&&Se<ge);if(U.flags&512&&(U.check=r(U.check,fe,Se,W)),ge-=Se,W+=Se,Me)break inf_leave}else U.head&&(U.head.name=null);U.length=0,U.mode=O;case O:if(U.flags&4096){if(ge===0)break inf_leave;Se=0;do Me=fe[W+ Se++],U.head&&Me&&U.length<65536&&(U.head.comment+=String.fromCharCode(Me));while(Me&&Se<ge);if(U.flags&512&&(U.check=r(U.check,fe,Se,W)),ge-=Se,W+=Se,Me)break inf_leave}else U.head&&(U.head.comment=null);U.mode=k;case k:if(U.flags&512){for(;K<16;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if(G!==(U.check&65535)){e.msg=`header crc mismatch`,U.mode=H;break}G=0,K=0}U.head&&(U.head.hcrc=U.flags>>9&1,U.head.done=!0),e.adler=U.check=0,U.mode=M;break;case A:for(;K<32;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}e.adler=U.check=pe(G),G=0,K=0,U.mode=j;case j:if(U.havedict===0)return e.next_out=he,e.avail_out=_e,e.next_in=W,e.avail_in=ge,U.hold=G,U.bits=K,m;e.adler=U.check=1,U.mode=M;case M:if(de===u||de===d)break inf_leave;case N:if(U.last){G>>>=K&7,K-=K&7,U.mode=oe;break}for(;K<3;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}switch(U.last=G&1,G>>>=1,--K,G&3){case 0:U.mode=P;break;case 1:if(be(U),U.mode=B,de===d){G>>>=2,K-=2;break inf_leave}break;case 2:U.mode=ee;break;case 3:e.msg=`invalid block type`,U.mode=H}G>>>=2,K-=2;break;case P:for(G>>>=K&7,K-=K&7;K<32;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if((G&65535)!=(G>>>16^65535)){e.msg=`invalid stored block lengths`,U.mode=H;break}if(U.length=G&65535,G=0,K=0,U.mode=F,de===d)break inf_leave;case F:U.mode=I;case I:if(Se=U.length,Se){if(Se>ge&&(Se=ge),Se>_e&&(Se=_e),Se===0)break inf_leave;t.arraySet(me,fe,W,Se,he),ge-=Se,W+=Se,_e-=Se,he+=Se,U.length-=Se;break}U.mode=M;break;case ee:for(;K<14;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if(U.nlen=(G&31)+257,G>>>=5,K-=5,U.ndist=(G&31)+1,G>>>=5,K-=5,U.ncode=(G&15)+4,G>>>=4,K-=4,U.nlen>286||U.ndist>30){e.msg=`too many length or distance symbols`,U.mode=H;break}U.have=0,U.mode=R;case R:for(;U.have<U.ncode;){for(;K<3;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}U.lens[Le[U.have++]]=G&7,G>>>=3,K-=3}for(;U.have<19;)U.lens[Le[U.have++]]=0;if(U.lencode=U.lendyn,U.lenbits=7,Fe={bits:U.lenbits},Ne=a(o,U.lens,0,19,U.lencode,0,U.work,Fe),U.lenbits=Fe.bits,Ne){e.msg=`invalid code lengths set`,U.mode=H;break}U.have=0,U.mode=z;case z:for(;U.have<U.nlen+U.ndist;){for(;Te=U.lencode[G&(1<<U.lenbits)-1],Ee=Te>>>24,De=Te>>>16&255,Oe=Te&65535,!(Ee<=K);){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if(Oe<16)G>>>=Ee,K-=Ee,U.lens[U.have++]=Oe;else{if(Oe===16){for(Ie=Ee+2;K<Ie;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if(G>>>=Ee,K-=Ee,U.have===0){e.msg=`invalid bit length repeat`,U.mode=H;break}Me=U.lens[U.have-1],Se=3+(G&3),G>>>=2,K-=2}else if(Oe===17){for(Ie=Ee+3;K<Ie;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}G>>>=Ee,K-=Ee,Me=0,Se=3+(G&7),G>>>=3,K-=3}else{for(Ie=Ee+7;K<Ie;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}G>>>=Ee,K-=Ee,Me=0,Se=11+(G&127),G>>>=7,K-=7}if(U.have+Se>U.nlen+U.ndist){e.msg=`invalid bit length repeat`,U.mode=H;break}for(;Se--;)U.lens[U.have++]=Me}}if(U.mode===H)break;if(U.lens[256]===0){e.msg=`invalid code -- missing end-of-block`,U.mode=H;break}if(U.lenbits=9,Fe={bits:U.lenbits},Ne=a(s,U.lens,0,U.nlen,U.lencode,0,U.work,Fe),U.lenbits=Fe.bits,Ne){e.msg=`invalid literal/lengths set`,U.mode=H;break}if(U.distbits=6,U.distcode=U.distdyn,Fe={bits:U.distbits},Ne=a(c,U.lens,U.nlen,U.ndist,U.distcode,0,U.work,Fe),U.distbits=Fe.bits,Ne){e.msg=`invalid distances set`,U.mode=H;break}if(U.mode=B,de===d)break inf_leave;case B:U.mode=te;case te:if(ge>=6&&_e>=258){e.next_out=he,e.avail_out=_e,e.next_in=W,e.avail_in=ge,U.hold=G,U.bits=K,i(e,ye),he=e.next_out,me=e.output,_e=e.avail_out,W=e.next_in,fe=e.input,ge=e.avail_in,G=U.hold,K=U.bits,U.mode===M&&(U.back=-1);break}for(U.back=0;Te=U.lencode[G&(1<<U.lenbits)-1],Ee=Te>>>24,De=Te>>>16&255,Oe=Te&65535,!(Ee<=K);){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if(De&&!(De&240)){for(ke=Ee,Ae=De,je=Oe;Te=U.lencode[je+((G&(1<<ke+Ae)-1)>>ke)],Ee=Te>>>24,De=Te>>>16&255,Oe=Te&65535,!(ke+Ee<=K);){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}G>>>=ke,K-=ke,U.back+=ke}if(G>>>=Ee,K-=Ee,U.back+=Ee,U.length=Oe,De===0){U.mode=ae;break}if(De&32){U.back=-1,U.mode=M;break}if(De&64){e.msg=`invalid literal/length code`,U.mode=H;break}U.extra=De&15,U.mode=ne;case ne:if(U.extra){for(Ie=U.extra;K<Ie;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}U.length+=G&(1<<U.extra)-1,G>>>=U.extra,K-=U.extra,U.back+=U.extra}U.was=U.length,U.mode=re;case re:for(;Te=U.distcode[G&(1<<U.distbits)-1],Ee=Te>>>24,De=Te>>>16&255,Oe=Te&65535,!(Ee<=K);){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if(!(De&240)){for(ke=Ee,Ae=De,je=Oe;Te=U.distcode[je+((G&(1<<ke+Ae)-1)>>ke)],Ee=Te>>>24,De=Te>>>16&255,Oe=Te&65535,!(ke+Ee<=K);){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}G>>>=ke,K-=ke,U.back+=ke}if(G>>>=Ee,K-=Ee,U.back+=Ee,De&64){e.msg=`invalid distance code`,U.mode=H;break}U.offset=Oe,U.extra=De&15,U.mode=V;case V:if(U.extra){for(Ie=U.extra;K<Ie;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}U.offset+=G&(1<<U.extra)-1,G>>>=U.extra,K-=U.extra,U.back+=U.extra}if(U.offset>U.dmax){e.msg=`invalid distance too far back`,U.mode=H;break}U.mode=ie;case ie:if(_e===0)break inf_leave;if(Se=ye-_e,U.offset>Se){if(Se=U.offset-Se,Se>U.whave&&U.sane){e.msg=`invalid distance too far back`,U.mode=H;break}Se>U.wnext?(Se-=U.wnext,Ce=U.wsize-Se):Ce=U.wnext-Se,Se>U.length&&(Se=U.length),we=U.window}else we=me,Ce=he-U.offset,Se=U.length;Se>_e&&(Se=_e),_e-=Se,U.length-=Se;do me[he++]=we[Ce++];while(--Se);U.length===0&&(U.mode=te);break;case ae:if(_e===0)break inf_leave;me[he++]=U.length,_e--,U.mode=te;break;case oe:if(U.wrap){for(;K<32;){if(ge===0)break inf_leave;ge--,G|=fe[W++]<<K,K+=8}if(ye-=_e,e.total_out+=ye,U.total+=ye,ye&&(e.adler=U.check=U.flags?r(U.check,me,ye,he-ye):n(U.check,me,ye,he-ye)),ye=_e,(U.flags?G:pe(G))!==U.check){e.msg=`incorrect data check`,U.mode=H;break}G=0,K=0}U.mode=se;case se:if(U.wrap&&U.flags){for(;K<32;){if(ge===0)break inf_leave;ge--,G+=fe[W++]<<K,K+=8}if(G!==(U.total&4294967295)){e.msg=`incorrect length check`,U.mode=H;break}G=0,K=0}U.mode=ce;case ce:Ne=p;break inf_leave;case H:Ne=g;break inf_leave;case le:return _;case ue:default:return h}return e.next_out=he,e.avail_out=_e,e.next_in=W,e.avail_in=ge,U.hold=G,U.bits=K,(U.wsize||ye!==e.avail_out&&U.mode<H&&(U.mode<oe||de!==l))&&xe(e,e.output,e.next_out,ye-e.avail_out)?(U.mode=le,_):(ve-=e.avail_in,ye-=e.avail_out,e.total_in+=ve,e.total_out+=ye,U.total+=ye,U.wrap&&ye&&(e.adler=U.check=U.flags?r(U.check,me,ye,e.next_out-ye):n(U.check,me,ye,e.next_out-ye)),e.data_type=U.bits+(U.last?64:0)+(U.mode===M?128:0)+(U.mode===B||U.mode===F?256:0),(ve===0&&ye===0||de===l)&&Ne===f&&(Ne=v),Ne)}function Ce(e){if(!e||!e.state)return h;var t=e.state;return t.window&&=null,e.state=null,f}function we(e,t){var n;return!e||!e.state||(n=e.state,!(n.wrap&2))?h:(n.head=t,t.done=!1,f)}function Te(e,t){var r=t.length,i,a,o;return!e||!e.state||(i=e.state,i.wrap!==0&&i.mode!==j)?h:i.mode===j&&(a=1,a=n(a,t,r,0),a!==i.check)?g:(o=xe(e,t,r,r),o?(i.mode=le,_):(i.havedict=1,f))}e.inflateReset=he,e.inflateReset2=ge,e.inflateResetKeep=W,e.inflateInit=G,e.inflateInit2=_e,e.inflate=Se,e.inflateEnd=Ce,e.inflateGetHeader=we,e.inflateSetDictionary=Te,e.inflateInfo=`pako inflate (from Nodeca project)`})),yt=s(((e,t)=>{t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}})),bt=s(((e,t)=>{function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=``,this.comment=``,this.hcrc=0,this.done=!1}t.exports=n})),xt=s((e=>{var t=vt(),n=st(),r=pt(),i=yt(),a=dt(),o=mt(),s=bt(),c=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=n.assign({chunkSize:16384,windowBits:0,to:``},e||{});var r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(e&&e.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(r.windowBits&15||(r.windowBits|=15)),this.err=0,this.msg=``,this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var c=t.inflateInit2(this.strm,r.windowBits);if(c!==i.Z_OK)throw Error(a[c]);this.header=new s,t.inflateGetHeader(this.strm,this.header)}l.prototype.push=function(e,a){var o=this.strm,s=this.options.chunkSize,l=this.options.dictionary,u,d,f,p,m,h,g=!1;if(this.ended)return!1;d=a===~~a?a:a===!0?i.Z_FINISH:i.Z_NO_FLUSH,typeof e==`string`?o.input=r.binstring2buf(e):c.call(e)===`[object ArrayBuffer]`?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(o.avail_out===0&&(o.output=new n.Buf8(s),o.next_out=0,o.avail_out=s),u=t.inflate(o,i.Z_NO_FLUSH),u===i.Z_NEED_DICT&&l&&(h=typeof l==`string`?r.string2buf(l):c.call(l)===`[object ArrayBuffer]`?new Uint8Array(l):l,u=t.inflateSetDictionary(this.strm,h)),u===i.Z_BUF_ERROR&&g===!0&&(u=i.Z_OK,g=!1),u!==i.Z_STREAM_END&&u!==i.Z_OK)return this.onEnd(u),this.ended=!0,!1;o.next_out&&(o.avail_out===0||u===i.Z_STREAM_END||o.avail_in===0&&(d===i.Z_FINISH||d===i.Z_SYNC_FLUSH))&&(this.options.to===`string`?(f=r.utf8border(o.output,o.next_out),p=o.next_out-f,m=r.buf2string(o.output,f),o.next_out=p,o.avail_out=s-p,p&&n.arraySet(o.output,o.output,f,p,0),this.onData(m)):this.onData(n.shrinkBuf(o.output,o.next_out))),o.avail_in===0&&o.avail_out===0&&(g=!0)}while((o.avail_in>0||o.avail_out===0)&&u!==i.Z_STREAM_END);return u===i.Z_STREAM_END&&(d=i.Z_FINISH),d===i.Z_FINISH?(u=t.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===i.Z_OK):d===i.Z_SYNC_FLUSH?(this.onEnd(i.Z_OK),o.avail_out=0,!0):!0},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===i.Z_OK&&(this.options.to===`string`?this.result=this.chunks.join(``):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function u(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function d(e,t){return t||={},t.raw=!0,u(e,t)}e.Inflate=l,e.inflate=u,e.inflateRaw=d,e.ungzip=u})),St=s(((e,t)=>{var n=st().assign,r=ht(),i=xt(),a=yt(),o={};n(o,r,i,a),t.exports=o})),Ct=s((e=>{var t=typeof Uint8Array<`u`&&typeof Uint16Array<`u`&&typeof Uint32Array<`u`,n=St();e.uncompressInputType=t?`uint8array`:`array`,e.compressInputType=t?`uint8array`:`array`,e.magic=`\b\0`,e.compress=function(e,t){return n.deflateRaw(e,{level:t.level||-1})},e.uncompress=function(e){return n.inflateRaw(e)}})),wt=s((e=>{e.STORE={magic:`\0\0`,compress:function(e,t){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},e.DEFLATE=Ct()})),Tt=s(((e,t)=>{t.exports=function(e,t){return new Buffer(e,t)},t.exports.test=function(e){return Buffer.isBuffer(e)}})),Et=s((e=>{var t=ot(),n=wt(),r=Tt();e.string2binary=function(e){for(var t=``,n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255);return t},e.arrayBuffer2Blob=function(t,n){e.checkSupport(`blob`),n||=`application/zip`;try{return new Blob([t],{type:n})}catch{try{var r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return r.append(t),r.getBlob(n)}catch{throw Error(`Bug : can't construct the Blob.`)}}};function i(e){return e}function a(e,t){for(var n=0;n<e.length;++n)t[n]=e.charCodeAt(n)&255;return t}function o(t){var n=65536,i=[],a=t.length,o=e.getTypeOf(t),s=0,c=!0;try{switch(o){case`uint8array`:String.fromCharCode.apply(null,new Uint8Array);break;case`nodebuffer`:String.fromCharCode.apply(null,r(0));break}}catch{c=!1}if(!c){for(var l=``,u=0;u<t.length;u++)l+=String.fromCharCode(t[u]);return l}for(;s<a&&n>1;)try{o===`array`||o===`nodebuffer`?i.push(String.fromCharCode.apply(null,t.slice(s,Math.min(s+n,a)))):i.push(String.fromCharCode.apply(null,t.subarray(s,Math.min(s+n,a)))),s+=n}catch{n=Math.floor(n/2)}return i.join(``)}e.applyFromCharCode=o;function s(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}var c={};c.string={string:i,array:function(e){return a(e,Array(e.length))},arraybuffer:function(e){return c.string.uint8array(e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:function(e){return a(e,r(e.length))}},c.array={string:o,array:i,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r(e)}},c.arraybuffer={string:function(e){return o(new Uint8Array(e))},array:function(e){return s(new Uint8Array(e),Array(e.byteLength))},arraybuffer:i,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r(new Uint8Array(e))}},c.uint8array={string:o,array:function(e){return s(e,Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:i,nodebuffer:function(e){return r(e)}},c.nodebuffer={string:o,array:function(e){return s(e,Array(e.length))},arraybuffer:function(e){return c.nodebuffer.uint8array(e).buffer},uint8array:function(e){return s(e,new Uint8Array(e.length))},nodebuffer:i},e.transformTo=function(t,n){return n||=``,t?(e.checkSupport(t),c[e.getTypeOf(n)][t](n)):n},e.getTypeOf=function(e){if(typeof e==`string`)return`string`;if(Object.prototype.toString.call(e)===`[object Array]`)return`array`;if(t.nodebuffer&&r.test(e))return`nodebuffer`;if(t.uint8array&&e instanceof Uint8Array)return`uint8array`;if(t.arraybuffer&&e instanceof ArrayBuffer)return`arraybuffer`},e.checkSupport=function(e){if(!t[e.toLowerCase()])throw Error(e+` is not supported by this browser`)},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(e){var t=``,n,r;for(r=0;r<(e||``).length;r++)n=e.charCodeAt(r),t+=`\\x`+(n<16?`0`:``)+n.toString(16).toUpperCase();return t},e.findCompression=function(e){for(var t in n)if(n.hasOwnProperty(t)&&n[t].magic===e)return n[t];return null},e.isRegExp=function(e){return Object.prototype.toString.call(e)===`[object RegExp]`}})),Dt=s(((e,t)=>{var n=Et(),r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if(e===void 0||!e.length)return 0;var i=n.getTypeOf(e)!==`string`;t===void 0&&(t=0);var a=0,o=0,s=0;t^=-1;for(var c=0,l=e.length;c<l;c++)s=i?e[c]:e.charCodeAt(c),o=(t^s)&255,a=r[o],t=t>>>8^a;return t^-1}})),Ot=s((e=>{e.LOCAL_FILE_HEADER=`PK`,e.CENTRAL_FILE_HEADER=`PK`,e.CENTRAL_DIRECTORY_END=`PK`,e.ZIP64_CENTRAL_DIRECTORY_LOCATOR=`PK\x07`,e.ZIP64_CENTRAL_DIRECTORY_END=`PK`,e.DATA_DESCRIPTOR=`PK\x07\b`})),kt=s((e=>{e.base64=!1,e.binary=!1,e.dir=!1,e.createFolders=!1,e.date=null,e.compression=null,e.compressionOptions=null,e.comment=null,e.unixPermissions=null,e.dosPermissions=null})),At=s(((e,t)=>{function n(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}n.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=n})),jt=s((e=>{for(var t=Et(),n=ot(),r=Tt(),i=Array(256),a=0;a<256;a++)i[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;i[254]=i[254]=1;var o=function(e){var t,r,i,a,o,s=e.length,c=0;for(a=0;a<s;a++)r=e.charCodeAt(a),(r&64512)==55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)==56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),c+=r<128?1:r<2048?2:r<65536?3:4;for(t=n.uint8array?new Uint8Array(c):Array(c),o=0,a=0;o<c;a++)r=e.charCodeAt(a),(r&64512)==55296&&a+1<s&&(i=e.charCodeAt(a+1),(i&64512)==56320&&(r=65536+(r-55296<<10)+(i-56320),a++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|r&63):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|r&63):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|r&63);return t},s=function(e,t){var n;for(t||=e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&(e[n]&192)==128;)n--;return n<0||n===0?t:n+i[e[n]]>t?n:t},c=function(e){var n,r,a,o,s=e.length,c=Array(s*2);for(r=0,n=0;n<s;){if(a=e[n++],a<128){c[r++]=a;continue}if(o=i[a],o>4){c[r++]=65533,n+=o-1;continue}for(a&=o===2?31:o===3?15:7;o>1&&n<s;)a=a<<6|e[n++]&63,o--;if(o>1){c[r++]=65533;continue}a<65536?c[r++]=a:(a-=65536,c[r++]=55296|a>>10&1023,c[r++]=56320|a&1023)}return c.length!==r&&(c.subarray?c=c.subarray(0,r):c.length=r),t.applyFromCharCode(c)};e.utf8encode=function(e){return n.nodebuffer?r(e,`utf-8`):o(e)},e.utf8decode=function(e){if(n.nodebuffer)return t.transformTo(`nodebuffer`,e).toString(`utf-8`);e=t.transformTo(n.uint8array?`uint8array`:`array`,e);for(var r=[],i=0,a=e.length,o=65536;i<a;){var l=s(e,Math.min(i+o,a));n.uint8array?r.push(c(e.subarray(i,l))):r.push(c(e.slice(i,l))),i=l}return r.join(``)}})),Mt=s(((e,t)=>{var n=Et(),r=function(){this.data=[]};r.prototype={append:function(e){e=n.transformTo(`string`,e),this.data.push(e)},finalize:function(){return this.data.join(``)}},t.exports=r})),Nt=s(((e,t)=>{var n=Et(),r=function(e){this.data=new Uint8Array(e),this.index=0};r.prototype={append:function(e){e.length!==0&&(e=n.transformTo(`uint8array`,e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=r})),Pt=s(((e,t)=>{var n=ot(),r=Et(),i=Dt(),a=Ot(),o=kt(),s=at(),c=wt(),l=At(),u=Tt(),d=jt(),f=Mt(),p=Nt(),m=function(e){if(e._data instanceof l&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,r.getTypeOf(e._data)===`uint8array`)){var t=e._data;e._data=new Uint8Array(t.length),t.length!==0&&e._data.set(t,0)}return e._data},h=function(e){var t=m(e);return r.getTypeOf(t)===`string`?!e.options.binary&&n.nodebuffer?u(t,`utf-8`):e.asBinary():t},g=function(e){var t=m(this);return t==null?``:(this.options.base64&&(t=s.decode(t)),t=e&&this.options.binary?A.utf8decode(t):r.transformTo(`string`,t),!e&&!this.options.binary&&(t=r.transformTo(`string`,A.utf8encode(t))),t)},_=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this.options=n,this._initialMetadata={dir:n.dir,date:n.date}};_.prototype={asText:function(){return g.call(this,!0)},asBinary:function(){return g.call(this,!1)},asNodeBuffer:function(){var e=h(this);return r.transformTo(`nodebuffer`,e)},asUint8Array:function(){var e=h(this);return r.transformTo(`uint8array`,e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var v=function(e,t){var n=``,r;for(r=0;r<t;r++)n+=String.fromCharCode(e&255),e>>>=8;return n},y=function(){var e={},t,n;for(t=0;t<arguments.length;t++)for(n in arguments[t])arguments[t].hasOwnProperty(n)&&e[n]===void 0&&(e[n]=arguments[t][n]);return e},b=function(e){return e||={},e.base64===!0&&(e.binary===null||e.binary===void 0)&&(e.binary=!0),e=y(e,o),e.date=e.date||new Date,e.compression!==null&&(e.compression=e.compression.toUpperCase()),e},x=function(e,t,n){var i=r.getTypeOf(t),a;if(n=b(n),typeof n.unixPermissions==`string`&&(n.unixPermissions=parseInt(n.unixPermissions,8)),n.unixPermissions&&n.unixPermissions&16384&&(n.dir=!0),n.dosPermissions&&n.dosPermissions&16&&(n.dir=!0),n.dir&&(e=C(e)),n.createFolders&&(a=S(e))&&w.call(this,a,!0),n.dir||t==null)n.base64=!1,n.binary=!1,t=null,i=null;else if(i===`string`)n.binary&&!n.base64&&n.optimizedBinaryString!==!0&&(t=r.string2binary(t));else{if(n.base64=!1,n.binary=!0,!i&&!(t instanceof l))throw Error(`The data of '`+e+`' is in an unsupported format !`);i===`arraybuffer`&&(t=r.transformTo(`uint8array`,t))}var o=new _(e,t,n);return this.files[e]=o,o},S=function(e){e.slice(-1)==`/`&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf(`/`);return t>0?e.substring(0,t):``},C=function(e){return e.slice(-1)!=`/`&&(e+=`/`),e},w=function(e,t){return t=t===void 0?!1:t,e=C(e),this.files[e]||x.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},E=function(e,t,n){var a=new l,o;return e._data instanceof l?(a.uncompressedSize=e._data.uncompressedSize,a.crc32=e._data.crc32,a.uncompressedSize===0||e.dir?(t=c.STORE,a.compressedContent=``,a.crc32=0):e._data.compressionMethod===t.magic?a.compressedContent=e._data.getCompressedContent():(o=e._data.getContent(),a.compressedContent=t.compress(r.transformTo(t.compressInputType,o),n))):(o=h(e),(!o||o.length===0||e.dir)&&(t=c.STORE,o=``),a.uncompressedSize=o.length,a.crc32=i(o),a.compressedContent=t.compress(r.transformTo(t.compressInputType,o),n)),a.compressedSize=a.compressedContent.length,a.compressionMethod=t.magic,a},D=function(e,t){var n=e;return e||(n=t?16893:33204),(n&65535)<<16},O=function(e,t){return(e||0)&63},k=function(e,t,n,o,s){n.compressedContent;var c=r.transformTo(`string`,d.utf8encode(t.name)),l=t.comment||``,u=r.transformTo(`string`,d.utf8encode(l)),f=c.length!==t.name.length,p=u.length!==l.length,m=t.options,h,g,_=``,y=``,b=``,x=t._initialMetadata.dir===t.dir?m.dir:t.dir,S=t._initialMetadata.date===t.date?m.date:t.date,C=0,w=0;x&&(C|=16),s===`UNIX`?(w=798,C|=D(t.unixPermissions,x)):(w=20,C|=O(t.dosPermissions,x)),h=S.getHours(),h<<=6,h|=S.getMinutes(),h<<=5,h|=S.getSeconds()/2,g=S.getFullYear()-1980,g<<=4,g|=S.getMonth()+1,g<<=5,g|=S.getDate(),f&&(y=v(1,1)+v(i(c),4)+c,_+=`up`+v(y.length,2)+y),p&&(b=v(1,1)+v(this.crc32(u),4)+u,_+=`uc`+v(b.length,2)+b);var E=``;return E+=`
\0`,E+=f||p?`\0\b`:`\0\0`,E+=n.compressionMethod,E+=v(h,2),E+=v(g,2),E+=v(n.crc32,4),E+=v(n.compressedSize,4),E+=v(n.uncompressedSize,4),E+=v(c.length,2),E+=v(_.length,2),{fileRecord:a.LOCAL_FILE_HEADER+E+c+_,dirRecord:a.CENTRAL_FILE_HEADER+v(w,2)+E+v(u.length,2)+`\0\0\0\0`+v(C,4)+v(o,4)+c+_+u,compressedObject:n}},A={load:function(e,t){throw Error(`Load method is not defined. Is the file jszip-load.js included ?`)},filter:function(e){var t=[],n,r,i,a;for(n in this.files)this.files.hasOwnProperty(n)&&(i=this.files[n],a=new _(i.name,i._data,y(i.options)),r=n.slice(this.root.length,n.length),n.slice(0,this.root.length)===this.root&&e(r,a)&&t.push(a));return t},file:function(e,t,n){if(arguments.length===1)if(r.isRegExp(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}else return this.filter(function(t,n){return!n.dir&&t===e})[0]||null;else e=this.root+e,x.call(this,e,t,n);return this},folder:function(e){if(!e)return this;if(r.isRegExp(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,n=w.call(this,t),i=this.clone();return i.root=n.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||=(e.slice(-1)!=`/`&&(e+=`/`),this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(e){e=y(e||{},{base64:!0,compression:`STORE`,compressionOptions:null,type:`base64`,platform:`DOS`,comment:null,mimeType:`application/zip`}),r.checkSupport(e.type),(e.platform===`darwin`||e.platform===`freebsd`||e.platform===`linux`||e.platform===`sunos`)&&(e.platform=`UNIX`),e.platform===`win32`&&(e.platform=`DOS`);var t=[],n=0,i=0,o,l,u=r.transformTo(`string`,this.utf8encode(e.comment||this.comment||``));for(var d in this.files)if(this.files.hasOwnProperty(d)){var m=this.files[d],h=m.options.compression||e.compression.toUpperCase(),g=c[h];if(!g)throw Error(h+` is not a valid compression method !`);var _=m.options.compressionOptions||e.compressionOptions||{},b=E.call(this,m,g,_),x=k.call(this,d,m,b,n,e.platform);n+=x.fileRecord.length+b.compressedSize,i+=x.dirRecord.length,t.push(x)}var S=``;S=a.CENTRAL_DIRECTORY_END+`\0\0\0\0`+v(t.length,2)+v(t.length,2)+v(i,4)+v(n,4)+v(u.length,2)+u;var C=e.type.toLowerCase();for(o=C===`uint8array`||C===`arraybuffer`||C===`blob`||C===`nodebuffer`?new p(n+i+S.length):new f(n+i+S.length),l=0;l<t.length;l++)o.append(t[l].fileRecord),o.append(t[l].compressedObject.compressedContent);for(l=0;l<t.length;l++)o.append(t[l].dirRecord);o.append(S);var w=o.finalize();switch(e.type.toLowerCase()){case`uint8array`:case`arraybuffer`:case`nodebuffer`:return r.transformTo(e.type.toLowerCase(),w);case`blob`:return r.arrayBuffer2Blob(r.transformTo(`arraybuffer`,w),e.mimeType);case`base64`:return e.base64?s.encode(w):w;default:return w}},crc32:function(e,t){return i(e,t)},utf8encode:function(e){return r.transformTo(`string`,d.utf8encode(e))},utf8decode:function(e){return d.utf8decode(e)}};t.exports=A})),Ft=s(((e,t)=>{var n=Et();function r(e){this.data=null,this.length=0,this.index=0}r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0)throw Error(`End of data reached (data length = `+this.length+`, asked index = `+e+`). Corrupted zip ?`)},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t=0,n;for(this.checkOffset(e),n=this.index+e-1;n>=this.index;n--)t=(t<<8)+this.byteAt(n);return this.index+=e,t},readString:function(e){return n.transformTo(`string`,this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(e&31)<<1)}},t.exports=r})),It=s(((e,t)=>{var n=Ft(),r=Et();function i(e,t){this.data=e,t||(this.data=r.string2binary(this.data)),this.length=this.data.length,this.index=0}i.prototype=new n,i.prototype.byteAt=function(e){return this.data.charCodeAt(e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=i})),Lt=s(((e,t)=>{var n=Ft();function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}r.prototype=new n,r.prototype.byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===n&&this.data[a+2]===r&&this.data[a+3]===i)return a;return-1},r.prototype.readData=function(e){if(this.checkOffset(e),e===0)return new Uint8Array;var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r})),Rt=s(((e,t)=>{var n=Lt();function r(e){this.data=e,this.length=this.data.length,this.index=0}r.prototype=new n,r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r})),zt=s(((e,t)=>{var n=It(),r=Et(),i=At(),a=Pt(),o=0,s=3;function c(e,t){this.options=e,this.loadOptions=t}c.prototype={isEncrypted:function(){return(this.bitFlag&1)==1},useUTF8:function(){return(this.bitFlag&2048)==2048},prepareCompressedContent:function(e,t,n){return function(){var r=e.index;e.setIndex(t);var i=e.readData(n);return e.setIndex(r),i}},prepareContent:function(e,t,n,i,a){return function(){var e=r.transformTo(i.uncompressInputType,this.getCompressedContent()),t=i.uncompress(e);if(t.length!==a)throw Error(`Bug : uncompressed data size mismatch`);return t}},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(n),this.compressedSize==-1||this.uncompressedSize==-1)throw Error(`Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)`);if(t=r.findCompression(this.compressionMethod),t===null)throw Error(`Corrupted zip : compression `+r.pretty(this.compressionMethod)+` unknown (inner file : `+this.fileName+`)`);if(this.decompressed=new i,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=r.transformTo(`string`,this.decompressed.getContent()),a.crc32(this.decompressed)!==this.crc32))throw Error(`Corrupted zip : CRC32 mismatch`)},readCentralPart:function(e){if(this.versionMadeBy=e.readInt(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw Error(`Encrypted zip are not supported`);this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),e===o&&(this.dosPermissions=this.externalFileAttributes&63),e===s&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileName.slice(-1)===`/`&&(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=new n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t=e.index,n,r,i;for(this.extraFields=this.extraFields||{};e.index<t+this.extraFieldsLength;)n=e.readInt(2),r=e.readInt(2),i=e.readString(r),this.extraFields[n]={id:n,length:r,value:i}},handleUTF8:function(){if(this.useUTF8())this.fileName=a.utf8decode(this.fileName),this.fileComment=a.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();e!==null&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();t!==null&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new n(e.value);return t.readInt(1)!==1||a.crc32(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new n(e.value);return t.readInt(1)!==1||a.crc32(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readString(e.length-5))}return null}},t.exports=c})),Bt=s(((e,t)=>{var n=It(),r=Rt(),i=Lt(),a=Et(),o=Ot(),s=zt(),c=ot(),l=Pt();function u(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}u.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw Error(`Corrupted zip or bug : unexpected signature (`+a.pretty(t)+`, expected `+a.pretty(e)+`)`)},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=l.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e=this.zip64EndOfCentralSize-44,t=0,n,r,i;t<e;)n=this.reader.readInt(2),r=this.reader.readInt(4),i=this.reader.readString(r),this.zip64ExtensibleData[n]={id:n,length:r,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw Error(`Multi-volumes zip are not supported`)},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===o.CENTRAL_FILE_HEADER;)e=new s({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(e===-1){var t=!0;try{this.reader.setIndex(0),this.checkSignature(o.LOCAL_FILE_HEADER),t=!1}catch{}throw t?Error(`Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html`):Error(`Corrupted zip : can't find end of central directory`)}if(this.reader.setIndex(e),this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),e===-1)throw Error(`Corrupted zip : can't find the ZIP64 end of central directory locator`);this.reader.setIndex(e),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=a.getTypeOf(e);t===`string`&&!c.uint8array?this.reader=new n(e,this.loadOptions.optimizedBinaryString):t===`nodebuffer`?this.reader=new r(e):this.reader=new i(a.transformTo(`uint8array`,e))},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=u})),Vt=s(((e,t)=>{var n=at(),r=Bt();t.exports=function(e,t){var i,a,o,s;for(t||={},t.base64&&(e=n.decode(e)),a=new r(e,t),i=a.files,o=0;o<i.length;o++)s=i[o],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders});return a.zipComment.length&&(this.comment=a.zipComment),this}})),Ht=s((e=>{var t=Et();e.string2binary=function(e){return t.string2binary(e)},e.string2Uint8Array=function(e){return t.transformTo(`uint8array`,e)},e.uint8Array2String=function(e){return t.transformTo(`string`,e)},e.string2Blob=function(e){var n=t.transformTo(`arraybuffer`,e);return t.arrayBuffer2Blob(n)},e.arrayBuffer2Blob=function(e){return t.arrayBuffer2Blob(e)},e.transformTo=function(e,n){return t.transformTo(e,n)},e.getTypeOf=function(e){return t.getTypeOf(e)},e.checkSupport=function(e){return t.checkSupport(e)},e.MAX_VALUE_16BITS=t.MAX_VALUE_16BITS,e.MAX_VALUE_32BITS=t.MAX_VALUE_32BITS,e.pretty=function(e){return t.pretty(e)},e.findCompression=function(e){return t.findCompression(e)},e.isRegExp=function(e){return t.isRegExp(e)}})),Ut=s(((e,t)=>{var n=at();function r(e,t){if(!(this instanceof r))return new r(e,t);this.files={},this.comment=null,this.root=``,e&&this.load(e,t),this.clone=function(){var e=new r;for(var t in this)typeof this[t]!=`function`&&(e[t]=this[t]);return e}}r.prototype=Pt(),r.prototype.load=Vt(),r.support=ot(),r.defaults=kt(),r.utils=Ht(),r.base64={encode:function(e){return n.encode(e)},decode:function(e){return n.decode(e)}},r.compressions=wt(),t.exports=r})),Wt=s(((e,t)=>{var n=rt(),r=it(),i=Ze(),a=Ut();t.exports=function(e,t){var o=new a,s=o.folder(t&&t.folder?t.folder:`layers`);[r.point(e),r.line(e),r.polygon(e)].forEach(function(e){e.geometries.length&&e.geometries[0].length&&n(e.properties,e.type,e.geometries,function(n,r){var a=t&&t.types[e.type.toLowerCase()]?t.types[e.type.toLowerCase()]:e.type;s.file(a+`.shp`,r.shp.buffer,{binary:!0}),s.file(a+`.shx`,r.shx.buffer,{binary:!0}),s.file(a+`.dbf`,r.dbf.buffer,{binary:!0}),s.file(a+`.prj`,i)})});var c={compression:`STORE`};return process.browser||(c.type=`nodebuffer`),o.generate(c)}})),Gt=s(((e,t)=>{var n=Wt();t.exports=function(e,t){var r=n(e,t);location.href=`data:application/zip;base64,`+r}})),Kt=u(s(((e,t)=>{t.exports.download=Gt(),t.exports.write=rt(),t.exports.zip=Wt()}))(),1);function qt(e,t=`export`){let n={folder:t,outputType:`blob`,compression:`DEFLATE`};Kt.default.download(e,n)}var Jt=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default={verbose:!1}})),Yt=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=function(e){var t,n={};return e.forEach(function(e){var r=e[0],i=e[1];switch(i){case`$MEASUREMENT`:t=`measurement`;break;case`$INSUNITS`:t=`insUnits`;break;case`$EXTMIN`:n.extMin={},t=`extMin`;break;case`$EXTMAX`:n.extMax={},t=`extMax`;break;case`$DIMASZ`:n.dimArrowSize={},t=`dimArrowSize`;break;default:switch(t){case`extMin`:case`extMax`:switch(r){case 10:n[t].x=i;break;case 20:n[t].y=i;break;case 30:n[t].z=i,t=void 0;break}break;case`measurement`:case`insUnits`:switch(r){case 70:n[t]=i,t=void 0;break}break;case`dimArrowSize`:switch(r){case 40:n[t]=i,t=void 0;break}break}}}),n}})),Xt=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(Jt());function n(e){return e&&e.__esModule?e:{default:e}}function r(){t.default.verbose&&console.info.apply(void 0,arguments)}function i(){t.default.verbose&&console.warn.apply(void 0,arguments)}function a(){console.error.apply(void 0,arguments)}e.default={info:r,warn:i,error:a}})),Zt=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(Xt());function n(e){return e&&e.__esModule?e:{default:e}}var r=function(e){var t=null,n=null;return e.reduce(function(e,r){var i=r[0],a=r[1];switch(i){case 2:e.name=a;break;case 3:e.description=a;break;case 70:e.flag=a;break;case 72:e.alignment=a;break;case 73:e.elementCount=parseInt(a);break;case 40:e.patternLength=a;break;case 49:t=Object.create({scales:[],offset:[]}),t.length=a,e.pattern.push(t);break;case 74:t.shape=a;break;case 75:t.shapeNumber=a;break;case 340:t.styleHandle=a;break;case 46:t.scales.push(a);break;case 50:t.rotation=a;break;case 44:n=Object.create({x:a,y:0}),t.offset.push(n);break;case 45:n.y=a;break;case 9:t.text=a;break;default:}return e},{type:`LTYPE`,pattern:[]})},i=function(e){return e.reduce(function(e,t){var n=t[0],r=t[1];switch(n){case 2:e.name=r;break;case 6:e.lineTypeName=r;break;case 62:e.colorNumber=r;break;case 70:e.flags=r;break;case 290:e.plot=parseInt(r)!==0;break;case 370:e.lineWeightEnum=r;break;default:}return e},{type:`LAYER`})},a=function(e){return e.reduce(function(e,t){var n=t[0],r=t[1];switch(n){case 2:e.name=r;break;case 6:e.lineTypeName=r;break;case 40:e.fixedTextHeight=r;break;case 41:e.widthFactor=r;break;case 50:e.obliqueAngle=r;break;case 71:e.flags=r;break;case 42:e.lastHeightUsed=r;break;case 3:e.primaryFontFileName=r;break;case 4:e.bigFontFileName=r;break;default:}return e},{type:`STYLE`})},o=function(e){return e.reduce(function(e,t){var n=t[0],r=t[1];switch(n){case 2:e.name=r;break;case 5:e.handle=r;break;case 70:e.flags=r;break;case 10:e.lowerLeft.x=parseFloat(r);break;case 20:e.lowerLeft.y=parseFloat(r);break;case 11:e.upperRight.x=parseFloat(r);break;case 21:e.upperRight.y=parseFloat(r);break;case 12:e.center.x=parseFloat(r);break;case 22:e.center.y=parseFloat(r);break;case 14:e.snapSpacing.x=parseFloat(r);break;case 24:e.snapSpacing.y=parseFloat(r);break;case 15:e.gridSpacing.x=parseFloat(r);break;case 25:e.gridSpacing.y=parseFloat(r);break;case 16:e.direction.x=parseFloat(r);break;case 26:e.direction.y=parseFloat(r);break;case 36:e.direction.z=parseFloat(r);break;case 17:e.target.x=parseFloat(r);break;case 27:e.target.y=parseFloat(r);break;case 37:e.target.z=parseFloat(r);break;case 45:e.height=parseFloat(r);break;case 50:e.snapAngle=parseFloat(r);break;case 51:e.angle=parseFloat(r);break;case 110:e.x=parseFloat(r);break;case 120:e.y=parseFloat(r);break;case 130:e.z=parseFloat(r);break;case 111:e.xAxisX=parseFloat(r);break;case 121:e.xAxisY=parseFloat(r);break;case 131:e.xAxisZ=parseFloat(r);break;case 112:e.xAxisX=parseFloat(r);break;case 122:e.xAxisY=parseFloat(r);break;case 132:e.xAxisZ=parseFloat(r);break;case 146:e.elevation=parseFloat(r);break;default:}return e},{type:`VPORT`,center:{},lowerLeft:{},upperRight:{},snap:{},snapSpacing:{},gridSpacing:{},direction:{},target:{}})},s=function(e,n,r){var i=[],a;return e.forEach(function(e){var t=e[0],r=e[1];(t===0||t===2)&&r===n?(a=[],i.push(a)):a.push(e)}),i.reduce(function(e,n){var i=r(n);return i.name?e[i.name]=i:t.default.warn(`table row without name:`,i),e},{})};e.default=function(e){var t=[],n;e.forEach(function(e){var r=e[1];r===`TABLE`?(n=[],t.push(n)):r===`ENDTAB`?t.push(n):n.push(e)});var c=[],l=[],u=[],d=[];return t.forEach(function(e){e[0][1]===`STYLE`?c=e:e[0][1]===`LTYPE`?d=e:e[0][1]===`LAYER`?l=e:e[0][1]===`VPORT`&&(u=e)}),{layers:s(l,`LAYER`,i),styles:s(c,`STYLE`,a),vports:s(u,`VPORT`,o),ltypes:s(d,`LTYPE`,r)}}})),Qt=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=function(e,t){switch(e){case 5:return{handle:t};case 6:return{lineTypeName:t};case 8:return{layer:t};case 48:return{lineTypeScale:t};case 60:return{visible:t===0};case 62:return{colorNumber:t};case 67:return t===0?{}:{paperSpace:t};case 68:return{viewportOn:t};case 69:return{viewport:t};case 210:return{extrusionX:t};case 220:return{extrusionY:t};case 230:return{extrusionZ:t};case 410:return{layout:t};default:return{}}}})),$t=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`POINT`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 10:e.x=i;break;case 20:e.y=i;break;case 30:e.z=i;break;case 39:e.thickness=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r})}}})),en=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`LINE`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 10:e.start.x=i;break;case 20:e.start.y=i;break;case 30:e.start.z=i;break;case 39:e.thickness=i;break;case 11:e.end.x=i;break;case 21:e.end.y=i;break;case 31:e.end.z=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r,start:{},end:{}})}}})),tn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`LWPOLYLINE`;e.default={TYPE:r,process:e.process=function(e){var n;return e.reduce(function(e,r){var i=r[0],a=r[1];switch(i){case 70:e.closed=(a&1)==1;break;case 10:n={x:a,y:0},e.vertices.push(n);break;case 20:n.y=a;break;case 39:e.thickness=a;break;case 42:n.bulge=a;break;default:Object.assign(e,(0,t.default)(i,a));break}return e},{type:r,vertices:[]})}}})),nn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`POLYLINE`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 70:e.closed=(i&1)==1,e.polygonMesh=(i&16)==16,e.polyfaceMesh=(i&64)==64;break;case 39:e.thickness=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r,vertices:[]})}}})),rn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=e.TYPE=`VERTEX`,n=function(e){e.faces=e.faces||[],`x`in e&&!e.x&&delete e.x,`y`in e&&!e.y&&delete e.y,`z`in e&&!e.z&&delete e.z};e.default={TYPE:t,process:e.process=function(e){return e.reduce(function(e,t){var r=t[0],i=t[1];switch(r){case 10:e.x=i;break;case 20:e.y=i;break;case 30:e.z=i;break;case 42:e.bulge=i;break;case 71:n(e),e.faces[0]=i;break;case 72:n(e),e.faces[1]=i;break;case 73:n(e),e.faces[2]=i;break;case 74:n(e),e.faces[3]=i;break;default:break}return e},{})}}})),an=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`CIRCLE`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 10:e.x=i;break;case 20:e.y=i;break;case 30:e.z=i;break;case 40:e.r=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r})}}})),on=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`ARC`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 10:e.x=i;break;case 20:e.y=i;break;case 30:e.z=i;break;case 39:e.thickness=i;break;case 40:e.r=i;break;case 50:e.startAngle=i/180*Math.PI;break;case 51:e.endAngle=i/180*Math.PI;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r})}}})),sn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`ELLIPSE`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 10:e.x=i;break;case 11:e.majorX=i;break;case 20:e.y=i;break;case 21:e.majorY=i;break;case 30:e.z=i;break;case 31:e.majorZ=i;break;case 40:e.axisRatio=i;break;case 41:e.startAngle=i;break;case 42:e.endAngle=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r})}}})),cn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`SPLINE`;e.default={TYPE:r,process:e.process=function(e){var n;return e.reduce(function(e,r){var i=r[0],a=r[1];switch(i){case 10:n={x:a,y:0},e.controlPoints.push(n);break;case 20:n.y=a;break;case 30:n.z=a;break;case 40:e.knots.push(a);break;case 41:e.weights||=[],e.weights.push(a);break;case 42:e.knotTolerance=a;break;case 43:e.controlPointTolerance=a;break;case 44:e.fitTolerance=a;break;case 70:e.flag=a,e.closed=(a&1)==1;break;case 71:e.degree=a;break;case 72:e.numberOfKnots=a;break;case 73:e.numberOfControlPoints=a;break;case 74:e.numberOfFitPoints=a;break;default:Object.assign(e,(0,t.default)(i,a));break}return e},{type:r,controlPoints:[],knots:[]})}}})),ln=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`SOLID`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 10:e.corners[0].x=i;break;case 20:e.corners[0].y=i;break;case 30:e.corners[0].z=i;break;case 11:e.corners[1].x=i;break;case 21:e.corners[1].y=i;break;case 31:e.corners[1].z=i;break;case 12:e.corners[2].x=i;break;case 22:e.corners[2].y=i;break;case 32:e.corners[2].z=i;break;case 13:e.corners[3].x=i;break;case 23:e.corners[3].y=i;break;case 33:e.corners[3].z=i;break;case 39:e.thickness=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r,corners:[{},{},{},{}]})}}})),un=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`HATCH`,i=`IDLE`,a={},o=0,s=!1,c=null,l={references:[],entities:[]},u=null;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],p=n[1];switch(r){case 100:i=`IDLE`;break;case 2:e.patternName=p;break;case 10:i===`IDLE`?e.elevation.x=parseFloat(p):i===`POLYLINE`?(u={x:parseFloat(p),y:0,bulge:0},l.entities[0].points.push(u)):i===`SEED`?(c||(c={x:0,y:0},e.seeds.seeds.push(c)),c.x=parseFloat(p)):f(r,o,parseFloat(p));break;case 20:i===`IDLE`?e.elevation.y=parseFloat(p):i===`POLYLINE`?u.y=parseFloat(p):i===`SEED`?(c.y=parseFloat(p),c=null):f(r,o,parseFloat(p));break;case 30:e.elevation.z=parseFloat(p);break;case 63:e.fillColor=p;break;case 70:e.fillType=parseFloat(p)===1?`SOLID`:`PATTERN`;break;case 210:e.extrusionDir.x=parseFloat(p);break;case 220:e.extrusionDir.y=parseFloat(p);break;case 230:e.extrusionDir.z=parseFloat(p);break;case 91:e.boundary.count=parseFloat(p);break;case 92:l={references:[],entities:[]},e.boundary.loops.push(l),l.type=parseFloat(p),s=(l.type&2)==2,s&&(l.entities.push({type:`POLYLINE`,points:[]}),i=`POLYLINE`);break;case 93:i===`IDLE`&&(i=`ENT`),l.count=parseFloat(p);break;case 11:case 21:case 40:case 50:case 51:case 74:case 94:case 95:case 96:o===4&&(i=`SPLINE`),f(r,o,parseFloat(p));break;case 42:s?u.bulge=parseFloat(p):f(r,o,parseFloat(p));break;case 72:o=parseFloat(p),l[s?`hasBulge`:`edgeType`]=o,s||(a=d(o),l.entities.push(a));break;case 73:i===`IDLE`||s?l.entities[0].closed=p:f(r,o,parseFloat(p));break;case 75:i=`IDLE`,e.style=parseFloat(p);break;case 76:e.hatchType=parseFloat(p);break;case 97:i=`IDLE`,s=!1,l.sourceObjects=parseFloat(p);break;case 98:i=`SEED`,e.seeds.count=parseFloat(p);break;case 52:e.shadowPatternAngle=parseFloat(p);break;case 41:e.spacing=parseFloat(p);break;case 77:e.double=parseFloat(p)===1;break;case 78:e.pattern.lineCount=parseFloat(p);break;case 53:e.pattern.angle=parseFloat(p);break;case 43:e.pattern.x=parseFloat(p);break;case 44:e.pattern.y=parseFloat(p);break;case 45:e.pattern.offsetX=parseFloat(p);break;case 46:e.pattern.offsetY=parseFloat(p);break;case 79:e.pattern.dashCount=parseFloat(p);break;case 49:e.pattern.length.push(p);break;case 330:l.references.push(p);break;case 450:e.solidOrGradient=parseFloat(p)===0?`SOLID`:`GRADIENT`;break;case 453:e.color.count=parseFloat(p);break;case 460:e.color.rotation=p;break;case 461:e.color.gradient=p;break;case 462:e.color.tint=p;break;default:Object.assign(e,(0,t.default)(r,p));break}return e},{type:r,elevation:{},extrusionDir:{x:0,y:0,z:1},pattern:{length:[]},boundary:{loops:[]},seeds:{count:0,seeds:[]},color:{}})}};function d(e){if(s)return{};switch(e){case 1:return{type:`LINE`,start:{x:0,y:0},end:{x:0,y:0}};case 2:return{type:`ARC`,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0,counterClockWise:!1};case 3:return{type:`ELLIPSE`,center:{x:0,y:0},startAngle:0,endAngle:0,counterClockWise:!1,major:{x:0,y:0},minor:0};case 4:return{type:`SPLINE`,degree:0,rational:0,periodic:0,knots:{count:0,knots:[]},controlPoints:{count:0,points:[]},weights:1}}return{}}function f(e,t,n){switch(e){case 10:switch(t){case 1:a.start.x=n;break;case 2:a.center.x=n;break;case 3:a.center.x=n;break;case 4:a.controlPoints.points.push({x:n,y:0});break}break;case 20:switch(t){case 1:a.start.y=n;break;case 2:a.center.y=n;break;case 3:a.center.y=n;break;case 4:a.controlPoints.points[a.controlPoints.points.length-1].y=n;break}break;case 11:switch(t){case 1:a.end.x=n;break;case 3:a.major.x=n;break}break;case 21:switch(t){case 1:a.end.y=n;break;case 3:a.major.y=n;break}break;case 40:switch(t){case 2:a.radius=n;break;case 3:a.minor=n;break;case 4:a.knots.knots.push(n);break}break;case 42:switch(t){case 4:a.weights=n;break}break;case 50:switch(t){case 2:a.startAngle=n;break;case 3:a.startAngle=n;break}break;case 51:switch(t){case 2:a.endAngle=n;break;case 3:a.endAngle=n;break}break;case 73:switch(t){case 2:a.counterClockWise=parseFloat(n)===1;break;case 3:a.counterClockWise=parseFloat(n)===1;break;case 4:a.rational=n;break}break;case 74:switch(t){case 4:a.periodic=n;break}break;case 94:switch(t){case 4:a.degree=n;break}break;case 95:switch(t){case 4:a.knots.count=n;break}break;case 96:switch(t){case 4:a.controlPoints.count=n;break}break}}})),dn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.assign=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`MTEXT`,i={10:`x`,20:`y`,30:`z`,40:`nominalTextHeight`,41:`refRectangleWidth`,71:`attachmentPoint`,72:`drawingDirection`,7:`styleName`,11:`xAxisX`,21:`xAxisY`,31:`xAxisZ`,42:`horizontalWidth`,43:`verticalHeight`,73:`lineSpacingStyle`,44:`lineSpacingFactor`,90:`backgroundFill`,420:`bgColorRGB0`,421:`bgColorRGB1`,422:`bgColorRGB2`,423:`bgColorRGB3`,424:`bgColorRGB4`,425:`bgColorRGB5`,426:`bgColorRGB6`,427:`bgColorRGB7`,428:`bgColorRGB8`,429:`bgColorRGB9`,430:`bgColorName0`,431:`bgColorName1`,432:`bgColorName2`,433:`bgColorName3`,434:`bgColorName4`,435:`bgColorName5`,436:`bgColorName6`,437:`bgColorName7`,438:`bgColorName8`,439:`bgColorName9`,45:`fillBoxStyle`,63:`bgFillColor`,441:`bgFillTransparency`,75:`columnType`,76:`columnCount`,78:`columnFlowReversed`,79:`columnAutoheight`,48:`columnWidth`,49:`columnGutter`,50:`columnHeights`},a=e.process=function(e){return e.reduce(function(e,t){var n=t[0],r=t[1];return o(e,n,r),e},{type:r,string:``})},o=e.assign=function(e,n,r){return i[n]===void 0?n===1||n===3?e.string+=r:n===50?(e.xAxisX=Math.cos(r),e.xAxisY=Math.sin(r)):Object.assign(e,(0,t.default)(n,r)):e[i[n]]=r,e};e.default={TYPE:r,process:a,assign:o}})),fn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.assign=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`TEXT`,i={1:`string`,10:`x`,20:`y`,30:`z`,11:`x2`,21:`y2`,31:`z2`,39:`thickness`,40:`textHeight`,41:`relScaleX`,50:`rotation`,51:`obliqueAngle`,7:`styleName`,71:`mirror`,72:`hAlign`,73:`vAlign`},a=e.process=function(e){return e.reduce(function(e,t){var n=t[0],r=t[1];return o(e,n,r),e},{type:r,string:``})},o=e.assign=function(e,n,r){i[n]===void 0?Object.assign(e,(0,t.default)(n,r)):e[i[n]]=r};e.default={TYPE:r,process:a,assign:o}})),pn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.assign=e.TYPE=void 0;var t=i(Qt()),n=dn(),r=fn();function i(e){return e&&e.__esModule?e:{default:e}}var a=e.TYPE=`ATTDEF`,o=e.process=function(e){return e.reduce(function(e,t){var n=t[0],r=t[1];return s(e,n,r),e},{type:a,subclassMarker:`AcDbText`,thickness:0,scaleX:1,mtext:{},text:{}})},s=e.assign=function(e,i,a){switch(i){case 100:e.subclassMarker=a;break;case 1:switch(e.subclassMarker){case`AcDbText`:(0,r.assign)(e.text,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 2:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:e.tag=a;break;case`AcDbXrecord`:e.attdefFlag=a;break}break;case 3:switch(e.subclassMarker){case`AcDbAttributeDefinition`:e.prompt=a;break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 7:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:(0,r.assign)(e.text,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 10:switch(e.subclassMarker){case`AcDbText`:(0,r.assign)(e.text,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break;case`AcDbXrecord`:e.x=a;break}break;case 20:switch(e.subclassMarker){case`AcDbText`:(0,r.assign)(e.text,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break;case`AcDbXrecord`:e.y=a;break}break;case 30:switch(e.subclassMarker){case`AcDbText`:(0,r.assign)(e.text,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break;case`AcDbXrecord`:e.z=a;break}break;case 11:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:e.x2=a;break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 21:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:e.y2=a;break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 31:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:e.z2=a;break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 39:(0,r.assign)(e.text,i,a);break;case 40:switch(e.subclassMarker){case`AcDbText`:(0,r.assign)(e.text,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break;case`AcDbXrecord`:e.annotationScale=a;break}break;case 41:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:(0,r.assign)(e.text,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 42:case 43:case 44:case 45:(0,n.assign)(e.mtext,i,a);break;case 46:e.mtext.annotationHeight=a;break;case 48:case 49:(0,n.assign)(e.mtext,i,a);break;case 50:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:(0,r.assign)(e.text,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 51:(0,r.assign)(e.text,i,a);break;case 63:(0,n.assign)(e.mtext,i,a);break;case 70:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:e.attributeFlags=a;break;case`AcDbXrecord`:e.mTextFlag===void 0?e.mTextFlag=a:e.isReallyLocked===void 0?e.isReallyLocked=a:e.secondaryAttdefCount=a;break}break;case 71:case 72:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:(0,r.assign)(e.text,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 73:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:e.fieldLength=a;break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 74:(0,r.assign)(e.text,73,a);break;case 75:case 76:case 78:case 79:(0,n.assign)(e.mtext,i,a);break;case 90:(0,n.assign)(e.mtext,i,a);break;case 210:case 220:case 230:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:(0,r.assign)(e.mtext,i,a);break;case`AcDbMText`:(0,n.assign)(e.mtext,i,a);break}break;case 280:switch(e.subclassMarker){case`AcDbAttributeDefinition`:case`AcDbAttribute`:e.lock=a;break;case`AcDbXrecord`:e.clone=!0;break}break;case 340:e.attdefHandle=a;break;case 420:case 421:case 422:case 423:case 424:case 425:case 426:case 427:case 428:case 429:case 430:case 431:case 432:case 433:case 434:case 435:case 436:case 437:case 438:case 439:case 441:(0,n.assign)(e.mtext,i,a);break;default:Object.assign(e,(0,t.default)(i,a));break}};e.default={TYPE:a,process:o,assign:s}})),mn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=pn(),n=e.TYPE=`ATTRIB`;e.default={TYPE:n,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];return(0,t.assign)(e,r,i),e},{type:n,subclassMarker:`AcDbText`,thickness:0,scaleX:1,mtext:{},text:{}})}}})),hn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`INSERT`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 2:e.block=i;break;case 10:e.x=i;break;case 20:e.y=i;break;case 30:e.z=i;break;case 41:e.scaleX=i;break;case 42:e.scaleY=i;break;case 43:e.scaleZ=i;break;case 44:e.columnSpacing=i;break;case 45:e.rowSpacing=i;break;case 50:e.rotation=i;break;case 70:e.columnCount=i;break;case 71:e.rowCount=i;break;case 210:e.extrusionX=i;break;case 220:e.extrusionY=i;break;case 230:e.extrusionZ=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r})}}})),gn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`3DFACE`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 10:e.vertices[0].x=i;break;case 20:e.vertices[0].y=i;break;case 30:e.vertices[0].z=i;break;case 11:e.vertices[1].x=i;break;case 21:e.vertices[1].y=i;break;case 31:e.vertices[1].z=i;break;case 12:e.vertices[2].x=i;break;case 22:e.vertices[2].y=i;break;case 32:e.vertices[2].z=i;break;case 13:e.vertices[3].x=i;break;case 23:e.vertices[3].y=i;break;case 33:e.vertices[3].z=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r,vertices:[{},{},{},{}]})}}})),_n=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`DIMENSION`,i=e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 2:e.block=i;break;case 10:e.start.x=i;break;case 20:e.start.y=i;break;case 30:e.start.z=i;break;case 11:e.textMidpoint.x=i;break;case 21:e.textMidpoint.y=i;break;case 31:e.textMidpoint.z=i;break;case 13:e.measureStart.x=i;break;case 23:e.measureStart.y=i;break;case 33:e.measureStart.z=i;break;case 14:e.measureEnd.x=i;break;case 24:e.measureEnd.y=i;break;case 34:e.measureEnd.z=i;break;case 50:e.rotation=i;break;case 51:e.horizonRotation=i;break;case 52:e.extensionRotation=i;break;case 53:e.textRotation=i;break;case 70:var o=a(i);o.ordinateType&&(e.ordinateType=!0),o.uniqueBlockReference&&(e.uniqueBlockReference=!0),o.userDefinedLocation&&(e.userDefinedLocation=!0),e.dimensionType=o.dimensionType;break;case 71:e.attachementPoint=i;break;case 210:e.extrudeDirection=e.extrudeDirection||{},e.extrudeDirection.x=i;break;case 220:e.extrudeDirection=e.extrudeDirection||{},e.extrudeDirection.y=i;break;case 230:e.extrudeDirection=e.extrudeDirection||{},e.extrudeDirection.z=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r,start:{x:0,y:0,z:0},measureStart:{x:0,y:0,z:0},measureEnd:{x:0,y:0,z:0},textMidpoint:{x:0,y:0,z:0},attachementPoint:1,dimensionType:0})};function a(e){var t=!1,n=!1,r=!1;if(e>6){var i=e-32,a=e-64,o=e-32-64,s=e-32-128,c=e-32-64-128;i>=0&&i<=6?(t=!0,e=i):a>=0&&a<=6?(n=!0,e=a):o>=0&&o<=6?(t=!0,n=!0,e=o):s>=0&&s<=6?(t=!0,r=!0,e=s):c>=0&&c<=6&&(t=!0,n=!0,r=!0,e=c)}return{dimensionType:e,uniqueBlockReference:t,ordinateType:n,userDefinedLocation:r}}e.default={TYPE:r,process:i}})),vn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`VIEWPORT`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 1:e.layout=parseFloat(i);break;case 10:e.center.x=parseFloat(i);break;case 20:e.center.y=parseFloat(i);break;case 30:e.center.z=parseFloat(i);break;case 12:e.centerDCS.x=parseFloat(i);break;case 22:e.centerDCS.y=parseFloat(i);break;case 13:e.snap.x=parseFloat(i);break;case 23:e.snap.y=parseFloat(i);break;case 14:e.snapSpacing.x=parseFloat(i);break;case 24:e.snapSpacing.y=parseFloat(i);break;case 15:e.gridSpacing.x=parseFloat(i);break;case 25:e.gridSpacing.y=parseFloat(i);break;case 16:e.direction.x=parseFloat(i);break;case 26:e.direction.y=parseFloat(i);break;case 36:e.direction.z=parseFloat(i);break;case 17:e.target.x=parseFloat(i);break;case 27:e.target.y=parseFloat(i);break;case 37:e.target.z=parseFloat(i);break;case 40:e.width=parseFloat(i);break;case 41:e.height=parseFloat(i);break;case 50:e.snapAngle=parseFloat(i);break;case 51:e.angle=parseFloat(i);break;case 68:e.status=i;break;case 69:e.id=i;break;case 90:e.flags=i;break;case 110:e.x=parseFloat(i);break;case 120:e.y=parseFloat(i);break;case 130:e.z=parseFloat(i);break;case 111:e.xAxisX=parseFloat(i);break;case 121:e.xAxisY=parseFloat(i);break;case 131:e.xAxisZ=parseFloat(i);break;case 112:e.xAxisX=parseFloat(i);break;case 122:e.xAxisY=parseFloat(i);break;case 132:e.xAxisZ=parseFloat(i);break;case 146:e.elevation=parseFloat(i);break;case 281:e.render=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r,center:{},centerDCS:{},snap:{},snapSpacing:{},gridSpacing:{},direction:{},target:{}})}}})),yn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.process=e.default=e.TYPE=void 0;var t=n(Qt());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.TYPE=`OLE2FRAME`;e.default={TYPE:r,process:e.process=function(e){return e.reduce(function(e,n){var r=n[0],i=n[1];switch(r){case 70:e.version=i;break;case 3:e.name=i;break;case 10:e.upperLeftX=i;break;case 20:e.upperLeftY=i;break;case 30:e.upperLeftZ=i;break;case 11:e.lowerRightX=i;break;case 21:e.lowerRightY=i;break;case 31:e.lowerRightZ=i;break;case 71:e.objectType=i;break;case 72:e.tile=i;break;case 90:e.length=i;break;case 310:e.data+=i;break;default:Object.assign(e,(0,t.default)(r,i));break}return e},{type:r,data:``})}}})),bn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=S(Xt()),n=S($t()),r=S(en()),i=S(tn()),a=S(nn()),o=S(rn()),s=S(an()),c=S(on()),l=S(sn()),u=S(cn()),d=S(ln()),f=S(un()),p=S(dn()),m=S(pn()),h=S(mn()),g=S(hn()),_=S(gn()),v=S(_n()),y=S(fn()),b=S(vn()),x=S(yn());function S(e){return e&&e.__esModule?e:{default:e}}var C=[n.default,r.default,i.default,a.default,o.default,s.default,c.default,l.default,u.default,d.default,f.default,p.default,m.default,h.default,y.default,g.default,v.default,_.default,b.default,x.default].reduce(function(e,t){return e[t.TYPE]=t,e},{});e.default=function(e){var n=[],r=[],i;e.forEach(function(e){e[0]===0&&(i=[],r.push(i)),i.push(e)});var a;return r.forEach(function(e){var r=e[0][1],i=e.slice(1);if(C[r]!==void 0){var o=C[r].process(i);r===`POLYLINE`?(a=o,n.push(o)):r===`VERTEX`?a?a.vertices.push(o):t.default.error(`ignoring invalid VERTEX entity`):r===`SEQEND`?a=void 0:n.push(o)}else t.default.warn(`unsupported type in ENTITIES section:`,r)}),n}})),xn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(bn());function n(e){return e&&e.__esModule?e:{default:e}}e.default=function(e){var n,r=[],i,a=[];return e.forEach(function(e){var o=e[0],s=e[1];if(s===`BLOCK`)n=`block`,i={},a=[],r.push(i);else if(s===`ENDBLK`)n===`entities`?i.entities=(0,t.default)(a):i.entities=[],a=void 0,n=void 0;else if(n===`block`&&o!==0)switch(o){case 1:i.xref=s;break;case 2:i.name=s;break;case 10:i.x=s;break;case 20:i.y=s;break;case 30:i.z=s;break;case 67:s!==0&&(i.paperSpace=s);break;case 410:i.layout=s;break;default:break}else n===`block`&&o===0?(n=`entities`,a.push(e)):n===`entities`&&a.push(e)}),r}})),Sn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=function(e){var t,n={layouts:[]},r={};return e.forEach(function(e,i){var a=e[0],o=e[1];if(a===0&&(t=`IDLE`),o===`LAYOUT`&&(t=`layout`,r={},n.layouts.push(r)),t===`layout`&&a!==0)switch(a){case 100:o===`AcDbLayout`&&(t=`AcDbLayout`);break}if(t===`AcDbLayout`&&a!==0)switch(a){case 1:r.name=o;break;case 5:r.handle=o;break;case 10:r.minLimitX=parseFloat(o);break;case 20:r.minLimitY=parseFloat(o);break;case 11:r.maxLimitX=parseFloat(o);break;case 21:r.maxLimitY=parseFloat(o);break;case 12:r.x=parseFloat(o);break;case 22:r.y=parseFloat(o);break;case 32:r.z=parseFloat(o);break;case 14:r.minX=parseFloat(o);break;case 24:r.minY=parseFloat(o);break;case 34:r.minZ=parseFloat(o);break;case 15:r.maxX=parseFloat(o);break;case 25:r.maxY=parseFloat(o);break;case 35:r.maxZ=parseFloat(o);break;case 70:r.flag=o===1?`PSLTSCALE`:`LIMCHECK`;break;case 71:r.tabOrder=o;break;case 146:r.elevation=parseFloat(o);break;case 13:r.ucsX=parseFloat(o);break;case 23:r.ucsY=parseFloat(o);break;case 33:r.ucsZ=parseFloat(o);break;case 16:r.ucsXaxisX=parseFloat(o);break;case 26:r.ucsXaxisY=parseFloat(o);break;case 36:r.ucsXaxisZ=parseFloat(o);break;case 17:r.ucsYaxisX=parseFloat(o);break;case 27:r.ucsYaxisY=parseFloat(o);break;case 37:r.ucsYaxisZ=parseFloat(o);break;case 76:switch(o){case 0:r.ucsType=`NOT ORTHOGRAPHIC`;break;case 1:r.ucsType=`TOP`;break;case 2:r.ucsType=`BOTTOM`;break;case 3:r.ucsType=`FRONT`;break;case 4:r.ucsType=`BACK`;break;case 5:r.ucsType=`LEFT`;break;case 6:r.ucsType=`RIGHT`;break}break;case 330:r.tableRecord=o;break;case 331:r.lastActiveViewport=o;break;case 333:r.shadePlot=o;break}}),n}})),Cn=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=s(Yt()),n=s(Zt()),r=s(xn()),i=s(bn()),a=s(Sn()),o=s(Xt());function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var n=typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&typeof e.length==`number`){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||n.return==null||n.return()}finally{if(s)throw a}}}}function l(e,t){if(e){if(typeof e==`string`)return u(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var d=function(e,t){return e>=10&&e<60||e>=210&&e<240?parseFloat(t,10):e>=60&&e<100?parseInt(t,10):t},f=function(e){var t=`type`,n,r=[],i=c(e),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;t===`type`?(n=parseInt(o,10),t=`value`):(r.push([n,d(n,o)]),t=`type`)}}catch(e){i.e(e)}finally{i.f()}return r},p=function(e){var t;return e.reduce(function(e,n){return n[0]===0&&n[1]===`SECTION`?t=[]:n[0]===0&&n[1]===`ENDSEC`?(e.push(t),t=void 0):t!==void 0&&t.push(n),e},[])},m=function(e,s){var c=s[0][1],l=s.slice(1);switch(c){case`HEADER`:e.header=(0,t.default)(l);break;case`TABLES`:e.tables=(0,n.default)(l);break;case`BLOCKS`:e.blocks=(0,r.default)(l);break;case`ENTITIES`:e.entities=(0,i.default)(l);break;case`OBJECTS`:e.objects=(0,a.default)(l);break;default:o.default.warn(`Unsupported section: ${c}`)}return e};e.default=function(e){return p(f(e.split(/\r\n|\r|\n/g))).reduce(m,{header:{},blocks:[],entities:[],objects:{layouts:[]},tables:{layers:{},styles:{},ltypes:{}}})}})),wn=s(((e,t)=>{function n(){this.__data__=[],this.size=0}t.exports=n})),Tn=s(((e,t)=>{function n(e,t){return e===t||e!==e&&t!==t}t.exports=n})),En=s(((e,t)=>{var n=Tn();function r(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}t.exports=r})),Dn=s(((e,t)=>{var n=En(),r=Array.prototype.splice;function i(e){var t=this.__data__,i=n(t,e);return i<0?!1:(i==t.length-1?t.pop():r.call(t,i,1),--this.size,!0)}t.exports=i})),On=s(((e,t)=>{var n=En();function r(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}t.exports=r})),kn=s(((e,t)=>{var n=En();function r(e){return n(this.__data__,e)>-1}t.exports=r})),An=s(((e,t)=>{var n=En();function r(e,t){var r=this.__data__,i=n(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this}t.exports=r})),jn=s(((e,t)=>{var n=wn(),r=Dn(),i=On(),a=kn(),o=An();function s(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=n,s.prototype.delete=r,s.prototype.get=i,s.prototype.has=a,s.prototype.set=o,t.exports=s})),Mn=s(((e,t)=>{var n=jn();function r(){this.__data__=new n,this.size=0}t.exports=r})),Nn=s(((e,t)=>{function n(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}t.exports=n})),Pn=s(((e,t)=>{function n(e){return this.__data__.get(e)}t.exports=n})),Fn=s(((e,t)=>{function n(e){return this.__data__.has(e)}t.exports=n})),In=s(((e,t)=>{t.exports=typeof global==`object`&&global&&global.Object===Object&&global})),Ln=s(((e,t)=>{var n=In(),r=typeof self==`object`&&self&&self.Object===Object&&self;t.exports=n||r||Function(`return this`)()})),Rn=s(((e,t)=>{t.exports=Ln().Symbol})),zn=s(((e,t)=>{var n=Rn(),r=Object.prototype,i=r.hasOwnProperty,a=r.toString,o=n?n.toStringTag:void 0;function s(e){var t=i.call(e,o),n=e[o];try{e[o]=void 0;var r=!0}catch{}var s=a.call(e);return r&&(t?e[o]=n:delete e[o]),s}t.exports=s})),Bn=s(((e,t)=>{var n=Object.prototype.toString;function r(e){return n.call(e)}t.exports=r})),Vn=s(((e,t)=>{var n=Rn(),r=zn(),i=Bn(),a=`[object Null]`,o=`[object Undefined]`,s=n?n.toStringTag:void 0;function c(e){return e==null?e===void 0?o:a:s&&s in Object(e)?r(e):i(e)}t.exports=c})),Hn=s(((e,t)=>{function n(e){var t=typeof e;return e!=null&&(t==`object`||t==`function`)}t.exports=n})),Un=s(((e,t)=>{var n=Vn(),r=Hn(),i=`[object AsyncFunction]`,a=`[object Function]`,o=`[object GeneratorFunction]`,s=`[object Proxy]`;function c(e){if(!r(e))return!1;var t=n(e);return t==a||t==o||t==i||t==s}t.exports=c})),Wn=s(((e,t)=>{t.exports=Ln()[`__core-js_shared__`]})),Gn=s(((e,t)=>{var n=Wn(),r=function(){var e=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||``);return e?`Symbol(src)_1.`+e:``}();function i(e){return!!r&&r in e}t.exports=i})),Kn=s(((e,t)=>{var n=Function.prototype.toString;function r(e){if(e!=null){try{return n.call(e)}catch{}try{return e+``}catch{}}return``}t.exports=r})),qn=s(((e,t)=>{var n=Un(),r=Gn(),i=Hn(),a=Kn(),o=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,d=l.hasOwnProperty,f=RegExp(`^`+u.call(d).replace(o,`\\$&`).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,`$1.*?`)+`$`);function p(e){return!i(e)||r(e)?!1:(n(e)?f:s).test(a(e))}t.exports=p})),Jn=s(((e,t)=>{function n(e,t){return e?.[t]}t.exports=n})),Yn=s(((e,t)=>{var n=qn(),r=Jn();function i(e,t){var i=r(e,t);return n(i)?i:void 0}t.exports=i})),Xn=s(((e,t)=>{t.exports=Yn()(Ln(),`Map`)})),Zn=s(((e,t)=>{t.exports=Yn()(Object,`create`)})),Qn=s(((e,t)=>{var n=Zn();function r(){this.__data__=n?n(null):{},this.size=0}t.exports=r})),$n=s(((e,t)=>{function n(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}t.exports=n})),er=s(((e,t)=>{var n=Zn(),r=`__lodash_hash_undefined__`,i=Object.prototype.hasOwnProperty;function a(e){var t=this.__data__;if(n){var a=t[e];return a===r?void 0:a}return i.call(t,e)?t[e]:void 0}t.exports=a})),tr=s(((e,t)=>{var n=Zn(),r=Object.prototype.hasOwnProperty;function i(e){var t=this.__data__;return n?t[e]!==void 0:r.call(t,e)}t.exports=i})),nr=s(((e,t)=>{var n=Zn(),r=`__lodash_hash_undefined__`;function i(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=n&&t===void 0?r:t,this}t.exports=i})),rr=s(((e,t)=>{var n=Qn(),r=$n(),i=er(),a=tr(),o=nr();function s(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=n,s.prototype.delete=r,s.prototype.get=i,s.prototype.has=a,s.prototype.set=o,t.exports=s})),ir=s(((e,t)=>{var n=rr(),r=jn(),i=Xn();function a(){this.size=0,this.__data__={hash:new n,map:new(i||r),string:new n}}t.exports=a})),ar=s(((e,t)=>{function n(e){var t=typeof e;return t==`string`||t==`number`||t==`symbol`||t==`boolean`?e!==`__proto__`:e===null}t.exports=n})),or=s(((e,t)=>{var n=ar();function r(e,t){var r=e.__data__;return n(t)?r[typeof t==`string`?`string`:`hash`]:r.map}t.exports=r})),sr=s(((e,t)=>{var n=or();function r(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}t.exports=r})),cr=s(((e,t)=>{var n=or();function r(e){return n(this,e).get(e)}t.exports=r})),lr=s(((e,t)=>{var n=or();function r(e){return n(this,e).has(e)}t.exports=r})),ur=s(((e,t)=>{var n=or();function r(e,t){var r=n(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this}t.exports=r})),dr=s(((e,t)=>{var n=ir(),r=sr(),i=cr(),a=lr(),o=ur();function s(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=n,s.prototype.delete=r,s.prototype.get=i,s.prototype.has=a,s.prototype.set=o,t.exports=s})),fr=s(((e,t)=>{var n=jn(),r=Xn(),i=dr(),a=200;function o(e,t){var o=this.__data__;if(o instanceof n){var s=o.__data__;if(!r||s.length<a-1)return s.push([e,t]),this.size=++o.size,this;o=this.__data__=new i(s)}return o.set(e,t),this.size=o.size,this}t.exports=o})),pr=s(((e,t)=>{var n=jn(),r=Mn(),i=Nn(),a=Pn(),o=Fn(),s=fr();function c(e){this.size=(this.__data__=new n(e)).size}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=a,c.prototype.has=o,c.prototype.set=s,t.exports=c})),mr=s(((e,t)=>{function n(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}t.exports=n})),hr=s(((e,t)=>{var n=Yn();t.exports=function(){try{var e=n(Object,`defineProperty`);return e({},``,{}),e}catch{}}()})),gr=s(((e,t)=>{var n=hr();function r(e,t,r){t==`__proto__`&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}t.exports=r})),_r=s(((e,t)=>{var n=gr(),r=Tn(),i=Object.prototype.hasOwnProperty;function a(e,t,a){var o=e[t];(!(i.call(e,t)&&r(o,a))||a===void 0&&!(t in e))&&n(e,t,a)}t.exports=a})),vr=s(((e,t)=>{var n=_r(),r=gr();function i(e,t,i,a){var o=!i;i||={};for(var s=-1,c=t.length;++s<c;){var l=t[s],u=a?a(i[l],e[l],l,i,e):void 0;u===void 0&&(u=e[l]),o?r(i,l,u):n(i,l,u)}return i}t.exports=i})),yr=s(((e,t)=>{function n(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}t.exports=n})),br=s(((e,t)=>{function n(e){return typeof e==`object`&&!!e}t.exports=n})),xr=s(((e,t)=>{var n=Vn(),r=br(),i=`[object Arguments]`;function a(e){return r(e)&&n(e)==i}t.exports=a})),Sr=s(((e,t)=>{var n=xr(),r=br(),i=Object.prototype,a=i.hasOwnProperty,o=i.propertyIsEnumerable;t.exports=n(function(){return arguments}())?n:function(e){return r(e)&&a.call(e,`callee`)&&!o.call(e,`callee`)}})),Cr=s(((e,t)=>{t.exports=Array.isArray})),wr=s(((e,t)=>{function n(){return!1}t.exports=n})),Tr=s(((e,t)=>{var n=Ln(),r=wr(),i=typeof e==`object`&&e&&!e.nodeType&&e,a=i&&typeof t==`object`&&t&&!t.nodeType&&t,o=a&&a.exports===i?n.Buffer:void 0;t.exports=(o?o.isBuffer:void 0)||r})),Er=s(((e,t)=>{var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;function i(e,t){var i=typeof e;return t??=n,!!t&&(i==`number`||i!=`symbol`&&r.test(e))&&e>-1&&e%1==0&&e<t}t.exports=i})),Dr=s(((e,t)=>{var n=9007199254740991;function r(e){return typeof e==`number`&&e>-1&&e%1==0&&e<=n}t.exports=r})),Or=s(((e,t)=>{var n=Vn(),r=Dr(),i=br(),a=`[object Arguments]`,o=`[object Array]`,s=`[object Boolean]`,c=`[object Date]`,l=`[object Error]`,u=`[object Function]`,d=`[object Map]`,f=`[object Number]`,p=`[object Object]`,m=`[object RegExp]`,h=`[object Set]`,g=`[object String]`,_=`[object WeakMap]`,v=`[object ArrayBuffer]`,y=`[object DataView]`,b=`[object Float32Array]`,x=`[object Float64Array]`,S=`[object Int8Array]`,C=`[object Int16Array]`,w=`[object Int32Array]`,E=`[object Uint8Array]`,D=`[object Uint8ClampedArray]`,O=`[object Uint16Array]`,k=`[object Uint32Array]`,A={};A[b]=A[x]=A[S]=A[C]=A[w]=A[E]=A[D]=A[O]=A[k]=!0,A[a]=A[o]=A[v]=A[s]=A[y]=A[c]=A[l]=A[u]=A[d]=A[f]=A[p]=A[m]=A[h]=A[g]=A[_]=!1;function j(e){return i(e)&&r(e.length)&&!!A[n(e)]}t.exports=j})),kr=s(((e,t)=>{function n(e){return function(t){return e(t)}}t.exports=n})),Ar=s(((e,t)=>{var n=In(),r=typeof e==`object`&&e&&!e.nodeType&&e,i=r&&typeof t==`object`&&t&&!t.nodeType&&t,a=i&&i.exports===r&&n.process;t.exports=function(){try{return i&&i.require&&i.require(`util`).types||a&&a.binding&&a.binding(`util`)}catch{}}()})),jr=s(((e,t)=>{var n=Or(),r=kr(),i=Ar(),a=i&&i.isTypedArray;t.exports=a?r(a):n})),Mr=s(((e,t)=>{var n=yr(),r=Sr(),i=Cr(),a=Tr(),o=Er(),s=jr(),c=Object.prototype.hasOwnProperty;function l(e,t){var l=i(e),u=!l&&r(e),d=!l&&!u&&a(e),f=!l&&!u&&!d&&s(e),p=l||u||d||f,m=p?n(e.length,String):[],h=m.length;for(var g in e)(t||c.call(e,g))&&!(p&&(g==`length`||d&&(g==`offset`||g==`parent`)||f&&(g==`buffer`||g==`byteLength`||g==`byteOffset`)||o(g,h)))&&m.push(g);return m}t.exports=l})),Nr=s(((e,t)=>{var n=Object.prototype;function r(e){var t=e&&e.constructor;return e===(typeof t==`function`&&t.prototype||n)}t.exports=r})),Pr=s(((e,t)=>{function n(e,t){return function(n){return e(t(n))}}t.exports=n})),Fr=s(((e,t)=>{t.exports=Pr()(Object.keys,Object)})),Ir=s(((e,t)=>{var n=Nr(),r=Fr(),i=Object.prototype.hasOwnProperty;function a(e){if(!n(e))return r(e);var t=[];for(var a in Object(e))i.call(e,a)&&a!=`constructor`&&t.push(a);return t}t.exports=a})),Lr=s(((e,t)=>{var n=Un(),r=Dr();function i(e){return e!=null&&r(e.length)&&!n(e)}t.exports=i})),Rr=s(((e,t)=>{var n=Mr(),r=Ir(),i=Lr();function a(e){return i(e)?n(e):r(e)}t.exports=a})),zr=s(((e,t)=>{var n=vr(),r=Rr();function i(e,t){return e&&n(t,r(t),e)}t.exports=i})),Br=s(((e,t)=>{function n(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}t.exports=n})),Vr=s(((e,t)=>{var n=Hn(),r=Nr(),i=Br(),a=Object.prototype.hasOwnProperty;function o(e){if(!n(e))return i(e);var t=r(e),o=[];for(var s in e)s==`constructor`&&(t||!a.call(e,s))||o.push(s);return o}t.exports=o})),Hr=s(((e,t)=>{var n=Mr(),r=Vr(),i=Lr();function a(e){return i(e)?n(e,!0):r(e)}t.exports=a})),Ur=s(((e,t)=>{var n=vr(),r=Hr();function i(e,t){return e&&n(t,r(t),e)}t.exports=i})),Wr=s(((e,t)=>{var n=Ln(),r=typeof e==`object`&&e&&!e.nodeType&&e,i=r&&typeof t==`object`&&t&&!t.nodeType&&t,a=i&&i.exports===r?n.Buffer:void 0,o=a?a.allocUnsafe:void 0;function s(e,t){if(t)return e.slice();var n=e.length,r=o?o(n):new e.constructor(n);return e.copy(r),r}t.exports=s})),Gr=s(((e,t)=>{function n(e,t){var n=-1,r=e.length;for(t||=Array(r);++n<r;)t[n]=e[n];return t}t.exports=n})),Kr=s(((e,t)=>{function n(e,t){for(var n=-1,r=e==null?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}t.exports=n})),qr=s(((e,t)=>{function n(){return[]}t.exports=n})),Jr=s(((e,t)=>{var n=Kr(),r=qr(),i=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols;t.exports=a?function(e){return e==null?[]:(e=Object(e),n(a(e),function(t){return i.call(e,t)}))}:r})),Yr=s(((e,t)=>{var n=vr(),r=Jr();function i(e,t){return n(e,r(e),t)}t.exports=i})),Xr=s(((e,t)=>{function n(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}t.exports=n})),Zr=s(((e,t)=>{t.exports=Pr()(Object.getPrototypeOf,Object)})),Qr=s(((e,t)=>{var n=Xr(),r=Zr(),i=Jr(),a=qr();t.exports=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,i(e)),e=r(e);return t}:a})),$r=s(((e,t)=>{var n=vr(),r=Qr();function i(e,t){return n(e,r(e),t)}t.exports=i})),ei=s(((e,t)=>{var n=Xr(),r=Cr();function i(e,t,i){var a=t(e);return r(e)?a:n(a,i(e))}t.exports=i})),ti=s(((e,t)=>{var n=ei(),r=Jr(),i=Rr();function a(e){return n(e,i,r)}t.exports=a})),ni=s(((e,t)=>{var n=ei(),r=Qr(),i=Hr();function a(e){return n(e,i,r)}t.exports=a})),ri=s(((e,t)=>{t.exports=Yn()(Ln(),`DataView`)})),ii=s(((e,t)=>{t.exports=Yn()(Ln(),`Promise`)})),ai=s(((e,t)=>{t.exports=Yn()(Ln(),`Set`)})),oi=s(((e,t)=>{t.exports=Yn()(Ln(),`WeakMap`)})),si=s(((e,t)=>{var n=ri(),r=Xn(),i=ii(),a=ai(),o=oi(),s=Vn(),c=Kn(),l=`[object Map]`,u=`[object Object]`,d=`[object Promise]`,f=`[object Set]`,p=`[object WeakMap]`,m=`[object DataView]`,h=c(n),g=c(r),_=c(i),v=c(a),y=c(o),b=s;(n&&b(new n(new ArrayBuffer(1)))!=m||r&&b(new r)!=l||i&&b(i.resolve())!=d||a&&b(new a)!=f||o&&b(new o)!=p)&&(b=function(e){var t=s(e),n=t==u?e.constructor:void 0,r=n?c(n):``;if(r)switch(r){case h:return m;case g:return l;case _:return d;case v:return f;case y:return p}return t}),t.exports=b})),ci=s(((e,t)=>{var n=Object.prototype.hasOwnProperty;function r(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]==`string`&&n.call(e,`index`)&&(r.index=e.index,r.input=e.input),r}t.exports=r})),li=s(((e,t)=>{t.exports=Ln().Uint8Array})),ui=s(((e,t)=>{var n=li();function r(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}t.exports=r})),di=s(((e,t)=>{var n=ui();function r(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}t.exports=r})),fi=s(((e,t)=>{var n=/\w*$/;function r(e){var t=new e.constructor(e.source,n.exec(e));return t.lastIndex=e.lastIndex,t}t.exports=r})),pi=s(((e,t)=>{var n=Rn(),r=n?n.prototype:void 0,i=r?r.valueOf:void 0;function a(e){return i?Object(i.call(e)):{}}t.exports=a})),mi=s(((e,t)=>{var n=ui();function r(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}t.exports=r})),hi=s(((e,t)=>{var n=ui(),r=di(),i=fi(),a=pi(),o=mi(),s=`[object Boolean]`,c=`[object Date]`,l=`[object Map]`,u=`[object Number]`,d=`[object RegExp]`,f=`[object Set]`,p=`[object String]`,m=`[object Symbol]`,h=`[object ArrayBuffer]`,g=`[object DataView]`,_=`[object Float32Array]`,v=`[object Float64Array]`,y=`[object Int8Array]`,b=`[object Int16Array]`,x=`[object Int32Array]`,S=`[object Uint8Array]`,C=`[object Uint8ClampedArray]`,w=`[object Uint16Array]`,E=`[object Uint32Array]`;function D(e,t,D){var O=e.constructor;switch(t){case h:return n(e);case s:case c:return new O(+e);case g:return r(e,D);case _:case v:case y:case b:case x:case S:case C:case w:case E:return o(e,D);case l:return new O;case u:case p:return new O(e);case d:return i(e);case f:return new O;case m:return a(e)}}t.exports=D})),gi=s(((e,t)=>{var n=Hn(),r=Object.create;t.exports=function(){function e(){}return function(t){if(!n(t))return{};if(r)return r(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}()})),_i=s(((e,t)=>{var n=gi(),r=Zr(),i=Nr();function a(e){return typeof e.constructor==`function`&&!i(e)?n(r(e)):{}}t.exports=a})),vi=s(((e,t)=>{var n=si(),r=br(),i=`[object Map]`;function a(e){return r(e)&&n(e)==i}t.exports=a})),yi=s(((e,t)=>{var n=vi(),r=kr(),i=Ar(),a=i&&i.isMap;t.exports=a?r(a):n})),bi=s(((e,t)=>{var n=si(),r=br(),i=`[object Set]`;function a(e){return r(e)&&n(e)==i}t.exports=a})),xi=s(((e,t)=>{var n=bi(),r=kr(),i=Ar(),a=i&&i.isSet;t.exports=a?r(a):n})),Si=s(((e,t)=>{var n=pr(),r=mr(),i=_r(),a=zr(),o=Ur(),s=Wr(),c=Gr(),l=Yr(),u=$r(),d=ti(),f=ni(),p=si(),m=ci(),h=hi(),g=_i(),_=Cr(),v=Tr(),y=yi(),b=Hn(),x=xi(),S=Rr(),C=Hr(),w=1,E=2,D=4,O=`[object Arguments]`,k=`[object Array]`,A=`[object Boolean]`,j=`[object Date]`,M=`[object Error]`,N=`[object Function]`,P=`[object GeneratorFunction]`,F=`[object Map]`,I=`[object Number]`,ee=`[object Object]`,R=`[object RegExp]`,z=`[object Set]`,B=`[object String]`,te=`[object Symbol]`,ne=`[object WeakMap]`,re=`[object ArrayBuffer]`,V=`[object DataView]`,ie=`[object Float32Array]`,ae=`[object Float64Array]`,oe=`[object Int8Array]`,se=`[object Int16Array]`,ce=`[object Int32Array]`,H=`[object Uint8Array]`,le=`[object Uint8ClampedArray]`,ue=`[object Uint16Array]`,de=`[object Uint32Array]`,U={};U[O]=U[k]=U[re]=U[V]=U[A]=U[j]=U[ie]=U[ae]=U[oe]=U[se]=U[ce]=U[F]=U[I]=U[ee]=U[R]=U[z]=U[B]=U[te]=U[H]=U[le]=U[ue]=U[de]=!0,U[M]=U[N]=U[ne]=!1;function fe(e,t,k,A,j,M){var F,I=t&w,R=t&E,z=t&D;if(k&&(F=j?k(e,A,j,M):k(e)),F!==void 0)return F;if(!b(e))return e;var B=_(e);if(B){if(F=m(e),!I)return c(e,F)}else{var te=p(e),ne=te==N||te==P;if(v(e))return s(e,I);if(te==ee||te==O||ne&&!j){if(F=R||ne?{}:g(e),!I)return R?u(e,o(F,e)):l(e,a(F,e))}else{if(!U[te])return j?e:{};F=h(e,te,I)}}M||=new n;var re=M.get(e);if(re)return re;M.set(e,F),x(e)?e.forEach(function(n){F.add(fe(n,t,k,n,e,M))}):y(e)&&e.forEach(function(n,r){F.set(r,fe(n,t,k,r,e,M))});var V=B?void 0:(z?R?f:d:R?C:S)(e);return r(V||e,function(n,r){V&&(r=n,n=e[r]),i(F,r,fe(n,t,k,r,e,M))}),F}t.exports=fe})),Ci=s(((e,t)=>{var n=Si(),r=1,i=4;function a(e){return n(e,r|i)}t.exports=a})),wi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=r(Ci()),n=r(Xt());function r(e){return e&&e.__esModule?e:{default:e}}e.default=function(e){var r=e.blocks.reduce(function(e,t){return e[t.name]=t,e},{}),i=function(e,a){var o=[];return e.forEach(function(e){if(e.type===`INSERT`){var s=e,c=r[s.block];if(!c){n.default.error(`no block found for insert. block:`,s.block);return}var l=s.rowCount??1,u=s.columnCount??1,d=s.rowSpacing??0,f=s.columnSpacing??0,p=s.rotation??0,m,h;if(l>1||u>1){var g=Math.cos(p*Math.PI/180),_=Math.sin(p*Math.PI/180);m={x:-_*d,y:g*d},h={x:g*f,y:_*f}}else m={x:0,y:0},h={x:0,y:0};for(var v=0;v<l;v++)for(var y=0;y<u;y++){var b={x:s.x+m.x*v+h.x*y,y:s.y+m.y*v+h.y*y,scaleX:s.scaleX,scaleY:s.scaleY,scaleZ:s.scaleZ,extrusionX:s.extrusionX,extrusionY:s.extrusionY,extrusionZ:s.extrusionZ,rotation:s.rotation},x=a.slice(0);x.push(b);var S=c.entities.map(function(e){var n=(0,t.default)(e);switch(n.layer=s.layer,n.type){case`LINE`:n.start.x-=c.x,n.start.y-=c.y,n.end.x-=c.x,n.end.y-=c.y;break;case`LWPOLYLINE`:case`POLYLINE`:n.vertices.forEach(function(e){e.x-=c.x,e.y-=c.y});break;case`CIRCLE`:case`ELLIPSE`:case`ARC`:n.x-=c.x,n.y-=c.y;break;case`SPLINE`:n.controlPoints.forEach(function(e){e.x-=c.x,e.y-=c.y});break}return n});o=o.concat(i(S,x))}}else{var C=(0,t.default)(e);C.transforms=a.slice().reverse(),o.push(C)}}),o};return i(e.entities,[])}})),Ti=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=function(e){return e.reduce(function(e,t){var n=t.layer;return e[n]||(e[n]=[]),e[n].push(t),e},{})}})),Ei=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;function t(e){"@babel/helpers - typeof";return t=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},t(e)}function n(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}e.default=function(){function e(r,i){n(this,e),t(r)===`object`?(this.x=r.x,this.y=r.y):(this.x=r,this.y=i)}return i(e,[{key:`equals`,value:function(e){return this.x===e.x&&this.y===e.y}},{key:`length`,value:function(){return Math.sqrt(this.dot(this))}},{key:`neg`,value:function(){return new e(-this.x,-this.y)}},{key:`add`,value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:`sub`,value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:`multiply`,value:function(t){return new e(this.x*t,this.y*t)}},{key:`norm`,value:function(){return this.multiply(1/this.length())}},{key:`dot`,value:function(e){return this.x*e.x+this.y*e.y}}]),e}()})),Di=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;function t(e){"@babel/helpers - typeof";return t=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},t(e)}function n(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}e.default=function(){function e(r,i,a){n(this,e),t(r)===`object`?(this.x=r.x,this.y=r.y,this.z=r.z):r===void 0?(this.x=0,this.y=0,this.z=0):(this.x=r,this.y=i,this.z=a)}return i(e,[{key:`equals`,value:function(e,t){return t===void 0&&(t=0),Math.abs(this.x-e.x)<=t&&Math.abs(this.y-e.y)<=t&&Math.abs(this.z-e.z)<=t}},{key:`length`,value:function(){return Math.sqrt(this.dot(this))}},{key:`neg`,value:function(){return new e(-this.x,-this.y,-this.z)}},{key:`add`,value:function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)}},{key:`sub`,value:function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)}},{key:`multiply`,value:function(t){return new e(this.x*t,this.y*t,this.z*t)}},{key:`norm`,value:function(){return this.multiply(1/this.length())}},{key:`dot`,value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:`cross`,value:function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}}]),e}()})),Oi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(Ei());function n(e){return e&&e.__esModule?e:{default:e}}function r(e){"@babel/helpers - typeof";return r=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},r(e)}function i(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var s=function(){function e(n,a){if(i(this,e),r(n)===`object`&&r(a)===`object`&&n.x!==void 0&&n.y!==void 0&&a.x!==void 0&&a.y!==void 0)this.min=new t.default(n),this.max=new t.default(a),this.valid=!0;else if(n===void 0&&a===void 0)this.min=new t.default(1/0,1/0),this.max=new t.default(-1/0,-1/0),this.valid=!1;else throw Error(`Illegal construction - must use { x, y } objects`)}return o(e,[{key:`equals`,value:function(e){if(!this.valid)throw Error(`Box2 is invalid`);return this.min.equals(e.min)&&this.max.equals(e.max)}},{key:`expandByPoint`,value:function(e){return this.min=new t.default(Math.min(this.min.x,e.x),Math.min(this.min.y,e.y)),this.max=new t.default(Math.max(this.max.x,e.x),Math.max(this.max.y,e.y)),this.valid=!0,this}},{key:`expandByPoints`,value:function(e){var t=this;return e.forEach(function(e){t.expandByPoint(e)},this),this}},{key:`isPointInside`,value:function(e){return e.x>=this.min.x&&e.y>=this.min.y&&e.x<=this.max.x&&e.y<=this.max.y}},{key:`width`,get:function(){if(!this.valid)throw Error(`Box2 is invalid`);return this.max.x-this.min.x}},{key:`height`,get:function(){if(!this.valid)throw Error(`Box2 is invalid`);return this.max.y-this.min.y}}]),e}();s.fromPoints=function(e){return new s().expandByPoints(e)},e.default=s})),ki=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(Di());function n(e){return e&&e.__esModule?e:{default:e}}function r(e){"@babel/helpers - typeof";return r=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},r(e)}function i(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var s=function(){function e(n,a){if(i(this,e),r(n)===`object`&&r(a)===`object`&&n.x!==void 0&&n.y!==void 0&&n.z!==void 0&&a.x!==void 0&&a.y!==void 0&&a.z!==void 0)this.min=new t.default(n),this.max=new t.default(a),this.valid=!0;else if(n===void 0&&a===void 0)this.min=new t.default(1/0,1/0,1/0),this.max=new t.default(-1/0,-1/0,-1/0),this.valid=!1;else throw Error(`Illegal construction - must use { x, y, z } objects`)}return o(e,[{key:`equals`,value:function(e){if(!this.valid)throw Error(`Box3 is invalid`);return this.min.equals(e.min)&&this.max.equals(e.max)}},{key:`expandByPoint`,value:function(e){return this.min=new t.default(Math.min(this.min.x,e.x),Math.min(this.min.y,e.y),Math.min(this.min.z,e.z)),this.max=new t.default(Math.max(this.max.x,e.x),Math.max(this.max.y,e.y),Math.max(this.max.z,e.z)),this.valid=!0,this}},{key:`expandByPoints`,value:function(e){var t=this;return e.forEach(function(e){t.expandByPoint(e)},this),this}},{key:`isPointInside`,value:function(e){return e.x>=this.min.x&&e.y>=this.min.y&&e.z>=this.min.z&&e.x<=this.max.x&&e.y<=this.max.y&&e.z<=this.max.z}},{key:`width`,get:function(){if(!this.valid)throw Error(`Box3 is invalid`);return this.max.x-this.min.x}},{key:`depth`,get:function(){if(!this.valid)throw Error(`Box3 is invalid`);return this.max.y-this.min.y}},{key:`height`,get:function(){if(!this.valid)throw Error(`Box3 is invalid`);return this.max.z-this.min.z}}]),e}();s.fromPoints=function(e){return new s().expandByPoints(e)},e.default=s})),Ai=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;function t(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var i=function(){function e(n,r,i,a){t(this,e),this.a=n,this.b=r,this.c=i,this.d=a}return r(e,[{key:`distanceToPoint`,value:function(e){return(this.a*e.x+this.b*e.y+this.c*e.z+this.d)/Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c)}},{key:`equals`,value:function(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d}},{key:`coPlanar`,value:function(e){var t=this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d,n=this.a===-e.a&&this.b===-e.b&&this.c===-e.c&&this.d===-e.d;return t||n}}]),e}();i.fromPointAndNormal=function(e,t){var n=t.x,r=t.y,a=t.z,o=-(e.x*n+e.y*r+e.z*a);return new i(t.x,t.y,t.z,o)},i.fromPoints=function(e){for(var t,n=0,r=e.length;n<r;++n){var a=e[(n+1)%r].sub(e[n]),o=e[(n+2)%r].sub(e[(n+1)%r]),s=a.cross(o);if(!(isNaN(s.length())||s.length()===0))if(!t)t=s.norm();else{var c=s.norm().equals(t,1e-6),l=s.neg().norm().equals(t,1e-6);if(!(c||l))throw Error(`points not on a plane`)}}if(!t)throw Error(`points not on a plane`);return i.fromPointAndNormal(e[0],t.norm())},e.default=i})),ji=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(Di());function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var o=function(){function e(t,n,i,a){r(this,e),this.x=t,this.y=n,this.z=i,this.w=a}return a(e,[{key:`applyToVec3`,value:function(e){var n=e.x,r=e.y,i=e.z,a=this.x,o=this.y,s=this.z,c=this.w,l=c*n+o*i-s*r,u=c*r+s*n-a*i,d=c*i+a*r-o*n,f=-a*n-o*r-s*i;return new t.default(l*c+f*-a+u*-s-d*-o,u*c+f*-o+d*-a-l*-s,d*c+f*-s+l*-o-u*-a)}}]),e}();o.fromAxisAngle=function(e,t){var n=e.norm(),r=t/2,i=Math.sin(r);return new o(n.x*i,n.y*i,n.z*i,Math.cos(r))},e.default=o})),Mi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(Ei());function n(e){return e&&e.__esModule?e:{default:e}}function r(e){"@babel/helpers - typeof";return r=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},r(e)}function i(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var s=function(e,t,n){var r=e.x,i=e.y,a=t.x,o=t.y,s=n.x,c=(n.y-i)*(a-r),l=(o-i)*(s-r);return c>l+2**-52?1:c+2**-52<l?-1:0},c=function(e,t){var n=e.a,r=e.b,i=t.a,a=t.b;return s(n,i,a)!==s(r,i,a)&&s(n,r,i)!==s(n,r,a)},l=function(e,n){var r=e.a.x,i=e.b.x,a=e.a.y,o=e.b.y,s=n.a.x,c=n.b.x,l=n.a.y,u=n.b.y,d=r-i,f=s-c,p=a-o,m=l-u,h=d*m-p*f,g=((r*o-a*i)*f-d*(s*u-l*c))/h,_=((r*o-a*i)*m-p*(s*u-l*c))/h;return isNaN(g)||isNaN(_)?null:new t.default(g,_)},u=function(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)};e.default=function(){function e(n,a){if(i(this,e),r(n)!==`object`||n.x===void 0||n.y===void 0)throw Error(`expected first argument to have x and y properties`);if(r(a)!==`object`||a.x===void 0||a.y===void 0)throw Error(`expected second argument to have x and y properties`);this.a=new t.default(n),this.b=new t.default(a)}return o(e,[{key:`length`,value:function(){return this.a.sub(this.b).length()}},{key:`intersects`,value:function(t){if(!(t instanceof e))throw Error(`expected argument to be an instance of vecks.Line2`);return c(this,t)}},{key:`getIntersection`,value:function(e){return this.intersects(e)?l(this,e):null}},{key:`containsPoint`,value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e-12;return Math.abs(u(this.a,this.b)-u(e,this.a)-u(e,this.b))<t}}]),e}()})),Ni=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(Di());function n(e){return e&&e.__esModule?e:{default:e}}function r(e){"@babel/helpers - typeof";return r=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},r(e)}function i(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var s=function(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2+(e.z-t.z)**2)};e.default=function(){function e(n,a){if(i(this,e),r(n)!==`object`||n.x===void 0||n.y===void 0||n.z===void 0)throw Error(`expected first argument to have x, y and z properties`);if(r(a)!==`object`||a.x===void 0||a.y===void 0||a.y===void 0)throw Error(`expected second argument to have x, y and z properties`);this.a=new t.default(n),this.b=new t.default(a)}return o(e,[{key:`length`,value:function(){return this.a.sub(this.b).length()}},{key:`containsPoint`,value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e-12;return Math.abs(s(this.a,this.b)-s(e,this.a)-s(e,this.b))<t}}]),e}()})),Pi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),Object.defineProperty(e,`V2`,{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,`V3`,{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,`Box2`,{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,`Box3`,{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,`Plane3`,{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,`Quaternion`,{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,`Line2`,{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,`Line3`,{enumerable:!0,get:function(){return c.default}});var t=l(Ei()),n=l(Di()),r=l(Oi()),i=l(ki()),a=l(Ai()),o=l(ji()),s=l(Mi()),c=l(Ni());function l(e){return e&&e.__esModule?e:{default:e}}})),Fi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=[[0,0,0],[255,0,0],[255,255,0],[0,255,0],[0,255,255],[0,0,255],[255,0,255],[255,255,255],[65,65,65],[128,128,128],[255,0,0],[255,170,170],[189,0,0],[189,126,126],[129,0,0],[129,86,86],[104,0,0],[104,69,69],[79,0,0],[79,53,53],[255,63,0],[255,191,170],[189,46,0],[189,141,126],[129,31,0],[129,96,86],[104,25,0],[104,78,69],[79,19,0],[79,59,53],[255,127,0],[255,212,170],[189,94,0],[189,157,126],[129,64,0],[129,107,86],[104,52,0],[104,86,69],[79,39,0],[79,66,53],[255,191,0],[255,234,170],[189,141,0],[189,173,126],[129,96,0],[129,118,86],[104,78,0],[104,95,69],[79,59,0],[79,73,53],[255,255,0],[255,255,170],[189,189,0],[189,189,126],[129,129,0],[129,129,86],[104,104,0],[104,104,69],[79,79,0],[79,79,53],[191,255,0],[234,255,170],[141,189,0],[173,189,126],[96,129,0],[118,129,86],[78,104,0],[95,104,69],[59,79,0],[73,79,53],[127,255,0],[212,255,170],[94,189,0],[157,189,126],[64,129,0],[107,129,86],[52,104,0],[86,104,69],[39,79,0],[66,79,53],[63,255,0],[191,255,170],[46,189,0],[141,189,126],[31,129,0],[96,129,86],[25,104,0],[78,104,69],[19,79,0],[59,79,53],[0,255,0],[170,255,170],[0,189,0],[126,189,126],[0,129,0],[86,129,86],[0,104,0],[69,104,69],[0,79,0],[53,79,53],[0,255,63],[170,255,191],[0,189,46],[126,189,141],[0,129,31],[86,129,96],[0,104,25],[69,104,78],[0,79,19],[53,79,59],[0,255,127],[170,255,212],[0,189,94],[126,189,157],[0,129,64],[86,129,107],[0,104,52],[69,104,86],[0,79,39],[53,79,66],[0,255,191],[170,255,234],[0,189,141],[126,189,173],[0,129,96],[86,129,118],[0,104,78],[69,104,95],[0,79,59],[53,79,73],[0,255,255],[170,255,255],[0,189,189],[126,189,189],[0,129,129],[86,129,129],[0,104,104],[69,104,104],[0,79,79],[53,79,79],[0,191,255],[170,234,255],[0,141,189],[126,173,189],[0,96,129],[86,118,129],[0,78,104],[69,95,104],[0,59,79],[53,73,79],[0,127,255],[170,212,255],[0,94,189],[126,157,189],[0,64,129],[86,107,129],[0,52,104],[69,86,104],[0,39,79],[53,66,79],[0,63,255],[170,191,255],[0,46,189],[126,141,189],[0,31,129],[86,96,129],[0,25,104],[69,78,104],[0,19,79],[53,59,79],[0,0,255],[170,170,255],[0,0,189],[126,126,189],[0,0,129],[86,86,129],[0,0,104],[69,69,104],[0,0,79],[53,53,79],[63,0,255],[191,170,255],[46,0,189],[141,126,189],[31,0,129],[96,86,129],[25,0,104],[78,69,104],[19,0,79],[59,53,79],[127,0,255],[212,170,255],[94,0,189],[157,126,189],[64,0,129],[107,86,129],[52,0,104],[86,69,104],[39,0,79],[66,53,79],[191,0,255],[234,170,255],[141,0,189],[173,126,189],[96,0,129],[118,86,129],[78,0,104],[95,69,104],[59,0,79],[73,53,79],[255,0,255],[255,170,255],[189,0,189],[189,126,189],[129,0,129],[129,86,129],[104,0,104],[104,69,104],[79,0,79],[79,53,79],[255,0,191],[255,170,234],[189,0,141],[189,126,173],[129,0,96],[129,86,118],[104,0,78],[104,69,95],[79,0,59],[79,53,73],[255,0,127],[255,170,212],[189,0,94],[189,126,157],[129,0,64],[129,86,107],[104,0,52],[104,69,86],[79,0,39],[79,53,66],[255,0,63],[255,170,191],[189,0,46],[189,126,141],[129,0,31],[129,86,96],[104,0,25],[104,69,78],[79,0,19],[79,53,59],[51,51,51],[80,80,80],[105,105,105],[130,130,130],[190,190,190],[255,255,255]]})),Ii=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=function(e,t){return t===void 0||+t==0?Math.round(e):(e=+e,t=+t,isNaN(e)||!(typeof t==`number`&&t%1==0)?NaN:(e=e.toString().split(`e`),e=Math.round(+(e[0]+`e`+(e[1]?+e[1]-t:-t))),e=e.toString().split(`e`),+(e[0]+`e`+(e[1]?+e[1]+t:t))))}})),Li=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=n(Ii());function n(e){return e&&e.__esModule?e:{default:e}}e.default=function(e,n,r,i,a){var o=r.length,s=r[0].length;if(e<0||e>1)throw Error(`t out of bounds [0,1]: `+e);if(n<1)throw Error(`degree must be at least 1 (linear)`);if(n>o-1)throw Error(`degree must be less than or equal to point count - 1`);if(!a){a=[];for(var c=0;c<o;c++)a[c]=1}if(!i){i=[];for(var l=0;l<o+n+1;l++)i[l]=l}else if(i.length!==o+n+1)throw Error(`bad knot vector length`);var u=[n,i.length-1-n],d=i[u[0]],f=i[u[1]];e=e*(f-d)+d,e=Math.max(e,d),e=Math.min(e,f);var p;for(p=u[0];p<u[1]&&!(e>=i[p]&&e<=i[p+1]);p++);for(var m=[],h=0;h<o;h++){m[h]=[];for(var g=0;g<s;g++)m[h][g]=r[h][g]*a[h];m[h][s]=a[h]}for(var _,v=1;v<=n+1;v++)for(var y=p;y>p-n-1+v;y--){_=(e-i[y])/(i[y+n+1-v]-i[y]);for(var b=0;b<s+1;b++)m[y][b]=(1-_)*m[y-1][b]+_*m[y][b]}for(var x=[],S=0;S<s;S++)x[S]=(0,t.default)(m[p][S]/m[p][s],-9);return x}})),Ri=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=Pi();e.default=function(e,n,r,i){i||=5;var a,o,s;r<0?(a=Math.atan(-r)*4,o=new t.V2(e[0],e[1]),s=new t.V2(n[0],n[1])):(a=Math.atan(r)*4,o=new t.V2(n[0],n[1]),s=new t.V2(e[0],e[1]));var c=s.sub(o),l=c.length(),u=o.add(c.multiply(.5)),d=Math.abs(l/2/Math.tan(a/2)),f=c.norm(),p;if(a<Math.PI){var m=new t.V2(f.x*Math.cos(Math.PI/2)-f.y*Math.sin(Math.PI/2),f.y*Math.cos(Math.PI/2)+f.x*Math.sin(Math.PI/2));p=u.add(m.multiply(-d))}else{var h=new t.V2(f.x*Math.cos(Math.PI/2)-f.y*Math.sin(Math.PI/2),f.y*Math.cos(Math.PI/2)+f.x*Math.sin(Math.PI/2));p=u.add(h.multiply(d))}var g=Math.atan2(s.y-p.y,s.x-p.x)/Math.PI*180,_=Math.atan2(o.y-p.y,o.x-p.x)/Math.PI*180;_<g&&(_+=360);for(var v=s.sub(p).length(),y=Math.floor(g/i)*i+i,b=Math.ceil(_/i)*i-i,x=[],S=y;S<=b;S+=i)x.push(p.add(new t.V2(Math.cos(S/180*Math.PI)*v,Math.sin(S/180*Math.PI)*v)));return r<0&&x.reverse(),x.map(function(e){return[e.x,e.y]})}})),zi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.polyfaceOutline=e.interpolateBSpline=e.default=void 0;var t=i(Li()),n=i(Xt()),r=i(Ri());function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return c(e)||s(e)||u(e)||o()}function o(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}function c(e){if(Array.isArray(e))return d(e)}function l(e,t){var n=typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&typeof e.length==`number`){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||n.return==null||n.return()}finally{if(s)throw a}}}}function u(e,t){if(e){if(typeof e==`string`)return d(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var f=function(e,t){return e.map(function(e){return[e[0]*Math.cos(t)-e[1]*Math.sin(t),e[1]*Math.cos(t)+e[0]*Math.sin(t)]})},p=function(e,t,n,r,i,a,o){a<i&&(a+=Math.PI*2);for(var s=[],c=Math.PI*2/72,l=1e-6,u=i;u<a-l;u+=c)s.push([Math.cos(u)*n,Math.sin(u)*r]);return s.push([Math.cos(a)*n,Math.sin(a)*r]),o&&(s=f(s,o)),s=s.map(function(n){return[e+n[0],t+n[1]]}),s},m=e.interpolateBSpline=function(e,n,r,i,a){for(var o=[],s=e.map(function(e){return[e.x,e.y]}),c=[r[n]],l=[r[n],r[r.length-1-n]],u=n+1;u<r.length-n;++u)c[c.length-1]!==r[u]&&c.push(r[u]);i||=25;for(var d=1;d<c.length;++d)for(var f=c[d-1],p=c[d],m=0;m<=i;++m){var h=(m/i*(p-f)+f-l[0])/(l[1]-l[0]);h=Math.max(h,0),h=Math.min(h,1);var g=(0,t.default)(h,n,s,r,a);o.push(g)}return o},h=e.polyfaceOutline=function(e){var t=[],n=[],r=l(e.vertices),i;try{for(r.s();!(i=r.n()).done;){var o=i.value;if(o.faces){var s={indices:[],hiddens:[]},c=l(o.faces),u;try{for(c.s();!(u=c.n()).done;){var d=u.value;if(d===0)break;s.indices.push(d<0?-d-1:d-1),s.hiddens.push(d<0)}}catch(e){c.e(e)}finally{c.f()}[3,4].includes(s.indices.length)&&n.push(s)}else t.push({x:o.x,y:o.y})}}catch(e){r.e(e)}finally{r.f()}for(var f=[],p=function(e,t){for(var n=0,r=f;n<r.length;n++){var i=r[n];if(i.slice(-1)[0]===e)return i.push(t)}f.push([e,t])},m=0,h=n;m<h.length;m++)for(var g=h[m],_=0;_<g.indices.length;_++)if(!g.hiddens[_]){var v=(_+1)%g.indices.length;p(g.indices[_],g.indices[v])}for(var y=0,b=f;y<b.length;y++){var x=b[y],S=l(f),C;try{for(S.s();!(C=S.n()).done;){var w=C.value;if(x!==w&&x[0]===w.slice(-1)[0]){w.push.apply(w,a(x.slice(1))),x.splice(0,x.length);break}}}catch(e){S.e(e)}finally{S.f()}}return f.filter(function(e){return e.length}).map(function(e){return e.map(function(e){return t[e]}).map(function(e){return[e.x,e.y]})})};e.default=function(e,t){t||={};var i;if(e.type===`LINE`&&(i=[[e.start.x,e.start.y],[e.end.x,e.end.y]]),e.type===`LWPOLYLINE`||e.type===`POLYLINE`){if(i=[],e.polyfaceMesh){var o;(o=i).push.apply(o,a(h(e)[0]))}else if(!e.polygonMesh)if(e.vertices.length){e.closed&&(e.vertices=e.vertices.concat(e.vertices[0]));for(var s=0,c=e.vertices.length;s<c-1;++s){var l=[e.vertices[s].x,e.vertices[s].y],u=[e.vertices[s+1].x,e.vertices[s+1].y];i.push(l),e.vertices[s].bulge&&(i=i.concat((0,r.default)(l,u,e.vertices[s].bulge))),s===c-2&&i.push(u)}}else n.default.warn(`Polyline entity with no vertices`)}if(e.type===`CIRCLE`&&(i=p(e.x,e.y,e.r,e.r,0,Math.PI*2),e.extrusionZ===-1&&(i=i.map(function(e){return[-e[0],e[1]]}))),e.type===`ELLIPSE`){var d=Math.sqrt(e.majorX*e.majorX+e.majorY*e.majorY),f=e.axisRatio*d,g=-Math.atan2(-e.majorY,e.majorX);i=p(e.x,e.y,d,f,e.startAngle,e.endAngle,g),e.extrusionZ===-1&&(i=i.map(function(e){return[-e[0],e[1]]}))}return e.type===`ARC`&&(i=p(e.x,e.y,e.r,e.r,e.startAngle,e.endAngle,void 0,!1),e.extrusionZ===-1&&(i=i.map(function(e){return[-e[0],e[1]]}))),e.type===`SPLINE`&&(i=m(e.controlPoints,e.degree,e.knots,t.interpolationsPerSplineSegment,e.weights)),i||(n.default.warn(`unsupported entity for converting to polyline:`,e.type),[])}})),Bi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=function(e,t){return t.forEach(function(t){e=e.map(function(e){var n=[e[0],e[1]];if(t.scaleX&&(n[0]*=t.scaleX),t.scaleY&&(n[1]*=t.scaleY),t.rotation){var r=t.rotation/180*Math.PI;n=[n[0]*Math.cos(r)-n[1]*Math.sin(r),n[1]*Math.cos(r)+n[0]*Math.sin(r)]}return t.x&&(n[0]+=t.x),t.y&&(n[1]+=t.y),t.extrusionZ===-1&&(n[0]=-n[0]),n})}),e}})),Vi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=Pi(),n=s(Fi()),r=s(wi()),i=s(zi()),a=s(Bi()),o=s(Xt());function s(e){return e&&e.__esModule?e:{default:e}}e.default=function(e){var s=(0,r.default)(e).map(function(t){var r=e.tables.layers[t.layer],s=0;return`colorNumber`in t?s=t.colorNumber:r&&(s=r.colorNumber),n.default[s]===void 0&&(o.default.warn(`Color index`,s,`invalid, defaulting to black`),s=0),{rgb:n.default[s],layer:r,vertices:(0,a.default)((0,i.default)(t),t.transforms)}}),c=new t.Box2;return s.forEach(function(e){e.vertices.forEach(function(e){c.expandByPoint({x:e[0],y:e[1]})})}),{bbox:c,polylines:s}}})),Hi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=r(Fi()),n=r(Xt());function r(e){return e&&e.__esModule?e:{default:e}}e.default=function(e,r){var i=e[r.layer];if(i){var a=`colorNumber`in r&&r.colorNumber!==256?r.colorNumber:i.colorNumber;return t.default[a]||(n.default.warn(`Color index`,a,`invalid, defaulting to black`),[0,0,0])}else return n.default.warn(`no layer table for layer:`+r.layer),[0,0,0]}})),Ui=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=function(e,t){return{x:e.x*Math.cos(t)-e.y*Math.sin(t),y:e.y*Math.cos(t)+e.x*Math.sin(t)}}})),Wi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=function(e){return e[0]===255&&e[1]===255&&e[2]===255?`rgb(0, 0, 0)`:`rgb(${e[0]}, ${e[1]}, ${e[2]})`}})),Gi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0,e.default=function(e,t,n,r){for(var i=n,a=t,o=t.length,s=0,c=!1,l=0;l<o+e;l++)if(r>i[l]&&r<=i[l+1]){s=l,c=!0;break}if(!c)throw Error(`invalid new knot`);for(var u=[],d=0;d<o+e+1;d++)d<=s?u[d]=i[d]:d===s+1?u[d]=r:u[d]=i[d-1];for(var f,p=[],m=0;m<o+1;m++)f=m<=s-e+1?1:s-e+2<=m&&m<=s?i[m+e-1]-i[m]===0?0:(r-i[m])/(i[m+e-1]-i[m]):0,f===0?p[m]=a[m-1]:f===1?p[m]=a[m]:p[m]={x:(1-f)*a[m-1].x+f*a[m].x,y:(1-f)*a[m-1].y+f*a[m].y};return{controlPoints:p,knots:u}}})),Ki=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.multiplicity=e.default=e.computeInsertions=e.checkPinned=void 0;var t=n(Gi());function n(e){return e&&e.__esModule?e:{default:e}}var r=e.checkPinned=function(e,t){for(var n=1;n<e;++n)if(t[n]!==t[0])throw Error(`not pinned. order: ${e} knots: ${t}`);for(var r=t.length-2;r>t.length-e-1;--r)if(t[r]!==t[t.length-1])throw Error(`not pinned. order: ${e} knots: ${t}`)},i=e.multiplicity=function(e,t){for(var n=1,r=t+1;r<e.length&&e[r]===e[t];++r)++n;return n},a=e.computeInsertions=function(e,t){for(var n=[],r=e;r<t.length-e;){for(var a=t[r],o=i(t,r),s=0;s<e-o-1;++s)n.push(a);r+=o}return n};e.default=function(e,n,i){return r(e,i),a(e,i).reduce(function(n,r){return(0,t.default)(e,n.controlPoints,n.knots,r)},{controlPoints:n,knots:i})}})),qi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=Pi();function n(e,t){return s(e)||o(e,t)||i(e,t)||r()}function r(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i(e,t){if(e){if(typeof e==`string`)return a(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function s(e){if(Array.isArray(e))return e}e.default=function(e,r,i){var a=``,o=i.map(function(e){var t=e.x||0,n=e.y||0,r=e.scaleX||1,i=e.scaleY||1,a=(e.rotation||0)/180*Math.PI,o=Math.cos,s=Math.sin,c,l,u,d,f,p;return e.extrusionZ===-1?(c=-r*o(a),l=r*s(a),u=i*s(a),d=i*o(a),f=-t,p=n):(c=r*o(a),l=r*s(a),u=-i*s(a),d=i*o(a),f=t,p=n),[c,l,u,d,f,p]}),s=new t.Box2;if(e.valid){var c=[{x:e.min.x,y:e.min.y},{x:e.max.x,y:e.min.y},{x:e.max.x,y:e.max.y},{x:e.min.x,y:e.max.y}];o.forEach(function(e){var t=n(e,6),r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5];c=c.map(function(e){return{x:e.x*r+e.y*a+s,y:e.x*i+e.y*o+l}})}),s=c.reduce(function(e,t){return e.expandByPoint(t)},new t.Box2)}return o.reverse(),o.forEach(function(e){var t=n(e,6),r=t[0],i=t[1],o=t[2],s=t[3],c=t[4],l=t[5];a+=`<g transform="matrix(${r} ${i} ${o} ${s} ${c} ${l})">`}),a+=r,o.forEach(function(e){a+=`</g>`}),{bbox:s,element:a}}})),Ji=s((e=>{function t(e){"@babel/helpers - typeof";return t=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},t(e)}Object.defineProperty(e,`__esModule`,{value:!0}),e.piecewiseToPaths=e.default=void 0;var n=Pi(),r=p(zi()),i=p(wi()),a=p(Hi()),o=p(Xt()),s=p(Ui()),c=p(Wi()),l=f(Ki()),u=p(qi());function d(e){if(typeof WeakMap!=`function`)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function f(e,n){if(!n&&e&&e.__esModule)return e;if(e===null||t(e)!=`object`&&typeof e!=`function`)return{default:e};var r=d(n);if(r&&r.has(e))return r.get(e);var i={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!==`default`&&{}.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,r&&r.set(e,i),i}function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){return y(e)||v(e,t)||g(e,t)||h()}function h(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g(e,t){if(e){if(typeof e==`string`)return _(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}function _(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function y(e){if(Array.isArray(e))return e}var b=function(e,t){var r=t.bbox,i=t.element;return e.extrusionZ===-1?{bbox:new n.Box2().expandByPoint({x:-r.min.x,y:r.min.y}).expandByPoint({x:-r.max.x,y:r.max.y}),element:`<g transform="matrix(-1 0 0 1 0 0)">
        ${i}
      </g>`}:{bbox:r,element:i}},x=function(e){var t=(0,r.default)(e),i=t.reduce(function(e,t){var n=m(t,2),r=n[0],i=n[1];return e.expandByPoint({x:r,y:i})},new n.Box2),a=t.reduce(function(e,t,n){return e+=n===0?`M`:`L`,e+=t[0]+`,`+t[1],e},``);return(0,u.default)(i,`<path d="${a}" />`,e.transforms)},S=function(e){var t=(0,r.default)(e),i=b(e,{bbox:t.reduce(function(e,t){var n=m(t,2),r=n[0],i=n[1];return e.expandByPoint({x:r,y:i})},new n.Box2),element:`<path d="${t.reduce(function(e,t,n){return e+=n===0?`M`:`L`,e+=t[0]+`,`+t[1],e},``)}" />`}),a=i.bbox,o=i.element;return(0,u.default)(a,o,e.transforms)},C=function(e){var t=b(e,{bbox:new n.Box2().expandByPoint({x:e.x+e.r,y:e.y+e.r}).expandByPoint({x:e.x-e.r,y:e.y-e.r}),element:`<circle cx="${e.x}" cy="${e.y}" r="${e.r}" />`}),r=t.bbox,i=t.element;return(0,u.default)(r,i,e.transforms)},w=function(e,t,n,r,i,a,o,c){var l=Math.sqrt(n*n+r*r),u=i*l,d=-Math.atan2(-r,n),f=E(e,t,n,r,i,a,o,c);if(Math.abs(a-o)<1e-9||Math.abs(a-o+Math.PI*2)<1e-9)return{bbox:f,element:`<g transform="rotate(${d/Math.PI*180} ${e}, ${t})">
      <ellipse cx="${e}" cy="${t}" rx="${l}" ry="${u}" />
    </g>`};var p=(0,s.default)({x:Math.cos(a)*l,y:Math.sin(a)*u},d),m={x:e+p.x,y:t+p.y},h=(0,s.default)({x:Math.cos(o)*l,y:Math.sin(o)*u},d),g={x:e+h.x,y:t+h.y},_=(o<a?o+Math.PI*2:o)-a<Math.PI?0:1;return{bbox:f,element:`<path d="${`M ${m.x} ${m.y} A ${l} ${u} ${d/Math.PI*180} ${_} 1 ${g.x} ${g.y}`}" />`}},E=function(e,t,r,i,a,o,s,c){for(;o<0;)o+=Math.PI*2;for(;s<=o;)s+=Math.PI*2;var l=[];if(Math.abs(r)<1e-12||Math.abs(i)<1e-12)for(var u=0;u<4;u++)l.push(u/2*Math.PI);else l[0]=Math.atan(-i*a/r)-Math.PI,l[1]=Math.atan(r*a/i)-Math.PI,l[2]=l[0]-Math.PI,l[3]=l[1]-Math.PI;for(var d=4;d>=0;d--){for(;l[d]<o;)l[d]+=Math.PI*2;l[d]>s&&l.splice(d,1)}l.push(o),l.push(s);var f=l.map(function(e){return{x:Math.cos(e),y:Math.sin(e)}}),p=[[r,-i*a],[i,r*a]];return f.map(function(n){return{x:n.x*p[0][0]+n.y*p[0][1]+e,y:n.x*p[1][0]+n.y*p[1][1]+t}}).reduce(function(e,t){return e.expandByPoint(t),e},new n.Box2)},D=function(e){var t=w(e.x,e.y,e.majorX,e.majorY,e.axisRatio,e.startAngle,e.endAngle),n=t.bbox,r=t.element,i=b(e,{bbox:n,element:r}),a=i.bbox,o=i.element;return(0,u.default)(a,o,e.transforms)},O=function(e){var t=w(e.x,e.y,e.r,0,1,e.startAngle,e.endAngle,e.extrusionZ===-1),n=t.bbox,r=t.element,i=b(e,{bbox:n,element:r}),a=i.bbox,o=i.element;return(0,u.default)(a,o,e.transforms)},k=e.piecewiseToPaths=function(e,t,n){for(var r=[],i=0,a=e;a<t.length-e+1;){var o=(0,l.multiplicity)(t,a),s=n.slice(i,i+e);e===4?r.push(`<path d="M ${s[0].x} ${s[0].y} C ${s[1].x} ${s[1].y} ${s[2].x} ${s[2].y} ${s[3].x} ${s[3].y}" />`):e===3&&r.push(`<path d="M ${s[0].x} ${s[0].y} Q ${s[1].x} ${s[1].y} ${s[2].x} ${s[2].y}" />`),i+=o,a+=o}return r},A=function(e){var t=new n.Box2;e.controlPoints.forEach(function(e){t=t.expandByPoint(e)});var r=e.degree+1,i=(0,l.default)(r,e.controlPoints,e.knots),a=`<g>${k(r,i.knots,i.controlPoints).join(``)}</g>`;return(0,u.default)(t,a,e.transforms)},j=function(e){switch(e.type){case`CIRCLE`:return C(e);case`ELLIPSE`:return D(e);case`ARC`:return O(e);case`SPLINE`:var t=e.weights&&e.weights.some(function(e){return e!==1});if((e.degree===2||e.degree===3)&&!t)try{return A(e)}catch{return x(e)}else return x(e);case`LINE`:case`POLYLINE`:return x(e);case`LWPOLYLINE`:return S(e);default:return o.default.warn(`entity type not supported in SVG rendering:`,e.type),null}};e.default=function(e){var t=(0,i.default)(e).reduce(function(t,n,r){var i=(0,a.default)(e.tables.layers,n),o=j(n);if(o){var s=o.bbox,l=o.element;s.valid&&(t.bbox.expandByPoint(s.min),t.bbox.expandByPoint(s.max)),t.elements.push(`<g stroke="${(0,c.default)(i)}">${l}</g>`)}return t},{bbox:new n.Box2,elements:[]}),r=t.bbox,o=t.elements,s=r.valid?{x:r.min.x,y:-r.max.y,width:r.max.x-r.min.x,height:r.max.y-r.min.y}:{x:0,y:0,width:0,height:0};return`<?xml version="1.0"?>
<svg
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
  preserveAspectRatio="xMinYMin meet"
  viewBox="${s.x} ${s.y} ${s.width} ${s.height}"
  width="100%" height="100%"
>
  <g stroke="#000000" stroke-width="0.1%" fill="none" transform="matrix(1,0,0,-1,0,0)">
    ${o.join(`
`)}
  </g>
</svg>`}})),Yi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.default=void 0;var t=s(Xt()),n=s(Cn()),r=s(wi()),i=s(Ji()),a=s(Vi()),o=s(Ti());function s(e){return e&&e.__esModule?e:{default:e}}function c(e){"@babel/helpers - typeof";return c=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},c(e)}function l(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,`prototype`,{writable:!1}),e}function f(e){var t=p(e,`string`);return c(t)==`symbol`?t:t+``}function p(e,t){if(c(e)!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(c(r)!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}e.default=function(){function e(t){if(l(this,e),typeof t!=`string`)throw Error(`Helper constructor expects a DXF string`);this._contents=t,this._parsed=null,this._denormalised=null}return d(e,[{key:`parse`,value:function(){return this._parsed=(0,n.default)(this._contents),t.default.info(`parsed:`,this.parsed),this._parsed}},{key:`parsed`,get:function(){return this._parsed===null&&this.parse(),this._parsed}},{key:`denormalise`,value:function(){return this._denormalised=(0,r.default)(this.parsed),t.default.info(`denormalised:`,this._denormalised),this._denormalised}},{key:`denormalised`,get:function(){return this._denormalised||this.denormalise(),this._denormalised}},{key:`group`,value:function(){this._groups=(0,o.default)(this.denormalised)}},{key:`groups`,get:function(){return this._groups||this.group(),this._groups}},{key:`toSVG`,value:function(){return(0,i.default)(this.parsed)}},{key:`toPolylines`,value:function(){return(0,a.default)(this.parsed)}}])}()})),Xi=s((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),Object.defineProperty(e,`Helper`,{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,`colors`,{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,`config`,{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,`denormalise`,{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,`groupEntitiesByLayer`,{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,`parseString`,{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,`toPolylines`,{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,`toSVG`,{enumerable:!0,get:function(){return o.default}});var t=l(Jt()),n=l(Cn()),r=l(wi()),i=l(Ti()),a=l(Vi()),o=l(Ji()),s=l(Fi()),c=l(Yi());function l(e){return e&&e.__esModule?e:{default:e}}}))();function Zi(e){let t=new Xi.Helper(e);return{entities:t.parsed?.entities||[],layers:Object.keys(t.groups||{}),blocks:t.parsed?.blocks||[]}}function Qi(e){return e?.entities||[]}function $i(e){return e?.layers||[]}function ea(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let a of e)if(a.type===`LINE`)t=Math.min(t,a.start.x,a.end.x),n=Math.min(n,a.start.y,a.end.y),r=Math.max(r,a.start.x,a.end.x),i=Math.max(i,a.start.y,a.end.y);else if(a.type===`CIRCLE`){let e=a.center?.x??a.x??0,o=a.center?.y??a.y??0,s=a.radius??a.r??0;t=Math.min(t,e-s),n=Math.min(n,o-s),r=Math.max(r,e+s),i=Math.max(i,o+s)}else if(a.type===`ARC`){let e=a.center?.x??a.x??0,o=a.center?.y??a.y??0,s=a.radius??a.r??0;t=Math.min(t,e-s),n=Math.min(n,o-s),r=Math.max(r,e+s),i=Math.max(i,o+s)}else if(a.type===`POLYLINE`||a.type===`LWPOLYLINE`){if(a.vertices)for(let e of a.vertices)t=Math.min(t,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x),i=Math.max(i,e.y)}else if(a.type===`POINT`)t=Math.min(t,a.position.x),n=Math.min(n,a.position.y),r=Math.max(r,a.position.x),i=Math.max(i,a.position.y);else if(a.type===`TEXT`||a.type===`MTEXT`)a.position&&(t=Math.min(t,a.position.x),n=Math.min(n,a.position.y),r=Math.max(r,a.position.x),i=Math.max(i,a.position.y));else if(a.type===`HATCH`&&a.boundaryPoints)for(let e of a.boundaryPoints)t=Math.min(t,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x),i=Math.max(i,e.y);return{minX:t,minY:n,maxX:r,maxY:i}}function ta(e,t=32){let{center:n,radius:r,startAngle:i,endAngle:a}=e,o=[],s=i,c=a;s>c&&(c+=360);let l=(c-s)/t;for(let e=0;e<=t;e++){let t=(s+l*e)*Math.PI/180;o.push([n.x+r*Math.cos(t),n.y+r*Math.sin(t)])}return o}function na(e,t=64){let{center:n,radius:r}=e,i=[];for(let e=0;e<=t;e++){let a=e/t*2*Math.PI;i.push([n.x+r*Math.cos(a),n.y+r*Math.sin(a)])}return i}function ra(e,t={}){return console.warn(`DWG parsing is limited. For full support, please:
1. Convert DWG to DXF using external tools
2. Use the DXF parser instead
3. Consider using @mlightcad/libredwg-converter for commercial use`),{entities:[],layers:[],warning:`Limited DWG support. Consider converting to DXF.`}}function ia(e){if(!e||e.byteLength<22)return!1;let t=new Uint8Array(e,0,22),n=String.fromCharCode(...t.slice(0,6));return n===`AC1015`||n===`AC1018`||n===`AC1019`||n===`AC1021`||n===`AC1024`||n===`AC1027`||n===`AC1029`||n===`AC1032`}function aa(e){if(!e||e.byteLength<22)return`unknown`;let t=new Uint8Array(e,0,22);return{AC1015:`R15/AutoCAD 2000`,AC1018:`AutoCAD 2004`,AC1019:`AutoCAD 2007`,AC1021:`AutoCAD 2010`,AC1024:`AutoCAD 2013`,AC1027:`AutoCAD 2018`,AC1029:`AutoCAD 2021`,AC1032:`AutoCAD 2024`}[String.fromCharCode(...t.slice(0,6))]||`unknown`}function oa(){return{recommended:`Convert DWG to DXF using:
- Autodesk TrueView (free)
- LibreDWG tools
- Online converters`,alternatives:[`Use ODA (Open Design Alliance) libraries`,`Use @mlightcad/libredwg-converter (commercial)`,`Export from CAD software as DXF`]}}var sa={LINE:`#ff6b6b`,POLYLINE:`#4ecdc4`,LWPOLYLINE:`#4ecdc4`,CIRCLE:`#45b7d1`,ARC:`#f39c12`,TEXT:`#9b59b6`,MTEXT:`#9b59b6`,POINT:`#e74c3c`,HATCH:`#2ecc71`,BLOCK:`#3498db`,INSERT:`#e67e22`,ELLIPSE:`#1abc9c`,SPLINE:`#34495e`};function ca(e,t){let{offset:n=[0,0],scale:r=1,rotation:i=0}=t,[a,o]=e;if(a=a*r+n[0],o=o*r+n[1],i!==0){let e=i*Math.PI/180,t=Math.cos(e),n=Math.sin(e),r=a*t-o*n,s=a*n+o*t;a=r,o=s}return[a,o]}function la(e,t){return{type:`Feature`,properties:{type:`LINE`,layer:e.layer||`0`,color:e.color||sa.LINE},geometry:{type:`LineString`,coordinates:[ca([e.start.x,e.start.y],t),ca([e.end.x,e.end.y],t)]}}}function ua(e,t){let n=e.vertices||[];if(n.length===0)return null;let r=n.map(e=>ca([e.x,e.y],t));return{type:`Feature`,properties:{type:`POLYLINE`,layer:e.layer||`0`,color:e.color||sa.POLYLINE,isClosed:e.isClosed||!1},geometry:{type:e.isClosed?`Polygon`:`LineString`,coordinates:e.isClosed?[r]:r}}}function da(e,t){let n=e.points||[];if(n.length===0)return null;let r=n.map(e=>ca([e.x,e.y],t));return{type:`Feature`,properties:{type:`LWPOLYLINE`,layer:e.layer||`0`,color:e.color||sa.LWPOLYLINE,isClosed:e.isClosed||!1},geometry:{type:e.isClosed?`Polygon`:`LineString`,coordinates:e.isClosed?[r]:r}}}function fa(e,t){let n=e.center?.x??e.x??0,r=e.center?.y??e.y??0,i=(e.radius??e.r??10)*t.scale,a=ca([n,r],t),o=na({center:{x:0,y:0},radius:i}).map(e=>[a[0]+e[0]-a[0],a[1]+e[1]-a[1]]);return{type:`Feature`,properties:{type:`CIRCLE`,layer:e.layer||`0`,color:e.color||sa.CIRCLE,radius:i,center:a},geometry:{type:`Polygon`,coordinates:[o]}}}function pa(e,t){let n=e.center?.x??e.x??0,r=e.center?.y??e.y??0,i=(e.radius??e.r??10)*t.scale,a=ca([n,r],t),o=ta({center:{x:0,y:0},radius:i,startAngle:e.startAngle??0,endAngle:e.endAngle??360}).map(e=>[a[0]+e[0]-a[0],a[1]+e[1]-a[1]]);return{type:`Feature`,properties:{type:`ARC`,layer:e.layer||`0`,color:e.color||sa.ARC,radius:i,center:a,startAngle:e.startAngle,endAngle:e.endAngle},geometry:{type:`LineString`,coordinates:o}}}function ma(e,t){return{type:`Feature`,properties:{type:`POINT`,layer:e.layer||`0`,color:e.color||sa.POINT},geometry:{type:`Point`,coordinates:ca([e.position.x,e.position.y],t)}}}function ha(e,t){let n=ca([e.position.x,e.position.y],t);return{type:`Feature`,properties:{type:`TEXT`,layer:e.layer||`0`,color:e.color||sa.TEXT,text:e.text||``,height:e.height},geometry:{type:`Point`,coordinates:n}}}function ga(e,t){let n=ca([e.position.x,e.position.y],t);return{type:`Feature`,properties:{type:`MTEXT`,layer:e.layer||`0`,color:e.color||sa.MTEXT,text:e.text||``,height:e.height},geometry:{type:`Point`,coordinates:n}}}function _a(e,t){let n=e.boundaryPoints||[];if(n.length===0)return null;let r=[n.map(e=>ca([e.x,e.y],t))];return{type:`Feature`,properties:{type:`HATCH`,layer:e.layer||`0`,color:e.color||sa.HATCH,pattern:e.pattern||`SOLID`},geometry:{type:`Polygon`,coordinates:r}}}function va(e,t){let n=ca([e.center.x,e.center.y],t),r=e.semiMajorAxis*t.scale||e.semiMajorAxis,i=e.semiMinorAxis*t.scale||e.semiMinorAxis,a=[];i/r;let o=e.startAngle||0,s=e.endAngle||2*Math.PI;for(let e=0;e<=64;e++){let t=o+(s-o)*e/64;a.push([n[0]+r*Math.cos(t),n[1]+i*Math.sin(t)])}return{type:`Feature`,properties:{type:`ELLIPSE`,layer:e.layer||`0`,color:e.color||sa.ELLIPSE,semiMajorAxis:r,semiMinorAxis:i},geometry:{type:`LineString`,coordinates:a}}}function ya(e,t){let n=e.controlPoints||[];if(n.length===0)return null;let r=n.map(e=>ca([e.x,e.y],t));return{type:`Feature`,properties:{type:`SPLINE`,layer:e.layer||`0`,color:e.color||sa.SPLINE,degree:e.degree,knotValues:e.knotValues},geometry:{type:`LineString`,coordinates:r}}}function ba(e,t){if(!e||!e.type)return null;let n={LINE:la,POLYLINE:ua,LWPOLYLINE:da,CIRCLE:fa,ARC:pa,POINT:ma,TEXT:ha,MTEXT:ga,HATCH:_a,ELLIPSE:va,SPLINE:ya}[e.type];return n?n(e,t):null}function xa(e,t={}){let n=Qi(e),r=[];for(let e of n){let n=ba(e,t);n&&r.push(n)}return{type:`FeatureCollection`,features:r}}function Sa(e,t={}){let n=[];for(let r of e){let e=ba(r,t);e&&n.push(e)}return{type:`FeatureCollection`,features:n}}var Ca=[`dxf`,`dwg`];async function wa(e,t,n={}){if(!e)throw Error(`No buffer provided`);if(t=t.toLowerCase(),!Ca.includes(t))throw Error(`Unsupported format: ${t}. Supported: ${Ca.join(`, `)}`);let r={offset:[0,0],scale:1,rotation:0,layers:null,entityTypes:null,...n};if(t===`dxf`)return Ta(e,r);if(t===`dwg`)return Ea(e,r)}function Ta(e,t){let n;n=Zi(typeof e==`string`?e:new TextDecoder(`utf-8`).decode(e));let r=Qi(n);return t.layers&&(r=r.filter(e=>t.layers.includes(e.layer))),t.entityTypes&&(r=r.filter(e=>t.entityTypes.includes(e.type))),{geojson:xa({entities:r},t),metadata:{format:`dxf`,entityCount:r.length,layers:$i(n),boundingBox:ea(r)}}}function Ea(e,t){if(!ia(e))throw Error(`Invalid DWG file format`);let n=aa(e);console.warn(`DWG version detected: ${n}`);let r=ra(e,t);if(!r.entities||r.entities.length===0){let e=oa();return console.warn(e.recommended),{geojson:{type:`FeatureCollection`,features:[]},metadata:{format:`dwg`,version:n,warning:`Limited DWG support. For full support, convert to DXF.`,suggestions:e}}}return{geojson:Sa(r.entities,t),metadata:{format:`dwg`,version:n,entityCount:r.entities.length,layers:r.layers}}}function Da(){return[...Ca]}function Oa(e){let t=f.DomUtil.create(`div`,`tool-panel`);t.innerHTML=`
    <div class="tool-panel-header">
      <span>工具箱</span>
      <button class="tool-toggle-btn">−</button>
    </div>
    <div class="tool-panel-content">
      <div class="tool-section">
        <div class="tool-section-title">📁 文件导入</div>
        <div class="tool-tabs">
          <button class="tab-btn active" data-tab="geojson">GeoJSON</button>
          <button class="tab-btn" data-tab="shp">SHP</button>
          <button class="tab-btn" data-tab="cad">CAD</button>
        </div>
        <div class="tab-content active" id="tab-geojson">
          <div class="file-drop-zone" id="geojson-drop-zone">
            <div class="drop-icon">📄</div>
            <div class="drop-text">点击或拖拽 GeoJSON 文件</div>
            <div class="drop-hint">支持 .json, .geojson</div>
            <input type="file" id="geojson-input" accept=".json,.geojson" />
          </div>
          <div class="file-name-display" id="geojson-name">未选择文件</div>
        </div>
        <div class="tab-content" id="tab-shp">
          <div class="shp-file-row">
            <label>.shp</label>
            <input type="file" id="shp-file" accept=".shp" />
            <span class="file-trigger" id="shp-name">选择文件</span>
          </div>
          <div class="shp-file-row">
            <label>.dbf</label>
            <input type="file" id="dbf-file" accept=".dbf" />
            <span class="file-trigger" id="dbf-name">选择文件</span>
          </div>
          <div class="shp-file-row">
            <label>.shx</label>
            <input type="file" id="shx-file" accept=".shx" />
            <span class="file-trigger" id="shx-name">选择文件 (可选)</span>
          </div>
        </div>
        <div class="tab-content" id="tab-cad">
          <div class="file-drop-zone" id="cad-drop-zone">
            <div class="drop-icon">📐</div>
            <div class="drop-text">点击或拖拽 CAD 文件</div>
            <div class="drop-hint">支持 .dxf, .dwg</div>
            <input type="file" id="cad-input" accept=".dxf,.dwg" />
          </div>
          <div class="file-name-display" id="cad-name">未选择文件</div>
          <div class="cad-options" style="margin-top: 12px;">
            <div class="coord-row">
              <label>偏移X</label>
              <input type="number" id="cad-offset-x" value="0" style="flex:1;padding:6px 8px;border:1px solid #ddd;border-radius:4px;font-size:12px;" />
            </div>
            <div class="coord-row">
              <label>偏移Y</label>
              <input type="number" id="cad-offset-y" value="0" style="flex:1;padding:6px 8px;border:1px solid #ddd;border-radius:4px;font-size:12px;" />
            </div>
            <div class="coord-row">
              <label>缩放</label>
              <input type="number" id="cad-scale" value="1" step="0.1" min="0.001" max="1000" style="flex:1;padding:6px 8px;border:1px solid #ddd;border-radius:4px;font-size:12px;" />
            </div>
          </div>
        </div>
        <button class="tool-primary-btn" id="import-btn">导入到地图</button>
      </div>
      <div class="tool-section">
        <div class="tool-section-title">📤 导出数据</div>
        <div class="export-options">
          <label class="checkbox-label">
            <input type="radio" name="export-format" value="geojson" checked />
            <span>GeoJSON</span>
          </label>
          <label class="checkbox-label">
            <input type="radio" name="export-format" value="shp" />
            <span>SHP (ZIP)</span>
          </label>
        </div>
        <button class="tool-secondary-btn" id="export-btn" disabled>导出当前图层</button>
      </div>
      <div class="tool-section">
        <div class="tool-section-title">🔄 坐标转换</div>
        <div class="coord-row">
          <label>源坐标</label>
          <select id="source-crs">
            <option value="wgs84">WGS84 (GPS)</option>
            <option value="gcj02">GCJ-02 (高德)</option>
            <option value="bd09">BD-09 (百度)</option>
          </select>
        </div>
        <div class="coord-row">
          <label>目标坐标</label>
          <select id="target-crs">
            <option value="gcj02">GCJ-02 (高德)</option>
            <option value="wgs84">WGS84 (GPS)</option>
            <option value="bd09">BD-09 (百度)</option>
          </select>
        </div>
        <div class="coord-row">
          <label>应用范围</label>
          <select id="transform-scope">
            <option value="import">导入时</option>
            <option value="export">导出时</option>
            <option value="both">导入和导出</option>
          </select>
        </div>
      </div>
      <div class="tool-section">
        <div class="tool-section-title">📍 坐标拾取</div>
        <div class="coord-display">
          <div class="coord-item">
            <span class="coord-label">WGS84</span>
            <span class="coord-value" id="coord-wgs84">点击地图获取</span>
          </div>
          <div class="coord-item">
            <span class="coord-label">GCJ-02</span>
            <span class="coord-value" id="coord-gcj02">-</span>
          </div>
          <div class="coord-item">
            <span class="coord-label">BD-09</span>
            <span class="coord-value" id="coord-bd09">-</span>
          </div>
        </div>
      </div>
      <div class="tool-status" id="tool-status"></div>
    </div>
  `,document.body.appendChild(t),f.DomEvent.disableClickPropagation(t),f.DomEvent.disableScrollPropagation(t);let n=t.querySelector(`.tool-toggle-btn`),r=t.querySelector(`.tool-panel-content`);n.addEventListener(`click`,()=>{let e=r.style.display===`none`;r.style.display=e?`block`:`none`,n.textContent=e?`−`:`+`});let i=t.querySelectorAll(`.tab-btn`);i.forEach(e=>{e.addEventListener(`click`,()=>{i.forEach(e=>e.classList.remove(`active`)),e.classList.add(`active`),t.querySelectorAll(`.tab-content`).forEach(e=>e.classList.remove(`active`)),t.querySelector(`#tab-${e.dataset.tab}`).classList.add(`active`)})});let a=t.querySelector(`#geojson-input`),o=t.querySelector(`#geojson-drop-zone`),s=t.querySelector(`#geojson-name`),c=t.querySelector(`#shp-file`),l=t.querySelector(`#dbf-file`),u=t.querySelector(`#shx-file`),d=t.querySelector(`#shp-name`),p=t.querySelector(`#dbf-name`),m=t.querySelector(`#shx-name`),h=t.querySelector(`#import-btn`),g=t.querySelector(`#export-btn`),_=t.querySelector(`#tool-status`),v=null,y=null,b=`geojson`;i.forEach(e=>{e.addEventListener(`click`,()=>{b=e.dataset.tab})}),o.addEventListener(`click`,()=>a.click()),o.addEventListener(`dragover`,e=>{e.preventDefault(),o.classList.add(`drag-over`)}),o.addEventListener(`dragleave`,()=>{o.classList.remove(`drag-over`)}),o.addEventListener(`drop`,e=>{e.preventDefault(),o.classList.remove(`drag-over`);let t=e.dataTransfer.files[0];t&&x(t)}),a.addEventListener(`change`,e=>{let t=e.target.files[0];t&&x(t)});function x(e){if(!e.name.match(/\.(json|geojson)$/i)){A(`请选择 GeoJSON 文件`,`error`);return}s.textContent=e.name;let t=new FileReader;t.onload=e=>{try{v=JSON.parse(e.target.result),A(`已加载 ${v.features?.length||0} 个要素`,`success`),g.disabled=!1}catch{A(`文件解析失败`,`error`)}},t.readAsText(e,`utf-8`)}let S=t.querySelector(`#cad-input`),C=t.querySelector(`#cad-drop-zone`),w=t.querySelector(`#cad-name`);C.addEventListener(`click`,()=>S.click()),C.addEventListener(`dragover`,e=>{e.preventDefault(),C.classList.add(`drag-over`)}),C.addEventListener(`dragleave`,()=>{C.classList.remove(`drag-over`)}),C.addEventListener(`drop`,e=>{e.preventDefault(),C.classList.remove(`drag-over`);let t=e.dataTransfer.files[0];t&&E(t)}),S.addEventListener(`change`,e=>{let t=e.target.files[0];t&&E(t)});function E(n){let r=n.name.split(`.`).pop().toLowerCase();if(!Da().includes(r)){A(`不支持的文件格式，仅支持 .dxf 和 .dwg`,`error`);return}w.textContent=n.name;let i=new FileReader;i.onload=async n=>{try{let i=parseFloat(t.querySelector(`#cad-offset-x`).value)||0,a=parseFloat(t.querySelector(`#cad-offset-y`).value)||0,o=parseFloat(t.querySelector(`#cad-scale`).value)||1,s=e.getCenter(),c=await wa(n.target.result,r,{offset:[s.lng+i,s.lat+a],scale:o});v=c.geojson,A(`已加载 ${v.features.length} 个要素 (${c.metadata.format.toUpperCase()})`,`success`),g.disabled=!1}catch(e){console.error(e),A(`CAD加载失败: ${e.message}`,`error`)}},i.readAsArrayBuffer(n)}d.addEventListener(`click`,()=>c.click()),p.addEventListener(`click`,()=>l.click()),m.addEventListener(`click`,()=>u.click()),c.addEventListener(`change`,e=>{d.textContent=e.target.files[0]?.name||`选择文件`}),l.addEventListener(`change`,e=>{p.textContent=e.target.files[0]?.name||`选择文件`}),u.addEventListener(`change`,e=>{m.textContent=e.target.files[0]?.name||`选择文件 (可选)`}),h.addEventListener(`click`,async()=>{try{if(A(`正在加载...`,`loading`),b===`geojson`){if(!v){A(`请先选择 GeoJSON 文件`,`error`);return}}else if(b===`shp`){let e=c.files[0];if(!e){A(`请选择 .shp 文件`,`error`);return}let t=l.files[0];v=await We(e,t),A(`已加载 ${v.features.length} 个要素`,`success`)}else if(b===`cad`&&!v){A(`请先选择 CAD 文件`,`error`);return}y&&e.removeLayer(y),y=f.geoJSON(v,{style:{color:`#3388ff`,weight:2,fillOpacity:.3},pointToLayer:(e,t)=>f.circleMarker(t,{radius:6,fillColor:`#3388ff`,color:`#fff`,weight:1,fillOpacity:.8}),onEachFeature:(e,t)=>{if(e.properties){let n=Object.entries(e.properties).map(([e,t])=>`<b>${e}:</b> ${t}`).join(`<br>`);t.bindPopup(n||`无属性`)}}}).addTo(e);let t=y.getBounds();t.isValid()&&e.fitBounds(t),A(`已导入 ${v.features.length} 个要素`,`success`)}catch(e){console.error(e),A(`加载失败: ${e.message}`,`error`)}}),g.addEventListener(`click`,()=>{if(!v){A(`没有可导出的数据`,`error`);return}let e=t.querySelector(`input[name="export-format"]:checked`).value,n=`wgis_export`;if(e===`geojson`){let e=new Blob([JSON.stringify(v,null,2)],{type:`application/json`}),t=URL.createObjectURL(e),r=document.createElement(`a`);r.href=t,r.download=`${n}.geojson`,r.click(),URL.revokeObjectURL(t),A(`GeoJSON 已导出`,`success`)}else qt(v,n),A(`SHP 已导出`,`success`)});let D=t.querySelector(`#coord-wgs84`),O=t.querySelector(`#coord-gcj02`),k=t.querySelector(`#coord-bd09`);e.on(`click`,e=>{let t=e.latlng;D.textContent=`${t.lat.toFixed(6)}, ${t.lng.toFixed(6)}`;let n=ee(t.lng,t.lat);O.textContent=`${n[1].toFixed(6)}, ${n[0].toFixed(6)}`;let r=I(n[0],n[1]);k.textContent=`${r[1].toFixed(6)}, ${r[0].toFixed(6)}`});function A(e,t){_.textContent=e,_.className=`tool-status ${t}`}return t}function ka(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})}function Aa(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==`function`&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return c([e,t])}}function c(o){if(r)throw TypeError(`Generator is already executing.`);for(;n;)try{if(r=1,i&&(a=o[0]&2?i.return:o[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;switch(i=0,a&&(o=[o[0]&2,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,i=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if((a=n.trys,!(a=a.length>0&&a[a.length-1]))&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!a||o[1]>a[0]&&o[1]<a[3])){n.label=o[1];break}if(o[0]===6&&n.label<a[1]){n.label=a[1],a=o;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(o);break}a[2]&&n.ops.pop(),n.trys.pop();continue}o=t.call(e,n)}catch(e){o=[6,e],i=0}finally{r=a=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function ja(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function Ma(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}function Na(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,`default`)?e.default:e}function Pa(e){setTimeout(e,0)}function Fa(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e(function(){return t.apply(void 0,n)})}}function Ia(e){return e&&e.__esModule?e:{default:e}}function La(e){return e[Symbol.toStringTag]===`AsyncFunction`}function Ra(e){return e[Symbol.toStringTag]===`AsyncGenerator`}function za(e){return typeof e[Symbol.asyncIterator]==`function`}function Ba(e){if(typeof e!=`function`)throw Error(`expected a function`);return La(e)?(0,$a.default)(e):e}var Va,Ha,Ua,Wa,Ga,Ka,qa,Ja,Ya,Xa,Za,Qa,$a,eo,to,no,ro,io,ao,oo,so,co,lo,uo,fo,po,mo,ho,go,_o,vo,yo,bo,xo,So=o((()=>{Va={exports:{}},Ha={exports:{}},Ua={exports:{}},(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=n;function n(e){return e&&typeof e.length==`number`&&e.length>=0&&e.length%1==0}e.exports=t.default})(Ua,Ua.exports),Wa={},Ga={exports:{}},Ka={exports:{}},(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default})(Ka,Ka.exports),qa={},Object.defineProperty(qa,`__esModule`,{value:!0}),qa.fallback=Pa,qa.wrap=Fa,Ja=qa.hasQueueMicrotask=typeof queueMicrotask==`function`&&queueMicrotask,Ya=qa.hasSetImmediate=typeof setImmediate==`function`&&setImmediate,Xa=qa.hasNextTick=typeof process==`object`&&typeof process.nextTick==`function`,Za=Ja?queueMicrotask:Ya?setImmediate:Xa?process.nextTick:Pa,qa.default=Fa(Za),(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=s;var n=Ka.exports,r=o(n),i=o(qa),a=Wa;function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return(0,a.isAsync)(e)?function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return c(e.apply(this,t),r)}:(0,r.default)(function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&typeof r.then==`function`)return c(r,n);n(null,r)})}function c(e,t){return e.then(function(e){l(t,null,e)},function(e){l(t,e&&e.message?e:Error(e))})}function l(e,t,n){try{e(t,n)}catch(e){(0,i.default)(function(e){throw e},e)}}e.exports=t.default})(Ga,Ga.exports),Object.defineProperty(Wa,`__esModule`,{value:!0}),Wa.isAsyncIterable=Wa.isAsyncGenerator=Wa.isAsync=void 0,Qa=Ga.exports,$a=Ia(Qa),Wa.default=Ba,Wa.isAsync=La,Wa.isAsyncGenerator=Ra,Wa.isAsyncIterable=za,eo={exports:{}},(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=n;function n(e,t){if(t===void 0&&(t=e.length),!t)throw Error(`arity is undefined`);function n(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return typeof r[t-1]==`function`?e.apply(this,r):new Promise(function(i,a){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return a(e);i(t.length>1?t:t[0])},e.apply(n,r)})}return n}e.exports=t.default})(eo,eo.exports),(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0});var n=Ua.exports,r=s(n),i=s(Wa),a=eo.exports,o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)(function(e,t,n){var a=(0,r.default)(t)?[]:{};e(t,function(e,t,n){(0,i.default)(e)(function(e){for(var r,i=[],o=arguments.length-1;o-- >0;)i[o]=arguments[o+1];i.length<2&&(r=i,i=r[0]),a[t]=i,n(e)})},function(e){return n(e,a)})},3),e.exports=t.default})(Ha,Ha.exports),to={exports:{}},no={exports:{}},ro={exports:{}},io={exports:{}},(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=n;function n(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(e!==null){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t}e.exports=t.default})(io,io.exports),ao={exports:{}},oo={exports:{}},(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default})(oo,oo.exports),(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=u;var n=Ua.exports,r=o(n),i=oo.exports,a=o(i);function o(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}function c(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}function l(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function i(){var a=t[++n];return a===`__proto__`?i():n<r?{value:e[a],key:a}:null}}function u(e){if((0,r.default)(e))return s(e);var t=(0,a.default)(e);return t?c(t):l(e)}e.exports=t.default})(ao,ao.exports),so={exports:{}},(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=n;function n(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(e===null)throw Error(`Callback was already called.`);var r=e;e=null,r.apply(this,t)}}e.exports=t.default})(so,so.exports),co={exports:{}},lo={exports:{}},(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default={},e.exports=t.default})(lo,lo.exports),(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=a;var n=lo.exports,r=i(n);function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n,i){var a=!1,o=!1,s=!1,c=0,l=0;function u(){c>=t||s||a||(s=!0,e.next().then(function(e){var t=e.value,r=e.done;if(!(o||a)){if(s=!1,r){a=!0,c<=0&&i(null);return}c++,n(t,l,d),l++,u()}}).catch(f))}function d(e,t){if(--c,!o){if(e)return f(e);if(e===!1){a=!0,o=!0;return}if(t===r.default||a&&c<=0)return a=!0,i(null);u()}}function f(e){o||(s=!1,a=!0,i(e))}u()}e.exports=t.default})(co,co.exports),(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0});var n=io.exports,r=p(n),i=ao.exports,a=p(i),o=so.exports,s=p(o),c=Wa,l=co.exports,u=p(l),d=lo.exports,f=p(d);function p(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,n,i){if(i=(0,r.default)(i),e<=0)throw RangeError(`concurrency limit cannot be less than 1`);if(!t)return i(null);if((0,c.isAsyncGenerator)(t))return(0,u.default)(t,e,n,i);if((0,c.isAsyncIterable)(t))return(0,u.default)(t[Symbol.asyncIterator](),e,n,i);var o=(0,a.default)(t),l=!1,d=!1,p=0,m=!1;function h(e,t){if(!d)if(--p,e)l=!0,i(e);else if(e===!1)l=!0,d=!0;else if(t===f.default||l&&p<=0)return l=!0,i(null);else m||g()}function g(){for(m=!0;p<e&&!l;){var t=o();if(t===null){l=!0,p<=0&&i(null);return}p+=1,n(t.value,t.key,(0,s.default)(h))}m=!1}g()}},e.exports=t.default})(ro,ro.exports),(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0});var n=ro.exports,r=s(n),i=s(Wa),a=eo.exports,o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,a){return(0,r.default)(t)(e,(0,i.default)(n),a)}t.default=(0,o.default)(c,4),e.exports=t.default})(no,no.exports),(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0});var n=no.exports,r=o(n),i=eo.exports,a=o(i);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n){return(0,r.default)(e,1,t,n)}t.default=(0,a.default)(s,3),e.exports=t.default})(to,to.exports),(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=s;var n=Ha.exports,r=o(n),i=to.exports,a=o(i);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,r.default)(a.default,e,t)}e.exports=t.default})(Va,Va.exports),uo=Na(Va.exports),fo=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,uo(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push(function(r){t.apply(void 0,Ma([],ja(n.args),!1)),r(null,e)})},e}(),po={exports:{}},mo={exports:{}},(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0});var n=Ua.exports,r=h(n),i=lo.exports,a=h(i),o=no.exports,s=h(o),c=io.exports,l=h(c),u=so.exports,d=h(u),f=h(Wa),p=eo.exports,m=h(p);function h(e){return e&&e.__esModule?e:{default:e}}function g(e,t,n){n=(0,l.default)(n);var r=0,i=0,o=e.length,s=!1;o===0&&n(null);function c(e,t){e===!1&&(s=!0),s!==!0&&(e?n(e):(++i===o||t===a.default)&&n(null))}for(;r<o;r++)t(e[r],r,(0,d.default)(c))}function _(e,t,n){return(0,s.default)(e,1/0,t,n)}function v(e,t,n){return((0,r.default)(e)?g:_)(e,(0,f.default)(t),n)}t.default=(0,m.default)(v,3),e.exports=t.default})(mo,mo.exports),(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0}),t.default=s;var n=mo.exports,r=o(n),i=Ha.exports,a=o(i);function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,a.default)(r.default,e,t)}e.exports=t.default})(po,po.exports),ho=Na(po.exports),function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return ho(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push(function(r){return ka(n,void 0,void 0,function(){return Aa(this,function(n){switch(n.label){case 0:return[4,t()];case 1:return n.sent(),r(null,e),[2]}})})})},e}(),go={exports:{}},(function(e,t){Object.defineProperty(t,`__esModule`,{value:!0});var n=io.exports,r=l(n),i=so.exports,a=l(i),o=l(Wa),s=eo.exports,c=l(s);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(t=(0,r.default)(t),!Array.isArray(e))return t(Error(`First argument to waterfall must be an array of functions`));if(!e.length)return t();var n=0;function i(t){(0,o.default)(e[n++]).apply(void 0,t.concat([(0,a.default)(s)]))}function s(r){for(var a=[],o=arguments.length-1;o-- >0;)a[o]=arguments[o+1];if(r!==!1){if(r||n===e.length)return t.apply(void 0,[r].concat(a));i(a)}}i([])}t.default=(0,c.default)(u),e.exports=t.default})(go,go.exports),_o=Na(go.exports),function(){function e(){this.tasks=[]}return e.prototype.call=function(){return _o(this.tasks)},e.prototype.tap=function(e,t){this.tasks.length===0?this.tasks.push(function(e){var n=t();e(n?null:!1,n)}):this.tasks.push(function(n,r){r(t.apply(void 0,Ma([],ja(n),!1))?null:!1,e)})},e}(),vo=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return uo(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push(function(n){n(t(),e)})},e}(),yo=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,uo(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push(function(r){return ka(n,void 0,void 0,function(){return Aa(this,function(n){switch(n.label){case 0:return[4,t.apply(void 0,Ma([],ja(this.args),!1))];case 1:return n.sent(),r(null,e),[2]}})})})},e}(),bo=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,uo(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push(function(r){return ka(n,void 0,void 0,function(){var n;return Aa(this,function(i){switch(i.label){case 0:return[4,t.apply(void 0,Ma([],ja(this.args),!1))];case 1:return n=i.sent(),r(n,e),[2]}})})})},e}(),xo=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return _o(this.tasks)},e.prototype.tapPromise=function(e,t){this.tasks.length===0?this.tasks.push(function(e){t().then(function(t){e(null,t)})}):this.tasks.push(function(e,n){t(e).then(function(e){n(null,e)})})},e}()})),Co,wo=o((()=>{Co={REGISTERED_PROTOCOLS:{}}}));function To(e,t){let n=new XMLHttpRequest,r=Array.isArray(e.url)?e.url[0]:e.url;n.open(e.method||`GET`,r,!0),e.type===`arrayBuffer`&&(n.responseType=`arraybuffer`);for(let t in e.headers)e.headers.hasOwnProperty(t)&&n.setRequestHeader(t,e.headers[t]);return e.type===`json`&&(n.responseType=`text`,n.setRequestHeader(`Accept`,`application/json`)),n.withCredentials=e.credentials===`include`,n.onerror=()=>{t(Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||n.status===0)&&n.response!==null){let r=n.response;if(e.type===`json`)try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r,n.getResponseHeader(`Cache-Control`),n.getResponseHeader(`Expires`),n)}else{let e=new Blob([n.response],{type:n.getResponseHeader(`Content-Type`)});t(new Vo(n.status,n.statusText,r.toString(),e))}},n.cancel=n.abort,n.send(e.body),n}function Eo(e){return new Promise((t,n)=>{To(e,(e,r,i,a,o)=>{e?n({err:e,data:null,xhr:o}):t({err:null,data:r,cacheControl:i,expires:a,xhr:o})})})}function Do(e,t){return To(e,t)}function Oo(e){let t=window.document.createElement(`a`);return t.href=e,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}function ko(e,t){let n=new window.Image,r=window.URL||window.webkitURL;n.crossOrigin=`anonymous`,n.onload=()=>{t(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=Ko})},n.onerror=()=>t(Error(`Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`));let i=new Blob([new Uint8Array(e)],{type:`image/png`});n.src=e.byteLength?r.createObjectURL(i):Ko}function Ao(e,t){let n=new Blob([new Uint8Array(e)],{type:`image/png`});createImageBitmap(n).then(e=>{t(null,e)}).catch(e=>{t(Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}var jo,Mo,No,Po,Fo,Io,Lo,Ro,zo,Bo,Vo,Ho,Uo,Wo,Go,Ko,qo,Jo,Yo=o((()=>{wo(),jo=Object.defineProperty,Mo=Object.defineProperties,No=Object.getOwnPropertyDescriptors,Po=Object.getOwnPropertySymbols,Fo=Object.prototype.hasOwnProperty,Io=Object.prototype.propertyIsEnumerable,Lo=(e,t,n)=>t in e?jo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ro=(e,t)=>{for(var n in t||={})Fo.call(t,n)&&Lo(e,n,t[n]);if(Po)for(var n of Po(t))Io.call(t,n)&&Lo(e,n,t[n]);return e},zo=(e,t)=>Mo(e,No(t)),Bo=e=>Co.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf(`://`))],Vo=class extends Error{constructor(e,t,n,r){super(`AJAXError: ${t} (${e}): ${n}`),this.status=e,this.statusText=t,this.url=n,this.body=r}},Ho=(e,t)=>(Bo(e.url)||Do)(zo(Ro({},e),{type:`json`}),t),Uo=(e,t)=>(Bo(e.url)||Do)(zo(Ro({},e),{type:`arrayBuffer`}),t),Wo=(e,t)=>Do(zo(Ro({},e),{method:`POST`}),t),Go=(e,t)=>Do(zo(Ro({},e),{method:`GET`}),t),Ko=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=`,qo=(e,t,n)=>{let r=(e,r)=>{if(e)t(e);else if(r){let e=typeof createImageBitmap==`function`,i=n?n(r):r;e?Ao(i,t):ko(i,t)}};return e.type===`json`?Ho(e,r):Uo(e,r)},Jo=(e,t)=>{typeof createImageBitmap==`function`?Ao(e,t):ko(e,t)}}));function Xo(e,t,n){let r=e.classList;for(let e in Qo)Qo.hasOwnProperty(e)&&r.remove(`l7-${n}-anchor-${e}`);r.add(`l7-${n}-anchor-${t}`)}var Zo,Qo,$o=o((()=>{Zo=(e=>(e.CENTER=`center`,e.TOP=`top`,e[`TOP-LEFT`]=`top-left`,e[`TOP-RIGHT`]=`top-right`,e.BOTTOM=`bottom`,e[`BOTTOM-LEFT`]=`bottom-left`,e[`BOTTOM-RIGHT`]=`bottom-right`,e.LEFT=`left`,e.RIGHT=`right`,e))(Zo||{}),Qo={center:`translate(-50%,-50%)`,top:`translate(-50%,0)`,"top-left":`translate(0,0)`,"top-right":`translate(-100%,0)`,bottom:`translate(-50%,-100%)`,"bottom-left":`translate(0,-100%)`,"bottom-right":`translate(-100%,-100%)`,left:`translate(0,-50%)`,right:`translate(-100%,-50%)`}}));function es(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function ts(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}var ns=o((()=>{}));function rs(){}function is(){return this.rgb().formatHex()}function as(){return _s(this).formatHsl()}function os(){return this.rgb().formatRgb()}function ss(e){var t,n;return e=(e+``).trim().toLowerCase(),(t=Es.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?cs(t):n===3?new fs(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?ls(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?ls(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Ds.exec(e))?new fs(t[1],t[2],t[3],1):(t=Os.exec(e))?new fs(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=ks.exec(e))?ls(t[1],t[2],t[3],t[4]):(t=As.exec(e))?ls(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=js.exec(e))?gs(t[1],t[2]/100,t[3]/100,1):(t=Ms.exec(e))?gs(t[1],t[2]/100,t[3]/100,t[4]):Ns.hasOwnProperty(e)?cs(Ns[e]):e===`transparent`?new fs(NaN,NaN,NaN,0):null}function cs(e){return new fs(e>>16&255,e>>8&255,e&255,1)}function ls(e,t,n,r){return r<=0&&(e=t=n=NaN),new fs(e,t,n,r)}function us(e){return e instanceof rs||(e=ss(e)),e?(e=e.rgb(),new fs(e.r,e.g,e.b,e.opacity)):new fs}function ds(e,t,n,r){return arguments.length===1?us(e):new fs(e,t,n,r??1)}function fs(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function ps(){return`#`+hs(this.r)+hs(this.g)+hs(this.b)}function ms(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?`rgb(`:`rgba(`)+Math.max(0,Math.min(255,Math.round(this.r)||0))+`, `+Math.max(0,Math.min(255,Math.round(this.g)||0))+`, `+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?`)`:`, `+e+`)`)}function hs(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?`0`:``)+e.toString(16)}function gs(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ys(e,t,n,r)}function _s(e){if(e instanceof ys)return new ys(e.h,e.s,e.l,e.opacity);if(e instanceof rs||(e=ss(e)),!e)return new ys;if(e instanceof ys)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,c=(a+i)/2;return s?(o=t===a?(n-r)/s+(n<r)*6:n===a?(r-t)/s+2:(t-n)/s+4,s/=c<.5?a+i:2-a-i,o*=60):s=c>0&&c<1?0:o,new ys(o,s,c,e.opacity)}function vs(e,t,n,r){return arguments.length===1?_s(e):new ys(e,t,n,r??1)}function ys(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function bs(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var xs,Ss,Cs,ws,Ts,Es,Ds,Os,ks,As,js,Ms,Ns,Ps=o((()=>{ns(),xs=.7,Ss=1/xs,Cs=`\\s*([+-]?\\d+)\\s*`,ws=`\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*`,Ts=`\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*`,Es=/^#([0-9a-f]{3,8})$/,Ds=RegExp(`^rgb\\(`+[Cs,Cs,Cs]+`\\)$`),Os=RegExp(`^rgb\\(`+[Ts,Ts,Ts]+`\\)$`),ks=RegExp(`^rgba\\(`+[Cs,Cs,Cs,ws]+`\\)$`),As=RegExp(`^rgba\\(`+[Ts,Ts,Ts,ws]+`\\)$`),js=RegExp(`^hsl\\(`+[ws,Ts,Ts]+`\\)$`),Ms=RegExp(`^hsla\\(`+[ws,Ts,Ts,ws]+`\\)$`),Ns={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},es(rs,ss,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:is,formatHex:is,formatHsl:as,formatRgb:os,toString:os}),es(fs,ds,ts(rs,{brighter:function(e){return e=e==null?Ss:Ss**+e,new fs(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?xs:xs**+e,new fs(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ps,formatHex:ps,formatRgb:ms,toString:ms})),es(ys,vs,ts(rs,{brighter:function(e){return e=e==null?Ss:Ss**+e,new ys(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?xs:xs**+e,new ys(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new fs(bs(e>=240?e-240:e+120,i,r),bs(e,i,r),bs(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?`hsl(`:`hsla(`)+(this.h||0)+`, `+(this.s||0)*100+`%, `+(this.l||0)*100+`%`+(e===1?`)`:`, `+e+`)`)}}))})),Fs=o((()=>{Ps()}));function Is(e){return typeof e==`string`?!!ss(e):!1}function Ls(e){let t=ss(e),n=[0,0,0,0];return t!=null&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function Rs(e){let t=e&&e[0],n=e&&e[1],r=e&&e[2];return t+n*256+r*65536-1}function zs(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Bs(e){let t=window.document.createElement(`canvas`),n=t.getContext(`2d`);t.width=256,t.height=1;let r=null,i=n.createLinearGradient(0,0,256,1),a=e.positions[0],o=e.positions[e.positions.length-1];for(let t=0;t<e.colors.length;++t){let n=(e.positions[t]-a)/(o-a);i.addColorStop(n,e.colors[t])}return n.fillStyle=i,n.fillRect(0,0,256,1),r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),t=null,n=null,{data:r,width:256,height:1}}function Vs(e,t){let n=window.document.createElement(`canvas`),r=n.getContext(`2d`);n.width=256,n.height=1;let i=r.createLinearGradient(0,0,256,1),a=t[1]-t[0];for(let n=0;n<e.colors.length;++n){let r=Math.max((e.positions[n]-t[0])/a,0);i.addColorStop(r,e.colors[n])}r.fillStyle=i,r.fillRect(0,0,256,1);let o=r.getImageData(0,0,256,1).data,s=Gs(r,o);return n=null,r=null,s}function Hs(e){let t=window.document.createElement(`canvas`),n=t.getContext(`2d`);t.width=256,t.height=1;let r=n.createImageData(256,1);return r.data.fill(0),e.positions.forEach((t,n)=>{let i=Ls(e.colors[n]);r.data[t*4+0]=i[0]*255,r.data[t*4+1]=i[1]*255,r.data[t*4+2]=i[2]*255,r.data[t*4+3]=i[3]*255}),t=null,n=null,r}function Us(e){let t=window.document.createElement(`canvas`),n=t.getContext(`2d`);n.globalAlpha=1,t.width=256,t.height=1;let r=256/e.colors.length;for(let t=0;t<e.colors.length;t++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[t],n.moveTo(t*r,0),n.lineTo((t+1)*r,0),n.stroke();let i=n.getImageData(0,0,256,1).data,a=Gs(n,i);return t=null,n=null,a}function Ws(e,t){let n=window.document.createElement(`canvas`),r=n.getContext(`2d`);r.globalAlpha=1,n.width=256,n.height=1;let i=t[1]-t[0];e.positions.length-e.colors.length!==1&&console.warn(`positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值`);for(let n=0;n<e.colors.length;n++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[n],r.moveTo((e.positions[n]-t[0])/i*255,0),r.lineTo((e.positions[n+1]-t[0])/i*255,0),r.stroke();let a=r.getImageData(0,0,256,1).data,o=Gs(r,a);return n=null,r=null,o}function Gs(e,t){let n=e.createImageData(256,1);for(let e=0;e<n.data.length;e+=4)n.data[e+0]=t[e+0],n.data[e+1]=t[e+1],n.data[e+2]=t[e+2],n.data[e+3]=t[e+3];return n}function Ks(e){switch(e?.type){case`cat`:return[0,255];default:return[0,1]}}var qs=o((()=>{Fs()})),Js=s(((e,t)=>{function n(e,t,n){return e===e&&(n!==void 0&&(e=e<=n?e:n),t!==void 0&&(e=e>=t?e:t)),e}t.exports=n})),Ys=s(((e,t)=>{var n=/\s/;function r(e){for(var t=e.length;t--&&n.test(e.charAt(t)););return t}t.exports=r})),Xs=s(((e,t)=>{var n=Ys(),r=/^\s+/;function i(e){return e&&e.slice(0,n(e)+1).replace(r,``)}t.exports=i})),Zs=s(((e,t)=>{var n=Vn(),r=br(),i=`[object Symbol]`;function a(e){return typeof e==`symbol`||r(e)&&n(e)==i}t.exports=a})),Qs=s(((e,t)=>{var n=Xs(),r=Hn(),i=Zs(),a=NaN,o=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;function u(e){if(typeof e==`number`)return e;if(i(e))return a;if(r(e)){var t=typeof e.valueOf==`function`?e.valueOf():e;e=r(t)?t+``:t}if(typeof e!=`string`)return e===0?e:+e;e=n(e);var u=s.test(e);return u||c.test(e)?l(e.slice(2),u?2:8):o.test(e)?a:+e}t.exports=u})),$s=s(((e,t)=>{var n=Js(),r=Qs();function i(e,t,i){return i===void 0&&(i=t,t=void 0),i!==void 0&&(i=r(i),i=i===i?i:0),t!==void 0&&(t=r(t),t=t===t?t:0),n(r(e),t,i)}t.exports=i})),ec=s(((e,t)=>{var n=Ln();t.exports=function(){return n.Date.now()}})),tc=s(((e,t)=>{var n=Hn(),r=ec(),i=Qs(),a=`Expected a function`,o=Math.max,s=Math.min;function c(e,t,c){var l,u,d,f,p,m,h=0,g=!1,_=!1,v=!0;if(typeof e!=`function`)throw TypeError(a);t=i(t)||0,n(c)&&(g=!!c.leading,_=`maxWait`in c,d=_?o(i(c.maxWait)||0,t):d,v=`trailing`in c?!!c.trailing:v);function y(t){var n=l,r=u;return l=u=void 0,h=t,f=e.apply(r,n),f}function b(e){return h=e,p=setTimeout(C,t),g?y(e):f}function x(e){var n=e-m,r=e-h,i=t-n;return _?s(i,d-r):i}function S(e){var n=e-m,r=e-h;return m===void 0||n>=t||n<0||_&&r>=d}function C(){var e=r();if(S(e))return w(e);p=setTimeout(C,x(e))}function w(e){return p=void 0,v&&l?y(e):(l=u=void 0,f)}function E(){p!==void 0&&clearTimeout(p),h=0,l=m=u=p=void 0}function D(){return p===void 0?f:w(r())}function O(){var e=r(),n=S(e);if(l=arguments,u=this,m=e,n){if(p===void 0)return b(m);if(_)return clearTimeout(p),p=setTimeout(C,t),y(m)}return p===void 0&&(p=setTimeout(C,t)),f}return O.cancel=E,O.flush=D,O}t.exports=c})),nc=s(((e,t)=>{var n=Cr(),r=Zs(),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;function o(e,t){if(n(e))return!1;var o=typeof e;return o==`number`||o==`symbol`||o==`boolean`||e==null||r(e)?!0:a.test(e)||!i.test(e)||t!=null&&e in Object(t)}t.exports=o})),rc=s(((e,t)=>{var n=dr(),r=`Expected a function`;function i(e,t){if(typeof e!=`function`||t!=null&&typeof t!=`function`)throw TypeError(r);var a=function(){var n=arguments,r=t?t.apply(this,n):n[0],i=a.cache;if(i.has(r))return i.get(r);var o=e.apply(this,n);return a.cache=i.set(r,o)||i,o};return a.cache=new(i.Cache||n),a}i.Cache=n,t.exports=i})),ic=s(((e,t)=>{var n=rc(),r=500;function i(e){var t=n(e,function(e){return i.size===r&&i.clear(),e}),i=t.cache;return t}t.exports=i})),ac=s(((e,t)=>{var n=ic(),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g;t.exports=n(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(``),e.replace(r,function(e,n,r,a){t.push(r?a.replace(i,`$1`):n||e)}),t})})),oc=s(((e,t)=>{function n(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}t.exports=n})),sc=s(((e,t)=>{var n=Rn(),r=oc(),i=Cr(),a=Zs(),o=1/0,s=n?n.prototype:void 0,c=s?s.toString:void 0;function l(e){if(typeof e==`string`)return e;if(i(e))return r(e,l)+``;if(a(e))return c?c.call(e):``;var t=e+``;return t==`0`&&1/e==-o?`-0`:t}t.exports=l})),cc=s(((e,t)=>{var n=sc();function r(e){return e==null?``:n(e)}t.exports=r})),lc=s(((e,t)=>{var n=Cr(),r=nc(),i=ac(),a=cc();function o(e,t){return n(e)?e:r(e,t)?[e]:i(a(e))}t.exports=o})),uc=s(((e,t)=>{var n=Zs(),r=1/0;function i(e){if(typeof e==`string`||n(e))return e;var t=e+``;return t==`0`&&1/e==-r?`-0`:t}t.exports=i})),dc=s(((e,t)=>{var n=lc(),r=uc();function i(e,t){t=n(t,e);for(var i=0,a=t.length;e!=null&&i<a;)e=e[r(t[i++])];return i&&i==a?e:void 0}t.exports=i})),fc=s(((e,t)=>{var n=dc();function r(e,t,r){var i=e==null?void 0:n(e,t);return i===void 0?r:i}t.exports=r})),pc=s(((e,t)=>{var n=Vn(),r=br(),i=`[object Boolean]`;function a(e){return e===!0||e===!1||r(e)&&n(e)==i}t.exports=a})),mc=s(((e,t)=>{var n=`__lodash_hash_undefined__`;function r(e){return this.__data__.set(e,n),this}t.exports=r})),hc=s(((e,t)=>{function n(e){return this.__data__.has(e)}t.exports=n})),gc=s(((e,t)=>{var n=dr(),r=mc(),i=hc();function a(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new n;++t<r;)this.add(e[t])}a.prototype.add=a.prototype.push=r,a.prototype.has=i,t.exports=a})),_c=s(((e,t)=>{function n(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}t.exports=n})),vc=s(((e,t)=>{function n(e,t){return e.has(t)}t.exports=n})),yc=s(((e,t)=>{var n=gc(),r=_c(),i=vc(),a=1,o=2;function s(e,t,s,c,l,u){var d=s&a,f=e.length,p=t.length;if(f!=p&&!(d&&p>f))return!1;var m=u.get(e),h=u.get(t);if(m&&h)return m==t&&h==e;var g=-1,_=!0,v=s&o?new n:void 0;for(u.set(e,t),u.set(t,e);++g<f;){var y=e[g],b=t[g];if(c)var x=d?c(b,y,g,t,e,u):c(y,b,g,e,t,u);if(x!==void 0){if(x)continue;_=!1;break}if(v){if(!r(t,function(e,t){if(!i(v,t)&&(y===e||l(y,e,s,c,u)))return v.push(t)})){_=!1;break}}else if(!(y===b||l(y,b,s,c,u))){_=!1;break}}return u.delete(e),u.delete(t),_}t.exports=s})),bc=s(((e,t)=>{function n(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}t.exports=n})),xc=s(((e,t)=>{function n(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}t.exports=n})),Sc=s(((e,t)=>{var n=Rn(),r=li(),i=Tn(),a=yc(),o=bc(),s=xc(),c=1,l=2,u=`[object Boolean]`,d=`[object Date]`,f=`[object Error]`,p=`[object Map]`,m=`[object Number]`,h=`[object RegExp]`,g=`[object Set]`,_=`[object String]`,v=`[object Symbol]`,y=`[object ArrayBuffer]`,b=`[object DataView]`,x=n?n.prototype:void 0,S=x?x.valueOf:void 0;function C(e,t,n,x,C,w,E){switch(n){case b:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case y:return!(e.byteLength!=t.byteLength||!w(new r(e),new r(t)));case u:case d:case m:return i(+e,+t);case f:return e.name==t.name&&e.message==t.message;case h:case _:return e==t+``;case p:var D=o;case g:var O=x&c;if(D||=s,e.size!=t.size&&!O)return!1;var k=E.get(e);if(k)return k==t;x|=l,E.set(e,t);var A=a(D(e),D(t),x,C,w,E);return E.delete(e),A;case v:if(S)return S.call(e)==S.call(t)}return!1}t.exports=C})),Cc=s(((e,t)=>{var n=ti(),r=1,i=Object.prototype.hasOwnProperty;function a(e,t,a,o,s,c){var l=a&r,u=n(e),d=u.length;if(d!=n(t).length&&!l)return!1;for(var f=d;f--;){var p=u[f];if(!(l?p in t:i.call(t,p)))return!1}var m=c.get(e),h=c.get(t);if(m&&h)return m==t&&h==e;var g=!0;c.set(e,t),c.set(t,e);for(var _=l;++f<d;){p=u[f];var v=e[p],y=t[p];if(o)var b=l?o(y,v,p,t,e,c):o(v,y,p,e,t,c);if(!(b===void 0?v===y||s(v,y,a,o,c):b)){g=!1;break}_||=p==`constructor`}if(g&&!_){var x=e.constructor,S=t.constructor;x!=S&&`constructor`in e&&`constructor`in t&&!(typeof x==`function`&&x instanceof x&&typeof S==`function`&&S instanceof S)&&(g=!1)}return c.delete(e),c.delete(t),g}t.exports=a})),wc=s(((e,t)=>{var n=pr(),r=yc(),i=Sc(),a=Cc(),o=si(),s=Cr(),c=Tr(),l=jr(),u=1,d=`[object Arguments]`,f=`[object Array]`,p=`[object Object]`,m=Object.prototype.hasOwnProperty;function h(e,t,h,g,_,v){var y=s(e),b=s(t),x=y?f:o(e),S=b?f:o(t);x=x==d?p:x,S=S==d?p:S;var C=x==p,w=S==p,E=x==S;if(E&&c(e)){if(!c(t))return!1;y=!0,C=!1}if(E&&!C)return v||=new n,y||l(e)?r(e,t,h,g,_,v):i(e,t,x,h,g,_,v);if(!(h&u)){var D=C&&m.call(e,`__wrapped__`),O=w&&m.call(t,`__wrapped__`);if(D||O){var k=D?e.value():e,A=O?t.value():t;return v||=new n,_(k,A,h,g,v)}}return E?(v||=new n,a(e,t,h,g,_,v)):!1}t.exports=h})),Tc=s(((e,t)=>{var n=wc(),r=br();function i(e,t,a,o,s){return e===t?!0:e==null||t==null||!r(e)&&!r(t)?e!==e&&t!==t:n(e,t,a,o,i,s)}t.exports=i})),Ec=s(((e,t)=>{var n=Tc();function r(e,t){return n(e,t)}t.exports=r})),Dc=s(((e,t)=>{function n(e){return e==null}t.exports=n})),Oc=s(((e,t)=>{var n=Vn(),r=br(),i=`[object Number]`;function a(e){return typeof e==`number`||r(e)&&n(e)==i}t.exports=a})),kc=s(((e,t)=>{var n=Vn(),r=Zr(),i=br(),a=`[object Object]`,o=Function.prototype,s=Object.prototype,c=o.toString,l=s.hasOwnProperty,u=c.call(Object);function d(e){if(!i(e)||n(e)!=a)return!1;var t=r(e);if(t===null)return!0;var o=l.call(t,`constructor`)&&t.constructor;return typeof o==`function`&&o instanceof o&&c.call(o)==u}t.exports=d})),Ac=s(((e,t)=>{var n=Vn(),r=Cr(),i=br(),a=`[object String]`;function o(e){return typeof e==`string`||!r(e)&&i(e)&&n(e)==a}t.exports=o})),jc=s(((e,t)=>{var n=gr(),r=Tn();function i(e,t,i){(i!==void 0&&!r(e[t],i)||i===void 0&&!(t in e))&&n(e,t,i)}t.exports=i})),Mc=s(((e,t)=>{function n(e){return function(t,n,r){for(var i=-1,a=Object(t),o=r(t),s=o.length;s--;){var c=o[e?s:++i];if(n(a[c],c,a)===!1)break}return t}}t.exports=n})),Nc=s(((e,t)=>{t.exports=Mc()()})),Pc=s(((e,t)=>{var n=Lr(),r=br();function i(e){return r(e)&&n(e)}t.exports=i})),Fc=s(((e,t)=>{function n(e,t){if(!(t===`constructor`&&typeof e[t]==`function`)&&t!=`__proto__`)return e[t]}t.exports=n})),Ic=s(((e,t)=>{var n=vr(),r=Hr();function i(e){return n(e,r(e))}t.exports=i})),Lc=s(((e,t)=>{var n=jc(),r=Wr(),i=mi(),a=Gr(),o=_i(),s=Sr(),c=Cr(),l=Pc(),u=Tr(),d=Un(),f=Hn(),p=kc(),m=jr(),h=Fc(),g=Ic();function _(e,t,_,v,y,b,x){var S=h(e,_),C=h(t,_),w=x.get(C);if(w){n(e,_,w);return}var E=b?b(S,C,_+``,e,t,x):void 0,D=E===void 0;if(D){var O=c(C),k=!O&&u(C),A=!O&&!k&&m(C);E=C,O||k||A?c(S)?E=S:l(S)?E=a(S):k?(D=!1,E=r(C,!0)):A?(D=!1,E=i(C,!0)):E=[]:p(C)||s(C)?(E=S,s(S)?E=g(S):(!f(S)||d(S))&&(E=o(C))):D=!1}D&&(x.set(C,E),y(E,C,v,b,x),x.delete(C)),n(e,_,E)}t.exports=_})),Rc=s(((e,t)=>{var n=pr(),r=jc(),i=Nc(),a=Lc(),o=Hn(),s=Hr(),c=Fc();function l(e,t,u,d,f){e!==t&&i(t,function(i,s){if(f||=new n,o(i))a(e,t,s,u,l,d,f);else{var p=d?d(c(e,s),i,s+``,e,t,f):void 0;p===void 0&&(p=i),r(e,s,p)}},s)}t.exports=l})),zc=s(((e,t)=>{function n(e){return e}t.exports=n})),Bc=s(((e,t)=>{function n(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}t.exports=n})),Vc=s(((e,t)=>{var n=Bc(),r=Math.max;function i(e,t,i){return t=r(t===void 0?e.length-1:t,0),function(){for(var a=arguments,o=-1,s=r(a.length-t,0),c=Array(s);++o<s;)c[o]=a[t+o];o=-1;for(var l=Array(t+1);++o<t;)l[o]=a[o];return l[t]=i(c),n(e,this,l)}}t.exports=i})),Hc=s(((e,t)=>{function n(e){return function(){return e}}t.exports=n})),Uc=s(((e,t)=>{var n=Hc(),r=hr(),i=zc();t.exports=r?function(e,t){return r(e,`toString`,{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:i})),Wc=s(((e,t)=>{var n=800,r=16,i=Date.now;function a(e){var t=0,a=0;return function(){var o=i(),s=r-(o-a);if(a=o,s>0){if(++t>=n)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}t.exports=a})),Gc=s(((e,t)=>{var n=Uc();t.exports=Wc()(n)})),Kc=s(((e,t)=>{var n=zc(),r=Vc(),i=Gc();function a(e,t){return i(r(e,t,n),e+``)}t.exports=a})),qc=s(((e,t)=>{var n=Tn(),r=Lr(),i=Er(),a=Hn();function o(e,t,o){if(!a(o))return!1;var s=typeof t;return(s==`number`?r(o)&&i(t,o.length):s==`string`&&t in o)?n(o[t],e):!1}t.exports=o})),Jc=s(((e,t)=>{var n=Kc(),r=qc();function i(e){return n(function(t,n){var i=-1,a=n.length,o=a>1?n[a-1]:void 0,s=a>2?n[2]:void 0;for(o=e.length>3&&typeof o==`function`?(a--,o):void 0,s&&r(n[0],n[1],s)&&(o=a<3?void 0:o,a=1),t=Object(t);++i<a;){var c=n[i];c&&e(t,c,i,o)}return t})}t.exports=i})),Yc=s(((e,t)=>{var n=Rc();t.exports=Jc()(function(e,t,r){n(e,t,r)})})),Xc=s(((e,t)=>{var n=Rc();t.exports=Jc()(function(e,t,r,i){n(e,t,r,i)})})),Zc=s(((e,t)=>{function n(e,t,n,r){for(var i=e.length,a=n+(r?1:-1);r?a--:++a<i;)if(t(e[a],a,e))return a;return-1}t.exports=n})),Qc=s(((e,t)=>{function n(e){return e!==e}t.exports=n})),$c=s(((e,t)=>{function n(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}t.exports=n})),el=s(((e,t)=>{var n=Zc(),r=Qc(),i=$c();function a(e,t,a){return t===t?i(e,t,a):n(e,r,a)}t.exports=a})),tl=s(((e,t)=>{function n(e,t,n,r){for(var i=n-1,a=e.length;++i<a;)if(r(e[i],t))return i;return-1}t.exports=n})),nl=s(((e,t)=>{var n=oc(),r=el(),i=tl(),a=kr(),o=Gr(),s=Array.prototype.splice;function c(e,t,c,l){var u=l?i:r,d=-1,f=t.length,p=e;for(e===t&&(t=o(t)),c&&(p=n(e,a(c)));++d<f;)for(var m=0,h=t[d],g=c?c(h):h;(m=u(p,g,m,l))>-1;)p!==e&&s.call(p,m,1),s.call(e,m,1);return e}t.exports=c})),rl=s(((e,t)=>{var n=nl();function r(e,t){return e&&e.length&&t&&t.length?n(e,t):e}t.exports=r})),il=s(((e,t)=>{t.exports=Kc()(rl())})),al=s(((e,t)=>{var n=tc(),r=Hn(),i=`Expected a function`;function a(e,t,a){var o=!0,s=!0;if(typeof e!=`function`)throw TypeError(i);return r(a)&&(o=`leading`in a?!!a.leading:o,s=`trailing`in a?!!a.trailing:s),n(e,t,{leading:o,maxWait:t,trailing:s})}t.exports=a})),ol=s(((e,t)=>{var n=el();function r(e,t){return!!(e!=null&&e.length)&&n(e,t,0)>-1}t.exports=r})),sl=s(((e,t)=>{function n(e,t,n){for(var r=-1,i=e==null?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}t.exports=n})),cl=s(((e,t)=>{function n(){}t.exports=n})),ll=s(((e,t)=>{var n=ai(),r=cl(),i=xc();t.exports=n&&1/i(new n([,-0]))[1]==1/0?function(e){return new n(e)}:r})),ul=s(((e,t)=>{var n=gc(),r=ol(),i=sl(),a=vc(),o=ll(),s=xc(),c=200;function l(e,t,l){var u=-1,d=r,f=e.length,p=!0,m=[],h=m;if(l)p=!1,d=i;else if(f>=c){var g=t?null:o(e);if(g)return s(g);p=!1,d=a,h=new n}else h=t?[]:m;outer:for(;++u<f;){var _=e[u],v=t?t(_):_;if(_=l||_!==0?_:0,p&&v===v){for(var y=h.length;y--;)if(h[y]===v)continue outer;t&&h.push(v),m.push(_)}else d(h,v,l)||(h!==m&&h.push(v),m.push(_))}return m}t.exports=l})),dl=s(((e,t)=>{var n=ul();function r(e){return e&&e.length?n(e):[]}t.exports=r})),fl=s(((e,t)=>{function n(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(i);++r<i;)a[r]=e[r+t];return a}t.exports=n})),pl=s(((e,t)=>{var n=fl();function r(e,t,r){var i=e.length;return r=r===void 0?i:r,!t&&r>=i?e:n(e,t,r)}t.exports=r})),ml=s(((e,t)=>{var n=RegExp(`[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]`);function r(e){return n.test(e)}t.exports=r})),hl=s(((e,t)=>{function n(e){return e.split(``)}t.exports=n})),gl=s(((e,t)=>{var n=`\\ud800-\\udfff`,r=`\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff`,i=`\\ufe0e\\ufe0f`,a=`[`+n+`]`,o=`[`+r+`]`,s=`\\ud83c[\\udffb-\\udfff]`,c=`(?:`+o+`|`+s+`)`,l=`[^`+n+`]`,u=`(?:\\ud83c[\\udde6-\\uddff]){2}`,d=`[\\ud800-\\udbff][\\udc00-\\udfff]`,f=`\\u200d`,p=c+`?`,m=`[`+i+`]?`,h=`(?:`+f+`(?:`+[l,u,d].join(`|`)+`)`+m+p+`)*`,g=m+p+h,_=`(?:`+[l+o+`?`,o,u,d,a].join(`|`)+`)`,v=RegExp(s+`(?=`+s+`)|`+_+g,`g`);function y(e){return e.match(v)||[]}t.exports=y})),_l=s(((e,t)=>{var n=hl(),r=ml(),i=gl();function a(e){return r(e)?i(e):n(e)}t.exports=a})),vl=s(((e,t)=>{var n=pl(),r=ml(),i=_l(),a=cc();function o(e){return function(t){t=a(t);var o=r(t)?i(t):void 0,s=o?o[0]:t.charAt(0),c=o?n(o,1).join(``):t.slice(1);return s[e]()+c}}t.exports=o})),yl=s(((e,t)=>{t.exports=vl()(`toUpperCase`)})),bl=s(((e,t)=>{function n(e){return e===void 0}t.exports=n})),xl=s(((e,t)=>{var n=cc(),r=yl();function i(e){return r(n(e).toLowerCase())}t.exports=i})),Sl=s(((e,t)=>{function n(e,t,n,r){var i=-1,a=e==null?0:e.length;for(r&&a&&(n=e[++i]);++i<a;)n=t(n,e[i],i,e);return n}t.exports=n})),Cl=s(((e,t)=>{function n(e){return function(t){return e?.[t]}}t.exports=n})),wl=s(((e,t)=>{t.exports=Cl()({À:`A`,Á:`A`,Â:`A`,Ã:`A`,Ä:`A`,Å:`A`,à:`a`,á:`a`,â:`a`,ã:`a`,ä:`a`,å:`a`,Ç:`C`,ç:`c`,Ð:`D`,ð:`d`,È:`E`,É:`E`,Ê:`E`,Ë:`E`,è:`e`,é:`e`,ê:`e`,ë:`e`,Ì:`I`,Í:`I`,Î:`I`,Ï:`I`,ì:`i`,í:`i`,î:`i`,ï:`i`,Ñ:`N`,ñ:`n`,Ò:`O`,Ó:`O`,Ô:`O`,Õ:`O`,Ö:`O`,Ø:`O`,ò:`o`,ó:`o`,ô:`o`,õ:`o`,ö:`o`,ø:`o`,Ù:`U`,Ú:`U`,Û:`U`,Ü:`U`,ù:`u`,ú:`u`,û:`u`,ü:`u`,Ý:`Y`,ý:`y`,ÿ:`y`,Æ:`Ae`,æ:`ae`,Þ:`Th`,þ:`th`,ß:`ss`,Ā:`A`,Ă:`A`,Ą:`A`,ā:`a`,ă:`a`,ą:`a`,Ć:`C`,Ĉ:`C`,Ċ:`C`,Č:`C`,ć:`c`,ĉ:`c`,ċ:`c`,č:`c`,Ď:`D`,Đ:`D`,ď:`d`,đ:`d`,Ē:`E`,Ĕ:`E`,Ė:`E`,Ę:`E`,Ě:`E`,ē:`e`,ĕ:`e`,ė:`e`,ę:`e`,ě:`e`,Ĝ:`G`,Ğ:`G`,Ġ:`G`,Ģ:`G`,ĝ:`g`,ğ:`g`,ġ:`g`,ģ:`g`,Ĥ:`H`,Ħ:`H`,ĥ:`h`,ħ:`h`,Ĩ:`I`,Ī:`I`,Ĭ:`I`,Į:`I`,İ:`I`,ĩ:`i`,ī:`i`,ĭ:`i`,į:`i`,ı:`i`,Ĵ:`J`,ĵ:`j`,Ķ:`K`,ķ:`k`,ĸ:`k`,Ĺ:`L`,Ļ:`L`,Ľ:`L`,Ŀ:`L`,Ł:`L`,ĺ:`l`,ļ:`l`,ľ:`l`,ŀ:`l`,ł:`l`,Ń:`N`,Ņ:`N`,Ň:`N`,Ŋ:`N`,ń:`n`,ņ:`n`,ň:`n`,ŋ:`n`,Ō:`O`,Ŏ:`O`,Ő:`O`,ō:`o`,ŏ:`o`,ő:`o`,Ŕ:`R`,Ŗ:`R`,Ř:`R`,ŕ:`r`,ŗ:`r`,ř:`r`,Ś:`S`,Ŝ:`S`,Ş:`S`,Š:`S`,ś:`s`,ŝ:`s`,ş:`s`,š:`s`,Ţ:`T`,Ť:`T`,Ŧ:`T`,ţ:`t`,ť:`t`,ŧ:`t`,Ũ:`U`,Ū:`U`,Ŭ:`U`,Ů:`U`,Ű:`U`,Ų:`U`,ũ:`u`,ū:`u`,ŭ:`u`,ů:`u`,ű:`u`,ų:`u`,Ŵ:`W`,ŵ:`w`,Ŷ:`Y`,ŷ:`y`,Ÿ:`Y`,Ź:`Z`,Ż:`Z`,Ž:`Z`,ź:`z`,ż:`z`,ž:`z`,Ĳ:`IJ`,ĳ:`ij`,Œ:`Oe`,œ:`oe`,ŉ:`'n`,ſ:`s`})})),Tl=s(((e,t)=>{var n=wl(),r=cc(),i=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a=RegExp(`[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]`,`g`);function o(e){return e=r(e),e&&e.replace(i,n).replace(a,``)}t.exports=o})),El=s(((e,t)=>{var n=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function r(e){return e.match(n)||[]}t.exports=r})),Dl=s(((e,t)=>{var n=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function r(e){return n.test(e)}t.exports=r})),Ol=s(((e,t)=>{var n=`\\ud800-\\udfff`,r=`\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff`,i=`\\u2700-\\u27bf`,a=`a-z\\xdf-\\xf6\\xf8-\\xff`,o=`\\xac\\xb1\\xd7\\xf7`,s=`\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf`,c=`\\u2000-\\u206f`,l=` \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000`,u=`A-Z\\xc0-\\xd6\\xd8-\\xde`,d=`\\ufe0e\\ufe0f`,f=o+s+c+l,p=`['’]`,m=`[`+f+`]`,h=`[`+r+`]`,g=`\\d+`,_=`[`+i+`]`,v=`[`+a+`]`,y=`[^`+n+f+g+i+a+u+`]`,b=`(?:`+h+`|\\ud83c[\\udffb-\\udfff])`,x=`[^`+n+`]`,S=`(?:\\ud83c[\\udde6-\\uddff]){2}`,C=`[\\ud800-\\udbff][\\udc00-\\udfff]`,w=`[`+u+`]`,E=`\\u200d`,D=`(?:`+v+`|`+y+`)`,O=`(?:`+w+`|`+y+`)`,k=`(?:`+p+`(?:d|ll|m|re|s|t|ve))?`,A=`(?:`+p+`(?:D|LL|M|RE|S|T|VE))?`,j=b+`?`,M=`[`+d+`]?`,N=`(?:`+E+`(?:`+[x,S,C].join(`|`)+`)`+M+j+`)*`,P=`\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])`,F=`\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])`,I=M+j+N,ee=`(?:`+[_,S,C].join(`|`)+`)`+I,R=RegExp([w+`?`+v+`+`+k+`(?=`+[m,w,`$`].join(`|`)+`)`,O+`+`+A+`(?=`+[m,w+D,`$`].join(`|`)+`)`,w+`?`+D+`+`+k,w+`+`+A,F,P,g,ee].join(`|`),`g`);function z(e){return e.match(R)||[]}t.exports=z})),kl=s(((e,t)=>{var n=El(),r=Dl(),i=cc(),a=Ol();function o(e,t,o){return e=i(e),t=o?void 0:t,t===void 0?r(e)?a(e):n(e):e.match(t)||[]}t.exports=o})),Al=s(((e,t)=>{var n=Sl(),r=Tl(),i=kl(),a=RegExp(`['’]`,`g`);function o(e){return function(t){return n(i(r(t).replace(a,``)),e,``)}}t.exports=o})),jl=s(((e,t)=>{var n=xl();t.exports=Al()(function(e,t,r){return t=t.toLowerCase(),e+(r?n(t):t)})})),Ml=s(((e,t)=>{var n=cc(),r=0;function i(e){var t=++r;return n(e)+t}t.exports=i})),Nl,Pl,Fl,Il,Ll,Rl,zl,Bl,Vl,Hl,Ul,Wl,Gl,Kl,ql,Jl,Yl,Xl,Zl,Ql,$l,eu,tu,nu=o((()=>{Nl=u($s()),Pl=u(Ci()),Fl=u(tc()),Il=u(fc()),Ll=u(pc()),Rl=u(Ec()),zl=u(Dc()),Bl=u(Oc()),Vl=u(kc()),Hl=u(Ac()),Ul=u(jr()),Wl=u(Yc()),Gl=u(Xc()),Kl=u(il()),ql=u(al()),Jl=u(dl()),Yl=u(yl()),Xl=u(Un()),Zl=u(Hn()),Ql=u(bl()),$l=u(jl()),eu=u(Ml()),tu={isNil:zl.default,merge:Wl.default,throttle:ql.default,isString:Hl.default,debounce:Fl.default,pull:Kl.default,isTypedArray:Ul.default,isPlainObject:Vl.default,isNumber:Bl.default,isBoolean:Ll.default,isEqual:Rl.default,cloneDeep:Pl.default,uniq:Jl.default,clamp:Nl.default,upperFirst:Yl.default,get:Il.default,mergeWith:Gl.default,isFunction:Xl.default,isObject:Zl.default,isUndefined:Ql.default,camelCase:$l.default,uniqueId:eu.default}})),ru=c({DPR:()=>Nu,addClass:()=>uu,addStyle:()=>xu,appendElementType:()=>ku,clearChildren:()=>Du,create:()=>cu,css2Style:()=>wu,empty:()=>gu,findParentElement:()=>Au,getClass:()=>hu,getContainer:()=>iu,getDiffRect:()=>Tu,getStyleList:()=>Su,getViewPortScale:()=>bu,hasClass:()=>fu,printCanvas:()=>yu,remove:()=>lu,removeClass:()=>du,removeStyle:()=>Cu,setChecked:()=>Eu,setClass:()=>pu,setTransform:()=>_u,setUnDraggable:()=>Ou,splitWords:()=>ou,toggleClass:()=>mu,triggerResize:()=>vu,trim:()=>au});function iu(e){let t=e;return typeof e==`string`&&(t=window.document.getElementById(e)),t}function au(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,``)}function ou(e){return au(e).split(/\s+/)}function su(e){let t=(document==null?void 0:document.documentElement)?.style;if(!t)return e[0];for(let n in e)if(e[n]&&e[n]in t)return e[n];return e[0]}function cu(e,t,n){let r=window.document.createElement(e);return t&&(r.className=t||``),n&&n.appendChild(r),r}function lu(e){let t=e.parentNode;t&&t.removeChild(e)}function uu(e,t){if(e.classList!==void 0){let n=ou(t);for(let t=0,r=n.length;t<r;t++)e.classList.add(n[t])}else if(!fu(e,t)){let n=hu(e);pu(e,(n?n+` `:``)+t)}}function du(e,t){e.classList===void 0?pu(e,au((` `+hu(e)+` `).replace(` `+t+` `,` `))):ou(t).forEach(t=>{e.classList.remove(t)})}function fu(e,t){if(e.classList!==void 0)return e.classList.contains(t);let n=hu(e);return n.length>0&&RegExp(`(^|\\s)`+t+`(\\s|$)`).test(n)}function pu(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function mu(e,t,n){n===void 0?fu(e,t)?du(e,t):uu(e,t):n?uu(e,t):du(e,t)}function hu(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function gu(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}function _u(e,t){e.style[Mu]=t}function vu(){if(typeof Event==`function`)window.dispatchEvent(new Event(`resize`));else{let e=window.document.createEvent(`UIEvents`);e.initUIEvent(`resize`,!0,!1,window,0),window.dispatchEvent(e)}}function yu(e){let t=[`padding: `+(e.height/2-8)+`px `+e.width/2+`px;`,`line-height: `+e.height+`px;`,`background-image: url(`+e.toDataURL()+`);`];console.log(`%c
`,t.join(``))}function bu(){let e=window.document.querySelector(`meta[name="viewport"]`);if(!e)return 1;let t=(e.content?.split(`,`)).find(e=>{let[t]=e.split(`=`);return t===`initial-scale`});return t?t.split(`=`)[1]*1:1}function xu(e,t){e.setAttribute(`style`,`${e.style.cssText}${t}`)}function Su(e){return e.split(`;`).map(e=>e.trim()).filter(e=>e)}function Cu(e,t){let n=ju(Su(e.getAttribute(`style`)??``),...Su(t));e.setAttribute(`style`,n.join(`;`))}function wu(e){return Object.entries(e).map(([e,t])=>`${e}: ${t}`).join(`;`)}function Tu(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function Eu(e,t){e.checked=t,t?e.setAttribute(`checked`,`true`):e.removeAttribute(`checked`)}function Du(e){e.innerHTML=``}function Ou(e){e.setAttribute(`draggable`,`false`)}function ku(e,t){if(typeof t==`string`){let n=document.createElement(`div`);for(n.innerHTML=t;n.firstChild;)e.append(n.firstChild)}else Array.isArray(t)?e.append(...t):e.append(t)}function Au(e,t){let n=Array.isArray(t)?t:[t],r=e;for(;r instanceof Element&&r!==window.document.body;){if(n.find(e=>r?.matches(e)))return r;r=r?.parentElement??null}}var ju,Mu,Nu,Pu=o((()=>{nu(),{pull:ju}=tu,Mu=su([`transform`,`WebkitTransform`]),Nu=bu()<1?1:window.devicePixelRatio}));function Fu(e){return typeof ImageBitmap<`u`&&e instanceof ImageBitmap}function Iu(){return typeof importScripts==`function`}function Lu(){let e=zu,t=[`Android`,`iPhone`,`SymbianOS`,`Windows Phone`,`iPad`,`iPod`],n=!0;for(let r of t)if(e.indexOf(r)>0){n=!1;break}return n}var Ru,zu,Bu,Vu,Hu=o((()=>{Ru=Iu()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol===`blob:`?window.parent:window).location.href,zu=navigator==null?void 0:navigator.userAgent,Bu=!!zu.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Vu=zu.indexOf(`Android`)>-1||zu.indexOf(`Adr`)>-1}));function Uu(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}var Wu,Gu=o((()=>{Wu=class{constructor(e=16){this.duration=16,this.timestamp=new Date().getTime(),this.duration=e}run(e){let t=new Date().getTime(),n=t-this.timestamp;this.timestamp=t,n>=this.duration&&e()}}}));function Ku(e,t,n){n===void 0&&(n={});var r={type:`Feature`};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function qu(e,t,n){n===void 0&&(n={});for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a.length<4)throw Error(`Each LinearRing of a Polygon must have 4 or more Positions.`);for(var o=0;o<a[a.length-1].length;o++)if(a[a.length-1][o]!==a[0][o])throw Error(`First and last Position are not equivalent.`)}return Ku({type:`Polygon`,coordinates:e},t,n)}function Ju(e,t,n){if(n===void 0&&(n={}),e.length<2)throw Error(`coordinates must be an array of two or more positions`);return Ku({type:`LineString`,coordinates:e},t,n)}function Yu(e,t){t===void 0&&(t={});var n={type:`FeatureCollection`};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function Xu(e,t,n){return n===void 0&&(n={}),Ku({type:`MultiPolygon`,coordinates:e},t,n)}function Zu(e,t){t===void 0&&(t=`kilometers`);var n=td[t];if(!n)throw Error(t+` units is invalid`);return e*n}function Qu(e){return e%(2*Math.PI)*180/Math.PI}function $u(e){return e%360*Math.PI/180}var ed,td,nd=o((()=>{ed=6371008.8,td={centimeters:ed*100,centimetres:ed*100,degrees:ed/111325,feet:ed*3.28084,inches:ed*39.37,kilometers:ed/1e3,kilometres:ed/1e3,meters:ed,metres:ed,miles:ed/1609.344,millimeters:ed*1e3,millimetres:ed*1e3,nauticalmiles:ed/1852,radians:1,yards:ed*1.0936},1/ed}));function rd(e,t,n){if(e!==null)for(var r,i,a,o,s,c,l,u=0,d=0,f,p=e.type,m=p===`FeatureCollection`,h=p===`Feature`,g=m?e.features.length:1,_=0;_<g;_++){l=m?e.features[_].geometry:h?e.geometry:e,f=l?l.type===`GeometryCollection`:!1,s=f?l.geometries.length:1;for(var v=0;v<s;v++){var y=0,b=0;if(o=f?l.geometries[v]:l,o!==null){c=o.coordinates;var x=o.type;switch(u=n&&(x===`Polygon`||x===`MultiPolygon`)?1:0,x){case null:break;case`Point`:if(t(c,d,_,y,b)===!1)return!1;d++,y++;break;case`LineString`:case`MultiPoint`:for(r=0;r<c.length;r++){if(t(c[r],d,_,y,b)===!1)return!1;d++,x===`MultiPoint`&&y++}x===`LineString`&&y++;break;case`Polygon`:case`MultiLineString`:for(r=0;r<c.length;r++){for(i=0;i<c[r].length-u;i++){if(t(c[r][i],d,_,y,b)===!1)return!1;d++}x===`MultiLineString`&&y++,x===`Polygon`&&b++}x===`Polygon`&&y++;break;case`MultiPolygon`:for(r=0;r<c.length;r++){for(b=0,i=0;i<c[r].length;i++){for(a=0;a<c[r][i].length-u;a++){if(t(c[r][i][a],d,_,y,b)===!1)return!1;d++}b++}y++}break;case`GeometryCollection`:for(r=0;r<o.geometries.length;r++)if(rd(o.geometries[r],t,n)===!1)return!1;break;default:throw Error(`Unknown Geometry Type`)}}}}}function id(e,t){var n,r,i,a,o,s,c,l,u,d,f=0,p=e.type===`FeatureCollection`,m=e.type===`Feature`,h=p?e.features.length:1;for(n=0;n<h;n++){for(s=p?e.features[n].geometry:m?e.geometry:e,l=p?e.features[n].properties:m?e.properties:{},u=p?e.features[n].bbox:m?e.bbox:void 0,d=p?e.features[n].id:m?e.id:void 0,c=s?s.type===`GeometryCollection`:!1,o=c?s.geometries.length:1,i=0;i<o;i++){if(a=c?s.geometries[i]:s,a===null){if(t(null,f,l,u,d)===!1)return!1;continue}switch(a.type){case`Point`:case`LineString`:case`MultiPoint`:case`Polygon`:case`MultiLineString`:case`MultiPolygon`:if(t(a,f,l,u,d)===!1)return!1;break;case`GeometryCollection`:for(r=0;r<a.geometries.length;r++)if(t(a.geometries[r],f,l,u,d)===!1)return!1;break;default:throw Error(`Unknown Geometry Type`)}}f++}}function ad(e,t){id(e,function(e,n,r,i,a){var o=e===null?null:e.type;switch(o){case null:case`Point`:case`LineString`:case`Polygon`:return t(Ku(e,r,{bbox:i,id:a}),n,0)===!1?!1:void 0}var s;switch(o){case`MultiPoint`:s=`Point`;break;case`MultiLineString`:s=`LineString`;break;case`MultiPolygon`:s=`Polygon`;break}for(var c=0;c<e.coordinates.length;c++){var l=e.coordinates[c];if(t(Ku({type:s,coordinates:l},r),n,c)===!1)return!1}})}var od=o((()=>{nd()}));function sd(e){var t=[1/0,1/0,-1/0,-1/0];return rd(e,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}var cd=o((()=>{od(),sd.default=sd}));function ld(e){return typeof e==`number`}function ud(e){return e-Math.fround(e)}var dd=o((()=>{}));function fd(e,t){let[n,r,i,a]=t;return e.lng>n&&e.lng<=i&&e.lat>r&&e.lat<=a}function pd(e){let t=[1/0,1/0,-1/0,-1/0];return e.forEach(e=>{let{coordinates:n}=e;md(t,n)}),t}function md(e,t){return Array.isArray(t[0])?t.forEach(t=>{md(e,t)}):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function hd(e,t){return gd(e,t)}function gd(e,t){return Array.isArray(e[0])?e.map(e=>gd(e,t)):t(e)}function _d(e,t=!0,n={enable:!0,decimal:1}){e=xd(e,t);let r=e[0],i=e[1],a=r*Vd/180,o=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return o=o*Vd/180,n.enable&&(a=Number(a.toFixed(n.decimal)),o=Number(o.toFixed(n.decimal))),e.length===3?[a,o,e[2]]:[a,o]}function vd(e,t=6){let n=e[0],r=e[1],i=n/Vd*180,a=r/Vd*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),t!=null&&(i=Number(i.toFixed(t)),a=Number(a.toFixed(t))),e.length===3?[i,a,e[2]]:[i,a]}function yd(e){if(e==null)throw Error(`lng is required`);return(e>180||e<-180)&&(e%=360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function bd(e){if(e==null)throw Error(`lat is required`);return(e>90||e<-90)&&(e%=180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function xd(e,t){if(t===!1)return e;let n=yd(e[0]),r=bd(e[1]);return r>85&&(r=85),r<-85&&(r=-85),e.length===3?[n,r,e[2]]:[n,r]}function Sd(e){let t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,a=e[0]*i,o=n*i;o=Math.log(Math.tan(Math.PI/4+o/2));let s=.5/Math.PI,c=-.5/Math.PI;return i=.5,a=r*(s*a+.5),o=r*(c*o+i),[Math.floor(a),Math.floor(o)]}function Cd(e){let t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=256<<20,[a,o]=e;a=(a/i-.5)/t,o=(o/i-r)/n,o=(Math.atan(Math.E**+o)-Math.PI/4)*2,r=Math.PI/180;let s=o/r;return[a/r,s]}function wd(e,t){let n=85.0511287798,r=Math.PI/180,i=6378137;return t=Math.max(Math.min(n,t),-n),e*=r,t*=r,t=Math.log(Math.tan(Math.PI/4+t/2)),[e*i,t*i]}function Td(e,t){let n=Math.PI/180,r=6378137;return[e/r/n,2*(Math.atan(Math.exp(t/r))-Math.PI/4)/n]}function Ed(e,t,n){let r=$u(t[1]-e[1]),i=$u(t[0]-e[0]),a=$u(e[1]),o=$u(t[1]),s=Math.sin(r/2)**2+Math.sin(i/2)**2*Math.cos(a)*Math.cos(o);return Zu(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),n=`meters`)}function Dd(e){let t=Math.PI/180,n=85.0511287798,r=6378137,i=Math.max(Math.min(n,e[1]),-n),a=Math.sin(i*t);return[r*e[0]*t,r*Math.log((1+a)/(1-a))/2]}function Od(e,t){let n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function kd(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Ad(e){return[[e[0],e[1]],[e[2],e[3]]]}function jd(e){let t=Md(e,[0,0]);return[e[0]/t,e[1]/t]}function Md(e,t){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)}function Nd(e,t){return e[0]*t[0]+e[1]*t[1]}function Pd(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Fd(e,t){return Math.acos(Nd(e,t)/(Pd(e)*Pd(t)))*180/Math.PI}function Id(e,t){return t[0]>0?t[1]>0?90-Math.atan(t[1]/t[0])*180/Math.PI:90+Math.atan(-t[1]/t[0])*180/Math.PI:t[1]<0?180+(90-Math.atan(t[1]/t[0])*180/Math.PI):270+Math.atan(t[1]/-t[0])*180/Math.PI}function Ld(e,t=100){if(!e||e.length<2)return;let n=[0,1],r=0,i=[];for(let t=0;t<e.length-1;t++){let a=e[t],o=e[t+1],s=Md(a,o);r+=s;let c=Id(n,[a[0]-o[0],a[1]-o[1]]);if(t>0){let e=i[t-1].rotation;e-c>360-e+c&&(c+=360)}i.push({start:a,end:o,dis:s,rotation:c,duration:0})}return i.map(e=>{e.duration=t*(e.dis/r)}),i}function Rd(e){if(ld(e[0]))return e;if(ld(e[0][0]))throw Error(`当前数据不支持标注`);if(ld(e[0][0][0])){let t=e,n=0,r=0,i=0;return t.forEach(e=>{e.forEach(e=>{n+=e[0],r+=e[1],i++})}),[n/i,r/i,0]}else throw Error(`当前数据不支持标注`)}function zd(e){let t=e[0],n=e[1],r=e[0],i=e[1],a=0,o=0,s=0;for(let c=0;c<e.length;c+=2){let l=e[c],u=e[c+1];l&&u&&(t=Math.max(l,t),n=Math.max(u,n),r=Math.min(l,r),i=Math.min(u,i),a+=l,o+=u,s++)}return{center:[a/s,o/s],radius:Math.sqrt((t-r)**2+(n-i)**2)/2}}function Bd(e){return sd(Yu([Ju(e)]))}var Vd,Hd=o((()=>{cd(),nd(),dd(),Vd=2*Math.PI*6378137/2}));function Ud(e){let t=0;e+=`x`;for(let n=0;n<e.length;n++)t>65745979961613&&(t=Math.floor(t/137)),t=t*131+e.charCodeAt(n);return t}function Wd(e){e=e.toString();let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return t>>>0}function Gd(){return`xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`.replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e===`x`?t:t&3|8).toString(16)})}var Kd=o((()=>{}));function qd(e,t,n,r,i=30,a){let o=n;return a&&(o=Math.round(n*(i-1))/(i-1)),r?Zd(e,t,o,r):Zd(e,t,o,.314)}function Jd(e,t){let n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function Yd(e,t){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)}function Xd(e,t,n){let r=[t[0]-e[0],t[1]-e[1]],i=Yd(r,[0,0]),a=Math.atan2(r[1],r[0]),o=i/2/Math.cos(n),s=a+n;return[o*Math.cos(s)+e[0],o*Math.sin(s)+e[1]]}function Zd(e,t,n,r){let i=Xd(e,t,r),a=[e[0],i[0],t[0]],o=[e[1],i[1],t[1]];return[Jd(a,n),Jd(o,n),0]}var Qd=o((()=>{}));function $d(e,t,n,r,i=30,a){let o=n;return a&&(o=Math.round(n*29)/29),tf(e,t,o)}function ef(e,t){let n=[e[0]-t[0],e[1]-t[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],i=r[1]*r[1]+Math.cos(e[1])*Math.cos(t[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function tf(e,t,n){let r=[$u(e[0]),$u(e[1])],i=[$u(t[0]),$u(t[1])],a=ef(r,i);if(Math.abs(a-Math.PI)<.001)return[(1-n)*r[0]+n*i[0],(1-n)*r[1]+n*i[1]];let o=Math.sin((1-n)*a)/Math.sin(a),s=Math.sin(n*a)/Math.sin(a),c=[Math.sin(r[0]),Math.sin(r[1])],l=[Math.cos(r[0]),Math.cos(r[1])],u=[Math.sin(i[0]),Math.sin(i[1])],d=[Math.cos(i[0]),Math.cos(i[1])],f=o*l[1]*l[0]+s*d[1]*d[0],p=o*l[1]*c[0]+s*d[1]*u[0],m=o*c[1]+s*u[1];return[Qu(Math.atan2(p,f)),Qu(Math.atan2(m,Math.sqrt(f*f+p*p)))]}var nf=o((()=>{nd()}));function rf(e,t){let n=0,r=[];for(let t=0;t<e.length-1;t++){let i=e[t],a=e[t+1],o=of(i,a),s=n;n+=o,r.push({p1:i,p2:a,totalDistance:n,distance:o,lastTotalDistance:s})}let i=n*t,a,o;for(let e of r)if(e.totalDistance>i){let t=e.p1,n=e.p2,r=af(n,t,(i-e.lastTotalDistance)/e.distance);a=r[0],o=r[1];break}return{lng:a,lat:o,height:0}}function af(e,t,n){return[e[0]*n+t[0]*(1-n),e[1]*n+t[1]*(1-n)]}function of(e,t){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)}var sf=o((()=>{}));function cf(e,t){let{featureId:n}=t,r=e.data.dataArray;return typeof n==`number`&&(r=r.filter(({id:e})=>e===n)),r.map(e=>{let n=uf(e,t);return gf(gf({},e),n)})}function lf(e,t){return new Promise(n=>{e.inited?n(cf(e,t)):e.once(`update`,()=>{n(cf(e,t))})})}function uf(e,t){let{offset:n,shape:r,thetaOffset:i,segmentNumber:a=30,autoFit:o=!0}=t,{coordinates:s}=e;if(r===`line`)return rf(s,n);let c=s[0],l=s[1],u=typeof i==`string`?e[i]||0:i,d;switch(r){case`arc`:d=qd;break;case`greatcircle`:d=$d;break;default:d=qd}let[f,p,m]=d(c,l,n,u,a,o);return{lng:f,lat:p,height:m}}var df,ff,pf,mf,hf,gf,_f=o((()=>{Qd(),nf(),sf(),df=Object.defineProperty,ff=Object.getOwnPropertySymbols,pf=Object.prototype.hasOwnProperty,mf=Object.prototype.propertyIsEnumerable,hf=(e,t,n)=>t in e?df(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,gf=(e,t)=>{for(var n in t||={})pf.call(t,n)&&hf(e,n,t[n]);if(ff)for(var n of ff(t))mf.call(t,n)&&hf(e,n,t[n]);return e}})),vf,yf=o((()=>{vf=class{constructor(e=50,t){this.limit=e,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}clear(){this.order.forEach(e=>{this.delete(e)}),this.cache={},this.order=[]}get(e){let t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}set(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}delete(e){let t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}deleteCache(e){delete this.cache[e]}deleteOrder(e){let t=this.order.findIndex(t=>t===e);t>=0&&this.order.splice(t,1)}appendOrder(e){this.order.push(e)}defaultDestroy(e,t){return null}}})),bf=c({getColumn:()=>Ef,getSatByColumn:()=>Df,max:()=>xf,mean:()=>wf,min:()=>Sf,mode:()=>Tf,statMap:()=>Of,sum:()=>Cf});function xf(e){if(e.length===0)throw Error(`max requires at least one data point`);let t=e[0];for(let n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t*1}function Sf(e){if(e.length===0)throw Error(`min requires at least one data point`);let t=e[0];for(let n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t*1}function Cf(e){if(e.length===0)return 0;let t=e[0]*1;for(let n=1;n<e.length;n++)t+=e[n]*1;return t}function wf(e){if(e.length===0)throw Error(`mean requires at least one data point`);return Cf(e)/e.length}function Tf(e){if(e.length===0)throw Error(`mean requires at least one data point`);if(e.length<3)return e[0];e.sort();let t=e[0],n=NaN,r=0,i=1;for(let a=1;a<e.length+1;a++)e[a]===t?i++:(i>r&&(r=i,n=t),i=1,t=e[a]);return n*1}function Ef(e,t){return e.map(e=>e[t])}function Df(e,t){return Of[e](t)}var Of,kf=o((()=>{Of={min:Sf,max:xf,mean:wf,sum:Cf,mode:Tf}}));function Af(e,t){t===void 0&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw Error(`@turf/bbox-polygon does not support BBox with 6 positions`);var o=[n,r];return qu([[o,[i,r],[i,a],[n,a],o]],t.properties,{bbox:e,id:t.id})}var jf=o((()=>{nd()})),Mf=s(((e,t)=>{var n=Object.prototype.hasOwnProperty,r=`~`;function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1));function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,n,i,o){if(typeof n!=`function`)throw TypeError(`The listener must be a function`);var s=new a(n,i||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function s(e,t){--e._eventsCount===0?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var e=[],t,i;if(this._eventsCount===0)return e;for(i in t=this._events)n.call(t,i)&&e.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e},c.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,o=Array(a);i<a;i++)o[i]=n[i].fn;return o},c.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,i,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var c=this._events[s],l=arguments.length,u,d;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,a),!0;case 6:return c.fn.call(c.context,t,n,i,a,o),!0}for(d=1,u=Array(l-1);d<l;d++)u[d-1]=arguments[d];c.fn.apply(c.context,u)}else{var f=c.length,p;for(d=0;d<f;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),l){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,n);break;case 4:c[d].fn.call(c[d].context,t,n,i);break;default:if(!u)for(p=1,u=Array(l-1);p<l;p++)u[p-1]=arguments[p];c[d].fn.apply(c[d].context,u)}}return!0},c.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn===t&&(!i||o.once)&&(!n||o.context===n)&&s(this,a);else{for(var c=0,l=[],u=o.length;c<u;c++)(o[c].fn!==t||i&&!o[c].once||n&&o[c].context!==n)&&l.push(o[c]);l.length?this._events[a]=l.length===1?l[0]:l:s(this,a)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,t!==void 0&&(t.exports=c)})),Nf,Pf,Ff=o((()=>{Nf=(e=>(e.Realtime=`realtime`,e.Overlap=`overlap`,e.Replace=`replace`,e))(Nf||{}),Pf=(e=>(e.Loading=`Loading`,e.Loaded=`Loaded`,e.Failure=`Failure`,e.Cancelled=`Cancelled`,e))(Pf||{})}));function If(e){e.forEach(e=>{e.isCurrent&&(e.isVisible=e.isLoaded)})}function Lf(e){e.forEach(e=>{e.properties.state=Vf}),e.forEach(e=>{e.isCurrent&&!zf(e)&&Bf(e)}),e.forEach(e=>{e.isVisible=!!(e.properties.state&Uf)})}function Rf(e){e.forEach(e=>{e.properties.state=Vf}),e.forEach(e=>{e.isCurrent&&zf(e)}),e.slice().sort((e,t)=>e.z-t.z).forEach(e=>{e.isVisible=!!(e.properties.state&Uf),e.children.length&&(e.isVisible||e.properties.state&Hf)?e.children.forEach(e=>{e.properties.state=Hf}):e.isCurrent&&Bf(e)})}function zf(e){for(;e;){if(e.isLoaded)return e.properties.state|=Uf,!0;e=e.parent}return!1}function Bf(e){e.children.forEach(e=>{e.isLoaded?e.properties.state|=Uf:Bf(e)})}var Vf,Hf,Uf,Wf=o((()=>{Vf=0,Hf=1,Uf=2})),Gf,Kf,qf,Jf,Yf=o((()=>{Ff(),Wf(),Gf=[-1/0,-1/0,1/0,1/0],Kf=.2,qf={[Nf.Realtime]:If,[Nf.Overlap]:Lf,[Nf.Replace]:Rf},Jf=()=>{}}));function Xf(e,t,n){return[Math.floor((e+180)/360*2**n),Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*2**n)]}function Zf(e,t,n){let r=e/2**n*360-180,i=Math.PI-2*Math.PI*t/2**n;return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}function Qf({zoom:e,latLonBounds:t,maxZoom:n=1/0,minZoom:r=0,zoomOffset:i=0,extent:a=Gf}){let o=Math.ceil(e)+i;if(Number.isFinite(r)&&o<r)return[];Number.isFinite(n)&&o>n&&(o=n);let[s,c,l,u]=t,d=[Math.max(s,a[0]),Math.max(c,a[1]),Math.min(l,a[2]),Math.min(u,a[3])],f=[],[p,m]=Xf(d[0],d[1],o),[h,g]=Xf(d[2],d[3],o);for(let e=p;e<=h;e++)for(let t=g;t<=m;t++)f.push({x:e,y:t,z:o});let _=(h+p)/2,v=(m+g)/2,y=(e,t)=>Math.abs(e-_)+Math.abs(t-v);return f.sort((e,t)=>y(e.x,e.y)-y(t.x,t.y)),f}var $f,ep,tp=o((()=>{Yf(),$f=(e,t,n)=>{let[r,i]=Zf(e,t,n),[a,o]=Zf(e+1,t+1,n);return[r,o,a,i]},ep=(e,t,n,r=!0)=>{let i=2**n,a=i-1,o=i,s=e,c=t;return r&&(s<0?s+=o:s>a&&(s%=o)),{warpX:s,warpY:c}}})),np,rp,ip,ap=o((()=>{jf(),np=u(Mf()),Ff(),tp(),rp=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),ip=class extends np.EventEmitter{constructor(e){super(),this.tileSize=256,this.isVisible=!1,this.isCurrent=!1,this.isVisibleChange=!1,this.loadedLayers=0,this.isLayerLoaded=!1,this.isLoad=!1,this.isChildLoad=!1,this.parent=null,this.children=[],this.data=null,this.properties={},this.loadDataId=0;let{x:t,y:n,z:r,tileSize:i,warp:a=!0}=e;this.x=t,this.y=n,this.z=r,this.warp=a||!0,this.tileSize=i}get isLoading(){return this.loadStatus===Pf.Loading}get isLoaded(){return this.loadStatus===Pf.Loaded}get isFailure(){return this.loadStatus===Pf.Failure}setTileLayerLoaded(){this.isLayerLoaded=!0}get isCancelled(){return this.loadStatus===Pf.Cancelled}get isDone(){return[Pf.Loaded,Pf.Cancelled,Pf.Failure].includes(this.loadStatus)}get bounds(){return $f(this.x,this.y,this.z)}get bboxPolygon(){let[e,t,n,r]=this.bounds,i=[(n-e)/2,(r-t)/2];return Af(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:i,meta:`
      ${this.key}
      `}})}get key(){return`${this.x}_${this.y}_${this.z}`}layerLoad(){this.loadedLayers++,this.emit(`layerLoaded`)}loadData(e){return rp(this,arguments,function*({getData:e,onLoad:t,onError:n}){this.loadDataId++;let r=this.loadDataId;this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Pf.Loading;let i=null,a;try{let{x:t,y:n,z:r,bounds:a,tileSize:o,warp:s}=this,{warpX:c,warpY:l}=ep(t,n,r,s),{signal:u}=this.abortController;i=yield e({x:c,y:l,z:r,bounds:a,tileSize:o,signal:u,warp:s},this)}catch(e){a=e}if(r===this.loadDataId&&!(this.isCancelled&&!i)){if(a||!i){this.loadStatus=Pf.Failure,n(a,this);return}this.loadStatus=Pf.Loaded,this.data=i,t(this)}})}reloadData(e){this.isLoading&&this.abortLoad(),this.loadData(e)}abortLoad(){this.isLoaded||this.isCancelled||(this.loadStatus=Pf.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}})),op,sp,cp=o((()=>{Hd(),op=(e,t)=>{let n=Od(Ad(e),t),r=85.0511287798065;return[Math.max(n[0][0],-900),Math.max(n[0][1],-r),Math.min(n[1][0],900),Math.min(n[1][1],r)]},sp=(e,t)=>kd(Ad(e),Ad(t))})),lp,up,dp,fp,pp,mp,hp,gp,_p,vp,yp,bp,xp=o((()=>{lp=u(Mf()),nu(),Yf(),ap(),Ff(),cp(),tp(),up=Object.defineProperty,dp=Object.defineProperties,fp=Object.getOwnPropertyDescriptors,pp=Object.getOwnPropertySymbols,mp=Object.prototype.hasOwnProperty,hp=Object.prototype.propertyIsEnumerable,gp=(e,t,n)=>t in e?up(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_p=(e,t)=>{for(var n in t||={})mp.call(t,n)&&gp(e,n,t[n]);if(pp)for(var n of pp(t))hp.call(t,n)&&gp(e,n,t[n]);return e},vp=(e,t)=>dp(e,fp(t)),{throttle:yp}=tu,bp=class extends lp.default{constructor(e){super(),this.currentTiles=[],this.cacheTiles=new Map,this.throttleUpdate=yp((e,t)=>{this.update(e,t)},16),this.onTileLoad=e=>{this.emit(`tile-loaded`,e),this.updateTileVisible(),this.loadFinished()},this.onTileError=(e,t)=>{this.emit(`tile-error`,{error:e,tile:t}),this.updateTileVisible(),this.loadFinished()},this.onTileUnload=e=>{this.emit(`tile-unload`,e),this.loadFinished()},this.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Gf,getTileData:Jf,warp:!0,updateStrategy:Nf.Replace},this.updateOptions(e)}get isLoaded(){return this.currentTiles.every(e=>e.isDone)}get tiles(){return Array.from(this.cacheTiles.values()).sort((e,t)=>e.z-t.z)}updateOptions(e){let t=e.minZoom===void 0?this.options.minZoom:Math.ceil(e.minZoom),n=e.maxZoom===void 0?this.options.maxZoom:Math.floor(e.maxZoom);this.options=vp(_p(_p({},this.options),e),{minZoom:t,maxZoom:n})}update(e,t){let n=Math.max(0,Math.ceil(e));if(this.lastViewStates&&this.lastViewStates.zoom===n&&sp(this.lastViewStates.latLonBoundsBuffer,t))return;let r=op(t,Kf);this.lastViewStates={zoom:n,latLonBounds:t,latLonBoundsBuffer:r},this.currentZoom=n;let i=!1,a=this.getTileIndices(n,r).filter(e=>this.options.warp||e.x>=0&&e.x<2**n);this.emit(`tiles-load-start`),this.currentTiles=a.map(({x:e,y:t,z:n})=>{let r=this.getTile(e,t,n);return r?((r?.isFailure||r?.isCancelled)&&r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),r):(r=this.createTile(e,t,n),i=!0,r)}),i&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}reloadAll(){for(let[e,t]of this.cacheTiles){if(!this.currentTiles.includes(t)){this.cacheTiles.delete(e),this.onTileUnload(t);return}this.onTileUnload(t),t.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}reloadTileById(e,t,n){let r=this.cacheTiles.get(`${t},${n},${e}`);r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}reloadTileByLnglat(e,t,n){let r=this.getTileByLngLat(e,t,n);r&&this.reloadTileById(r.z,r.x,r.y)}reloadTileByExtent(e,t){this.getTileIndices(t,e).forEach(e=>{this.reloadTileById(e.z,e.x,e.y)})}pruneRequests(){let e=[];for(let t of this.cacheTiles.values())t.isLoading&&!t.isCurrent&&!t.isVisible&&e.push(t);for(;e.length>0;)e.shift().abortLoad()}getTileByLngLat(e,t,n){let{zoomOffset:r}=this.options,i=Math.ceil(n)+r,a=Xf(e,t,i);return this.tiles.filter(e=>e.key===`${a[0]}_${a[1]}_${i}`)[0]}getTileExtent(e,t){return this.getTileIndices(t,e)}getTileByZXY(e,t,n){return this.tiles.filter(r=>r.key===`${t}_${n}_${e}`)[0]}clear(){for(let e of this.cacheTiles.values())e.isLoading?e.abortLoad():this.onTileUnload(e);this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}destroy(){this.clear(),this.removeAllListeners()}updateTileVisible(){let e=this.options.updateStrategy,t=new Map;for(let e of this.cacheTiles.values())t.set(e.key,e.isVisible),e.isCurrent=!1,e.isVisible=!1;for(let e of this.currentTiles)e.isCurrent=!0,e.isVisible=!0;let n=Array.from(this.cacheTiles.values());typeof e==`function`?e(n):qf[e](n);let r=!1;Array.from(this.cacheTiles.values()).forEach(e=>{e.isVisible===t.get(e.key)?e.isVisibleChange=!1:(e.isVisibleChange=!0,r=!0)}),r&&this.emit(`tile-update`)}getTileIndices(e,t){let{tileSize:n,extent:r,zoomOffset:i}=this.options;return Qf({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:i,tileSize:n,zoom:e,latLonBounds:t,extent:r})}getTileId(e,t,n){return`${e},${t},${n}`}loadFinished(){let e=!this.currentTiles.some(e=>!e.isDone);return e&&this.emit(`tiles-load-finished`),e}getTile(e,t,n){let r=this.getTileId(e,t,n);return this.cacheTiles.get(r)}createTile(e,t,n){let r=this.getTileId(e,t,n),i=new ip({x:e,y:t,z:n,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}resizeCacheTiles(){let e=5*this.currentTiles.length;if(this.cacheTiles.size>e){for(let[t,n]of this.cacheTiles)if(!n.isVisible&&!this.currentTiles.includes(n)&&(this.cacheTiles.delete(t),this.onTileUnload(n)),this.cacheTiles.size<=e)break}this.rebuildTileTree()}rebuildTileTree(){for(let e of this.cacheTiles.values())e.parent=null,e.children.length=0;for(let e of this.cacheTiles.values()){let t=this.getNearestAncestor(e.x,e.y,e.z);e.parent=t,t?.children&&t.children.push(e)}}getNearestAncestor(e,t,n){for(;n>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),--n;let r=this.getTile(e,t,n);if(r)return r}return null}}}));function Sp(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Cp(e){let t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){let r=n[1].charCodeAt(0),i=n[2].charCodeAt(0),a;for(a=r;a<=i;++a)t.push(e.replace(n[0],String.fromCharCode(a)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e),n){let r=parseInt(n[2],10);for(let i=parseInt(n[1],10);i<=r;i++)t.push(e.replace(n[0],i.toString()));return t}return t.push(e),t}function wp(e,t){if(!e||!e.length)throw Error(`url is not allowed to be empty`);let{x:n,y:r,z:i}=t,a=Cp(e),o=Math.abs(n+r)%a.length;return(Bo(a[o])?`${a[o]}/{z}/{x}/{y}`:a[o]).replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,$f(n,r,i).join(`,`)).replace(/\{-y\}/g,(2**i-r-1).toString())}function Tp(e,t){let{x:n,y:r,z:i,layer:a,version:o=`1.0.0`,style:s=`default`,format:c,service:l=`WMTS`,tileMatrixset:u}=t,d=Cp(e);return`${d[Math.abs(n+r)%d.length]}&SERVICE=${l}&REQUEST=GetTile&VERSION=${o}&LAYER=${a}&STYLE=${s}&TILEMATRIXSET=${u}&FORMAT=${c}&TILECOL=${n}&TILEROW=${r}&TILEMATRIX=${i}`}var Ep=o((()=>{Yo(),tp()})),Dp=o((()=>{ap(),xp(),Ff(),tp(),Ep()}));function Op(e,t){return e??t}var kp=o((()=>{Yo(),$o(),qs(),wo(),Pu(),Hu(),Gu(),Hd(),Kd(),_f(),nu(),yf(),dd(),kf(),Dp()})),Ap,jp,Mp,Np,Pp,Fp,Ip=o((()=>{Ap={},jp={},Mp=e=>jp[e],Np=(e,t)=>{jp[e]=t},Pp=e=>Ap[e],Fp=(e,t)=>{Ap[e]=t}})),Lp=s(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n=typeof globalThis<`u`?globalThis:n||self,n.Supercluster=r())})(e,(function(){function e(n,r,i,a,o,s){if(!(o-a<=i)){var c=a+o>>1;t(n,r,c,a,o,s%2),e(n,r,i,a,c-1,s+1),e(n,r,i,c+1,o,s+1)}}function t(e,r,i,a,o,s){for(;o>a;){if(o-a>600){var c=o-a+1,l=i-a+1,u=Math.log(c),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(c-d)/c)*(l-c/2<0?-1:1);t(e,r,i,Math.max(a,Math.floor(i-l*d/c+f)),Math.min(o,Math.floor(i+(c-l)*d/c+f)),s)}var p=r[2*i+s],m=a,h=o;for(n(e,r,a,i),r[2*o+s]>p&&n(e,r,a,o);m<h;){for(n(e,r,m,h),m++,h--;r[2*m+s]<p;)m++;for(;r[2*h+s]>p;)h--}r[2*a+s]===p?n(e,r,a,h):(h++,n(e,r,h,o)),h<=i&&(a=h+1),i<=h&&(o=h-1)}}function n(e,t,n,i){r(e,n,i),r(t,2*n,2*i),r(t,2*n+1,2*i+1)}function r(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function i(e,t,n,r,i,a,o){for(var s=[0,e.length-1,0],c=[],l,u;s.length;){var d=s.pop(),f=s.pop(),p=s.pop();if(f-p<=o){for(var m=p;m<=f;m++)l=t[2*m],u=t[2*m+1],l>=n&&l<=i&&u>=r&&u<=a&&c.push(e[m]);continue}var h=Math.floor((p+f)/2);l=t[2*h],u=t[2*h+1],l>=n&&l<=i&&u>=r&&u<=a&&c.push(e[h]);var g=(d+1)%2;(d===0?n<=l:r<=u)&&(s.push(p),s.push(h-1),s.push(g)),(d===0?i>=l:a>=u)&&(s.push(h+1),s.push(f),s.push(g))}return c}function a(e,t,n,r,i,a){for(var s=[0,e.length-1,0],c=[],l=i*i;s.length;){var u=s.pop(),d=s.pop(),f=s.pop();if(d-f<=a){for(var p=f;p<=d;p++)o(t[2*p],t[2*p+1],n,r)<=l&&c.push(e[p]);continue}var m=Math.floor((f+d)/2),h=t[2*m],g=t[2*m+1];o(h,g,n,r)<=l&&c.push(e[m]);var _=(u+1)%2;(u===0?n-i<=h:r-i<=g)&&(s.push(f),s.push(m-1),s.push(_)),(u===0?n+i>=h:r+i>=g)&&(s.push(m+1),s.push(d),s.push(_))}return c}function o(e,t,n,r){var i=e-n,a=t-r;return i*i+a*a}var s=function(e){return e[0]},c=function(e){return e[1]},l=function(t,n,r,i,a){n===void 0&&(n=s),r===void 0&&(r=c),i===void 0&&(i=64),a===void 0&&(a=Float64Array),this.nodeSize=i,this.points=t;for(var o=this.ids=new(t.length<65536?Uint16Array:Uint32Array)(t.length),l=this.coords=new a(t.length*2),u=0;u<t.length;u++)o[u]=u,l[2*u]=n(t[u]),l[2*u+1]=r(t[u]);e(o,l,i,0,o.length-1,0)};l.prototype.range=function(e,t,n,r){return i(this.ids,this.coords,e,t,n,r,this.nodeSize)},l.prototype.within=function(e,t,n){return a(this.ids,this.coords,e,t,n,this.nodeSize)};var u={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},d=Math.fround||(function(e){return(function(t){return e[0]=+t,e[0]})})(new Float32Array(1)),f=function(e){this.options=x(Object.create(u),e),this.trees=Array(this.options.maxZoom+1)};f.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,a=t.nodeSize;n&&console.time(`total time`);var o=`prepare `+e.length+` points`;n&&console.time(o),this.points=e;for(var s=[],c=0;c<e.length;c++)e[c].geometry&&s.push(m(e[c],c));this.trees[i+1]=new l(s,S,C,a,Float32Array),n&&console.timeEnd(o);for(var u=i;u>=r;u--){var d=+Date.now();s=this._cluster(s,u),this.trees[u]=new l(s,S,C,a,Float32Array),n&&console.log(`z%d: %d clusters in %dms`,u,s.length,+Date.now()-d)}return n&&console.timeEnd(`total time`),this},f.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=e[2]===180?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var o=this.getClusters([n,r,180,a],t),s=this.getClusters([-180,r,i,a],t);return o.concat(s)}for(var c=this.trees[this._limitZoom(t)],l=c.range(_(n),v(a),_(i),v(r)),u=[],d=0,f=l;d<f.length;d+=1){var p=f[d],m=c.points[p];u.push(m.numPoints?h(m):this.points[m.index])}return u},f.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r=`No cluster with the specified id.`,i=this.trees[n];if(!i)throw Error(r);var a=i.points[t];if(!a)throw Error(r);for(var o=this.options.radius/(this.options.extent*2**(n-1)),s=i.within(a.x,a.y,o),c=[],l=0,u=s;l<u.length;l+=1){var d=u[l],f=i.points[d];f.parentId===e&&c.push(f.numPoints?h(f):this.points[f.index])}if(c.length===0)throw Error(r);return c},f.prototype.getLeaves=function(e,t,n){t||=10,n||=0;var r=[];return this._appendLeaves(r,e,t,n,0),r},f.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=2**e,a=this.options,o=a.extent,s=a.radius/o,c=(n-s)/i,l=(n+1+s)/i,u={features:[]};return this._addTileFeatures(r.range((t-s)/i,c,(t+1+s)/i,l),r.points,t,n,i,u),t===0&&this._addTileFeatures(r.range(1-s/i,c,1,l),r.points,i,n,i,u),t===i-1&&this._addTileFeatures(r.range(0,c,s/i,l),r.points,-1,n,i,u),u.features.length?u:null},f.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,n.length!==1)break;e=n[0].properties.cluster_id}return t},f.prototype._appendLeaves=function(e,t,n,r,i){for(var a=this.getChildren(t),o=0,s=a;o<s.length;o+=1){var c=s[o],l=c.properties;if(l&&l.cluster?i+l.point_count<=r?i+=l.point_count:i=this._appendLeaves(e,l.cluster_id,n,r,i):i<r?i++:e.push(c),e.length===n)break}return i},f.prototype._addTileFeatures=function(e,t,n,r,i,a){for(var o=0,s=e;o<s.length;o+=1){var c=t[s[o]],l=c.numPoints,u=void 0,d=void 0,f=void 0;if(l)u=g(c),d=c.x,f=c.y;else{var p=this.points[c.index];u=p.properties,d=_(p.geometry.coordinates[0]),f=v(p.geometry.coordinates[1])}var m={type:1,geometry:[[Math.round(this.options.extent*(d*i-n)),Math.round(this.options.extent*(f*i-r))]],tags:u},h=void 0;l?h=c.id:this.options.generateId?h=c.index:this.points[c.index].id&&(h=this.points[c.index].id),h!==void 0&&(m.id=h),a.features.push(m)}},f.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))},f.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,a=r.extent,o=r.reduce,s=r.minPoints,c=i/(a*2**t),l=0;l<e.length;l++){var u=e[l];if(!(u.zoom<=t)){u.zoom=t;for(var d=this.trees[t+1],f=d.within(u.x,u.y,c),m=u.numPoints||1,h=m,g=0,_=f;g<_.length;g+=1){var v=_[g],y=d.points[v];y.zoom>t&&(h+=y.numPoints||1)}if(h>m&&h>=s){for(var b=u.x*m,x=u.y*m,S=o&&m>1?this._map(u,!0):null,C=(l<<5)+(t+1)+this.points.length,w=0,E=f;w<E.length;w+=1){var D=E[w],O=d.points[D];if(!(O.zoom<=t)){O.zoom=t;var k=O.numPoints||1;b+=O.x*k,x+=O.y*k,O.parentId=C,o&&(S||=this._map(u,!0),o(S,this._map(O)))}}u.parentId=C,n.push(p(b/h,x/h,C,h,S))}else if(n.push(u),h>1)for(var A=0,j=f;A<j.length;A+=1){var M=j[A],N=d.points[M];N.zoom<=t||(N.zoom=t,n.push(N))}}}return n},f.prototype._getOriginId=function(e){return e-this.points.length>>5},f.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},f.prototype._map=function(e,t){if(e.numPoints)return t?x({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?x({},r):r};function p(e,t,n,r,i){return{x:d(e),y:d(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function m(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:d(_(r)),y:d(v(i)),zoom:1/0,index:t,parentId:-1}}function h(e){return{type:`Feature`,id:e.id,properties:g(e),geometry:{type:`Point`,coordinates:[y(e.x),b(e.y)]}}}function g(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+`k`:t>=1e3?Math.round(t/100)/10+`k`:t;return x(x({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function _(e){return e/360+.5}function v(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function y(e){return(e-.5)*360}function b(e){var t=(180-e*360)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function x(e,t){for(var n in t)e[n]=t[n];return e}function S(e){return e.x}function C(e){return e.y}return f}))}));function Rp(e,t){let{radius:n=40,maxZoom:r=18,minZoom:i=0,zoom:a=2}=t;if(e.pointIndex)return e.dataArray=zp(e.pointIndex.getClusters(e.extent,Math.floor(a))),e;let o=new Bp.default({radius:n,minZoom:i,maxZoom:r}),s={type:`FeatureCollection`,features:[]};return s.features=e.dataArray.map(e=>({type:`Feature`,geometry:{type:`Point`,coordinates:e.coordinates},properties:Kp({},e)})),o.load(s.features),o}function zp(e){return e.map((e,t)=>Kp({coordinates:e.geometry.coordinates,_id:t+1},e.properties))}var Bp,Vp,Hp,Up,Wp,Gp,Kp,qp=o((()=>{Bp=u(Lp()),Vp=Object.defineProperty,Hp=Object.getOwnPropertySymbols,Up=Object.prototype.hasOwnProperty,Wp=Object.prototype.propertyIsEnumerable,Gp=(e,t,n)=>t in e?Vp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Kp=(e,t)=>{for(var n in t||={})Up.call(t,n)&&Gp(e,n,t[n]);if(Hp)for(var n of Hp(t))Wp.call(t,n)&&Gp(e,n,t[n]);return e}}));function Jp(e){if(e.length===0)throw Error(`max requires at least one data point`);let t=e[0];for(let n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t}function Yp(e){if(e.length===0)throw Error(`min requires at least one data point`);let t=e[0];for(let n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t}function Xp(e){if(e.length===0)return 0;let t=e[0],n=0,r;for(let i=1;i<e.length;i++)r=t+e[i]*1,Math.abs(t)>=Math.abs(e[i])?n+=t-r+e[i]:n+=e[i]-r+t,t=r;return t+n*1}function Zp(e){if(e.length===0)throw Error(`mean requires at least one data point`);return Xp(e)/e.length}var Qp,$p=o((()=>{Qp={min:Yp,max:Jp,mean:Zp,sum:Xp}})),em=s(((e,t)=>{t.exports=n;function n(e,t){var i=e&&e.type,a;if(i===`FeatureCollection`)for(a=0;a<e.features.length;a++)n(e.features[a],t);else if(i===`GeometryCollection`)for(a=0;a<e.geometries.length;a++)n(e.geometries[a],t);else if(i===`Feature`)n(e.geometry,t);else if(i===`Polygon`)r(e.coordinates,t);else if(i===`MultiPolygon`)for(a=0;a<e.coordinates.length;a++)r(e.coordinates[a],t);return e}function r(e,t){if(e.length!==0){i(e[0],t);for(var n=1;n<e.length;n++)i(e[n],!t)}}function i(e,t){for(var n=0,r=0,i=0,a=e.length,o=a-1;i<a;o=i++){var s=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]),c=n+s;r+=Math.abs(n)>=Math.abs(s)?n-c+s:s-c+n,n=c}n+r>=0!=!!t&&e.reverse()}}));function tm(e,t){return e.map(e=>e[t]*1)}function nm(e){return Array.isArray(e)?e.length===0||typeof e[0]==`number`:!1}function rm(e){let t=Object.isFrozen(e)?tu.cloneDeep(e):e;return(0,am.default)(t,!0),t}function im(e,t){return e||[[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]}var am,om=o((()=>{kp(),am=u(em())}));function sm(e,t){if(Array.isArray(t))return t}var cm,lm,um,dm,fm,pm,mm,hm,gm,_m,vm,ym,bm,xm=o((()=>{So(),kp(),cm=u(Mf()),Ip(),qp(),$p(),om(),lm=Object.defineProperty,um=Object.getOwnPropertySymbols,dm=Object.prototype.hasOwnProperty,fm=Object.prototype.propertyIsEnumerable,pm=(e,t,n)=>t in e?lm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,mm=(e,t)=>{for(var n in t||={})dm.call(t,n)&&pm(e,n,t[n]);if(um)for(var n of um(t))fm.call(t,n)&&pm(e,n,t[n]);return e},hm=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),{cloneDeep:gm,isFunction:_m,isString:vm,mergeWith:ym}=tu,bm=class extends cm.EventEmitter{constructor(e,t){super(),this.type=`source`,this.isTile=!1,this.inited=!1,this.hooks={init:new fo},this.parser={type:`geojson`},this.transforms=[],this.cluster=!1,this.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:`count`},this.invalidExtent=!1,this.dataArrayChanged=!1,this.cfg={autoRender:!0},this.originData=e,this.initCfg(t),this.init().then(()=>{this.inited=!0,this.emit(`update`,{type:`inited`})})}getSourceCfg(){return this.cfg}getClusters(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}getClustersLeaves(e){return this.clusterIndex.getLeaves(e,1/0)}getParserType(){return this.parser.type}updateClusterData(e){let{method:t=`sum`,field:n}=this.clusterOptions,r=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,r.forEach(e=>{e.id||(e.properties.point_count=1)}),(n||_m(t))&&(r=r.map(e=>{let r=e.id;if(r){let i=this.clusterIndex.getLeaves(r,1/0).map(e=>e.properties),a;if(vm(t)&&n){let e=tm(i,n);a=Qp[t](e)}_m(t)&&(a=t(i)),e.properties.stat=a}else e.properties.point_count=1;return e})),this.data=Mp(`geojson`)({type:`FeatureCollection`,features:r}),this.executeTrans()}getFeatureById(e){let{type:t=`geojson`,geometry:n}=this.parser;if(t===`geojson`&&!this.cluster){let t=gm(e<this.originData.features.length?this.originData.features[e]:`null`);return t?.properties&&(this.transforms.length!==0||this.dataArrayChanged)&&(t.properties=this.data.dataArray.find(t=>t._id===e)),t}else if(t===`json`&&n)return this.data.dataArray.find(t=>t._id===e);else return e<this.data.dataArray.length?this.data.dataArray[e]:`null`}updateFeaturePropertiesById(e,t){this.data.dataArray=this.data.dataArray.map(n=>n._id===e?mm(mm({},n),t):n),this.dataArrayChanged=!0,this.emit(`update`,{type:`update`})}getFeatureId(e,t){return this.data.dataArray.find(n=>n[e]===t)?._id}setData(e,t){this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then(()=>{this.emit(`update`,{type:`update`})})}reloadAllTile(){var e;(e=this.tileset)==null||e.reloadAll()}reloadTilebyId(e,t,n){var r;(r=this.tileset)==null||r.reloadTileById(e,t,n)}reloadTileByLnglat(e,t,n){var r;(r=this.tileset)==null||r.reloadTileByLnglat(e,t,n)}getTileExtent(e,t){return this.tileset?.getTileExtent(e,t)}getTileByZXY(e,t,n){return this.tileset?.getTileByZXY(e,t,n)}reloadTileByExtent(e,t){var n;(n=this.tileset)==null||n.reloadTileByExtent(e,t)}destroy(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(e=this.tileset)==null||e.destroy()}processData(){return hm(this,null,function*(){return new Promise((e,t)=>{try{this.excuteParser(),this.initCluster(),this.executeTrans(),e({})}catch(e){t(e)}})})}initCfg(e){this.cfg=ym(this.cfg,e,sm);let t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=mm(mm({},this.clusterOptions),t.clusterOptions)))}init(){return hm(this,null,function*(){this.inited=!1,yield this.processData(),this.inited=!0})}excuteParser(){let e=this.parser;this.data=Mp(e.type||`geojson`)(this.originData,e),this.tileset=this.initTileset(),!e.cancelExtent&&(this.extent=pd(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}setCenter(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}initTileset(){let{tilesetOptions:e}=this.data;if(e)return this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new bp(mm({},e))}executeTrans(){this.transforms.forEach(e=>{let{type:t}=e,n=Pp(t)(this.data,e);Object.assign(this.data,n)})}initCluster(){if(!this.cluster)return;let e=this.clusterOptions||{};this.clusterIndex=Rp(this.data,e)}caculClusterExtent(e){let t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=Od(Ad(this.extent),e)),t[0].concat(t[1])}}}));function Sm(e){return Function(`d`,`return {`+e.map(function(e,t){return JSON.stringify(e)+`: d[`+t+`] || ""`}).join(`,`)+`}`)}function Cm(e,t){var n=Sm(e);return function(r,i){return t(n(r),i,e)}}function wm(e){var t=Object.create(null),n=[];return e.forEach(function(e){for(var r in e)r in t||n.push(t[r]=r)}),n}function Tm(e,t){var n=e+``,r=n.length;return r<t?Array(t-r+1).join(0)+n:n}function Em(e){return e<0?`-`+Tm(-e,6):e>9999?`+`+Tm(e,6):Tm(e,4)}function Dm(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?`Invalid Date`:Em(e.getUTCFullYear(),4)+`-`+Tm(e.getUTCMonth()+1,2)+`-`+Tm(e.getUTCDate(),2)+(i?`T`+Tm(t,2)+`:`+Tm(n,2)+`:`+Tm(r,2)+`.`+Tm(i,3)+`Z`:r?`T`+Tm(t,2)+`:`+Tm(n,2)+`:`+Tm(r,2)+`Z`:n||t?`T`+Tm(t,2)+`:`+Tm(n,2)+`Z`:``)}function Om(e){var t=RegExp(`["`+e+`
\r]`),n=e.charCodeAt(0);function r(e,t){var n,r,a=i(e,function(e,i){if(n)return n(e,i-1);r=e,n=t?Cm(e,t):Sm(e)});return a.columns=r||[],a}function i(e,t){var r=[],i=e.length,a=0,o=0,s,c=i<=0,l=!1;e.charCodeAt(i-1)===Mm&&--i,e.charCodeAt(i-1)===Nm&&--i;function u(){if(c)return Am;if(l)return l=!1,km;var t,r=a,o;if(e.charCodeAt(r)===jm){for(;a++<i&&e.charCodeAt(a)!==jm||e.charCodeAt(++a)===jm;);return(t=a)>=i?c=!0:(o=e.charCodeAt(a++))===Mm?l=!0:o===Nm&&(l=!0,e.charCodeAt(a)===Mm&&++a),e.slice(r+1,t-1).replace(/""/g,`"`)}for(;a<i;){if((o=e.charCodeAt(t=a++))===Mm)l=!0;else if(o===Nm)l=!0,e.charCodeAt(a)===Mm&&++a;else if(o!==n)continue;return e.slice(r,t)}return c=!0,e.slice(r,i)}for(;(s=u())!==Am;){for(var d=[];s!==km&&s!==Am;)d.push(s),s=u();t&&(d=t(d,o++))==null||r.push(d)}return r}function a(t,n){return t.map(function(t){return n.map(function(e){return u(t[e])}).join(e)})}function o(t,n){return n??=wm(t),[n.map(u).join(e)].concat(a(t,n)).join(`
`)}function s(e,t){return t??=wm(e),a(e,t).join(`
`)}function c(e){return e.map(l).join(`
`)}function l(t){return t.map(u).join(e)}function u(e){return e==null?``:e instanceof Date?Dm(e):t.test(e+=``)?`"`+e.replace(/"/g,`""`)+`"`:e}return{parse:r,parseRows:i,format:o,formatBody:s,formatRows:c,formatRow:l,formatValue:u}}var km,Am,jm,Mm,Nm,Pm=o((()=>{km={},Am={},jm=34,Mm=10,Nm=13})),Fm,Im,Lm=o((()=>{Pm(),Fm=Om(`,`),Im=Fm.parse,Fm.parseRows,Fm.format,Fm.formatBody,Fm.formatRows,Fm.formatRow,Fm.formatValue})),Rm=o((()=>{Lm()}));function zm(e){if(Array.isArray(e))return e;if(e.type===`Feature`){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw Error(`coords must be GeoJSON Feature, Geometry Object or an Array`)}function Bm(e){return e.type===`Feature`?e.geometry:e}var Vm=o((()=>{}));function Hm(e,t){let{x:n,y:r,x1:i,y1:a,coordinates:o,geometry:s}=t,c=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter(e=>e[s]&&e[s].type&&e[s].coordinates&&e[s].coordinates.length>0).forEach((e,t)=>{ad(rm(e[s]),n=>{let r=zm(n),i=Zm(Xm({},e),{_id:t,coordinates:r});c.push(i)})}),{dataArray:c};for(let t=0;t<e.length;t++){let s=e[t],l=[];if(o){let e=`Polygon`;Array.isArray(o[0])||(e=`Point`),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(e=`LineString`),l=rm({type:e,coordinates:s[o]}).coordinates}else n&&r&&i&&a?l=[[parseFloat(s[n]),parseFloat(s[r])],[parseFloat(s[i]),parseFloat(s[a])]]:n&&r&&(l=[parseFloat(s[n]),parseFloat(s[r])]);let u=Zm(Xm({},s),{_id:t,coordinates:l});c.push(u)}return{dataArray:c}}var Um,Wm,Gm,Km,qm,Jm,Ym,Xm,Zm,Qm=o((()=>{Vm(),od(),om(),Um=Object.defineProperty,Wm=Object.defineProperties,Gm=Object.getOwnPropertyDescriptors,Km=Object.getOwnPropertySymbols,qm=Object.prototype.hasOwnProperty,Jm=Object.prototype.propertyIsEnumerable,Ym=(e,t,n)=>t in e?Um(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Xm=(e,t)=>{for(var n in t||={})qm.call(t,n)&&Ym(e,n,t[n]);if(Km)for(var n of Km(t))Jm.call(t,n)&&Ym(e,n,t[n]);return e},Zm=(e,t)=>Wm(e,Gm(t))}));function $m(e,t){return Hm(Im(e),t)}var eh=o((()=>{Rm(),Qm()}));function th(e){let t=e.toString(),n=5381,r=t.length;for(;r;)n=n*33^t.charCodeAt(--r);return n>>>0}function nh(e,t){return t===void 0?null:isNaN(e.properties[t]*1)?e.properties&&e.properties[t]?th(e.properties[t]+``)%1000019:null:e.properties[t]*1}function rh(e,t){let n=[],r={};return e.features?(e.features=e.features.filter(e=>{let t=e.geometry;return e!=null&&t&&t.type&&t.coordinates&&t.coordinates.length>0}),e=rm(e),e.features.length===0?{dataArray:[],featureKeys:r}:(ad(e,(e,r)=>{let i=nh(e,t?.featureId);i===null&&(i=r);let a=i,o=zm(e),s=fh(dh({},e.properties),{coordinates:o,_id:a});n.push(s)}),{dataArray:n,featureKeys:r})):(e.features=[],{dataArray:[]})}var ih,ah,oh,sh,ch,lh,uh,dh,fh,ph=o((()=>{Vm(),od(),om(),ih=Object.defineProperty,ah=Object.defineProperties,oh=Object.getOwnPropertyDescriptors,sh=Object.getOwnPropertySymbols,ch=Object.prototype.hasOwnProperty,lh=Object.prototype.propertyIsEnumerable,uh=(e,t,n)=>t in e?ih(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dh=(e,t)=>{for(var n in t||={})ch.call(t,n)&&uh(e,n,t[n]);if(sh)for(var n of sh(t))lh.call(t,n)&&uh(e,n,t[n]);return e},fh=(e,t)=>ah(e,oh(t))}));function mh(e,t,n,r){for(var i=r,a=n-t>>1,o=n-t,s,c=e[t],l=e[t+1],u=e[n],d=e[n+1],f=t+3;f<n;f+=3){var p=hh(e[f],e[f+1],c,l,u,d);if(p>i)s=f,i=p;else if(p===i){var m=Math.abs(f-a);m<o&&(s=f,o=m)}}i>r&&(s-t>3&&mh(e,t,s,r),e[s+2]=i,n-s>3&&mh(e,s,n,r))}function hh(e,t,n,r,i,a){var o=i-n,s=a-r;if(o!==0||s!==0){var c=((e-n)*o+(t-r)*s)/(o*o+s*s);c>1?(n=i,r=a):c>0&&(n+=o*c,r+=s*c)}return o=e-n,s=t-r,o*o+s*s}var gh=o((()=>{}));function _h(e,t,n,r){var i={id:e===void 0?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return vh(i),i}function vh(e){var t=e.geometry,n=e.type;if(n===`Point`||n===`MultiPoint`||n===`LineString`)yh(e,t);else if(n===`Polygon`||n===`MultiLineString`)for(var r=0;r<t.length;r++)yh(e,t[r]);else if(n===`MultiPolygon`)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)yh(e,t[r][i])}function yh(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}var bh=o((()=>{}));function xh(e,t){var n=[];if(e.type===`FeatureCollection`)for(var r=0;r<e.features.length;r++)Sh(n,e.features[r],t,r);else e.type===`Feature`?Sh(n,e,t):Sh(n,{geometry:e},t);return n}function Sh(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,a=t.geometry.type,o=(n.tolerance/((1<<n.maxZoom)*n.extent))**2,s=[],c=t.id;if(n.promoteId?c=t.properties[n.promoteId]:n.generateId&&(c=r||0),a===`Point`)Ch(i,s);else if(a===`MultiPoint`)for(var l=0;l<i.length;l++)Ch(i[l],s);else if(a===`LineString`)wh(i,s,o,!1);else if(a===`MultiLineString`)if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],wh(i[l],s,o,!1),e.push(_h(c,`LineString`,s,t.properties));return}else Th(i,s,o,!1);else if(a===`Polygon`)Th(i,s,o,!0);else if(a===`MultiPolygon`)for(l=0;l<i.length;l++){var u=[];Th(i[l],u,o,!0),s.push(u)}else if(a===`GeometryCollection`){for(l=0;l<t.geometry.geometries.length;l++)Sh(e,{id:c,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}else throw Error(`Input data is not a valid GeoJSON object.`);e.push(_h(c,a,s,t.properties))}}function Ch(e,t){t.push(Eh(e[0])),t.push(Dh(e[1])),t.push(0)}function wh(e,t,n,r){for(var i,a,o=0,s=0;s<e.length;s++){var c=Eh(e[s][0]),l=Dh(e[s][1]);t.push(c),t.push(l),t.push(0),s>0&&(r?o+=(i*l-c*a)/2:o+=Math.sqrt((c-i)**2+(l-a)**2)),i=c,a=l}var u=t.length-3;t[2]=1,mh(t,0,u,n),t[u+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function Th(e,t,n,r){for(var i=0;i<e.length;i++){var a=[];wh(e[i],a,n,r),t.push(a)}}function Eh(e){return e/360+.5}function Dh(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}var Oh=o((()=>{gh(),bh()}));function kh(e,t,n,r,i,a,o,s){if(n/=t,r/=t,a>=n&&o<r)return e;if(o<n||a>=r)return null;for(var c=[],l=0;l<e.length;l++){var u=e[l],d=u.geometry,f=u.type,p=i===0?u.minX:u.minY,m=i===0?u.maxX:u.maxY;if(p>=n&&m<r){c.push(u);continue}else if(m<n||p>=r)continue;var h=[];if(f===`Point`||f===`MultiPoint`)Ah(d,h,n,r,i);else if(f===`LineString`)jh(d,h,n,r,i,!1,s.lineMetrics);else if(f===`MultiLineString`)Nh(d,h,n,r,i,!1);else if(f===`Polygon`)Nh(d,h,n,r,i,!0);else if(f===`MultiPolygon`)for(var g=0;g<d.length;g++){var _=[];Nh(d[g],_,n,r,i,!0),_.length&&h.push(_)}if(h.length){if(s.lineMetrics&&f===`LineString`){for(g=0;g<h.length;g++)c.push(_h(u.id,f,h[g],u.tags));continue}(f===`LineString`||f===`MultiLineString`)&&(h.length===1?(f=`LineString`,h=h[0]):f=`MultiLineString`),(f===`Point`||f===`MultiPoint`)&&(f=h.length===3?`Point`:`MultiPoint`),c.push(_h(u.id,f,h,u.tags))}}return c.length?c:null}function Ah(e,t,n,r,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=n&&o<=r&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function jh(e,t,n,r,i,a,o){for(var s=Mh(e),c=i===0?Fh:Ih,l=e.start,u,d,f=0;f<e.length-3;f+=3){var p=e[f],m=e[f+1],h=e[f+2],g=e[f+3],_=e[f+4],v=i===0?p:m,y=i===0?g:_,b=!1;o&&(u=Math.sqrt((p-g)**2+(m-_)**2)),v<n?y>n&&(d=c(s,p,m,g,_,n),o&&(s.start=l+u*d)):v>r?y<r&&(d=c(s,p,m,g,_,r),o&&(s.start=l+u*d)):Ph(s,p,m,h),y<n&&v>=n&&(d=c(s,p,m,g,_,n),b=!0),y>r&&v<=r&&(d=c(s,p,m,g,_,r),b=!0),!a&&b&&(o&&(s.end=l+u*d),t.push(s),s=Mh(e)),o&&(l+=u)}var x=e.length-3;p=e[x],m=e[x+1],h=e[x+2],v=i===0?p:m,v>=n&&v<=r&&Ph(s,p,m,h),x=s.length-3,a&&x>=3&&(s[x]!==s[0]||s[x+1]!==s[1])&&Ph(s,s[0],s[1],s[2]),s.length&&t.push(s)}function Mh(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function Nh(e,t,n,r,i,a){for(var o=0;o<e.length;o++)jh(e[o],t,n,r,i,a,!1)}function Ph(e,t,n,r){e.push(t),e.push(n),e.push(r)}function Fh(e,t,n,r,i,a){var o=(a-t)/(r-t);return e.push(a),e.push(n+(i-n)*o),e.push(1),o}function Ih(e,t,n,r,i,a){var o=(a-n)/(i-n);return e.push(t+(r-t)*o),e.push(a),e.push(1),o}var Lh=o((()=>{bh()}));function Rh(e,t){var n=t.buffer/t.extent,r=e,i=kh(e,1,-1-n,n,0,-1,2,t),a=kh(e,1,1-n,2+n,0,-1,2,t);return(i||a)&&(r=kh(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=zh(i,1).concat(r)),a&&(r=r.concat(zh(a,-1)))),r}function zh(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r],a=i.type,o;if(a===`Point`||a===`MultiPoint`||a===`LineString`)o=Bh(i.geometry,t);else if(a===`MultiLineString`||a===`Polygon`){o=[];for(var s=0;s<i.geometry.length;s++)o.push(Bh(i.geometry[s],t))}else if(a===`MultiPolygon`)for(o=[],s=0;s<i.geometry.length;s++){for(var c=[],l=0;l<i.geometry[s].length;l++)c.push(Bh(i.geometry[s][l],t));o.push(c)}n.push(_h(i.id,a,o,i.tags))}return n}function Bh(e,t){var n=[];n.size=e.size,e.start!==void 0&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}var Vh=o((()=>{Lh(),bh()}));function Hh(e,t){if(e.transformed)return e;var n=1<<e.z,r=e.x,i=e.y,a,o,s;for(a=0;a<e.features.length;a++){var c=e.features[a],l=c.geometry,u=c.type;if(c.geometry=[],u===1)for(o=0;o<l.length;o+=2)c.geometry.push(Uh(l[o],l[o+1],t,n,r,i));else for(o=0;o<l.length;o++){var d=[];for(s=0;s<l[o].length;s+=2)d.push(Uh(l[o][s],l[o][s+1],t,n,r,i));c.geometry.push(d)}}return e.transformed=!0,e}function Uh(e,t,n,r,i,a){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-a))]}var Wh=o((()=>{}));function Gh(e,t,n,r,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,Kh(o,e[s],a,i);var c=e[s].minX,l=e[s].minY,u=e[s].maxX,d=e[s].maxY;c<o.minX&&(o.minX=c),l<o.minY&&(o.minY=l),u>o.maxX&&(o.maxX=u),d>o.maxY&&(o.maxY=d)}return o}function Kh(e,t,n,r){var i=t.geometry,a=t.type,o=[];if(a===`Point`||a===`MultiPoint`)for(var s=0;s<i.length;s+=3)o.push(i[s]),o.push(i[s+1]),e.numPoints++,e.numSimplified++;else if(a===`LineString`)qh(o,i,e,n,!1,!1);else if(a===`MultiLineString`||a===`Polygon`)for(s=0;s<i.length;s++)qh(o,i[s],e,n,a===`Polygon`,s===0);else if(a===`MultiPolygon`)for(var c=0;c<i.length;c++){var l=i[c];for(s=0;s<l.length;s++)qh(o,l[s],e,n,!0,s===0)}if(o.length){var u=t.tags||null;if(a===`LineString`&&r.lineMetrics){for(var d in u={},t.tags)u[d]=t.tags[d];u.mapbox_clip_start=i.start/i.size,u.mapbox_clip_end=i.end/i.size}var f={geometry:o,type:a===`Polygon`||a===`MultiPolygon`?3:a===`LineString`||a===`MultiLineString`?2:1,tags:u};t.id!==null&&(f.id=t.id),e.features.push(f)}}function qh(e,t,n,r,i,a){var o=r*r;if(r>0&&t.size<(i?o:r)){n.numPoints+=t.length/3;return}for(var s=[],c=0;c<t.length;c+=3)(r===0||t[c+2]>o)&&(n.numSimplified++,s.push(t[c]),s.push(t[c+1])),n.numPoints++;i&&Jh(s,a),e.push(s)}function Jh(e,t){for(var n=0,r=0,i=e.length,a=i-2;r<i;a=r,r+=2)n+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var o=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=o,e[i-1-r]=s}}var Yh=o((()=>{}));function Xh(e,t){return new Zh(e,t)}function Zh(e,t){t=this.options=$h(Object.create(this.options),t);var n=t.debug;if(n&&console.time(`preprocess data`),t.maxZoom<0||t.maxZoom>24)throw Error(`maxZoom should be in the 0-24 range`);if(t.promoteId&&t.generateId)throw Error(`promoteId and generateId cannot be used together.`);var r=xh(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd(`preprocess data`),console.log(`index: maxZoom: %d, maxPoints: %d`,t.indexMaxZoom,t.indexMaxPoints),console.time(`generate tiles`),this.stats={},this.total=0),r=Rh(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log(`features: %d, points: %d`,this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd(`generate tiles`),console.log(`tiles generated:`,this.total,JSON.stringify(this.stats)))}function Qh(e,t,n){return((1<<e)*n+t)*32+e}function $h(e,t){for(var n in t)e[n]=t[n];return e}var eg=o((()=>{Oh(),Lh(),Vh(),Wh(),Yh(),Zh.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zh.prototype.splitTile=function(e,t,n,r,i,a,o){for(var s=[e,t,n,r],c=this.options,l=c.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var u=1<<t,d=Qh(t,n,r),f=this.tiles[d];if(!f&&(l>1&&console.time(`creation`),f=this.tiles[d]=Gh(e,t,n,r,c),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log(`tile z%d-%d-%d (features: %d, points: %d, simplified: %d)`,t,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd(`creation`));var p=`z`+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,i){if(t===c.maxZoom||t===i)continue;var m=1<<i-t;if(n!==Math.floor(a/m)||r!==Math.floor(o/m))continue}else if(t===c.indexMaxZoom||f.numPoints<=c.indexMaxPoints)continue;if(f.source=null,e.length!==0){l>1&&console.time(`clipping`);var h=.5*c.buffer/c.extent,g=.5-h,_=.5+h,v=1+h,y=b=x=S=null,b,x,S,C=kh(e,u,n-h,n+_,0,f.minX,f.maxX,c),w=kh(e,u,n+g,n+v,0,f.minX,f.maxX,c);e=null,C&&=(y=kh(C,u,r-h,r+_,1,f.minY,f.maxY,c),b=kh(C,u,r+g,r+v,1,f.minY,f.maxY,c),null),w&&=(x=kh(w,u,r-h,r+_,1,f.minY,f.maxY,c),S=kh(w,u,r+g,r+v,1,f.minY,f.maxY,c),null),l>1&&console.timeEnd(`clipping`),s.push(y||[],t+1,n*2,r*2),s.push(b||[],t+1,n*2,r*2+1),s.push(x||[],t+1,n*2+1,r*2),s.push(S||[],t+1,n*2+1,r*2+1)}}},Zh.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,a=r.debug;if(e<0||e>24)return null;var o=1<<e;t=(t%o+o)%o;var s=Qh(e,t,n);if(this.tiles[s])return Hh(this.tiles[s],i);a>1&&console.log(`drilling down to z%d-%d-%d`,e,t,n);for(var c=e,l=t,u=n,d;!d&&c>0;)c--,l=Math.floor(l/2),u=Math.floor(u/2),d=this.tiles[Qh(c,l,u)];return!d||!d.source?null:(a>1&&console.log(`found parent tile z%d-%d-%d`,c,l,u),a>1&&console.time(`drilling down`),this.splitTile(d.source,c,l,u,e,t,n),a>1&&console.timeEnd(`drilling down`),this.tiles[s]?Hh(this.tiles[s],i):null)}})),tg,ng=o((()=>{tg=class{constructor(e,t,n,r){this.vectorLayerCache={},this.x=t,this.y=n,this.z=r,this.vectorTile=e}getTileData(e){return!e||!this.vectorTile.layers[e]?[]:this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features}getFeatureById(){throw Error(`Method not implemented.`)}}}));function rg(e){let t=0;for(let n=0,r=e.length,i=r-1,a,o;n<r;i=n++)a=e[n],o=e[i],t+=(o.x-a.x)*(a.y+o.y);return t}function ig(e){let t=e.length;if(t<=1)return[e];let n=[],r,i;for(let a=0;a<t;a++){let t=rg(e[a]);t!==0&&(i===void 0&&(i=t<0),i===t<0?(r&&n.push(r),r=[e[a]]):r.push(e[a]))}return r&&n.push(r),n}function ag(e,t,n,r,i){let a=i.geometry,o=i.type,s=i.tags,c=i.id,l=e*2**r,u=e*t,d=e*n,f=yg[o],p,m;function h(e){for(let t=0;t<e.length;t++){let n=e[t];if(n[3])break;let r=180-(n[1]+d)*360/l;e[t]=[(n[0]+u)*360/l-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90,0,1]}}switch(o){case 1:let e=[];for(p=0;p<a.length;p++)e[p]=a[p][0];a=e,h(a);break;case 2:for(p=0;p<a.length;p++)h(a[p]);break;case 3:for(a=ig(a),p=0;p<a.length;p++)for(m=0;m<a[p].length;m++)h(a[p][m]);break}return a.length===1?a=a[0]:f=`Multi`+f,{type:`Feature`,geometry:{type:f,coordinates:a},properties:s,id:c,relativeOrigin:[0,0],coord:``}}function og(e){let t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||e.geojsonvtOptions===void 0?t:hg(hg({},t),e.geojsonvtOptions)}function sg(e,t){let n=og(t),r=n.extent||4096,i=Xh(e,n);return{data:e,dataArray:[],tilesetOptions:gg(hg(hg({},vg),t),{getTileData:(e,t)=>bg(t,i,e,r)}),isTile:!0}}var cg,lg,ug,dg,fg,pg,mg,hg,gg,_g,vg,yg,bg,xg=o((()=>{eg(),ng(),cg=Object.defineProperty,lg=Object.defineProperties,ug=Object.getOwnPropertyDescriptors,dg=Object.getOwnPropertySymbols,fg=Object.prototype.hasOwnProperty,pg=Object.prototype.propertyIsEnumerable,mg=(e,t,n)=>t in e?cg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,hg=(e,t)=>{for(var n in t||={})fg.call(t,n)&&mg(e,n,t[n]);if(dg)for(var n of dg(t))pg.call(t,n)&&mg(e,n,t[n]);return e},gg=(e,t)=>lg(e,ug(t)),_g=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),vg={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},yg=[`Unknown`,`Point`,`LineString`,`Polygon`],bg=(e,t,n,r)=>_g(void 0,null,function*(){return new Promise(i=>{let a=t.getTile(e.z,e.x,e.y);i(new tg({layers:{defaultLayer:{features:a?a.features.map(e=>ag(r,n.x,n.y,n.z,e)):[]}}},e.x,e.y,e.z))})})}));function Sg(e,t){let{extent:n=[121.168,30.2828,121.384,30.4219],coordinates:r,requestParameters:i={}}=t;return{originData:e,images:new Promise(t=>{e instanceof HTMLImageElement||Fu(e)?t([e]):Cg(e,i,e=>{t(e)})}),_id:1,dataArray:[{_id:0,coordinates:im(r,n)}]}}function Cg(e,t,n){let r=[];if(typeof e==`string`)qo(Mg(jg({},t),{url:e}),(e,t)=>{t&&(r.push(t),n(r))});else{let i=e.length,a=0;e.forEach(e=>{qo(Mg(jg({},t),{url:e}),(e,t)=>{a++,t&&r.push(t),a===i&&n(r)})})}return Sg}var wg,Tg,Eg,Dg,Og,kg,Ag,jg,Mg,Ng=o((()=>{kp(),om(),wg=Object.defineProperty,Tg=Object.defineProperties,Eg=Object.getOwnPropertyDescriptors,Dg=Object.getOwnPropertySymbols,Og=Object.prototype.hasOwnProperty,kg=Object.prototype.propertyIsEnumerable,Ag=(e,t,n)=>t in e?wg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,jg=(e,t)=>{for(var n in t||={})Og.call(t,n)&&Ag(e,n,t[n]);if(Dg)for(var n of Dg(t))kg.call(t,n)&&Ag(e,n,t[n]);return e},Mg=(e,t)=>Tg(e,Eg(t))}));function Pg(e,t){return{dataArray:[],tilesetOptions:Ug(Hg({},t),{getTileData:(n,r)=>Gg(e,r,t?.requestParameters,t.getCustomData)}),isTile:!0}}var Fg,Ig,Lg,Rg,zg,Bg,Vg,Hg,Ug,Wg,Gg,Kg=o((()=>{kp(),ng(),Fg=Object.defineProperty,Ig=Object.defineProperties,Lg=Object.getOwnPropertyDescriptors,Rg=Object.getOwnPropertySymbols,zg=Object.prototype.hasOwnProperty,Bg=Object.prototype.propertyIsEnumerable,Vg=(e,t,n)=>t in e?Fg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Hg=(e,t)=>{for(var n in t||={})zg.call(t,n)&&Vg(e,n,t[n]);if(Rg)for(var n of Rg(t))Bg.call(t,n)&&Vg(e,n,t[n]);return e},Ug=(e,t)=>Ig(e,Lg(t)),Wg=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),Gg=(e,t,n,r)=>Wg(void 0,null,function*(){let i={x:t.x,y:t.y,z:t.z},a=wp(e,i);return new Promise(e=>{r?r(i,(n,r)=>{e(n||!r?new tg({layers:{defaultLayer:{features:[]}}},t.x,t.y,t.z):new tg({layers:{defaultLayer:{features:r.features}}},t.x,t.y,t.z))}):Go(Ug(Hg({},n),{url:a}),(n,r)=>{e(n||!r?new tg({layers:{defaultLayer:{features:[]}}},t.x,t.y,t.z):new tg({layers:{defaultLayer:{features:JSON.parse(r)}}},t.x,t.y,t.z))})})})})),qg=s(((e,t)=>{t.exports=n;function n(e,t){this.x=e,this.y=t}n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),a=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e}})),Jg=s(((e,t)=>{var n=qg();t.exports=r;function r(e,t,n,r,a){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=a,e.readFields(i,this,t)}function i(e,t,n){e==1?t.id=n.readVarint():e==2?a(n,t):e==3?t.type=n.readVarint():e==4&&(t._geometry=n.pos)}function a(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}r.types=[`Unknown`,`Point`,`LineString`,`Polygon`],r.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,a=0,o=0,s=[],c;e.pos<t;){if(i<=0){var l=e.readVarint();r=l&7,i=l>>3}if(i--,r===1||r===2)a+=e.readSVarint(),o+=e.readSVarint(),r===1&&(c&&s.push(c),c=[]),c.push(new n(a,o));else if(r===7)c&&c.push(c[0].clone());else throw Error(`unknown command `+r)}return c&&s.push(c),s},r.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,a=0,o=1/0,s=-1/0,c=1/0,l=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();n=u&7,r=u>>3}if(r--,n===1||n===2)i+=e.readSVarint(),a+=e.readSVarint(),i<o&&(o=i),i>s&&(s=i),a<c&&(c=a),a>l&&(l=a);else if(n!==7)throw Error(`unknown command `+n)}return[o,c,s,l]},r.prototype.toGeoJSON=function(e,t,n){var i=this.extent*2**n,a=this.extent*e,s=this.extent*t,c=this.loadGeometry(),l=r.types[this.type],u,d;function f(e){for(var t=0;t<e.length;t++){var n=e[t],r=180-(n.y+s)*360/i;e[t]=[(n.x+a)*360/i-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(u=0;u<c.length;u++)p[u]=c[u][0];c=p,f(c);break;case 2:for(u=0;u<c.length;u++)f(c[u]);break;case 3:for(c=o(c),u=0;u<c.length;u++)for(d=0;d<c[u].length;d++)f(c[u][d]);break}c.length===1?c=c[0]:l=`Multi`+l;var m={type:`Feature`,geometry:{type:l,coordinates:c},properties:this.properties};return`id`in this&&(m.id=this.id),m};function o(e){var t=e.length;if(t<=1)return[e];for(var n=[],r,i,a=0;a<t;a++){var o=s(e[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(r&&n.push(r),r=[e[a]]):r.push(e[a]))}return r&&n.push(r),n}function s(e){for(var t=0,n=0,r=e.length,i=r-1,a,o;n<r;i=n++)a=e[n],o=e[i],t+=(o.x-a.x)*(a.y+o.y);return t}})),Yg=s(((e,t)=>{var n=Jg();t.exports=r;function r(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(i,this,t),this.length=this._features.length}function i(e,t,n){e===15?t.version=n.readVarint():e===1?t.name=n.readString():e===5?t.extent=n.readVarint():e===2?t._features.push(n.pos):e===3?t._keys.push(n.readString()):e===4&&t._values.push(a(n))}function a(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var r=e.readVarint()>>3;t=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null}return t}r.prototype.feature=function(e){if(e<0||e>=this._features.length)throw Error(`feature index out of bounds`);this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,t,this.extent,this._keys,this._values)}})),Xg=s(((e,t)=>{var n=Yg();t.exports=r;function r(e,t){this.layers=e.readFields(i,{},t)}function i(e,t,r){if(e===3){var i=new n(r,r.readVarint()+r.pos);i.length&&(t[i.name]=i)}}})),Zg=s(((e,t)=>{t.exports.VectorTile=Xg(),t.exports.VectorTileFeature=Jg(),t.exports.VectorTileLayer=Yg()})),Qg=s((e=>{e.read=function(e,t,n,r,i){var a,o,s=i*8-r-1,c=(1<<s)-1,l=c>>1,u=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,a=p&(1<<-u)-1,p>>=-u,u+=s;u>0;a=a*256+e[t+d],d+=f,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=o*256+e[t+d],d+=f,u-=8);if(a===0)a=1-l;else if(a===c)return o?NaN:(p?-1:1)*(1/0);else o+=2**r,a-=l;return(p?-1:1)*o*2**(a-r)},e.write=function(e,t,n,r,i,a){var o,s,c,l=a*8-i-1,u=(1<<l)-1,d=u>>1,f=i===23?2**-24-2**-77:0,p=r?0:a-1,m=r?1:-1,h=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=2**-o)<1&&(o--,c*=2),o+d>=1?t+=f/c:t+=f*2**(1-d),t*c>=2&&(o++,c/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*c-1)*2**i,o+=d):(s=t*2**(d-1)*2**i,o=0));i>=8;e[n+p]=s&255,p+=m,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[n+p]=o&255,p+=m,o/=256,l-=8);e[n+p-m]|=h*128}})),$g=s(((e,t)=>{t.exports=r;var n=Qg();function r(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var i=65536*65536,a=1/i,o=12,s=typeof TextDecoder>`u`?null:new TextDecoder(`utf-8`);r.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n||=this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,a=this.pos;this.type=r&7,e(i,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=w(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=D(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=w(this.buf,this.pos)+w(this.buf,this.pos+4)*i;return this.pos+=8,e},readSFixed64:function(){var e=w(this.buf,this.pos)+D(this.buf,this.pos+4)*i;return this.pos+=8,e},readFloat:function(){var e=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,n,r=t[this.pos++];return n=r&127,r<128||(r=t[this.pos++],n|=(r&127)<<7,r<128)||(r=t[this.pos++],n|=(r&127)<<14,r<128)||(r=t[this.pos++],n|=(r&127)<<21,r<128)?n:(r=t[this.pos],n|=(r&15)<<28,c(n,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=o&&s?k(this.buf,t,e):O(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==r.Bytes)return e.push(this.readVarint(t));var n=l(this);for(e||=[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==r.Bytes)return e.push(this.readSVarint());var t=l(this);for(e||=[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==r.Bytes)return e.push(this.readBoolean());var t=l(this);for(e||=[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==r.Bytes)return e.push(this.readFloat());var t=l(this);for(e||=[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==r.Bytes)return e.push(this.readDouble());var t=l(this);for(e||=[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==r.Bytes)return e.push(this.readFixed32());var t=l(this);for(e||=[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==r.Bytes)return e.push(this.readSFixed32());var t=l(this);for(e||=[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==r.Bytes)return e.push(this.readFixed64());var t=l(this);for(e||=[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==r.Bytes)return e.push(this.readSFixed64());var t=l(this);for(e||=[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===r.Varint)for(;this.buf[this.pos++]>127;);else if(t===r.Bytes)this.pos=this.readVarint()+this.pos;else if(t===r.Fixed32)this.pos+=4;else if(t===r.Fixed64)this.pos+=8;else throw Error(`Unimplemented type: `+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),E(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),E(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),E(this.buf,e&-1,this.pos),E(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),E(this.buf,e&-1,this.pos),E(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){d(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=A(this.buf,e,this.pos);var n=this.pos-t;n>=128&&m(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),n.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),n.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&m(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,r.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,h,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,g,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,y,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,_,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,v,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,b,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,x,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,S,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,C,t)},writeBytesField:function(e,t){this.writeTag(e,r.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,r.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,r.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,r.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};function c(e,t,n){var r=n.buf,i,a=r[n.pos++];if(i=(a&112)>>4,a<128||(a=r[n.pos++],i|=(a&127)<<3,a<128)||(a=r[n.pos++],i|=(a&127)<<10,a<128)||(a=r[n.pos++],i|=(a&127)<<17,a<128)||(a=r[n.pos++],i|=(a&127)<<24,a<128)||(a=r[n.pos++],i|=(a&1)<<31,a<128))return u(e,i,t);throw Error(`Expected varint not more than 10 bytes`)}function l(e){return e.type===r.Bytes?e.readVarint()+e.pos:e.pos+1}function u(e,t,n){return n?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function d(e,t){var n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(n=~(-e%4294967296),r=~(-e/4294967296),n^4294967295?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw Error(`Given varint doesn't fit into 10 bytes`);t.realloc(10),f(n,r,t),p(r,t)}function f(e,t,n){n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos++]=e&127|128,e>>>=7,n.buf[n.pos]=e&127}function p(e,t){var n=(e&7)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function m(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function h(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function g(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function _(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function v(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function y(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function b(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function x(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function S(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function C(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function w(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function E(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function D(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function O(e,t,n){for(var r=``,i=t;i<n;){var a=e[i],o=null,s=a>239?4:a>223?3:a>191?2:1;if(i+s>n)break;var c,l,u;s===1?a<128&&(o=a):s===2?(c=e[i+1],(c&192)==128&&(o=(a&31)<<6|c&63,o<=127&&(o=null))):s===3?(c=e[i+1],l=e[i+2],(c&192)==128&&(l&192)==128&&(o=(a&15)<<12|(c&63)<<6|l&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):s===4&&(c=e[i+1],l=e[i+2],u=e[i+3],(c&192)==128&&(l&192)==128&&(u&192)==128&&(o=(a&15)<<18|(c&63)<<12|(l&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,s=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),i+=s}return r}function k(e,t,n){return s.decode(e.subarray(t,n))}function A(e,t,n){for(var r=0,i,a;r<t.length;r++){if(i=t.charCodeAt(r),i>55295&&i<57344)if(a)if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,a=i;continue}else i=a-55296<<10|i-56320|65536,a=null;else{i>56319||r+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):a=i;continue}else a&&=(e[n++]=239,e[n++]=191,e[n++]=189,null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=i&63|128)}return n}})),e_,t_,n_,r_,i_,a_,o_,s_,c_,l_,u_,d_,f_=o((()=>{e_=Zg(),t_=u($g()),n_=Object.defineProperty,r_=Object.defineProperties,i_=Object.getOwnPropertyDescriptors,a_=Object.getOwnPropertySymbols,o_=Object.prototype.hasOwnProperty,s_=Object.prototype.propertyIsEnumerable,c_=(e,t,n)=>t in e?n_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,l_=(e,t)=>{for(var n in t||={})o_.call(t,n)&&c_(e,n,t[n]);if(a_)for(var n of a_(t))s_.call(t,n)&&c_(e,n,t[n]);return e},u_=(e,t)=>r_(e,i_(t)),d_=class{constructor(e,t,n,r){this.vectorLayerCache={},this.x=t,this.y=n,this.z=r,this.vectorTile=new e_.VectorTile(new t_.default(e))}getTileData(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];let t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;let n=[];for(let e=0;e<t.length;e++){let r=t.feature(e).toGeoJSON(this.x,this.y,this.z);n.push(u_(l_({},r),{properties:l_({id:r.id},r.properties)}))}return this.vectorLayerCache[e]=n,n}getFeatureById(){throw Error(`Method not implemented.`)}}}));function p_(e,t){let n=Array.isArray(e)?e[0]:e;return{data:n,dataArray:[],tilesetOptions:S_(x_(x_({},w_),t),{getTileData:(e,r)=>T_(n,e,r,t?.requestParameters,t?.getCustomData)}),isTile:!0}}var m_,h_,g_,__,v_,y_,b_,x_,S_,C_,w_,T_,E_=o((()=>{kp(),f_(),m_=Object.defineProperty,h_=Object.defineProperties,g_=Object.getOwnPropertyDescriptors,__=Object.getOwnPropertySymbols,v_=Object.prototype.hasOwnProperty,y_=Object.prototype.propertyIsEnumerable,b_=(e,t,n)=>t in e?m_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,x_=(e,t)=>{for(var n in t||={})v_.call(t,n)&&b_(e,n,t[n]);if(__)for(var n of __(t))y_.call(t,n)&&b_(e,n,t[n]);return e},S_=(e,t)=>h_(e,g_(t)),C_=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),w_={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},T_=(e,t,n,r,i)=>C_(void 0,null,function*(){let a=wp(e,t);return new Promise(e=>{if(i)i({x:n.x,y:n.y,z:n.z},(t,r)=>{e(t||!r?void 0:new d_(r,n.x,n.y,n.z))});else{let t=Uo(S_(x_({},r),{url:a}),(t,r)=>{e(t||!r?void 0:new d_(r,n.x,n.y,n.z))});n.xhrCancel=()=>t.cancel()}})})}));function D_(e,t,n){switch(e){case`+`:return t+n;case`-`:return t-n;case`*`:return t*n;case`/`:return t/n;case`%`:return t%n;case`^`:return t**+n;case`abs`:return Math.abs(t);case`floor`:return Math.floor(t);case`round`:return Math.round(t);case`ceil`:return Math.ceil(t);case`sin`:return Math.sin(t);case`cos`:return Math.cos(t);case`atan`:return n===-1?Math.atan(t):Math.atan2(t,n);case`min`:return Math.min(t,n);case`max`:return Math.max(t,n);case`log10`:return Math.log(t);case`log2`:return Math.log2(t);default:return console.warn(`Calculate symbol err! Return default 0`),0}}function O_(e,t){let{width:n,height:r}=t[0],i=t.map(e=>e.rasterData),a=n*r,o=[],s=JSON.stringify(e);for(let e=0;e<a;e++){let t=JSON.parse(s),n=k_(t,i,e);if(typeof n==`number`)o.push(n);else{let e=j_(t);o.push(e)}}return o}function k_(e,t,n){if(e.length===2&&e[0]===`band`&&typeof e[1]==`number`)try{return t[e[1]][n]}catch{return console.warn(`Raster Data err!`),0}e.map((r,i)=>{if(Array.isArray(r)&&r.length>0)switch(r[0]){case`band`:try{e[i]=t[r[1]][n]}catch{console.warn(`Raster Data err!`),e[i]=0}break;default:k_(r,t,n)}})}function A_(e){let[t,n=-1,r=-1]=e;return t===void 0?(console.warn(`Express err!`),[`+`,0,0]):[t.replace(/\s+/g,``),n,r]}function j_(e){let t=A_(e),n=t[0],r=t[1],i=t[2];return Array.isArray(r)&&(r=j_(e[1])),Array.isArray(i)&&(i=j_(e[2])),D_(n,r,i)}var M_=o((()=>{}));function N_(e,t){let n=e[0].rasterData,r=e[1].rasterData,i=e[2].rasterData,a=[],[o,s]=t?.countCut||[2,98],c=t?.RMinMax||P_(n,o,s),l=t?.GMinMax||P_(r,o,s),u=t?.BMinMax||P_(i,o,s);for(let e=0;e<n.length;e++)a.push(Math.max(0,n[e]-c[0])),a.push(Math.max(0,r[e]-l[0])),a.push(Math.max(0,i[e]-u[0]));return{rasterData:a,rMinMax:c,gMinMax:l,bMinMax:u}}function P_(e,t,n){let r=e.slice().sort((e,t)=>e-t),i=r.length;return[r[Math.ceil(i*t/100)],r[Math.ceil(i*n/100)]]}var F_,I_=o((()=>{F_={nd:{type:`operation`,expression:[`/`,[`-`,[`band`,1],[`band`,0]],[`+`,[`band`,1],[`band`,0]]]},rgb:{type:`function`,method:N_}}}));function L_(e,t,n){return X_(this,null,function*(){if(e.length===0)return{rasterData:[0],width:1,heigh:1};let r=yield Promise.all(e.map(({data:e,bands:n=[0]})=>t(e,n))),i=[];r.forEach(e=>{Array.isArray(e)?i.push(...e):i.push(e)});let{width:a,height:o}=i[0],s;switch(typeof n){case`function`:s=n(i);break;case`object`:s=Array.isArray(n)?{rasterData:O_(n,i)}:R_(n,i);break;default:s={rasterData:i[0].rasterData}}return Y_(J_({},s),{width:a,height:o})})}function R_(e,t){let n=F_[e.type];if(n.type===`function`)return n.method(t,e?.options);if(n.type===`operation`)return e.type===`rgb`?z_(n.expression,t):{rasterData:O_(n.expression,t)}}function z_(e,t){return e.r===void 0&&console.warn(`Channel R lost in Operation! Use band[0] to fill!`),e.g===void 0&&console.warn(`Channel G lost in Operation! Use band[0] to fill!`),e.b===void 0&&console.warn(`Channel B lost in Operation! Use band[0] to fill!`),[O_(e.r||[`band`,0],t),O_(e.g||[`band`,0],t),O_(e.b||[`band`,0],t)]}function B_(e,t,n,r){return X_(this,null,function*(){r(null,{data:yield L_(e,t,n)})})}var V_,H_,U_,W_,G_,K_,q_,J_,Y_,X_,Z_=o((()=>{M_(),I_(),V_=Object.defineProperty,H_=Object.defineProperties,U_=Object.getOwnPropertyDescriptors,W_=Object.getOwnPropertySymbols,G_=Object.prototype.hasOwnProperty,K_=Object.prototype.propertyIsEnumerable,q_=(e,t,n)=>t in e?V_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,J_=(e,t)=>{for(var n in t||={})G_.call(t,n)&&q_(e,n,t[n]);if(W_)for(var n of W_(t))K_.call(t,n)&&q_(e,n,t[n]);return e},Y_=(e,t)=>H_(e,U_(t)),X_=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())})}));function Q_(e,t){let{extent:n=[121.168,30.2828,121.384,30.4219],coordinates:r,width:i,height:a,min:o,max:s,format:c,operation:l}=t,u,d,f;c===void 0||nm(e)?(u=Array.from(e),d=i,f=a):u=L_(Array.isArray(e)?e:[e],c,l);let p=im(r,n);return{_id:1,dataArray:[{_id:1,data:u,width:d,height:f,min:o,max:s,coordinates:p}]}}var $_=o((()=>{Z_(),om()}));function ev(e){"@babel/helpers - typeof";return ev=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},ev(e)}var tv=o((()=>{}));function nv(e,t){if(ev(e)!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(ev(r)!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}var rv=o((()=>{tv()}));function iv(e){var t=nv(e,`string`);return ev(t)==`symbol`?t:t+``}var av=o((()=>{tv(),rv()}));function J(e,t,n){return(t=iv(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ov=o((()=>{av()}));function sv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?sv(Object(n),!0).forEach(function(t){J(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sv(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var cv=o((()=>{ov()})),lv,uv=o((()=>{lv=function(e){return e.Normal=`normal`,e.PostProcessing=`post-processing`,e}({})})),X,dv=o((()=>{X=function(e){return e[e.DEPTH_BUFFER_BIT=256]=`DEPTH_BUFFER_BIT`,e[e.STENCIL_BUFFER_BIT=1024]=`STENCIL_BUFFER_BIT`,e[e.COLOR_BUFFER_BIT=16384]=`COLOR_BUFFER_BIT`,e[e.POINTS=0]=`POINTS`,e[e.LINES=1]=`LINES`,e[e.LINE_LOOP=2]=`LINE_LOOP`,e[e.LINE_STRIP=3]=`LINE_STRIP`,e[e.TRIANGLES=4]=`TRIANGLES`,e[e.TRIANGLE_STRIP=5]=`TRIANGLE_STRIP`,e[e.TRIANGLE_FAN=6]=`TRIANGLE_FAN`,e[e.ZERO=0]=`ZERO`,e[e.ONE=1]=`ONE`,e[e.SRC_COLOR=768]=`SRC_COLOR`,e[e.ONE_MINUS_SRC_COLOR=769]=`ONE_MINUS_SRC_COLOR`,e[e.SRC_ALPHA=770]=`SRC_ALPHA`,e[e.ONE_MINUS_SRC_ALPHA=771]=`ONE_MINUS_SRC_ALPHA`,e[e.DST_ALPHA=772]=`DST_ALPHA`,e[e.ONE_MINUS_DST_ALPHA=773]=`ONE_MINUS_DST_ALPHA`,e[e.DST_COLOR=774]=`DST_COLOR`,e[e.ONE_MINUS_DST_COLOR=775]=`ONE_MINUS_DST_COLOR`,e[e.SRC_ALPHA_SATURATE=776]=`SRC_ALPHA_SATURATE`,e[e.FUNC_ADD=32774]=`FUNC_ADD`,e[e.BLEND_EQUATION=32777]=`BLEND_EQUATION`,e[e.BLEND_EQUATION_RGB=32777]=`BLEND_EQUATION_RGB`,e[e.BLEND_EQUATION_ALPHA=34877]=`BLEND_EQUATION_ALPHA`,e[e.FUNC_SUBTRACT=32778]=`FUNC_SUBTRACT`,e[e.FUNC_REVERSE_SUBTRACT=32779]=`FUNC_REVERSE_SUBTRACT`,e[e.MAX_EXT=32776]=`MAX_EXT`,e[e.MIN_EXT=32775]=`MIN_EXT`,e[e.BLEND_DST_RGB=32968]=`BLEND_DST_RGB`,e[e.BLEND_SRC_RGB=32969]=`BLEND_SRC_RGB`,e[e.BLEND_DST_ALPHA=32970]=`BLEND_DST_ALPHA`,e[e.BLEND_SRC_ALPHA=32971]=`BLEND_SRC_ALPHA`,e[e.CONSTANT_COLOR=32769]=`CONSTANT_COLOR`,e[e.ONE_MINUS_CONSTANT_COLOR=32770]=`ONE_MINUS_CONSTANT_COLOR`,e[e.CONSTANT_ALPHA=32771]=`CONSTANT_ALPHA`,e[e.ONE_MINUS_CONSTANT_ALPHA=32772]=`ONE_MINUS_CONSTANT_ALPHA`,e[e.BLEND_COLOR=32773]=`BLEND_COLOR`,e[e.ARRAY_BUFFER=34962]=`ARRAY_BUFFER`,e[e.ELEMENT_ARRAY_BUFFER=34963]=`ELEMENT_ARRAY_BUFFER`,e[e.ARRAY_BUFFER_BINDING=34964]=`ARRAY_BUFFER_BINDING`,e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]=`ELEMENT_ARRAY_BUFFER_BINDING`,e[e.STREAM_DRAW=35040]=`STREAM_DRAW`,e[e.STATIC_DRAW=35044]=`STATIC_DRAW`,e[e.DYNAMIC_DRAW=35048]=`DYNAMIC_DRAW`,e[e.BUFFER_SIZE=34660]=`BUFFER_SIZE`,e[e.BUFFER_USAGE=34661]=`BUFFER_USAGE`,e[e.CURRENT_VERTEX_ATTRIB=34342]=`CURRENT_VERTEX_ATTRIB`,e[e.FRONT=1028]=`FRONT`,e[e.BACK=1029]=`BACK`,e[e.FRONT_AND_BACK=1032]=`FRONT_AND_BACK`,e[e.CULL_FACE=2884]=`CULL_FACE`,e[e.BLEND=3042]=`BLEND`,e[e.DITHER=3024]=`DITHER`,e[e.STENCIL_TEST=2960]=`STENCIL_TEST`,e[e.DEPTH_TEST=2929]=`DEPTH_TEST`,e[e.SCISSOR_TEST=3089]=`SCISSOR_TEST`,e[e.POLYGON_OFFSET_FILL=32823]=`POLYGON_OFFSET_FILL`,e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]=`SAMPLE_ALPHA_TO_COVERAGE`,e[e.SAMPLE_COVERAGE=32928]=`SAMPLE_COVERAGE`,e[e.NO_ERROR=0]=`NO_ERROR`,e[e.INVALID_ENUM=1280]=`INVALID_ENUM`,e[e.INVALID_VALUE=1281]=`INVALID_VALUE`,e[e.INVALID_OPERATION=1282]=`INVALID_OPERATION`,e[e.OUT_OF_MEMORY=1285]=`OUT_OF_MEMORY`,e[e.CW=2304]=`CW`,e[e.CCW=2305]=`CCW`,e[e.LINE_WIDTH=2849]=`LINE_WIDTH`,e[e.ALIASED_POINT_SIZE_RANGE=33901]=`ALIASED_POINT_SIZE_RANGE`,e[e.ALIASED_LINE_WIDTH_RANGE=33902]=`ALIASED_LINE_WIDTH_RANGE`,e[e.CULL_FACE_MODE=2885]=`CULL_FACE_MODE`,e[e.FRONT_FACE=2886]=`FRONT_FACE`,e[e.DEPTH_RANGE=2928]=`DEPTH_RANGE`,e[e.DEPTH_WRITEMASK=2930]=`DEPTH_WRITEMASK`,e[e.DEPTH_CLEAR_VALUE=2931]=`DEPTH_CLEAR_VALUE`,e[e.DEPTH_FUNC=2932]=`DEPTH_FUNC`,e[e.STENCIL_CLEAR_VALUE=2961]=`STENCIL_CLEAR_VALUE`,e[e.STENCIL_FUNC=2962]=`STENCIL_FUNC`,e[e.STENCIL_FAIL=2964]=`STENCIL_FAIL`,e[e.STENCIL_PASS_DEPTH_FAIL=2965]=`STENCIL_PASS_DEPTH_FAIL`,e[e.STENCIL_PASS_DEPTH_PASS=2966]=`STENCIL_PASS_DEPTH_PASS`,e[e.STENCIL_REF=2967]=`STENCIL_REF`,e[e.STENCIL_VALUE_MASK=2963]=`STENCIL_VALUE_MASK`,e[e.STENCIL_WRITEMASK=2968]=`STENCIL_WRITEMASK`,e[e.STENCIL_BACK_FUNC=34816]=`STENCIL_BACK_FUNC`,e[e.STENCIL_BACK_FAIL=34817]=`STENCIL_BACK_FAIL`,e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]=`STENCIL_BACK_PASS_DEPTH_FAIL`,e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]=`STENCIL_BACK_PASS_DEPTH_PASS`,e[e.STENCIL_BACK_REF=36003]=`STENCIL_BACK_REF`,e[e.STENCIL_BACK_VALUE_MASK=36004]=`STENCIL_BACK_VALUE_MASK`,e[e.STENCIL_BACK_WRITEMASK=36005]=`STENCIL_BACK_WRITEMASK`,e[e.VIEWPORT=2978]=`VIEWPORT`,e[e.SCISSOR_BOX=3088]=`SCISSOR_BOX`,e[e.COLOR_CLEAR_VALUE=3106]=`COLOR_CLEAR_VALUE`,e[e.COLOR_WRITEMASK=3107]=`COLOR_WRITEMASK`,e[e.UNPACK_ALIGNMENT=3317]=`UNPACK_ALIGNMENT`,e[e.PACK_ALIGNMENT=3333]=`PACK_ALIGNMENT`,e[e.MAX_TEXTURE_SIZE=3379]=`MAX_TEXTURE_SIZE`,e[e.MAX_VIEWPORT_DIMS=3386]=`MAX_VIEWPORT_DIMS`,e[e.SUBPIXEL_BITS=3408]=`SUBPIXEL_BITS`,e[e.RED_BITS=3410]=`RED_BITS`,e[e.GREEN_BITS=3411]=`GREEN_BITS`,e[e.BLUE_BITS=3412]=`BLUE_BITS`,e[e.ALPHA_BITS=3413]=`ALPHA_BITS`,e[e.DEPTH_BITS=3414]=`DEPTH_BITS`,e[e.STENCIL_BITS=3415]=`STENCIL_BITS`,e[e.POLYGON_OFFSET_UNITS=10752]=`POLYGON_OFFSET_UNITS`,e[e.POLYGON_OFFSET_FACTOR=32824]=`POLYGON_OFFSET_FACTOR`,e[e.TEXTURE_BINDING_2D=32873]=`TEXTURE_BINDING_2D`,e[e.SAMPLE_BUFFERS=32936]=`SAMPLE_BUFFERS`,e[e.SAMPLES=32937]=`SAMPLES`,e[e.SAMPLE_COVERAGE_VALUE=32938]=`SAMPLE_COVERAGE_VALUE`,e[e.SAMPLE_COVERAGE_INVERT=32939]=`SAMPLE_COVERAGE_INVERT`,e[e.COMPRESSED_TEXTURE_FORMATS=34467]=`COMPRESSED_TEXTURE_FORMATS`,e[e.DONT_CARE=4352]=`DONT_CARE`,e[e.FASTEST=4353]=`FASTEST`,e[e.NICEST=4354]=`NICEST`,e[e.GENERATE_MIPMAP_HINT=33170]=`GENERATE_MIPMAP_HINT`,e[e.BYTE=5120]=`BYTE`,e[e.UNSIGNED_BYTE=5121]=`UNSIGNED_BYTE`,e[e.SHORT=5122]=`SHORT`,e[e.UNSIGNED_SHORT=5123]=`UNSIGNED_SHORT`,e[e.INT=5124]=`INT`,e[e.UNSIGNED_INT=5125]=`UNSIGNED_INT`,e[e.FLOAT=5126]=`FLOAT`,e[e.DEPTH_COMPONENT=6402]=`DEPTH_COMPONENT`,e[e.ALPHA=6406]=`ALPHA`,e[e.RGB=6407]=`RGB`,e[e.RGBA=6408]=`RGBA`,e[e.LUMINANCE=6409]=`LUMINANCE`,e[e.LUMINANCE_ALPHA=6410]=`LUMINANCE_ALPHA`,e[e.RED=6403]=`RED`,e[e.UNSIGNED_SHORT_4_4_4_4=32819]=`UNSIGNED_SHORT_4_4_4_4`,e[e.UNSIGNED_SHORT_5_5_5_1=32820]=`UNSIGNED_SHORT_5_5_5_1`,e[e.UNSIGNED_SHORT_5_6_5=33635]=`UNSIGNED_SHORT_5_6_5`,e[e.FRAGMENT_SHADER=35632]=`FRAGMENT_SHADER`,e[e.VERTEX_SHADER=35633]=`VERTEX_SHADER`,e[e.MAX_VERTEX_ATTRIBS=34921]=`MAX_VERTEX_ATTRIBS`,e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]=`MAX_VERTEX_UNIFORM_VECTORS`,e[e.MAX_VARYING_VECTORS=36348]=`MAX_VARYING_VECTORS`,e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]=`MAX_COMBINED_TEXTURE_IMAGE_UNITS`,e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]=`MAX_VERTEX_TEXTURE_IMAGE_UNITS`,e[e.MAX_TEXTURE_IMAGE_UNITS=34930]=`MAX_TEXTURE_IMAGE_UNITS`,e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]=`MAX_FRAGMENT_UNIFORM_VECTORS`,e[e.SHADER_TYPE=35663]=`SHADER_TYPE`,e[e.DELETE_STATUS=35712]=`DELETE_STATUS`,e[e.LINK_STATUS=35714]=`LINK_STATUS`,e[e.VALIDATE_STATUS=35715]=`VALIDATE_STATUS`,e[e.ATTACHED_SHADERS=35717]=`ATTACHED_SHADERS`,e[e.ACTIVE_UNIFORMS=35718]=`ACTIVE_UNIFORMS`,e[e.ACTIVE_ATTRIBUTES=35721]=`ACTIVE_ATTRIBUTES`,e[e.SHADING_LANGUAGE_VERSION=35724]=`SHADING_LANGUAGE_VERSION`,e[e.CURRENT_PROGRAM=35725]=`CURRENT_PROGRAM`,e[e.NEVER=512]=`NEVER`,e[e.LESS=513]=`LESS`,e[e.EQUAL=514]=`EQUAL`,e[e.LEQUAL=515]=`LEQUAL`,e[e.GREATER=516]=`GREATER`,e[e.NOTEQUAL=517]=`NOTEQUAL`,e[e.GEQUAL=518]=`GEQUAL`,e[e.ALWAYS=519]=`ALWAYS`,e[e.KEEP=7680]=`KEEP`,e[e.REPLACE=7681]=`REPLACE`,e[e.INCR=7682]=`INCR`,e[e.DECR=7683]=`DECR`,e[e.INVERT=5386]=`INVERT`,e[e.INCR_WRAP=34055]=`INCR_WRAP`,e[e.DECR_WRAP=34056]=`DECR_WRAP`,e[e.VENDOR=7936]=`VENDOR`,e[e.RENDERER=7937]=`RENDERER`,e[e.VERSION=7938]=`VERSION`,e[e.NEAREST=9728]=`NEAREST`,e[e.LINEAR=9729]=`LINEAR`,e[e.NEAREST_MIPMAP_NEAREST=9984]=`NEAREST_MIPMAP_NEAREST`,e[e.LINEAR_MIPMAP_NEAREST=9985]=`LINEAR_MIPMAP_NEAREST`,e[e.NEAREST_MIPMAP_LINEAR=9986]=`NEAREST_MIPMAP_LINEAR`,e[e.LINEAR_MIPMAP_LINEAR=9987]=`LINEAR_MIPMAP_LINEAR`,e[e.TEXTURE_MAG_FILTER=10240]=`TEXTURE_MAG_FILTER`,e[e.TEXTURE_MIN_FILTER=10241]=`TEXTURE_MIN_FILTER`,e[e.TEXTURE_WRAP_S=10242]=`TEXTURE_WRAP_S`,e[e.TEXTURE_WRAP_T=10243]=`TEXTURE_WRAP_T`,e[e.TEXTURE_2D=3553]=`TEXTURE_2D`,e[e.TEXTURE=5890]=`TEXTURE`,e[e.TEXTURE_CUBE_MAP=34067]=`TEXTURE_CUBE_MAP`,e[e.TEXTURE_BINDING_CUBE_MAP=34068]=`TEXTURE_BINDING_CUBE_MAP`,e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]=`TEXTURE_CUBE_MAP_POSITIVE_X`,e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]=`TEXTURE_CUBE_MAP_NEGATIVE_X`,e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]=`TEXTURE_CUBE_MAP_POSITIVE_Y`,e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]=`TEXTURE_CUBE_MAP_NEGATIVE_Y`,e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]=`TEXTURE_CUBE_MAP_POSITIVE_Z`,e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]=`TEXTURE_CUBE_MAP_NEGATIVE_Z`,e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]=`MAX_CUBE_MAP_TEXTURE_SIZE`,e[e.TEXTURE0=33984]=`TEXTURE0`,e[e.TEXTURE1=33985]=`TEXTURE1`,e[e.TEXTURE2=33986]=`TEXTURE2`,e[e.TEXTURE3=33987]=`TEXTURE3`,e[e.TEXTURE4=33988]=`TEXTURE4`,e[e.TEXTURE5=33989]=`TEXTURE5`,e[e.TEXTURE6=33990]=`TEXTURE6`,e[e.TEXTURE7=33991]=`TEXTURE7`,e[e.TEXTURE8=33992]=`TEXTURE8`,e[e.TEXTURE9=33993]=`TEXTURE9`,e[e.TEXTURE10=33994]=`TEXTURE10`,e[e.TEXTURE11=33995]=`TEXTURE11`,e[e.TEXTURE12=33996]=`TEXTURE12`,e[e.TEXTURE13=33997]=`TEXTURE13`,e[e.TEXTURE14=33998]=`TEXTURE14`,e[e.TEXTURE15=33999]=`TEXTURE15`,e[e.TEXTURE16=34e3]=`TEXTURE16`,e[e.TEXTURE17=34001]=`TEXTURE17`,e[e.TEXTURE18=34002]=`TEXTURE18`,e[e.TEXTURE19=34003]=`TEXTURE19`,e[e.TEXTURE20=34004]=`TEXTURE20`,e[e.TEXTURE21=34005]=`TEXTURE21`,e[e.TEXTURE22=34006]=`TEXTURE22`,e[e.TEXTURE23=34007]=`TEXTURE23`,e[e.TEXTURE24=34008]=`TEXTURE24`,e[e.TEXTURE25=34009]=`TEXTURE25`,e[e.TEXTURE26=34010]=`TEXTURE26`,e[e.TEXTURE27=34011]=`TEXTURE27`,e[e.TEXTURE28=34012]=`TEXTURE28`,e[e.TEXTURE29=34013]=`TEXTURE29`,e[e.TEXTURE30=34014]=`TEXTURE30`,e[e.TEXTURE31=34015]=`TEXTURE31`,e[e.ACTIVE_TEXTURE=34016]=`ACTIVE_TEXTURE`,e[e.REPEAT=10497]=`REPEAT`,e[e.CLAMP_TO_EDGE=33071]=`CLAMP_TO_EDGE`,e[e.MIRRORED_REPEAT=33648]=`MIRRORED_REPEAT`,e[e.FLOAT_VEC2=35664]=`FLOAT_VEC2`,e[e.FLOAT_VEC3=35665]=`FLOAT_VEC3`,e[e.FLOAT_VEC4=35666]=`FLOAT_VEC4`,e[e.INT_VEC2=35667]=`INT_VEC2`,e[e.INT_VEC3=35668]=`INT_VEC3`,e[e.INT_VEC4=35669]=`INT_VEC4`,e[e.BOOL=35670]=`BOOL`,e[e.BOOL_VEC2=35671]=`BOOL_VEC2`,e[e.BOOL_VEC3=35672]=`BOOL_VEC3`,e[e.BOOL_VEC4=35673]=`BOOL_VEC4`,e[e.FLOAT_MAT2=35674]=`FLOAT_MAT2`,e[e.FLOAT_MAT3=35675]=`FLOAT_MAT3`,e[e.FLOAT_MAT4=35676]=`FLOAT_MAT4`,e[e.SAMPLER_2D=35678]=`SAMPLER_2D`,e[e.SAMPLER_CUBE=35680]=`SAMPLER_CUBE`,e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]=`VERTEX_ATTRIB_ARRAY_ENABLED`,e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]=`VERTEX_ATTRIB_ARRAY_SIZE`,e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]=`VERTEX_ATTRIB_ARRAY_STRIDE`,e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]=`VERTEX_ATTRIB_ARRAY_TYPE`,e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]=`VERTEX_ATTRIB_ARRAY_NORMALIZED`,e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]=`VERTEX_ATTRIB_ARRAY_POINTER`,e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]=`VERTEX_ATTRIB_ARRAY_BUFFER_BINDING`,e[e.COMPILE_STATUS=35713]=`COMPILE_STATUS`,e[e.LOW_FLOAT=36336]=`LOW_FLOAT`,e[e.MEDIUM_FLOAT=36337]=`MEDIUM_FLOAT`,e[e.HIGH_FLOAT=36338]=`HIGH_FLOAT`,e[e.LOW_INT=36339]=`LOW_INT`,e[e.MEDIUM_INT=36340]=`MEDIUM_INT`,e[e.HIGH_INT=36341]=`HIGH_INT`,e[e.FRAMEBUFFER=36160]=`FRAMEBUFFER`,e[e.RENDERBUFFER=36161]=`RENDERBUFFER`,e[e.RGBA4=32854]=`RGBA4`,e[e.RGB5_A1=32855]=`RGB5_A1`,e[e.RGB565=36194]=`RGB565`,e[e.DEPTH_COMPONENT16=33189]=`DEPTH_COMPONENT16`,e[e.STENCIL_INDEX=6401]=`STENCIL_INDEX`,e[e.STENCIL_INDEX8=36168]=`STENCIL_INDEX8`,e[e.DEPTH_STENCIL=34041]=`DEPTH_STENCIL`,e[e.RENDERBUFFER_WIDTH=36162]=`RENDERBUFFER_WIDTH`,e[e.RENDERBUFFER_HEIGHT=36163]=`RENDERBUFFER_HEIGHT`,e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]=`RENDERBUFFER_INTERNAL_FORMAT`,e[e.RENDERBUFFER_RED_SIZE=36176]=`RENDERBUFFER_RED_SIZE`,e[e.RENDERBUFFER_GREEN_SIZE=36177]=`RENDERBUFFER_GREEN_SIZE`,e[e.RENDERBUFFER_BLUE_SIZE=36178]=`RENDERBUFFER_BLUE_SIZE`,e[e.RENDERBUFFER_ALPHA_SIZE=36179]=`RENDERBUFFER_ALPHA_SIZE`,e[e.RENDERBUFFER_DEPTH_SIZE=36180]=`RENDERBUFFER_DEPTH_SIZE`,e[e.RENDERBUFFER_STENCIL_SIZE=36181]=`RENDERBUFFER_STENCIL_SIZE`,e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]=`FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE`,e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]=`FRAMEBUFFER_ATTACHMENT_OBJECT_NAME`,e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]=`FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL`,e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]=`FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE`,e[e.COLOR_ATTACHMENT0=36064]=`COLOR_ATTACHMENT0`,e[e.DEPTH_ATTACHMENT=36096]=`DEPTH_ATTACHMENT`,e[e.STENCIL_ATTACHMENT=36128]=`STENCIL_ATTACHMENT`,e[e.DEPTH_STENCIL_ATTACHMENT=33306]=`DEPTH_STENCIL_ATTACHMENT`,e[e.NONE=0]=`NONE`,e[e.FRAMEBUFFER_COMPLETE=36053]=`FRAMEBUFFER_COMPLETE`,e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]=`FRAMEBUFFER_INCOMPLETE_ATTACHMENT`,e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]=`FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT`,e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]=`FRAMEBUFFER_INCOMPLETE_DIMENSIONS`,e[e.FRAMEBUFFER_UNSUPPORTED=36061]=`FRAMEBUFFER_UNSUPPORTED`,e[e.FRAMEBUFFER_BINDING=36006]=`FRAMEBUFFER_BINDING`,e[e.RENDERBUFFER_BINDING=36007]=`RENDERBUFFER_BINDING`,e[e.MAX_RENDERBUFFER_SIZE=34024]=`MAX_RENDERBUFFER_SIZE`,e[e.INVALID_FRAMEBUFFER_OPERATION=1286]=`INVALID_FRAMEBUFFER_OPERATION`,e[e.UNPACK_FLIP_Y_WEBGL=37440]=`UNPACK_FLIP_Y_WEBGL`,e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]=`UNPACK_PREMULTIPLY_ALPHA_WEBGL`,e[e.CONTEXT_LOST_WEBGL=37442]=`CONTEXT_LOST_WEBGL`,e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]=`UNPACK_COLORSPACE_CONVERSION_WEBGL`,e[e.BROWSER_DEFAULT_WEBGL=37444]=`BROWSER_DEFAULT_WEBGL`,e}({})})),fv,pv,mv,hv,gv,_v=o((()=>{cv(),ov(),kp(),uv(),dv(),fv=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,{camelCase:pv,isNil:mv,upperFirst:hv}=tu,gv=class{constructor(){J(this,`shaderModuleService`,void 0),J(this,`rendererService`,void 0),J(this,`config`,void 0),J(this,`quad`,fv),J(this,`enabled`,!0),J(this,`renderToScreen`,!1),J(this,`model`,void 0),J(this,`name`,void 0),J(this,`optionsToUpdate`,{})}getName(){return this.name}setName(e){this.name=e}getType(){return lv.PostProcessing}init(e,t){this.config=t,this.rendererService=e.getContainer().rendererService,this.shaderModuleService=e.getContainer().shaderModuleService;let{createAttribute:n,createBuffer:r,createModel:i}=this.rendererService,{vs:a,fs:o,uniforms:s}=this.setupShaders();this.model=i({vs:a,fs:o,attributes:{a_Position:n({buffer:r({data:[-4,-4,4,-4,0,4],type:X.FLOAT}),size:2})},uniforms:Y(Y({u_Texture:null},s),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()===`copy`}})}render(e,t){let n=e.multiPassRenderer.getPostProcessor(),{useFramebuffer:r,getViewportSize:i,clear:a}=this.rendererService,{width:o,height:s}=i();r(this.renderToScreen?null:n.getWriteFBO(),()=>{a({framebuffer:n.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});let e=Y({u_BloomFinal:0,u_Texture:n.getReadFBO(),u_ViewportSize:[o,s]},this.convertOptionsToUniforms(this.optionsToUpdate));t&&(e.u_BloomFinal=1,e.u_Texture2=t),this.model.draw({uniforms:e})})}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}setRenderToScreen(e){this.renderToScreen=e}updateOptions(e){this.optionsToUpdate=Y(Y({},this.optionsToUpdate),e)}setupShaders(){throw Error(`Method not implemented.`)}convertOptionsToUniforms(e){let t={};return Object.keys(e).forEach(n=>{mv(e[n])||(t[`u_${hv(pv(n))}`]=e[n])}),t}}}));function vv(e){let t=0;switch(e){case`vec2`:case`ivec2`:t=2;break;case`vec3`:case`ivec3`:t=3;break;case`vec4`:case`ivec4`:case`mat2`:t=4;break;case`mat3`:t=9;break;case`mat4`:t=16;break;default:}return t}function yv(e,t=!1){let n={};return e=e.replace(Sv,(e,r,i)=>{let a=i.split(`:`),o=a[0].trim(),s=``;switch(a.length>1&&(s=a[1].trim()),r){case`bool`:s=s===`true`;break;case`float`:case`int`:s=Number(s);break;case`vec2`:case`vec3`:case`vec4`:case`ivec2`:case`ivec3`:case`ivec4`:case`mat2`:case`mat3`:case`mat4`:s=s?s.replace(`[`,``).replace(`]`,``).split(`,`).reduce((e,t)=>(e.push(Number(t.trim())),e),[]):Array(vv(r)).fill(0);break;default:}return n[o]=s,`${t?`uniform `:``}${r} ${o};\n`}),{content:e,uniforms:n}}function bv(e){let{content:t,uniforms:n}=yv(e,!0);return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(e,t,r)=>{r=r.trim().replace(/^.*$/gm,e=>`uniform ${e}`);let{content:i,uniforms:a}=yv(r);return Object.assign(n,a),`${t}{\n${i}\n};`}),{content:t,uniforms:n}}function xv(e){let t={};return e.replace(Sv,(e,n,r)=>{let i=r.trim();return t[i]?``:(t[i]=!0,`uniform ${n} ${i};\n`)})}var Sv,Cv=o((()=>{Sv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g}));function wv(e){return Tv.indexOf(e)}var Tv,Ev=o((()=>{Tv=[`circle`,`triangle`,`square`,`pentagon`,`hexagon`,`octogon`,`hexagram`,`rhombus`,`vesica`]}));function Dv(e,t){return e=kv(Math.floor(e),0,255),t=kv(Math.floor(t),0,255),256*e+t}function Ov(e){let{color:t,radius:n,tileX:r,tileY:i,shape:a,opacity:o,stroke:s,strokeWidth:c,strokeOpacity:l}=e,u=[],d=[],f=[],p=[Dv(t[0],t[1]),Dv(t[2],t[3])],m=[Dv(s[0],s[1]),Dv(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(([e,t])=>{u.push([...p,(e+1)*Nv+(t+1)*Mv+wv(a)*Av+n,(r+512)*jv+(i+512)*64]),d.push([...m,c,l]),f.push([o,0,0,0])}),{packedBuffer:u,packedBuffer2:d,packedBuffer3:f}}var kv,Av,jv,Mv,Nv,Pv=o((()=>{kp(),Ev(),{clamp:kv}=tu,Av=131072,jv=524288,Mv=2097152,Nv=8388608})),Fv=o((()=>{})),Iv=o((()=>{})),Lv=o((()=>{})),Rv,zv=o((()=>{Rv={ProjectionMatrix:`u_ProjectionMatrix`,ViewMatrix:`u_ViewMatrix`,ViewProjectionMatrix:`u_ViewProjectionMatrix`,Zoom:`u_Zoom`,ZoomScale:`u_ZoomScale`,FocalDistance:`u_FocalDistance`,CameraPosition:`u_CameraPosition`}})),Bv,Vv=o((()=>{Bv=function(e){return e.TOPRIGHT=`topright`,e.TOPLEFT=`topleft`,e.BOTTOMRIGHT=`bottomright`,e.BOTTOMLEFT=`bottomleft`,e.TOPCENTER=`topcenter`,e.BOTTOMCENTER=`bottomcenter`,e.LEFTCENTER=`leftcenter`,e.RIGHTCENTER=`rightcenter`,e.LEFTTOP=`lefttop`,e.RIGHTTOP=`righttop`,e.LEFTBOTTOM=`leftbottom`,e.RIGHTBOTTOM=`rightbottom`,e}({})})),Hv=o((()=>{})),Uv=o((()=>{})),Wv=o((()=>{})),Gv,Kv,qv=o((()=>{Gv=function(e){return e[e.LNGLAT=1]=`LNGLAT`,e[e.LNGLAT_OFFSET=2]=`LNGLAT_OFFSET`,e[e.VECTOR_TILE=3]=`VECTOR_TILE`,e[e.IDENTITY=4]=`IDENTITY`,e[e.METER_OFFSET=5]=`METER_OFFSET`,e}({}),Kv={CoordinateSystem:`u_CoordinateSystem`,ViewportCenter:`u_ViewportCenter`,ViewportCenterProjection:`u_ViewportCenterProjection`,PixelsPerDegree:`u_PixelsPerDegree`,PixelsPerDegree2:`u_PixelsPerDegree2`,PixelsPerMeter:`u_PixelsPerMeter`,RelativeOrigin:`u_RelativeOrigin`}})),Jv,Yv=o((()=>{Jv={MapInitStart:`mapInitStart`,LayerInitStart:`layerInitStart`,LayerInitEnd:`layerInitEnd`,SourceInitStart:`sourceInitStart`,SourceInitEnd:`sourceInitEnd`,ScaleInitStart:`scaleInitStart`,ScaleInitEnd:`scaleInitEnd`,MappingStart:`mappingStart`,MappingEnd:`mappingEnd`,BuildModelStart:`buildModelStart`,BuildModelEnd:`buildModelEnd`}})),Xv,Zv=o((()=>{Xv=function(e){return e.Hover=`hover`,e.Click=`click`,e.Select=`select`,e.Active=`active`,e.Drag=`drag`,e}({})})),Qv=o((()=>{})),$v,ey,ty,ny,ry=o((()=>{$v=function(e){return e.normal=`normal`,e.additive=`additive`,e.subtractive=`subtractive`,e.min=`min`,e.max=`max`,e.none=`none`,e}({}),ey=function(e){return e.MULTIPLE=`MULTIPLE`,e.SINGLE=`SINGLE`,e}({}),ty=function(e){return e.AND=`and`,e.OR=`or`,e}({}),ny=function(e){return e.INIT=`init`,e.UPDATE=`update`,e}({})})),iy,ay,oy,sy=o((()=>{iy=function(e){return e.LINEAR=`linear`,e.SEQUENTIAL=`sequential`,e.POWER=`power`,e.LOG=`log`,e.IDENTITY=`identity`,e.TIME=`time`,e.QUANTILE=`quantile`,e.QUANTIZE=`quantize`,e.THRESHOLD=`threshold`,e.CAT=`cat`,e.DIVERGING=`diverging`,e.CUSTOM=`threshold`,e}({}),ay=function(e){return e.CONSTANT=`constant`,e.VARIABLE=`variable`,e}({}),oy=function(e){return e[e.Attribute=0]=`Attribute`,e[e.InstancedAttribute=1]=`InstancedAttribute`,e[e.Uniform=2]=`Uniform`,e}({})})),cy,ly=o((()=>{cy=[`mapload`,`mapchange`,`mapAfterFrameChange`]})),uy=s(((e,t)=>{t.exports=r,t.exports.default=r;var n=0x56bc75e2d63100000;function r(e,t,n,r,i,a){this.fontSize=e||24,this.buffer=t===void 0?3:t,this.cutoff=r||.25,this.fontFamily=i||`sans-serif`,this.fontWeight=a||`normal`,this.radius=n||8;var o=this.size=this.fontSize+this.buffer*2,s=o+this.buffer*2;this.canvas=document.createElement(`canvas`),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext(`2d`),this.ctx.font=this.fontWeight+` `+this.fontSize+`px `+this.fontFamily,this.ctx.textAlign=`left`,this.ctx.fillStyle=`black`,this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=this.ctx.measureText(`A`).actualBoundingBoxLeft!==void 0,this.middle=Math.round(o/2*(navigator.userAgent.indexOf(`Gecko/`)>=0?1.2:1))}function i(e,t,r,i,a,o,s){o.fill(n,0,t*r),s.fill(0,0,t*r);for(var c=(t-i)/2,l=0;l<a;l++)for(var u=0;u<i;u++){var d=(l+c)*t+u+c,f=e.data[4*(l*i+u)+3]/255;if(f===1)o[d]=0,s[d]=n;else if(f===0)o[d]=n,s[d]=0;else{var p=Math.max(0,.5-f),m=Math.max(0,f-.5);o[d]=p*p,s[d]=m*m}}}function a(e,t,n,r,i,a,o){for(var s=0;s<t*n;s++){var c=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(c/a+o))}}r.prototype._draw=function(e,t){var n=this.ctx.measureText(e),r=n.width,s=2*this.buffer,c,l,u,d,f,p,m,h;t&&this.useMetrics?(f=Math.floor(n.actualBoundingBoxAscent),h=this.buffer+Math.ceil(n.actualBoundingBoxAscent),p=this.buffer,m=this.buffer,l=Math.min(this.size,Math.ceil(n.actualBoundingBoxRight-n.actualBoundingBoxLeft)),d=Math.min(this.size-p,Math.ceil(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)),c=l+s,u=d+s,this.ctx.textBaseline=`alphabetic`):(c=l=this.size,u=d=this.size,f=19*this.fontSize/24,p=m=0,h=this.middle,this.ctx.textBaseline=`middle`);var g;l&&d&&(this.ctx.clearRect(m,p,l,d),this.ctx.fillText(e,this.buffer,h),g=this.ctx.getImageData(m,p,l,d));var _=new Uint8ClampedArray(c*u);return i(g,c,u,l,d,this.gridOuter,this.gridInner),o(this.gridOuter,c,u,this.f,this.v,this.z),o(this.gridInner,c,u,this.f,this.v,this.z),a(_,c,u,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:_,metrics:{width:l,height:d,sdfWidth:c,sdfHeight:u,top:f,left:0,advance:r}}},r.prototype.draw=function(e){return this._draw(e,!1).data},r.prototype.drawWithMetrics=function(e){return this._draw(e,!0)};function o(e,t,n,r,i,a){for(var o=0;o<t;o++)s(e,o,t,n,r,i,a);for(var c=0;c<n;c++)s(e,c*t,1,t,r,i,a)}function s(e,t,r,i,a,o,s){var c,l,u,d;for(o[0]=0,s[0]=-n,s[1]=n,c=0;c<i;c++)a[c]=e[t+c*r];for(c=1,l=0,u=0;c<i;c++){do d=o[l],u=(a[c]-a[d]+c*c-d*d)/(c-d)/2;while(u<=s[l]&&--l>-1);l++,o[l]=c,s[l]=u,s[l+1]=n}for(c=0,l=0;c<i;c++){for(;s[l+1]<c;)l++;d=o[l],e[t+c*r]=a[d]+(c-d)*(c-d)}}}));function dy({characterSet:e,getFontWidth:t,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:a={},xOffset:o=0,yOffset:s=0}){let c=0,l=o;Array.from(e).forEach((e,n)=>{if(!a[e]){let r=t(e,n);l+gy>i&&(l=0,c++),a[e]={x:l,y:s+c*gy,width:gy,height:gy,advance:r},l+=gy}});let u=n+r*2;return{mapping:a,xOffset:l,yOffset:s+c*u,canvasHeight:hy(s+(c+1)*u)}}function fy(e,t,n){let r=0,i=0,a=0,o=[],s={};for(let c of e)if(!s[c.id]){let{size:e}=c;r+e+t>n&&(py(s,o,i),r=0,i=a+i+t,a=0,o=[]),o.push({icon:c,xOffset:r}),r=r+e+t,a=Math.max(a,e)}return o.length>0&&py(s,o,i),{mapping:s,canvasHeight:hy(a+i+t)}}function py(e,t,n){for(let r of t){let{icon:t,xOffset:i}=r;e[t.id]=Y(Y({},t),{},{x:i,y:n,image:t.image,width:t.width,height:t.height})}}function hy(e){return 2**Math.ceil(Math.log2(e))}var gy,_y=o((()=>{cv(),gy=30}));function vy(){let e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}function yy(e,t,n,r){e.font=`${r} ${n}px ${t}`,e.fillStyle=`black`,e.textBaseline=`middle`}function by(e,t){for(let n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var xy,Sy,Cy,wy,Ty,Ey,Dy,Oy,ky,Ay,jy,My=o((()=>{cv(),ov(),kp(),xy=u(uy()),Sy=u(Mf()),_y(),Cy=vy(),wy=`sans-serif`,Ty=`normal`,Ey=.25,Dy=1024,Oy=1,ky=1,Ay=3,jy=class extends Sy.EventEmitter{constructor(...e){super(...e),J(this,`fontAtlas`,void 0),J(this,`iconFontMap`,void 0),J(this,`iconFontGlyphs`,{}),J(this,`fontOptions`,void 0),J(this,`key`,void 0),J(this,`cache`,new vf(Ay))}get scale(){return ky}get canvas(){let e=this.cache.get(this.key);return e&&e.data}get mapping(){let e=this.cache.get(this.key);return e&&e.mapping||{}}getCanvasByKey(e){let t=this.cache.get(e);return t&&t.data}getMappingByKey(e){let t=this.cache.get(e);return t&&t.mapping||{}}init(){this.cache.clear(),this.fontOptions={fontFamily:wy,fontWeight:Ty,characterSet:Cy,fontSize:24,buffer:3,sdf:!0,cutoff:Ey,radius:8,iconfont:!1},this.key=``,this.iconFontMap=new Map}addIconGlyphs(e){e.forEach(e=>{this.iconFontGlyphs[e.name]=e.unicode})}addIconFont(e,t){this.iconFontMap.set(e,t)}getIconFontKey(e){return this.iconFontMap.get(e)||e}getGlyph(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):``}setFontOptions(e){this.fontOptions=Y(Y({},this.fontOptions),e),this.key=this.getKey();let t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(n&&t.length===0)return;let r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}addFontFace(e,t){let n=document.createElement(`style`);n.type=`text/css`,n.innerText=`
        @font-face{
            font-family: '${e}';
            src: url('${t}') format('woff2'),
            url('${t}') format('woff'),
            url('${t}') format('truetype');
        }`,n.onload=()=>{if(document.fonts)try{document.fonts.load(`24px ${e}`,`L7text`),document.fonts.ready.then(()=>{this.emit(`fontloaded`,{fontFamily:e})})}catch(e){console.warn(`当前环境不支持 document.fonts !`),console.warn(`当前环境不支持 iconfont !`),console.warn(e)}},document.getElementsByTagName(`head`)[0].appendChild(n)}destroy(){this.cache.clear(),this.iconFontMap.clear()}generateFontAtlas(e,t,n){let{fontFamily:r,fontWeight:i,fontSize:a,buffer:o,sdf:s,radius:c,cutoff:l,iconfont:u}=this.fontOptions,d=n&&n.data;d||(d=window.document.createElement(`canvas`),d.width=Dy);let f=d.getContext(`2d`,{willReadFrequently:!0});yy(f,r,a,i);let{mapping:p,canvasHeight:m,xOffset:h,yOffset:g}=dy(Y({getFontWidth:e=>f.measureText(e).width,fontHeight:a*ky,buffer:o,characterSet:t,maxCanvasWidth:Dy},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),_=f.getImageData(0,0,d.width,d.height);if(d.height=m,f.putImageData(_,0,0),yy(f,r,a,i),s){let e=new xy.default(a,o,c,l,r,i),n=f.getImageData(0,0,e.size,e.size);for(let r of t){if(u){let t=String.fromCharCode(parseInt(r.replace(`&#x`,``).replace(`;`,``),16));by(e.draw(t),n)}else by(e.draw(r),n);f.putImageData(n,p[r].x,p[r].y)}}else for(let e of t)f.fillText(e,p[e].x,p[e].y+a*Oy);return{xOffset:h,yOffset:g,mapping:p,data:d,width:d.width,height:d.height}}getKey(){let{fontFamily:e,fontWeight:t}=this.fontOptions;return`${e}_${t}`}getNewChars(e,t){let n=this.cache.get(e);if(!n)return t;let r=[],i=n.mapping,a=new Set(Object.keys(i));return new Set(t).forEach(e=>{a.has(e)||r.push(e)}),r}}}));function Ny(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){n(e);return}s.done?t(c):Promise.resolve(c).then(r,i)}function Z(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){Ny(a,r,i,o,s,`next`,e)}function s(e){Ny(a,r,i,o,s,`throw`,e)}o(void 0)})}}var Py=o((()=>{})),Fy,Iy,Ly,Ry,zy,By=o((()=>{Py(),ov(),Fy=u(Mf()),_y(),Iy=3,Ly=1024,Ry=64,zy=class extends Fy.EventEmitter{constructor(...e){super(...e),J(this,`canvasHeight`,128),J(this,`texture`,void 0),J(this,`canvas`,void 0),J(this,`iconData`,void 0),J(this,`iconMap`,void 0),J(this,`ctx`,void 0),J(this,`loadingImageCount`,0)}isLoading(){return this.loadingImageCount===0}init(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement(`canvas`),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext(`2d`)}addImage(e,t){var n=this;return Z(function*(){let r=new Image;n.loadingImageCount++,n.hasImage(e)?console.warn(`Image Id already exists`):n.iconData.push({id:e,size:Ry}),n.updateIconMap(),r=yield n.loadImage(t);let i=n.iconData.find(t=>t.id===e);i&&(i.image=r,i.width=r.width,i.height=r.height),n.update()})()}addImageMini(e,t,n){let r=n.getSceneConfig().canvas,i=r.createImage();if(this.loadingImageCount++,this.hasImage(e))throw Error(`Image Id already exists`);this.iconData.push({id:e,size:Ry}),this.updateIconMap(),this.loadImageMini(t,r).then(t=>{i=t;let n=this.iconData.find(t=>t.id===e);n&&(n.image=i,n.width=i.width,n.height=i.height),this.update()})}getTexture(){return this.texture}getIconMap(){return this.iconMap}getCanvas(){return this.canvas}hasImage(e){return this.iconMap.hasOwnProperty(e)}removeImage(e){this.hasImage(e)&&(this.iconData=this.iconData.filter(t=>t.id!==e),delete this.iconMap[e],this.update())}destroy(){this.removeAllListeners(`imageUpdate`),this.iconData=[],this.iconMap={}}loadImage(e){return new Promise((t,n)=>{if(e instanceof HTMLImageElement){t(e);return}let r=new Image;r.crossOrigin=`anonymous`,r.onload=()=>{t(r)},r.onerror=()=>{n(Error(`Could not load image at `+e))},r.src=e instanceof File?URL.createObjectURL(e):e})}update(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit(`imageUpdate`)}updateIconAtlas(){this.canvas.width=Ly,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(e=>{let{x:t,y:n,image:r,width:i=64,height:a=64}=this.iconMap[e],o=Math.max(i,a)/Ry,s=a/o,c=i/o;r&&this.ctx.drawImage(r,t+(Ry-c)/2,n+(Ry-s)/2,c,s)})}updateIconMap(){let{mapping:e,canvasHeight:t}=fy(this.iconData,Iy,Ly);this.iconMap=e,this.canvasHeight=t}loadImageMini(e,t){return new Promise((n,r)=>{let i=t.createImage();i.crossOrigin=`anonymous`,i.onload=()=>{n(i)},i.onerror=()=>{r(Error(`Could not load image at `+e))},i.src=e})}}})),Vy,Hy=o((()=>{Vy=typeof Float32Array<`u`?Float32Array:Array,Math.PI/180,180/Math.PI}));function Uy(){var e=new Vy(4);return Vy!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function Wy(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+a*s,e[1]=i*c+o*s,e[2]=r*-s+a*c,e[3]=i*-s+o*c,e}var Gy=o((()=>{Hy()}));function Ky(){var e=new Vy(16);return Vy!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function qy(e){var t=new Vy(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Jy(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){var g=new Vy(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=a,g[6]=o,g[7]=s,g[8]=c,g[9]=l,g[10]=u,g[11]=d,g[12]=f,g[13]=p,g[14]=m,g[15]=h,g}function Yy(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xy(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],h=t[13],g=t[14],_=t[15],v=n*s-r*o,y=n*c-i*o,b=n*l-a*o,x=r*c-i*s,S=r*l-a*s,C=i*l-a*c,w=u*h-d*m,E=u*g-f*m,D=u*_-p*m,O=d*g-f*h,k=d*_-p*h,A=f*_-p*g,j=v*A-y*k+b*O+x*D-S*E+C*w;return j?(j=1/j,e[0]=(s*A-c*k+l*O)*j,e[1]=(i*k-r*A-a*O)*j,e[2]=(h*C-g*S+_*x)*j,e[3]=(f*S-d*C-p*x)*j,e[4]=(c*D-o*A-l*E)*j,e[5]=(n*A-i*D+a*E)*j,e[6]=(g*b-m*C-_*y)*j,e[7]=(u*C-f*b+p*y)*j,e[8]=(o*k-s*D+l*w)*j,e[9]=(r*D-n*k-a*w)*j,e[10]=(m*S-h*b+_*v)*j,e[11]=(d*b-u*S-p*v)*j,e[12]=(s*E-o*O-c*w)*j,e[13]=(n*O-r*E+i*w)*j,e[14]=(h*y-m*x-g*v)*j,e[15]=(u*x-d*y+f*v)*j,e):null}function Zy(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=t[9],p=t[10],m=t[11],h=t[12],g=t[13],_=t[14],v=t[15],y=n[0],b=n[1],x=n[2],S=n[3];return e[0]=y*r+b*s+x*d+S*h,e[1]=y*i+b*c+x*f+S*g,e[2]=y*a+b*l+x*p+S*_,e[3]=y*o+b*u+x*m+S*v,y=n[4],b=n[5],x=n[6],S=n[7],e[4]=y*r+b*s+x*d+S*h,e[5]=y*i+b*c+x*f+S*g,e[6]=y*a+b*l+x*p+S*_,e[7]=y*o+b*u+x*m+S*v,y=n[8],b=n[9],x=n[10],S=n[11],e[8]=y*r+b*s+x*d+S*h,e[9]=y*i+b*c+x*f+S*g,e[10]=y*a+b*l+x*p+S*_,e[11]=y*o+b*u+x*m+S*v,y=n[12],b=n[13],x=n[14],S=n[15],e[12]=y*r+b*s+x*d+S*h,e[13]=y*i+b*c+x*f+S*g,e[14]=y*a+b*l+x*p+S*_,e[15]=y*o+b*u+x*m+S*v,e}function Qy(e,t,n){var r=n[0],i=n[1],a=n[2],o,s,c,l,u,d,f,p,m,h,g,_;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],c=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],m=t[8],h=t[9],g=t[10],_=t[11],e[0]=o,e[1]=s,e[2]=c,e[3]=l,e[4]=u,e[5]=d,e[6]=f,e[7]=p,e[8]=m,e[9]=h,e[10]=g,e[11]=_,e[12]=o*r+u*i+m*a+t[12],e[13]=s*r+d*i+h*a+t[13],e[14]=c*r+f*i+g*a+t[14],e[15]=l*r+p*i+_*a+t[15]),e}function $y(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function eb(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*r,e[5]=o*i+u*r,e[6]=s*i+d*r,e[7]=c*i+f*r,e[8]=l*i-a*r,e[9]=u*i-o*r,e[10]=d*i-s*r,e[11]=f*i-c*r,e}function tb(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],l=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-l*r,e[1]=o*i-u*r,e[2]=s*i-d*r,e[3]=c*i-f*r,e[8]=a*r+l*i,e[9]=o*r+u*i,e[10]=s*r+d*i,e[11]=c*r+f*i,e}function nb(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],l=t[4],u=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+l*r,e[1]=o*i+u*r,e[2]=s*i+d*r,e[3]=c*i+f*r,e[4]=l*i-a*r,e[5]=u*i-o*r,e[6]=d*i-s*r,e[7]=f*i-c*r,e}function rb(e,t,n,r,i){var a=1/Math.tan(t/2);if(e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){var o=1/(r-i);e[10]=(i+r)*o,e[14]=2*i*r*o}else e[10]=-1,e[14]=-2*r;return e}function ib(e,t,n,r){var i,a,o,s,c,l,u,d,f,p,m=t[0],h=t[1],g=t[2],_=r[0],v=r[1],y=r[2],b=n[0],x=n[1],S=n[2];return Math.abs(m-b)<1e-6&&Math.abs(h-x)<1e-6&&Math.abs(g-S)<1e-6?Yy(e):(u=m-b,d=h-x,f=g-S,p=1/Math.sqrt(u*u+d*d+f*f),u*=p,d*=p,f*=p,i=v*f-y*d,a=y*u-_*f,o=_*d-v*u,p=Math.sqrt(i*i+a*a+o*o),p?(p=1/p,i*=p,a*=p,o*=p):(i=0,a=0,o=0),s=d*o-f*a,c=f*i-u*o,l=u*a-d*i,p=Math.sqrt(s*s+c*c+l*l),p?(p=1/p,s*=p,c*=p,l*=p):(s=0,c=0,l=0),e[0]=i,e[1]=s,e[2]=u,e[3]=0,e[4]=a,e[5]=c,e[6]=d,e[7]=0,e[8]=o,e[9]=l,e[10]=f,e[11]=0,e[12]=-(i*m+a*h+o*g),e[13]=-(s*m+c*h+l*g),e[14]=-(u*m+d*h+f*g),e[15]=1,e)}function ab(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],d=e[9],f=e[10],p=e[11],m=e[12],h=e[13],g=e[14],_=e[15],v=t[0],y=t[1],b=t[2],x=t[3],S=t[4],C=t[5],w=t[6],E=t[7],D=t[8],O=t[9],k=t[10],A=t[11],j=t[12],M=t[13],N=t[14],P=t[15];return Math.abs(n-v)<=1e-6*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-y)<=1e-6*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-b)<=1e-6*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-x)<=1e-6*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-S)<=1e-6*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-C)<=1e-6*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(c-w)<=1e-6*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-E)<=1e-6*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(u-D)<=1e-6*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(d-O)<=1e-6*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(f-k)<=1e-6*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(p-A)<=1e-6*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(m-j)<=1e-6*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(h-M)<=1e-6*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(g-N)<=1e-6*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(_-P)<=1e-6*Math.max(1,Math.abs(_),Math.abs(P))}var ob,sb=o((()=>{Hy(),ob=rb}));function cb(){var e=new Vy(3);return Vy!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function lb(e,t,n){var r=new Vy(3);return r[0]=e,r[1]=t,r[2]=n,r}function ub(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function db(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function fb(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function pb(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function mb(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function hb(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function gb(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],c=n[2];return e[0]=i*c-a*s,e[1]=a*o-r*c,e[2]=r*s-i*o,e}function _b(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o||=1,e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,e}function vb(e,t){var n=e[0],r=e[1],i=e[2],a=t[0],o=t[1],s=t[2],c=Math.sqrt((n*n+r*r+i*i)*(a*a+o*o+s*s)),l=c&&hb(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}var yb,bb=o((()=>{Hy(),yb=ub,function(){var e=cb();return function(t,n,r,i,a,o){var s,c;for(n||=3,r||=0,c=i?Math.min(i*n+r,t.length):t.length,s=r;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}()}));function xb(){var e=new Vy(4);return Vy!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Sb(e,t,n,r){var i=new Vy(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function Cb(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function wb(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e}var Tb=o((()=>{Hy(),function(){var e=xb();return function(t,n,r,i,a,o){var s,c;for(n||=4,r||=0,c=i?Math.min(i*n+r,t.length):t.length,s=r;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}()}));function Eb(){var e=new Vy(2);return Vy!=Float32Array&&(e[0]=0,e[1]=0),e}function Db(e,t){var n=new Vy(2);return n[0]=e,n[1]=t,n}function Ob(e,t){return e[0]=t[0],e[1]=t[1],e}function kb(e,t,n){return e[0]=t,e[1]=n,e}function Ab(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function jb(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Mb(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Nb(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Pb(e,t){return e[0]*t[0]+e[1]*t[1]}function Fb(e,t,n,r){var i=t[0],a=t[1];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e}var Ib,Lb=o((()=>{Hy(),Ib=jb,function(){var e=Eb();return function(t,n,r,i,a,o){var s,c;for(n||=2,r||=0,c=i?Math.min(i*n+r,t.length):t.length,s=r;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}()})),Rb=o((()=>{Gy(),sb(),Lb(),bb(),Tb()})),zb,Bb=o((()=>{ov(),Rb(),zb=class{constructor(){J(this,`viewport`,void 0),J(this,`overridedViewProjectionMatrix`,void 0),J(this,`viewMatrixInverse`,void 0),J(this,`cameraPosition`,void 0)}init(){}update(e){this.viewport=e,this.viewMatrixInverse=Ky(),Xy(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}getProjectionMatrix(){return this.viewport.getProjectionMatrix()}getModelMatrix(){return this.viewport.getModelMatrix()}getViewMatrix(){return this.viewport.getViewMatrix()}getViewMatrixUncentered(){return this.viewport.getViewMatrixUncentered()}getViewProjectionMatrixUncentered(){return this.viewport.getViewProjectionMatrixUncentered()}getViewProjectionMatrix(){return this.overridedViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}getZoom(){return this.viewport.getZoom()}getZoomScale(){return this.viewport.getZoomScale()}getCenter(){let[e,t]=this.viewport.getCenter();return[e,t]}getFocalDistance(){return this.viewport.getFocalDistance()}getCameraPosition(){return this.cameraPosition}projectFlat(e,t){return this.viewport.projectFlat(e,t)}setViewProjectionMatrix(e){this.overridedViewProjectionMatrix=e}}})),Vb,Hb,Ub=o((()=>{ov(),kp(),Vv(),Vb={topleft:`column`,topright:`column`,bottomright:`column`,bottomleft:`column`,leftcenter:`column`,rightcenter:`column`,topcenter:`row`,bottomcenter:`row`,lefttop:`row`,righttop:`row`,leftbottom:`row`,rightbottom:`row`},Hb=class{constructor(){J(this,`container`,void 0),J(this,`controlCorners`,void 0),J(this,`controlContainer`,void 0),J(this,`scene`,void 0),J(this,`mapsService`,void 0),J(this,`controls`,[]),J(this,`unAddControls`,[])}init(e,t){this.container=e.container,this.scene=t,this.mapsService=t.mapService,this.initControlPos()}addControl(e,t){t.mapService.map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}getControlByName(e){return this.controls.find(t=>t.controlOption.name===e)}removeControl(e){let t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}addControls(){this.unAddControls.forEach(e=>{e.addTo(this.scene),this.controls.push(e)}),this.unAddControls=[]}destroy(){for(let e of this.controls)e.remove();this.controls=[],this.clearControlPos()}initControlPos(){let e=this.controlCorners={},t=this.controlContainer=cu(`div`,`l7-control-container`,this.container);function n(n=[]){let r=n.map(e=>`l7-`+e).join(` `);e[n.filter(e=>![`row`,`column`].includes(e)).join(``)]=cu(`div`,r,t)}function r(e){return[...e.replace(/^(top|bottom|left|right|center)/,`$1-`).split(`-`),Vb[e]]}Object.values(Bv).forEach(e=>{n(r(e))}),this.checkCornerOverlap()}clearControlPos(){for(let e in this.controlCorners)this.controlCorners[e]&&lu(this.controlCorners[e]);this.controlContainer&&lu(this.controlContainer)}checkCornerOverlap(){let e=window.MutationObserver;if(e)for(let t of Object.keys(this.controlCorners)){let n=t.match(/^(top|bottom)(left|right)$/);if(n){let[,t,r]=n,i=this.controlCorners[`${t}${r}`];new e(([{target:e}])=>{i&&(i.style[t]=e.clientHeight+`px`)}).observe(this.controlCorners[`${r}${t}`],{childList:!0,attributes:!0})}}}}})),Wb,Gb=o((()=>{ov(),Wb=class{constructor(){J(this,`container`,void 0),J(this,`scene`,void 0),J(this,`mapsService`,void 0),J(this,`markers`,[]),J(this,`markerLayers`,[]),J(this,`unAddMarkers`,[]),J(this,`unAddMarkerLayers`,[])}addMarkerLayer(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}removeMarkerLayer(e){e.destroy(),this.markerLayers.indexOf(e);let t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}addMarker(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}addMarkers(){this.unAddMarkers.forEach(e=>{e.addTo(this.scene),this.markers.push(e)}),this.unAddMarkers=[]}addMarkerLayers(){this.unAddMarkerLayers.forEach(e=>{this.markerLayers.push(e),e.addTo(this.scene)}),this.unAddMarkers=[]}removeMarker(e){e.remove(),this.markers.indexOf(e);let t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}removeAllMarkers(){this.destroy()}init(e){this.scene=e,this.mapsService=e.mapService}destroy(){this.markers.forEach(e=>{e.remove()}),this.markers=[],this.markerLayers.forEach(e=>{e.destroy()}),this.markerLayers=[]}removeMakerLayerMarker(e){e.destroy()}}})),Kb,qb=o((()=>{ov(),Kb=class{constructor(){J(this,`scene`,void 0),J(this,`mapsService`,void 0),J(this,`popups`,[]),J(this,`unAddPopups`,[])}get isMarkerReady(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}removePopup(e){e!=null&&e.isOpen()&&e.remove();let t=this.popups.indexOf(e);t>-1&&this.popups.splice(t,1);let n=this.unAddPopups.indexOf(e);n>-1&&this.unAddPopups.splice(n,1)}destroy(){this.popups.forEach(e=>e.remove())}addPopup(e){e&&e.getOptions().autoClose&&[...this.popups,...this.unAddPopups].forEach(e=>{e.getOptions().autoClose&&this.removePopup(e)}),this.isMarkerReady?(e.addTo(this.scene),this.popups.push(e)):this.unAddPopups.push(e),e.on(`close`,()=>{this.removePopup(e)})}initPopup(){this.unAddPopups.length&&this.unAddPopups.forEach(e=>{this.addPopup(e),this.unAddPopups=[]})}init(e){this.scene=e,this.mapsService=e.mapService}}})),Jb,Yb=o((()=>{Jb={MapToken:`您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/`,SDK:`请确认引入了mapbox-gl api且在L7之前引入`}})),Xb,Zb,Qb,$b,ex=o((()=>{cv(),ov(),kp(),ry(),Yb(),{merge:Xb}=tu,Zb={id:`map`,logoPosition:`bottomleft`,logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Qb={colors:[`rgb(103,0,31)`,`rgb(178,24,43)`,`rgb(214,96,77)`,`rgb(244,165,130)`,`rgb(253,219,199)`,`rgb(247,247,247)`,`rgb(209,229,240)`,`rgb(146,197,222)`,`rgb(67,147,195)`,`rgb(33,102,172)`,`rgb(5,48,97)`],size:10,shape:`circle`,scales:{},shape2d:[`circle`,`triangle`,`square`,`pentagon`,`hexagon`,`octogon`,`hexagram`,`rhombus`,`vesica`],shape3d:[`cylinder`,`triangleColumn`,`hexagonColumn`,`squareColumn`],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:`normal`,maskLayers:[],enableMask:!0,maskOperation:ty.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:`#2f54eb`,enableHighlight:!1,enableSelect:!1,highlightColor:`#2f54eb`,activeMix:0,selectColor:`blue`,selectMix:0,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},$b=class{constructor(){J(this,`sceneConfigCache`,{}),J(this,`layerConfigCache`,{}),J(this,`layerAttributeConfigCache`,{})}getSceneConfig(e){return this.sceneConfigCache[e]}getSceneWarninfo(e){return Jb[e]}setSceneConfig(e,t){this.sceneConfigCache[e]=Y(Y({},Zb),t)}getLayerConfig(e){return this.layerConfigCache[e]}setLayerConfig(e,t,n){this.layerConfigCache[t]=Y({},Xb({},this.sceneConfigCache[e],Qb,n))}getAttributeConfig(e){return this.layerAttributeConfigCache[e]}setAttributeConfig(e,t){this.layerAttributeConfigCache[e]=Y(Y({},this.layerAttributeConfigCache[e]),t)}clean(){this.sceneConfigCache={},this.layerConfigCache={}}}}));function tx({latitude:e=0,zoom:t=0,scale:n,highPrecision:r=!1,flipY:i=!1}){n=n===void 0?2**t:n;let a={},o=rx*n,s=Math.cos(e*nx),c=o/360,l=c/s,u=o/ix/s;if(a.pixelsPerMeter=[u,-u,u],a.metersPerPixel=[1/u,-1/u,1/u],a.pixelsPerDegree=[c,-l,u],a.degreesPerPixel=[1/c,-1/l,1/u],r){let t=nx*Math.tan(e*nx)/s,n=c*t/2,r=o/ix*t,d=r/l*u;a.pixelsPerDegree2=[0,-n,r],a.pixelsPerMeter2=[d,0,d],i&&(a.pixelsPerDegree2[1]=-a.pixelsPerDegree2[1],a.pixelsPerMeter2[1]=-a.pixelsPerMeter2[1])}return i&&(a.pixelsPerMeter[1]=-a.pixelsPerMeter[1],a.metersPerPixel[1]=-a.metersPerPixel[1],a.pixelsPerDegree[1]=-a.pixelsPerDegree[1],a.degreesPerPixel[1]=-a.degreesPerPixel[1]),a}var nx,rx,ix,ax=o((()=>{nx=Math.PI/180,rx=512,ix=4003e4})),ox,sx,cx=o((()=>{ov(),Rb(),ax(),qv(),ox=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],sx=class{constructor(e){J(this,`needRefresh`,!0),J(this,`coordinateSystem`,void 0),J(this,`viewportCenter`,void 0),J(this,`viewportCenterProjection`,void 0),J(this,`pixelsPerDegree`,void 0),J(this,`pixelsPerDegree2`,void 0),J(this,`pixelsPerMeter`,void 0),this.cameraService=e}refresh(e){let t=this.cameraService.getZoom(),n=e||this.cameraService.getCenter(),{pixelsPerMeter:r,pixelsPerDegree:i}=tx({latitude:n[1],zoom:t});this.viewportCenter=n,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=r,this.pixelsPerDegree=i,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Gv.LNGLAT?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Gv.LNGLAT_OFFSET&&this.calculateLnglatOffset(n,t),this.needRefresh=!1}getCoordinateSystem(){return this.coordinateSystem}setCoordinateSystem(e){this.coordinateSystem=e}getViewportCenter(){return this.viewportCenter}setViewportCenter(e){this.refresh(e)}getViewportCenterProjection(){return this.viewportCenterProjection}getPixelsPerDegree(){return this.pixelsPerDegree}getPixelsPerDegree2(){return this.pixelsPerDegree2}getPixelsPerMeter(){return this.pixelsPerMeter}calculateLnglatOffset(e,t,n,r){let{pixelsPerMeter:i,pixelsPerDegree:a,pixelsPerDegree2:o}=tx({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),s=this.cameraService.getViewMatrix(),c=this.cameraService.getProjectionMatrix(),l=Zy([],c,s),u=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],2**t);this.viewportCenterProjection=wb([],[u[0],u[1],0,1],l),s=this.cameraService.getViewMatrixUncentered()||s,l=Zy([],c,s),l=Zy([],l,ox),this.cameraService.setViewProjectionMatrix(l),this.pixelsPerMeter=i,this.pixelsPerDegree=a,this.pixelsPerDegree2=o}}})),lx,ux,dx=o((()=>{cv(),ov(),kp(),lx=u(Mf()),ux=class extends lx.EventEmitter{constructor(...e){super(...e),J(this,`renderMap`,new Map),J(this,`enable`,!1),J(this,`renderEnable`,!1),J(this,`cacheLogs`,{})}setEnable(e){this.enable=!!e}log(e,t){if(!this.enable)return;let n=e.split(`.`),r=null;n.forEach((e,i)=>{r===null?(this.cacheLogs[e]||(this.cacheLogs[e]={}),i!==n.length-1&&(r=this.cacheLogs[e])):(r[e]||(r[e]={}),i!==n.length-1&&(r=r[e])),i===n.length-1&&(r[e]=Y(Y({time:Date.now()},r[e]),t))})}getLog(e){switch(typeof e){case`string`:return this.cacheLogs[e];case`object`:return e.map(e=>this.cacheLogs[e]).filter(e=>e!==void 0);case`undefined`:return this.cacheLogs}}removeLog(e){delete this.cacheLogs[e]}generateRenderUid(){return this.renderEnable?Gd():``}renderDebug(e){this.renderEnable=e}renderStart(e){if(!this.renderEnable||!this.enable)return;let t=this.renderMap.get(e)||{};this.renderMap.set(e,Y(Y({},t),{},{renderUid:e,renderStart:Date.now()}))}renderEnd(e){if(!this.renderEnable||!this.enable)return;let t=this.renderMap.get(e);if(t){let n=t.renderStart,r=Date.now();this.emit(`renderEnd`,Y(Y({},t),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(e)}}destroy(){this.cacheLogs=null,this.renderMap.clear()}}})),fx=s(((e,t)=>{(function(e,n,r,i){var a=[``,`webkit`,`Moz`,`MS`,`ms`,`o`],o=n.createElement(`div`),s=`function`,c=Math.round,l=Math.abs,u=Date.now;function d(e,t,n){return setTimeout(y(e,n),t)}function f(e,t,n){return Array.isArray(e)?(p(e,n[t],n),!0):!1}function p(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==i)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function m(t,n,r){var i=`DEPRECATED METHOD: `+n+`
`+r+` AT 
`;return function(){var n=Error(`get-stack-trace`),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,``).replace(/^\s+at\s+/gm,``).replace(/^Object.<anonymous>\s*\(/gm,`{anonymous}()@`):`Unknown Stack Trace`,a=e.console&&(e.console.warn||e.console.log);return a&&a.call(e.console,i,r),t.apply(this,arguments)}}var h=typeof Object.assign==`function`?Object.assign:function(e){if(e===i||e===null)throw TypeError(`Cannot convert undefined or null to object`);for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==i&&r!==null)for(var a in r)r.hasOwnProperty(a)&&(t[a]=r[a])}return t},g=m(function(e,t,n){for(var r=Object.keys(t),a=0;a<r.length;)(!n||n&&e[r[a]]===i)&&(e[r[a]]=t[r[a]]),a++;return e},`extend`,"Use `assign`."),_=m(function(e,t){return g(e,t,!0)},`merge`,"Use `assign`.");function v(e,t,n){var r=t.prototype,i=e.prototype=Object.create(r);i.constructor=e,i._super=r,n&&h(i,n)}function y(e,t){return function(){return e.apply(t,arguments)}}function b(e,t){return typeof e==s?e.apply(t&&t[0]||i,t):e}function x(e,t){return e===i?t:e}function S(e,t,n){p(D(t),function(t){e.addEventListener(t,n,!1)})}function C(e,t,n){p(D(t),function(t){e.removeEventListener(t,n,!1)})}function w(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function E(e,t){return e.indexOf(t)>-1}function D(e){return e.trim().split(/\s+/g)}function O(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function k(e){return Array.prototype.slice.call(e,0)}function A(e,t,n){for(var r=[],i=[],a=0;a<e.length;){var o=t?e[a][t]:e[a];O(i,o)<0&&r.push(e[a]),i[a]=o,a++}return n&&(r=t?r.sort(function(e,n){return e[t]>n[t]}):r.sort()),r}function j(e,t){for(var n,r,o=t[0].toUpperCase()+t.slice(1),s=0;s<a.length;){if(n=a[s],r=n?n+o:t,r in e)return r;s++}return i}var M=1;function N(){return M++}function P(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}var F=/mobile|tablet|ip(ad|hone|od)|android/i,I=`ontouchstart`in e,ee=j(e,`PointerEvent`)!==i,R=I&&F.test(navigator.userAgent),z=`touch`,B=`pen`,te=`mouse`,ne=`kinect`,re=25,V=1,ie=2,ae=4,oe=8,se=1,ce=2,H=4,le=8,ue=16,de=ce|H,U=le|ue,fe=de|U,pe=[`x`,`y`],me=[`clientX`,`clientY`];function W(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){b(e.options.enable,[e])&&n.handler(t)},this.init()}W.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(P(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(P(this.element),this.evWin,this.domHandler)}};function he(e){var t;return t=e.options.inputClass||(ee?Pe:R?Ve:I?Ge:ke),new t(e,ge)}function ge(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,a=t&V&&r-i===0,o=t&(ae|oe)&&r-i===0;n.isFirst=!!a,n.isFinal=!!o,a&&(e.session={}),n.eventType=t,_e(e,n),e.emit(`hammer.input`,n),e.recognize(n),e.session.prevInput=n}function _e(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||=ve(t),i>1&&!n.firstMultiple?n.firstMultiple=ve(t):i===1&&(n.firstMultiple=!1);var a=n.firstInput,o=n.firstMultiple,s=o?o.center:a.center,c=t.center=ye(r);t.timeStamp=u(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=Ce(s,c),t.distance=Se(s,c),G(n,t),t.offsetDirection=xe(t.deltaX,t.deltaY);var d=be(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=d.x,t.overallVelocityY=d.y,t.overallVelocity=l(d.x)>l(d.y)?d.x:d.y,t.scale=o?Te(o.pointers,r):1,t.rotation=o?we(o.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,K(n,t);var f=e.element;w(t.srcEvent.target,f)&&(f=t.srcEvent.target),t.target=f}function G(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},a=e.prevInput||{};(t.eventType===V||a.eventType===ae)&&(i=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}function K(e,t){var n=e.lastInterval||t,r=t.timeStamp-n.timeStamp,a,o,s,c;if(t.eventType!=oe&&(r>re||n.velocity===i)){var u=t.deltaX-n.deltaX,d=t.deltaY-n.deltaY,f=be(r,u,d);o=f.x,s=f.y,a=l(f.x)>l(f.y)?f.x:f.y,c=xe(u,d),e.lastInterval=t}else a=n.velocity,o=n.velocityX,s=n.velocityY,c=n.direction;t.velocity=a,t.velocityX=o,t.velocityY=s,t.direction=c}function ve(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:c(e.pointers[n].clientX),clientY:c(e.pointers[n].clientY)},n++;return{timeStamp:u(),pointers:t,center:ye(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ye(e){var t=e.length;if(t===1)return{x:c(e[0].clientX),y:c(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:c(n/t),y:c(r/t)}}function be(e,t,n){return{x:t/e||0,y:n/e||0}}function xe(e,t){return e===t?se:l(e)>=l(t)?e<0?ce:H:t<0?le:ue}function Se(e,t,n){n||=pe;var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function Ce(e,t,n){n||=pe;var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.atan2(i,r)*180/Math.PI}function we(e,t){return Ce(t[1],t[0],me)+Ce(e[1],e[0],me)}function Te(e,t){return Se(t[0],t[1],me)/Se(e[0],e[1],me)}var Ee={mousedown:V,mousemove:ie,mouseup:ae},De=`mousedown`,Oe=`mousemove mouseup`;function ke(){this.evEl=De,this.evWin=Oe,this.pressed=!1,W.apply(this,arguments)}v(ke,W,{handler:function(e){var t=Ee[e.type];t&V&&e.button===0&&(this.pressed=!0),t&ie&&e.which!==1&&(t=ae),this.pressed&&(t&ae&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:te,srcEvent:e}))}});var Ae={pointerdown:V,pointermove:ie,pointerup:ae,pointercancel:oe,pointerout:oe},je={2:z,3:B,4:te,5:ne},Me=`pointerdown`,Ne=`pointermove pointerup pointercancel`;e.MSPointerEvent&&!e.PointerEvent&&(Me=`MSPointerDown`,Ne=`MSPointerMove MSPointerUp MSPointerCancel`);function Pe(){this.evEl=Me,this.evWin=Ne,W.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}v(Pe,W,{handler:function(e){var t=this.store,n=!1,r=Ae[e.type.toLowerCase().replace(`ms`,``)],i=je[e.pointerType]||e.pointerType,a=i==z,o=O(t,e.pointerId,`pointerId`);r&V&&(e.button===0||a)?o<0&&(t.push(e),o=t.length-1):r&(ae|oe)&&(n=!0),!(o<0)&&(t[o]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:i,srcEvent:e}),n&&t.splice(o,1))}});var Fe={touchstart:V,touchmove:ie,touchend:ae,touchcancel:oe},Ie=`touchstart`,Le=`touchstart touchmove touchend touchcancel`;function q(){this.evTarget=Ie,this.evWin=Le,this.started=!1,W.apply(this,arguments)}v(q,W,{handler:function(e){var t=Fe[e.type];if(t===V&&(this.started=!0),this.started){var n=Re.call(this,e,t);t&(ae|oe)&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:e})}}});function Re(e,t){var n=k(e.touches),r=k(e.changedTouches);return t&(ae|oe)&&(n=A(n.concat(r),`identifier`,!0)),[n,r]}var ze={touchstart:V,touchmove:ie,touchend:ae,touchcancel:oe},Be=`touchstart touchmove touchend touchcancel`;function Ve(){this.evTarget=Be,this.targetIds={},W.apply(this,arguments)}v(Ve,W,{handler:function(e){var t=ze[e.type],n=He.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:e})}});function He(e,t){var n=k(e.touches),r=this.targetIds;if(t&(V|ie)&&n.length===1)return r[n[0].identifier]=!0,[n,n];var i,a,o=k(e.changedTouches),s=[],c=this.target;if(a=n.filter(function(e){return w(e.target,c)}),t===V)for(i=0;i<a.length;)r[a[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&s.push(o[i]),t&(ae|oe)&&delete r[o[i].identifier],i++;if(s.length)return[A(a.concat(s),`identifier`,!0),s]}var Ue=2500,We=25;function Ge(){W.apply(this,arguments);var e=y(this.handler,this);this.touch=new Ve(this.manager,e),this.mouse=new ke(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}v(Ge,W,{handler:function(e,t,n){var r=n.pointerType==z,i=n.pointerType==te;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)Ke.call(this,t,n);else if(i&&Je.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ke(e,t){e&V?(this.primaryTouch=t.changedPointers[0].identifier,qe.call(this,t)):e&(ae|oe)&&qe.call(this,t)}function qe(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout(function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)},Ue)}}function Je(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],a=Math.abs(t-i.x),o=Math.abs(n-i.y);if(a<=We&&o<=We)return!0}return!1}var Ye=j(o.style,`touchAction`),Xe=Ye!==i,Ze=`compute`,Qe=`auto`,$e=`manipulation`,et=`none`,tt=`pan-x`,nt=`pan-y`,rt=ot();function it(e,t){this.manager=e,this.set(t)}it.prototype={set:function(e){e==Ze&&(e=this.compute()),Xe&&this.manager.element.style&&rt[e]&&(this.manager.element.style[Ye]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return p(this.manager.recognizers,function(t){b(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),at(e.join(` `))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented){t.preventDefault();return}var r=this.actions,i=E(r,et)&&!rt[et],a=E(r,nt)&&!rt[nt],o=E(r,tt)&&!rt[tt];if(i){var s=e.pointers.length===1,c=e.distance<2,l=e.deltaTime<250;if(s&&c&&l)return}if(!(o&&a)&&(i||a&&n&de||o&&n&U))return this.preventSrc(t)},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function at(e){if(E(e,et))return et;var t=E(e,tt),n=E(e,nt);return t&&n?et:t||n?t?tt:nt:E(e,$e)?$e:Qe}function ot(){if(!Xe)return!1;var t={},n=e.CSS&&e.CSS.supports;return[`auto`,`manipulation`,`pan-y`,`pan-x`,`pan-x pan-y`,`none`].forEach(function(r){t[r]=n?e.CSS.supports(`touch-action`,r):!0}),t}var st=1,ct=2,lt=4,ut=8,dt=ut,ft=16,pt=32;function mt(e){this.options=h({},this.defaults,e||{}),this.id=N(),this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=st,this.simultaneous={},this.requireFail=[]}mt.prototype={defaults:{},set:function(e){return h(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(f(e,`recognizeWith`,this))return this;var t=this.simultaneous;return e=_t(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return f(e,`dropRecognizeWith`,this)?this:(e=_t(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(f(e,`requireFailure`,this))return this;var t=this.requireFail;return e=_t(e,this),O(t,e)===-1&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(f(e,`dropRequireFailure`,this))return this;e=_t(e,this);var t=O(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<ut&&r(t.options.event+ht(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=ut&&r(t.options.event+ht(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=pt},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(pt|st)))return!1;e++}return!0},recognize:function(e){var t=h({},e);if(!b(this.options.enable,[this,t])){this.reset(),this.state=pt;return}this.state&(dt|ft|pt)&&(this.state=st),this.state=this.process(t),this.state&(ct|lt|ut|ft)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}};function ht(e){return e&ft?`cancel`:e&ut?`end`:e&lt?`move`:e&ct?`start`:``}function gt(e){return e==ue?`down`:e==le?`up`:e==ce?`left`:e==H?`right`:``}function _t(e,t){var n=t.manager;return n?n.get(e):e}function vt(){mt.apply(this,arguments)}v(vt,mt,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return t===0||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=t&(ct|lt),i=this.attrTest(e);return r&&(n&oe||!i)?t|ft:r||i?n&ae?t|ut:t&ct?t|lt:ct:pt}});function yt(){vt.apply(this,arguments),this.pX=null,this.pY=null}v(yt,vt,{defaults:{event:`pan`,threshold:10,pointers:1,direction:fe},getTouchAction:function(){var e=this.options.direction,t=[];return e&de&&t.push(nt),e&U&&t.push(tt),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,a=e.deltaX,o=e.deltaY;return i&t.direction||(t.direction&de?(i=a===0?se:a<0?ce:H,n=a!=this.pX,r=Math.abs(e.deltaX)):(i=o===0?se:o<0?le:ue,n=o!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return vt.prototype.attrTest.call(this,e)&&(this.state&ct||!(this.state&ct)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=gt(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}});function bt(){vt.apply(this,arguments)}v(bt,vt,{defaults:{event:`pinch`,threshold:0,pointers:2},getTouchAction:function(){return[et]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&ct)},emit:function(e){if(e.scale!==1){var t=e.scale<1?`in`:`out`;e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}});function xt(){mt.apply(this,arguments),this._timer=null,this._input=null}v(xt,mt,{defaults:{event:`press`,pointers:1,time:251,threshold:9},getTouchAction:function(){return[Qe]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||e.eventType&(ae|oe)&&!i)this.reset();else if(e.eventType&V)this.reset(),this._timer=d(function(){this.state=dt,this.tryEmit()},t.time,this);else if(e.eventType&ae)return dt;return pt},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===dt&&(e&&e.eventType&ae?this.manager.emit(this.options.event+`up`,e):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function St(){vt.apply(this,arguments)}v(St,vt,{defaults:{event:`rotate`,threshold:0,pointers:2},getTouchAction:function(){return[et]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&ct)}});function Ct(){vt.apply(this,arguments)}v(Ct,vt,{defaults:{event:`swipe`,threshold:10,velocity:.3,direction:de|U,pointers:1},getTouchAction:function(){return yt.prototype.getTouchAction.call(this)},attrTest:function(e){var t=this.options.direction,n;return t&(de|U)?n=e.overallVelocity:t&de?n=e.overallVelocityX:t&U&&(n=e.overallVelocityY),this._super.attrTest.call(this,e)&&t&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&l(n)>this.options.velocity&&e.eventType&ae},emit:function(e){var t=gt(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}});function wt(){mt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}v(wt,mt,{defaults:{event:`tap`,pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[$e]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),e.eventType&V&&this.count===0)return this.failTimeout();if(r&&i&&n){if(e.eventType!=ae)return this.failTimeout();var a=this.pTime?e.timeStamp-this.pTime<t.interval:!0,o=!this.pCenter||Se(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!o||!a?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=d(function(){this.state=dt,this.tryEmit()},t.interval,this),ct):dt}return pt},failTimeout:function(){return this._timer=d(function(){this.state=pt},this.options.interval,this),pt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==dt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Tt(e,t){return t||={},t.recognizers=x(t.recognizers,Tt.defaults.preset),new Ot(e,t)}Tt.VERSION=`2.0.7`,Tt.defaults={domEvents:!1,touchAction:Ze,enable:!0,inputTarget:null,inputClass:null,preset:[[St,{enable:!1}],[bt,{enable:!1},[`rotate`]],[Ct,{direction:de}],[yt,{direction:de},[`swipe`]],[wt],[wt,{event:`doubletap`,taps:2},[`tap`]],[xt]],cssProps:{userSelect:`none`,touchSelect:`none`,touchCallout:`none`,contentZooming:`none`,userDrag:`none`,tapHighlightColor:`rgba(0,0,0,0)`}};var Et=1,Dt=2;function Ot(e,t){this.options=h({},Tt.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=he(this),this.touchAction=new it(this,this.options.touchAction),kt(this,!0),p(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}Ot.prototype={set:function(e){return h(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?Dt:Et},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,r=this.recognizers,i=t.curRecognizer;(!i||i&&i.state&dt)&&(i=t.curRecognizer=null);for(var a=0;a<r.length;)n=r[a],t.stopped!==Dt&&(!i||n==i||n.canRecognizeWith(i))?n.recognize(e):n.reset(),!i&&n.state&(ct|lt|ut)&&(i=t.curRecognizer=n),a++}},get:function(e){if(e instanceof mt)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(f(e,`add`,this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(f(e,`remove`,this))return this;if(e=this.get(e),e){var t=this.recognizers,n=O(t,e);n!==-1&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==i&&t!==i){var n=this.handlers;return p(D(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==i){var n=this.handlers;return p(D(e),function(e){t?n[e]&&n[e].splice(O(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&At(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(!(!n||!n.length)){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&kt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function kt(e,t){var n=e.element;if(n.style){var r;p(e.options.cssProps,function(i,a){r=j(n.style,a),t?(e.oldCssProps[r]=n.style[r],n.style[r]=i):n.style[r]=e.oldCssProps[r]||``}),t||(e.oldCssProps={})}}function At(e,t){var r=n.createEvent(`Event`);r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}h(Tt,{INPUT_START:V,INPUT_MOVE:ie,INPUT_END:ae,INPUT_CANCEL:oe,STATE_POSSIBLE:st,STATE_BEGAN:ct,STATE_CHANGED:lt,STATE_ENDED:ut,STATE_RECOGNIZED:dt,STATE_CANCELLED:ft,STATE_FAILED:pt,DIRECTION_NONE:se,DIRECTION_LEFT:ce,DIRECTION_RIGHT:H,DIRECTION_UP:le,DIRECTION_DOWN:ue,DIRECTION_HORIZONTAL:de,DIRECTION_VERTICAL:U,DIRECTION_ALL:fe,Manager:Ot,Input:W,TouchAction:it,TouchInput:Ve,MouseInput:ke,PointerEventInput:Pe,TouchMouseInput:Ge,SingleTouchInput:q,Recognizer:mt,AttrRecognizer:vt,Tap:wt,Pan:yt,Swipe:Ct,Pinch:bt,Rotate:St,Press:xt,on:S,off:C,each:p,merge:_,extend:g,assign:h,inherit:v,bindFn:y,prefixed:j});var jt=e===void 0?typeof self<`u`?self:{}:e;jt.Hammer=Tt,typeof define==`function`&&define.amd?define(function(){return Tt}):t!==void 0&&t.exports?t.exports=Tt:e[r]=Tt})(window,document,`Hammer`)})),px,mx,hx,gx,_x=o((()=>{ov(),px=u(Mf()),mx=u(fx()),Zv(),hx={panstart:`dragstart`,panmove:`dragging`,panend:`dragend`,pancancel:`dragcancel`},gx=class extends px.default{get mapService(){return this.container.mapService}constructor(e){super(),J(this,`indragging`,!1),J(this,`hammertime`,void 0),J(this,`lastClickTime`,0),J(this,`lastClickXY`,[-1,-1]),J(this,`clickTimer`,void 0),J(this,`$containter`,void 0),J(this,`onDrag`,e=>{let t=this.interactionEvent(e);t.type=hx[t.type],t.type===`dragging`?this.indragging=!0:this.indragging=!1,this.emit(Xv.Drag,t)}),J(this,`onHammer`,e=>{e.srcEvent.stopPropagation();let t=this.interactionEvent(e);this.emit(Xv.Hover,t)}),J(this,`onTouch`,e=>{let t=e.touches[0];this.onHover({clientX:t.clientX,clientY:t.clientY,type:`touchstart`})}),J(this,`onTouchEnd`,e=>{if(e.changedTouches.length>0){let t=e.changedTouches[0];this.onHover({clientX:t.clientX,clientY:t.clientY,type:`touchend`})}}),J(this,`onTouchMove`,e=>{let t=e.changedTouches[0];this.onHover({clientX:t.clientX,clientY:t.clientY,type:`touchmove`})}),J(this,`onHover`,e=>{let{clientX:t,clientY:n}=e,r=t,i=n,a=e.type,o=this.mapService.getMapContainer();if(o){let{top:e,left:t}=o.getBoundingClientRect();r=r-t-o.clientLeft,i=i-e-o.clientTop}let s=this.mapService.containerToLngLat([r,i]);if(a===`click`){this.isDoubleTap(r,i,s);return}if(a===`touch`){this.isDoubleTap(r,i,s);return}a!==`click`&&a!==`dblclick`&&this.emit(Xv.Hover,{x:r,y:i,lngLat:s,type:a,target:e})}),this.container=e}init(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}destroy(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Xv.Hover)}triggerHover({x:e,y:t}){this.emit(Xv.Hover,{x:e,y:t})}triggerSelect(e){this.emit(Xv.Select,{featureId:e})}triggerActive(e){this.emit(Xv.Active,{featureId:e})}addEventListenerOnMap(){let e=this.mapService.getMapContainer();if(e){let t=new mx.default.Manager(e);t.add(new mx.default.Tap({event:`dblclick`,taps:2})),t.add(new mx.default.Tap({event:`click`})),t.add(new mx.default.Pan({threshold:0,pointers:0})),t.add(new mx.default.Press({})),t.on(`dblclick click`,this.onHammer),t.on(`panstart panmove panend pancancel`,this.onDrag),e.addEventListener(`touchstart`,this.onTouch),e.addEventListener(`touchend`,this.onTouchEnd),e.addEventListener(`mousemove`,this.onHover),e.addEventListener(`touchmove`,this.onTouchMove),e.addEventListener(`mousedown`,this.onHover,!0),e.addEventListener(`mouseup`,this.onHover),e.addEventListener(`contextmenu`,this.onHover),this.hammertime=t}}removeEventListenerOnMap(){let e=this.mapService.getMapContainer();e&&(e.removeEventListener(`mousemove`,this.onHover),this.hammertime.off(`dblclick click`,this.onHammer),this.hammertime.off(`panstart panmove panend pancancel`,this.onDrag),e.removeEventListener(`touchstart`,this.onTouch),e.removeEventListener(`touchend`,this.onTouchEnd),e.removeEventListener(`mousedown`,this.onHover),e.removeEventListener(`mouseup`,this.onHover),e.removeEventListener(`contextmenu`,this.onHover))}interactionEvent(e){let{type:t,pointerType:n}=e,r,i;n===`touch`?(i=Math.floor(e.pointers[0].clientY),r=Math.floor(e.pointers[0].clientX)):(i=Math.floor(e.srcEvent.y),r=Math.floor(e.srcEvent.x));let a=this.mapService.getMapContainer();if(a){let{top:e,left:t}=a.getBoundingClientRect();r-=t,i-=e}let o=this.mapService.containerToLngLat([r,i]);return{x:r,y:i,lngLat:o,type:t,target:e.srcEvent}}isDoubleTap(e,t,n){let r=new Date().getTime(),i=`click`;r-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-e)<10&&Math.abs(this.lastClickXY[1]-t)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),i=`dblclick`,this.emit(Xv.Hover,{x:e,y:t,lngLat:n,type:i})):(this.lastClickTime=r,this.lastClickXY=[e,t],this.clickTimer=setTimeout(()=>{i=`click`,this.emit(Xv.Hover,{x:e,y:t,lngLat:n,type:i})},400))}}}));function vx(e){let t=e;if(typeof e==`string`&&(t=document.getElementById(e)),t){let e=document.createElement(`div`);return e.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,e.id=`l7-scene-${bx++}`,e.classList.add(`l7-scene`),t.appendChild(e),e}return null}function yx(e){var t;let n=!0;if((e==null||(t=e.target)==null?void 0:t.target)instanceof HTMLElement){var r;let t=e==null||(r=e.target)==null?void 0:r.target;for(;t;){let e=Array.from(t.classList);if(e.includes(`l7-marker`)||e.includes(`l7-popup`)){n=!1;break}t=t?.parentElement}}return n}var bx,xx=o((()=>{bx=0})),Sx,Cx=o((()=>{Sx=function(e){return e[e.SAMPLED=0]=`SAMPLED`,e[e.RENDER_TARGET=1]=`RENDER_TARGET`,e}({})})),Tx,Ex=o((()=>{cv(),Py(),ov(),kp(),xx(),Zv(),Cx(),Tx=class{constructor(e){var t=this;J(this,`pickedColors`,void 0),J(this,`pickedTileLayers`,[]),J(this,`pickingFBO`,void 0),J(this,`width`,0),J(this,`height`,0),J(this,`alreadyInPicking`,!1),J(this,`pickBufferScale`,1),J(this,`pickFromPickingFBO`,function(){var e=Z(function*(e,{x:n,y:r,lngLat:i,type:a,target:o}){let s=!1,{readPixels:c,readPixelsAsync:l,getViewportSize:u,queryVerdorInfo:d}=t.rendererService,{width:f,height:p}=u(),{enableHighlight:m,enableSelect:h}=e.getLayerConfig(),g=n*Nu,_=r*Nu;if(g>f-1*Nu||g<0||_>p-1*Nu||_<0)return!1;let v;if(v=d()===`WebGPU`?yield l({x:Math.floor(g/t.pickBufferScale),y:Math.floor((p-(r+1)*Nu)/t.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO}):c({x:Math.floor(g/t.pickBufferScale),y:Math.floor((p-(r+1)*Nu)/t.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO}),t.pickedColors=v,v[0]!==0||v[1]!==0||v[2]!==0){let c=Rs(v),l=e.layerPickService.getFeatureById(c);c!==e.getCurrentPickId()&&a===`mousemove`&&(a=`mouseenter`);let u={x:n,y:r,type:a,lngLat:i,featureId:c,feature:l,target:o};l&&(s=!0,e.setCurrentPickId(c),t.triggerHoverOnLayer(e,u))}else{let s={x:n,y:r,lngLat:i,type:e.getCurrentPickId()!==null&&a===`mousemove`?`mouseout`:`un`+a,featureId:null,target:o,feature:null};t.triggerHoverOnLayer(e,Y(Y({},s),{},{type:`unpick`})),t.triggerHoverOnLayer(e,s),e.setCurrentPickId(null)}if(m&&e.layerPickService.highlightPickedFeature(v),h&&a===`click`&&v?.toString()!==[0,0,0,0].toString()){let t=Rs(v);e.getCurrentSelectedId()===null||t!==e.getCurrentSelectedId()?(e.layerPickService.selectFeature(v),e.setCurrentSelectedId(t)):(e.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),e.setCurrentSelectedId(null))}return s});return function(t,n){return e.apply(this,arguments)}}()),this.container=e}get mapService(){return this.container.mapService}get rendererService(){return this.container.rendererService}get configService(){return this.container.globalConfigService}get interactionService(){return this.container.interactionService}get layerService(){return this.container.layerService}init(e){let{createTexture2D:t,createFramebuffer:n,getViewportSize:r}=this.rendererService,{width:i,height:a}=r();this.pickBufferScale=this.configService.getSceneConfig(e).pickBufferScale||1,i=Math.round(i/this.pickBufferScale),a=Math.round(a/this.pickBufferScale),this.pickingFBO=n({color:t({width:i,height:a,usage:Sx.RENDER_TARGET,label:`Picking Texture`}),depth:!0,width:i,height:a}),this.interactionService.on(Xv.Hover,this.pickingAllLayer.bind(this))}boxPickLayer(e,t,n){var r=this;return Z(function*(){let{useFramebufferAsync:i,clear:a}=r.rendererService;r.resizePickingFBO(),e.hooks.beforePickingEncode.call(),yield i(r.pickingFBO,Z(function*(){a({framebuffer:r.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.renderModels({ispick:!0})})),e.hooks.afterPickingEncode.call(),n(yield r.pickBox(e,t))})()}pickBox(e,t){var n=this;return Z(function*(){let[r,i,a,o]=t.map(e=>{let t=e<0?0:e;return Math.floor(t*Nu/n.pickBufferScale)}),{readPixelsAsync:s,getViewportSize:c}=n.rendererService,{width:l,height:u}=c();if(r>(l-1)*Nu/n.pickBufferScale||a<0||i>(u-1)*Nu/n.pickBufferScale||o<0)return[];let d=Math.min(l/n.pickBufferScale,a)-r,f=Math.min(u/n.pickBufferScale,o)-i,p=yield s({x:r,y:Math.floor(u/n.pickBufferScale-(o+1)),width:d,height:f,data:new Uint8Array(d*f*4),framebuffer:n.pickingFBO}),m=[],h={};for(let t=0;t<p.length/4;t+=1){let n=Rs(p.slice(t*4,t*4+4));if(n!==-1&&!h[n]){let t=e.layerPickService.getFeatureById(n);m.push(Y(Y({},t),{},{pickedFeatureIdx:n})),h[n]=!0}}return m})()}handleCursor(e,t){let{cursor:n=``,cursorEnabled:r}=e.getLayerConfig();if(r){let e=this.mapService.getType()===`amap`?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),r=e?.style.getPropertyValue(`cursor`);t===`unmousemove`&&r!==``?e?.style.setProperty(`cursor`,``):t===`mousemove`&&e?.style.setProperty(`cursor`,n)}}destroy(){this.pickingFBO.destroy(),this.pickingFBO=null}pickingAllLayer(e){var t=this;return Z(function*(){!t.layerService.needPick(e.type)||!t.isPickingAllLayer()||(t.alreadyInPicking=!0,yield t.pickingLayers(e),t.layerService.renderLayers(),t.alreadyInPicking=!1)})()}isPickingAllLayer(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}resizePickingFBO(){let{getViewportSize:e}=this.rendererService,{width:t,height:n}=e();(this.width!==t||this.height!==n)&&(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(n/this.pickBufferScale)}),this.width=t,this.height=n)}pickingLayers(e){var t=this;return Z(function*(){let{clear:n,useFramebufferAsync:r}=t.rendererService;t.resizePickingFBO();let i=t.layerService.getRenderList();for(let a of i.filter(t=>t.needPick(e.type)).reverse()){yield r(t.pickingFBO,Z(function*(){n({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.layerPickService.pickRender(e)}));let i=yield t.pickFromPickingFBO(a,e);if(t.layerService.pickedLayerId=i?+a.id:-1,i&&!a.getLayerConfig().enablePropagation)break}})()}triggerHoverOnLayer(e,t){yx(t)&&(this.handleCursor(e,t.type),e.emit(t.type,t))}}})),Dx,Ox=o((()=>{ov(),Dx=class{constructor(e=!0){J(this,`autoStart`,void 0),J(this,`startTime`,0),J(this,`oldTime`,0),J(this,`running`,!1),J(this,`elapsedTime`,0),this.autoStart=e}start(){this.startTime=(typeof performance>`u`?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=(typeof performance>`u`?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}})),kx,Ax,jx,Mx=o((()=>{Py(),ov(),kp(),kx=u(Mf()),Ox(),ry(),{throttle:Ax}=tu,jx=class extends kx.EventEmitter{get renderService(){return this.container.rendererService}get mapService(){return this.container.mapService}get debugService(){return this.container.debugService}constructor(e){super(),J(this,`pickedLayerId`,-1),J(this,`clock`,new Dx),J(this,`alreadyInRendering`,!1),J(this,`layers`,[]),J(this,`layerList`,[]),J(this,`layerRenderID`,void 0),J(this,`sceneInited`,!1),J(this,`animateInstanceCount`,0),J(this,`shaderPicking`,!0),J(this,`enableRender`,!0),J(this,`reRender`,Ax(()=>{this.renderLayers()},32)),J(this,`throttleRenderLayers`,Ax(()=>{this.renderLayers()},16)),this.container=e}needPick(e){return this.updateLayerRenderList(),this.layerList.some(t=>t.needPick(e))}add(e){this.layers.push(e),this.sceneInited&&e.init().then(()=>{this.renderLayers()})}addMask(e){this.sceneInited&&e.init().then(()=>{this.renderLayers()})}initLayers(){var e=this;return Z(function*(){e.sceneInited=!0,e.layers.forEach(function(){var t=Z(function*(t){t.startInit||(yield t.init(),e.updateLayerRenderList())});return function(e){return t.apply(this,arguments)}}())})()}getSceneInited(){return this.sceneInited}getRenderList(){return this.layerList}getLayers(){return this.layers}getLayer(e){return this.layers.find(t=>t.id===e)}getLayerByName(e){return this.layers.find(t=>t.name===e)}remove(e,t){var n=this;return Z(function*(){if(t){t.layerChildren||=[];let n=t.layerChildren.findIndex(t=>t.id===e.id);n>-1&&t.layerChildren.splice(n,1)}else{let t=n.layers.findIndex(t=>t.id===e.id);t>-1&&n.layers.splice(t,1)}e.destroy(),n.reRender(),n.emit(`layerChange`,n.layers)})()}removeAllLayers(){var e=this;return Z(function*(){e.destroy(),e.reRender()})()}setEnableRender(e){this.enableRender=e}renderLayers(){var e=this;return Z(function*(){if(e.alreadyInRendering||!e.enableRender)return;e.updateLayerRenderList();let t=e.debugService.generateRenderUid();e.debugService.renderStart(t),e.alreadyInRendering=!0,e.clear();for(let t of e.layerList)t.prerender();e.renderService.beginFrame();for(let t of e.layerList){let{enableMask:n}=t.getLayerConfig();t.masks.filter(e=>e.inited).length>0&&n&&e.renderMask(t.masks),t.getLayerConfig().enableMultiPassRenderer?yield t.renderMultiPass():t.render()}e.renderService.endFrame(),e.debugService.renderEnd(t),e.alreadyInRendering=!1})()}renderMask(e){let t=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});let n=e.length>1?ey.MULTIPLE:ey.SINGLE;for(let r of e)r.render({isStencil:!0,stencilType:n,stencilIndex:t++})}beforeRenderData(e){var t=this;return Z(function*(){(yield e.hooks.beforeRenderData.promise())&&t.renderLayers()})()}renderTileLayerMask(e){let t=0,{enableMask:n=!0}=e.getLayerConfig(),r=e.tileMask?1:0,i=e.masks.filter(e=>e.inited);r+=n?i.length:1;let a=r>1?ey.MULTIPLE:ey.SINGLE;if((e.tileMask||i.length&&n)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),i.length&&n)for(let e of i)e.render({isStencil:!0,stencilType:a,stencilIndex:t++});e.tileMask&&e.tileMask.render({isStencil:!0,stencilType:a,stencilIndex:t++,stencilOperation:ty.OR})}renderTileLayer(e){var t=this;return Z(function*(){t.renderTileLayerMask(e),e.getLayerConfig().enableMultiPassRenderer?yield e.renderMultiPass():yield e.render()})()}updateLayerRenderList(){this.layerList=[],this.layers.filter(e=>e.inited).filter(e=>e.isVisible()).sort((e,t)=>e.zIndex-t.zIndex).forEach(e=>{this.layerList.push(e)})}destroy(){this.layers.forEach(e=>{e.destroy()}),this.layers=[],this.layerList=[],this.emit(`layerChange`,this.layers)}startAnimate(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}stopAnimate(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}getOESTextureFloat(){return this.renderService.extensionObject.OES_texture_float}enableShaderPick(){this.shaderPicking=!0}disableShaderPick(){this.shaderPicking=!1}getShaderPickStat(){return this.shaderPicking}clear(){let e=Ls(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}runRender(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}stopRender(){window.cancelAnimationFrame(this.layerRenderID)}}}));function Nx(e,t){if(e==null)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;n[r]=e[r]}return n}var Px=o((()=>{}));function Fx(e,t){if(e==null)return{};var n,r,i=Nx(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var Ix=o((()=>{Px()})),Lx,Rx,zx=o((()=>{ov(),kp(),{isNil:Lx}=tu,Rx=class{constructor(e){J(this,`name`,void 0),J(this,`type`,void 0),J(this,`scale`,void 0),J(this,`descriptor`,void 0),J(this,`featureBufferLayout`,[]),J(this,`needRescale`,!1),J(this,`needRemapping`,!1),J(this,`needRegenerateVertices`,!1),J(this,`featureRange`,{startIndex:0,endIndex:1/0}),J(this,`vertexAttribute`,void 0),J(this,`defaultCallback`,e=>e.length===0?this.scale?.defaultValues||[]:e.map((e,t)=>(this.scale?.scalers[t].func)(e))),this.setProps(e)}setProps(e){Object.assign(this,e)}mapping(e){var t;if((t=this.scale)!=null&&t.callback){let t=this.scale?.callback(...e);if(!Lx(t))return[t]}return this.defaultCallback(e)}resetDescriptor(){this.descriptor&&(this.descriptor.buffer.data=[])}}})),Bx,Vx,Hx,Ux,Wx=o((()=>{Ix(),cv(),ov(),dv(),zx(),Bx=[`buffer`,`update`,`name`],Vx=[`buffer`,`update`,`name`],Hx={[X.FLOAT]:4,[X.UNSIGNED_BYTE]:1,[X.UNSIGNED_SHORT]:2},Ux=class{constructor(e){J(this,`attributesAndIndices`,void 0),J(this,`attributes`,[]),J(this,`triangulation`,void 0),J(this,`featureLayout`,{sizePerElement:0,elements:[]}),this.rendererService=e}registerStyleAttribute(e){let t=this.getLayerStyleAttribute(e.name||``);return t?t.setProps(e):(t=new Rx(e),this.attributes.push(t)),t}unRegisterStyleAttribute(e){let t=this.attributes.findIndex(t=>t.name===e);t>-1&&this.attributes.splice(t,1)}updateScaleAttribute(e){this.attributes.forEach(t=>{let n=t.name,r=t.scale?.field;(e[n]||r&&e[r])&&(t.needRescale=!0,t.needRemapping=!0,t.needRegenerateVertices=!0)})}updateStyleAttribute(e,t,n){let r=this.getLayerStyleAttribute(e);r||=this.registerStyleAttribute(Y(Y({},t),{},{name:e}));let{scale:i}=t;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}getLayerStyleAttributes(){return this.attributes}getLayerStyleAttribute(e){return this.attributes.find(t=>t.name===e)}getLayerAttributeScale(e){var t;let n=this.getLayerStyleAttribute(e),r=n==null||(t=n.scale)==null?void 0:t.scalers;return r&&r[0]?r[0].func:null}updateAttributeByFeatureRange(e,t,n=0,r,i){let a=this.attributes.find(t=>t.name===e);if(a&&a.descriptor){let{descriptor:o}=a,{update:s,buffer:c,size:l=0}=o,u=Hx[c.type||X.FLOAT];if(s){let{elements:o,sizePerElement:c}=this.featureLayout,d=o.slice(n,r);if(!d.length)return;let{offset:f}=d[0],p=f*l*u,m=d.map(({featureIdx:e,vertices:n,normals:r},i)=>{let a=n.length/c,o=[];for(let l=0;l<a;l++){let a=r?r.slice(l*3,l*3+3):[];o.push(...s(t[e],e,n.slice(l*c,l*c+c),i,a))}return o}).flat();a.vertexAttribute.updateBuffer({data:m,offset:p}),i?.emit(`legend:${e}`,i.getLegend(e))}}}createAttributesAndIndices(e,t,n,r){this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);let i=this.attributes.map(e=>(e.resetDescriptor(),e.descriptor)),a=0,o=0,s=[],c=3;e.forEach((e,t)=>{let{indices:r,vertices:l,normals:u,size:d,indexes:f,count:p}=this.triangulation(e,n);typeof p==`number`&&(o+=p),r.forEach(e=>{s.push(e+a)}),c=d;let m=l.length/d;this.featureLayout.sizePerElement=c,this.featureLayout.elements.push({featureIdx:t,vertices:l,normals:u,offset:a}),a+=m;for(let n=0;n<m;n++){let r=u?.slice(n*3,n*3+3)||[],a=l.slice(n*d,n*d+d),o=0;f&&f[n]!==void 0&&(o=f[n]),i.forEach((i,s)=>{i&&i.update&&i.buffer.data.push(...i.update(e,t,a,n,r,o))})}});let{createAttribute:l,createBuffer:u,createElements:d}=this.rendererService,f={};return i.forEach((e,t)=>{if(e){let{buffer:n,update:r,name:i}=e,a=Fx(e,Bx),o=l(Y({buffer:u(n)},a));f[e.name||``]=o,this.attributes[t].vertexAttribute=o}}),this.attributesAndIndices={attributes:f,elements:d({data:s,type:X.UNSIGNED_INT,count:s.length}),count:o},Object.values(this.attributes).filter(e=>e.scale).forEach(e=>{let t=e.name;r?.emit(`legend:${t}`,r.getLegend(t))}),this.attributesAndIndices}createAttributes(e,t){this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);let n=this.attributes.map(e=>(e.resetDescriptor(),e.descriptor)),r=0,i=[],a=3;e.forEach((e,t)=>{let{indices:o,vertices:s,normals:c,size:l,indexes:u}=this.triangulation(e);o.forEach(e=>{i.push(e+r)}),a=l;let d=s.length/l;this.featureLayout.sizePerElement=a,this.featureLayout.elements.push({featureIdx:t,vertices:s,normals:c,offset:r}),r+=d;for(let r=0;r<d;r++){let i=c?.slice(r*3,r*3+3)||[],a=s.slice(r*l,r*l+l),o=0;u&&u[r]!==void 0&&(o=u[r]),n.forEach((n,s)=>{n&&n.update&&n.buffer.data.push(...n.update(e,t,a,r,i,o))})}});let{createAttribute:o,createBuffer:s}=this.rendererService,c={};return n.forEach((e,t)=>{if(e){let{buffer:n,update:r,name:i}=e,a=Fx(e,Vx),l=o(Y({buffer:s(n)},a));c[e.name||``]=l,this.attributes[t].vertexAttribute=l}}),{attributes:c}}clearAllAttributes(){var e;this.attributes.forEach(e=>{e.vertexAttribute&&e.vertexAttribute.destroy()}),(e=this.attributesAndIndices)==null||e.elements.destroy(),this.attributes=[]}}})),Gx=s(((e,t)=>{var n=t.exports={};n.forEach=function(e,t){for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}}})),Kx=s(((e,t)=>{t.exports=function(e){var t=e.stateHandler.getState;function n(e){var n=t(e);return n&&!!n.isDetectable}function r(e){t(e).isDetectable=!0}function i(e){return!!t(e).busy}function a(e,n){t(e).busy=!!n}return{isDetectable:n,markAsDetectable:r,isBusy:i,markBusy:a}}})),qx=s(((e,t)=>{t.exports=function(e){var t={};function n(n){var r=e.get(n);return r===void 0?[]:t[r]||[]}function r(n,r){var i=e.get(n);t[i]||(t[i]=[]),t[i].push(r)}function i(e,t){for(var r=n(e),i=0,a=r.length;i<a;++i)if(r[i]===t){r.splice(i,1);break}}function a(e){var t=n(e);t&&(t.length=0)}return{get:n,add:r,removeListener:i,removeAllListeners:a}}})),Jx=s(((e,t)=>{t.exports=function(){var e=1;function t(){return e++}return{generate:t}}})),Yx=s(((e,t)=>{t.exports=function(e){var t=e.idGenerator,n=e.stateHandler.getState;function r(e){var t=n(e);return t&&t.id!==void 0?t.id:null}function i(e){var r=n(e);if(!r)throw Error(`setId required the element to have a resize detection state.`);var i=t.generate();return r.id=i,i}return{get:r,set:i}}})),Xx=s(((e,t)=>{t.exports=function(e){function t(){}var n={log:t,warn:t,error:t};if(!e&&window.console){var r=function(e,t){e[t]=function(){var e=console[t];if(e.apply)e.apply(console,arguments);else for(var n=0;n<arguments.length;n++)e(arguments[n])}};r(n,`log`),r(n,`warn`),r(n,`error`)}return n}})),Zx=s(((e,t)=>{var n=t.exports={};n.isIE=function(e){function t(){var e=navigator.userAgent.toLowerCase();return e.indexOf(`msie`)!==-1||e.indexOf(`trident`)!==-1||e.indexOf(` edge/`)!==-1}return t()?e?e===function(){var e,t=3,n=document.createElement(`div`),r=n.getElementsByTagName(`i`);do n.innerHTML=`<!--[if gt IE `+ ++t+`]><i></i><![endif]-->`;while(r[0]);return t>4?t:e}():!0:!1},n.isLegacyOpera=function(){return!!window.opera}})),Qx=s(((e,t)=>{var n=t.exports={};n.getOption=r;function r(e,t,n){var r=e[t];return r==null&&n!==void 0?n:r}})),$x=s(((e,t)=>{var n=Qx();t.exports=function(e){e||={};var t=e.reporter,i=n.getOption(e,`async`,!0),a=n.getOption(e,`auto`,!0);a&&!i&&(t&&t.warn(`Invalid options combination. auto=true and async=false is invalid. Setting async=true.`),i=!0);var o=r(),s,c=!1;function l(e,t){!c&&a&&i&&o.size()===0&&f(),o.add(e,t)}function u(){for(c=!0;o.size();){var e=o;o=r(),e.process()}c=!1}function d(e){c||(e===void 0&&(e=i),s&&=(p(s),null),e?f():u())}function f(){s=m(u)}function p(e){return clearTimeout(e)}function m(e){return function(e){return setTimeout(e,0)}(e)}return{add:l,force:d}};function r(){var e={},t=0,n=0,r=0;function i(i,a){a||(a=i,i=0),i>n?n=i:i<r&&(r=i),e[i]||(e[i]=[]),e[i].push(a),t++}function a(){for(var t=r;t<=n;t++)for(var i=e[t],a=0;a<i.length;a++){var o=i[a];o()}}function o(){return t}return{add:i,process:a,size:o}}})),eS=s(((e,t)=>{var n=`_erd`;function r(e){return e[n]={},i(e)}function i(e){return e[n]}function a(e){delete e[n]}t.exports={initState:r,getState:i,cleanState:a}})),tS=s(((e,t)=>{var n=Zx();t.exports=function(e){e||={};var t=e.reporter,r=e.batchProcessor,i=e.stateHandler.getState;if(!t)throw Error(`Missing required dependency: reporter.`);function a(e,t){function r(){t(e)}if(n.isIE(8))i(e).object={proxy:r},e.attachEvent(`onresize`,r);else{var a=c(e);if(!a)throw Error(`Element is not detectable by this strategy.`);a.contentDocument.defaultView.addEventListener(`resize`,r)}}function o(t){var n=e.important?` !important; `:`; `;return(t.join(n)+n).trim()}function s(e,a,s){s||(s=a,a=e,e=null),e||={},e.debug;function c(a,s){var c=o([`display: block`,`position: absolute`,`top: 0`,`left: 0`,`width: 100%`,`height: 100%`,`border: none`,`padding: 0`,`margin: 0`,`opacity: 0`,`z-index: -1000`,`pointer-events: none`]),l=!1,u=window.getComputedStyle(a),d=a.offsetWidth,f=a.offsetHeight;i(a).startSize={width:d,height:f};function p(){function r(){if(u.position===`static`){a.style.setProperty(`position`,`relative`,e.important?`important`:``);var n=function(t,n,r,i){function a(e){return e.replace(/[^-\d\.]/g,``)}var o=r[i];o!==`auto`&&a(o)!==`0`&&(t.warn(`An element that is positioned static has style.`+i+`=`+o+` which is ignored due to the static positioning. The element will need to be positioned relative, so the style.`+i+` will be set to 0. Element: `,n),n.style.setProperty(i,`0`,e.important?`important`:``))};n(t,a,u,`top`),n(t,a,u,`right`),n(t,a,u,`bottom`),n(t,a,u,`left`)}}function o(){l||r();function e(t,n){if(!t.contentDocument){var r=i(t);r.checkForObjectDocumentTimeoutId&&window.clearTimeout(r.checkForObjectDocumentTimeoutId),r.checkForObjectDocumentTimeoutId=setTimeout(function(){r.checkForObjectDocumentTimeoutId=0,e(t,n)},100);return}n(t.contentDocument)}e(this,function(e){s(a)})}u.position!==``&&(r(u),l=!0);var d=document.createElement(`object`);d.style.cssText=c,d.tabIndex=-1,d.type=`text/html`,d.setAttribute(`aria-hidden`,`true`),d.onload=o,n.isIE()||(d.data=`about:blank`),i(a)&&(a.appendChild(d),i(a).object=d,n.isIE()&&(d.data=`about:blank`))}r?r.add(p):p()}n.isIE(8)?s(a):c(a,s)}function c(e){return i(e).object}function l(e){if(i(e)){var t=c(e);t&&(n.isIE(8)?e.detachEvent(`onresize`,t.proxy):e.removeChild(t),i(e).checkForObjectDocumentTimeoutId&&window.clearTimeout(i(e).checkForObjectDocumentTimeoutId),delete i(e).object)}}return{makeDetectable:s,addListener:a,uninstall:l}}})),nS=s(((e,t)=>{var n=Gx().forEach;t.exports=function(e){e||={};var t=e.reporter,r=e.batchProcessor,i=e.stateHandler.getState;e.stateHandler.hasState;var a=e.idHandler;if(!r)throw Error(`Missing required dependency: batchProcessor`);if(!t)throw Error(`Missing required dependency: reporter.`);var o=d(),s=`erd_scroll_detection_scrollbar_style`,c=`erd_scroll_detection_container`;function l(e){f(e,s,c)}l(window.document);function u(t){var n=e.important?` !important; `:`; `;return(t.join(n)+n).trim()}function d(){var e=500,t=500,n=document.createElement(`div`);n.style.cssText=u([`position: absolute`,`width: `+e*2+`px`,`height: `+t*2+`px`,`visibility: hidden`,`margin: 0`,`padding: 0`]);var r=document.createElement(`div`);r.style.cssText=u([`position: absolute`,`width: `+e+`px`,`height: `+t+`px`,`overflow: scroll`,`visibility: none`,`top: `+-e*3+`px`,`left: `+-t*3+`px`,`visibility: hidden`,`margin: 0`,`padding: 0`]),r.appendChild(n),document.body.insertBefore(r,document.body.firstChild);var i=e-r.clientWidth,a=t-r.clientHeight;return document.body.removeChild(r),{width:i,height:a}}function f(e,t,n){function r(n,r){r||=function(t){e.head.appendChild(t)};var i=e.createElement(`style`);return i.innerHTML=n,i.id=t,r(i),i}if(!e.getElementById(t)){var i=n+`_animation`,a=n+`_animation_active`,o=`/* Created by the element-resize-detector library. */
`;o+=`.`+n+` > div::-webkit-scrollbar { `+u([`display: none`])+` }

`,o+=`.`+a+` { `+u([`-webkit-animation-duration: 0.1s`,`animation-duration: 0.1s`,`-webkit-animation-name: `+i,`animation-name: `+i])+` }
`,o+=`@-webkit-keyframes `+i+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
`,o+=`@keyframes `+i+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }`,r(o)}}function p(e){e.className+=` `+c+`_animation_active`}function m(e,n,r){if(e.addEventListener)e.addEventListener(n,r);else if(e.attachEvent)e.attachEvent(`on`+n,r);else return t.error(`[scroll] Don't know how to add event listeners.`)}function h(e,n,r){if(e.removeEventListener)e.removeEventListener(n,r);else if(e.detachEvent)e.detachEvent(`on`+n,r);else return t.error(`[scroll] Don't know how to remove event listeners.`)}function g(e){return i(e).container.childNodes[0].childNodes[0].childNodes[0]}function _(e){return i(e).container.childNodes[0].childNodes[0].childNodes[1]}function v(e,t){if(!i(e).listeners.push)throw Error(`Cannot add listener to an element that is not detectable.`);i(e).listeners.push(t)}function y(e,s,l){l||(l=s,s=e,e=null),e||={};function d(){if(e.debug){var n=Array.prototype.slice.call(arguments);if(n.unshift(a.get(s),`Scroll: `),t.log.apply)t.log.apply(null,n);else for(var r=0;r<n.length;r++)t.log(n[r])}}function f(e){function t(e){var t=e.getRootNode&&e.getRootNode().contains(e);return e===e.ownerDocument.body||e.ownerDocument.body.contains(e)||t}return!t(e)||window.getComputedStyle(e)===null}function h(e){var t=i(e).container.childNodes[0],n=window.getComputedStyle(t);return!n.width||n.width.indexOf(`px`)===-1}function v(){var e=window.getComputedStyle(s),t={};return t.position=e.position,t.width=s.offsetWidth,t.height=s.offsetHeight,t.top=e.top,t.right=e.right,t.bottom=e.bottom,t.left=e.left,t.widthCSS=e.width,t.heightCSS=e.height,t}function y(){var e=v();i(s).startSize={width:e.width,height:e.height},d(`Element start size`,i(s).startSize)}function b(){i(s).listeners=[]}function x(){if(d(`storeStyle invoked.`),!i(s)){d(`Aborting because element has been uninstalled`);return}var e=v();i(s).style=e}function S(e,t,n){i(e).lastWidth=t,i(e).lastHeight=n}function C(e){return g(e).childNodes[0]}function w(){return 2*o.width+1}function E(){return 2*o.height+1}function D(e){return e+10+w()}function O(e){return e+10+E()}function k(e){return e*2+w()}function A(e){return e*2+E()}function j(e,t,n){var r=g(e),i=_(e),a=D(t),o=O(n),s=k(t),c=A(n);r.scrollLeft=a,r.scrollTop=o,i.scrollLeft=s,i.scrollTop=c}function M(){var e=i(s).container;if(!e){e=document.createElement(`div`),e.className=c,e.style.cssText=u([`visibility: hidden`,`display: inline`,`width: 0px`,`height: 0px`,`z-index: -1`,`overflow: hidden`,`margin: 0`,`padding: 0`]),i(s).container=e,p(e),s.appendChild(e);var t=function(){i(s).onRendered&&i(s).onRendered()};m(e,`animationstart`,t),i(s).onAnimationStart=t}return e}function N(){function n(){var n=i(s).style;if(n.position===`static`){s.style.setProperty(`position`,`relative`,e.important?`important`:``);var r=function(e,t,n,r){function i(e){return e.replace(/[^-\d\.]/g,``)}var a=n[r];a!==`auto`&&i(a)!==`0`&&(e.warn(`An element that is positioned static has style.`+r+`=`+a+` which is ignored due to the static positioning. The element will need to be positioned relative, so the style.`+r+` will be set to 0. Element: `,t),t.style[r]=0)};r(t,s,n,`top`),r(t,s,n,`right`),r(t,s,n,`bottom`),r(t,s,n,`left`)}}function r(e,t,n,r){return e=e?e+`px`:`0`,t=t?t+`px`:`0`,n=n?n+`px`:`0`,r=r?r+`px`:`0`,[`left: `+e,`top: `+t,`right: `+r,`bottom: `+n]}if(d(`Injecting elements`),!i(s)){d(`Aborting because element has been uninstalled`);return}n();var a=i(s).container;a||=M();var l=o.width,f=o.height,p=u([`position: absolute`,`flex: none`,`overflow: hidden`,`z-index: -1`,`visibility: hidden`,`width: 100%`,`height: 100%`,`left: 0px`,`top: 0px`]),h=u([`position: absolute`,`flex: none`,`overflow: hidden`,`z-index: -1`,`visibility: hidden`].concat(r(-(1+l),-(1+f),-f,-l))),g=u([`position: absolute`,`flex: none`,`overflow: scroll`,`z-index: -1`,`visibility: hidden`,`width: 100%`,`height: 100%`]),_=u([`position: absolute`,`flex: none`,`overflow: scroll`,`z-index: -1`,`visibility: hidden`,`width: 100%`,`height: 100%`]),v=u([`position: absolute`,`left: 0`,`top: 0`]),y=u([`position: absolute`,`width: 200%`,`height: 200%`]),b=document.createElement(`div`),x=document.createElement(`div`),S=document.createElement(`div`),C=document.createElement(`div`),w=document.createElement(`div`),E=document.createElement(`div`);b.dir=`ltr`,b.style.cssText=p,b.className=c,x.className=c,x.style.cssText=h,S.style.cssText=g,C.style.cssText=v,w.style.cssText=_,E.style.cssText=y,S.appendChild(C),w.appendChild(E),x.appendChild(S),x.appendChild(w),b.appendChild(x),a.appendChild(b);function D(){var e=i(s);e&&e.onExpand?e.onExpand():d(`Aborting expand scroll handler: element has been uninstalled`)}function O(){var e=i(s);e&&e.onShrink?e.onShrink():d(`Aborting shrink scroll handler: element has been uninstalled`)}m(S,`scroll`,D),m(w,`scroll`,O),i(s).onExpandScroll=D,i(s).onShrinkScroll=O}function P(){function o(t,n,r){var i=C(t),a=D(n),o=O(r);i.style.setProperty(`width`,a+`px`,e.important?`important`:``),i.style.setProperty(`height`,o+`px`,e.important?`important`:``)}function c(n){var c=s.offsetWidth,u=s.offsetHeight,f=c!==i(s).lastWidth||u!==i(s).lastHeight;d(`Storing current size`,c,u),S(s,c,u),r.add(0,function(){if(f){if(!i(s)){d(`Aborting because element has been uninstalled`);return}if(!l()){d(`Aborting because element container has not been initialized`);return}if(e.debug){var n=s.offsetWidth,r=s.offsetHeight;(n!==c||r!==u)&&t.warn(a.get(s),`Scroll: Size changed before updating detector elements.`)}o(s,c,u)}}),r.add(1,function(){if(!i(s)){d(`Aborting because element has been uninstalled`);return}if(!l()){d(`Aborting because element container has not been initialized`);return}j(s,c,u)}),f&&n&&r.add(2,function(){if(!i(s)){d(`Aborting because element has been uninstalled`);return}if(!l()){d(`Aborting because element container has not been initialized`);return}n()})}function l(){return!!i(s).container}function u(){function e(){return i(s).lastNotifiedWidth===void 0}d(`notifyListenersIfNeeded invoked`);var t=i(s);if(e()&&t.lastWidth===t.startSize.width&&t.lastHeight===t.startSize.height)return d(`Not notifying: Size is the same as the start size, and there has been no notification yet.`);if(t.lastWidth===t.lastNotifiedWidth&&t.lastHeight===t.lastNotifiedHeight)return d(`Not notifying: Size already notified`);d(`Current size not notified, notifying...`),t.lastNotifiedWidth=t.lastWidth,t.lastNotifiedHeight=t.lastHeight,n(i(s).listeners,function(e){e(s)})}function f(){if(d(`startanimation triggered.`),h(s)){d(`Ignoring since element is still unrendered...`);return}d(`Element rendered.`);var e=g(s),t=_(s);(e.scrollLeft===0||e.scrollTop===0||t.scrollLeft===0||t.scrollTop===0)&&(d(`Scrollbars out of sync. Updating detector elements...`),c(u))}function p(){if(d(`Scroll detected.`),h(s)){d(`Scroll event fired while unrendered. Ignoring...`);return}c(u)}if(d(`registerListenersAndPositionElements invoked.`),!i(s)){d(`Aborting because element has been uninstalled`);return}i(s).onRendered=f,i(s).onExpand=p,i(s).onShrink=p;var m=i(s).style;o(s,m.width,m.height)}function F(){if(d(`finalizeDomMutation invoked.`),!i(s)){d(`Aborting because element has been uninstalled`);return}var e=i(s).style;S(s,e.width,e.height),j(s,e.width,e.height)}function I(){l(s)}function ee(){d(`Installing...`),b(),y(),r.add(0,x),r.add(1,N),r.add(2,P),r.add(3,F),r.add(4,I)}d(`Making detectable...`),f(s)?(d(`Element is detached`),M(),d(`Waiting until element is attached...`),i(s).onRendered=function(){d(`Element is now attached`),ee()}):ee()}function b(e){var t=i(e);t&&(t.onExpandScroll&&h(g(e),`scroll`,t.onExpandScroll),t.onShrinkScroll&&h(_(e),`scroll`,t.onShrinkScroll),t.onAnimationStart&&h(t.container,`animationstart`,t.onAnimationStart),t.container&&e.removeChild(t.container))}return{makeDetectable:y,addListener:v,uninstall:b,initDocument:l}}})),rS=s(((e,t)=>{var n=Gx().forEach,r=Kx(),i=qx(),a=Jx(),o=Yx(),s=Xx(),c=Zx(),l=$x(),u=eS(),d=tS(),f=nS();function p(e){return Array.isArray(e)||e.length!==void 0}function m(e){if(Array.isArray(e))return e;var t=[];return n(e,function(e){t.push(e)}),t}function h(e){return e&&e.nodeType===1}t.exports=function(e){e||={};var t=e.idHandler?{get:function(t){return e.idHandler.get(t,!0)},set:e.idHandler.set}:o({idGenerator:a(),stateHandler:u}),_=e.reporter;_||=s(_===!1);var v=g(e,`batchProcessor`,l({reporter:_})),y={};y.callOnAdd=!!g(e,`callOnAdd`,!0),y.debug=!!g(e,`debug`,!1);var b=i(t),x=r({stateHandler:u}),S,C=g(e,`strategy`,`object`),w=g(e,`important`,!1),E={reporter:_,batchProcessor:v,stateHandler:u,idHandler:t,important:w};if(C===`scroll`&&(c.isLegacyOpera()?(_.warn(`Scroll strategy is not supported on legacy Opera. Changing to object strategy.`),C=`object`):c.isIE(9)&&(_.warn(`Scroll strategy is not supported on IE9. Changing to object strategy.`),C=`object`)),C===`scroll`)S=f(E);else if(C===`object`)S=d(E);else throw Error(`Invalid strategy name: `+C);var D={};function O(e,r,i){function a(e){n(b.get(e),function(t){t(e)})}function o(e,t,n){b.add(t,n),e&&n(t)}if(i||(i=r,r=e,e={}),!r)throw Error(`At least one element required.`);if(!i)throw Error(`Listener required.`);if(h(r))r=[r];else if(p(r))r=m(r);else return _.error(`Invalid arguments. Must be a DOM element or a collection of DOM elements.`);var s=0,c=g(e,`callOnAdd`,y.callOnAdd),l=g(e,`onReady`,function(){}),d=g(e,`debug`,y.debug);n(r,function(e){u.getState(e)||(u.initState(e),t.set(e));var f=t.get(e);if(d&&_.log(`Attaching listener to element`,f,e),!x.isDetectable(e)){if(d&&_.log(f,`Not detectable.`),x.isBusy(e)){d&&_.log(f,`System busy making it detectable`),o(c,e,i),D[f]=D[f]||[],D[f].push(function(){s++,s===r.length&&l()});return}return d&&_.log(f,`Making detectable...`),x.markBusy(e,!0),S.makeDetectable({debug:d,important:w},e,function(e){if(d&&_.log(f,`onElementDetectable`),u.getState(e)){x.markAsDetectable(e),x.markBusy(e,!1),S.addListener(e,a),o(c,e,i);var t=u.getState(e);if(t&&t.startSize){var p=e.offsetWidth,m=e.offsetHeight;(t.startSize.width!==p||t.startSize.height!==m)&&a(e)}D[f]&&n(D[f],function(e){e()})}else d&&_.log(f,`Element uninstalled before being detectable.`);delete D[f],s++,s===r.length&&l()})}d&&_.log(f,`Already detecable, adding listener.`),o(c,e,i),s++}),s===r.length&&l()}function k(e){if(!e)return _.error(`At least one element is required.`);if(h(e))e=[e];else if(p(e))e=m(e);else return _.error(`Invalid arguments. Must be a DOM element or a collection of DOM elements.`);n(e,function(e){b.removeAllListeners(e),S.uninstall(e),u.cleanState(e)})}function A(e){S.initDocument&&S.initDocument(e)}return{listenTo:O,removeListener:b.removeListener,removeAllListeners:b.removeAllListeners,uninstall:k,initDocument:A}};function g(e,t,n){var r=e[t];return r==null&&n!==void 0?n:r}})),iS,aS,oS,sS=o((()=>{Py(),ov(),So(),kp(),iS=u(rS()),aS=u(Mf()),xx(),Zv(),oS=class extends aS.EventEmitter{get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get controlService(){return this.container.controlService}get configService(){return this.container.globalConfigService}get map(){return this.container.mapService}get coordinateSystemService(){return this.container.coordinateSystemService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get cameraService(){return this.container.cameraService}get interactionService(){return this.container.interactionService}get pickingService(){return this.container.pickingService}get shaderModuleService(){return this.container.shaderModuleService}get markerService(){return this.container.markerService}get popupService(){return this.container.popupService}constructor(e){super(),J(this,`destroyed`,!1),J(this,`loaded`,!1),J(this,`id`,void 0),J(this,`inited`,!1),J(this,`rendering`,!1),J(this,`$container`,void 0),J(this,`canvas`,void 0),J(this,`markerContainer`,void 0),J(this,`resizeDetector`,void 0),J(this,`hooks`,void 0),J(this,`handleWindowResized`,()=>{this.emit(`resize`),this.$container&&(this.initContainer(),this.coordinateSystemService.needRefresh=!0,this.render())}),J(this,`handleMapCameraChanged`,e=>{this.cameraService.update(e),this.render()}),this.container=e,this.hooks={init:new yo},this.id=e.id}init(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on(`imageUpdate`,()=>this.render()),this.fontService.init(),this.hooks.init.tapPromise(`initMap`,Z(function*(){t.debugService.log(`map.mapInitStart`,{type:t.map.version}),yield new Promise(e=>{t.map.onCameraChanged(n=>{t.cameraService.init(),t.cameraService.update(n),e()}),t.map.init()}),t.map.onCameraChanged(t.handleMapCameraChanged),t.map.addMarkerContainer(),t.markerService.addMarkers(),t.markerService.addMarkerLayers(),t.popupService.initPopup(),t.interactionService.init(),t.interactionService.on(Xv.Drag,t.addSceneEvent.bind(t))})),this.hooks.init.tapPromise(`initRenderer`,Z(function*(){let n=t.map?.getOverlayContainer()||void 0;if(n?t.$container=n:t.$container=vx(t.configService.getSceneConfig(t.id).id||``),t.$container){let{canvas:n}=e;if(t.canvas=n||cu(`canvas`,``,t.$container),t.setCanvas(),yield t.rendererService.init(t.canvas,t.configService.getSceneConfig(t.id),e.gl),t.registerContextLost(),t.initContainer(),t.resizeDetector=(0,iS.default)({strategy:`scroll`}),t.resizeDetector.listenTo(t.$container,t.handleWindowResized),window.matchMedia){var r;(r=window.matchMedia(`screen and (-webkit-min-device-pixel-ratio: 1.5)`))==null||r.addListener(t.handleWindowResized.bind(`screen`))}}else console.error(`容器 id 不存在`);t.pickingService.init(t.id)})),this.render()}registerContextLost(){let e=this.rendererService.getCanvas();e&&e.addEventListener(`webglcontextlost`,()=>this.emit(`webglcontextlost`))}addLayer(e){this.layerService.sceneService=this,this.layerService.add(e)}addMask(e){this.layerService.sceneService=this,this.layerService.addMask(e)}render(){var e=this;return Z(function*(){e.rendering||e.destroyed||(e.rendering=!0,e.inited?(yield e.layerService.initLayers(),yield e.layerService.renderLayers()):(yield e.hooks.init.promise(),e.destroyed&&e.destroy(),yield e.layerService.initLayers(),e.layerService.renderLayers(),e.controlService.addControls(),e.loaded=!0,e.emit(`loaded`),e.inited=!0),e.rendering=!1)})()}addFontFace(e,t){this.fontService.addFontFace(e,t)}getSceneContainer(){return this.$container}exportPng(e){var t=this;return Z(function*(){let n=t.$container?.getElementsByTagName(`canvas`)[0];return yield t.render(),e===`jpg`?n?.toDataURL(`image/jpeg`):n?.toDataURL(`image/png`)})()}getSceneConfig(){return this.configService.getSceneConfig(this.id)}getPointSizeRange(){return this.rendererService.getPointSizeRange()}addMarkerContainer(){let e=this.$container.parentElement;e!==null&&(this.markerContainer=cu(`div`,`l7-marker-container`,e))}getMarkerContainer(){return this.markerContainer}destroy(){var e;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(()=>{var e;(e=this.$container)==null||e.removeChild(this.canvas),this.canvas=null,this.rendererService.destroy()}),(e=this.$container)==null||(e=e.parentNode)==null||e.removeChild(this.$container),this.emit(`destroy`)}initContainer(){let e=Nu,t=this.$container?.clientWidth||400,n=this.$container?.clientHeight||300,r=this.canvas;r&&(r.width=t*e,r.height=n*e),this.rendererService.viewport({x:0,y:0,width:e*t,height:e*n})}setCanvas(){let e=Nu,t=this.$container?.clientWidth||400,n=this.$container?.clientHeight||300,r=this.canvas;r.width=t*e,r.height=n*e,r.style.width=`100%`,r.style.height=`100%`}addSceneEvent(e){this.emit(e.type,e)}}}));function cS(e){return Object.keys(e).reduce((t,n)=>t+`#define ${n.toUpperCase()} ${e[n]}\n`,`
`)}var lS,uS,dS,fS,pS,mS,hS,gS,_S,vS,yS,bS,xS,SS,CS,wS,TS,ES,DS=o((()=>{cv(),ov(),kp(),Cv(),{uniq:lS}=tu,uS=`#define PI (3.14159265359)
`,dS=`#define ambientRatio (0.5)
#define diffuseRatio (0.3)
#define specularRatio (0.2)

float calc_lighting(vec4 pos) {
  vec3 worldPos = vec3(pos * u_ModelMatrix);

  vec3 worldNormal = a_Normal;
  // //cal light weight
  vec3 viewDir = normalize(u_CameraPosition - worldPos);

  vec3 lightDir = normalize(vec3(1, -10.5, 12));

  vec3 halfDir = normalize(viewDir + lightDir);
  // //lambert
  float lambert = dot(worldNormal, lightDir);
  //specular
  float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
  //sum to light weight
  float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

  return lightWeight;
}
`,fS=`#define SHIFT_RIGHT17 (1.0 / 131072.0)
#define SHIFT_RIGHT18 (1.0 / 262144.0)
#define SHIFT_RIGHT19 (1.0 / 524288.0)
#define SHIFT_RIGHT20 (1.0 / 1048576.0)
#define SHIFT_RIGHT21 (1.0 / 2097152.0)
#define SHIFT_RIGHT22 (1.0 / 4194304.0)
#define SHIFT_RIGHT23 (1.0 / 8388608.0)
#define SHIFT_RIGHT24 (1.0 / 16777216.0)

#define SHIFT_LEFT17 (131072.0)
#define SHIFT_LEFT18 (262144.0)
#define SHIFT_LEFT19 (524288.0)
#define SHIFT_LEFT20 (1048576.0)
#define SHIFT_LEFT21 (2097152.0)
#define SHIFT_LEFT22 (4194304.0)
#define SHIFT_LEFT23 (8388608.0)
#define SHIFT_LEFT24 (16777216.0)

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(unpack_float(encodedColor[0]) / 255.0, unpack_float(encodedColor[1]) / 255.0);
}
`,pS=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,mS=`in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE (0.0)
#define PICKING_ENCODE (1.0)
#define PICKING_HIGHLIGHT (2.0)
#define COLOR_SCALE (1.0 / 255.0)

#define HIGHLIGHT (1.0)
#define SELECT (2.0)

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float activeType = v_PickingResult.a;
  if (activeType > 0.0) {
    vec4 highLightColor = activeType > 1.5 ? u_SelectColor : u_HighlightColor;
    highLightColor = highLightColor * COLOR_SCALE;
    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));
    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }

}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE
    ? vec4(pickingColor, step(0.001, color.a))
    : color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // 过滤多余的 shader 计算
  // return color;
  if (u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }

}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // 过滤多余的 shader 计算
  // return color;
  if (u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,hS=`layout(location = ATTRIBUTE_LOCATION_PICKING_COLOR) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// 判断当前点是否已经被 select 选中
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  if(u_PickingStage == PICKING_HIGHLIGHT) {
    if(isVertexPicked(pickingColor)) {
       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);
       return;
    }
    if(isVertexSelected(pickingColor)) {
     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);
      return;
    }

  } else {
      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);
      return;
  }

  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));

  // // Stores the picking color so that the fragment shader can render it during picking
  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,gS=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_activeMix;
};
`,_S=`#define E (2.718281828459045)
vec2 ProjectFlat(vec2 lnglat) {
  float maxs = 85.0511287798;
  float lat = max(min(maxs, lnglat.y), -maxs);
  float scale = 268435456.0;
  float d = PI / 180.0;
  float x = lnglat.x * d;
  float y = lat * d;
  y = log(tan(PI / 4.0 + y / 2.0));

  float a = 0.5 / PI,
    b = 0.5,
    c = -0.5 / PI;
  d = 0.5;
  x = scale * (a * x + b);
  y = scale * (c * y + d);
  return vec2(x, y);
}

vec2 unProjectFlat(vec2 px) {
  float a = 0.5 / PI;
  float b = 0.5;
  float c = -0.5 / PI;
  float d = 0.5;
  float scale = 268435456.0;
  float x = (px.x / scale - b) / a;
  float y = (px.y / scale - d) / c;
  y = (atan(pow(E, y)) - PI / 4.0) * 2.0;
  d = PI / 180.0;
  float lat = y / d;
  float lng = x / d;
  return vec2(lng, lat);
}

float pixelDistance(vec2 from, vec2 to) {
  vec2 a1 = ProjectFlat(from);
  vec2 b1 = ProjectFlat(to);
  return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) {
  // 经纬度 => 平面坐标
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) {
  // 平面坐标 => 经纬度
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}

float customPixelDistance(vec2 from, vec2 to) {
  vec2 a1 = ProjectFlat(from);
  vec2 b1 = ProjectFlat(to);
  return distance(a1, b1);
}
`,vS=`#define TILE_SIZE (512.0)
#define PI (3.1415926536)
#define WORLD_SCALE (TILE_SIZE / (PI * 2.0))
#define EARTH_CIRCUMFERENCE (40.03e6)

#define COORDINATE_SYSTEM_LNGLAT (1.0) // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET (2.0) // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE (3.0)
#define COORDINATE_SYSTEM_IDENTITY (4.0)
#define COORDINATE_SYSTEM_METER_OFFSET (5.0)

#pragma include "scene_uniforms"

const vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)));
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}

// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1.0, 1.0);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
      u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01 ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}

vec4 project_position(vec4 position, vec2 position64xyLow) {
  // 检查是否使用了图层相对坐标转换
  bool usingRelativeCoords = abs(u_RelativeOrigin.x) > 0.0001 || abs(u_RelativeOrigin.y) > 0.0001;

  if (usingRelativeCoords) {
    // 相对坐标系的特殊处理：CPU侧已确保ViewportCenter=RelativeOrigin
    // 在高缩放级别时直接使用相对坐标，避免精度问题

    if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // 高缩放级别：直接使用相对坐标作为偏移
      // 由于ViewportCenter已被设置为RelativeOrigin，可以直接使用position
      float X = position.x;
      float Y = position.y;
      return project_offset(
        vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w)
      );
    } else {
      // 低缩放级别：转换为绝对坐标后使用墨卡托投影
      vec2 absolutePos = position.xy + u_RelativeOrigin.xy;
      return vec4(
        project_mercator(absolutePos) * WORLD_SCALE * u_ZoomScale,
        project_scale(position.z),
        position.w
      );
    }
  }

  // 处理普通坐标系（非相对坐标）
  vec4 absolutePosition = position;
  vec2 absolutePosition64xyLow = position64xyLow;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // 在偏移坐标系下
    vec2 center = u_ViewportCenter;
    float X = absolutePosition.x - center.x;
    float Y = absolutePosition.y - center.y;
    return project_offset(
      vec4(
        X + absolutePosition64xyLow.x,
        Y + absolutePosition64xyLow.y,
        absolutePosition.z,
        absolutePosition.w
      )
    );
  }
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
    u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01
  ) {
    // 在经纬度坐标系下使用墨卡托投影
    return vec4(
      project_mercator(absolutePosition.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(absolutePosition.z),
      absolutePosition.w
    );
  }

  return absolutePosition;
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_XY_LOW);
}

vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

// 适配纹理贴图的等像素大小
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance;
  }

  return pixel * 2.0 * u_FocalDistance;
}

// 在不论什么底图下需要统一处理的时候使用
float project_float_pixel(float pixel) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
    return pixel * pow(2.0, 19.0 - u_Zoom) * u_FocalDistance;
  }

  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
    return meter;
  } else {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;

}

float project_pixel(float pixel) {
  return pixel * u_FocalDistance;
}

vec2 project_pixel(vec2 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec3 project_pixel(vec3 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}

bool isEqual(float a, float b) {
  return a < b + 0.001 && a > b - 0.001;
}

`,yS=`vec2 rotate_matrix(vec2 v, float a) {
  float b = a / 180.0 * 3.1415926535897932384626433832795;
  float s = sin(b);
  float c = cos(b);
  mat2 m = mat2(c, s, -s, c);
  return m * v;
}
`,bS=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
  vec2 u_RelativeOrigin;
  float u_Reserved3;
};
`,xS=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b) {
  return a.x * b.x - a.y * b.y;
}

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0 / k;
  if (p.x + k * p.y > 0.0) p = vec2(p.x - k * p.y, -k * p.x - p.y) / 2.0;
  p.x -= clamp(p.x, -2.0, 0.0);
  return -length(p) * sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p) - b;
  return length(max(d, vec2(0))) + min(max(d.x, d.y), 0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994, 0.587785252, 0.726542528);
  p.x = abs(p.x);
  p -= 2.0 * min(dot(vec2(-k.x, k.y), p), 0.0) * vec2(-k.x, k.y);
  p -= 2.0 * min(dot(vec2(k.x, k.y), p), 0.0) * vec2(k.x, k.y);
  p -= vec2(clamp(p.x, -r * k.z, r * k.z), r);
  return length(p) * sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404, 0.5, 0.577350269);
  p = abs(p);
  p -= 2.0 * min(dot(k.xy, p), 0.0) * k.xy;
  p -= vec2(clamp(p.x, -k.z * r, k.z * r), r);
  return length(p) * sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623);
  p = abs(p);
  p -= 2.0 * min(dot(vec2(k.x, k.y), p), 0.0) * vec2(k.x, k.y);
  p -= 2.0 * min(dot(vec2(-k.x, k.y), p), 0.0) * vec2(-k.x, k.y);
  p -= vec2(clamp(p.x, -k.z * r, k.z * r), r);
  return length(p) * sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k = vec4(-0.5, 0.8660254038, 0.5773502692, 1.7320508076);
  p = abs(p);
  p -= 2.0 * min(dot(k.xy, p), 0.0) * k.xy;
  p -= 2.0 * min(dot(k.yx, p), 0.0) * k.yx;
  p -= vec2(clamp(p.x, r * k.z, r * k.w), r);
  return length(p) * sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0 * ndot(q, b) + ndot(b, b)) / dot(b, b), -1.0, 1.0);
  float d = length(q - 0.5 * b * vec2(1.0 - h, 1.0 + h));
  return d * sign(q.x * b.y + q.y * b.x - b.x * b.y);
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r * r - d * d); // can delay this sqrt
  return (p.y - b) * d > p.x * b
    ? length(p - vec2(0.0, b))
    : length(p - vec2(-d, 0.0)) - r;
}
`,SS=/precision\s+(high|low|medium)p\s+float/,CS=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,wS=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,TS=/void\s+main\s*\([^)]*\)\s*\{\n?/,ES=class{constructor(){J(this,`moduleCache`,{}),J(this,`rawContentCache`,{})}registerBuiltinModules(){this.destroy(),this.registerModule(`common`,{vs:uS,fs:uS}),this.registerModule(`decode`,{vs:fS,fs:``}),this.registerModule(`scene_uniforms`,{vs:bS,fs:bS}),this.registerModule(`picking_uniforms`,{vs:gS,fs:gS}),this.registerModule(`projection`,{vs:vS,fs:vS}),this.registerModule(`project`,{vs:_S,fs:``}),this.registerModule(`sdf_2d`,{vs:``,fs:xS}),this.registerModule(`lighting`,{vs:pS,fs:``}),this.registerModule(`light`,{vs:dS,fs:``}),this.registerModule(`picking`,{vs:hS,fs:mS}),this.registerModule(`rotation_2d`,{vs:yS,fs:``})}registerModule(e,t){t.vs=t.vs.replace(/\r\n/g,`
`),t.fs=t.fs.replace(/\r\n/g,`
`);let{vs:n,fs:r,uniforms:i,defines:a,inject:o}=t,{content:s,uniforms:c}=bv(n),{content:l,uniforms:u}=bv(r);this.rawContentCache[e]={fs:l,defines:a,inject:o,uniforms:Y(Y(Y({},c),u),i),vs:s}}getModule(e){let t=this.rawContentCache[e].vs,n=this.rawContentCache[e].fs,{defines:r={},inject:i={}}=this.rawContentCache[e],a={};i[`vs:#decl`]&&(t=i[`vs:#decl`]+t,a=bv(i[`vs:#decl`]).uniforms),i[`vs:#main-start`]&&(t=t.replace(TS,e=>e+i[`vs:#main-start`])),i[`fs:#decl`]&&(n=i[`fs:#decl`]+n),t=cS(r)+t;let{content:o,includeList:s}=this.processModule(t,[],`vs`),{content:c,includeList:l}=this.processModule(n,[],`fs`),u=lS(s.concat(l).concat(e)).reduce((e,t)=>Y(Y({},e),this.rawContentCache[t].uniforms),Y({},a)),d=(SS.test(c)?``:CS)+o,f=(SS.test(c)?``:CS)+c;return this.moduleCache[e]={vs:d.trim(),fs:f.trim(),uniforms:u},this.moduleCache[e]}destroy(){this.moduleCache={},this.rawContentCache={}}processModule(e,t,n){return{content:e.replace(wS,(e,r)=>{let i=r.split(` `)[0].replace(/"/g,``);if(t.indexOf(i)>-1)return``;let a=this.rawContentCache[i][n];t.push(i);let{content:o}=this.processModule(a,t,n);return o}),includeList:t}}}})),OS,kS=o((()=>{ov(),uv(),OS=class{constructor(){J(this,`shaderModuleService`,void 0),J(this,`rendererService`,void 0),J(this,`cameraService`,void 0),J(this,`mapService`,void 0),J(this,`interactionService`,void 0),J(this,`layerService`,void 0),J(this,`config`,void 0)}getName(){return``}getType(){return lv.Normal}init(e,t){this.config=t,this.rendererService=e.getContainer().rendererService,this.cameraService=e.getContainer().cameraService,this.mapService=e.getContainer().mapService,this.interactionService=e.getContainer().interactionService,this.layerService=e.getContainer().layerService,this.shaderModuleService=e.getContainer().shaderModuleService}render(e){}}})),AS,jS=o((()=>{kS(),AS=class extends OS{getName(){return`clear`}init(e,t){super.init(e,t)}render(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}})),MS,NS=o((()=>{Py(),ov(),uv(),MS=class{constructor(e){J(this,`passes`,[]),J(this,`layer`,void 0),J(this,`renderFlag`,void 0),J(this,`width`,0),J(this,`height`,0),this.postProcessor=e}setLayer(e){this.layer=e}setRenderFlag(e){this.renderFlag=e}getRenderFlag(){return this.renderFlag}getPostProcessor(){return this.postProcessor}render(){var e=this;return Z(function*(){for(let t of e.passes)yield t.render(e.layer);yield e.postProcessor.render(e.layer)})()}resize(e,t){(this.width!==e||this.height!==t)&&(this.postProcessor.resize(e,t),this.width=e,this.height=t)}add(e,t){e.getType()===lv.PostProcessing?this.postProcessor.add(e,this.layer,t):(e.init(this.layer,t),this.passes.push(e))}insert(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}destroy(){this.passes.length=0}}})),PS,FS=o((()=>{cv(),Py(),ov(),kp(),Zv(),dv(),uv(),kS(),PS=class extends OS{constructor(...e){var t;super(...e),t=this,J(this,`pickingFBO`,void 0),J(this,`layer`,void 0),J(this,`width`,0),J(this,`height`,0),J(this,`alreadyInRendering`,!1),J(this,`pickFromPickingFBO`,({x:e,y:n,lngLat:r,type:i})=>{if(!this.layer.isVisible()||!this.layer.needPick(i))return;let{getViewportSize:a,readPixelsAsync:o,useFramebuffer:s}=this.rendererService,{width:c,height:l}=a(),{enableHighlight:u,enableSelect:d}=this.layer.getLayerConfig(),f=e*Nu,p=n*Nu;if(f>c||f<0||p>l||p<0)return;let m;s(this.pickingFBO,Z(function*(){if(m=yield o({x:Math.round(f),y:Math.round(l-(n+1)*Nu),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO}),m[0]!==0||m[1]!==0||m[2]!==0){let a=Rs(m),o=t.layer.getSource().getFeatureById(a),s={x:e,y:n,type:i,lngLat:r,featureId:a,feature:o};o&&(t.layer.setCurrentPickId(a),t.triggerHoverOnLayer(s))}else{let a={x:e,y:n,lngLat:r,type:t.layer.getCurrentPickId()===null?`un`+i:`mouseout`,featureId:null,feature:null};t.triggerHoverOnLayer(Y(Y({},a),{},{type:`unpick`})),t.triggerHoverOnLayer(a),t.layer.setCurrentPickId(null)}u&&t.highlightPickedFeature(m),d&&i===`click`&&m?.toString()!==[0,0,0,0].toString()&&t.selectFeature(m)}))})}getType(){return lv.Normal}getName(){return`pixelPicking`}init(e,t){super.init(e,t),this.layer=e;let{createTexture2D:n,createFramebuffer:r,getViewportSize:i}=this.rendererService,{width:a,height:o}=i();this.pickingFBO=r({color:n({width:a,height:o,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,label:`Picking Texture`})}),this.interactionService.on(Xv.Hover,this.pickFromPickingFBO),this.interactionService.on(Xv.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Xv.Active,this.highlightFeatureHandle.bind(this))}render(e){if(this.alreadyInRendering)return;let{getViewportSize:t,useFramebuffer:n,clear:r}=this.rendererService,{width:i,height:a}=t();this.alreadyInRendering=!0,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:i,height:a}),this.width=i,this.height=a),n(this.pickingFBO,()=>{r({framebuffer:this.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});let t=this.layer.multiPassRenderer.getRenderFlag();this.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),this.layer.multiPassRenderer.setRenderFlag(t),this.alreadyInRendering=!1})}triggerHoverOnLayer(e){this.layer.emit(e.type,e)}highlightPickedFeature(e){let[t,n,r]=e;this.layer.hooks.beforeHighlight.call([t,n,r]),this.layerService.renderLayers()}selectFeature(e){let[t,n,r]=e;this.layer.hooks.beforeSelect.call([t,n,r]),this.layerService.renderLayers()}selectFeatureHandle({featureId:e}){let t=zs(e);this.selectFeature(new Uint8Array(t))}highlightFeatureHandle({featureId:e}){let t=zs(e);this.highlightPickedFeature(new Uint8Array(t))}}})),IS,LS=o((()=>{Py(),ov(),Cx(),dv(),IS=class{constructor(e){J(this,`passes`,[]),J(this,`readFBO`,void 0),J(this,`writeFBO`,void 0),this.rendererService=e,this.init()}getReadFBO(){return this.readFBO}getWriteFBO(){return this.writeFBO}getCurrentFBOTex(){let{getViewportSize:e,createTexture2D:t}=this.rendererService,{width:n,height:r}=e();return t({x:0,y:0,width:n,height:r,copy:!0})}getReadFBOTex(){var e=this;let{useFramebuffer:t}=this.rendererService;return new Promise(n=>{t(this.readFBO,Z(function*(){n(e.getCurrentFBOTex())}))})}renderBloomPass(e,t){var n=this;return Z(function*(){let r=yield n.getReadFBOTex(),i=0;for(;i<4;)yield t.render(e,r),n.swap(),i++})()}render(e){var t=this;return Z(function*(){for(let n=0;n<t.passes.length;n++){let r=t.passes[n];r.setRenderToScreen(t.isLastEnabledPass(n)),r.getName()===`bloom`?yield t.renderBloomPass(e,r):(yield r.render(e),n!==t.passes.length-1&&t.swap())}})()}resize(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}add(e,t,n){e.init(t,n),this.passes.push(e)}insert(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}getPostProcessingPassByName(e){return this.passes.find(t=>t.getName()===e)}init(){let{createFramebuffer:e,createTexture2D:t}=this.rendererService;this.readFBO=e({color:t({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,usage:Sx.RENDER_TARGET})}),this.writeFBO=e({color:t({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,usage:Sx.RENDER_TARGET})})}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}swap(){let e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}})),RS,zS=o((()=>{uv(),kS(),RS=class extends OS{getType(){return lv.Normal}getName(){return`render`}init(e,t){super.init(e,t)}render(e){let{useFramebuffer:t,clear:n}=this.rendererService,r=e.multiPassRenderer.getPostProcessor().getReadFBO();t(r,()=>{n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:r}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach(t=>{t.draw({uniforms:e.layerModel.getUninforms()})}),e.multiPassRenderer.setRenderFlag(!0)})}}})),BS,VS,HS,US,WS=o((()=>{cv(),kp(),_v(),BS=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,VS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,{isNil:HS}=tu,US=class extends gv{setupShaders(){this.shaderModuleService.registerModule(`blur-pass`,{vs:VS,fs:BS});let{vs:e,fs:t,uniforms:n}=this.shaderModuleService.getModule(`blur-pass`),{width:r,height:i}=this.rendererService.getViewportSize();return{vs:e,fs:t,uniforms:Y(Y({},n),{},{u_ViewportSize:[r,i]})}}convertOptionsToUniforms(e){let t={};return HS(e.bloomRadius)||(t.u_radius=e.bloomRadius),HS(e.bloomIntensity)||(t.u_intensity=e.bloomIntensity),HS(e.bloomBaseRadio)||(t.u_baseRadio=e.bloomBaseRadio),t}}})),GS,KS,qS,JS,YS=o((()=>{cv(),kp(),_v(),GS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,KS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,{isNil:qS}=tu,JS=class extends gv{setupShaders(){this.shaderModuleService.registerModule(`blur-pass`,{vs:KS,fs:GS});let{vs:e,fs:t,uniforms:n}=this.shaderModuleService.getModule(`blur-pass`),{width:r,height:i}=this.rendererService.getViewportSize();return{vs:e,fs:t,uniforms:Y(Y({},n),{},{u_ViewportSize:[r,i]})}}convertOptionsToUniforms(e){let t={};return qS(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}})),XS,ZS,QS,$S,eC=o((()=>{cv(),kp(),_v(),XS=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,ZS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,{isNil:QS}=tu,$S=class extends gv{setupShaders(){this.shaderModuleService.registerModule(`blur-pass`,{vs:ZS,fs:XS});let{vs:e,fs:t,uniforms:n}=this.shaderModuleService.getModule(`blur-pass`),{width:r,height:i}=this.rendererService.getViewportSize();return{vs:e,fs:t,uniforms:Y(Y({},n),{},{u_ViewportSize:[r,i]})}}convertOptionsToUniforms(e){let t={};return QS(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}})),tC,nC,rC,iC=o((()=>{cv(),_v(),tC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,nC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,rC=class extends gv{setupShaders(){this.shaderModuleService.registerModule(`colorhalftone-pass`,{vs:nC,fs:tC});let{vs:e,fs:t,uniforms:n}=this.shaderModuleService.getModule(`colorhalftone-pass`),{width:r,height:i}=this.rendererService.getViewportSize();return{vs:e,fs:t,uniforms:Y(Y({},n),{},{u_ViewportSize:[r,i]})}}}})),aC,oC,sC,cC=o((()=>{_v(),aC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}
`,oC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,sC=class extends gv{setupShaders(){return this.shaderModuleService.registerModule(`copy-pass`,{vs:oC,fs:aC}),this.shaderModuleService.getModule(`copy-pass`)}}})),lC,uC,dC,fC=o((()=>{cv(),_v(),lC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,uC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,dC=class extends gv{setupShaders(){this.shaderModuleService.registerModule(`hexagonalpixelate-pass`,{vs:uC,fs:lC});let{vs:e,fs:t,uniforms:n}=this.shaderModuleService.getModule(`hexagonalpixelate-pass`),{width:r,height:i}=this.rendererService.getViewportSize();return{vs:e,fs:t,uniforms:Y(Y({},n),{},{u_ViewportSize:[r,i]})}}}})),pC,mC,hC,gC=o((()=>{cv(),_v(),pC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,mC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,hC=class extends gv{setupShaders(){this.shaderModuleService.registerModule(`ink-pass`,{vs:mC,fs:pC});let{vs:e,fs:t,uniforms:n}=this.shaderModuleService.getModule(`ink-pass`),{width:r,height:i}=this.rendererService.getViewportSize();return{vs:e,fs:t,uniforms:Y(Y({},n),{},{u_ViewportSize:[r,i]})}}}})),_C,vC,yC,bC=o((()=>{_v(),_C=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,vC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,yC=class extends gv{setupShaders(){return this.shaderModuleService.registerModule(`noise-pass`,{vs:vC,fs:_C}),this.shaderModuleService.getModule(`noise-pass`)}}})),xC,SC,CC,wC=o((()=>{_v(),xC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0.0, 1.0);
}
`,SC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,CC=class extends gv{setupShaders(){return this.shaderModuleService.registerModule(`sepia-pass`,{vs:xC,fs:SC}),this.shaderModuleService.getModule(`sepia-pass`)}}}));function TC(){let e=new ES,t=new ux,n=new zb,r=new sx(n),i=new jy,a=new zy,o=new Wb,s=new Kb,c=new Hb,l={id:`${OC++}`,globalConfigService:DC,shaderModuleService:e,debugService:t,cameraService:n,coordinateSystemService:r,fontService:i,iconService:a,markerService:o,popupService:s,controlService:c,customRenderService:{}};l.layerService=new jx(l),l.sceneService=new oS(l),l.interactionService=new gx(l),l.pickingService=new Tx(l);let u={clear:new AS,pixelPicking:new PS,render:new RS};l.normalPassFactory=e=>u[e];let d={copy:new sC,bloom:new US,blurH:new JS,blurV:new $S,noise:new yC,sepia:new CC,colorHalftone:new rC,hexagonalPixelate:new dC,ink:new hC};return l.postProcessingPass=d,l.postProcessingPassFactory=e=>d[e],l}function EC(e){let t=Y({},e);return t.postProcessor=new IS(t.rendererService),t.multiPassRenderer=new MS(t.postProcessor),t.styleAttributeService=new Ux(t.rendererService),t}var DC,OC,kC=o((()=>{cv(),My(),By(),Bb(),Ub(),Gb(),qb(),ex(),cx(),dx(),_x(),Ex(),Mx(),Wx(),sS(),DS(),jS(),NS(),FS(),LS(),zS(),WS(),YS(),eC(),iC(),cC(),fC(),gC(),bC(),wC(),DC=new $b,OC=0})),AC=o((()=>{})),jC=o((()=>{})),MC=o((()=>{})),NC=o((()=>{})),PC=o((()=>{})),FC=o((()=>{})),IC=o((()=>{})),LC=o((()=>{})),RC,zC=o((()=>{RC=[`loaded`,`fontloaded`,`maploaded`,`resize`,`destroy`,`dragstart`,`dragging`,`dragend`,`dragcancel`]})),BC=o((()=>{})),VC,HC=o((()=>{VC=function(e){return e.IMAGE=`image`,e.CUSTOMIMAGE=`customImage`,e.ARRAYBUFFER=`arraybuffer`,e.RGB=`rgb`,e.TERRAINRGB=`terrainRGB`,e.CUSTOMRGB=`customRGB`,e.CUSTOMARRAYBUFFER=`customArrayBuffer`,e.CUSTOMTERRAINRGB=`customTerrainRGB`,e}({})})),UC=o((()=>{_v(),Cv(),Pv(),Fv(),Iv(),Lv(),zv(),Vv(),Hv(),Uv(),Wv(),qv(),Yv(),Zv(),Qv(),ry(),sy(),ly(),dv(),kC(),AC(),jC(),MC(),NC(),PC(),uv(),FC(),IC(),Cx(),LC(),zC(),BC(),HC()})),WC,GC,KC,qC=o((()=>{kp(),Z_(),WC=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),GC=(e,t,n,r)=>WC(void 0,null,function*(){return new Promise((i,a)=>{t({x:e.x,y:e.y,z:e.z},(e,t)=>{if(e||t.length===0){a(e);return}t&&B_([{data:t,bands:[0]}],n,r,(e,t)=>{e?a(e):t&&i(t)})})})}),KC=(e,t)=>WC(void 0,null,function*(){return new Promise((n,r)=>{t({x:e.x,y:e.y,z:e.z},(e,t)=>{if(e||!t){r(e);return}t instanceof ArrayBuffer?Jo(t,(e,t)=>{e&&r(e),n(t)}):t instanceof HTMLImageElement?n(t):r(e)})})})}));function JC(e,t){return Array.isArray(e)?typeof e[0]==`string`?e.map(e=>wp(e,t)):e.map(e=>({url:wp(e.url,t),bands:e.bands||[0]})):wp(e,t)}function YC(e){return typeof e==`string`?[{url:e,bands:[0]}]:typeof e[0]==`string`?e.map(e=>({url:e,bands:[0]})):e}function XC(e,t){e.xhrCancel=()=>{t.map(e=>{e.abort()})}}var ZC=o((()=>{kp()}));function QC(e,t){return cw(this,null,function*(){let n=[],r=[],i=[];for(let a=0;a<e.length;a++){let o=e[a],s=sw(ow({},t),{url:o.url}),c=o.bands,{err:l,data:u,xhr:d}=yield Eo(sw(ow({},s),{type:`arrayBuffer`}));l&&i.push(l),r.push(d),n.push({data:u,bands:c})}return{rasterFiles:n,xhrList:r,errList:i}})}var $C,ew,tw,nw,rw,iw,aw,ow,sw,cw,lw,uw=o((()=>{kp(),Z_(),ZC(),$C=Object.defineProperty,ew=Object.defineProperties,tw=Object.getOwnPropertyDescriptors,nw=Object.getOwnPropertySymbols,rw=Object.prototype.hasOwnProperty,iw=Object.prototype.propertyIsEnumerable,aw=(e,t,n)=>t in e?$C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ow=(e,t)=>{for(var n in t||={})rw.call(t,n)&&aw(e,n,t[n]);if(nw)for(var n of nw(t))iw.call(t,n)&&aw(e,n,t[n]);return e},sw=(e,t)=>ew(e,tw(t)),cw=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),lw=(e,t,n,r,i)=>cw(void 0,null,function*(){let a=YC(t.url);if(a.length>1){let{rasterFiles:o,xhrList:s,errList:c}=yield QC(a,t);if(XC(e,s),c.length>0){n(c,null);return}B_(o,r,i,n)}else XC(e,[Uo(t,(e,t)=>{e?n(e):t&&B_([{data:t,bands:a[0].bands}],r,i,n)})])})})),dw,fw,pw,mw,hw,gw,_w,vw,yw,bw,xw,Sw,Cw,ww=o((()=>{kp(),uw(),ZC(),dw=Object.defineProperty,fw=Object.defineProperties,pw=Object.getOwnPropertyDescriptors,mw=Object.getOwnPropertySymbols,hw=Object.prototype.hasOwnProperty,gw=Object.prototype.propertyIsEnumerable,_w=(e,t,n)=>t in e?dw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,vw=(e,t)=>{for(var n in t||={})hw.call(t,n)&&_w(e,n,t[n]);if(mw)for(var n of mw(t))gw.call(t,n)&&_w(e,n,t[n]);return e},yw=(e,t)=>fw(e,pw(t)),bw=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),xw=(e,t,n,r)=>bw(void 0,null,function*(){let{format:i=Cw,operation:a,requestParameters:o={}}=r,s=yw(vw({},o),{url:JC(e,t)});return new Promise((e,t)=>{lw(n,s,(n,r)=>{n?t(n):r&&e(r)},i,a)})}),Sw=(e,t,n,r)=>bw(void 0,null,function*(){let i,a=Array.isArray(e)?e[0]:e;return i=r.wmtsOptions?(r?.getURLFromTemplate||Tp)(a,vw(vw({},t),r.wmtsOptions)):(r?.getURLFromTemplate||wp)(a,t),new Promise((e,t)=>{let a=qo(yw(vw({},r?.requestParameters),{url:i,type:r?.requestParameters?.type||`arrayBuffer`}),(n,r)=>{n?t(n):r&&e(r)},r.transformResponse);n.xhrCancel=()=>a.cancel()})}),Cw=()=>({rasterData:new Uint8Array([0]),width:1,height:1})}));function Tw(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!=`string`)}function Ew(e,t={}){if(Tw(e))throw Error(`tile server url is error`);let{extent:n=[1/0,1/0,-1/0,-1/0],coordinates:r}=t,i=t?.dataType||VC.IMAGE;i===VC.RGB&&(i=VC.ARRAYBUFFER);let a=Fw(Pw(Pw({},Iw),t),{getTileData:(n,r)=>{switch(i){case VC.IMAGE:return Sw(e,n,r,t);case VC.CUSTOMIMAGE:case VC.CUSTOMTERRAINRGB:return KC(r,t?.getCustomData);case VC.ARRAYBUFFER:return xw(e,n,r,t);case VC.CUSTOMARRAYBUFFER:case VC.CUSTOMRGB:return GC(r,t?.getCustomData,t?.format||Cw,t?.operation);default:return Sw(e,n,r,t)}}});return{data:e,dataArray:[{_id:1,coordinates:im(r,n)}],tilesetOptions:a,isTile:!0}}var Dw,Ow,kw,Aw,jw,Mw,Nw,Pw,Fw,Iw,Lw=o((()=>{UC(),qC(),ww(),om(),Dw=Object.defineProperty,Ow=Object.defineProperties,kw=Object.getOwnPropertyDescriptors,Aw=Object.getOwnPropertySymbols,jw=Object.prototype.hasOwnProperty,Mw=Object.prototype.propertyIsEnumerable,Nw=(e,t,n)=>t in e?Dw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Pw=(e,t)=>{for(var n in t||={})jw.call(t,n)&&Nw(e,n,t[n]);if(Aw)for(var n of Aw(t))Mw.call(t,n)&&Nw(e,n,t[n]);return e},Fw=(e,t)=>Ow(e,kw(t)),Iw={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},VC.ARRAYBUFFER,VC.RGB}));function Rw(e,t){let n=t,{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:i,width:a,height:o}=n,s=Jw(n,[`extent`,`coordinates`,`width`,`height`]);e.length<2&&console.warn(`RGB解析需要2个波段的数据`);let[c,l]=s.bands||[0,1],u=[e[c],e[l]],d=[];for(let e=0;e<u[0].length;e++)d.push((u[1][e]-u[0][e])/(u[1][e]+u[0][e]));let f=im(i,r);return{_id:1,dataArray:[qw(Kw({_id:1,data:d,width:a,height:o},s),{coordinates:f})]}}var zw,Bw,Vw,Hw,Uw,Ww,Gw,Kw,qw,Jw,Yw=o((()=>{om(),zw=Object.defineProperty,Bw=Object.defineProperties,Vw=Object.getOwnPropertyDescriptors,Hw=Object.getOwnPropertySymbols,Uw=Object.prototype.hasOwnProperty,Ww=Object.prototype.propertyIsEnumerable,Gw=(e,t,n)=>t in e?zw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Kw=(e,t)=>{for(var n in t||={})Uw.call(t,n)&&Gw(e,n,t[n]);if(Hw)for(var n of Hw(t))Ww.call(t,n)&&Gw(e,n,t[n]);return e},qw=(e,t)=>Bw(e,Vw(t)),Jw=(e,t)=>{var n={};for(var r in e)Uw.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Hw)for(var r of Hw(e))t.indexOf(r)<0&&Ww.call(e,r)&&(n[r]=e[r]);return n}}));function Xw(e,t){let n=t,{extent:r,coordinates:i,width:a,height:o}=n,s=oT(n,[`extent`,`coordinates`,`width`,`height`]);e.length<3&&console.warn(`RGB解析需要三个波段的数据`);let[c,l,u]=s.bands||[0,1,2],d=[e[c],e[l],e[u]],f=[],[p,m]=s?.countCut||[2,98],h=s?.RMinMax||P_(d[0],p,m),g=s?.GMinMax||P_(d[1],p,m),_=s?.BMinMax||P_(d[2],p,m);for(let e=0;e<d[0].length;e++)f.push(Math.max(0,d[0][e]-h[0])),f.push(Math.max(0,d[1][e]-g[0])),f.push(Math.max(0,d[2][e]-_[0]));let v=im(i,r);return{_id:1,dataArray:[aT(iT({_id:1,data:f,width:a,height:o,rMinMax:h,gMinMax:g,bMinMax:_},s),{coordinates:v})]}}var Zw,Qw,$w,eT,tT,nT,rT,iT,aT,oT,sT=o((()=>{I_(),om(),Zw=Object.defineProperty,Qw=Object.defineProperties,$w=Object.getOwnPropertyDescriptors,eT=Object.getOwnPropertySymbols,tT=Object.prototype.hasOwnProperty,nT=Object.prototype.propertyIsEnumerable,rT=(e,t,n)=>t in e?Zw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,iT=(e,t)=>{for(var n in t||={})tT.call(t,n)&&rT(e,n,t[n]);if(eT)for(var n of eT(t))nT.call(t,n)&&rT(e,n,t[n]);return e},aT=(e,t)=>Qw(e,$w(t)),oT=(e,t)=>{var n={};for(var r in e)tT.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&eT)for(var r of eT(e))t.indexOf(r)<0&&nT.call(e,r)&&(n[r]=e[r]);return n}}));function cT(e,t){let n=t,{extent:r,coordinates:i,min:a,max:o,width:s,height:c,format:l,operation:u}=n,d=vT(n,[`extent`,`coordinates`,`min`,`max`,`width`,`height`,`format`,`operation`]),f;f=l===void 0||nm(e)?Array.from(e):L_(Array.isArray(e)?e:[e],l,u);let p=im(i,r);return{_id:1,dataArray:[_T(gT({_id:1,data:f,width:s,height:c},d),{min:a,max:o,coordinates:p})]}}var lT,uT,dT,fT,pT,mT,hT,gT,_T,vT,yT=o((()=>{Z_(),om(),lT=Object.defineProperty,uT=Object.defineProperties,dT=Object.getOwnPropertyDescriptors,fT=Object.getOwnPropertySymbols,pT=Object.prototype.hasOwnProperty,mT=Object.prototype.propertyIsEnumerable,hT=(e,t,n)=>t in e?lT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,gT=(e,t)=>{for(var n in t||={})pT.call(t,n)&&hT(e,n,t[n]);if(fT)for(var n of fT(t))mT.call(t,n)&&hT(e,n,t[n]);return e},_T=(e,t)=>uT(e,dT(t)),vT=(e,t)=>{var n={};for(var r in e)pT.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&fT)for(var r of fT(e))t.indexOf(r)<0&&mT.call(e,r)&&(n[r]=e[r]);return n}}));function bT(e,t){return{data:e,dataArray:[],tilesetOptions:kT(OT(OT({},jT),t),{getTileData:e=>MT(e)}),isTile:!0}}var xT,ST,CT,wT,TT,ET,DT,OT,kT,AT,jT,MT,NT=o((()=>{xT=Object.defineProperty,ST=Object.defineProperties,CT=Object.getOwnPropertyDescriptors,wT=Object.getOwnPropertySymbols,TT=Object.prototype.hasOwnProperty,ET=Object.prototype.propertyIsEnumerable,DT=(e,t,n)=>t in e?xT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,OT=(e,t)=>{for(var n in t||={})TT.call(t,n)&&DT(e,n,t[n]);if(wT)for(var n of wT(t))ET.call(t,n)&&DT(e,n,t[n]);return e},kT=(e,t)=>ST(e,CT(t)),AT=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),jT={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},MT=e=>AT(void 0,null,function*(){return new Promise(t=>{let[n,r,i,a]=e.bounds;t({layers:{testTile:{features:[{type:`Feature`,properties:{key:e.x+`/`+e.y+`/`+e.z,x:(n+i)/2,y:(r+a)/2},geometry:{type:`LineString`,coordinates:[[i,a],[i,r],[n,r],[n,r]]}}]}}})})})}));function PT(e,t){let{callback:n}=t;return n&&(e.dataArray=e.dataArray.filter(n)),e}var FT=o((()=>{}));function IT(e,t){let n=e.dataArray,{size:r=10}=t,i=r/(2*Math.PI*HT)*(256<<20)/2,{gridHash:a,gridOffset:o}=LT(n,r);return{yOffset:i,xOffset:i,radius:i,type:`grid`,dataArray:VT(a,o,t)}}function LT(e,t){let n=1/0,r=-1/0,i;for(let t of e)i=t.coordinates[1],Number.isFinite(i)&&(n=i<n?i:n,r=i>r?i:r);let a=RT(t,(n+r)/2);if(a.xOffset<=0||a.yOffset<=0)return{gridHash:{},gridOffset:a};let o={};for(let t of e){let e=t.coordinates[1],n=t.coordinates[0];if(Number.isFinite(e)&&Number.isFinite(n)){let r=`${Math.floor((e+90)/a.yOffset)}-${Math.floor((n+180)/a.xOffset)}`;o[r]=o[r]||{count:0,points:[]},o[r].count+=1,o[r].points.push(t)}}return{gridHash:o,gridOffset:a}}function RT(e,t){return{yOffset:zT(e),xOffset:BT(t,e)}}function zT(e){return e/HT*(180/Math.PI)}function BT(e,t){return t/HT*(180/Math.PI)/Math.cos(e*Math.PI/180)}function VT(e,t,n){return Object.keys(e).reduce((r,i,a)=>{let o=i.split(`-`),s=parseInt(o[0],10),c=parseInt(o[1],10),l={};if(n.field&&n.method){let t=Ef(e[i].points,n.field);l[n.method]=Of[n.method](t)}return Object.assign(l,{_id:a,coordinates:Sd([-180+t.xOffset*(c+.5),-90+t.yOffset*(s+.5)]),rawData:e[i].points,count:e[i].count}),r.push(l),r},[])}var HT,UT=o((()=>{kp(),HT=6378e3}));function WT(e){return e[0]}function GT(e){return e[1]}function KT(){var e=0,t=0,n=1,r=1,i=WT,a=GT,o,s,c;function l(e){var t={},n=[],r,o=e.length;for(r=0;r<o;++r)if(!(isNaN(u=+i.call(null,l=e[r],r,e))||isNaN(d=+a.call(null,l,r,e)))){var l,u,d,f=Math.round(d/=c),p=Math.round(u=u/s-(f&1)/2),m=d-f;if(Math.abs(m)*3>1){var h=u-p,g=p+(u<p?-1:1)/2,_=f+(d<f?-1:1),v=u-g,y=d-_;h*h+m*m>v*v+y*y&&(p=g+(f&1?1:-1)/2,f=_)}var b=p+`-`+f,x=t[b];x?x.push(l):(n.push(x=t[b]=[l]),x.x=(p+(f&1)/2)*s,x.y=f*c)}return n}function u(e){var t=0,n=0;return JT.map(function(r){var i=Math.sin(r)*e,a=-Math.cos(r)*e,o=i-t,s=a-n;return t=i,n=a,[o,s]})}return l.hexagon=function(e){return`m`+u(e==null?o:+e).join(`l`)+`z`},l.centers=function(){for(var i=[],a=Math.round(t/c),l=Math.round(e/s),u=a*c;u<r+o;u+=c,++a)for(var d=l*s+(a&1)*s/2;d<n+s/2;d+=s)i.push([d,u]);return i},l.mesh=function(){var e=u(o).slice(0,4).join(`l`);return l.centers().map(function(t){return`M`+t+`m`+e}).join(``)},l.x=function(e){return arguments.length?(i=e,l):i},l.y=function(e){return arguments.length?(a=e,l):a},l.radius=function(e){return arguments.length?(o=+e,s=o*2*Math.sin(qT),c=o*1.5,l):o},l.size=function(i){return arguments.length?(e=t=0,n=+i[0],r=+i[1],l):[n-e,r-t]},l.extent=function(i){return arguments.length?(e=+i[0][0],t=+i[0][1],n=+i[1][0],r=+i[1][1],l):[[e,t],[n,r]]},l.radius(1)}var qT,JT,YT=o((()=>{qT=Math.PI/3,JT=[0,qT,2*qT,3*qT,4*qT,5*qT]})),XT=o((()=>{YT()}));function ZT(e,t){let n=e.dataArray,{size:r=10,method:i=`sum`}=t,a=r/(2*Math.PI*sE)*(256<<20)/2,o=n.map(e=>{let[t,n]=Sd(e.coordinates);return oE(aE({},e),{coordinates:[t,n]})});return{dataArray:KT().radius(a).x(e=>e.coordinates[0]).y(e=>e.coordinates[1])(o).map((e,n)=>{if(t.field&&i){let n=Ef(e,t.field);e[i]=Of[i](n)}return{[t.method]:e[i],count:e.length,rawData:e,coordinates:[e.x,e.y],_id:n}}),radius:a,xOffset:a,yOffset:a,type:`hexagon`}}var QT,$T,eE,tE,nE,rE,iE,aE,oE,sE,cE=o((()=>{kp(),XT(),QT=Object.defineProperty,$T=Object.defineProperties,eE=Object.getOwnPropertyDescriptors,tE=Object.getOwnPropertySymbols,nE=Object.prototype.hasOwnProperty,rE=Object.prototype.propertyIsEnumerable,iE=(e,t,n)=>t in e?QT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,aE=(e,t)=>{for(var n in t||={})nE.call(t,n)&&iE(e,n,t[n]);if(tE)for(var n of tE(t))rE.call(t,n)&&iE(e,n,t[n]);return e},oE=(e,t)=>$T(e,eE(t)),sE=6378e3}));function lE(e,t){let{sourceField:n,targetField:r,data:i}=t,a={};return i.forEach(e=>{a[e[n]]=e}),e.dataArray=e.dataArray.map(e=>{let t=e[r];return hE(hE({},e),a[t])}),e}var uE,dE,fE,pE,mE,hE,gE=o((()=>{uE=Object.defineProperty,dE=Object.getOwnPropertySymbols,fE=Object.prototype.hasOwnProperty,pE=Object.prototype.propertyIsEnumerable,mE=(e,t,n)=>t in e?uE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,hE=(e,t)=>{for(var n in t||={})fE.call(t,n)&&mE(e,n,t[n]);if(dE)for(var n of dE(t))pE.call(t,n)&&mE(e,n,t[n]);return e}}));function _E(e,t){let{callback:n}=t;return n&&(e.dataArray=e.dataArray.map(n)),e}var vE=o((()=>{})),yE=o((()=>{})),bE=o((()=>{yE(),f_()}));function xE(e){let t=1/0,n=-1/0,r=1/0,i=-1/0;return e.forEach(e=>{let a=e.coordinates;if(!a)return;let o=e=>{if(typeof e[0]==`number`&&typeof e[1]==`number`){let[a,o]=e;t=Math.min(t,a),n=Math.max(n,a),r=Math.min(r,o),i=Math.max(i,o)}else Array.isArray(e[0])&&e.forEach(o)};o(a)}),[(t+n)/2,(r+i)/2]}function SE(e,t){let[n,r]=t;return e.map(e=>{if(!e.coordinates)return e;let t=e=>typeof e[0]==`number`&&typeof e[1]==`number`?[Number((e[0]-n).toPrecision(15)),Number((e[1]-r).toPrecision(15)),...e.slice(2)||[]]:Array.isArray(e[0])?e.map(t):e;return ME(jE({},e),{coordinates:t(e.coordinates)})})}function CE(e,t={}){let{enableRelativeCoordinates:n=!1,relativeOrigin:r}=t;if(!n)return{dataArray:e,relativeOrigin:[0,0],originalExtent:[0,0,0,0]};let i=1/0,a=-1/0,o=1/0,s=-1/0;e.forEach(e=>{let t=e.coordinates;if(!t)return;let n=e=>{if(typeof e[0]==`number`&&typeof e[1]==`number`){let[t,n]=e;i=Math.min(i,t),a=Math.max(a,t),o=Math.min(o,n),s=Math.max(s,n)}else Array.isArray(e[0])&&e.forEach(n)};n(t)});let c=[i,o,a,s],l=r||xE(e);return{dataArray:SE(e,l),relativeOrigin:l,originalExtent:c}}var wE,TE,EE,DE,OE,kE,AE,jE,ME,NE=o((()=>{wE=Object.defineProperty,TE=Object.defineProperties,EE=Object.getOwnPropertyDescriptors,DE=Object.getOwnPropertySymbols,OE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,AE=(e,t,n)=>t in e?wE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,jE=(e,t)=>{for(var n in t||={})OE.call(t,n)&&AE(e,n,t[n]);if(DE)for(var n of DE(t))kE.call(t,n)&&AE(e,n,t[n]);return e},ME=(e,t)=>TE(e,EE(t))})),PE,FE=o((()=>{xm(),Ip(),eh(),ph(),xg(),Ng(),Qm(),Kg(),E_(),$_(),Lw(),Yw(),sT(),yT(),NT(),qp(),FT(),UT(),cE(),gE(),vE(),yE(),bE(),NE(),Np(`rasterTile`,Ew),Np(`mvt`,p_),Np(`geojsonvt`,sg),Np(`testTile`,bT),Np(`geojson`,rh),Np(`jsonTile`,Pg),Np(`image`,Sg),Np(`csv`,$m),Np(`json`,Hm),Np(`raster`,Q_),Np(`rasterRgb`,cT),Np(`rgb`,Xw),Np(`ndi`,Rw),Fp(`cluster`,Rp),Fp(`filter`,PT),Fp(`join`,lE),Fp(`map`,_E),Fp(`grid`,IT),Fp(`hexagon`,ZT),PE=bm})),IE,LE,RE=o((()=>{cv(),ov(),kp(),IE=u(Mf()),LE=class extends IE.EventEmitter{getMarkerLayerContainerSize(){}constructor(e){super(),J(this,`markerOption`,void 0),J(this,`popup`,void 0),J(this,`mapsService`,void 0),J(this,`lngLat`,void 0),J(this,`scene`,void 0),J(this,`added`,!1),J(this,`preLngLat`,{lng:0,lat:0}),J(this,`visible`,!0),J(this,`onMarkerDragStart`,e=>{let t=this.mapsService.getContainer();if(!t)return;this.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});let{left:n,top:r}=t.getClientRects()[0],{x:i,y:a}=e;this.preLngLat=this.mapsService.containerToLngLat([i-n,a-r]),this.mapsService.on(`mousemove`,this.onMarkerDragMove),document.addEventListener(`mouseup`,this.onMarkerDragEnd),this.emit(`dragstart`,this.lngLat)}),J(this,`onMarkerDragMove`,e=>{let t=e.lngLat||e.lnglat,{lng:n,lat:r}=this.preLngLat,{lng:i,lat:a}=t,o={lng:this.lngLat.lng+i-n,lat:this.lngLat.lat+a-r};this.setLnglat(o),this.preLngLat=t,this.emit(`dragging`,o)}),J(this,`onMarkerDragEnd`,()=>{this.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),this.mapsService.off(`mousemove`,this.onMarkerDragMove),document.removeEventListener(`mouseup`,this.onMarkerDragEnd),this.emit(`dragend`,this.lngLat)}),J(this,`eventHandle`,e=>{this.polyfillEvent(e),this.emit(e.type,{target:e,data:this.markerOption.extData,lngLat:this.lngLat})}),J(this,`touchStartTime`,void 0),this.markerOption=Y(Y({},this.getDefault()),e),Uu([`update`,`onMove`,`onMapClick`,`updatePositionWhenZoom`],this),this.init()}getDefault(){return{element:void 0,anchor:Zo.BOTTOM,offsets:[0,0],color:`#5B8FF9`,draggable:!1,overflowHide:!0}}addTo(e){this.scene=e,this.mapsService=e.mapService;let{element:t}=this.markerOption;return this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this.updateDraggable(),this.added=!0,this.emit(`added`),this}remove(){this.mapsService,this.unRegisterMarkerEvent(),this.removeAllListeners();let{element:e}=this.markerOption;return e&&lu(e),this.popup&&this.popup.remove(),this}hide(){let{element:e}=this.markerOption;return e&&(e.style.display=`none`),this.visible=!1,this}show(){let{element:e}=this.markerOption;return e&&(e.style.display=`block`),this.visible=!0,this.update(),this}setLnglat(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}getLnglat(){return this.lngLat}getElement(){return this.markerOption.element}setElement(e){if(!this.added)return this.once(`added`,()=>{this.setElement(e)}),this;let{element:t}=this.markerOption;return t&&lu(t),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.updateDraggable(),this.update(),this}openPopup(){if(!this.added)return this.once(`added`,()=>{this.openPopup()}),this;let e=this.popup;return e&&(e.isOpen()||e.addTo(this.scene)),this}closePopup(){this.added||this.once(`added`,()=>{this.closePopup()});let e=this.popup;return e&&e.remove(),this}setPopup(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}togglePopup(){let e=this.popup;if(e)e.isOpen()?e.remove():e.addTo(this.scene);else return this;return this}getPopup(){return this.popup}getOffset(){return this.markerOption.offsets}setDraggable(e){this.markerOption.draggable=e,this.updateDraggable()}getDraggable(){return this.markerOption.draggable}getExtData(){return this.markerOption.extData}setExtData(e){this.markerOption.extData=e}update(){if(!this.mapsService)return;let{element:e,anchor:t}=this.markerOption;this.updatePosition(),_u(e,`${Qo[t]}`)}updatePositionWhenZoom(e){if(!this.mapsService)return;let{element:t,offsets:n}=this.markerOption,{lng:r,lat:i}=this.lngLat;if(this.visible&&t){t.style.display=`block`,t.style.whiteSpace=`nowrap`;let{containerHeight:a,containerWidth:o,bounds:s}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!s)return;let c=e.map,l=e.center,u=e.zoom,d=c.DE(this.lngLat,u,l);d.x=Math.round(d.x+n[0]),d.y=Math.round(d.y-n[1]),(Math.abs(s[0][0])>180||Math.abs(s[1][0])>180)&&(d.x>o&&(d.x=this.mapsService.lngLatToContainer([r-360,i]).x),d.x<0&&(d.x=this.mapsService.lngLatToContainer([r+360,i]).x)),(d.x>o||d.x<0||d.y>a||d.y<0)&&(t.style.display=`none`),t.style.left=d.x+`px`,t.style.top=d.y+`px`,t.style.transition=`left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)`}}onMapClick(e){let{element:t}=this.markerOption;this.popup&&t&&this.togglePopup()}getCurrentContainerSize(){let e=this.mapsService.getContainer();return{containerHeight:e?.scrollHeight||0,containerWidth:e?.scrollWidth||0,bounds:this.mapsService.getBounds()}}updateDraggable(){let{element:e}=this.markerOption;e?.removeEventListener(`mousedown`,this.onMarkerDragStart),this.mapsService.off(`mousemove`,this.onMarkerDragMove),document.removeEventListener(`mouseup`,this.onMarkerDragEnd),this.markerOption.draggable&&e?.addEventListener(`mousedown`,this.onMarkerDragStart)}updatePosition(){if(!this.mapsService)return;let{element:e,offsets:t}=this.markerOption,{lng:n,lat:r}=this.lngLat,i=this.mapsService.lngLatToContainer([n,r]);if(!this.visible){e&&(e.style.display=`none`);return}if(e){e.style.display=`block`,e.style.whiteSpace=`nowrap`;let{containerHeight:a,containerWidth:o,bounds:s}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!s)return;(Math.abs(s[0][0])>180||Math.abs(s[1][0])>180)&&(i.x>o&&(i.x=this.mapsService.lngLatToContainer([n-360,r]).x),i.x<0&&(i.x=this.mapsService.lngLatToContainer([n+360,r]).x)),this.markerOption.overflowHide&&(i.x>o||i.x<0||i.y>a||i.y<0)&&(e.style.display=`none`),e.style.left=i.x+t[0]+`px`,e.style.top=i.y-t[1]+`px`}}init(){let{element:e}=this.markerOption,{color:t,anchor:n}=this.markerOption;if(!e){e=cu(`div`),this.markerOption.element=e;let n=document.createElementNS(`http://www.w3.org/2000/svg`,`svg`);n.setAttributeNS(null,`display`,`block`),n.setAttributeNS(null,`height`,`48px`),n.setAttributeNS(null,`width`,`48px`),n.setAttributeNS(null,`viewBox`,`0 0 1024 1024`);let r=document.createElementNS(`http://www.w3.org/2000/svg`,`path`);r.setAttributeNS(null,`d`,`M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z`),r.setAttributeNS(null,`fill`,t),n.appendChild(r),e.appendChild(n)}uu(e,`l7-marker`),Object.keys(this.markerOption.style||{}).forEach(t=>{let n=this.markerOption?.style&&this.markerOption?.style[t];e&&(e.style[t]=n)}),Xo(e,n,`marker`)}registerMarkerEvent(e){e.addEventListener(`click`,this.onMapClick),e.addEventListener(`mousemove`,this.eventHandle),e.addEventListener(`click`,this.eventHandle),e.addEventListener(`mousedown`,this.eventHandle),e.addEventListener(`mouseup`,this.eventHandle),e.addEventListener(`dblclick`,this.eventHandle),e.addEventListener(`contextmenu`,this.eventHandle),e.addEventListener(`mouseover`,this.eventHandle),e.addEventListener(`mouseout`,this.eventHandle),e.addEventListener(`touchstart`,this.eventHandle),e.addEventListener(`touchend`,this.eventHandle)}unRegisterMarkerEvent(){let e=this.getElement();e.removeEventListener(`click`,this.onMapClick),e.removeEventListener(`mousemove`,this.eventHandle),e.removeEventListener(`click`,this.eventHandle),e.removeEventListener(`mousedown`,this.eventHandle),e.removeEventListener(`mouseup`,this.eventHandle),e.removeEventListener(`dblclick`,this.eventHandle),e.removeEventListener(`contextmenu`,this.eventHandle),e.removeEventListener(`mouseover`,this.eventHandle),e.removeEventListener(`mouseout`,this.eventHandle),e.removeEventListener(`touchstart`,this.eventHandle),e.removeEventListener(`touchend`,this.eventHandle)}polyfillEvent(e){!this.mapsService||this.mapsService.getType()!==`amap`||Lu()||(e.type===`touchstart`&&(this.touchStartTime=Date.now()),e.type===`touchend`&&Date.now()-this.touchStartTime<300&&this.emit(`click`,{target:e,data:this.markerOption.extData,lngLat:this.lngLat}))}addDragHandler(e){return null}onUp(e){throw Error(`Method not implemented.`)}}})),zE,BE,VE,HE,UE=o((()=>{cv(),ov(),kp(),zE=u(Mf()),BE=u(Lp()),RE(),{merge:VE}=tu,HE=class extends zE.EventEmitter{constructor(e){super(),J(this,`markers`,[]),J(this,`markerLayerOption`,void 0),J(this,`clusterIndex`,void 0),J(this,`points`,[]),J(this,`clusterMarkers`,[]),J(this,`mapsService`,void 0),J(this,`scene`,void 0),J(this,`zoom`,void 0),J(this,`bbox`,void 0),J(this,`inited`,void 0),J(this,`containerSize`,void 0),this.markerLayerOption=VE(this.getDefault(),e),Uu([`update`],this),this.zoom=this.markerLayerOption.clusterOption?.zoom||-99}getDefault(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:``}}}addTo(e){return this.scene=e,this.mapsService=e.mapService,this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on(`camerachange`,this.update),this.mapsService.on(`viewchange`,this.update)),this.mapsService.on(`camerachange`,this.updateMarkers.bind(this)),this.mapsService.on(`viewchange`,this.updateMarkers.bind(this)),this.mapsService.on(`camerachange`,this.setContainerSize.bind(this)),this.mapsService.on(`viewchange`,this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}setContainerSize(){if(!this.mapsService)return;let e=this.mapsService.getContainer();this.containerSize={containerWidth:e?.scrollWidth||0,containerHeight:e?.scrollHeight||0,bounds:this.mapsService.getBounds()}}getContainerSize(){return this.containerSize}addMarker(e){let t=this.markerLayerOption.cluster;e.getMarkerLayerContainerSize=this.getContainerSize.bind(this);try{let t=this.markerLayerOption.markerOption;if(t&&e&&typeof e.getElement==`function`){let n=e.getElement();if(n){if(t.className)try{uu(n,t.className)}catch{n.className=`${n.className||``} ${t.className}`.trim()}if(t.style&&typeof t.style==`object`&&Object.keys(t.style).forEach(e=>{try{n.style[e]=t.style[e]}catch{}}),t.color)try{let e=n.querySelector?n.querySelector(`path`):null;e&&typeof e.setAttribute==`function`?e.setAttribute(`fill`,t.color):n.style.background=t.color}catch{}}}}catch{}if(t&&(this.addPoint(e,this.markers.length),this.mapsService)){let e=this.mapsService.getZoom();this.bbox=Od(this.mapsService.getBounds(),.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e);try{this.inited&&this.scene&&typeof e.addTo==`function`&&(this.markerLayerOption.cluster||e.addTo(this.scene))}catch{}}removeMarker(e){this.markers.indexOf(e);let t=this.markers.indexOf(e);if(t>-1){try{typeof e.remove==`function`&&e.remove()}catch{}this.markers.splice(t,1),this.markerLayerOption.cluster&&(this.removePoint(t),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom))}}hide(){this.markers.forEach(e=>{try{typeof e.hide==`function`?e.hide():e.getElement().style.opacity=`0`}catch{}}),this.clusterMarkers.forEach(e=>{try{typeof e.hide==`function`?e.hide():e.getElement().style.opacity=`0`}catch{}})}show(){this.markers.forEach(e=>{try{typeof e.show==`function`?e.show():e.getElement().style.opacity=`1`}catch{}}),this.clusterMarkers.forEach(e=>{try{typeof e.show==`function`?e.show():e.getElement().style.opacity=`1`}catch{}})}getMarkers(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}getOriginMarkers(){return this.markers}addMarkers(){this.getMarkers().forEach(e=>{e.addTo(this.scene)})}clear(){this.markers.forEach(e=>{e.remove()}),this.clusterMarkers.forEach(e=>{e.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}destroy(){this.clear(),this.removeAllListeners(),this.mapsService.off(`camerachange`,this.update),this.mapsService.off(`viewchange`,this.update),this.mapsService.off(`camerachange`,this.setContainerSize.bind(this)),this.mapsService.off(`viewchange`,this.setContainerSize.bind(this)),this.mapsService.off(`camerachange`,this.updateMarkers.bind(this)),this.mapsService.off(`viewchange`,this.updateMarkers.bind(this))}updateMarkers(){try{this.markers.forEach(e=>{e&&typeof e.update==`function`&&e.update()}),this.clusterMarkers.forEach(e=>{e&&typeof e.update==`function`&&e.update()})}catch{}}addPoint(e,t){let{lng:n,lat:r}=e.getLnglat(),i={geometry:{type:`Point`,coordinates:[n,r]},properties:Y(Y({},e.getExtData()),{},{marker_id:t})};this.points.push(i),this.clusterIndex&&this.clusterIndex.load(this.points)}removePoint(e){let t=this.points.findIndex(t=>t.properties.marker_id===e);t>-1&&this.points.splice(t,1),this.clusterIndex&&this.clusterIndex.load(this.points)}initCluster(){if(!this.markerLayerOption.cluster)return;let{radius:e,minZoom:t=0,maxZoom:n}=this.markerLayerOption.clusterOption;this.clusterIndex=new BE.default({radius:e,minZoom:t,maxZoom:n}),this.clusterIndex.load(this.points)}getClusterMarker(e,t){let n=e[0].concat(e[1]),r=this.clusterIndex.getClusters(n,t);this.clusterMarkers.forEach(e=>{e.remove()}),this.clusterMarkers=[],r.forEach(e=>{var t;let{field:n,method:r}=this.markerLayerOption.clusterOption;if((t=e.properties)!=null&&t.cluster_id){let t=this.getLeaves(e.properties?.cluster_id);if(e.properties.clusterData=t,n&&r){let i=t?.map(e=>({[n]:e.properties[n]})),a=Df(r,Ef(i,n)),o=`point_`+r;e.properties[o]=a.toFixed(2)}}let i=this.clusterMarker(e);try{let e=i;e&&typeof e.on==`function`&&e.on(`click`,t=>{try{this.emit(`marker:click`,{marker:e,data:e.getExtData?e.getExtData():null,lngLat:e.getLnglat?e.getLnglat():null,originalEvent:t})}catch{}})}catch{}this.clusterMarkers.push(i),i.addTo(this.scene)})}getLeaves(e,t=1/0,n=0){return e?this.clusterIndex.getLeaves(e,t,n):null}clusterMarker(e){var t;let{element:n=this.generateElement.bind(this)}=this.markerLayerOption.clusterOption,r=e.properties?.point_count;if(r===void 0&&(t=e.properties)!=null&&t.cluster_id&&(r=(this.getLeaves(e.properties.cluster_id,1/0,0)||[]).length),(r===1||r===`1`)&&e.properties){let t=null;if(e.properties.cluster_id){let n=this.getLeaves(e.properties.cluster_id,1,0);t=n&&n[0]}else e.properties.marker_id!==void 0&&(t=e);if(t&&t.properties&&typeof t.properties.marker_id==`number`){let n=this.normalMarker(t);if(n){try{e&&e.properties&&typeof n.setExtData==`function`&&n.setExtData(e.properties)}catch{}return n}}}let i;i=typeof n==`function`?n(e):n;let a=new LE({element:i}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]});return e&&e.properties&&a.setExtData(e.properties),a}normalMarker(e){let t=e.properties.marker_id;return this.markers[t]}update(){if(!this.mapsService||this.markers.length===0)return;let e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!kd(this.bbox,t))&&(this.bbox=Od(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}generateElement(e){let t=cu(`div`,`l7-marker-cluster`),n=cu(`span`,``,cu(`div`,``,t)),{field:r,method:i}=this.markerLayerOption.clusterOption;return e.properties.point_count=e.properties.point_count||1,n.textContent=r&&i?e.properties[`point_`+i]||e.properties[r]:e.properties.point_count,t}}})),WE=o((()=>{window._iconfont_svg_string_3580659=`<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>`,function(e){try{var t=(t=document.getElementsByTagName(`script`))[t.length-1],n=t.getAttribute(`data-injectcss`),t=t.getAttribute(`data-disable-injectsvg`);if(!t){var r,i,a,o,s,c=function(e,t){t.parentNode.insertBefore(e,t)};if(n&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write(`<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>`)}catch(e){console&&console.log(e)}}r=function(){var t,n=document.createElement(`div`);n.innerHTML=e._iconfont_svg_string_3580659,(n=n.getElementsByTagName(`svg`)[0])&&(n.setAttribute(`aria-hidden`,`true`),n.style.position=`absolute`,n.style.width=0,n.style.height=0,n.style.overflow=`hidden`,n=n,(t=document.body).firstChild?c(n,t.firstChild):t.appendChild(n))},document.addEventListener?~[`complete`,`loaded`,`interactive`].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener(`DOMContentLoaded`,i,!1),r()},document.addEventListener(`DOMContentLoaded`,i,!1)):document.attachEvent&&(a=r,o=e.document,s=!1,u(),o.onreadystatechange=function(){o.readyState==`complete`&&(o.onreadystatechange=null,l())})}function l(){s||(s=!0,a())}function u(){try{o.documentElement.doScroll(`left`)}catch{setTimeout(u,50);return}l()}}catch{}}(window)})),GE,KE,qE=o((()=>{cv(),ov(),UC(),kp(),GE=u(Mf()),KE=class e extends GE.default{constructor(t){super(),J(this,`controlOption`,void 0),J(this,`container`,void 0),J(this,`isShow`,void 0),J(this,`sceneContainer`,void 0),J(this,`scene`,void 0),J(this,`mapsService`,void 0),J(this,`renderService`,void 0),J(this,`layerService`,void 0),J(this,`controlService`,void 0),J(this,`configService`,void 0),e.controlCount++,this.controlOption=Y(Y({},this.getDefault(t)),t||{})}getOptions(){return this.controlOption}setOptions(e){let t=this.getDefault(e);Object.entries(e).forEach(([n,r])=>{r===void 0&&(e[n]=t[n])}),`position`in e&&this.setPosition(e.position),`className`in e&&this.setClassName(e.className),`style`in e&&this.setStyle(e.style),this.controlOption=Y(Y({},this.controlOption),e)}addTo(e){this.mapsService=e.mapService,this.renderService=e.rendererService,this.layerService=e.layerService,this.controlService=e.controlService,this.configService=e.globalConfigService,this.scene=e.sceneService,this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),uu(this.container,`l7-control`);let{className:t,style:n}=this.controlOption;return t&&this.setClassName(t),n&&this.setStyle(n),this.insertContainer(),this.emit(`add`,this),this}remove(){if(!this.mapsService)return this;lu(this.container),this.onRemove(),this.emit(`remove`,this)}onAdd(){return cu(`div`)}onRemove(){}show(){let e=this.container;du(e,`l7-control--hide`),this.isShow=!0,this.emit(`show`,this)}hide(){let e=this.container;uu(e,`l7-control--hide`),this.isShow=!1,this.emit(`hide`,this)}getDefault(t){return{position:Bv.TOPRIGHT,name:`${e.controlCount}`}}getContainer(){return this.container}getIsShow(){return this.isShow}_refocusOnMap(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){let e=this.mapsService.getContainer();e!==null&&e.focus()}}setPosition(e=Bv.TOPLEFT){let t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}setClassName(e){let t=this.container,{className:n}=this.controlOption;n&&du(t,n),e&&uu(t,e)}setStyle(e){let t=this.container;e?t.setAttribute(`style`,e):t.removeAttribute(`style`)}insertContainer(){let e=this.controlOption.position,t=this.container;if(e instanceof Element)e.appendChild(t);else{let n=this.controlService.controlCorners[e];[`bottomleft`,`bottomright`,`righttop`,`rightbottom`].includes(e)?n.insertBefore(t,n.firstChild):n.appendChild(t)}}checkUpdateOption(e,t){return t.some(t=>t in e)}},J(KE,`controlCount`,0)})),JE,YE=o((()=>{ov(),kp(),qE(),JE=class extends KE{constructor(...e){super(...e),J(this,`isDisable`,!1),J(this,`button`,void 0),J(this,`buttonText`,void 0),J(this,`buttonIcon`,void 0)}setIsDisable(e){if(this.isDisable=e,e){var t;(t=this.button)==null||t.setAttribute(`disabled`,`true`)}else{var n;(n=this.button)==null||n.removeAttribute(`disabled`)}}createButton(e=``){return cu(`button`,`l7-button-control ${e}`)}onAdd(){this.button=this.createButton(),this.isDisable=!1;let{title:e,btnText:t,btnIcon:n}=this.controlOption;return this.setBtnTitle(e),this.setBtnText(t),this.setBtnIcon(n),this.button}onRemove(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}setOptions(e){let{title:t,btnText:n,btnIcon:r}=e;this.checkUpdateOption(e,[`title`])&&this.setBtnTitle(t),this.checkUpdateOption(e,[`btnIcon`])&&this.setBtnIcon(r),this.checkUpdateOption(e,[`btnText`])&&this.setBtnText(n),super.setOptions(e)}setBtnTitle(e){var t;(t=this.button)==null||t.setAttribute(`title`,e??``)}setBtnIcon(e){if(this.buttonIcon&&lu(this.buttonIcon),e){let r=this.button?.firstChild;if(r){var t;(t=this.button)==null||t.insertBefore(e,r)}else{var n;(n=this.button)==null||n.appendChild(e)}this.buttonIcon=e}}setBtnText(e){if(this.button)if(du(this.button,`l7-button-control--row`),du(this.button,`l7-button-control--column`),e){let n=this.buttonText;if(!n){var t;n=cu(`div`,`l7-button-control__text`),(t=this.button)==null||t.appendChild(n),this.buttonText=n}n.innerText=e,uu(this.button,this.controlOption.vertical?`l7-button-control--column`:`l7-button-control--row`)}else !e&&this.buttonText&&(lu(this.buttonText),this.buttonText=void 0)}}})),XE,ZE,QE=o((()=>{ov(),kp(),XE=u(Mf()),ZE=class e extends XE.EventEmitter{get buttonRect(){return this.button.getBoundingClientRect()}constructor(t,n){super(),J(this,`popperDOM`,void 0),J(this,`contentDOM`,void 0),J(this,`button`,void 0),J(this,`option`,void 0),J(this,`isShow`,!1),J(this,`content`,void 0),J(this,`timeout`,null),J(this,`show`,()=>this.isShow||!this.contentDOM.innerHTML?this:(this.resetPopperPosition(),du(this.popperDOM,`l7-popper-hide`),this.isShow=!0,this.option.unique&&e.conflictPopperList.forEach(e=>{e!==this&&e.isShow&&e.hide()}),this.emit(`show`),window.addEventListener(`pointerdown`,this.onPopperUnClick),this)),J(this,`hide`,()=>this.isShow?(uu(this.popperDOM,`l7-popper-hide`),this.isShow=!1,this.emit(`hide`),window.removeEventListener(`pointerdown`,this.onPopperUnClick),this):this),J(this,`setHideTimeout`,()=>{this.timeout||=window.setTimeout(()=>{this.isShow&&(this.hide(),this.timeout=null)},300)}),J(this,`clearHideTimeout`,()=>{this.timeout&&=(window.clearTimeout(this.timeout),null)}),J(this,`onBtnClick`,()=>{this.isShow?this.hide():this.show()}),J(this,`onPopperUnClick`,e=>{Au(e.target,[`.l7-button-control`,`.l7-popper-content`])||this.hide()}),J(this,`onBtnMouseLeave`,()=>{this.setHideTimeout()}),J(this,`onBtnMouseMove`,()=>{this.clearHideTimeout(),!this.isShow&&this.show()}),this.button=t,this.option=n,this.init(),n.unique&&e.conflictPopperList.push(this)}getPopperDOM(){return this.popperDOM}getIsShow(){return this.isShow}getContent(){return this.content}setContent(e){typeof e==`string`?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(Du(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}init(){let{trigger:e}=this.option;this.popperDOM=this.createPopper(),e===`click`?this.button.addEventListener(`click`,this.onBtnClick):(this.button.addEventListener(`mousemove`,this.onBtnMouseMove),this.button.addEventListener(`mouseleave`,this.onBtnMouseLeave),this.popperDOM.addEventListener(`mousemove`,this.onBtnMouseMove),this.popperDOM.addEventListener(`mouseleave`,this.onBtnMouseLeave))}destroy(){this.button.removeEventListener(`click`,this.onBtnClick),this.button.removeEventListener(`mousemove`,this.onBtnMouseMove),this.button.removeEventListener(`mousemove`,this.onBtnMouseLeave),this.popperDOM.removeEventListener(`mousemove`,this.onBtnMouseMove),this.popperDOM.removeEventListener(`mouseleave`,this.onBtnMouseLeave),lu(this.popperDOM)}resetPopperPosition(){let e={},{container:t,offset:n=[0,0],placement:r}=this.option,[i,a]=n,o=this.button.getBoundingClientRect(),{left:s,right:c,top:l,bottom:u}=Tu(o,t.getBoundingClientRect()),d=!1,f=!1;/^(left|right)/.test(r)?(r.includes(`left`)?e.right=`${o.width+c}px`:r.includes(`right`)&&(e.left=`${o.width+s}px`),r.includes(`start`)?e.top=`${l}px`:r.includes(`end`)?e.bottom=`${u}px`:(e.top=`${l+o.height/2}px`,f=!0,e.transform=`translate(${i}px, calc(${a}px - 50%))`)):/^(top|bottom)/.test(r)&&(r.includes(`top`)?e.bottom=`${o.height+u}px`:r.includes(`bottom`)&&(e.top=`${o.height+l}px`),r.includes(`start`)?e.left=`${s}px`:r.includes(`end`)?e.right=`${c}px`:(e.left=`${s+o.width/2}px`,d=!0,e.transform=`translate(calc(${i}px - 50%), ${a}px)`)),e.transform=`translate(calc(${i}px - ${d?`50%`:`0%`}), calc(${a}px - ${f?`50%`:`0%`})`;let p=r.split(`-`);p.length&&uu(this.popperDOM,p.map(e=>`l7-popper-${e}`).join(` `)),xu(this.popperDOM,wu(e))}createPopper(){let{container:e,className:t=``,content:n}=this.option,r=cu(`div`,`l7-popper l7-popper-hide ${t}`),i=cu(`div`,`l7-popper-content`),a=cu(`div`,`l7-popper-arrow`);return r.appendChild(i),r.appendChild(a),e.appendChild(r),this.popperDOM=r,this.contentDOM=i,n&&this.setContent(n),r}},J(ZE,`conflictPopperList`,[])})),$E,eD,tD=o((()=>{cv(),ov(),QE(),YE(),$E={topleft:`right-start`,topcenter:`bottom`,topright:`left-start`,bottomleft:`right-end`,bottomcenter:`top`,bottomright:`left-end`,lefttop:`bottom-start`,leftcenter:`right`,leftbottom:`top-start`,righttop:`bottom-end`,rightcenter:`left`,rightbottom:`top-end`},eD=class extends JE{constructor(...e){super(...e),J(this,`popper`,void 0)}getPopper(){return this.popper}hide(){this.popper.hide(),super.hide()}getDefault(e){let t=super.getDefault(e),n=e?.position??t.position;return Y(Y({},super.getDefault(e)),{},{popperPlacement:n instanceof Element?`bottom`:$E[n],popperTrigger:`click`})}onAdd(){let e=super.onAdd();return this.initPopper(),e}onRemove(){this.popper.destroy()}initPopper(){let{popperClassName:e,popperPlacement:t,popperTrigger:n}=this.controlOption,r=this.mapsService.getMapContainer();return this.popper=new ZE(this.button,{className:e,placement:t,trigger:n,container:r,unique:!0}),this.popper.on(`show`,()=>{this.emit(`popperShow`,this)}).on(`hide`,()=>{this.emit(`popperHide`,this)}),this.popper}setOptions(e){if(super.setOptions(e),this.checkUpdateOption(e,[`popperPlacement`,`popperTrigger`,`popperClassName`])){let e=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(e)}}}})),nD,rD,iD=o((()=>{ov(),kp(),tD(),nD=function(e){return e.ActiveOptionClassName=`l7-select-control-item-active`,e.OptionValueAttrKey=`data-option-value`,e.OptionIndexAttrKey=`data-option-index`,e}(nD||{}),rD=class extends eD{constructor(...e){super(...e),J(this,`selectValue`,[]),J(this,`optionDOMList`,void 0),J(this,`createNormalOption`,e=>{let t=this.selectValue.includes(e.value),n=cu(`div`,`l7-select-control-item ${t?nD.ActiveOptionClassName:``}`);this.getIsMultiple()?n.appendChild(this.createCheckbox(t)):n.appendChild(this.createRadio(t)),e.icon&&n.appendChild(e.icon);let r=cu(`span`);return r.innerText=e.text,n.appendChild(r),n}),J(this,`onItemClick`,e=>{if(this.getIsMultiple()){let t=this.selectValue.findIndex(t=>t===e.value);t>-1?this.selectValue.splice(t,1):this.selectValue=[...this.selectValue,e.value]}else this.selectValue=[e.value];this.setSelectValue(this.selectValue)})}setOptions(e){super.setOptions(e);let{options:t}=e;t&&this.popper.setContent(this.getPopperContent(t))}onAdd(){let e=super.onAdd(),{defaultValue:t}=this.controlOption;return t&&(this.selectValue=this.transSelectValue(t)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}getSelectValue(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}setSelectValue(e,t=!0){let n=this.transSelectValue(e);this.optionDOMList.forEach(e=>{let t=e.getAttribute(nD.OptionValueAttrKey),r=e.querySelector(`input[type=checkbox]`),i=e.querySelector(`input[type=radio]`),a=n.includes(t),o=(t,n)=>{mu(e,nD.ActiveOptionClassName,n),t&&Eu(t,n)};o(r,a),o(i,a)}),this.selectValue=n,t&&this.emit(`selectChange`,this.getIsMultiple()?n:n[0])}getIsMultiple(){return!1}getPopperContent(e){let t=this.isImageOptions(),n=cu(`div`,t?`l7-select-control--image`:`l7-select-control--normal`);this.getIsMultiple()&&uu(n,`l7-select-control--multiple`);let r=e.map((e,n)=>{let r=t?this.createImageOption(e):this.createNormalOption(e);return r.setAttribute(nD.OptionValueAttrKey,e.value),r.setAttribute(nD.OptionIndexAttrKey,window.String(n)),r.addEventListener(`click`,this.onItemClick.bind(this,e)),r});return n.append(...r),this.optionDOMList=r,n}createImageOption(e){let t=this.selectValue.includes(e.value),n=cu(`div`,`l7-select-control-item ${t?nD.ActiveOptionClassName:``}`),r=cu(`img`);r.setAttribute(`src`,e.img),Ou(r),n.appendChild(r);let i=cu(`div`,`l7-select-control-item-row`);this.getIsMultiple()&&n.appendChild(this.createCheckbox(t));let a=cu(`span`);return a.innerText=e.text,i.appendChild(a),n.appendChild(i),n}createCheckbox(e){let t=cu(`input`);return t.setAttribute(`type`,`checkbox`),e&&Eu(t,!0),t}createRadio(e){let t=cu(`input`);return t.setAttribute(`type`,`radio`),e&&Eu(t,!0),t}isImageOptions(){return!!this.controlOption.options.find(e=>e.img)}transSelectValue(e){return Array.isArray(e)?e:[e]}}})),aD=o((()=>{YE(),qE(),tD(),iD()})),oD,sD=o((()=>{oD=e=>{let t=document.createElementNS(`http://www.w3.org/2000/svg`,`svg`);t.classList.add(`l7-iconfont`),t.setAttribute(`aria-hidden`,`true`);let n=document.createElementNS(`http://www.w3.org/2000/svg`,`use`);return n.setAttributeNS(`http://www.w3.org/1999/xlink`,`href`,`#${e}`),t.appendChild(n),t}})),cD,lD=o((()=>{cv(),Py(),ov(),sD(),YE(),cD=class extends JE{constructor(...e){var t;super(...e),t=this,J(this,`onClick`,Z(function*(){let{onExport:e}=t.controlOption;e?.(yield t.getImage())})),J(this,`mergeImage`,Z(function*(...e){let{imageType:n}=t.controlOption,{width:r=0,height:i=0}=t.mapsService.getContainer()?.getBoundingClientRect()??{},a=document.createElement(`canvas`);a.width=r,a.height=i;let o=a.getContext(`2d`);return(yield Promise.all(e.map(e=>new Promise(t=>{let n=new Image;n.onload=()=>{t(n)},n.src=e})))).forEach(e=>{o?.drawImage(e,0,0,r,i)}),a.toDataURL(`image/${n}`)}))}onAdd(){let e=super.onAdd();return e.addEventListener(`click`,this.onClick),e}getDefault(e){return Y(Y({},super.getDefault(e)),{},{title:`导出图片`,btnIcon:oD(`l7-icon-export-picture`),imageType:`png`})}getImage(){var e=this;return Z(function*(){let t=yield e.mapsService.exportMap(`png`),n=yield e.scene.exportPng(`png`);return e.mergeImage(...[t,n].filter(e=>e))})()}}})),uD,dD,fD,pD,mD,hD=o((()=>{uD=[[`requestFullscreen`,`exitFullscreen`,`fullscreenElement`,`fullscreenEnabled`,`fullscreenchange`,`fullscreenerror`],[`webkitRequestFullscreen`,`webkitExitFullscreen`,`webkitFullscreenElement`,`webkitFullscreenEnabled`,`webkitfullscreenchange`,`webkitfullscreenerror`],[`webkitRequestFullScreen`,`webkitCancelFullScreen`,`webkitCurrentFullScreenElement`,`webkitCancelFullScreen`,`webkitfullscreenchange`,`webkitfullscreenerror`],[`mozRequestFullScreen`,`mozCancelFullScreen`,`mozFullScreenElement`,`mozFullScreenEnabled`,`mozfullscreenchange`,`mozfullscreenerror`],[`msRequestFullscreen`,`msExitFullscreen`,`msFullscreenElement`,`msFullscreenEnabled`,`MSFullscreenChange`,`MSFullscreenError`]],dD=(()=>{if(typeof document>`u`)return!1;let e=uD[0],t={};for(let n of uD)if(n?.[1]in document){for(let[r,i]of n.entries())t[e[r]]=i;return t}return!1})(),fD={change:dD.fullscreenchange,error:dD.fullscreenerror},pD={request(e=document.documentElement,t){return new Promise((n,r)=>{let i=()=>{pD.off(`change`,i),n()};pD.on(`change`,i);let a=e[dD.requestFullscreen](t);a instanceof Promise&&a.then(i).catch(r)})},exit(){return new Promise((e,t)=>{if(!pD.isFullscreen){e();return}let n=()=>{pD.off(`change`,n),e()};pD.on(`change`,n);let r=document[dD.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)})},toggle(e,t){return pD.isFullscreen?pD.exit():pD.request(e,t)},onchange(e){pD.on(`change`,e)},onerror(e){pD.on(`error`,e)},on(e,t){let n=fD[e];n&&document.addEventListener(n,t,!1)},off(e,t){let n=fD[e];n&&document.removeEventListener(n,t,!1)},raw:dD},Object.defineProperties(pD,{isFullscreen:{get:()=>!!document[dD.fullscreenElement]},element:{enumerable:!0,get:()=>document[dD.fullscreenElement]??void 0},isEnabled:{enumerable:!0,get:()=>!!document[dD.fullscreenEnabled]}}),dD||(pD={isEnabled:!1}),mD=pD})),gD,_D=o((()=>{cv(),Py(),ov(),kp(),sD(),hD(),YE(),gD=class extends JE{constructor(e){var t;super(e),t=this,J(this,`isFullscreen`,!1),J(this,`mapContainer`,void 0),J(this,`toggleFullscreen`,Z(function*(){mD.isEnabled&&(yield mD.toggle(t.mapContainer))})),J(this,`onClick`,()=>{this.toggleFullscreen()}),J(this,`onFullscreenChange`,()=>{this.isFullscreen=!!document.fullscreenElement;let{btnText:e,btnIcon:t,title:n,exitBtnText:r,exitBtnIcon:i,exitTitle:a}=this.controlOption;this.isFullscreen?(this.setBtnTitle(a),this.setBtnText(r),this.setBtnIcon(i)):(this.setBtnTitle(n),this.setBtnText(e),this.setBtnIcon(t)),this.emit(`fullscreenChange`,this.isFullscreen)}),mD.isEnabled||console.warn(`当前浏览器环境不支持对地图全屏化`)}setOptions(e){let{exitBtnText:t,exitBtnIcon:n,exitTitle:r}=e;this.isFullscreen&&(this.checkUpdateOption(e,[`exitBtnIcon`])&&this.setBtnIcon(n),this.checkUpdateOption(e,[`exitBtnText`])&&this.setBtnText(t),this.checkUpdateOption(e,[`exitTitle`])&&this.setBtnTitle(r)),super.setOptions(e)}onAdd(){let e=super.onAdd();return e.addEventListener(`click`,this.onClick),this.mapContainer=iu(this.scene.getSceneConfig().id),this.mapContainer.addEventListener(`fullscreenchange`,this.onFullscreenChange),e}onRemove(){super.onRemove(),this.mapContainer.removeEventListener(`fullscreenchange`,this.onFullscreenChange)}getDefault(e){return Y(Y({},super.getDefault(e)),{},{title:`全屏`,btnIcon:oD(`l7-icon-fullscreen`),exitTitle:`退出全屏`,exitBtnIcon:oD(`l7-icon-exit-fullscreen`)})}}})),vD,yD=o((()=>{cv(),Py(),ov(),sD(),YE(),vD=class extends JE{constructor(e){var t;super(e),t=this,J(this,`getGeoLocation`,()=>new Promise((e,t)=>{window.navigator.geolocation.getCurrentPosition(({coords:n})=>{let{longitude:r,latitude:i}=n??{};!isNaN(r)&&!isNaN(i)?e([r,i]):t()},e=>{t(e)})})),J(this,`onClick`,Z(function*(){if(!window.navigator.geolocation)return;let{transform:e}=t.controlOption,n=yield t.getGeoLocation(),r=t.mapsService.getZoom();t.mapsService.setZoomAndCenter(r>15?r:15,e?yield e(n):n)})),window.navigator.geolocation||console.warn(`当前浏览器环境不支持获取地理定位`)}getDefault(e){return Y(Y({},super.getDefault(e)),{},{title:`定位`,btnIcon:oD(`l7-icon-reposition`)})}onAdd(){let e=super.onAdd();return e.addEventListener(`click`,this.onClick),e}}}));function bD(e){return Object.keys(e??{}).every(e=>[`layer`,`name`,`img`].includes(e))}var xD,SD=o((()=>{cv(),ov(),sD(),iD(),xD=class extends rD{constructor(...e){super(...e),J(this,`onLayerChange`,()=>{var e;(e=this.controlOption.layers)!=null&&e.length||(this.selectValue=this.getLayerVisible(),this.setOptions({options:this.getLayerOptions()}))}),J(this,`onLayerVisibleChane`,()=>{this.setSelectValue(this.getLayerVisible())}),J(this,`onSelectChange`,()=>{this.layers.forEach(e=>{let t=this.selectValue.includes(e.name),n=e.isVisible();t&&!n&&e.show(),!t&&n&&e.hide()})})}get layers(){let e=this.layerService,{layers:t}=this.controlOption;if(Array.isArray(t)&&t.length){let n=[];return t.forEach(t=>{if(t instanceof Object&&(bD(t)?n.push(t.layer):n.push(t)),typeof t==`string`){let r=e.getLayer(t)||e.getLayerByName(t);r&&n.push(r)}}),n}return e.getLayers()||[]}getDefault(e){return Y(Y({},super.getDefault(e)),{},{title:`图层控制`,btnIcon:oD(`l7-icon-layer`),options:[],multiple:e?.multiple??!0})}getLayerVisible(){return this.layers.filter(e=>e.isVisible()).map(e=>e.name)}getLayerOptions(){let{layers:e}=this.controlOption,t=e?.every(e=>e.img);return e?e?.map(e=>{if(bD(e))return{text:e.name||e.layer.name,value:e.layer.name,img:t?e.img:void 0};if(typeof e==`string`){let t=this.layerService.getLayer(e)||this.layerService.getLayerByName(e);return{text:t?.name,value:t?.name}}return{text:e.name,value:e.name}}):this.layers.map(e=>({text:e.name,value:e.name}))}setOptions(e){let t=this.checkUpdateOption(e,[`layers`,`multiple`]);super.setOptions(e),t&&(this.controlOption.multiple===!1&&this.handleSingleSelection(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}handleSingleSelection(){this.layers.forEach((e,t)=>{t===0?e.show():e.hide()})}onAdd(){var e;return this.controlOption.multiple===!1&&this.handleSingleSelection(),(e=this.controlOption.options)!=null&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on(`selectChange`,this.onSelectChange),this.layerService.on(`layerChange`,this.onLayerChange),super.onAdd()}onRemove(){this.off(`selectChange`,this.onSelectChange),this.layerService.off(`layerChange`,this.onLayerChange)}getIsMultiple(){return this.controlOption.multiple}}})),CD,wD=o((()=>{kp(),aD(),CD=class extends KE{getDefault(){return{position:Bv.BOTTOMLEFT,name:`logo`,href:`https://l7.antv.antgroup.com/`,img:`https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ`}}onAdd(){let e=cu(`div`,`l7-control-logo`);return this.setLogoContent(e),e}onRemove(){return null}setOptions(e){super.setOptions(e),this.checkUpdateOption(e,[`img`,`href`])&&(Du(this.container),this.setLogoContent(this.container))}setLogoContent(e){let{href:t,img:n}=this.controlOption,r=cu(`img`);if(r.setAttribute(`src`,n),r.setAttribute(`aria-label`,`AntV logo`),Ou(r),t){let n=cu(`a`,`l7-control-logo-link`);n.target=`_blank`,n.href=t,n.rel=`noopener nofollow`,n.setAttribute(`rel`,`noopener nofollow`),n.appendChild(r),e.appendChild(n)}else e.appendChild(r)}}})),TD,ED,DD=o((()=>{TD={normal:{text:`标准`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original`},light:{text:`月光银`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original`},dark:{text:`幻影黑`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original`},fresh:{text:`草色青`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original`},grey:{text:`雅士灰`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original`},graffiti:{text:`涂鸦`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original`},macaron:{text:`马卡龙`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original`},darkblue:{text:`极夜蓝`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original`},wine:{text:`酱籽`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original`}},ED={normal:{text:`标准`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original`},light:{text:`亮`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original`},dark:{text:`暗`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original`},satellite:{text:`卫星`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original`},outdoors:{text:`户外`,img:`https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original`}}})),OD,kD=o((()=>{cv(),ov(),DD(),sD(),iD(),OD=class extends rD{constructor(...e){super(...e),J(this,`onMapThemeChange`,()=>{this.mapsService.setMapStyle(this.selectValue[0])})}getDefault(e){return Y(Y({},super.getDefault(e)),{},{title:`地图样式`,btnIcon:oD(`l7-icon-color`),options:[]})}getStyleOptions(){let e=this.mapsService.getType()===`mapbox`?ED:TD;return Object.entries(this.mapsService.getMapStyleConfig()).filter(([e,t])=>typeof t==`string`&&e!==`blank`).map(([t,n])=>{let{text:r,img:i}=e[t]??{};return{text:r??t,value:n,img:i,key:t}})}getMapStyle(){return this.mapsService.getMapStyle()}onAdd(){var e;if((e=this.controlOption.options)!=null&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){let e=this.controlOption.defaultValue;this.controlOption.defaultValue=this.controlOption.options.find(t=>t.key===e)?.value??e}else{let e=this.getMapStyle();e?this.controlOption.defaultValue=e:this.mapsService.map.once(`styledata`,()=>{let e=this.mapsService.getMapStyle();this.controlOption.defaultValue=e,this.setSelectValue(e,!1)})}return this.on(`selectChange`,this.onMapThemeChange),super.onAdd()}getIsMultiple(){return!1}}})),AD,jD=o((()=>{cv(),ov(),UC(),kp(),qE(),AD=class extends KE{constructor(...e){super(...e),J(this,`location`,[0,0]),J(this,`onMouseMove`,e=>{let t=this.location,n=e.lngLat||e.lnglat,{transform:r}=this.controlOption;n&&(t=[n.lng,n.lat]),this.location=t,r&&(t=r(t)),this.insertLocation2HTML(t),this.emit(`locationChange`,t)})}getLocation(){return this.location}getDefault(e){return Y(Y({},super.getDefault(e)),{},{position:Bv.BOTTOMLEFT,transform:([e,t])=>[+(+e).toFixed(6),+(+t).toFixed(6)]})}onAdd(){let e=cu(`div`,`l7-control-mouse-location`);return e.innerHTML=`&nbsp;`,this.mapsService.on(`mousemove`,this.onMouseMove),e}onRemove(){this.mapsService.off(`mousemove`,this.onMouseMove)}insertLocation2HTML(e){this.container.innerText=e.join(`, `)}}})),MD,ND=o((()=>{cv(),ov(),kp(),aD(),MD=class extends KE{constructor(...e){super(...e),J(this,`mScale`,void 0),J(this,`iScale`,void 0),J(this,`update`,()=>{let e=this.mapsService,{maxWidth:t}=this.controlOption,n=e.getSize()[1]/2,r=e.containerToLngLat([0,n]),i=e.containerToLngLat([t,n]),a=Ed([r.lng,r.lat],[i.lng,i.lat]);this.updateScales(a)})}getDefault(e){return Y(Y({},super.getDefault(e)),{},{name:`scale`,position:Bv.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}onAdd(){let e=cu(`div`,`l7-control-scale`);this.resetScaleLines(e);let{updateWhenIdle:t}=this.controlOption;return this.mapsService.on(t?`moveend`:`mapmove`,this.update),this.mapsService.on(t?`zoomend`:`zoomchange`,this.update),e}onRemove(){let{updateWhenIdle:e}=this.controlOption;this.mapsService.off(e?`zoomend`:`zoomchange`,this.update),this.mapsService.off(e?`moveend`:`mapmove`,this.update)}setOptions(e){super.setOptions(e),this.checkUpdateOption(e,[`lockWidth`,`maxWidth`,`metric`,`updateWhenIdle`,`imperial`])&&this.resetScaleLines(this.container)}updateScales(e){let{metric:t,imperial:n}=this.controlOption;t&&e&&this.updateMetric(e),n&&e&&this.updateImperial(e)}resetScaleLines(e){Du(e);let{metric:t,imperial:n,maxWidth:r,lockWidth:i}=this.controlOption;i&&xu(e,`width: ${r}px`),t&&(this.mScale=cu(`div`,`l7-control-scale-line`,e)),n&&(this.iScale=cu(`div`,`l7-control-scale-line`,e)),this.update()}updateScale(e,t,n){let{maxWidth:r}=this.controlOption;e.style.width=Math.round(r*n)+`px`,e.innerHTML=t}getRoundNum(e){let t=10**((Math.floor(e)+``).length-1),n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,t*n}updateMetric(e){let t=this.getRoundNum(e),n=t<1e3?t+` m`:t/1e3+` km`;this.updateScale(this.mScale,n,t/e)}updateImperial(e){let t=e*3.2808399,n,r,i;t>5280?(n=t/5280,r=this.getRoundNum(n),this.updateScale(this.iScale,r+` mi`,r/n)):(i=this.getRoundNum(t),this.updateScale(this.iScale,i+` ft`,i/t))}}})),PD,FD=o((()=>{cv(),Py(),ov(),UC(),kp(),PD=class{constructor(){J(this,`mapService`,void 0),J(this,`fontService`,void 0)}apply(e,{styleAttributeService:t,mapService:n,fontService:r}){var i=this;this.mapService=n,this.fontService=r,e.hooks.init.tapPromise(`DataMappingPlugin`,Z(function*(){e.log(Jv.MappingStart,ny.INIT),i.generateMaping(e,{styleAttributeService:t}),e.log(Jv.MappingEnd,ny.INIT)})),e.hooks.beforeRenderData.tapPromise(`DataMappingPlugin`,function(){var n=Z(function*(n){if(!n)return n;e.dataState.dataMappingNeedUpdate=!1,e.log(Jv.MappingStart,ny.UPDATE);let r=i.generateMaping(e,{styleAttributeService:t});return e.log(Jv.MappingEnd,ny.UPDATE),r});return function(e){return n.apply(this,arguments)}}()),e.hooks.beforeRender.tap(`DataMappingPlugin`,()=>{let n=e.getSource();if(e.layerModelNeedUpdate||!n||!n.inited)return;let r=t.getLayerStyleAttributes()||[],i=t.getLayerStyleAttribute(`filter`),{dataArray:a}=n.data;if(Array.isArray(a)&&a.length===0)return;let o=r.filter(e=>e.needRemapping),s=a;if(i!=null&&i.needRemapping&&i!=null&&i.scale&&(s=a.filter(e=>this.applyAttributeMapping(i,e)[0])),o.length){let t=this.mapping(e,o,s,e.getEncodedData());e.setEncodedData(t)}})}generateMaping(e,{styleAttributeService:t}){let n=t.getLayerStyleAttributes()||[],r=t.getLayerStyleAttribute(`filter`),{dataArray:i}=e.getSource().data,a=i;r!=null&&r.scale&&(a=i.filter(e=>this.applyAttributeMapping(r,e)[0])),a=e.processData(a);let o=this.mapping(e,n,a,void 0);return e.setEncodedData(o),e.emit(`dataUpdate`,null),!0}mapping(e,t,n,r){let i=t.filter(e=>e.scale!==void 0).filter(e=>e.name!==`filter`),a=n.map((e,t)=>{let n=r?r[t]:{},a=Y({id:e._id,coordinates:e.coordinates},n);return i.forEach(t=>{let n=this.applyAttributeMapping(t,e);(t.name===`color`||t.name===`stroke`)&&(n=n.map(e=>Ls(e))),a[t.name]=Array.isArray(n)&&n.length===1?n[0]:n,t.name===`shape`&&(a.shape=this.fontService.getIconFontKey(a[t.name]))}),a});return t.forEach(e=>{e.needRemapping=!1}),this.adjustData2SimpleCoordinates(a),a}adjustData2SimpleCoordinates(e){e.length>0&&this.mapService.version===`SIMPLE`&&e.map(e=>{e.simpleCoordinate||=(e.coordinates=this.unProjectCoordinates(e.coordinates),!0)})}unProjectCoordinates(e){if(typeof e[0]==`number`)return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){let t=[];return e.map(e=>{let n=[];e.map(e=>{n.push(this.mapService.simpleMapCoord.unproject(e))}),t.push(n)}),t}else{let t=[];return e.map(e=>{t.push(this.mapService.simpleMapCoord.unproject(e))}),t}}applyAttributeMapping(e,t){var n;if(!e.scale)return[];let r=(e==null||(n=e.scale)==null?void 0:n.scalers)||[],i=[];return r.forEach(({field:n})=>{(t.hasOwnProperty(n)||e.scale?.type===`variable`)&&i.push(t[n])}),e.mapping?e.mapping(i):[]}getArrowPoints(e,t){let n=jd([t[0]-e[0],t[1]-e[1]]);return[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4]}}})),ID,LD=o((()=>{Py(),ov(),UC(),FE(),ID=class{constructor(){J(this,`mapService`,void 0)}apply(e){var t=this;this.mapService=e.getContainer().mapService,e.hooks.init.tapPromise(`DataSourcePlugin`,Z(function*(){e.log(Jv.SourceInitStart,ny.INIT);let n=e.getSource();if(!n){let{data:t,options:r}=e.sourceOption||e.defaultSourceConfig;n=new PE(t,r),e.setSource(n)}n.inited?(t.updateClusterData(e),e.log(Jv.SourceInitEnd,ny.INIT)):yield new Promise(r=>{n.on(`update`,n=>{n.type===`inited`&&(t.updateClusterData(e),e.log(Jv.SourceInitEnd,ny.INIT)),r(null)})})})),e.hooks.beforeRenderData.tapPromise(`DataSourcePlugin`,Z(function*(){let n=t.updateClusterData(e),r=e.dataState.dataSourceNeedUpdate;return e.dataState.dataSourceNeedUpdate=!1,n||r}))}updateClusterData(e){if(e.isTileLayer||e.tileLayer||!e.getSource())return!1;let t=e.getSource(),n=t.cluster,{zoom:r=0}=t.clusterOptions,i=this.mapService.getZoom()-1,a=e.dataState.dataSourceNeedUpdate;return n&&a&&t.updateClusterData(Math.floor(i)),n&&Math.abs(e.clusterZoom-i)>=1?(r!==Math.floor(i)&&t.updateClusterData(Math.floor(i)),e.clusterZoom=i,!0):!1}}}));function RD(e,t){let n,r;if(t===void 0)for(let t of e)t!=null&&(n===void 0?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));else{let i=-1;for(let a of e)(a=t(a,++i,e))!=null&&(n===void 0?a>=a&&(n=r=a):(n>a&&(n=a),r<a&&(r=a)))}return[n,r]}var zD=o((()=>{})),BD=o((()=>{zD()}));function VD(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function HD(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return VD((n-r/t)*t,o,i,a,s)}}var UD=o((()=>{})),WD=o((()=>{UD()}));function GD(e){return function(){return e}}var KD=o((()=>{}));function qD(e,t){return function(n){return e+n*t}}function JD(e,t,n){return e**=+n,t=t**+n-e,n=1/n,function(r){return(e+r*t)**+n}}function YD(e){return(e=+e)==1?XD:function(t,n){return n-t?JD(t,n,e):GD(isNaN(t)?n:t)}}function XD(e,t){var n=t-e;return n?qD(e,n):GD(isNaN(e)?t:e)}var ZD=o((()=>{KD()}));function QD(e){return function(t){var n=t.length,r=Array(n),i=Array(n),a=Array(n),o,s;for(o=0;o<n;++o)s=ds(t[o]),r[o]=s.r||0,i[o]=s.g||0,a[o]=s.b||0;return r=e(r),i=e(i),a=e(a),s.opacity=1,function(e){return s.r=r(e),s.g=i(e),s.b=a(e),s+``}}}var $D,eO,tO=o((()=>{Fs(),UD(),WD(),ZD(),$D=(function e(t){var n=YD(t);function r(e,t){var r=n((e=ds(e)).r,(t=ds(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=XD(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+``}}return r.gamma=e,r})(1),eO=QD(HD)}));function nO(e,t){t||=[];var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=e[i]*(1-a)+t[i]*a;return r}}function rO(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var iO=o((()=>{}));function aO(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=Array(r),a=Array(n),o;for(o=0;o<r;++o)i[o]=yO(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(e){for(o=0;o<r;++o)a[o]=i[o](e);return a}}var oO=o((()=>{bO()}));function sO(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}var cO=o((()=>{}));function lO(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var uO=o((()=>{}));function dO(e,t){var n={},r={},i;for(i in(typeof e!=`object`||!e)&&(e={}),(typeof t!=`object`||!t)&&(t={}),t)i in e?n[i]=yO(e[i],t[i]):r[i]=t[i];return function(e){for(i in n)r[i]=n[i](e);return r}}var fO=o((()=>{bO()}));function pO(e){return function(){return e}}function mO(e){return function(t){return e(t)+``}}function hO(e,t){var n=gO.lastIndex=_O.lastIndex=0,r,i,a,o=-1,s=[],c=[];for(e+=``,t+=``;(r=gO.exec(e))&&(i=_O.exec(t));)(a=i.index)>n&&(a=t.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,c.push({i:o,x:lO(r,i)})),n=_O.lastIndex;return n<t.length&&(a=t.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?c[0]?mO(c[0].x):pO(t):(t=c.length,function(e){for(var n=0,r;n<t;++n)s[(r=c[n]).i]=r.x(e);return s.join(``)})}var gO,_O,vO=o((()=>{uO(),gO=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_O=new RegExp(gO.source,`g`)}));function yO(e,t){var n=typeof t,r;return t==null||n===`boolean`?GD(t):(n===`number`?lO:n===`string`?(r=ss(t))?(t=r,$D):hO:t instanceof ss?$D:t instanceof Date?sO:rO(t)?nO:Array.isArray(t)?aO:typeof t.valueOf!=`function`&&typeof t.toString!=`function`||isNaN(t)?dO:lO)(e,t)}var bO=o((()=>{Fs(),tO(),oO(),cO(),uO(),fO(),vO(),KD(),iO()}));function xO(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var SO=o((()=>{})),CO=o((()=>{bO(),uO(),SO(),tO()}));function wO(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var TO=o((()=>{}));function EO(e){return e.length===1&&(e=DO(e)),{left:function(t,n,r,i){for(r??=0,i??=t.length;r<i;){var a=r+i>>>1;e(t[a],n)<0?r=a+1:i=a}return r},right:function(t,n,r,i){for(r??=0,i??=t.length;r<i;){var a=r+i>>>1;e(t[a],n)>0?i=a:r=a+1}return r}}}function DO(e){return function(t,n){return wO(e(t),n)}}var OO=o((()=>{TO()})),kO,AO,jO=o((()=>{TO(),OO(),kO=EO(wO),AO=kO.right,kO.left}));function MO(e){return e===null?NaN:+e}var NO=o((()=>{})),PO,FO=o((()=>{PO=Array.prototype,PO.slice,PO.map}));function IO(e,t,n){var r,i=-1,a,o,s;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((r=t<e)&&(a=e,e=t,t=a),(s=LO(e,t,n))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=Array(a=Math.ceil(t-e+1));++i<a;)o[i]=(e+i)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=Array(a=Math.ceil(e-t+1));++i<a;)o[i]=(e-i)/s;return r&&o.reverse(),o}function LO(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/10**i;return i>=0?(a>=zO?10:a>=BO?5:a>=VO?2:1)*10**i:-(10**-i)/(a>=zO?10:a>=BO?5:a>=VO?2:1)}function RO(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=10**Math.floor(Math.log(r)/Math.LN10),a=r/i;return a>=zO?i*=10:a>=BO?i*=5:a>=VO&&(i*=2),t<e?-i:i}var zO,BO,VO,HO=o((()=>{zO=Math.sqrt(50),BO=Math.sqrt(10),VO=Math.sqrt(2)})),UO=o((()=>{FO(),jO(),HO()}));function WO(e,t,n){if(n??=MO,r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}var GO=o((()=>{NO()})),KO=o((()=>{FO()})),qO=o((()=>{jO(),TO(),OO(),UO(),KO(),GO(),HO()}));function JO(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function YO(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e);break}return this}var XO=o((()=>{}));function ZO(){}function QO(e,t){var n=new ZO;if(e instanceof ZO)e.each(function(e,t){n.set(t,e)});else if(Array.isArray(e)){var r=-1,i=e.length,a;if(t==null)for(;++r<i;)n.set(r,e[r]);else for(;++r<i;)n.set(t(a=e[r],r,e),a)}else if(e)for(var o in e)n.set(o,e[o]);return n}var $O=o((()=>{ZO.prototype=QO.prototype={constructor:ZO,has:function(e){return`$`+e in this},get:function(e){return this[`$`+e]},set:function(e,t){return this[`$`+e]=t,this},remove:function(e){var t=`$`+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===`$`&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===`$`&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===`$`&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===`$`&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===`$`&&++e;return e},empty:function(){for(var e in this)if(e[0]===`$`)return!1;return!0},each:function(e){for(var t in this)t[0]===`$`&&e(this[t],t.slice(1),this)}}})),ek=o((()=>{$O()}));function tk(){}function nk(e,t){var n=new tk;if(e instanceof tk)e.each(function(e){n.add(e)});else if(e){var r=-1,i=e.length;if(t==null)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}var rk,ik=o((()=>{$O(),rk=QO.prototype,tk.prototype=nk.prototype={constructor:tk,has:rk.has,add:function(e){return e+=``,this[`$`+e]=e,this},remove:rk.remove,clear:rk.clear,values:rk.keys,size:rk.size,empty:rk.empty,each:rk.each}})),ak=o((()=>{ek(),ik(),$O()})),ok,sk,ck,lk=o((()=>{ok=Array.prototype,sk=ok.map,ck=ok.slice}));function uk(){var e=QO(),t=[],n=[],r=dk;function i(i){var a=i+``,o=e.get(a);if(!o){if(r!==dk)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=QO();for(var r=-1,a=n.length,o,s;++r<a;)e.has(s=(o=n[r])+``)||e.set(s,t.push(o));return i},i.range=function(e){return arguments.length?(n=ck.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return uk(t,n).unknown(r)},JO.apply(i,arguments),i}var dk,fk=o((()=>{ak(),lk(),XO(),dk={name:`implicit`}})),pk=o((()=>{qO(),fk()}));function mk(e){return function(){return e}}var hk=o((()=>{}));function gk(e){return+e}var _k=o((()=>{}));function vk(e){return e}function yk(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:mk(isNaN(t)?NaN:.5)}function bk(e){var t=e[0],n=e[e.length-1],r;return t>n&&(r=t,t=n,n=r),function(e){return Math.max(t,Math.min(n,e))}}function xk(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=yk(i,r),a=n(o,a)):(r=yk(r,i),a=n(a,o)),function(e){return a(r(e))}}function Sk(e,t,n){var r=Math.min(e.length,t.length)-1,i=Array(r),a=Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=yk(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=AO(e,t,1,r)-1;return a[n](i[n](t))}}function Ck(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function wk(){var e=Ek,t=Ek,n=yO,r,i,a,o=vk,s,c,l;function u(){return s=Math.min(e.length,t.length)>2?Sk:xk,c=l=null,d}function d(i){return isNaN(i=+i)?a:(c||=s(e.map(r),t,n))(r(o(i)))}return d.invert=function(n){return o(i((l||=s(t,e.map(r),lO))(n)))},d.domain=function(t){return arguments.length?(e=sk.call(t,gk),o===vk||(o=bk(e)),u()):e.slice()},d.range=function(e){return arguments.length?(t=ck.call(e),u()):t.slice()},d.rangeRound=function(e){return t=ck.call(e),n=xO,u()},d.clamp=function(t){return arguments.length?(o=t?bk(e):vk,d):o!==vk},d.interpolate=function(e){return arguments.length?(n=e,u()):n},d.unknown=function(e){return arguments.length?(a=e,d):a},function(e,t){return r=e,i=t,u()}}function Tk(e,t){return wk()(e,t)}var Ek,Dk=o((()=>{qO(),CO(),lk(),hk(),_k(),Ek=[0,1]}));function Ok(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString(`en`).replace(/,/g,``):e.toString(10)}function kk(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf(`e`))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}var Ak=o((()=>{}));function jk(e){return e=kk(Math.abs(e)),e?e[1]:NaN}var Mk=o((()=>{Ak()}));function Nk(e,t){return function(n,r){for(var i=n.length,a=[],o=0,s=e[0],c=0;i>0&&s>0&&(c+s+1>r&&(s=Math.max(1,r-c)),a.push(n.substring(i-=s,i+s)),!((c+=s+1)>r));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}var Pk=o((()=>{}));function Fk(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}var Ik=o((()=>{}));function Lk(e){if(!(t=zk.exec(e)))throw Error(`invalid format: `+e);var t;return new Rk({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Rk(e){this.fill=e.fill===void 0?` `:e.fill+``,this.align=e.align===void 0?`>`:e.align+``,this.sign=e.sign===void 0?`-`:e.sign+``,this.symbol=e.symbol===void 0?``:e.symbol+``,this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?``:e.type+``}var zk,Bk=o((()=>{zk=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i,Lk.prototype=Rk.prototype,Rk.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?`0`:``)+(this.width===void 0?``:Math.max(1,this.width|0))+(this.comma?`,`:``)+(this.precision===void 0?``:`.`+Math.max(0,this.precision|0))+(this.trim?`~`:``)+this.type}}));function Vk(e){out:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case`.`:r=i=n;break;case`0`:r===0&&(r=n),i=n;break;default:if(!+e[n])break out;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Hk=o((()=>{}));function Uk(e,t){var n=kk(e,t);if(!n)return e+``;var r=n[0],i=n[1],a=i-(Wk=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+Array(a-o+1).join(`0`):a>0?r.slice(0,a)+`.`+r.slice(a):`0.`+Array(1-a).join(`0`)+kk(e,Math.max(0,t+a-1))[0]}var Wk,Gk=o((()=>{Ak()}));function Kk(e,t){var n=kk(e,t);if(!n)return e+``;var r=n[0],i=n[1];return i<0?`0.`+Array(-i).join(`0`)+r:r.length>i+1?r.slice(0,i+1)+`.`+r.slice(i+1):r+Array(i-r.length+2).join(`0`)}var qk=o((()=>{Ak()})),Jk,Yk=o((()=>{Ak(),Gk(),qk(),Jk={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+``},d:Ok,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Kk(e*100,t)},r:Kk,s:Uk,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}}}));function Xk(e){return e}var Zk=o((()=>{}));function Qk(e){var t=e.grouping===void 0||e.thousands===void 0?Xk:Nk($k.call(e.grouping,Number),e.thousands+``),n=e.currency===void 0?``:e.currency[0]+``,r=e.currency===void 0?``:e.currency[1]+``,i=e.decimal===void 0?`.`:e.decimal+``,a=e.numerals===void 0?Xk:Fk($k.call(e.numerals,String)),o=e.percent===void 0?`%`:e.percent+``,s=e.minus===void 0?`-`:e.minus+``,c=e.nan===void 0?`NaN`:e.nan+``;function l(e){e=Lk(e);var l=e.fill,u=e.align,d=e.sign,f=e.symbol,p=e.zero,m=e.width,h=e.comma,g=e.precision,_=e.trim,v=e.type;v===`n`?(h=!0,v=`g`):Jk[v]||(g===void 0&&(g=12),_=!0,v=`g`),(p||l===`0`&&u===`=`)&&(p=!0,l=`0`,u=`=`);var y=f===`$`?n:f===`#`&&/[boxX]/.test(v)?`0`+v.toLowerCase():``,b=f===`$`?r:/[%p]/.test(v)?o:``,x=Jk[v],S=/[defgprs%]/.test(v);g=g===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g));function C(e){var n=y,r=b,o,f,C;if(v===`c`)r=x(e)+r,e=``;else{e=+e;var w=e<0||1/e<0;if(e=isNaN(e)?c:x(Math.abs(e),g),_&&(e=Vk(e)),w&&+e==0&&d!==`+`&&(w=!1),n=(w?d===`(`?d:s:d===`-`||d===`(`?``:d)+n,r=(v===`s`?eA[8+Wk/3]:``)+r+(w&&d===`(`?`)`:``),S){for(o=-1,f=e.length;++o<f;)if(C=e.charCodeAt(o),48>C||C>57){r=(C===46?i+e.slice(o+1):e.slice(o))+r,e=e.slice(0,o);break}}}h&&!p&&(e=t(e,1/0));var E=n.length+e.length+r.length,D=E<m?Array(m-E+1).join(l):``;switch(h&&p&&(e=t(D+e,D.length?m-r.length:1/0),D=``),u){case`<`:e=n+e+r+D;break;case`=`:e=n+D+e+r;break;case`^`:e=D.slice(0,E=D.length>>1)+n+e+r+D.slice(E);break;default:e=D+n+e+r;break}return a(e)}return C.toString=function(){return e+``},C}function u(e,t){var n=l((e=Lk(e),e.type=`f`,e)),r=Math.max(-8,Math.min(8,Math.floor(jk(t)/3)))*3,i=10**-r,a=eA[8+r/3];return function(e){return n(i*e)+a}}return{format:l,formatPrefix:u}}var $k,eA,tA=o((()=>{Mk(),Pk(),Ik(),Bk(),Hk(),Yk(),Gk(),Zk(),$k=Array.prototype.map,eA=[`y`,`z`,`a`,`f`,`p`,`n`,`µ`,`m`,``,`k`,`M`,`G`,`T`,`P`,`E`,`Z`,`Y`]}));function nA(e){return rA=Qk(e),iA=rA.format,aA=rA.formatPrefix,rA}var rA,iA,aA,oA=o((()=>{tA(),nA({decimal:`.`,thousands:`,`,grouping:[3],currency:[`$`,``],minus:`-`})}));function sA(e){return Math.max(0,-jk(Math.abs(e)))}var cA=o((()=>{Mk()}));function lA(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(jk(t)/3)))*3-jk(Math.abs(e)))}var uA=o((()=>{Mk()}));function dA(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,jk(t)-jk(e))+1}var fA=o((()=>{Mk()})),pA=o((()=>{oA(),Bk(),cA(),uA(),fA()}));function mA(e,t,n,r){var i=RO(e,t,n),a;switch(r=Lk(r??`,f`),r.type){case`s`:var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(a=lA(i,o))&&(r.precision=a),aA(r,o);case``:case`e`:case`g`:case`p`:case`r`:r.precision==null&&!isNaN(a=dA(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=a-(r.type===`e`));break;case`f`:case`%`:r.precision==null&&!isNaN(a=sA(i))&&(r.precision=a-(r.type===`%`)*2);break}return iA(r)}var hA=o((()=>{qO(),pA()}));function gA(e){var t=e.domain;return e.ticks=function(e){var n=t();return IO(n[0],n[n.length-1],e??10)},e.tickFormat=function(e,n){var r=t();return mA(r[0],r[r.length-1],e??10,n)},e.nice=function(n){n??=10;var r=t(),i=0,a=r.length-1,o=r[i],s=r[a],c;return s<o&&(c=o,o=s,s=c,c=i,i=a,a=c),c=LO(o,s,n),c>0?(o=Math.floor(o/c)*c,s=Math.ceil(s/c)*c,c=LO(o,s,n)):c<0&&(o=Math.ceil(o*c)/c,s=Math.floor(s*c)/c,c=LO(o,s,n)),c>0?(r[i]=Math.floor(o/c)*c,r[a]=Math.ceil(s/c)*c,t(r)):c<0&&(r[i]=Math.ceil(o*c)/c,r[a]=Math.floor(s*c)/c,t(r)),e},e}function _A(){var e=Tk(vk,vk);return e.copy=function(){return Ck(e,_A())},JO.apply(e,arguments),gA(e)}var vA=o((()=>{qO(),Dk(),XO(),hA()})),yA=o((()=>{lk(),vA()}));function bA(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],a=e[r],o;return a<i&&(o=n,n=r,r=o,o=i,i=a,a=o),e[n]=t.floor(i),e[r]=t.ceil(a),e}var xA=o((()=>{}));function SA(e){return Math.log(e)}function CA(e){return Math.exp(e)}function wA(e){return-Math.log(-e)}function TA(e){return-Math.exp(-e)}function EA(e){return isFinite(e)?+(`1e`+e):e<0?0:e}function DA(e){return e===10?EA:e===Math.E?Math.exp:function(t){return e**+t}}function OA(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function kA(e){return function(t){return-e(-t)}}function AA(e){var t=e(SA,CA),n=t.domain,r=10,i,a;function o(){return i=OA(r),a=DA(r),n()[0]<0?(i=kA(i),a=kA(a),e(wA,TA)):e(SA,CA),t}return t.base=function(e){return arguments.length?(r=+e,o()):r},t.domain=function(e){return arguments.length?(n(e),o()):n()},t.ticks=function(e){var t=n(),o=t[0],s=t[t.length-1],c;(c=s<o)&&(l=o,o=s,s=l);var l=i(o),u=i(s),d,f,p,m=e==null?10:+e,h=[];if(!(r%1)&&u-l<m){if(l=Math.round(l)-1,u=Math.round(u)+1,o>0){for(;l<u;++l)for(f=1,d=a(l);f<r;++f)if(p=d*f,!(p<o)){if(p>s)break;h.push(p)}}else for(;l<u;++l)for(f=r-1,d=a(l);f>=1;--f)if(p=d*f,!(p<o)){if(p>s)break;h.push(p)}}else h=IO(l,u,Math.min(u-l,m)).map(a);return c?h.reverse():h},t.tickFormat=function(e,n){if(n??=r===10?`.0e`:`,`,typeof n!=`function`&&(n=iA(n)),e===1/0)return n;e??=10;var o=Math.max(1,r*e/t.ticks().length);return function(e){var t=e/a(Math.round(i(e)));return t*r<r-.5&&(t*=r),t<=o?n(e):``}},t.nice=function(){return n(bA(n(),{floor:function(e){return a(Math.floor(i(e)))},ceil:function(e){return a(Math.ceil(i(e)))}}))},t}function jA(){var e=AA(wk()).domain([1,10]);return e.copy=function(){return Ck(e,jA()).base(e.base())},JO.apply(e,arguments),e}var MA=o((()=>{qO(),pA(),xA(),Dk(),XO()})),NA=o((()=>{vA(),Dk()}));function PA(e){return function(t){return t<0?-((-t)**+e):t**+e}}function FA(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function IA(e){return e<0?-e*e:e*e}function LA(e){var t=e(vk,vk),n=1;function r(){return n===1?e(vk,vk):n===.5?e(FA,IA):e(PA(n),PA(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},gA(t)}function RA(){var e=LA(wk());return e.copy=function(){return Ck(e,RA()).exponent(e.exponent())},JO.apply(e,arguments),e}var zA=o((()=>{vA(),Dk(),XO()}));function BA(){var e=[],t=[],n=[],r;function i(){var r=0,i=Math.max(1,t.length);for(n=Array(i-1);++r<i;)n[r-1]=WO(e,r/i);return a}function a(e){return isNaN(e=+e)?r:t[AO(n,e)]}return a.invertExtent=function(r){var i=t.indexOf(r);return i<0?[NaN,NaN]:[i>0?n[i-1]:e[0],i<n.length?n[i]:e[e.length-1]]},a.domain=function(t){if(!arguments.length)return e.slice();e=[];for(var n=0,r=t.length,a;n<r;++n)a=t[n],a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(wO),i()},a.range=function(e){return arguments.length?(t=ck.call(e),i()):t.slice()},a.unknown=function(e){return arguments.length?(r=e,a):r},a.quantiles=function(){return n.slice()},a.copy=function(){return BA().domain(e).range(t).unknown(r)},JO.apply(a,arguments)}var VA=o((()=>{qO(),lk(),XO()}));function HA(){var e=0,t=1,n=1,r=[.5],i=[0,1],a;function o(e){return e<=e?i[AO(r,e,0,n)]:a}function s(){var i=-1;for(r=Array(n);++i<n;)r[i]=((i+1)*t-(i-n)*e)/(n+1);return o}return o.domain=function(n){return arguments.length?(e=+n[0],t=+n[1],s()):[e,t]},o.range=function(e){return arguments.length?(n=(i=ck.call(e)).length-1,s()):i.slice()},o.invertExtent=function(a){var o=i.indexOf(a);return o<0?[NaN,NaN]:o<1?[e,r[0]]:o>=n?[r[n-1],t]:[r[o-1],r[o]]},o.unknown=function(e){return arguments.length&&(a=e),o},o.thresholds=function(){return r.slice()},o.copy=function(){return HA().domain([e,t]).range(i).unknown(a)},JO.apply(gA(o),arguments)}var UA=o((()=>{qO(),lk(),vA(),XO()}));function WA(){var e=[.5],t=[0,1],n,r=1;function i(i){return i<=i?t[AO(e,i,0,r)]:n}return i.domain=function(n){return arguments.length?(e=ck.call(n),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(n){return arguments.length?(t=ck.call(n),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(n){var r=t.indexOf(n);return[e[r-1],e[r]]},i.unknown=function(e){return arguments.length?(n=e,i):n},i.copy=function(){return WA().domain(e).range(t).unknown(n)},JO.apply(i,arguments)}var GA=o((()=>{qO(),lk(),XO()}));function KA(e,t,n,r){function i(t){return e(t=arguments.length===0?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),n==null?1:Math.floor(n)),e},i.range=function(n,r,a){var o=[],s;if(n=i.ceil(n),a=a==null?1:Math.floor(a),!(n<r)||!(a>0))return o;do o.push(s=new Date(+n)),t(n,a),e(n);while(s<n&&n<r);return o},i.filter=function(n){return KA(function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)},function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););})},n&&(i.count=function(t,r){return qA.setTime(+t),JA.setTime(+r),e(qA),e(JA),Math.floor(n(qA,JA))},i.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?i.filter(r?function(t){return r(t)%e===0}:function(t){return i.count(0,t)%e===0}):i}),i}var qA,JA,YA=o((()=>{qA=new Date,JA=new Date})),XA,ZA=o((()=>{YA(),XA=KA(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e}),XA.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?KA(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):XA},XA.range})),QA,$A,ej,tj,nj,rj=o((()=>{QA=1e3,$A=6e4,ej=36e5,tj=864e5,nj=6048e5})),ij,aj=o((()=>{YA(),rj(),ij=KA(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*QA)},function(e,t){return(t-e)/QA},function(e){return e.getUTCSeconds()}),ij.range})),oj,sj=o((()=>{YA(),rj(),oj=KA(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*QA)},function(e,t){e.setTime(+e+t*$A)},function(e,t){return(t-e)/$A},function(e){return e.getMinutes()}),oj.range})),cj,lj=o((()=>{YA(),rj(),cj=KA(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*QA-e.getMinutes()*$A)},function(e,t){e.setTime(+e+t*ej)},function(e,t){return(t-e)/ej},function(e){return e.getHours()}),cj.range})),uj,dj=o((()=>{YA(),rj(),uj=KA(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*$A)/tj},function(e){return e.getDate()-1}),uj.range}));function fj(e){return KA(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t*7)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*$A)/nj})}var pj,mj,hj,gj,_j,vj,yj,bj=o((()=>{YA(),rj(),pj=fj(0),mj=fj(1),hj=fj(2),gj=fj(3),_j=fj(4),vj=fj(5),yj=fj(6),pj.range,mj.range,hj.range,gj.range,_j.range,vj.range,yj.range})),xj,Sj=o((()=>{YA(),xj=KA(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),xj.range})),Cj,wj=o((()=>{YA(),Cj=KA(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),Cj.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:KA(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})},Cj.range})),Tj,Ej=o((()=>{YA(),rj(),Tj=KA(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/tj},function(e){return e.getUTCDate()-1}),Tj.range}));function Dj(e){return KA(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t*7)},function(e,t){return(t-e)/nj})}var Oj,kj,Aj,jj,Mj,Nj,Pj,Fj=o((()=>{YA(),rj(),Oj=Dj(0),kj=Dj(1),Aj=Dj(2),jj=Dj(3),Mj=Dj(4),Nj=Dj(5),Pj=Dj(6),Oj.range,kj.range,Aj.range,jj.range,Mj.range,Nj.range,Pj.range})),Ij,Lj=o((()=>{YA(),Ij=KA(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),Ij.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:KA(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})},Ij.range})),Rj=o((()=>{ZA(),aj(),sj(),lj(),dj(),bj(),Sj(),wj(),Ej(),Fj(),Lj()}));function zj(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Bj(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Vj(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function Hj(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,c=e.shortMonths,l=Gj(i),u=Kj(i),d=Gj(a),f=Kj(a),p=Gj(o),m=Kj(o),h=Gj(s),g=Kj(s),_=Gj(c),v=Kj(c),y={a:P,A:F,b:I,B:ee,c:null,d:pM,e:pM,f:vM,g:kM,G:jM,H:mM,I:hM,j:gM,L:_M,m:yM,M:bM,p:R,q:z,Q:eN,s:tN,S:xM,u:SM,U:CM,V:TM,w:EM,W:DM,x:null,X:null,y:OM,Y:AM,Z:MM,"%":$M},b={a:B,A:te,b:ne,B:re,c:null,d:NM,e:NM,f:RM,g:YM,G:ZM,H:PM,I:FM,j:IM,L:LM,m:zM,M:BM,p:V,q:ie,Q:eN,s:tN,S:VM,u:HM,U:UM,V:GM,w:KM,W:qM,x:null,X:null,y:JM,Y:XM,Z:QM,"%":$M},x={a:D,A:O,b:k,B:A,c:j,d:rM,e:rM,f:lM,g:$j,G:Qj,H:aM,I:aM,j:iM,L:cM,m:nM,M:oM,p:E,q:tM,Q:dM,s:fM,S:sM,u:Jj,U:Yj,V:Xj,w:qj,W:Zj,x:M,X:N,y:$j,Y:Qj,Z:eM,"%":uM};y.x=S(n,y),y.X=S(r,y),y.c=S(t,y),b.x=S(n,b),b.X=S(r,b),b.c=S(t,b);function S(e,t){return function(n){var r=[],i=-1,a=0,o=e.length,s,c,l;for(n instanceof Date||(n=new Date(+n));++i<o;)e.charCodeAt(i)===37&&(r.push(e.slice(a,i)),(c=nN[s=e.charAt(++i)])==null?c=s===`e`?` `:`0`:s=e.charAt(++i),(l=t[s])&&(s=l(n,c)),r.push(s),a=i+1);return r.push(e.slice(a,i)),r.join(``)}}function C(e,t){return function(n){var r=Vj(1900,void 0,1),i=w(r,e,n+=``,0),a,o;if(i!=n.length)return null;if(`Q`in r)return new Date(r.Q);if(`s`in r)return new Date(r.s*1e3+(`L`in r?r.L:0));if(t&&!(`Z`in r)&&(r.Z=0),`p`in r&&(r.H=r.H%12+r.p*12),r.m===void 0&&(r.m=`q`in r?r.q:0),`V`in r){if(r.V<1||r.V>53)return null;`w`in r||(r.w=1),`Z`in r?(a=Bj(Vj(r.y,0,1)),o=a.getUTCDay(),a=o>4||o===0?kj.ceil(a):kj(a),a=Tj.offset(a,(r.V-1)*7),r.y=a.getUTCFullYear(),r.m=a.getUTCMonth(),r.d=a.getUTCDate()+(r.w+6)%7):(a=zj(Vj(r.y,0,1)),o=a.getDay(),a=o>4||o===0?mj.ceil(a):mj(a),a=uj.offset(a,(r.V-1)*7),r.y=a.getFullYear(),r.m=a.getMonth(),r.d=a.getDate()+(r.w+6)%7)}else (`W`in r||`U`in r)&&(`w`in r||(r.w=`u`in r?r.u%7:`W`in r?1:0),o=`Z`in r?Bj(Vj(r.y,0,1)).getUTCDay():zj(Vj(r.y,0,1)).getDay(),r.m=0,r.d=`W`in r?(r.w+6)%7+r.W*7-(o+5)%7:r.w+r.U*7-(o+6)%7);return`Z`in r?(r.H+=r.Z/100|0,r.M+=r.Z%100,Bj(r)):zj(r)}}function w(e,t,n,r){for(var i=0,a=t.length,o=n.length,s,c;i<a;){if(r>=o)return-1;if(s=t.charCodeAt(i++),s===37){if(s=t.charAt(i++),c=x[s in nN?t.charAt(i++):s],!c||(r=c(e,n,r))<0)return-1}else if(s!=n.charCodeAt(r++))return-1}return r}function E(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=u[r[0].toLowerCase()],n+r[0].length):-1}function D(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=m[r[0].toLowerCase()],n+r[0].length):-1}function O(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=f[r[0].toLowerCase()],n+r[0].length):-1}function k(e,t,n){var r=_.exec(t.slice(n));return r?(e.m=v[r[0].toLowerCase()],n+r[0].length):-1}function A(e,t,n){var r=h.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1}function j(e,n,r){return w(e,t,n,r)}function M(e,t,r){return w(e,n,t,r)}function N(e,t,n){return w(e,r,t,n)}function P(e){return o[e.getDay()]}function F(e){return a[e.getDay()]}function I(e){return c[e.getMonth()]}function ee(e){return s[e.getMonth()]}function R(e){return i[+(e.getHours()>=12)]}function z(e){return 1+~~(e.getMonth()/3)}function B(e){return o[e.getUTCDay()]}function te(e){return a[e.getUTCDay()]}function ne(e){return c[e.getUTCMonth()]}function re(e){return s[e.getUTCMonth()]}function V(e){return i[+(e.getUTCHours()>=12)]}function ie(e){return 1+~~(e.getUTCMonth()/3)}return{format:function(e){var t=S(e+=``,y);return t.toString=function(){return e},t},parse:function(e){var t=C(e+=``,!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+=``,b);return t.toString=function(){return e},t},utcParse:function(e){var t=C(e+=``,!0);return t.toString=function(){return e},t}}}function Uj(e,t,n){var r=e<0?`-`:``,i=(r?-e:e)+``,a=i.length;return r+(a<n?Array(n-a+1).join(t)+i:i)}function Wj(e){return e.replace(aN,`\\$&`)}function Gj(e){return RegExp(`^(?:`+e.map(Wj).join(`|`)+`)`,`i`)}function Kj(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function qj(e,t,n){var r=rN.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Jj(e,t,n){var r=rN.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Yj(e,t,n){var r=rN.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Xj(e,t,n){var r=rN.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function Zj(e,t,n){var r=rN.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Qj(e,t,n){var r=rN.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function $j(e,t,n){var r=rN.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function eM(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||`00`)),n+r[0].length):-1}function tM(e,t,n){var r=rN.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function nM(e,t,n){var r=rN.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function rM(e,t,n){var r=rN.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function iM(e,t,n){var r=rN.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function aM(e,t,n){var r=rN.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function oM(e,t,n){var r=rN.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function sM(e,t,n){var r=rN.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function cM(e,t,n){var r=rN.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function lM(e,t,n){var r=rN.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function uM(e,t,n){var r=iN.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function dM(e,t,n){var r=rN.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function fM(e,t,n){var r=rN.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function pM(e,t){return Uj(e.getDate(),t,2)}function mM(e,t){return Uj(e.getHours(),t,2)}function hM(e,t){return Uj(e.getHours()%12||12,t,2)}function gM(e,t){return Uj(1+uj.count(Cj(e),e),t,3)}function _M(e,t){return Uj(e.getMilliseconds(),t,3)}function vM(e,t){return _M(e,t)+`000`}function yM(e,t){return Uj(e.getMonth()+1,t,2)}function bM(e,t){return Uj(e.getMinutes(),t,2)}function xM(e,t){return Uj(e.getSeconds(),t,2)}function SM(e){var t=e.getDay();return t===0?7:t}function CM(e,t){return Uj(pj.count(Cj(e)-1,e),t,2)}function wM(e){var t=e.getDay();return t>=4||t===0?_j(e):_j.ceil(e)}function TM(e,t){return e=wM(e),Uj(_j.count(Cj(e),e)+(Cj(e).getDay()===4),t,2)}function EM(e){return e.getDay()}function DM(e,t){return Uj(mj.count(Cj(e)-1,e),t,2)}function OM(e,t){return Uj(e.getFullYear()%100,t,2)}function kM(e,t){return e=wM(e),Uj(e.getFullYear()%100,t,2)}function AM(e,t){return Uj(e.getFullYear()%1e4,t,4)}function jM(e,t){var n=e.getDay();return e=n>=4||n===0?_j(e):_j.ceil(e),Uj(e.getFullYear()%1e4,t,4)}function MM(e){var t=e.getTimezoneOffset();return(t>0?`-`:(t*=-1,`+`))+Uj(t/60|0,`0`,2)+Uj(t%60,`0`,2)}function NM(e,t){return Uj(e.getUTCDate(),t,2)}function PM(e,t){return Uj(e.getUTCHours(),t,2)}function FM(e,t){return Uj(e.getUTCHours()%12||12,t,2)}function IM(e,t){return Uj(1+Tj.count(Ij(e),e),t,3)}function LM(e,t){return Uj(e.getUTCMilliseconds(),t,3)}function RM(e,t){return LM(e,t)+`000`}function zM(e,t){return Uj(e.getUTCMonth()+1,t,2)}function BM(e,t){return Uj(e.getUTCMinutes(),t,2)}function VM(e,t){return Uj(e.getUTCSeconds(),t,2)}function HM(e){var t=e.getUTCDay();return t===0?7:t}function UM(e,t){return Uj(Oj.count(Ij(e)-1,e),t,2)}function WM(e){var t=e.getUTCDay();return t>=4||t===0?Mj(e):Mj.ceil(e)}function GM(e,t){return e=WM(e),Uj(Mj.count(Ij(e),e)+(Ij(e).getUTCDay()===4),t,2)}function KM(e){return e.getUTCDay()}function qM(e,t){return Uj(kj.count(Ij(e)-1,e),t,2)}function JM(e,t){return Uj(e.getUTCFullYear()%100,t,2)}function YM(e,t){return e=WM(e),Uj(e.getUTCFullYear()%100,t,2)}function XM(e,t){return Uj(e.getUTCFullYear()%1e4,t,4)}function ZM(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Mj(e):Mj.ceil(e),Uj(e.getUTCFullYear()%1e4,t,4)}function QM(){return`+0000`}function $M(){return`%`}function eN(e){return+e}function tN(e){return Math.floor(e/1e3)}var nN,rN,iN,aN,oN=o((()=>{Rj(),nN={"-":``,_:` `,0:`0`},rN=/^\s*\d+/,iN=/^%/,aN=/[\\^$*+?|[\]().{}]/g}));function sN(e){return cN=Hj(e),lN=cN.format,uN=cN.parse,dN=cN.utcFormat,fN=cN.utcParse,cN}var cN,lN,uN,dN,fN,pN=o((()=>{oN(),sN({dateTime:`%x, %X`,date:`%-m/%-d/%Y`,time:`%-I:%M:%S %p`,periods:[`AM`,`PM`],days:[`Sunday`,`Monday`,`Tuesday`,`Wednesday`,`Thursday`,`Friday`,`Saturday`],shortDays:[`Sun`,`Mon`,`Tue`,`Wed`,`Thu`,`Fri`,`Sat`],months:[`January`,`February`,`March`,`April`,`May`,`June`,`July`,`August`,`September`,`October`,`November`,`December`],shortMonths:[`Jan`,`Feb`,`Mar`,`Apr`,`May`,`Jun`,`Jul`,`Aug`,`Sep`,`Oct`,`Nov`,`Dec`]})})),mN=o((()=>{pN()}));function hN(e){return new Date(e)}function gN(e){return e instanceof Date?+e:+new Date(+e)}function _N(e,t,n,r,i,a,o,s,c){var l=Tk(vk,vk),u=l.invert,d=l.domain,f=c(`.%L`),p=c(`:%S`),m=c(`%I:%M`),h=c(`%I %p`),g=c(`%a %d`),_=c(`%b %d`),v=c(`%B`),y=c(`%Y`),b=[[o,1,yN],[o,5,5*yN],[o,15,15*yN],[o,30,30*yN],[a,1,bN],[a,5,5*bN],[a,15,15*bN],[a,30,30*bN],[i,1,xN],[i,3,3*xN],[i,6,6*xN],[i,12,12*xN],[r,1,SN],[r,2,2*SN],[n,1,CN],[t,1,wN],[t,3,3*wN],[e,1,TN]];function x(s){return(o(s)<s?f:a(s)<s?p:i(s)<s?m:r(s)<s?h:t(s)<s?n(s)<s?g:_:e(s)<s?v:y)(s)}function S(t,n,r,i){if(t??=10,typeof t==`number`){var a=Math.abs(r-n)/t,o=EO(function(e){return e[2]}).right(b,a);o===b.length?(i=RO(n/TN,r/TN,t),t=e):o?(o=b[a/b[o-1][2]<b[o][2]/a?o-1:o],i=o[1],t=o[0]):(i=Math.max(RO(n,r,t),1),t=s)}return i==null?t:t.every(i)}return l.invert=function(e){return new Date(u(e))},l.domain=function(e){return arguments.length?d(sk.call(e,gN)):d().map(hN)},l.ticks=function(e,t){var n=d(),r=n[0],i=n[n.length-1],a=i<r,o;return a&&(o=r,r=i,i=o),o=S(e,r,i,t),o=o?o.range(r,i+1):[],a?o.reverse():o},l.tickFormat=function(e,t){return t==null?x:c(t)},l.nice=function(e,t){var n=d();return(e=S(e,n[0],n[n.length-1],t))?d(bA(n,e)):l},l.copy=function(){return Ck(l,_N(e,t,n,r,i,a,o,s,c))},l}function vN(){return JO.apply(_N(Cj,xj,pj,uj,cj,oj,ij,XA,lN).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}var yN,bN,xN,SN,CN,wN,TN,EN=o((()=>{qO(),Rj(),mN(),lk(),Dk(),XO(),xA(),yN=1e3,bN=yN*60,xN=bN*60,SN=xN*24,CN=SN*7,wN=SN*30,TN=SN*365})),DN=o((()=>{EN()}));function ON(){var e=0,t=1,n,r,i,a,o=vk,s=!1,c;function l(e){return isNaN(e=+e)?c:o(i===0?.5:(e=(a(e)-n)*i,s?Math.max(0,Math.min(1,e)):e))}return l.domain=function(o){return arguments.length?(n=a(e=+o[0]),r=a(t=+o[1]),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(e){return arguments.length?(s=!!e,l):s},l.interpolator=function(e){return arguments.length?(o=e,l):o},l.unknown=function(e){return arguments.length?(c=e,l):c},function(o){return a=o,n=o(e),r=o(t),i=n===r?0:1/(r-n),l}}function kN(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function AN(){var e=gA(ON()(vk));return e.copy=function(){return kN(e,AN())},YO.apply(e,arguments)}var jN=o((()=>{Dk(),XO(),vA(),MA(),NA(),zA()})),MN=o((()=>{qO(),Dk()}));function NN(){var e=0,t=.5,n=1,r,i,a,o,s,c=vk,l,u=!1,d;function f(e){return isNaN(e=+e)?d:(e=.5+((e=+l(e))-i)*(e<i?o:s),c(u?Math.max(0,Math.min(1,e)):e))}return f.domain=function(c){return arguments.length?(r=l(e=+c[0]),i=l(t=+c[1]),a=l(n=+c[2]),o=r===i?0:.5/(i-r),s=i===a?0:.5/(a-i),f):[e,t,n]},f.clamp=function(e){return arguments.length?(u=!!e,f):u},f.interpolator=function(e){return arguments.length?(c=e,f):c},f.unknown=function(e){return arguments.length?(d=e,f):d},function(c){return l=c,r=c(e),i=c(t),a=c(n),o=r===i?0:.5/(i-r),s=i===a?0:.5/(a-i),f}}function PN(){var e=gA(NN()(vk));return e.copy=function(){return kN(e,PN())},YO.apply(e,arguments)}var FN=o((()=>{Dk(),XO(),vA(),MA(),jN(),NA(),zA()})),IN=o((()=>{pk(),yA(),vA(),MA(),NA(),fk(),zA(),VA(),UA(),GA(),EN(),DN(),jN(),MN(),FN(),hA()}));function LN(e){let t,n=[];function r(e){return e??t}return r.invert=r,r.domain=r.range=e=>e?(n=e,e):n,r.unknown=e=>e?(t=e,e):t,r.copy=()=>LN(e).unknown(t),r}var RN=o((()=>{})),zN,BN,VN,HN,UN,WN,GN=o((()=>{cv(),Py(),ov(),UC(),kp(),BD(),CO(),IN(),RN(),{isNil:zN,isString:BN,uniq:VN}=tu,HN=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,UN={[iy.LINEAR]:_A,[iy.POWER]:RA,[iy.LOG]:jA,[iy.IDENTITY]:LN,[iy.SEQUENTIAL]:AN,[iy.TIME]:vN,[iy.QUANTILE]:BA,[iy.QUANTIZE]:HA,[iy.THRESHOLD]:WA,[iy.CAT]:uk,[iy.DIVERGING]:PN},WN=class{constructor(){J(this,`scaleOptions`,{})}apply(e,{styleAttributeService:t}){var n=this;e.hooks.init.tapPromise(`FeatureScalePlugin`,Z(function*(){e.log(Jv.ScaleInitStart,ny.INIT),n.scaleOptions=e.getScaleOptions();let r=t.getLayerStyleAttributes(),i=e.getSource()?.data.dataArray;Array.isArray(i)&&i.length===0||(n.caculateScalesForAttributes(r||[],i),e.log(Jv.ScaleInitEnd,ny.INIT))})),e.hooks.beforeRenderData.tapPromise(`FeatureScalePlugin`,function(){var r=Z(function*(r){if(!r)return r;e.log(Jv.ScaleInitStart,ny.UPDATE),n.scaleOptions=e.getScaleOptions();let i=t.getLayerStyleAttributes(),a=e.getSource().data.dataArray;return Array.isArray(a)&&a.length===0?!0:(n.caculateScalesForAttributes(i||[],a),e.log(Jv.ScaleInitEnd,ny.UPDATE),e.layerModelNeedUpdate=!0,!0)});return function(e){return r.apply(this,arguments)}}()),e.hooks.beforeRender.tap(`FeatureScalePlugin`,()=>{if(e.layerModelNeedUpdate)return;this.scaleOptions=e.getScaleOptions();let n=t.getLayerStyleAttributes(),r=e.getSource().data.dataArray;if(!(Array.isArray(r)&&r.length===0)&&n){let e=n.filter(e=>e.needRescale);e.length&&this.caculateScalesForAttributes(e,r)}})}isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}caculateScalesForAttributes(e,t){e.forEach(e=>{if(e.scale){let n=e.scale,r=e.scale.field;n.names=this.parseFields(zN(r)?[]:r);let i=[];n.names.forEach(n=>{i.push(this.createScale(n,e.name,e.scale?.values,t))}),i.some(e=>e.type===ay.VARIABLE)?(n.type=ay.VARIABLE,i.forEach(e=>{if(!n.callback&&n.values!==`text`)switch(e.option?.type){case iy.LOG:case iy.LINEAR:case iy.POWER:if(n.values&&n.values.length>2){let t=e.scale.ticks(n.values.length);e.scale.domain(t)}n.values?e.scale.range(n.values):e.scale.range(e.option.domain);break;case iy.QUANTILE:case iy.QUANTIZE:case iy.THRESHOLD:e.scale.range(n.values);break;case iy.IDENTITY:break;case iy.CAT:n.values?e.scale.range(n.values):e.scale.range(e.option.domain);break;case iy.DIVERGING:case iy.SEQUENTIAL:e.scale.interpolator(eO(n.values));break}n.values===`text`&&e.scale.range(e.option?.domain)})):(n.type=ay.CONSTANT,n.defaultValues=i.map((e,t)=>e.scale(n.names[t]))),n.scalers=i.map(e=>({field:e.field,func:e.scale,option:e.option})),e.needRescale=!1}})}parseFields(e){return Array.isArray(e)?e:BN(e)?e.split(`*`):[e]}createScale(e,t,n,r){let i=this.scaleOptions[t]&&this.scaleOptions[t]?.field===e?this.scaleOptions[t]:this.scaleOptions[e],a={field:e,scale:void 0,type:ay.VARIABLE,option:i};if(!r||!r.length)return i&&i.type?a.scale=this.createDefaultScale(i):(a.scale=uk([e]),a.type=ay.CONSTANT),a;let o=r.find(t=>!zN(t[e]))?.[e];if(this.isNumber(e)||zN(o)&&!i)a.scale=uk([e]),a.type=ay.CONSTANT;else{let t=i&&i.type||this.getDefaultType(o);n===`text`&&(t=iy.CAT),n===void 0&&(t=iy.IDENTITY);let s=this.createScaleConfig(t,e,i,r);a.scale=this.createDefaultScale(s),a.option=s}return a}getDefaultType(e){let t=iy.LINEAR;return typeof e==`string`&&(t=HN.test(e)?iy.TIME:iy.CAT),t}createScaleConfig(e,t,n,r){let i=Y(Y({},n),{},{type:e});if(i!=null&&i.domain)return i;let a=[];if(e===iy.QUANTILE){let e=new Map;r?.forEach(n=>{e.set(n._id,n[t])}),a=Array.from(e.values())}else a=r?.map(e=>e[t])||[];if(e===iy.CAT||e===iy.IDENTITY)i.domain=VN(a);else if(e===iy.QUANTILE)i.domain=a;else if(e===iy.DIVERGING){let e=RD(a),t=n?.neutral===void 0?(e[0]+e[1])/2:n?.neutral;i.domain=[e[0],t,e[1]]}else i.domain=RD(a);return i}createDefaultScale({type:e,domain:t,unknown:n,clamp:r,nice:i}){let a=UN[e]();return t&&a.domain&&a.domain(t),n&&a.unknown(n),r!==void 0&&a.clamp&&a.clamp(r),i!==void 0&&a.nice&&a.nice(i),a}}})),KN,qN=o((()=>{cv(),KN=class{apply(e){e.hooks.beforeRender.tap(`LayerAnimateStylePlugin`,()=>{e.animateStatus&&e.models.forEach(t=>{t.addUniforms(Y({},e.layerModel.getAnimateUniforms()))})})}}})),JN,YN=o((()=>{JN=class{apply(e){e.hooks.afterInit.tap(`LayerMaskPlugin`,()=>{let{maskLayers:t,enableMask:n}=e.getLayerConfig();!e.tileLayer&&t&&t.length>0&&e.updateLayerConfig({mask:n})})}}})),XN,ZN=o((()=>{Py(),UC(),XN=class{build(e){return Z(function*(){e.prepareBuildModel(),yield e.buildModels()})()}initLayerModel(e){var t=this;return Z(function*(){yield t.build(e),e.styleNeedUpdate=!1})()}prepareLayerModel(e){var t=this;return Z(function*(){yield t.build(e),e.styleNeedUpdate=!1})()}apply(e){var t=this;e.hooks.init.tapPromise(`LayerModelPlugin`,Z(function*(){if(e.getSource().isTile){e.prepareBuildModel();return}e.log(Jv.BuildModelStart,ny.INIT),yield t.initLayerModel(e),e.log(Jv.BuildModelEnd,ny.INIT)})),e.hooks.beforeRenderData.tapPromise(`LayerModelPlugin`,function(){var n=Z(function*(n){return!n||e.getSource().isTile?!1:(e.log(Jv.BuildModelStart,ny.UPDATE),yield t.prepareLayerModel(e),e.log(Jv.BuildModelEnd,ny.UPDATE),!0)});return function(e){return n.apply(this,arguments)}}())}}})),QN,$N=o((()=>{QN=class{apply(e){e.hooks.afterInit.tap(`LayerStylePlugin`,()=>{let{autoFit:t,fitBoundsOptions:n}=e.getLayerConfig();t&&e.fitBounds(n),e.styleNeedUpdate=!1})}}}));function eP(e){let t={u_DirectionalLights:[,,,].fill(Y({},iP)),u_NumOfDirectionalLights:0,u_SpotLights:[,,,].fill(Y({},aP)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[rP]),e.forEach(e=>{let{type:n=`directional`}=e,r=Fx(e,tP),i=nP[n].lights,a=nP[n].num,o=t[a];t[i][o]=Y(Y({},t[i][o]),r),t[a]++}),t}var tP,nP,rP,iP,aP,oP,sP=o((()=>{Ix(),cv(),tP=[`type`],nP={directional:{lights:`u_DirectionalLights`,num:`u_NumOfDirectionalLights`},spot:{lights:`u_SpotLights`,num:`u_NumOfSpotLights`}},rP={type:`directional`,direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},iP={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},aP={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},oP=class{apply(e){e.hooks.beforeRender.tap(`LightingPlugin`,()=>{let{enableLighting:t}=e.getLayerConfig();t&&e.models.forEach(e=>e.addUniforms(Y({},eP())))})}}}));function cP(e){return e.map(e=>(typeof e==`string`&&(e=[e,{}]),e))}function lP(e,t,n,r){let i=e.multiPassRenderer;return i.add(r(`render`)),cP(t).forEach(e=>{let[t,r]=e;i.add(n(t),r)}),i.add(n(`copy`)),i}var uP=o((()=>{})),dP,fP=o((()=>{ov(),uP(),dP=class{constructor(){J(this,`enabled`,void 0)}apply(e,{rendererService:t,postProcessingPassFactory:n,normalPassFactory:r}){e.hooks.init.tapPromise(`MultiPassRendererPlugin`,()=>{let{enableMultiPassRenderer:t,passes:i=[]}=e.getLayerConfig();this.enabled=!!t&&e.getLayerConfig().enableMultiPassRenderer!==!1,this.enabled&&(e.multiPassRenderer=lP(e,i,n,r),e.multiPassRenderer.setRenderFlag(!0))}),e.hooks.beforeRender.tap(`MultiPassRendererPlugin`,()=>{if(this.enabled){let{width:n,height:r}=t.getViewportSize();e.multiPassRenderer.resize(n,r)}})}}}));function pP(e){switch(e){case`rotation`:return{name:`Rotation`,type:oy.Attribute,descriptor:{name:`a_Rotation`,shaderLocation:mP.ROTATION,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{rotation:t=0}=e;return Array.isArray(t)?[t[0]]:[t]}}};case`stroke`:return{name:`stroke`,type:oy.Attribute,descriptor:{name:`a_Stroke`,shaderLocation:mP.STROKE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:4,update:e=>{let{stroke:t=[1,1,1,1]}=e;return t}}};case`opacity`:return{name:`opacity`,type:oy.Attribute,descriptor:{name:`a_Opacity`,shaderLocation:mP.OPACITY,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{opacity:t=1}=e;return[t]}}};case`offsets`:return{name:`offsets`,type:oy.Attribute,descriptor:{name:`a_Offsets`,shaderLocation:mP.OFFSETS,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let{offsets:t}=e;return t}}};default:return}}var mP,hP=o((()=>{UC(),mP={POSITION:0,POSITION_64LOW:1,COLOR:2,PICKING_COLOR:3,STROKE:4,OPACITY:5,OFFSETS:6,ROTATION:7,MAX:8}})),gP,_P,vP,yP=o((()=>{ov(),UC(),kp(),hP(),{isNumber:gP}=tu,_P={NONE:0,ENCODE:1,HIGHLIGHT:2},vP=class{constructor(){J(this,`pickingUniformMap`,void 0)}pickOption2Array(){let e=[];return this.pickingUniformMap.forEach(t=>{gP(t)?e.push(t):e.push(...t)}),e}updatePickOption(e,t){Object.keys(e).forEach(t=>{this.pickingUniformMap.set(t,e[t])});let n=t.getLayerConfig().pickingBuffer||0,r=Number(t.getShaderPickStat());this.pickingUniformMap.set(`u_PickingBuffer`,n),this.pickingUniformMap.set(`u_shaderPick`,r),t.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}apply(e,{styleAttributeService:t}){this.pickingUniformMap=new Map([[`u_HighlightColor`,[1,0,0,1]],[`u_SelectColor`,[1,0,0,1]],[`u_PickingColor`,[0,0,0]],[`u_PickingStage`,0],[`u_CurrentSelectedId`,[0,0,0]],[`u_PickingThreshold`,10],[`u_PickingBuffer`,0],[`u_shaderPick`,0],[`u_activeMix`,0]]),e.hooks.init.tapPromise(`PixelPickingPlugin`,()=>{let{enablePicking:n}=e.getLayerConfig();t.registerStyleAttribute({name:`pickingColor`,type:oy.Attribute,descriptor:{name:`a_PickingColor`,shaderLocation:mP.PICKING_COLOR,buffer:{data:[],type:X.FLOAT},size:3,update:e=>{let{id:t}=e;return n?zs(t):[0,0,0]}}})}),e.hooks.beforePickingEncode.tap(`PixelPickingPlugin`,()=>{let{enablePicking:t}=e.getLayerConfig();t&&e.isVisible()&&(this.updatePickOption({u_PickingStage:_P.ENCODE},e),e.models.forEach(e=>e.addUniforms({u_PickingStage:_P.ENCODE})))}),e.hooks.afterPickingEncode.tap(`PixelPickingPlugin`,()=>{let{enablePicking:t}=e.getLayerConfig();t&&e.isVisible()&&(this.updatePickOption({u_PickingStage:_P.HIGHLIGHT},e),e.models.forEach(e=>e.addUniforms({u_PickingStage:_P.HIGHLIGHT})))}),e.hooks.beforeHighlight.tap(`PixelPickingPlugin`,t=>{let{highlightColor:n,activeMix:r=0}=e.getLayerConfig(),i=typeof n==`string`?Ls(n):n||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:Rs(new Uint8Array(t))});let a={u_PickingStage:_P.HIGHLIGHT,u_PickingColor:t,u_HighlightColor:i.map(e=>e*255),u_activeMix:r};this.updatePickOption(a,e),e.models.forEach(e=>e.addUniforms(a))}),e.hooks.beforeSelect.tap(`PixelPickingPlugin`,t=>{let{selectColor:n,selectMix:r=0}=e.getLayerConfig(),i=typeof n==`string`?Ls(n):n||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:Rs(new Uint8Array(t))});let a={u_PickingStage:_P.HIGHLIGHT,u_PickingColor:t,u_HighlightColor:i.map(e=>e*255),u_activeMix:r,u_CurrentSelectedId:t,u_SelectColor:i.map(e=>e*255)};this.updatePickOption(a,e),e.models.forEach(e=>e.addUniforms(a))})}}}));function bP(e){let t=e.getSource();return xP.includes(t.parser.type)}var xP,SP=o((()=>{xP=[`mvt`,`geojsonvt`,`testTile`]})),CP,wP=o((()=>{UC(),hP(),SP(),CP=class{apply(e,{styleAttributeService:t}){e.hooks.init.tapPromise(`RegisterStyleAttributePlugin`,()=>{bP(e)||this.registerBuiltinAttributes(t,e)})}registerBuiltinAttributes(e,t){if(t.type===`MaskLayer`){this.registerPositionAttribute(e);return}this.registerPositionAttribute(e),this.registerColorAttribute(e)}registerPositionAttribute(e){e.registerStyleAttribute({name:`position`,type:oy.Attribute,descriptor:{name:`a_Position`,shaderLocation:mP.POSITION,buffer:{data:[],type:X.FLOAT},size:3,update:(e,t,n)=>n.length===2?[n[0],n[1],0]:[n[0],n[1],n[2]]}})}registerColorAttribute(e){e.registerStyleAttribute({name:`color`,type:oy.Attribute,descriptor:{name:`a_Color`,shaderLocation:mP.COLOR,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:4,update:e=>{let{color:t}=e;return!t||!t.length?[1,1,1,1]:t}}})}}})),TP,EP=o((()=>{cv(),ov(),UC(),TP=class{constructor(){J(this,`cameraService`,void 0),J(this,`coordinateSystemService`,void 0),J(this,`rendererService`,void 0),J(this,`mapService`,void 0),J(this,`layerService`,void 0)}apply(e,{rendererService:t,mapService:n,layerService:r,coordinateSystemService:i,cameraService:a}){this.rendererService=t,this.mapService=n,this.layerService=r,this.coordinateSystemService=i,this.cameraService=a;let o;this.rendererService.uniformBuffers[0]||(o=this.rendererService.createBuffer({data:new Float32Array(96),isUBO:!0,label:`renderUniformBuffer`}),this.rendererService.uniformBuffers[0]=o),e.hooks.beforeRender.tap(`ShaderUniformPlugin`,()=>{let t=e.getRelativeOrigin&&e.getRelativeOrigin()||[0,0];this.coordinateSystemService.refresh(),t&&(Math.abs(t[0])>1e-4||Math.abs(t[1])>1e-4)&&this.coordinateSystemService.getCoordinateSystem()===2&&this.coordinateSystemService.setViewportCenter(t);let{width:n,height:r}=this.rendererService.getViewportSize(),{data:i,uniforms:a}=this.generateUBO(n,r,t);this.layerService.alreadyInRendering&&this.rendererService.uniformBuffers[0]&&this.rendererService.uniformBuffers[0].subData({offset:0,data:i}),this.rendererService.queryVerdorInfo()===`WebGL1`&&e.models.forEach(t=>{t.addUniforms(Y(Y({},a),{},{u_PickingBuffer:e.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(e.getShaderPickStat())}))})})}generateUBO(e,t,n){let r=this.cameraService.getProjectionMatrix(),i=this.cameraService.getViewMatrix(),a=this.cameraService.getViewProjectionMatrix(),o=this.cameraService.getModelMatrix(),s=this.coordinateSystemService.getViewportCenterProjection(),c=this.coordinateSystemService.getPixelsPerDegree(),l=this.cameraService.getZoom(),u=this.coordinateSystemService.getPixelsPerDegree2(),d=this.cameraService.getZoomScale(),f=this.coordinateSystemService.getPixelsPerMeter(),p=this.coordinateSystemService.getCoordinateSystem(),m=this.cameraService.getCameraPosition(),h=window.devicePixelRatio,g=this.coordinateSystemService.getViewportCenter(),_=[e,t],v=this.cameraService.getFocalDistance(),y=n&&n.length>=2?[n[0],n[1]]:[0,0];return{data:[...i,...r,...a,...o,...s,...c,l,...u,d,...f,p,...m,h,...g,..._,v,...y,0],uniforms:{[Rv.ProjectionMatrix]:r,[Rv.ViewMatrix]:i,[Rv.ViewProjectionMatrix]:a,[Rv.Zoom]:l,[Rv.ZoomScale]:d,[Rv.FocalDistance]:v,[Rv.CameraPosition]:m,[Kv.CoordinateSystem]:p,[Kv.ViewportCenter]:g,[Kv.ViewportCenterProjection]:s,[Kv.PixelsPerDegree]:c,[Kv.PixelsPerDegree2]:u,[Kv.PixelsPerMeter]:f,u_ViewportSize:_,u_ModelMatrix:o,u_DevicePixelRatio:h,u_RelativeOrigin:y}}}}})),DP,OP=o((()=>{DP=class{apply(e){e.hooks.beforeRender.tap(`UpdateModelPlugin`,()=>{e.layerModel&&e.layerModel.needUpdate().then(t=>{t&&e.renderLayers()})}),e.hooks.afterRender.tap(`UpdateModelPlugin`,()=>{e.layerModelNeedUpdate=!1})}}})),kP,AP=o((()=>{kP=class{apply(e,{styleAttributeService:t}){e.hooks.init.tapPromise(`UpdateStyleAttributePlugin`,()=>{this.initStyleAttribute(e,{styleAttributeService:t})}),e.hooks.beforeRender.tap(`UpdateStyleAttributePlugin`,()=>{e.layerModelNeedUpdate||e.inited&&this.updateStyleAttribute(e,{styleAttributeService:t})})}updateStyleAttribute(e,{styleAttributeService:t}){let n=t.getLayerStyleAttributes()||[],r=t.getLayerStyleAttribute(`filter`);if(r&&r.needRegenerateVertices){e.layerModelNeedUpdate=!0,n.forEach(e=>e.needRegenerateVertices=!1);return}n.filter(e=>e.needRegenerateVertices).forEach(n=>{t.updateAttributeByFeatureRange(n.name,e.getEncodedData(),n.featureRange.startIndex,n.featureRange.endIndex,e),n.needRegenerateVertices=!1})}initStyleAttribute(e,{styleAttributeService:t}){(t.getLayerStyleAttributes()||[]).filter(e=>e.needRegenerateVertices).forEach(n=>{t.updateAttributeByFeatureRange(n.name,e.getEncodedData(),n.featureRange.startIndex,n.featureRange.endIndex),n.needRegenerateVertices=!1})}}}));function jP(){return[new ID,new CP,new WN,new PD,new QN,new JN,new kP,new DP,new dP,new TP,new KN,new oP,new vP,new XN]}var MP=o((()=>{FD(),LD(),GN(),qN(),YN(),ZN(),$N(),sP(),fP(),yP(),wP(),EP(),OP(),AP()})),NP,PP=o((()=>{UC(),NP={[$v.additive]:{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE,srcAlpha:1,dstAlpha:1}},[$v.none]:{enable:!1},[$v.normal]:{enable:!0,func:{srcRGB:X.SRC_ALPHA,dstRGB:X.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}},[$v.subtractive]:{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE,srcAlpha:X.ZERO,dstAlpha:X.ONE_MINUS_SRC_COLOR},equation:{rgb:X.FUNC_SUBTRACT,alpha:X.FUNC_SUBTRACT}},[$v.max]:{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE},equation:{rgb:X.MAX_EXT}},[$v.min]:{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE},equation:{rgb:X.MIN_EXT}}}})),FP,IP=o((()=>{cv(),Py(),ov(),kp(),FP=class{constructor(e){J(this,`layer`,void 0),this.layer=e}pickRender(e){let t=this.layer.getContainer().layerService,n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(e);n.hooks.beforePickingEncode.call(),t.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}pick(e,t){var n=this;return Z(function*(){let r=n.layer.getContainer().pickingService;return e.type===`RasterLayer`?n.pickRasterLayer(e,t):(n.pickRender(t),r.pickFromPickingFBO(e,t))})()}pickRasterLayer(e,t,n){let r=this.layer.getContainer(),i=r.pickingService,a=r.mapService,o=this.layer.getSource().extent,s=fd(t.lngLat,o),c={x:t.x,y:t.y,type:t.type,lngLat:t.lngLat,target:t,rasterValue:null},l=n||e;return s?(c.rasterValue=this.readRasterValue(e,o,a,t.x,t.y),i.triggerHoverOnLayer(l,c),!0):(c.type=t.type===`mousemove`?`mouseout`:`un`+t.type,i.triggerHoverOnLayer(l,Y(Y({},c),{},{type:`unpick`})),i.triggerHoverOnLayer(l,c),!1)}readRasterValue(e,t,n,r,i){let a=e.getSource().data.dataArray[0],[o=0,s=0,c=10,l=-10]=t,u=n.lngLatToContainer([o,s]),d=n.lngLatToContainer([c,l]),f=d.x-u.x,p=u.y-d.y,m=[(r-u.x)/f,(i-d.y)/p],h=a.width||1,g=a.height||1,_=Math.floor(m[0]*h),v=Math.floor(m[1]*g),y=Math.max(0,v-1)*h+_;return a.data[y]}selectFeature(e){let t=this.layer,[n,r,i]=e;t.hooks.beforeSelect.call([n,r,i])}highlightPickedFeature(e){let[t,n,r]=e;this.layer.hooks.beforeHighlight.call([t,n,r])}getFeatureById(e){return this.layer.getSource().getFeatureById(e)}}})),LP,RP=o((()=>{ov(),kp(),LP=class{constructor(e){J(this,`layer`,void 0),J(this,`rendererService`,void 0),J(this,`colorTexture`,void 0),J(this,`key`,void 0),this.layer=e,this.rendererService=this.layer.getContainer().rendererService}getColorTexture(e,t){let n=this.getTextureKey(e,t);return this.key===n?this.colorTexture:(this.createColorTexture(e,t),this.key=n,this.colorTexture)}createColorTexture(e,t){let{createTexture2D:n}=this.rendererService,r=this.getColorRampBar(e,t),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1,unorm:!0});return this.colorTexture=i,i}setColorTexture(e,t,n){this.key=this.getTextureKey(t,n),this.colorTexture=e}destroy(){var e;(e=this.colorTexture)==null||e.destroy()}getColorRampBar(e,t){switch(e.type){case`cat`:return Hs(e);case`quantize`:return Us(e);case`custom`:return Ws(e,t);case`linear`:return Vs(e,t);default:return Bs(e)}}getTextureKey(e,t){var n;return`${e.colors.join(`_`)}_${e==null||(n=e.positions)==null?void 0:n.join(`_`)}_${e.type}_${t?.join(`_`)}`}}})),zP,BP,VP,HP,UP,WP,GP,KP,qP,JP,YP,XP=o((()=>{Ix(),Py(),cv(),ov(),So(),UC(),FE(),kp(),zP=u(Mf()),MP(),PP(),uP(),IP(),RP(),BP=[`passes`],VP=[`moduleName`,`vertexShader`,`fragmentShader`,`defines`,`inject`,`triangulation`,`styleOption`,`pickingEnabled`],{isEqual:HP,isFunction:UP,isNumber:WP,isObject:GP,isPlainObject:KP,isUndefined:qP}=tu,JP=0,YP=class extends zP.EventEmitter{get shaderModuleService(){return this.container.shaderModuleService}get cameraService(){return this.container.cameraService}get coordinateService(){return this.container.coordinateSystemService}get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get pickingService(){return this.container.pickingService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get interactionService(){return this.container.interactionService}get mapService(){return this.container?.mapService}get normalPassFactory(){return this.container.normalPassFactory}constructor(e={}){super(),J(this,`id`,`${JP++}`),J(this,`name`,`${JP}`),J(this,`parent`,void 0),J(this,`coordCenter`,void 0),J(this,`type`,void 0),J(this,`visible`,!0),J(this,`zIndex`,0),J(this,`minZoom`,void 0),J(this,`maxZoom`,void 0),J(this,`inited`,!1),J(this,`layerModelNeedUpdate`,!1),J(this,`pickedFeatureID`,null),J(this,`selectedFeatureID`,null),J(this,`styleNeedUpdate`,!1),J(this,`rendering`,void 0),J(this,`forceRender`,!1),J(this,`clusterZoom`,0),J(this,`layerType`,void 0),J(this,`triangulation`,void 0),J(this,`layerPickService`,void 0),J(this,`textureService`,void 0),J(this,`defaultSourceConfig`,{data:[],options:{parser:{type:`json`}}}),J(this,`dataState`,{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),J(this,`hooks`,{init:new bo,afterInit:new vo,beforeRender:new vo,beforeRenderData:new xo,afterRender:new fo,beforePickingEncode:new fo,afterPickingEncode:new fo,beforeHighlight:new fo([`pickedColor`]),afterHighlight:new fo,beforeSelect:new fo([`pickedColor`]),afterSelect:new fo,beforeDestroy:new fo,afterDestroy:new fo}),J(this,`models`,[]),J(this,`multiPassRenderer`,void 0),J(this,`plugins`,void 0),J(this,`startInit`,!1),J(this,`sourceOption`,void 0),J(this,`layerModel`,void 0),J(this,`shapeOption`,void 0),J(this,`tileLayer`,void 0),J(this,`layerChildren`,[]),J(this,`masks`,[]),J(this,`configService`,DC),J(this,`styleAttributeService`,void 0),J(this,`layerSource`,void 0),J(this,`postProcessingPassFactory`,void 0),J(this,`animateOptions`,{enable:!1}),J(this,`relativeOrigin`,[0,0]),J(this,`originalExtent`,[0,0,0,0]),J(this,`absoluteDataArray`,[]),J(this,`container`,void 0),J(this,`encodedData`,void 0),J(this,`currentPickId`,null),J(this,`rawConfig`,void 0),J(this,`needUpdateConfig`,void 0),J(this,`encodeStyleAttribute`,{}),J(this,`enableShaderEncodeStyles`,[]),J(this,`enableDataEncodeStyles`,[]),J(this,`pendingStyleAttributes`,[]),J(this,`scaleOptions`,{}),J(this,`animateStartTime`,void 0),J(this,`animateStatus`,!1),J(this,`isDestroyed`,!1),J(this,`uniformBuffers`,[]),J(this,`encodeDataLength`,0),J(this,`sourceEvent`,()=>{this.dataState.dataSourceNeedUpdate=!0,this.processRelativeCoordinates();let e=this.getLayerConfig();e&&e.autoFit&&this.fitBounds(e.fitBoundsOptions),this.layerSource.getSourceCfg().autoRender&&setTimeout(()=>{this.reRender()},10)}),this.name=e.name||this.id,this.zIndex=e.zIndex||0,this.rawConfig=e,this.masks=e.maskLayers||[]}addMask(e){this.masks.push(e),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}removeMask(e){let t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),this.updateLayerConfig({maskLayers:this.masks})}disableMask(){this.updateLayerConfig({enableMask:!1})}enableMask(){this.updateLayerConfig({enableMask:!0})}addMaskLayer(e){this.masks.push(e)}removeMaskLayer(e){let t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),e.destroy()}getAttribute(e){return this.styleAttributeService.getLayerStyleAttribute(e)}getLayerConfig(){return this.configService.getLayerConfig(this.id)}updateLayerConfig(e){if(Object.keys(e).map(t=>{t in this.rawConfig&&(this.rawConfig[t]=e[t])}),!this.startInit)this.needUpdateConfig=Y(Y({},this.needUpdateConfig),e);else{let t=this.container.id;this.configService.setLayerConfig(t,this.id,Y(Y(Y({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}}setContainer(e){this.container=e}getContainer(){return this.container}addPlugin(e){return this.plugins.push(e),this}init(){var e=this;return Z(function*(){let t=e.container.id;e.startInit=!0,e.configService.setLayerConfig(t,e.id,e.rawConfig),e.layerType=e.rawConfig.layerType;let{enableMultiPassRenderer:n,passes:r}=e.getLayerConfig();n&&r!=null&&r.length&&r.length>0&&e.mapService.on(`mapAfterFrameChange`,()=>{e.renderLayers()}),e.postProcessingPassFactory=e.container.postProcessingPassFactory,e.styleAttributeService=e.container.styleAttributeService,n&&(e.multiPassRenderer=e.container.multiPassRenderer,e.multiPassRenderer.setLayer(e)),e.pendingStyleAttributes.forEach(({attributeName:t,attributeField:n,attributeValues:r,updateOptions:i})=>{e.styleAttributeService.updateStyleAttribute(t,{scale:Y({field:n},e.splitValuesAndCallbackInAttribute(r,n?void 0:e.getLayerConfig()[t]))},i)}),e.pendingStyleAttributes=[],e.plugins=jP();for(let t of e.plugins)t.apply(e,e.container);e.layerPickService=new FP(e),e.textureService=new LP(e),e.log(Jv.LayerInitStart),yield e.hooks.init.promise(),e.log(Jv.LayerInitEnd),e.inited=!0,e.emit(`inited`,{target:e,type:`inited`}),e.emit(`add`,{target:e,type:`add`}),e.hooks.afterInit.call()})()}log(e,t=`init`){var n;if(this.tileLayer||this.isTileLayer)return;let r=`${this.id}.${t}.${e}`,i={id:this.id,type:this.type};(n=this.debugService)==null||n.log(r,i)}updateModelData(e){e.attributes&&e.elements?this.models.map(t=>{t.updateAttributesAndElements(e.attributes,e.elements)}):console.warn(`data error`)}setLayerPickService(e){this.layerPickService=e}prepareBuildModel(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});let{animateOption:e}=this.getLayerConfig();e!=null&&e.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}color(e,t,n){return this.updateStyleAttribute(`color`,e,t,n),this}texture(e,t,n){return this.updateStyleAttribute(`texture`,e,t,n),this}rotate(e,t,n){return this.updateStyleAttribute(`rotate`,e,t,n),this}size(e,t,n){return this.updateStyleAttribute(`size`,e,t,n),this}filter(e,t,n){let r=this.updateStyleAttribute(`filter`,e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}shape(e,t,n){this.shapeOption={field:e,values:t};let r=this.updateStyleAttribute(`shape`,e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}label(e,t,n){return this.pendingStyleAttributes.push({attributeName:`label`,attributeField:e,attributeValues:t,updateOptions:n}),this}animate(e){let t={};return GP(e)?(t.enable=!0,t=Y(Y({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}source(e,t){return e?.type===`source`?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}setData(e,t){return this.inited?(this.dataUpdatelog(),this.layerSource.setData(e,t)):this.on(`inited`,()=>{this.dataUpdatelog(),this.layerSource.setData(e,t)}),this}dataUpdatelog(){this.log(Jv.SourceInitStart,ny.UPDATE),this.layerSource.once(`update`,()=>{this.log(Jv.SourceInitEnd,ny.UPDATE)})}style(e){let{passes:t}=e,n=Fx(e,BP);t&&cP(t).forEach(e=>{let t=this.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);t&&t.updateOptions(e[1])}),n.borderColor&&(n.stroke=n.borderColor),n.borderWidth&&(n.strokeWidth=n.borderWidth);let r=n;return Object.keys(n).forEach(e=>{let t=n[e];Array.isArray(t)&&t.length===2&&!WP(t[0])&&!WP(t[1])&&(r[e]={field:t[0],value:t[1]})}),this.encodeStyle(r),this.updateLayerConfig(r),this}encodeStyle(e){Object.keys(e).forEach(t=>{[...this.enableShaderEncodeStyles,...this.enableDataEncodeStyles].includes(t)&&KP(e[t])&&(e[t].field||e[t].value)&&!HP(this.encodeStyleAttribute[t],e[t])?(this.encodeStyleAttribute[t]=e[t],this.updateStyleAttribute(t,e[t].field,e[t].value),this.inited&&(this.dataState.dataMappingNeedUpdate=!0)):this.encodeStyleAttribute[t]&&(delete this.encodeStyleAttribute[t],this.dataState.dataSourceNeedUpdate=!0)})}scale(e,t){let n=Y({},this.scaleOptions);if(GP(e)?this.scaleOptions=Y(Y({},this.scaleOptions),e):this.scaleOptions[e]=t,this.styleAttributeService&&!HP(n,this.scaleOptions)){let n=GP(e)?e:{[e]:t};this.styleAttributeService.updateScaleAttribute(n)}return this}renderLayers(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}prerender(){}render(e={}){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(e),this)}renderMultiPass(){var e=this;return Z(function*(){e.encodeDataLength<=0&&!e.forceRender||(e.multiPassRenderer&&e.multiPassRenderer.getRenderFlag()?yield e.multiPassRenderer.render():e.renderModels())})()}active(e){let t={};return t.enableHighlight=GP(e)?!0:e,GP(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}setActive(e,t){if(GP(e)){let{x:n=0,y:r=0}=e;this.updateLayerConfig({highlightColor:GP(t)?t.color:this.getLayerConfig().highlightColor,activeMix:GP(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:n,y:r})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:GP(t)?t.color:this.getLayerConfig().highlightColor,activeMix:GP(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(zs(e)).then(()=>{setTimeout(()=>{this.reRender()},1)})}select(e){let t={};return t.enableSelect=GP(e)?!0:e,GP(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}setSelect(e,t){if(GP(e)){let{x:n=0,y:r=0}=e;this.updateLayerConfig({selectColor:GP(t)?t.color:this.getLayerConfig().selectColor,selectMix:GP(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:n,y:r})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:GP(t)?t.color:this.getLayerConfig().selectColor,selectMix:GP(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(zs(e)).then(()=>{setTimeout(()=>{this.reRender()},1)})}setBlend(e){return this.updateLayerConfig({blend:e}),this.reRender(),this}show(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit(`show`),this}hide(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit(`hide`),this}setIndex(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}setCurrentPickId(e){this.currentPickId=e}getCurrentPickId(){return this.currentPickId}setCurrentSelectedId(e){this.selectedFeatureID=e}getCurrentSelectedId(){return this.selectedFeatureID}isVisible(){let e=this.mapService.getZoom(),{visible:t,minZoom:n=-1/0,maxZoom:r=1/0}=this.getLayerConfig();return!!t&&e>=n&&e<r}setMultiPass(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){let{passes:e=[]}=this.getLayerConfig();this.multiPassRenderer=lP(this,e,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);let{width:t,height:n}=this.rendererService.getViewportSize();this.multiPassRenderer.resize(t,n)}return this}setMinZoom(e){return this.updateLayerConfig({minZoom:e}),this}getMinZoom(){let{minZoom:e}=this.getLayerConfig();return e}getMaxZoom(){let{maxZoom:e}=this.getLayerConfig();return e}get(e){return this.getLayerConfig()[e]}setMaxZoom(e){return this.updateLayerConfig({maxZoom:e}),this}setAutoFit(e){return this.updateLayerConfig({autoFit:e}),this}fitBounds(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;let t=this.getSource().extent;return t.some(e=>Math.abs(e)===1/0)||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}destroy(e=!0){var t,n,r,i,a;if(this.isDestroyed)return;(t=this.layerModel)==null||t.uniformBuffers.forEach(e=>{e.destroy()}),this.layerChildren.map(e=>e.destroy(!1)),this.layerChildren=[];let{maskfence:o}=this.getLayerConfig();o&&(this.masks.map(e=>e.destroy(!1)),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off(`update`,this.sourceEvent),(n=this.multiPassRenderer)==null||n.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(r=this.layerModel)==null||r.clearModels(e),(i=this.tileLayer)==null||i.destroy(),this.models=[],(a=this.debugService)==null||a.removeLog(this.id),this.emit(`remove`,{target:this,type:`remove`}),this.emit(`destroy`,{target:this,type:`destroy`}),this.removeAllListeners(),this.isDestroyed=!0}clear(){this.styleAttributeService.clearAllAttributes()}clearModels(){var e;this.models.forEach(e=>e.destroy()),(e=this.layerModel)==null||e.clearModels(),this.models=[]}isDirty(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(e=>e.needRescale||e.needRemapping||e.needRegenerateVertices).length}setSource(e){if(this.layerSource&&this.layerSource.off(`update`,this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){let e=this.mapService.getZoom();this.layerSource.updateClusterData(e)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on(`update`,({type:e})=>{if(this.coordCenter===void 0&&(this.coordCenter=this.layerSource.center),e===`update`){if(this.tileLayer){this.tileLayer.reload();return}this.sourceEvent()}e===`inited`&&this.processRelativeCoordinates()})}getSource(){return this.layerSource}getScaleOptions(){return this.scaleOptions}setEncodedData(e){this.encodedData=e,this.encodeDataLength=e.length}getEncodedData(){return this.encodedData}getScale(e){return this.styleAttributeService.getLayerAttributeScale(e)}getLegend(e){var t,n,r;let i=this.styleAttributeService.getLayerStyleAttribute(e);return{type:(n=((i==null||(t=i.scale)==null?void 0:t.scalers)||[])[0])==null||(n=n.option)==null?void 0:n.type,field:i==null||(r=i.scale)==null?void 0:r.field,items:this.getLegendItems(e)}}getLegendItems(e){let t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.invertExtent?t.range().map(n=>({value:t.invertExtent(n),[e]:n})):t.ticks?t.ticks().map(n=>({value:n,[e]:t(n)})):t!=null&&t.domain?t.domain().filter(e=>!qP(e)).map(n=>({value:n,[e]:t(n)})):[]:[]}pick({x:e,y:t}){this.interactionService.triggerHover({x:e,y:t})}boxSelect(e,t){this.pickingService.boxPickLayer(this,e,t)}buildLayerModel(e){var t=this;return Z(function*(){let{moduleName:n,vertexShader:r,fragmentShader:i,defines:a,inject:o,triangulation:s,styleOption:c,pickingEnabled:l=!0}=e,u=Fx(e,VP);t.shaderModuleService.registerModule(n,{vs:r,fs:i,defines:a,inject:o});let{vs:d,fs:f,uniforms:p}=t.shaderModuleService.getModule(n),{createModel:m}=t.rendererService;return new Promise(e=>{let{attributes:n,elements:r,count:i}=t.styleAttributeService.createAttributesAndIndices(t.encodedData,s,c,t),a=[...t.layerModel.uniformBuffers,...t.rendererService.uniformBuffers];l&&a.push(t.getPickingUniformBuffer());let o=Y({attributes:n,uniforms:p,fs:f,vs:d,elements:r,blend:NP[$v.normal],uniformBuffers:a,textures:t.layerModel.textures},u);i&&(o.count=i),e(m(o))})})()}createAttributes(e){let{triangulation:t}=e,{attributes:n}=this.styleAttributeService.createAttributes(this.encodedData,t);return n}getTime(){return this.layerService.clock.getDelta()}setAnimateStartTime(){this.animateStartTime=this.layerService.clock.getElapsedTime()}stopAnimate(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}getLayerAnimateTime(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}needPick(e){let{enableHighlight:t=!0,enableSelect:n=!0}=this.getLayerConfig(),r=this.eventNames().indexOf(e)!==-1||this.eventNames().indexOf(`un`+e)!==-1;return(e===`click`||e===`dblclick`)&&n&&(r=!0),e===`mousemove`&&(t||this.eventNames().indexOf(`mouseenter`)!==-1||this.eventNames().indexOf(`unmousemove`)!==-1||this.eventNames().indexOf(`mouseout`)!==-1)&&(r=!0),this.isVisible()&&r}buildModels(){return Z(function*(){throw Error(`Method not implemented.`)})()}rebuildModels(){var e=this;return Z(function*(){yield e.buildModels()})()}renderMulPass(e){return Z(function*(){yield e.render()})()}renderModels(e={}){return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(t=>{t.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(e),textures:this.layerModel.textures},e?.ispick||!1)}),this.hooks.afterRender.call(),this)}updateStyleAttribute(e,t,n,r){return HP((this.configService.getAttributeConfig(this.id)||{})[e],{field:t,values:n})?!1:([`color`,`size`,`texture`,`rotate`,`filter`,`label`,`shape`].indexOf(e)!==-1&&this.configService.setAttributeConfig(this.id,{[e]:{field:t,values:n}}),this.startInit?this.styleAttributeService.updateStyleAttribute(e,{scale:Y({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r}),!0)}getLayerAttributeConfig(){return this.configService.getAttributeConfig(this.id)}getShaderPickStat(){return this.layerService.getShaderPickStat()}setEarthTime(e){console.warn(`empty fn`)}processData(e){return e}getModelType(){throw Error(`Method not implemented.`)}getDefaultConfig(){return{}}processRelativeCoordinates(){if(!this.getLayerConfig().enableRelativeCoordinates||!this.layerSource||!this.layerSource.data)return;this.absoluteDataArray=[...this.layerSource.data.dataArray];let e=CE(this.layerSource.data.dataArray,{enableRelativeCoordinates:!0});this.layerSource.data.dataArray=e.dataArray,this.relativeOrigin=e.relativeOrigin,this.originalExtent=e.originalExtent}getAbsoluteData(){return this.absoluteDataArray}getRelativeOrigin(){return this.relativeOrigin}getOriginalExtent(){return this.originalExtent}initLayerModels(){var e=this;return Z(function*(){e.models.forEach(e=>e.destroy()),e.models=[],e.uniformBuffers.forEach(e=>{e.destroy()}),e.uniformBuffers=[];let t=e.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0,label:`pickingUniforms`});e.uniformBuffers.push(t),e.models=yield e.layerModel.initModels()})()}getPickingUniformBuffer(){return this.uniformBuffers[0]}reRender(){this.inited&&this.layerService.reRender()}splitValuesAndCallbackInAttribute(e){return{values:UP(e)?void 0:e,callback:UP(e)?e:void 0}}}}));function ZP(e,t){return{enable:e,mask:255,func:{cmp:X.EQUAL,ref:t?1:0,mask:1}}}function QP(e){return e.maskOperation===ty.OR?{enable:!0,mask:255,func:{cmp:X.ALWAYS,ref:1,mask:255},opFront:{fail:X.KEEP,zfail:X.REPLACE,zpass:X.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===ey.SINGLE||e.stencilIndex===0?X.ALWAYS:X.LESS,ref:e.stencilType===ey.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:X.KEEP,zfail:X.REPLACE,zpass:X.REPLACE}}}var $P=o((()=>{UC()})),eF,tF,nF=o((()=>{eF={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},tF={opacity:`float`,stroke:`vec4`,offsets:`vec2`,textOffset:`vec2`,rotation:`float`,extrusionBase:`float`,strokeOpacity:`float`,thetaOffset:`float`}})),rF=s(((e,t)=>{t.exports=n,t.exports.default=n;function n(e,t,n){n||=2;var i=t&&t.length,o=i?t[0]*n:e.length,s=r(e,0,o,n,!0),c=[];if(!s||s.next===s.prev)return c;var l,d,f,p,m,h,g;if(i&&(s=u(e,t,s,n)),e.length>80*n){l=f=e[0],d=p=e[1];for(var _=n;_<o;_+=n)m=e[_],h=e[_+1],m<l&&(l=m),h<d&&(d=h),m>f&&(f=m),h>p&&(p=h);g=Math.max(f-l,p-d),g=g===0?0:32767/g}return a(s,c,n,l,d,g,0),c}function r(e,t,n,r,i){var a,o;if(i===P(e,t,n,r)>0)for(a=t;a<n;a+=r)o=j(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=j(a,e[a],e[a+1],o);return o&&S(o,o.next)&&(M(o),o=o.next),o}function i(e,t){if(!e)return e;t||=e;var n=e,r;do if(r=!1,!n.steiner&&(S(n,n.next)||x(n.prev,n,n.next)===0)){if(M(n),n=t=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==t);return t}function a(e,t,n,r,u,d,f){if(e){!f&&d&&h(e,r,u,d);for(var p=e,m,g;e.prev!==e.next;){if(m=e.prev,g=e.next,d?s(e,r,u,d):o(e)){t.push(m.i/n|0),t.push(e.i/n|0),t.push(g.i/n|0),M(e),e=g.next,p=g.next;continue}if(e=g,e===p){f?f===1?(e=c(i(e),t,n),a(e,t,n,r,u,d,2)):f===2&&l(e,t,n,r,u,d):a(i(e),t,n,r,u,d,1);break}}}}function o(e){var t=e.prev,n=e,r=e.next;if(x(t,n,r)>=0)return!1;for(var i=t.x,a=n.x,o=r.x,s=t.y,c=n.y,l=r.y,u=i<a?i<o?i:o:a<o?a:o,d=s<c?s<l?s:l:c<l?c:l,f=i>a?i>o?i:o:a>o?a:o,p=s>c?s>l?s:l:c>l?c:l,m=r.next;m!==t;){if(m.x>=u&&m.x<=f&&m.y>=d&&m.y<=p&&y(i,s,a,c,o,l,m.x,m.y)&&x(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function s(e,t,n,r){var i=e.prev,a=e,o=e.next;if(x(i,a,o)>=0)return!1;for(var s=i.x,c=a.x,l=o.x,u=i.y,d=a.y,f=o.y,p=s<c?s<l?s:l:c<l?c:l,m=u<d?u<f?u:f:d<f?d:f,h=s>c?s>l?s:l:c>l?c:l,g=u>d?u>f?u:f:d>f?d:f,v=_(p,m,t,n,r),b=_(h,g,t,n,r),S=e.prevZ,C=e.nextZ;S&&S.z>=v&&C&&C.z<=b;){if(S.x>=p&&S.x<=h&&S.y>=m&&S.y<=g&&S!==i&&S!==o&&y(s,u,c,d,l,f,S.x,S.y)&&x(S.prev,S,S.next)>=0||(S=S.prevZ,C.x>=p&&C.x<=h&&C.y>=m&&C.y<=g&&C!==i&&C!==o&&y(s,u,c,d,l,f,C.x,C.y)&&x(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;S&&S.z>=v;){if(S.x>=p&&S.x<=h&&S.y>=m&&S.y<=g&&S!==i&&S!==o&&y(s,u,c,d,l,f,S.x,S.y)&&x(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;C&&C.z<=b;){if(C.x>=p&&C.x<=h&&C.y>=m&&C.y<=g&&C!==i&&C!==o&&y(s,u,c,d,l,f,C.x,C.y)&&x(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function c(e,t,n){var r=e;do{var a=r.prev,o=r.next.next;!S(a,o)&&C(a,r,r.next,o)&&O(a,o)&&O(o,a)&&(t.push(a.i/n|0),t.push(r.i/n|0),t.push(o.i/n|0),M(r),M(r.next),r=e=o),r=r.next}while(r!==e);return i(r)}function l(e,t,n,r,o,s){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&b(c,l)){var u=A(c,l);c=i(c,c.next),u=i(u,u.next),a(c,t,n,r,o,s,0),a(u,t,n,r,o,s,0);return}l=l.next}c=c.next}while(c!==e)}function u(e,t,n,i){var a=[],o,s,c,l,u;for(o=0,s=t.length;o<s;o++)c=t[o]*i,l=o<s-1?t[o+1]*i:e.length,u=r(e,c,l,i,!1),u===u.next&&(u.steiner=!0),a.push(v(u));for(a.sort(d),o=0;o<a.length;o++)n=f(a[o],n);return n}function d(e,t){return e.x-t.x}function f(e,t){var n=p(e,t);if(!n)return t;var r=A(n,e);return i(r,r.next),i(n,n.next)}function p(e,t){var n=t,r=e.x,i=e.y,a=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var s=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a&&(a=s,o=n.x<n.next.x?n:n.next,s===r))return o}n=n.next}while(n!==t);if(!o)return null;var c=o,l=o.x,u=o.y,d=1/0,f;n=o;do r>=n.x&&n.x>=l&&r!==n.x&&y(i<u?r:a,i,l,u,i<u?a:r,i,n.x,n.y)&&(f=Math.abs(i-n.y)/(r-n.x),O(n,e)&&(f<d||f===d&&(n.x>o.x||n.x===o.x&&m(o,n)))&&(o=n,d=f)),n=n.next;while(n!==c);return o}function m(e,t){return x(e.prev,e,t.prev)<0&&x(t.next,e,e.next)<0}function h(e,t,n,r){var i=e;do i.z===0&&(i.z=_(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,g(i)}function g(e){var t,n,r,i,a,o,s,c,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ,r);t++);for(c=l;s>0||c>0&&r;)s!==0&&(c===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,l*=2}while(o>1);return e}function _(e,t,n,r,i){return e=(e-n)*i|0,t=(t-r)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function v(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function y(e,t,n,r,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(i-o)*(r-s)}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!D(e,t)&&(O(e,t)&&O(t,e)&&k(e,t)&&(x(e.prev,e,t.prev)||x(e,t.prev,t))||S(e,t)&&x(e.prev,e,e.next)>0&&x(t.prev,t,t.next)>0)}function x(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function S(e,t){return e.x===t.x&&e.y===t.y}function C(e,t,n,r){var i=E(x(e,t,n)),a=E(x(e,t,r)),o=E(x(n,r,e)),s=E(x(n,r,t));return!!(i!==a&&o!==s||i===0&&w(e,n,t)||a===0&&w(e,r,t)||o===0&&w(n,e,r)||s===0&&w(n,t,r))}function w(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function E(e){return e>0?1:e<0?-1:0}function D(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&C(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function O(e,t){return x(e.prev,e,e.next)<0?x(e,t,e.next)>=0&&x(e,e.prev,t)>=0:x(e,t,e.prev)<0||x(e,e.next,t)<0}function k(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}function A(e,t){var n=new N(e.i,e.x,e.y),r=new N(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function j(e,t,n,r){var i=new N(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function N(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(e,t,n,r){var i=t&&t.length,a=i?t[0]*n:e.length,o=Math.abs(P(e,0,a,n));if(i)for(var s=0,c=t.length;s<c;s++){var l=t[s]*n,u=s<c-1?t[s+1]*n:e.length;o-=Math.abs(P(e,l,u,n))}var d=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,m=r[s+2]*n;d+=Math.abs((e[f]-e[m])*(e[p+1]-e[f+1])-(e[f]-e[p])*(e[m+1]-e[f+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)};function P(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}n.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}}));function iF(e){return Math.max(Math.ceil(e/4)*4,4)}function aF(e,t,n,r=!0){let i=n===3;if(r){e=e.slice();let t=[];for(let r=0;r<e.length;r+=n){t[0]=e[r],t[1]=e[r+1],i&&(t[2]=e[r+2]);let n=_d(t,!0,{enable:!1,decimal:1});e[r]=n[0],e[r+1]=n[1],i&&(e[r+2]=n[2])}}return(0,oF.default)(e,t,n)}var oF,sF=o((()=>{kp(),oF=u(rF())}));function cF(e,t){let n=[],r=``;e.forEach(e=>{let i=e.replace(/([a-z])([A-Z])/g,`$1_$2`).toUpperCase(),a=lF+i;t[e]?r+=`#define USE_ATTRIBUTE_${i} 0.0 \n`:n.push(`  ${tF[e]} u_${e};`),r+=`
#ifdef USE_ATTRIBUTE_${i}
layout(location = ${a}) in ${tF[e]} a_${e.charAt(0).toUpperCase()+e.slice(1)};
#endif \n`});let i=n.length?`
layout(std140) uniform AttributeUniforms {
  ${n.join(`
`)}
};\n`:``;r+=i;let a=``;return e.forEach(e=>{let t=e.replace(/([a-z])([A-Z])/g,`$1_$2`).toUpperCase();a+=`
  #ifdef USE_ATTRIBUTE_${t}
    ${tF[e]} ${e} = a_${e.charAt(0).toUpperCase()+e.slice(1)};
  #else
    ${tF[e]} ${e} = u_${e};
  #endif
  `}),{"vs:#decl":r,"fs:#decl":i,"vs:#main-start":a}}var lF,uF,dF=o((()=>{Py(),cv(),ov(),UC(),kp(),PP(),$P(),hP(),nF(),sF(),lF=`ATTRIBUTE_LOCATION_`,uF=class{get attributeLocation(){return Y({},mP)}constructor(e){J(this,`triangulation`,void 0),J(this,`uniformBuffers`,[]),J(this,`textures`,[]),J(this,`createTexture2D`,void 0),J(this,`preStyleAttribute`,{}),J(this,`encodeStyleAttribute`,{}),J(this,`layer`,void 0),J(this,`dataTexture`,void 0),J(this,`DATA_TEXTURE_WIDTH`,void 0),J(this,`dataTextureTest`,void 0),J(this,`configService`,void 0),J(this,`shaderModuleService`,void 0),J(this,`rendererService`,void 0),J(this,`iconService`,void 0),J(this,`fontService`,void 0),J(this,`styleAttributeService`,void 0),J(this,`mapService`,void 0),J(this,`cameraService`,void 0),J(this,`layerService`,void 0),J(this,`pickingService`,void 0),J(this,`attributeUnifoms`,void 0),J(this,`commonUnifoms`,void 0),this.layer=e,this.configService=e.getContainer().globalConfigService,this.rendererService=e.getContainer().rendererService,this.pickingService=e.getContainer().pickingService,this.shaderModuleService=e.getContainer().shaderModuleService,this.styleAttributeService=e.getContainer().styleAttributeService,this.mapService=e.getContainer().mapService,this.iconService=e.getContainer().iconService,this.fontService=e.getContainer().fontService,this.cameraService=e.getContainer().cameraService,this.layerService=e.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();let{createTexture2D:t}=this.rendererService;this.createTexture2D=t}getBlend(){let{blend:e=`normal`}=this.layer.getLayerConfig();return NP[$v[e]]}getStencil(e){let{mask:t=!1,maskInside:n=!0,enableMask:r,maskOperation:i=ty.AND}=this.layer.getLayerConfig();return this.layer.type===`MaskLayer`?QP({isStencil:!0,stencilType:ey.SINGLE}):e.isStencil?QP(Y(Y({},e),{},{maskOperation:i})):ZP(t||r&&this.layer.masks.length!==0||this.layer.tileMask!==void 0,n)}getDefaultStyle(){return{}}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();let n=Y(Y({},t.uniformsOption),e.uniformsOption);return Object.keys(n).forEach(e=>{typeof n[e]==`boolean`&&(n[e]=n[e]?1:0)}),!this.rendererService.hasOwnProperty(`device`)&&this.textures&&this.textures.length===1&&(n.u_texture=this.textures[0]),n}getAnimateUniforms(){return{}}needUpdate(){return Z(function*(){return!1})()}buildModels(){return Z(function*(){throw Error(`Method not implemented.`)})()}initModels(){return Z(function*(){throw Error(`Method not implemented.`)})()}clearModels(e=!0){}getAttribute(){throw Error(`Method not implemented.`)}prerender(){}render(e){throw Error(`Method not implemented.`)}registerBuiltinAttributes(){throw Error(`Method not implemented.`)}animateOption2Array(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}startModelAnimate(){let{animateOption:e}=this.layer.getLayerConfig();e.enable&&this.layer.setAnimateStartTime()}getInject(){return cF(this.layer.enableShaderEncodeStyles,this.layer.encodeStyleAttribute)}getDefines(){return Y({},Object.keys(this.attributeLocation).reduce((e,t)=>{let n=lF+t;return e[n]=this.attributeLocation[t],e},{}))}getStyleAttribute(){let e={};return this.layer.enableShaderEncodeStyles.forEach(t=>{if(!this.layer.encodeStyleAttribute[t]){let n=this.layer.getLayerConfig()[t],r=n===void 0?eF[t]:n;t===`stroke`&&(r=Ls(r)),e[`u_`+t]=r}}),e}registerStyleAttribute(){Object.keys(this.layer.encodeStyleAttribute).forEach(e=>{let t=pP(e);t&&this.styleAttributeService.registerStyleAttribute(t)})}registerPosition64LowAttribute(e=!0){this.styleAttributeService.registerStyleAttribute({name:`position64Low`,type:oy.Attribute,descriptor:{name:`a_Position64Low`,shaderLocation:this.attributeLocation.POSITION_64LOW,buffer:{data:[],type:X.FLOAT},size:2,update:(t,n,r)=>e?[ud(r[0]),ud(r[1])]:[0,0]}})}updateEncodeAttribute(e,t){this.encodeStyleAttribute[e]=t}initUniformsBuffer(){let e=this.getUniformsBufferInfo(this.getStyleAttribute()),t=this.getCommonUniformsInfo();e.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(iF(e.uniformsLength)).fill(0),isUBO:!0,label:`layerModelAttributeUnifoms`}),this.uniformBuffers.push(this.attributeUnifoms)),t.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(iF(t.uniformsLength)).fill(0),isUBO:!0,label:`layerModelCommonUnifoms`}),this.uniformBuffers.push(this.commonUnifoms))}getUniformsBufferInfo(e){let t=0,n=[];return Object.values(e).forEach(e=>{Array.isArray(e)?(n.push(...e),t+=e.length):typeof e==`number`?(n.push(e),t+=1):typeof e==`boolean`&&(n.push(Number(e)),t+=1)}),{uniformsOption:e,uniformsLength:t,uniformsArray:n}}getCommonUniformsInfo(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}updateStyleUnifoms(){var e,t;let{uniformsArray:n}=this.getUniformsBufferInfo(this.getStyleAttribute()),{uniformsArray:r}=this.getCommonUniformsInfo();(e=this.attributeUnifoms)==null||e.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),(t=this.commonUnifoms)==null||t.subData({offset:0,data:new Uint8Array(new Float32Array(r).buffer)})}}})),fF,pF,mF,hF,gF,_F=o((()=>{fF=function(e){return e[e.solid=0]=`solid`,e[e.dash=1]=`dash`,e}({}),pF=function(e){return e.VERTICAL=`vertical`,e.HORIZONTAL=`horizontal`,e}({}),mF=function(e){return e.NORMAL=`normal`,e.REPLACE=`replace`,e}({}),hF=function(e){return e[e.pixel=0]=`pixel`,e[e.meter=1]=`meter`,e}({}),gF=function(e){return e.ALWAYS=`always`,e.DRAGEND=`dragend`,e}({})})),vF,yF=o((()=>{vF={canvas2d:`2d`,webgl:`webgl`,webgl2:`webgl2`,webgpu:`webgpu`}})),bF,xF=o((()=>{Py(),ov(),dF(),_F(),yF(),bF=class extends uF{constructor(...e){super(...e),J(this,`canvas`,null),J(this,`ctx`,void 0),J(this,`ctxType`,void 0),J(this,`viewportSize`,void 0),J(this,`initCanvas`,()=>{var e,t;let{zIndex:n,getContext:r}=this.layerConfig,i=document.createElement(`canvas`),a=this.layer.getModelType();this.canvas=i,i.classList.add(`l7-canvas-layer`),i.style.position=`absolute`,i.style.top=`0`,i.style.left=`0`,i.style.zIndex=String(n),this.resetCanvasSize(),((e=this.mapService).getCanvasOverlays?.call(e)??(t=this.mapService).getMapCanvasContainer?.call(t))?.appendChild(i),this.ctx=r?r(i):i.getContext(vF[a]),this.ctx||console.error(`Failed to get rendering context for canvas`),this.bindListeners()}),J(this,`resetViewportSize`,()=>{let{width:e,height:t}=this.rendererService.getViewportSize();this.viewportSize=[e,t]}),J(this,`resetCanvasSize`,()=>{let e=this.canvas;if(!e)return;this.resetViewportSize();let[t,n]=this.mapService.getSize(),[r,i]=this.viewportSize;e.width=r,e.height=i,e.style.width=t+`px`,e.style.height=n+`px`}),J(this,`renderCanvas`,()=>{var e;this.canvas||this.initCanvas();let{draw:t,drawingOnCanvas:n}=this.layerConfig,[r,i]=this.viewportSize,a=this.mapService.getBounds();(e=t??n)==null||e({canvas:this.canvas,ctx:this.ctx,container:{width:r,height:i,bounds:a},size:[r,i],utils:{lngLatToContainer:this.lngLatToContainer},mapService:this.mapService})}),J(this,`removeCanvas`,()=>{if(this.canvas){var e;(e=this.canvas.parentElement)==null||e.removeChild(this.canvas),this.canvas=null}this.unbindListeners()}),J(this,`onMapResize`,()=>{requestAnimationFrame(()=>{this.resetCanvasSize(),this.renderCanvas()})}),J(this,`lngLatToContainer`,e=>{let{x:t,y:n}=this.mapService.lngLatToContainer(e);return{x:t*window.devicePixelRatio,y:n*window.devicePixelRatio}})}get layerConfig(){return this.layer.getLayerConfig()}initModels(){var e=this;return Z(function*(){return e.renderCanvas(),[]})()}bindListeners(){this.mapService.on(`resize`,this.onMapResize);let{trigger:e,update:t}=this.layerConfig;t===gF.ALWAYS||e===`change`?this.mapService.on(`mapchange`,this.renderCanvas):(this.mapService.on(`zoomstart`,this.removeCanvas),this.mapService.on(`zoomend`,this.renderCanvas),this.mapService.on(`movestart`,this.removeCanvas),this.mapService.on(`moveend`,this.renderCanvas))}unbindListeners(){this.mapService.off(`resize`,this.onMapResize),this.mapService.off(`mapchange`,this.renderCanvas),this.mapService.off(`zoomstart`,this.removeCanvas),this.mapService.off(`zoomend`,this.renderCanvas),this.mapService.off(`movestart`,this.removeCanvas),this.mapService.off(`moveend`,this.renderCanvas)}registerBuiltinAttributes(){}}})),SF=o((()=>{xF(),yF()})),CF,wF=o((()=>{cv(),Py(),ov(),XP(),SF(),CF=class extends YP{constructor(...e){super(...e),J(this,`type`,`CanvasLayer`)}getDefaultConfig(){return{zIndex:3,contextType:`canvas2d`,trigger:`change`}}buildModels(){var e=this;return Z(function*(){e.layerModel=new bF(e),yield e.initLayerModels()})()}getModelType(){return this.getLayerConfig().contextType||`canvas2d`}draw(e){return this.updateLayerConfig({draw:e}),this.render(),this}getLayerConfig(){let e=Y(Y({},this.getDefaultConfig()),super.getLayerConfig());return e.zIndex<3&&(e.zIndex=3),e}render(){var e;return(e=this.layerModel)==null||e.renderCanvas(),this}getCanvas(){return this.layerModel?.canvas}show(){let e=this.getCanvas();return e&&(e.style.display=`unset`),this}hide(){let e=this.getCanvas();return e&&(e.style.display=`none`),this}destroy(){this.layerModel.removeCanvas(),super.destroy()}}}));function TF(e){return e/180*Math.acos(-1)}function EF(e){let t=TF(e[0])+Math.PI/2,n=TF(e[1]),r=100+Math.random()*.4,i=r*Math.cos(n)*Math.cos(t);return[r*Math.cos(n)*Math.sin(t),r*Math.sin(n),i]}function DF(e,t){let n=Ky(),r=Ky(),i=lb(0,1,0),a=lb(0,0,0);t||={},e=e===void 0?1:e;let o=2+(t.segments===void 0?32:t.segments),s=2*o,c=[],l=[],u=[],d=[],f=[],p=[];for(let t=0;t<=o;t++){let m=t/o,h=m*Math.PI;for(let t=0;t<=s;t++){let o=t/s,c=o*Math.PI*2;Yy(r),nb(r,r,-h),Yy(n),tb(n,n,c),_b(a,i,r),_b(a,a,n),fb(a,a,-e),u.push(a.slice()),d.push(...a.slice()),mb(a,a),f.push(...a.slice()),p.push([o,1-m]),d.push(o,1-m)}if(t>0){let e=u.length,t=e-2*(s+1);for(;t+s+2<e;t++)c.push([t,t+1,t+s+1]),l.push(t,t+1,t+s+1),c.push([t+s+1,t+1,t+s+2]),l.push(t+s+1,t+1,t+s+2)}}return{cells:c,positions:u,uvs:p,positionsArr:d,indicesArr:l,normalArr:f}}var OF=o((()=>{Rb()}));function kF(e,t,n,r,i){Ab(e,n,r),Nb(e,e),t=Db(-e[1],e[0]);let a=Db(-n[1],n[0]);return[i/Pb(t,a),t]}function AF(e,t){return kb(e,-t[1],t[0])}function jF(e,t,n){return Ib(e,t,n),Nb(e,e),e}function MF(e,t){return e[0]===t[0]&&e[1]===t[1]}var NF,PF,FF,IF,LF,RF=o((()=>{ov(),kp(),Rb(),NF=Eb(),Eb(),PF=Eb(),FF=Eb(),IF=Eb(),LF=class{constructor(e={}){J(this,`complex`,void 0),J(this,`join`,void 0),J(this,`cap`,void 0),J(this,`miterLimit`,void 0),J(this,`thickness`,void 0),J(this,`normal`,void 0),J(this,`lastFlip`,-1),J(this,`miter`,Db(0,0)),J(this,`started`,!1),J(this,`dash`,!1),J(this,`totalDistance`,0),J(this,`currentIndex`,0),this.join=e.join||`miter`,this.cap=e.cap||`butt`,this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}simpleExtrude(e){let t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;let n=e.length,r=t.startIndex;for(let i=1;i<n;i++){let n=e[i-1],a=e[i],o=i<e.length-1?e[i+1]:null,s=this.simpleSegment(t,r,n,a,o);r+=s}if(this.dash)for(let e=0;e<t.positions.length/6;e++)t.positions[e*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}extrude(e){let t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;let n=e.length,r=t.startIndex;for(let i=1;i<n;i++){let n=e[i-1],a=e[i],o=i<e.length-1?e[i+1]:null,s=this.segment(t,r,n,a,o);r+=s}if(this.dash)for(let e=0;e<t.positions.length/6;e++)t.positions[e*6+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}simpleSegment(e,t,n,r,i){let a=0,o=e.indices,s=e.positions,c=e.normals,l=Sd([r[0],r[1]]),u=Sd([n[0],n[1]]);jF(PF,l,u);let d=0;if(this.dash&&(d=this.lineSegmentDistance(l,u),this.totalDistance+=d),this.normal||(this.normal=Eb(),AF(this.normal,PF)),this.started||(this.started=!0,this.extrusions(s,c,n,this.normal,this.thickness,this.totalDistance-d)),o.push(t+0,t+1,t+2),!i)AF(this.normal,PF),this.extrusions(s,c,r,this.normal,this.thickness,this.totalDistance),o.push(...this.lastFlip===1?[t,t+2,t+3]:[t+2,t+1,t+3]),a+=2;else{let e=Sd([i[0],i[1]]);MF(l,e)&&Ab(e,l,Nb(e,jb(e,l,u))),jF(FF,e,l);let[n,d]=kF(IF,Eb(),PF,FF,this.thickness),f=Pb(IF,this.normal)<0?-1:1;this.extrusions(s,c,r,d,n,this.totalDistance),o.push(...this.lastFlip===1?[t,t+2,t+3]:[t+2,t+1,t+3]),f=-1,Ob(this.normal,d),a+=2,this.lastFlip=f}return a}segment(e,t,n,r,i){let a=0,o=e.indices,s=e.positions,c=e.normals,l=this.cap===`square`,u=this.join===`bevel`,d=Sd([r[0],r[1]]),f=Sd([n[0],n[1]]);jF(PF,d,f);let p=0;if(this.dash&&(p=this.lineSegmentDistance(d,f),this.totalDistance+=p),this.normal||(this.normal=Eb(),AF(this.normal,PF)),!this.started)if(this.started=!0,l){let e=Eb(),t=Eb();Ab(e,this.normal,PF),Ab(t,this.normal,PF),c.push(t[0],t[1],0),c.push(e[0],e[1],0),s.push(n[0],n[1],n[2]|0,this.totalDistance-p,-this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],n[2]|0,this.totalDistance-p,this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,c,n,this.normal,this.thickness,this.totalDistance-p);if(o.push(t+0,t+1,t+2),i){let e=Sd([i[0],i[1]]);MF(d,e)&&Ab(e,d,Nb(e,jb(e,d,f))),jF(FF,e,d);let[n,l]=kF(IF,Eb(),PF,FF,this.thickness),p=Pb(IF,this.normal)<0?-1:1,m=u;!m&&this.join===`miter`&&n>this.miterLimit&&(m=!0),m?(c.push(this.normal[0],this.normal[1],0),c.push(l[0],l[1],0),s.push(r[0],r[1],r[2]|0,this.totalDistance,-this.thickness*p,r[2]|0),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],r[2]|0,this.totalDistance,this.thickness*p,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o.push(...this.lastFlip===-p?[t+2,t+1,t+3]:[t,t+2,t+3]),o.push(t+2,t+3,t+4),AF(NF,FF),Ob(this.normal,NF),c.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],r[2]|0,this.totalDistance,-this.thickness*p,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a+=3):(this.extrusions(s,c,r,l,n,this.totalDistance),o.push(...this.lastFlip===1?[t,t+2,t+3]:[t+2,t+1,t+3]),p=-1,Ob(this.normal,l),a+=2),this.lastFlip=p}else{if(AF(this.normal,PF),l){let e=Eb(),t=Eb();Ib(t,PF,this.normal),Ab(e,PF,this.normal),c.push(t[0],t[1],0),c.push(e[0],e[1],0),s.push(r[0],r[1],r[2]|0,this.totalDistance,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],r[2]|0,this.totalDistance,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,c,r,this.normal,this.thickness,this.totalDistance);o.push(...this.lastFlip===1?[t,t+2,t+3]:[t+2,t+1,t+3]),a+=2}return a}extrusions(e,t,n,r,i,a){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],n[2]|0,a,-i,n[2]|0),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],n[2]|0,a,i,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}lineSegmentDistance(e,t){let n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}}));function zF(e,t=0){let n=Math.PI*2/e,r=[];for(let i=0;i<e;i++)r.push(n*i+t*Math.PI/12);return r.map(e=>[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0])}function BF(){return zF(30)}function VF(){return zF(4)}function HF(){return zF(3)}function UF(){return zF(6,1)}function WF(){return zF(5)}var GF,KF,qF,JF=o((()=>{GF=function(e){return e.CYLINDER=`cylinder`,e.SQUARECOLUMN=`squareColumn`,e.TRIANGLECOLUMN=`triangleColumn`,e.HEXAGONCOLUMN=`hexagonColumn`,e.PENTAGONCOLUMN=`pentagonColumn`,e}({}),KF=function(e){return e.CIRCLE=`circle`,e.SQUARE=`square`,e.TRIANGLE=`triangle`,e.HEXAGON=`hexagon`,e.PENTAGON=`pentagon`,e}({}),qF={[KF.CIRCLE]:BF,[KF.HEXAGON]:UF,[KF.TRIANGLE]:HF,[KF.SQUARE]:VF,[KF.PENTAGON]:WF,[GF.CYLINDER]:BF,[GF.HEXAGONCOLUMN]:UF,[GF.TRIANGLECOLUMN]:HF,[GF.SQUARECOLUMN]:VF,[GF.PENTAGONCOLUMN]:WF}}));function YF(e){let t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));let r=e[0].length,i=$F.default.flatten(e),{vertices:a,dimensions:o}=i,s=[],c=[];for(let e=0;e<a.length/o;e++)o===2?s.push(a[e*2],a[e*2+1],1):s.push(a[e*3],a[e*3+1],1);let l=(0,$F.default)(i.vertices,i.holes,i.dimensions);c.push(...l);for(let e=0;e<r;e++){let t=i.vertices.slice(e*o,(e+1)*o),n=i.vertices.slice((e+1)*o,(e+2)*o);n.length===0&&(n=i.vertices.slice(0,o));let r=s.length/3;s.push(t[0],t[1],1,n[0],n[1],1,t[0],t[1],0,n[0],n[1],0),c.push(...[0,2,1,2,3,1].map(e=>e+r))}return{positions:s,index:c}}function XF(e){let t=$F.default.flatten(e),n=(0,$F.default)(t.vertices,t.holes,t.dimensions);return{positions:t.vertices,index:n}}function ZF(e,t=!1){let n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));let i=e[0].length,a=$F.default.flatten(e),{vertices:o,dimensions:s,holes:c}=a,l=[],u=[],d=[];for(let e=0;e<o.length/s;e++)l.push(o[e*s],o[e*s+1],1,-1,-1),d.push(0,0,1);let f=aF(o,c,s,t);u.push(...f);for(let e=0;e<i;e++){let n=a.vertices.slice(e*s,(e+1)*s),r=a.vertices.slice((e+1)*s,(e+2)*s);r.length===0&&(r=a.vertices.slice(0,s));let i=l.length/5;l.push(n[0],n[1],1,0,0,r[0],r[1],1,.1,0,n[0],n[1],0,0,.8,r[0],r[1],0,.1,.8);let o=QF([r[0],r[1],1],[n[0],n[1],0],[n[0],n[1],1],t);d.push(...o,...o,...o,...o),u.push(...[1,2,0,3,2,1].map(e=>e+i))}return{positions:l,index:u,normals:d}}function QF(e,t,n,r=!1){let i=cb(),a=cb(),o=cb();r&&(e=_d(e),t=_d(t),n=_d(n));let s=lb(...e),c=lb(...t),l=lb(...n);yb(i,l,c),yb(a,s,c),gb(o,i,a);let u=cb();return mb(u,o),u}var $F,eI=o((()=>{kp(),$F=u(rF()),Rb(),sF()}));function tI(e){let t=Rd(e.coordinates);return{vertices:[...t,...t,...t,...t],indices:[0,1,2,2,3,0],size:t.length}}function nI(e){let t=EF(Rd(e.coordinates));return{vertices:[...t,...t,...t,...t],indices:[0,1,2,2,3,0],size:t.length}}function rI(e){let{shape:t}=e,{positions:n,index:r,normals:i}=vI(t,!1);return{vertices:n,indices:r,normals:i,size:5}}function iI(e){let t=Rd(e.coordinates);return{vertices:[...t],indices:[0],size:t.length}}function aI(e){let{coordinates:t}=e,n=new LF({dash:!0,join:`bevel`}),r=t;r[0]&&!Array.isArray(r[0][0])&&(r=[t]),r.forEach(e=>{n.extrude(e)});let i=n.complex;return{vertices:i.positions,indices:i.indices,normals:i.normals,indexes:i.indexes,size:6}}function oI(e){let{coordinates:t}=e,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};let{results:r,totalDistance:i}=lI(t);return r.map(e=>{n.push(e[0],e[1],e[2],e[3],0,i)}),{vertices:n,indices:[],normals:[],size:6,count:r.length}}function sI(e,t){let n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function cI(e,t){return e.length<3&&e.push(0),t!==void 0&&e.push(t),e}function lI(e){let t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());let n=0;if(t.length<2)return{results:t,totalDistance:0};{let e=[],r=cI(t[0],n);e.push(r);for(let r=1;r<t.length-1;r++){let i=sI(Sd(t[r-1]),Sd(t[r]));n+=i;let a=cI(t[r],n);e.push(a),e.push(a)}let i=sI(Sd(t[t.length-2]),Sd(t[t.length-1]));return n+=i,e.push(cI(t[t.length-1],n)),{results:e,totalDistance:n}}}function uI(e){let{coordinates:t}=e,{vertices:n,dimensions:r,holes:i}=CI.default.flatten(t);return{indices:aF(n,i,r),vertices:n,size:r}}function dI(e){let{indices:t,vertices:n,size:r}=uI(e);return{indices:t,vertices:fI(n),size:r+4}}function fI(e){let t=[],{center:n,radius:r}=zd(e);for(let i=0;i<e.length;i+=2){let a=e[i],o=e[i+1];t.push(a,o,0,...n,r)}return t}function pI(e){let t=e.coordinates,{positions:n,index:r,normals:i}=ZF(t,!0);return{vertices:n,indices:r,normals:i,size:5}}function mI(e){let{shape:t}=e,{positions:n,index:r}=yI(t);return{vertices:n,indices:r,size:3}}function hI(e){let t=e.coordinates;return{vertices:[...t[0],0,0,0,...t[1],0,1,0,...t[2],0,1,1,...t[3],0,0,1],indices:[0,1,2,0,2,3],size:5}}function gI(e,t){let{segmentNumber:n=30}=t,r=e.coordinates,i=[],a=[];for(let e=0;e<n;e++)i.push(e,1,e,r[0][0],r[0][1],r[1][0],r[1][1],e,-1,e,r[0][0],r[0][1],r[1][0],r[1][1]),e!==n-1&&a.push(...[0,1,2,1,3,2].map(t=>e*2+t));return{vertices:i,indices:a,size:7}}function _I(e){let t=e.coordinates;t.length===2&&t.push(0);let n=bI(-1,1),r=bI(1,1),i=bI(-1,-1),a=bI(1,-1);return{vertices:[...t,...n,...t,...i,...t,...a,...t,...r],indices:[0,1,2,3,0,2],size:5}}function vI(e,t=!1){if(wI&&wI[e])return wI[e];let n=ZF([qF[e]?qF[e]():qF.cylinder()],t);return wI[e]=n,n}function yI(e){let t=[`cylinder`,`triangleColumn`,`hexagonColumn`,`squareColumn`],n=qF[e]?qF[e]():qF.circle();return t.indexOf(e)===-1?XF([n]):YF([n])}function bI(e,t){return[(e+1)/2,(t+1)/2]}function xI(){let{positionsArr:e,indicesArr:t,normalArr:n}=DF(100,{segments:36});return{vertices:e,indices:t,size:5,normals:n}}function SI(){let{positionsArr:e,indicesArr:t,normalArr:n}=DF(140,{segments:36});return{vertices:e,indices:t,size:5,normals:n}}var CI,wI,TI=o((()=>{kp(),CI=u(rF()),OF(),RF(),JF(),eI(),sF(),wI={}})),EI,DI,OI,kI=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),EI=`precision highp float;
layout(std140) uniform commonUniforms {
  vec4 u_baseColor: [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor: [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor: [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near: 0;
  float u_far: 1;
  float u_time;
};
in vec4 v_Color;
in vec2 v_texCoord;
in float v_worldDis;
out vec4 outputColor;

#pragma include "picking"
#pragma include "scene_uniforms"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  outputColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //顶部颜色
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       outputColor = vec4( foggedColor, v_Color.w);
  }else { // 侧面颜色
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // 将窗户颜色和墙面颜色区别开来
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // 顶部亮线
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        outputColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    outputColor.rgb += r * r * u_circleSweepColor.rgb;
  }

  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,DI=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

out vec2 v_texCoord;
out vec4 v_Color;
out float v_worldDis;

layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,OI=class extends uF{constructor(...e){super(...e),J(this,`cityCenter`,void 0),J(this,`cityMinSize`,void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getCommonUniformsInfo(){let{opacity:e=1,baseColor:t=`rgb(16,16,16)`,brightColor:n=`rgb(255,176,38)`,windowColor:r=`rgb(30,60,89)`,time:i=0,sweep:a={enable:!1,sweepRadius:1,sweepColor:`rgb(255, 255, 255)`,sweepSpeed:.4,sweepCenter:this.cityCenter}}=this.layer.getLayerConfig(),o={u_baseColor:Ls(t),u_brightColor:Ls(n),u_windowColor:Ls(r),u_circleSweepColor:[...Ls(a.sweepColor).slice(0,3),1],u_cityCenter:a.sweepCenter||this.cityCenter,u_circleSweep:a.enable?1:0,u_cityMinSize:this.cityMinSize*a.sweepRadius,u_circleSweepSpeed:a.sweepSpeed,u_opacity:e,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||i};return this.getUniformsBufferInfo(o)}calCityGeo(){let[e,t,n,r]=this.layer.getSource().extent,i=n-e,a=r-t;this.cityCenter=[(n+e)/2,(r+t)/2],this.cityMinSize=Math.sqrt(i**2+a**2)/4}initModels(){var e=this;return Z(function*(){return e.calCityGeo(),e.initUniformsBuffer(),e.startModelAnimate(),e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return[yield e.layer.buildLayerModel({moduleName:`cityBuilding`,vertexShader:DI,fragmentShader:EI,triangulation:pI,depth:{enable:!0},defines:e.getDefines(),inject:e.getInject(),cull:{enable:!0,face:X.BACK}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=10}=e;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}}})),AI,jI=o((()=>{Py(),ov(),XP(),kI(),AI=class extends YP{constructor(...e){super(...e),J(this,`type`,`CityBuildingLayer`)}buildModels(){var e=this;return Z(function*(){e.layerModel=new OI(e),yield e.initLayerModels()})()}setLight(e){this.updateLayerConfig({time:e})}getModelType(){return`citybuilding`}}})),MI,NI,PI,FI=o((()=>{Py(),cv(),ov(),UC(),dF(),MI=`layout(std140) uniform commonUniforms {
  vec2 u_size;
  float u_raisingHeight;
  float u_rotation;
  float u_opacity;
};

uniform sampler2D u_texture;

in vec2 v_uv;
out vec4 outputColor;

#pragma include "picking"
void main() {
  outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));
  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,NI=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_size;
  float u_raisingHeight;
  float u_rotation;
  float u_opacity;
};

out vec2 v_uv;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"
void main() {
  vec3 extrude = a_Extrude;
  v_uv = a_Uv;
  float raiseHeight = u_raisingHeight;
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  // 计算经纬度点位坐标
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  // 计算绕 z 轴旋转后的偏移
  vec2 offsetXY = project_pixel(rotate_matrix(vec2(extrude.x * u_size.x, 0.0), u_rotation));
  // 绕 z 轴旋转
  float x = project_pos.x + offsetXY.x;
  float y = project_pos.y + offsetXY.y;
  // z 轴不参与旋转
  float z = project_pixel(extrude.y * u_size.y + raiseHeight);

  gl_Position = project_common_position_to_clipspace(vec4(x, y, z, 1.0));

  setPickingColor(a_PickingColor);
}
`,PI=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`radian`,0),J(this,`planeGeometryTriangulation`,()=>{let{center:e=[120,30]}=this.layer.getLayerConfig();return{size:4,indices:[0,1,2,2,3,0],vertices:[...e,...[1,1],...e,...[0,1],...e,...[0,0],...e,...[1,0]]}})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,EXTRUDE:9,UV:10})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{opacity:e,width:t=1,height:n=1,raisingHeight:r=0}=this.layer.getLayerConfig(),i=1;this.mapService.getType()===`amap`&&(i=-1),this.radian=i*Math.PI*(this.mapService.getRotation()%360)/180;let a={u_size:[t,n],u_raisingHeight:Number(r),u_rotation:this.radian,u_opacity:e||1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}clearModels(){var e;(e=this.texture)==null||e.destroy()}initModels(){var e=this;return Z(function*(){let{drawCanvas:t}=e.layer.getLayerConfig(),{createTexture2D:n}=e.rendererService;return e.texture=n({height:0,width:0}),t&&e.updateTexture(t),e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`geometryBillboard`,vertexShader:NI,fragmentShader:MI,triangulation:e.planeGeometryTriangulation,defines:e.getDefines(),inject:e.getInject(),primitive:X.TRIANGLES,depth:{enable:!0}})]})()}buildModels(){var e=this;return Z(function*(){return e.initModels()})()}updateTexture(e){let{createTexture2D:t}=this.rendererService,{canvasWidth:n=1,canvasHeight:r=1}=this.layer.getLayerConfig(),i=document.createElement(`canvas`);i.width=n,i.height=r,i.getContext(`2d`)&&(e(i),this.texture=t({data:i,width:i.width,height:i.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE}),this.layerService.reRender())}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`extrude`,type:oy.Attribute,descriptor:{name:`a_Extrude`,shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r)=>{let i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=r%4*3;return[i[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[2],n[3]]}})}}})),II,LI,RI,zI=o((()=>{Py(),cv(),ov(),UC(),dF(),II=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_mapFlag;
  float u_terrainClipHeight;
};

in vec3 v_Color;
in vec2 v_uv;
in float v_clip;
out vec4 outputColor;

#pragma include "picking"
void main() {
  if (u_mapFlag > 0.0) {
    outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));
    outputColor.a *= u_opacity;
  } else {
    outputColor = vec4(v_Color, u_opacity);
  }
  outputColor.a *= v_clip;
  outputColor = filterColor(outputColor);
}
`,LI=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec3 a_Color;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_mapFlag;
  float u_terrainClipHeight;
};

out vec3 v_Color;
out vec2 v_uv;
out float v_clip;

#pragma include "projection"
#pragma include "picking"
void main() {
  v_Color = a_Color;
  v_uv = a_Uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  v_clip = 1.0;
  if (a_Position.z < u_terrainClipHeight) {
    v_clip = 0.0;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));

  setPickingColor(a_PickingColor);
}
`,RI=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`terrainImage`,void 0),J(this,`terrainImageLoaded`,!1),J(this,`mapTexture`,void 0),J(this,`planeGeometryTriangulation`,()=>{let{width:e=1,height:t=1,widthSegments:n=1,heightSegments:r=1,center:i=[120,30],terrainTexture:a,rgb2height:o=(e,t,n)=>e+t+n}=this.layer.getLayerConfig(),{indices:s,positions:c}=this.initPlane(e,t,n,r,...i);return a?this.translateVertex(c,s,this.terrainImage,n,r,o):{vertices:c,indices:s,size:5}})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:10})}initPlane(e=1,t=1,n=1,r=1,i=120,a=30){let o=e/2,s=t/2,c=Math.floor(n),l=Math.floor(r),u=c+1,d=l+1,f=e/c,p=t/l,m=[],h=[];for(let e=0;e<d;e++){let t=e*p-s;for(let n=0;n<u;n++){let r=n*f-o;h.push(r+i,-t+a,0),h.push(n/c),h.push(1-e/l)}}for(let e=0;e<l;e++)for(let t=0;t<c;t++){let n=t+u*e,r=t+u*(e+1),i=t+1+u*(e+1),a=t+1+u*e;m.push(n,r,a),m.push(r,i,a)}return{indices:m,positions:h}}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{opacity:e,mapTexture:t,terrainClipHeight:n=0,terrainTexture:r}=this.layer.getLayerConfig();if(this.mapTexture!==t){var i;this.mapTexture=t,(i=this.texture)==null||i.destroy(),this.updateTexture(t)}let a={u_opacity:e||1,u_mapFlag:t?1:0,u_terrainClipHeight:r?n:-1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}clearModels(){var e;this.terrainImage=null,(e=this.texture)==null||e.destroy(),this.textures=[]}initModels(){var e=this;return Z(function*(){let{mapTexture:t,terrainTexture:n}=e.layer.getLayerConfig();e.mapTexture=t;let{createTexture2D:r}=e.rendererService;return e.texture=r({height:0,width:0}),e.updateTexture(t),e.initUniformsBuffer(),n&&(e.terrainImage=yield e.loadTerrainImage(n)),[yield e.layer.buildLayerModel({moduleName:`geometryPlane`,vertexShader:LI,fragmentShader:II,triangulation:e.planeGeometryTriangulation,defines:e.getDefines(),inject:e.getInject(),primitive:X.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:X.BACK}})]})()}buildModels(){var e=this;return Z(function*(){return e.initModels()})()}createModelData(e){if(e){let{widthSegments:t,heightSegments:n,width:r,height:i}=this.layer.getLayerConfig(),{widthSegments:a,heightSegments:o,width:s,height:c}=e;this.layer.style({widthSegments:a===void 0?t:a,heightSegments:o===void 0?n:o,width:s===void 0?r:s,height:c===void 0?i:c})}let t=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(t,this.planeGeometryTriangulation)}updateTexture(e){let{createTexture2D:t}=this.rendererService;if(e){let n=new Image;n.crossOrigin=`anonymous`,n.onload=()=>{this.texture=t({data:n,width:n.width,height:n.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE}),this.layerService.reRender()},n.src=e}else this.texture=t({width:0,height:0})}getImageData(e){let t=document.createElement(`canvas`),n=t.getContext(`2d`),{width:r,height:i}=e;return t.width=r,t.height=i,n.drawImage(e,0,0,r,i),n.getImageData(0,0,r,i)}translateVertex(e,t,n,r,i,a){let o=n.width,s=n.height,c=this.getImageData(n).data,l=Math.floor(r),u=Math.floor(i),d=l+1,f=u+1,p=o/l,m=s/u;for(let t=0;t<f;t++){let n=Math.floor(t*m)*o;for(let r=0;r<d;r++){let i=(n+Math.floor(r*p))*4,o=c[i],s=c[i+1],l=c[i+2],u=(t*d+r)*5+2;e[u]=a(o,s,l)}}return{vertices:e,indices:t,size:5}}loadTerrainImage(e){var t=this;return Z(function*(){if(t.terrainImage)return t.terrainImageLoaded?t.terrainImage:new Promise(e=>{t.terrainImage.onload=()=>{e(t.terrainImage)}});{let n=new Image;return n.crossOrigin=`anonymous`,new Promise(r=>{n.onload=()=>{t.terrainImageLoaded=!0,r(n),setTimeout(()=>t.layer.emit(`terrainImageLoaded`,null))},n.src=e})}})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}}})),BI,VI,HI,UI,WI=o((()=>{Py(),cv(),ov(),UC(),dF(),BI=`layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_mapFlag;
  float u_Scale;
};
uniform sampler2D u_texture;

in vec3 v_Color;
in float v_d;
out vec4 outputColor;

void main() {
  if (v_d < 0.0) {
    discard;
  }

  if (u_mapFlag > 0.0) {
    outputColor = texture(SAMPLER_2D(u_texture), gl_PointCoord);
    outputColor.a *= u_opacity;
  } else {
    outputColor = vec4(v_Color, u_opacity);
  }
}
`,VI=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec3 a_Color;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_mapFlag;
  float u_Scale;
};

out vec3 v_Color;
out float v_d;

#pragma include "projection"
void main() {
  v_Color = a_Color.xyz;
  v_d = a_Position.z;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));
  gl_PointSize = pow(u_Zoom - 1.0, 2.0) * u_Scale;
}
`,HI=function(e){return e.UP=`up`,e.DOWN=`down`,e}(HI||{}),UI=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`mapTexture`,void 0),J(this,`positions`,void 0),J(this,`indices`,void 0),J(this,`timer`,void 0),J(this,`spriteTop`,void 0),J(this,`spriteUpdate`,void 0),J(this,`spriteAnimate`,void 0),J(this,`planeGeometryUpdateTriangulation`,()=>{let{spriteBottom:e=-10}=this.layer.getLayerConfig(),t=this.spriteUpdate,n=e,r=this.spriteTop;for(let e=0;e<this.positions.length;e+=5)this.spriteAnimate===HI.UP?(this.positions[e+2]+=t,this.positions[e+2]>r&&(this.positions[e+2]=n)):(this.positions[e+2]-=t,this.positions[e+2]<n&&(this.positions[e+2]=r));return{vertices:this.positions,indices:this.indices,size:5}}),J(this,`updatePosition`,()=>{this.planeGeometryUpdateTriangulation();let e=this.styleAttributeService.getLayerStyleAttribute(`position`)?.vertexAttribute;if(e){let t=[];for(let e=0;e<this.positions.length;e+=5)t.push(this.positions[e],this.positions[e+1],this.positions[e+2]);e.updateBuffer({data:t,offset:0})}this.layerService.throttleRenderLayers(),this.timer=requestAnimationFrame(this.updatePosition)}),J(this,`planeGeometryTriangulation`,()=>{let{center:e=[120,30],spriteCount:t=100,spriteRadius:n=10}=this.layer.getLayerConfig(),{indices:r,positions:i}=this.initSprite(n,t,...e);return this.positions=i,this.indices=r,{vertices:i,indices:r,size:5}})}initSprite(e=10,t=100,n=120,r=30){let i=[],a=[],o=this.spriteAnimate===HI.UP?-this.spriteTop:this.spriteTop;for(let e=0;e<t;e++){let e=Math.random()*o;a.push(...s(e))}for(let e=0;e<t;e++)i.push(e);function s(t){let i=e*Math.random(),a=e*Math.random(),o=-e/2+i,s=-e/2+a;return[o+n,-s+r,t,0,0]}return{indices:i,positions:a}}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{opacity:e,mapTexture:t,spriteScale:n=1}=this.layer.getLayerConfig();if(this.mapTexture!==t){var r;this.mapTexture=t,(r=this.texture)==null||r.destroy(),this.textures=[],this.updateTexture(t)}let i={u_opacity:e||1,u_mapFlag:t?1:0,u_Scale:n,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(i)}clearModels(){var e;cancelAnimationFrame(this.timer),(e=this.texture)==null||e.destroy(),this.textures=[]}initModels(){var e=this;return Z(function*(){let{mapTexture:t,spriteTop:n=300,spriteUpdate:r=10,spriteAnimate:i=HI.DOWN}=e.layer.getLayerConfig();e.initUniformsBuffer(),e.mapTexture=t,e.spriteTop=n,e.spriteUpdate=r,i===`up`?e.spriteAnimate=HI.UP:e.spriteAnimate=HI.DOWN;let{createTexture2D:a}=e.rendererService;return e.texture=a({height:0,width:0}),e.updateTexture(t),setTimeout(()=>{e.updatePosition()},100),[yield e.layer.buildLayerModel({moduleName:`geometrySprite`,vertexShader:VI,fragmentShader:BI,triangulation:e.planeGeometryTriangulation,defines:e.getDefines(),inject:e.getInject(),primitive:X.POINTS,depth:{enable:!1},blend:e.getBlend()})]})()}buildModels(){var e=this;return Z(function*(){return e.initModels()})()}updateTexture(e){let{createTexture2D:t}=this.rendererService;if(e){let n=new Image;n.crossOrigin=`anonymous`,n.onload=()=>{this.texture=t({data:n,width:n.width,height:n.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE}),this.layerService.reRender()},n.src=e}else this.texture=t({width:1,height:1})}registerBuiltinAttributes(){return``}}})),GI,KI=o((()=>{FI(),zI(),WI(),GI={plane:RI,sprite:UI,billboard:PI}})),qI,JI=o((()=>{Py(),ov(),XP(),KI(),qI=class extends YP{constructor(...e){super(...e),J(this,`type`,`GeometryLayer`),J(this,`defaultSourceConfig`,{data:[{x:0,y:0}],options:{parser:{type:`json`,x:`x`,y:`y`}}})}buildModels(){var e=this;return Z(function*(){e.layerModel=new GI[e.getModelType()](e),yield e.initLayerModels()})()}getDefaultConfig(){return{plane:{},sprite:{},billboard:{}}[this.getModelType()]}getModelType(){var e;let t=this.styleAttributeService.getLayerStyleAttribute(`shape`),n=t==null||(e=t.scale)==null?void 0:e.field;return n===`plane`?`plane`:n===`sprite`?`sprite`:n===`billboard`?`billboard`:`plane`}}}));function YI(e,t){return{type:e.type,field:`value`,items:e.positions.map((n,r)=>({[t]:r>=e.colors.length?null:e.colors[r],value:n}))}}var XI=o((()=>{})),ZI,QI,$I,eL=o((()=>{Py(),cv(),UC(),dF(),TI(),ZI=`in vec4 v_color;

#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,QI=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location =  ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage;

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`,$I=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{opacity:e,coverage:t,angle:n}=this.layer.getLayerConfig(),r={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:e||1,u_coverage:t||.9,u_angle:n||0};return this.getUniformsBufferInfo(r)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`heatmapGrid`,vertexShader:QI,fragmentShader:ZI,defines:e.getDefines(),triangulation:mI,primitive:X.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`pos`,type:oy.Attribute,descriptor:{shaderLocation:this.attributeLocation.POS,name:`a_Pos`,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:e=>{let t=e.coordinates;return[t[0],t[1],0]}}})}}})),tL,nL,rL,iL=o((()=>{Py(),cv(),UC(),dF(),TI(),tL=`in vec4 v_color;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,nL=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"

void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度
  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

  float lightWeight = calc_lighting(project_pos);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`,rL=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{opacity:e,coverage:t,angle:n}=this.layer.getLayerConfig(),r={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:e||1,u_coverage:t||.9,u_angle:n||0};return this.getUniformsBufferInfo(r)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`heatmapGrid3d`,vertexShader:nL,fragmentShader:tL,defines:e.getDefines(),triangulation:rI,primitive:X.TRIANGLES,depth:{enable:!0}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:`a_Size`,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t}=e;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`pos`,type:oy.Attribute,descriptor:{name:`a_Pos`,shaderLocation:this.attributeLocation.POS,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:e=>{let t=e.coordinates;return[t[0],t[1],0]}}})}}}));function aL(e,t){let n=[],r=[],i=[],a=e+1,o=t+1,s=e/2,c=t/2;for(let n=0;n<o;n++){let o=n-c;for(let l=0;l<a;l++){let a=l-s;r.push(a/s,-o/c,0),i.push(l/e),i.push(1-n/t)}}for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=t+a*r,i=t+a*(r+1),o=t+1+a*(r+1),s=t+1+a*r;n.push(e,i,s),n.push(i,o,s)}return{vertices:r,indices:n,uvs:i}}var oL=o((()=>{})),sL,cL,lL,uL,dL,fL,pL,mL,hL=o((()=>{cv(),Py(),ov(),UC(),kp(),Rb(),dF(),TI(),oL(),sL=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main() {
  float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0));
  outputColor = color;
  // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
  outputColor.a = color.a * smoothstep(0.0, 0.1, intensity) * u_opacity;
}
`,cL=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
  float t2 = t * t;
  float one_minus_t = 1.0 - t;
  float one_minus_t2 = one_minus_t * one_minus_t;
  return P0 * one_minus_t2 * one_minus_t +
  P1 * 3.0 * t * one_minus_t2 +
  P2 * 3.0 * t2 * one_minus_t +
  P3 * t2 * t;
}
vec2 toBezier(float t, vec4 p) {
  return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点
  vec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点

  vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）
  vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）
  inverseP2 = inverseP2 / inverseP2.w;

  float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
  vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b = vec4(0.5, 0.0, 1.0, 0.5);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.0), 1.0);

}
`,lL=`uniform sampler2D u_texture; // 热力强度图
uniform sampler2D u_colorTexture; // 根据强度分布的色带

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
  float vW = 2.0 / u_ViewportSize.x;
  float vH = 2.0 / u_ViewportSize.y;
  vec2 vUv = v_texCoord;
  float i11 = texture(SAMPLER_2D(u_texture), vec2(vUv.x - 1.0 * vW, vUv.y + 1.0 * vH)).r;
  float i12 = texture(SAMPLER_2D(u_texture), vec2(vUv.x - 0.0 * vW, vUv.y + 1.0 * vH)).r;
  float i13 = texture(SAMPLER_2D(u_texture), vec2(vUv.x + 1.0 * vW, vUv.y + 1.0 * vH)).r;

  float i21 = texture(SAMPLER_2D(u_texture), vec2(vUv.x - 1.0 * vW, vUv.y)).r;
  float i22 = texture(SAMPLER_2D(u_texture), vec2(vUv.x, vUv.y)).r;
  float i23 = texture(SAMPLER_2D(u_texture), vec2(vUv.x + 1.0 * vW, vUv.y)).r;

  float i31 = texture(SAMPLER_2D(u_texture), vec2(vUv.x - 1.0 * vW, vUv.y - 1.0 * vH)).r;
  float i32 = texture(SAMPLER_2D(u_texture), vec2(vUv.x - 0.0 * vW, vUv.y - 1.0 * vH)).r;
  float i33 = texture(SAMPLER_2D(u_texture), vec2(vUv.x + 1.0 * vW, vUv.y - 1.0 * vH)).r;

  return (i11 + i12 + i13 + i21 + i21 + i22 + i23 + i31 + i32 + i33) / 9.0;
}

void main() {
  // float intensity = texture(u_texture, v_texCoord).r;
  float intensity = getBlurIndusty();
  vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
  outputColor = color;
  outputColor.a = color.a * smoothstep(0.0, 0.1, intensity) * u_opacity;
}
`,uL=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
  v_texCoord.y = 1.0 - v_texCoord.y;
  #endif

  gl_Position = vec4(a_Position.xy, 0, 1.0);
}
`,dL=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in vec2 v_extrude;
in float v_weight;
out vec4 outputColor;
#define GAUSS_COEF (0.3989422804014327)

void main() {
  float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
  float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
  outputColor = vec4(val, 1.0, 1.0, 1.0);
}
`,fL=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_DIR) in vec2 a_Dir;

layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;

#define GAUSS_COEF (0.3989422804014327)

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 picking_color_placeholder = u_PickingColor;

  v_weight = a_Size;
  float ZERO = 1.0 / 255.0 / 16.0;
  float extrude_x = a_Dir.x * 2.0 - 1.0;
  float extrude_y = a_Dir.y * 2.0 - 1.0;
  vec2 extrude_dir = normalize(vec2(extrude_x, extrude_y));
  float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
  v_extrude = extrude_dir * S;

  vec2 offset = project_pixel(v_extrude * u_radius);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

}
`,{isEqual:pL}=tu,mL=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`colorTexture`,void 0),J(this,`heatmapFramerBuffer`,void 0),J(this,`heatmapTexture`,void 0),J(this,`intensityModel`,void 0),J(this,`colorModel`,void 0),J(this,`shapeType`,void 0),J(this,`preRampColors`,void 0),J(this,`colorModelUniformBuffer`,[]),J(this,`heat3DModelUniformBuffer`,[])}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10,DIR:11})}prerender(){let{clear:e,useFramebuffer:t}=this.rendererService;t(this.heatmapFramerBuffer,()=>{e({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.heatmapFramerBuffer}),this.drawIntensityMode()})}render(e){let{rampColors:t}=this.layer.getLayerConfig();pL(this.preRampColors,t)||this.updateColorTexture(),this.shapeType===`heatmap`?this.drawHeatMap(e):this.draw3DHeatMap(e)}getUninforms(){throw Error(`Method not implemented.`)}initModels(){var e=this;return Z(function*(){var t;let{createFramebuffer:n,getViewportSize:r,createTexture2D:i}=e.rendererService,a=e.styleAttributeService.getLayerStyleAttribute(`shape`),o=(a==null||(t=a.scale)==null?void 0:t.field)||`heatmap`;e.shapeType=o,e.intensityModel=yield e.buildHeatMapIntensity(),e.colorModel=o===`heatmap`?e.buildHeatmap():e.build3dHeatMap();let{width:s,height:c}=r();return e.heatmapTexture=i({width:Math.floor(s/4),height:Math.floor(c/4),wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.LINEAR,mag:X.LINEAR,usage:Sx.RENDER_TARGET}),e.heatmapFramerBuffer=n({color:e.heatmapTexture,depth:!0,width:Math.floor(s/4),height:Math.floor(c/4)}),e.updateColorTexture(),[e.intensityModel,e.colorModel]})()}buildModels(){var e=this;return Z(function*(){return e.initModels()})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`dir`,type:oy.Attribute,descriptor:{name:`a_Dir`,shaderLocation:this.attributeLocation.DIR,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=1}=e;return[t]}}})}buildHeatMapIntensity(){var e=this;return Z(function*(){return e.uniformBuffers=[e.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],e.layer.triangulation=_I,yield e.layer.buildLayerModel({moduleName:`heatmapIntensity`,vertexShader:fL,fragmentShader:dL,triangulation:_I,defines:e.getDefines(),depth:{enable:!1},cull:{enable:!0,face:X.FRONT}})})()}buildHeatmap(){this.shaderModuleService.registerModule(`heatmapColor`,{vs:uL,fs:lL}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];let{vs:e,fs:t,uniforms:n}=this.shaderModuleService.getModule(`heatmapColor`),{createAttribute:r,createElements:i,createBuffer:a,createModel:o}=this.rendererService;return o({vs:e,fs:t,uniformBuffers:[...this.colorModelUniformBuffer,...this.rendererService.uniformBuffers],attributes:{a_Position:r({shaderLocation:this.attributeLocation.POSITION,buffer:a({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:X.FLOAT}),size:3}),a_Uv:r({shaderLocation:this.attributeLocation.UV,buffer:a({data:[0,1,1,1,0,0,1,0],type:X.FLOAT}),size:2})},uniforms:Y({},n),depth:{enable:!1},elements:i({data:[0,2,1,2,3,1],type:X.UNSIGNED_INT,count:6})})}build3dHeatMap(){let{getViewportSize:e}=this.rendererService,{width:t,height:n}=e(),r=aL(t/4,n/4);this.shaderModuleService.registerModule(`heatmap3dColor`,{vs:cL,fs:sL}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(36).fill(0),isUBO:!0})];let{vs:i,fs:a,uniforms:o}=this.shaderModuleService.getModule(`heatmap3dColor`),{createAttribute:s,createElements:c,createBuffer:l,createModel:u}=this.rendererService;return u({vs:i,fs:a,attributes:{a_Position:s({shaderLocation:this.attributeLocation.POSITION,buffer:l({data:r.vertices,type:X.FLOAT}),size:3}),a_Uv:s({shaderLocation:this.attributeLocation.UV,buffer:l({data:r.uvs,type:X.FLOAT}),size:2})},primitive:X.TRIANGLES,uniformBuffers:[...this.heat3DModelUniformBuffer,...this.rendererService.uniformBuffers],uniforms:Y({},o),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:X.SRC_ALPHA,srcAlpha:1,dstRGB:X.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:c({data:r.indices,type:X.UNSIGNED_INT,count:r.indices.length})})}drawIntensityMode(){var e;let{intensity:t=10,radius:n=5}=this.layer.getLayerConfig(),r={u_radius:n,u_intensity:t};this.uniformBuffers[0].subData({offset:0,data:[n,t]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(e=this.intensityModel)==null||e.draw({uniforms:r,blend:{enable:!0,func:{srcRGB:X.ONE,srcAlpha:1,dstRGB:X.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}drawHeatMap(e){var t;let{opacity:n=1}=this.layer.getLayerConfig(),r={u_opacity:n,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},i=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[n]}),(t=this.colorModel)==null||t.draw({uniforms:r,textures:i,blend:this.getBlend(),stencil:this.getStencil(e)})}draw3DHeatMap(e){var t;let{opacity:n=1}=this.layer.getLayerConfig(),r=Ky();Xy(r,this.cameraService.getViewProjectionMatrixUncentered());let i={u_opacity:n,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:[...r]};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[...i.u_ViewProjectionMatrixUncentered,...i.u_InverseViewProjectionMatrix,n]});let a=[this.heatmapTexture,this.colorTexture];(t=this.colorModel)==null||t.draw({uniforms:i,textures:a,blend:{enable:!0,func:{srcRGB:X.SRC_ALPHA,srcAlpha:1,dstRGB:X.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(e)})}updateColorTexture(){let{createTexture2D:e}=this.rendererService;this.texture&&this.texture.destroy();let{rampColors:t}=this.layer.getLayerConfig(),n=Bs(t);this.colorTexture=e({data:n.data,usage:Sx.SAMPLED,width:n.width,height:n.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.NEAREST,mag:X.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=t}}})),gL,_L,vL,yL=o((()=>{Py(),cv(),UC(),dF(),TI(),gL=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,_L=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);

  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,vL=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{opacity:e,coverage:t,angle:n}=this.layer.getLayerConfig(),r={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:e||1,u_coverage:t||.9,u_angle:n||0};return this.getUniformsBufferInfo(r)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`heatmapHexagon`,vertexShader:_L,fragmentShader:gL,defines:e.getDefines(),triangulation:mI,depth:{enable:!1},primitive:X.TRIANGLES})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`pos`,type:oy.Attribute,descriptor:{name:`a_Pos`,shaderLocation:this.attributeLocation.POS,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:e=>{let t=e.coordinates;return[t[0],t[1],0]}}})}}})),bL,xL=o((()=>{eL(),iL(),hL(),yL(),bL={heatmap:mL,heatmap3d:mL,grid:$I,grid3d:rL,hexagon:vL}})),SL,CL=o((()=>{Py(),ov(),XP(),XI(),xL(),SL=class extends YP{constructor(...e){super(...e),J(this,`type`,`HeatMapLayer`)}buildModels(){var e=this;return Z(function*(){e.layerModel=new bL[e.getModelType()](e),yield e.initLayerModels()})()}prerender(){this.getModelType()===`heatmap`&&this.layerModel&&this.layerModel.prerender()}renderModels(e={}){return this.getModelType()===`heatmap`?(this.layerModel&&this.layerModel.render(e),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(t=>t.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(e)})),this.hooks.afterRender.call(),this)}updateModelData(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn(`data error`)}getModelType(){var e;let t=this.styleAttributeService.getLayerStyleAttribute(`shape`),{shape3d:n}=this.getLayerConfig(),r=this.getSource().data.type,i=(t==null||(e=t.scale)==null?void 0:e.field)||`heatmap`;return i===`heatmap`||i===`heatmap3d`?`heatmap`:r===`hexagon`?n?.indexOf(i)===-1?`hexagon`:`grid3d`:r===`grid`?n?.indexOf(i)===-1?`grid`:`grid3d`:`heatmap`}getLegend(e){if(this.getModelType()===`heatmap`){if(e!==`color`)return{type:void 0,field:void 0,items:[]};let t=this.getLayerConfig().rampColors;return YI(t,e)}else return super.getLegend(e)}}})),wL,TL,EL,DL=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),wL=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,TL=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`,EL=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){let{opacity:e,brightness:t,contrast:n,saturation:r,gamma:i}=this.layer.getLayerConfig(),a={u_opacity:Op(e,1),u_brightness:Op(t,1),u_contrast:Op(n,1),u_saturation:Op(r,1),u_gamma:Op(i,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}initModels(){var e=this;return Z(function*(){return yield e.loadTexture(),e.buildModels()})()}clearModels(){var e;(e=this.texture)==null||e.destroy()}loadTexture(){var e=this;return Z(function*(){let{createTexture2D:t}=e.rendererService,n=yield e.layer.getSource().data.images;e.texture=t({data:n[0],width:n[0].width,height:n[0].height,mag:X.LINEAR,min:X.LINEAR})})()}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`rasterImage`,vertexShader:TL,fragmentShader:wL,defines:e.getDefines(),triangulation:hI,primitive:X.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}}})),OL,kL=o((()=>{DL(),OL={image:EL}})),AL,jL=o((()=>{Py(),ov(),XP(),kL(),AL=class extends YP{constructor(...e){super(...e),J(this,`type`,`ImageLayer`)}buildModels(){var e=this;return Z(function*(){e.layerModel=new OL[e.getModelType()](e),yield e.initLayerModels()})()}getDefaultConfig(){return{image:{}}[this.getModelType()]}getModelType(){return`image`}}})),ML,NL,PL,FL,IL=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),ML=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // 运动速度
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // 当存在贴图时在底色上贴上贴图
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // 横向 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,NL=`#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  if (u_lineDir == 1.0) {
    // 正向
    return mid;
  } else {
    // 逆向
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
  //  return index / (segmentNumber - 1.);
}
vec2 interpolate(vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x, t), bezier3(y, t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return dir_screenspace.xy * sign(offset_direction);
}

void main() {
  //vs中计算渐变色
  if (u_linearColor == 1.0) {
    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex / segmentNumber);
  } else {
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source_world = a_Instance.rg; // 起始点
  vec2 target_world = a_Instance.ba; // 终点

  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  // 计算 dashArray 和 distanceRatio 输出到片元
  float total_Distance = pixelDistance(source_world, target_world) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 source = project_position(vec4(source_world, 0, 1.), a_Instance64Low.xy);
  vec4 target = project_position(vec4(target_world, 0, 1.), a_Instance64Low.zw);

  vec2 currPos = interpolate(source.xy, target.xy, segmentRatio, thetaOffset);
  vec2 nextPos = interpolate(source.xy, target.xy, nextSegmentRatio, thetaOffset);

  vec2 offset = project_pixel(
    getExtrusionOffset((nextPos.xy - currPos.xy) * indexDir, a_Position.y)
  );

  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // 开启贴图模式
    float arcDistrance = length(source - target); // 起始点和终点的距离
    arcDistrance = project_pixel(arcDistrance);

    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变
    float texCount = floor(arcDistrance / pixelLen); // 贴图在弧线上重复的数量
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size); // 定点位置偏移
    v_lineData.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值
  }

  gl_Position = project_common_position_to_clipspace(vec4(currPos.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,PL={solid:0,dash:1},FL=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`updateTexture`,()=>{let{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){let{sourceColor:e,targetColor:t,textureBlend:n=`normal`,lineType:r=`solid`,dashArray:i=[10,5],forward:a=!0,lineTexture:o=!1,iconStep:s=100,segmentNumber:c=30}=this.layer.getLayerConfig(),{animateOption:l}=this.layer.getLayerConfig(),u=i;r!==`dash`&&(u=[0,0]),u.length===2&&u.push(0,0);let d=0,f=[0,0,0,0],p=[0,0,0,0];if(e&&t&&(f=Ls(e),p=Ls(t),d=1),this.rendererService.getDirty()){var m;(m=this.texture)==null||m.bind()}let h={u_animate:this.animateOption2Array(l),u_dash_array:u,u_sourceColor:f,u_targetColor:p,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:c,u_lineDir:a?1:-1,u_icon_step:s,u_line_texture:o?1:0,u_textureBlend:n===`normal`?0:1,u_blur:.9,u_line_type:PL[r||`solid`],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:d};return this.getUniformsBufferInfo(h)}initModels(){var e=this;return Z(function*(){return e.updateTexture(),e.iconService.on(`imageUpdate`,e.updateTexture),e.buildModels()})()}clearModels(){var e;(e=this.texture)==null||e.destroy(),this.iconService.off(`imageUpdate`,this.updateTexture)}getShaders(){return{frag:ML,vert:NL,type:``}}buildModels(){var e=this;return Z(function*(){e.initUniformsBuffer();let{segmentNumber:t=30}=e.layer.getLayerConfig(),{frag:n,vert:r,type:i}=e.getShaders();return[yield e.layer.buildLayerModel({moduleName:`lineArc2d`+i,vertexShader:r,fragmentShader:n,defines:e.getDefines(),inject:e.getInject(),triangulation:gI,depth:{enable:!1},styleOption:{segmentNumber:t}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=1}=e;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:`instance`,type:oy.Attribute,descriptor:{name:`a_Instance`,shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:`instance64Low`,type:oy.Attribute,descriptor:{name:`a_Instance64Low`,shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n)=>[ud(n[3]),ud(n[4]),ud(n[5]),ud(n[6])]}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_iconMapUV`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let t=this.iconService.getIconMap(),{texture:n}=e,{x:r,y:i}=t[n]||{x:0,y:0};return[r,i]}}}),this.styleAttributeService.registerStyleAttribute({name:`thetaOffset`,type:oy.Attribute,descriptor:{name:`a_ThetaOffset`,shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{thetaOffset:t=1}=e;return[t]}}})}}})),LL,RL,zL,BL,VL=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),OF(),LL=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec4 v_dash_array;
in float v_segmentIndex;
in vec2 v_iconMapUV;
in vec4 v_line_data;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,RL=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 是为了对齐坐标
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // 手动增加一些偏移，减轻面的冲突
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs中计算渐变色
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0), a_Instance64Low.xy).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0), a_Instance64Low.zw).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // 地球模式
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // 线的偏移
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // 计算起始点和终止点的距离
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // 计算飞线各个节点相应的高度
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // 地球点位
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;

    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }


  setPickingColor(a_PickingColor);
}
`,zL={solid:0,dash:1},BL=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`updateTexture`,()=>{let{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){let{sourceColor:e,targetColor:t,textureBlend:n=`normal`,lineType:r=`solid`,dashArray:i=[10,5],lineTexture:a=!1,iconStep:o=100,segmentNumber:s=30,globalArcHeight:c=10}=this.layer.getLayerConfig(),{animateOption:l}=this.layer.getLayerConfig();i.length===2&&i.push(0,0);let u=0,d=[0,0,0,0],f=[0,0,0,0];if(e&&t&&(d=Ls(e),f=Ls(t),u=1),this.rendererService.getDirty()){var p;(p=this.texture)==null||p.bind()}let m={u_animate:this.animateOption2Array(l),u_dash_array:i,u_sourceColor:d,u_targetColor:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version===`GLOBEL`?1:0,u_globel_radius:100,u_global_height:c,segmentNumber:s,u_line_type:zL[r]||0,u_icon_step:o,u_line_texture:a?1:0,u_textureBlend:n===`normal`?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:u};return this.getUniformsBufferInfo(m)}initModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),e.updateTexture(),e.iconService.on(`imageUpdate`,e.updateTexture),e.buildModels()})()}clearModels(){var e;(e=this.texture)==null||e.destroy(),this.iconService.off(`imageUpdate`,this.updateTexture)}getShaders(){return{frag:LL,vert:RL,type:``}}buildModels(){var e=this;return Z(function*(){let{segmentNumber:t=30}=e.layer.getLayerConfig(),{frag:n,vert:r,type:i}=e.getShaders();return[yield e.layer.buildLayerModel({moduleName:`lineArc3d`+i,vertexShader:r,fragmentShader:n,defines:e.getDefines(),inject:e.getInject(),triangulation:gI,styleOption:{segmentNumber:t}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=1}=e;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:`instance`,type:oy.Attribute,descriptor:{name:`a_Instance`,shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:`instance64Low`,type:oy.Attribute,descriptor:{name:`a_Instance64Low`,shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n)=>[ud(n[3]),ud(n[4]),ud(n[5]),ud(n[6])]}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_iconMapUV`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let t=this.iconService.getIconMap(),{texture:n}=e,{x:r,y:i}=t[n]||{x:0,y:0};return[r,i]}}}),this.styleAttributeService.registerStyleAttribute({name:`thetaOffset`,type:oy.Attribute,descriptor:{name:`a_ThetaOffset`,shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{thetaOffset:t=1}=e;return[t]}}})}}}));function HL(e,t){let{width:n=2,height:r=1}=t;return{vertices:[0,QL*e,1*e*n,-(r+QL)*e,1*e*n,(r-QL)*e,0,QL*e,1*e*n,-(r+QL)*e,1*e*n,(r-QL)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function UL(e,t){let{width:n=2,height:r=3}=t;return{vertices:[0,0,1*e*n,1*r,1*e*n,-1*r,0,0,1*e*n,1*r,1*e*n,-1*r],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function WL(e,t){let{width:n=2,height:r=2}=t;return{vertices:[0,r/2,e*n*1,r/2,e*n*1,-r/2,0,-r/2,0,r/2,e*n*1,r/2,e*n*1,-r/2,0,-r/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function GL(e,t){let{width:n=2,height:r=3}=t;return{vertices:[0,0,1*n*e,.5*r,2*n*e,0,1*n*e,-.5*r,0,0,1*n*e,.5*r,2*n*e,0,1*n*e,-.5*r],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function KL(e,t){let{width:n=2,height:r=3}=t;return{vertices:[0,0,2*e*n,1*r,1.5*e*n,0,2*e*n,-1*r,0,0,2*e*n,1*r,1.5*e*n,0,2*e*n,-1*r],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function qL(e,t){let{width:n=2,height:r=2}=t,i=BF(),a=XL.default.flatten([i]),o=(0,XL.default)(a.vertices,a.holes,a.dimensions),s=i.map(t=>[t[0]*n*e,t[1]*r]).flat();return{vertices:[...s,...s],dimensions:2,indices:o.map(e=>e+i.length),outLineIndices:o,normals:[...i.map(t=>[t[1]*r,t[0]*n*e,1]).flat(),...Array(i.length*3).fill(0)]}}function JL(e,t=0,n){let r=typeof n.source==`object`?n.source.type:n.source,i=typeof n.target==`object`?n.target.type:n.target,{width:a=r?ZL[r]:0}=typeof n.source==`object`?n.source:{},{width:o=i?ZL[i]:0}=typeof n.target==`object`?n.target:{};return{vertices:[0,QL,1*a,...e,1,QL,-1*o,...e,1,-QL,-1*o,...e,0,-QL,1*a,...e,0,QL,1*a,...e,1,QL,-1*o,...e,1,-QL,-1*o,...e,0,-QL,1*a,...e],outLineIndices:[0,1,2,0,2,3].map(e=>e+t),indices:[4,5,6,4,6,7].map(e=>e+t),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function YL(e,t){let n=typeof e==`object`?e.type:e,r=t===`source`?1:-1,i=typeof e==`object`?e:{};switch(n){case`circle`:return qL(r,i);case`triangle`:return UL(r,i);case`diamond`:return GL(r,i);case`rect`:return WL(r,i);case`classic`:return KL(r,i);case`halfTriangle`:return HL(r,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}var XL,ZL,QL,$L=o((()=>{XL=u(rF()),JF(),ZL={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},QL=1/2}));function eR(e){let t=e.coordinates.flat();return{vertices:[1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t,1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t],normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function tR(e,t){return t?nR(e,t):eR(e)}function nR(e,t){let n=e.coordinates.flat(),{target:r=`classic`,source:i=`circle`}=t,a=rR(YL(i,`source`),n,0,0),o=JL(n,a.vertices.length/7,t),s=rR(YL(r,`target`),n,1,a.vertices.length/7+o.vertices.length/7);return{vertices:[...a.vertices,...o.vertices,...s.vertices],indices:[...a.outLineIndices,...o.outLineIndices,...s.outLineIndices,...a.indices,...o.indices,...s.indices],normals:[...a.normals,...o.normals,...s.normals],size:7}}function rR(e,t,n=1,r=0){let i=[],{vertices:a,indices:o,dimensions:s,outLineIndices:c}=e;for(let e=0;e<a.length;e+=s)i.push(n,a[e+1],a[e],...t);return Y(Y({},e),{},{vertices:i,indices:o.map(e=>e+r),outLineIndices:c.map(e=>e+r)})}var iR=o((()=>{cv(),$L()})),aR,oR,sR,cR=o((()=>{Py(),UC(),kp(),dF(),iR(),aR=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;

// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,oR=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {
  vec2 data = project_pixel(offsets);

  return vec2(data.x, -data.y);
}

vec2 line_dir(vec2 target, vec2 source) {
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}


void main() {
  // 透明度计算
  vec2 source_world = a_Instance.rg; // 起点
  vec2 target_world = a_Instance.ba; // 终点
  vec2 flowlineDir = line_dir(target_world, source_world);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);

  vec2 position = mix(source_world, target_world, a_Position.x);
  vec2 position64Low = mix(a_Instance64Low.rg, a_Instance64Low.ba, a_Position.x);

  float lengthCommon = length(
    project_position(vec4(target_world, 0, 1)) - project_position(vec4(source_world, 0, 1))
  );
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || 高德
  vec2 limitedOffsetDistances = clamp(
    offsetDistances,
    project_pixel(-lengthCommon * 0.2),
    project_pixel(lengthCommon * 0.2)
  );

  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon * 0.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon * 0.2),
    a_Position.x
  );

  vec2 normalsCommon = u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y));

  float gapCommon = -1. * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
      perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0), position64Low);

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));

  setPickingColor(a_PickingColor);
}
`,sR=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,NORMAL:12})}getCommonUniformsInfo(){let{gapWidth:e=2,strokeWidth:t=1,strokeOpacity:n=1}=this.layer.getLayerConfig(),r={u_gap_width:e,u_stroke_width:t,u_stroke_opacity:n};return this.getUniformsBufferInfo(r)}initModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return[yield e.layer.buildLayerModel({moduleName:`flow_line`,vertexShader:oR,fragmentShader:aR,defines:e.getDefines(),inject:e.getInject(),triangulation:tR,styleOption:e.layer.getLayerConfig().symbol,primitive:X.TRIANGLES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let{size:t=1}=e;return Array.isArray(t)?[t[0],t[1]]:[t,0]}}}),this.styleAttributeService.registerStyleAttribute({name:`instance`,type:oy.Attribute,descriptor:{name:`a_Instance`,shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:`instance64Low`,type:oy.Attribute,descriptor:{name:`a_Instance64Low`,shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n)=>[ud(n[3]),ud(n[4]),ud(n[5]),ud(n[6])]}}),this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}})}}})),lR,uR,dR,fR,pR=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),lR=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_dash_array;
in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_line_data;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;

  // 设置弧线的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // 使用 color 方法传入的颜色
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // 实线部分
    } else {
      // 虚线部分
      discard;
    };
  }

  // 设置弧线的动画模式
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // 设置弧线的贴图
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) {
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // 贴图在弧线上重复的数量
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // 设置贴图和底色的叠加模式
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,uR=`#define LineTypeSolid (0.0)
#define LineTypeDash (1.0)
#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps(float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.0);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(mix(source, target, segmentRatio), sqrt(max(0.0, vertex_height)));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}
float getAngularDist(vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) * sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate(vec2 source, vec2 target, float angularDist, float t) {
  if (abs(angularDist - PI) < 0.001) {
    return (1.0 - t) * source + t * target;
  }
  float a = sin((1.0 - t) * angularDist) / sin(angularDist);
  float b = sin(t * angularDist) / sin(angularDist);
  vec2 sin_source = sin(source);
  vec2 cos_source = cos(source);
  vec2 sin_target = sin(target);
  vec2 cos_target = cos(target);
  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
  float z = a * sin_source.y + b * sin_target.y;
  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));

}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if (u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    total_Distance = total_Distance * 16.0; // total_Distance*16.0 调整默认的效果
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if (u_animate.x == Animate) {
    v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0), a_Instance64Low.xy);
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0), a_Instance64Low.zw);

  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序
  if (LineTexture == u_line_texture) {
    float d_arcDistrance = length(source - target);
    d_arcDistrance = project_pixel(d_arcDistrance);

    float d_pixelLen = project_pixel(u_icon_step) / 8.0;
    v_line_data.b = floor(d_arcDistrance / d_pixelLen); // 贴图在弧线上重复的数量

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size); // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,dR={solid:0,dash:1},fR=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`updateTexture`,()=>{let{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12})}getCommonUniformsInfo(){let{sourceColor:e,targetColor:t,textureBlend:n=`normal`,lineType:r=`solid`,dashArray:i=[10,5],lineTexture:a=!1,iconStep:o=100,segmentNumber:s=30}=this.layer.getLayerConfig(),{animateOption:c}=this.layer.getLayerConfig();if(i.length===2&&i.push(0,0),this.rendererService.getDirty()){var l;(l=this.texture)==null||l.bind()}let u=0,d=[0,0,0,0],f=[0,0,0,0];e&&t&&(d=Ls(e),f=Ls(t),u=1);let p=this.layer.getLayerAnimateTime();isNaN(p)&&(p=0);let m={u_animate:this.animateOption2Array(c),u_dash_array:i,u_sourceColor:d,u_targetColor:f,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:s,u_line_type:dR[r]||0,u_icon_step:o,u_line_texture:a?1:0,u_textureBlend:n===`normal`?0:1,u_time:p,u_linearColor:u};return this.getUniformsBufferInfo(m)}initModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),e.updateTexture(),e.iconService.on(`imageUpdate`,e.updateTexture),e.buildModels()})()}clearModels(){var e;(e=this.texture)==null||e.destroy(),this.iconService.off(`imageUpdate`,this.updateTexture)}buildModels(){var e=this;return Z(function*(){let{segmentNumber:t=30}=e.layer.getLayerConfig();return[yield e.layer.buildLayerModel({moduleName:`lineGreatCircle`,vertexShader:uR,fragmentShader:lR,triangulation:gI,styleOption:{segmentNumber:t},defines:e.getDefines(),inject:e.getInject(),depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=1}=e;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:`instance`,type:oy.Attribute,descriptor:{name:`a_Instance`,shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:`instance64Low`,type:oy.Attribute,descriptor:{name:`a_Instance64Low`,shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n)=>[ud(n[3]),ud(n[4]),ud(n[5]),ud(n[6])]}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_iconMapUV`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let t=this.iconService.getIconMap(),{texture:n}=e,{x:r,y:i}=t[n]||{x:0,y:0};return[r,i]}}})}}})),mR,hR,gR,_R=o((()=>{Py(),ov(),UC(),kp(),dF(),_F(),TI(),mR=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // 虚线部分
      discard;
    };
  }
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // 使用 color 方法传入的颜色
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // 当前顶点的距离
    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // 绘制 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // 外侧
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,hR=`#define Animate (0.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_INDEX) in vec3 a_DistanceAndIndexAndMiter;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec4 a_Normal_Total_Distance;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash输出
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - 数据纹理映射部分的计算
  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * a_Normal;

  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）
  float linePixelSize = project_pixel(a_Size.x) * 2.0; // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2
  float texV = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值

  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // 设置数据集的参数

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height
  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]

  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // 保持高度相对不变
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    h *= mapboxZoomScale;
    h += u_raisingHeight * mapboxZoomScale;
    if (u_heightfixed > 0.0) {
      lineHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(
    vec4(project_pos.xy + offset, lineHeight + h, 1.0)
  );

  setPickingColor(a_PickingColor);
}
`,gR=class extends uF{constructor(...e){super(...e),J(this,`textureEventFlag`,!1),J(this,`texture`,this.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),J(this,`updateTexture`,()=>{let{createTexture2D:e}=this.rendererService;if(this.textures.length===0&&(this.textures=[this.texture]),this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,DISTANCE_INDEX:10,NORMAL:11,UV:12})}getCommonUniformsInfo(){let{sourceColor:e,targetColor:t,textureBlend:n=`normal`,lineType:r=`solid`,dashArray:i=[10,5,0,0],lineTexture:a=!1,iconStep:o=100,vertexHeightScale:s=20,strokeWidth:c=0,raisingHeight:l=0,heightfixed:u=!1,linearDir:d=pF.VERTICAL,blur:f=[1,1,1,0]}=this.layer.getLayerConfig(),p=i;if(r!==`dash`&&(p=[0,0,0,0]),p.length===2&&p.push(0,0),this.rendererService.getDirty()&&this.texture){var m;(m=this.texture)==null||m.bind()}let{animateOption:h}=this.layer.getLayerConfig(),g=0,_=[0,0,0,0],v=[0,0,0,0];e&&t&&(_=Ls(e),v=Ls(t),g=1);let y={u_animate:this.animateOption2Array(h),u_dash_array:p,u_blur:f,u_sourceColor:_,u_targetColor:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:o,u_heightfixed:Number(u),u_vertexScale:s,u_raisingHeight:Number(l),u_strokeWidth:c,u_textureBlend:n===mF.NORMAL?0:1,u_line_texture:a?1:0,u_linearDir:d===pF.VERTICAL?1:0,u_linearColor:g,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(y)}initModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),e.textureEventFlag||(e.textureEventFlag=!0,e.updateTexture(),e.iconService.on(`imageUpdate`,e.updateTexture)),e.buildModels()})()}clearModels(){var e;(e=this.texture)==null||e.destroy(),this.iconService.off(`imageUpdate`,this.updateTexture)}buildModels(){var e=this;return Z(function*(){let{depth:t=!1}=e.layer.getLayerConfig(),{frag:n,vert:r,type:i}=e.getShaders();return e.layer.triangulation=aI,[yield e.layer.buildLayerModel({moduleName:`line`+i,vertexShader:r,fragmentShader:n,triangulation:aI,defines:e.getDefines(),inject:e.getInject(),depth:{enable:t}})]})()}getShaders(){return{frag:mR,vert:hR,type:``}}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`distanceAndIndex`,type:oy.Attribute,descriptor:{name:`a_DistanceAndIndexAndMiter`,shaderLocation:this.attributeLocation.DISTANCE_INDEX,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i,a)=>a===void 0?[n[3],10,n[4]]:[n[3],a,n[4]]}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let{size:t=1}=e;return Array.isArray(t)?[t[0],t[1]]:[t,0]}}}),this.styleAttributeService.registerStyleAttribute({name:`normal_total_distance`,type:oy.Attribute,descriptor:{name:`a_Normal_Total_Distance`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n,r,i)=>[...i,n[5]]}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_iconMapUV`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let t=this.iconService.getIconMap(),{texture:n}=e,{x:r,y:i}=t[n]||{x:0,y:0};return[r,i]}}})}}})),vR,yR,bR,xR=o((()=>{Py(),UC(),kp(),dF(),TI(),vR=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // 虚线部分
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // 全局透明度
  }
  else{
    outputColor = v_color;
  }
}
`,yR=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash输出
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color;
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况

  float lineHeight = a_SizeDistanceAndTotalDistance.y;
  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // 保持高度相对不变
    h *= 2.0 / pow(2.0, 20.0 - u_Zoom);
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  gl_PointSize = 10.0;

}
`,bR=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getCommonUniformsInfo(){let{sourceColor:e,targetColor:t,lineType:n=`solid`,dashArray:r=[10,5,0,0],vertexHeightScale:i=20}=this.layer.getLayerConfig(),a=r;n!==`dash`&&(a=[0,0,0,0]),a.length===2&&a.push(0,0);let o=0,s=[0,0,0,0],c=[0,0,0,0];e&&t&&(s=Ls(e),c=Ls(t),o=1);let l={u_sourceColor:s,u_targetColor:c,u_dash_array:a,u_vertexScale:i,u_linearColor:o};return this.getUniformsBufferInfo(l)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}getShaders(){return{frag:vR,vert:yR,type:`lineSimpleNormal`}}buildModels(){var e=this;return Z(function*(){e.initUniformsBuffer();let{frag:t,vert:n,type:r}=e.getShaders();return[yield e.layer.buildLayerModel({moduleName:r,vertexShader:n,fragmentShader:t,triangulation:oI,defines:e.getDefines(),inject:e.getInject(),primitive:X.LINES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`sizeDistanceAndTotalDistance`,type:oy.Attribute,descriptor:{name:`a_SizeDistanceAndTotalDistance`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:(e,t,n)=>{let{size:r=1}=e,i=Array.isArray(r)?[r[0],r[1]]:[r,0];return[i[0],i[1],n[3],n[5]]}}})}}})),SR,CR,wR,TR=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),SR=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};


in vec2 v_iconMapUV;
in vec4 v_color;
in float v_blur;
in vec4 v_dataset;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // 使用 color 方法传入的颜色
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // 全局透明度
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // 当前顶点的距离
    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值

    // 计算纹理间隔 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // 计算纹理间隔 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: 判断纹理间隔
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }


  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,CR=`#define Animate 0.0
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_MITER_TOTAL) in vec3 a_Distance_Total_Miter;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};

// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out vec4 v_dataset;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float a_Distance = a_Distance_Total_Miter.x;
  float a_Miter = a_Distance_Total_Miter.y;
  float a_Total_Distance = a_Distance_Total_Miter.z;

  float d_distance_ratio; // 当前点位距离占线总长的比例
  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放

  v_iconMapUV = a_iconMapUV;
  if (u_heightfixed < 1.0) {
    // 高度随 zoom 调整
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }

  if (u_animate.x == Animate || u_linearColor == 1.0) {
    d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0) / 2.0;
  // 设置数据集的参数
  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例
  v_dataset[1] = a_Distance; // 当前顶点的距离
  v_dataset[2] = d_texPixelLen; // 贴图的像素长度，根据地图层级缩放
  v_dataset[3] = miter; // 线图层贴图部分的 v 坐标值 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float originSize = a_Size.x; // 固定高度
  if (u_heightfixed < 1.0) {
    originSize = project_float_meter(a_Size.x); // 高度随 zoom 调整
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // 保持高度相对不变
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    if (u_heightfixed > 0.0) {
      wallHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,wR=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`updateTexture`,()=>{let{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:12,UV:13,DISTANCE_MITER_TOTAL:15})}getCommonUniformsInfo(){let{sourceColor:e,targetColor:t,textureBlend:n=`normal`,heightfixed:r=!1,lineTexture:i=!1,iconStep:a=100,iconStepCount:o=1}=this.layer.getLayerConfig(),{animateOption:s}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var c;(c=this.texture)==null||c.bind()}let l=0,u=[0,0,0,0],d=[0,0,0,0];e&&t&&(u=Ls(e),d=Ls(t),l=1);let f={u_animate:this.animateOption2Array(s),u_sourceColor:u,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:a,u_heightfixed:Number(r),u_linearColor:l,u_line_texture:i?1:0,u_textureBlend:n===`normal`?0:1,u_iconStepCount:o,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(f)}initModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),e.updateTexture(),e.iconService.on(`imageUpdate`,e.updateTexture),e.buildModels()})()}clearModels(){var e;(e=this.texture)==null||e.destroy(),this.iconService.off(`imageUpdate`,this.updateTexture)}buildModels(){var e=this;return Z(function*(){return[yield e.layer.buildLayerModel({moduleName:`lineWall`,vertexShader:CR,fragmentShader:SR,triangulation:aI,defines:e.getDefines(),inject:e.getInject(),depth:{enable:!1},blend:e.getBlend()})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let{size:t=1}=e;return Array.isArray(t)?[t[0],t[1]]:[t,0]}}}),this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`distanceAndTotalAndMiter`,type:oy.Attribute,descriptor:{name:`a_Distance_Total_Miter`,shaderLocation:this.attributeLocation.DISTANCE_MITER_TOTAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n)=>[n[3],n[4],n[5]]}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_iconMapUV`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let t=this.iconService.getIconMap(),{texture:n}=e,{x:r,y:i}=t[n]||{x:0,y:0};return[r,i]}}})}}})),ER,DR=o((()=>{IL(),VL(),cR(),pR(),_R(),xR(),TR(),ER={arc:FL,arc3d:BL,greatcircle:fR,wall:wR,line:gR,simple:bR,flowline:sR,earthArc3d:BL}})),OR,kR=o((()=>{cv(),Py(),ov(),XP(),DR(),OR=class extends YP{constructor(...e){super(...e),J(this,`type`,`LineLayer`),J(this,`enableShaderEncodeStyles`,[`stroke`,`offsets`,`opacity`,`thetaOffset`]),J(this,`arrowInsertCount`,0),J(this,`defaultSourceConfig`,{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:`json`,x:`lng1`,y:`lat1`,x1:`lng2`,y1:`lat2`}}})}buildModels(){var e=this;return Z(function*(){e.layerModel=new ER[e.getModelType()](e),yield e.initLayerModels()})()}getDefaultConfig(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:`additive`},arc:{blend:`additive`},greatcircle:{blend:`additive`},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[this.getModelType()]}getModelType(){var e;if(this.layerType)return this.layerType;let t=this.styleAttributeService.getLayerStyleAttribute(`shape`);return(t==null||(e=t.scale)==null?void 0:e.field)||`line`}processData(e){if(this.getModelType()!==`simple`)return e;let t=[];return e.map(e=>{if(Array.isArray(e.coordinates)&&Array.isArray(e.coordinates[0])&&Array.isArray(e.coordinates[0][0])){let n=Y({},e);e.coordinates.map(e=>{t.push(Y(Y({},n),{},{coordinates:e}))})}else t.push(e)}),t}}}));function AR(e){let t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}var jR,MR,NR,PR=o((()=>{Py(),UC(),dF(),kp(),jR=`layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: 片元到中心点的距离 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: 片元的剪切成圆形
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);

  if (v_innerRadius < 0.99) {
    // 当存在 stroke 且 stroke > 0.01
    float blurWidth = (1.0 - v_blur) / 2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if (fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if (fragmengTocenter > v_innerRadius - blurWidth) {
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // 当不存在 stroke 或 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);

  if (u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,MR=`
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0 / a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  vec2 offset = project_pixel(u_offsets);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,NR=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:`additive`}}getCommonUniformsInfo(){let{blend:e,strokeOpacity:t=1,strokeWidth:n=0,stroke:r=`#fff`}=this.layer.getLayerConfig(),i={u_stroke_color:Ls(r),u_additive:e===`additive`?1:0,u_stroke_opacity:t,u_stroke_width:n};return this.getUniformsBufferInfo(i)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.layer.triangulation=AR,e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`pointSimple`,vertexShader:MR,fragmentShader:jR,defines:e.getDefines(),inject:e.getInject(),triangulation:AR,depth:{enable:!1},primitive:X.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=1}=e;return Array.isArray(t)?[t[0]]:[t]}}})}}})),FR,IR,LR,RR,zR=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),OF(),FR=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // 默认不固定
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // 开启透明度渐变
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,IR=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // 默认不固定
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// 用于将在顶点着色器中计算好的样式值传递给片元


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) +
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - 数据纹理映射部分的计算
  vec3 size = a_Size * a_Position;

  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移
  if(u_heightfixed < 1.0) { // 圆柱体不固定高度
    //
  } else {// 圆柱体固定高度 （ 处理 mapbox ）
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // 圆柱光照效果
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // 设置圆柱的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // 使用 color 方法传入的颜色
     v_color = a_Color;
  }
  v_color.a *= u_opacity;


  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度
  //旋转矩阵mx，创建绕x轴旋转矩阵
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//求解旋转角度余弦值
  float xsin = sin(xRadian);//求解旋转角度正弦值
  mat4 mx = mat4(
    1,0,0,0,
    0,xcos,-xsin,0,
    0,xsin,xcos,0,
    0,0,0,1);

  //旋转矩阵my，创建绕y轴旋转矩阵
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//求解旋转角度余弦值
  float ysin = sin(yRadian);//求解旋转角度正弦值
  mat4 my = mat4(
    ycos,0,-ysin,0,
    0,1,0,0,
    ysin,0,ycos,0,
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);


  setPickingColor(a_PickingColor);
}
`,{isNumber:LR}=tu,RR=class extends uF{constructor(...e){super(...e),J(this,`raiseCount`,0),J(this,`raiseRepeat`,0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getCommonUniformsInfo(){let{animateOption:e={enable:!1,speed:.01,repeat:!1},opacity:t=1,sourceColor:n,targetColor:r,pickLight:i=!1,heightfixed:a=!0,opacityLinear:o={enable:!1,dir:`up`},lightEnable:s=!0}=this.layer.getLayerConfig(),c=0,l=[0,0,0,0],u=[0,0,0,0];if(n&&r&&(l=Ls(n),u=Ls(r),c=1),this.raiseCount<1&&this.raiseRepeat>0&&e.enable){let{speed:t=.01}=e;this.raiseCount+=t,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}let d={u_sourceColor:l,u_targetColor:u,u_linearColor:c,u_pickLight:Number(i),u_heightfixed:Number(a),u_r:e.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:LR(t)?t:1,u_opacitylinear:Number(o.enable),u_opacitylinear_dir:o.dir===`up`?1:0,u_lightEnable:Number(s)};return this.getUniformsBufferInfo(d)}initModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),e.buildModels()})()}buildModels(){var e=this;return Z(function*(){let{animateOption:{repeat:t=1}}=e.layer.getLayerConfig();return e.raiseRepeat=t,[yield e.layer.buildLayerModel({moduleName:`pointEarthExtrude`,vertexShader:IR,fragmentShader:FR,triangulation:rI,depth:{enable:!0},defines:e.getDefines(),inject:e.getInject(),cull:{enable:!0,face:X.FRONT},blend:e.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:e=>{let{size:t}=e;if(t){let e=[];return Array.isArray(t)&&(e=t.length===2?[t[0],t[0],t[1]]:t),Array.isArray(t)||(e=[t,t,t]),e}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`pos`,type:oy.Attribute,descriptor:{name:`a_Pos`,shaderLocation:this.attributeLocation.POS,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:e=>{let t=Rd(e.coordinates);return EF([t[0],t[1]])}}})}}})),BR,VR,HR,UR=o((()=>{Py(),UC(),dF(),TI(),Rb(),BR=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,VR=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}
`,HR=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){let{strokeOpacity:e=1,strokeWidth:t=0,blend:n,blur:r=0}=this.layer.getLayerConfig();this.layer.getLayerConfig();let i={u_additive:n===`additive`?1:0,u_stroke_opacity:e,u_stroke_width:t,u_blur:r};return this.getUniformsBufferInfo(i)}initModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.layer.triangulation=nI,[yield e.layer.buildLayerModel({moduleName:`pointEarthFill`,vertexShader:VR,fragmentShader:BR,triangulation:nI,defines:e.getDefines(),inject:e.getInject(),depth:{enable:!0},blend:e.getBlend()})]})()}animateOption2Array(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`extrude`,type:oy.Attribute,descriptor:{name:`a_Extrude`,shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r)=>{let[i,a,o]=n,s=lb(0,0,1),c=lb(i,0,o),l=i>=0?vb(s,c):Math.PI*2-vb(s,c),u=Math.PI*2-Math.asin(a/100),d=Ky();tb(d,d,l),eb(d,d,u);let f=lb(1,1,0);_b(f,f,d),mb(f,f);let p=lb(-1,1,0);_b(p,p,d),mb(p,p);let m=lb(-1,-1,0);_b(m,m,d),mb(m,m);let h=lb(1,-1,0);_b(h,h,d),mb(h,h);let g=[...f,...p,...m,...h],_=r%4*3;return[g[_],g[_+1],g[_+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=5}=e;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:`shape`,type:oy.Attribute,descriptor:{name:`a_Shape`,shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{shape:t=2}=e;return[this.layer.getLayerConfig().shape2d.indexOf(t)]}}})}}})),WR,GR,KR,qR=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),WR=`in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  // 开启透明度渐变
  // picking
  if (u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,GR=`#define pi (3.1415926535)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec4 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if (x > 0.0 && z > 0.0) {
    return atan(x / z);
  } else if (x > 0.0 && z <= 0.0) {
    return atan(-z / x) + pi / 2.0;
  } else if (x <= 0.0 && z <= 0.0) {
    return pi + atan(x / z); //atan(x/z) +
  } else {
    return atan(z / -x) + pi * 3.0 / 2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y / r);
}

void main() {
  vec3 size = a_Size * a_Position;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移

  if (u_heightfixed < 1.0) {
    // 圆柱体不固定高度
  } else {
    // 圆柱体固定高度 （ 处理 mapbox ）
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      offset *= 4.0 / pow(2.0, 21.0 - u_Zoom);
    }
  }

  vec2 positions = a_Extrude.xy;
  vec2 positions64Low = a_Extrude.zw;
  vec4 project_pos = project_position(vec4(positions, 0.0, 1.0), positions64Low);

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // 圆柱光照效果
  float lightWeight = 1.0;

  if (u_lightEnable > 0.0) {
    // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

  // 设置圆柱的底色
  if (u_linearColor == 1.0) {
    // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a = v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

  if (u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? 1.0 - a_Position.z : a_Position.z;
  }

  gl_Position = project_common_position_to_clipspace(pos);

  setPickingColor(a_PickingColor);
}
`,KR=class extends uF{constructor(...e){super(...e),J(this,`raiseCount`,0),J(this,`raiseRepeat`,0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,NORMAL:11})}getCommonUniformsInfo(){let{animateOption:e={enable:!1,speed:.01,repeat:!1},sourceColor:t,targetColor:n,pickLight:r=!1,heightfixed:i=!1,opacityLinear:a={enable:!1,dir:`up`},lightEnable:o=!0}=this.layer.getLayerConfig(),s=0,c=[0,0,0,0],l=[0,0,0,0];if(t&&n&&(c=Ls(t),l=Ls(n),s=1),this.raiseCount<1&&this.raiseRepeat>0&&e.enable){let{speed:t=.01}=e;this.raiseCount+=t,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}let u={u_pickLight:Number(r),u_heightfixed:Number(i),u_r:e.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:s,u_sourceColor:c,u_targetColor:l,u_opacitylinear:Number(a.enable),u_opacitylinear_dir:a.dir===`up`?1:0,u_lightEnable:Number(o)};return this.getUniformsBufferInfo(u)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){let{depth:t=!0,animateOption:{repeat:n=1}}=e.layer.getLayerConfig();return e.raiseRepeat=n,e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`pointExtrude`,vertexShader:GR,fragmentShader:WR,triangulation:rI,defines:e.getDefines(),inject:e.getInject(),cull:{enable:!0,face:X.FRONT},depth:{enable:t}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:e=>{let{size:t}=e;if(t){let e=[];return Array.isArray(t)&&(e=t.length===2?[t[0],t[0],t[1]]:t),Array.isArray(t)||(e=[t,t,t]),e}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`extrude`,type:oy.Attribute,descriptor:{name:`a_Extrude`,shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:4,update:e=>{let t=Rd(e.coordinates);return[t[0],t[1],ud(t[0]),ud(t[1])]}}})}}})),JR,YR,XR,ZR=o((()=>{Py(),UC(),dF(),TI(),_F(),JR=`layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.0));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(antialiasblur, 0.0, inner_df);

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if (u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if (u_time != -1.0) {
    //wave相关逻辑
    float d = length(v_data.xy);
    if (d > 0.5) {
      discard;
    }
    intensity =
      clamp(cos(d * PI), 0.0, 1.0) *
      clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if (u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity; //wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity; //wave
    outputColor = filterColor(outputColor);
  }
  // 作为 mask 模板时需要丢弃透明的像素
  if (outputColor.a < 0.01) {
    discard;
  }
}
`,YR=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // 透明度计算
   v_stroke = stroke;
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  *  u_meter2coord 在等面积大小的时候设置单位
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);

  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,XR=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){let{strokeOpacity:e=1,strokeWidth:t=0,blend:n,blur:r=0,raisingHeight:i=0,heightfixed:a=!1,unit:o=`pixel`}=this.layer.getLayerConfig(),s=this.getAnimateUniforms().u_time;isNaN(s)&&(s=-1);let c={u_blur_height_fixed:[r,Number(i),Number(a)],u_stroke_width:t,u_additive:n===`additive`?1:0,u_stroke_opacity:e,u_size_unit:hF[o],u_time:s,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(c)}getAnimateUniforms(){let{animateOption:e={enable:!1}}=this.layer.getLayerConfig();return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),tI)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){let{frag:t,vert:n,type:r}=e.getShaders();return e.layer.triangulation=tI,e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:r,vertexShader:n,fragmentShader:t,defines:e.getDefines(),inject:e.getInject(),triangulation:tI,depth:{enable:!1}})]})()}getShaders(){return{frag:JR,vert:YR,type:`pointFill`}}animateOption2Array(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}registerBuiltinAttributes(){let e=this.layer.getLayerConfig().shape2d;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`extrude`,type:oy.Attribute,descriptor:{name:`a_Extrude`,shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r)=>{let i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=r%4*3;return[i[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=5}=e;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:`shape`,type:oy.Attribute,descriptor:{name:`a_Shape`,shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:t=>{let{shape:n=2}=t;return[e.indexOf(n)]}}})}}})),QR,$R,ez,tz=o((()=>{Py(),ov(),UC(),dF(),_F(),TI(),QR=`in vec2 v_uv;// 本身的 uv 坐标
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,$R=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed;
  float u_raisingHeight;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0) / 2.0;
  v_uv.x = 1.0 - v_uv.x;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if (u_size_unit == 1.0) {
    newSize = newSize * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = extrude.xy * newSize + offsets;

  offset = rotate_matrix(offset, rotation);

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,ez=class extends uF{constructor(...e){super(...e),J(this,`meter2coord`,1),J(this,`texture`,void 0),J(this,`isMeter`,!1),J(this,`radian`,0),J(this,`updateTexture`,()=>{let{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:`linear`,min:`linear mipmap nearest`,mipmap:!0}),this.layerService.throttleRenderLayers();return}this.texture=e({data:this.iconService.getCanvas(),mag:X.LINEAR,min:X.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,UV:11})}getCommonUniformsInfo(){let{raisingHeight:e=0,heightfixed:t=!1,unit:n=`pixel`}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var r;(r=this.texture)==null||r.bind()}let i={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(t),u_raisingHeight:Number(e),u_size_unit:hF[n]};return this.getUniformsBufferInfo(i)}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),tI)}initModels(){var e=this;return Z(function*(){return e.iconService.on(`imageUpdate`,e.updateTexture),e.updateTexture(),e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`pointFillImage`,vertexShader:$R,fragmentShader:QR,triangulation:tI,depth:{enable:!1},defines:e.getDefines(),inject:e.getInject(),cull:{enable:!0,face:X.FRONT}})]})()}clearModels(){var e;this.iconService.off(`imageUpdate`,this.updateTexture),(e=this.texture)==null||e.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let t=this.iconService.getIconMap(),{shape:n}=e,{x:r,y:i}=t[n]||{x:-64,y:-64};return[r,i]}}}),this.styleAttributeService.registerStyleAttribute({name:`extrude`,type:oy.Attribute,descriptor:{name:`a_Extrude`,shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r)=>{let i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=r%4*3;return[i[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=5}=e;return Array.isArray(t)?[t[0]]:[t]}}})}}})),nz,rz,iz,az=o((()=>{Py(),cv(),ov(),UC(),dF(),TI(),nz=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main() {
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.0;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // 亮度提取

  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: 去除边缘部分 mipmap 导致的混合变暗
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if (fragmengTocenter >= 0.5) {
    float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
    textureColor.a *= luma;
  }

  if (
    all(lessThan(v_color, vec4(1.0 + 0.00001))) && all(greaterThan(v_color, vec4(1.0 - 0.00001))) ||
    v_color == vec4(1.0)
  ) {
    outputColor = textureColor;
  } else {
    outputColor = step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,rz=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if (u_heightfixed < 1.0) {
    // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,iz=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`updateTexture`,()=>{let{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:`linear`,min:`linear mipmap nearest`,mipmap:!0}),setTimeout(()=>{this.layerService.throttleRenderLayers()});return}this.texture=e({data:this.iconService.getCanvas(),mag:X.LINEAR,min:X.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10})}getUninforms(){if(this.rendererService.getDirty()){var e;(e=this.texture)==null||e.bind()}let t=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},t.uniformsOption),n.uniformsOption)}getCommonUniformsInfo(){let{raisingHeight:e=0,heightfixed:t=!1}=this.layer.getLayerConfig(),n={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(e),u_heightfixed:Number(t),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(n)}initModels(){var e=this;return Z(function*(){return e.iconService.on(`imageUpdate`,e.updateTexture),e.updateTexture(),e.buildModels()})()}clearModels(){var e;(e=this.texture)==null||e.destroy(),this.iconService.off(`imageUpdate`,this.updateTexture)}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`pointImage`,vertexShader:rz,fragmentShader:nz,triangulation:iI,defines:e.getDefines(),inject:e.getInject(),depth:{enable:!1},primitive:X.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=5}=e;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:e=>{let t=this.iconService.getIconMap(),{shape:n}=e,{x:r,y:i}=t[n]||{x:-64,y:-64};return[r,i]}}})}}}));function oz(e){let t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}var sz,cz,lz,uz=o((()=>{Py(),UC(),dF(),sz=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}
`,cz=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(project_pos);

  gl_PointSize = a_Size * u_size_scale * 2.0 * u_DevicePixelRatio;
}
`,lz=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:`additive`}}getCommonUniformsInfo(){return this.getUniformsBufferInfo({u_size_scale:.5})}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.layer.triangulation=oz,e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`pointNormal`,vertexShader:cz,fragmentShader:sz,triangulation:oz,defines:e.getDefines(),inject:e.getInject(),depth:{enable:!1},primitive:X.POINTS,pick:!1})]})()}clearModels(){}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=1}=e;return Array.isArray(t)?[t[0]]:[t]}}})}}})),dz,fz,pz,mz=o((()=>{Py(),UC(),dF(),_F(),TI(),dz=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,fz=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2(
    cos(time), sin(time),
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));

  offset = project_pixel(offset);

  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,pz=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10})}getCommonUniformsInfo(){let{blend:e,speed:t=1,unit:n=`pixel`}=this.layer.getLayerConfig(),r={u_additive:e===`additive`?1:0,u_size_unit:hF[n],u_speed:t,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(r)}getAnimateUniforms(){return{}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),tI)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`pointRadar`,vertexShader:fz,fragmentShader:dz,triangulation:tI,defines:e.getDefines(),inject:e.getInject(),depth:{enable:!1}})]})()}animateOption2Array(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`extrude`,type:oy.Attribute,descriptor:{name:`a_Extrude`,shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r)=>{let i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=r%4*3;return[i[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:`a_Size`,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=5}=e;return Array.isArray(t)?[t[0]]:[t]}}})}}})),hz,gz=o((()=>{ov(),hz=class{constructor(e,t,n){J(this,`boxCells`,[]),J(this,`xCellCount`,void 0),J(this,`yCellCount`,void 0),J(this,`boxKeys`,void 0),J(this,`bboxes`,void 0),J(this,`width`,void 0),J(this,`height`,void 0),J(this,`xScale`,void 0),J(this,`yScale`,void 0),J(this,`boxUid`,void 0);let r=this.boxCells;this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0}insert(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}query(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}hitTest(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}insertBoxCell(e,t,n,r,i,a){this.boxCells[i].push(a)}queryHitTest(e,t,n,r,i,a){if(n<0||e>this.width||r<0||t>this.height)return i?!1:[];let o=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[e*4],y1:this.bboxes[e*4+1],x2:this.bboxes[e*4+2],y2:this.bboxes[e*4+3]});return a?o.filter(a):o}let s={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,o,s,a),i?o.length>0:o}queryCell(e,t,n,r,i,a,o,s){let c=o.seenUids,l=this.boxCells[i];if(l!==null){let i=this.bboxes;for(let u of l)if(!c.box[u]){c.box[u]=!0;let l=u*4;if(e<=i[l+2]&&t<=i[l+3]&&n>=i[l+0]&&r>=i[l+1]&&(!s||s(this.boxKeys[u]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[u],x1:i[l],y1:i[l+1],x2:i[l+2],y2:i[l+3]})}}}return!1}forEachCell(e,t,n,r,i,a,o,s){let c=this.convertToXCellCoord(e),l=this.convertToYCellCoord(t),u=this.convertToXCellCoord(n),d=this.convertToYCellCoord(r);for(let f=c;f<=u;f++)for(let c=l;c<=d;c++){let l=this.xCellCount*c+f;if(i.call(this,e,t,n,r,l,a,o,s))return}}convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}})),_z,vz=o((()=>{ov(),Rb(),gz(),_z=class{constructor(e,t){J(this,`width`,void 0),J(this,`height`,void 0),J(this,`grid`,void 0),J(this,`viewportPadding`,100),J(this,`screenRightBoundary`,void 0),J(this,`screenBottomBoundary`,void 0),J(this,`gridRightBoundary`,void 0),J(this,`gridBottomBoundary`,void 0),this.width=e,this.height=t,this.viewportPadding=Math.max(e,t),this.grid=new hz(e+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=e+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=e+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}placeCollisionBox(e){let t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}insertCollisionBox(e,t){let n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}project(e,t,n){let r=Sb(t,n,0,1),i=xb();return wb(i,r,Jy(...e)),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}isInsideGrid(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}}));function yz(e){let t=.5,n=.5;switch(e){case`right`:case`top-right`:case`bottom-right`:t=1;break;case`left`:case`top-left`:case`bottom-left`:t=0;break;default:t=.5}switch(e){case`bottom`:case`bottom-right`:case`bottom-left`:n=1;break;case`top`:case`top-right`:case`top-left`:n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function bz(e,t,n,r,i){if(!i)return;let a=e[r],o=a.glyph;if(o){let s=t[o].advance*a.scale,c=(e[r].x+s)*i;for(let t=n;t<=r;t++)e[t].x-=c}}function xz(e,t,n,r,i,a,o){let s=(t-n)*i,c=(-r*o+.5)*a;for(let t of e)t.x+=s,t.y+=c}function Sz(e,t,n,r,i,a,o){let s=0,c=-8,l=0,u=e.positionedGlyphs,d=a===`right`?1:a===`left`?0:.5,f=u.length;n.forEach(e=>{if(e.split(``).forEach(e=>{let n=t[e];n&&(u.push({glyph:e,x:s,y:c+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+o)}),u.length!==f){let e=s-o;l=Math.max(e,l),bz(u,t,f,u.length-1,d)}s=0,c-=r+5});let{horizontalAlign:p,verticalAlign:m}=yz(i);xz(u,d,p,m,l,r,n.length);let h=c- -8;e.top+=-m*h,e.bottom=e.top-h,e.left+=-p*l,e.right=e.left+l}function Cz(e,t,n,r,i,a,o){let s=0,c=-8,l=0,u=e.positionedGlyphs,d=a===`right`?1:a===`left`?0:.5,f=u.length;n.forEach(e=>{let n=t[e];if(n&&(u.push({glyph:e,x:n.advance/2,y:c+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+o),u.length!==f){let e=s-o;l=Math.max(e,l),bz(u,t,f,u.length-1,d)}s=0,c-=r+5});let{horizontalAlign:p,verticalAlign:m}=yz(i);xz(u,d,p,m,l,r,n.length);let h=c- -8;e.top+=-m*h,e.bottom=e.top-h,e.left+=-p*l,e.right=e.left+l}function wz(e,t,n,r,i,a,o=[0,0],s){let c=e.split(`
`),l=[],u={positionedGlyphs:l,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:c.length,text:e};return s?Cz(u,t,c,n,r,i,a):Sz(u,t,c,n,r,i,a),l.length?u:!1}function Tz(e,t=[0,0],n){let{positionedGlyphs:r=[]}=e,i=[];for(let e of r){let r=e.metrics,a=r.advance*e.scale/2,o=n?[e.x+a,e.y]:[0,0],s=n?[0,0]:[e.x+a+t[0],e.y+t[1]],c=-4*e.scale-a+s[0],l=-4*e.scale+s[1],u=c+r.width*e.scale,d=l+r.height*e.scale,f={x:c,y:l},p={x:u,y:l},m={x:c,y:d},h={x:u,y:d};i.push({tl:f,tr:p,bl:m,br:h,tex:r,glyphOffset:o})}return i}var Ez=o((()=>{}));function Dz(e){let t=this,n=e.id,r=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[n])return{vertices:[],indices:[],size:7};let a=t.glyphInfoMap[n].centroid,o=a.length===2?[a[0],a[1],0]:a;return t.glyphInfoMap[n].glyphQuads.forEach((e,t)=>{r.push(...o,e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y,...o,e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y,...o,e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y,...o,e.tex.x,e.tex.y,e.bl.x,e.bl.y),i.push(0+t*4,1+t*4,2+t*4,2+t*4,3+t*4,0+t*4)}),{vertices:r,indices:i,size:7}}var Oz,kz,Az,jz,Mz=o((()=>{cv(),Py(),ov(),UC(),kp(),dF(),vz(),Ez(),Oz=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // 作为 mask 模板时需要丢弃透明的像素
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,kz=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_TEXT_OFFSETS) in vec2 a_textOffsets;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // 文本缩放比例
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);

  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,{isEqual:Az}=tu,jz=class extends uF{constructor(...e){var t;super(...e),t=this,J(this,`glyphInfo`,void 0),J(this,`glyphInfoMap`,{}),J(this,`rawEncodeData`,void 0),J(this,`texture`,void 0),J(this,`currentZoom`,-1),J(this,`extent`,void 0),J(this,`textureHeight`,0),J(this,`textCount`,0),J(this,`preTextStyle`,{}),J(this,`mapping`,Z(function*(){t.initGlyph(),t.updateTexture(),yield t.reBuildModel()}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,TEXT_OFFSETS:10,UV:11})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y(Y({},e.uniformsOption),t.uniformsOption),{u_sdf_map:this.textures[0]})}getCommonUniformsInfo(){let{stroke:e=`#fff`,strokeWidth:t=0,halo:n=.5,gamma:r=2,raisingHeight:i=0}=this.layer.getLayerConfig(),a=this.getFontServiceMapping(),o=this.getFontServiceCanvas();a&&Object.keys(a).length!==this.textCount&&o&&(this.updateTexture(),this.textCount=Object.keys(a).length),this.preTextStyle=this.getTextStyle();let s={u_stroke_color:Ls(e),u_sdf_map_size:[o?.width||1,o?.height||1],u_raisingHeight:Number(i),u_stroke_width:t,u_gamma_scale:r,u_halo_blur:n};return this.getUniformsBufferInfo(s)}initModels(){var e=this;return Z(function*(){return e.bindEvent(),e.extent=e.textExtent(),e.rawEncodeData=e.layer.getEncodedData(),e.preTextStyle=e.getTextStyle(),e.initUniformsBuffer(),e.buildModels()})()}buildModels(){var e=this;return Z(function*(){let{textAllowOverlap:t=!1}=e.layer.getLayerConfig();return e.initGlyph(),e.updateTexture(),t||e.filterGlyphs(),[yield e.layer.buildLayerModel({moduleName:`pointText`,vertexShader:kz,fragmentShader:Oz,defines:e.getDefines(),inject:e.getInject(),triangulation:Dz.bind(e),depth:{enable:!1}})]})()}needUpdate(){var e=this;return Z(function*(){let{textAllowOverlap:t=!1,textAnchor:n=`center`,textOffset:r,padding:i,fontFamily:a,fontWeight:o}=e.getTextStyle();if(!Az(i,e.preTextStyle.padding)||!Az(r,e.preTextStyle.textOffset)||!Az(n,e.preTextStyle.textAnchor)||!Az(a,e.preTextStyle.fontFamily)||!Az(o,e.preTextStyle.fontWeight))return yield e.mapping(),!0;if(t)return!1;let s=e.mapService.getZoom(),c=e.mapService.getBounds(),l=kd(e.extent,c);return Math.abs(e.currentZoom-s)>.5||!l||t!==e.preTextStyle.textAllowOverlap?(yield e.reBuildModel(),!0):!1})()}clearModels(){var e;(e=this.texture)==null||e.destroy(),this.layer.off(`remapping`,this.mapping)}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`textOffsets`,type:oy.Attribute,descriptor:{shaderLocation:this.attributeLocation.TEXT_OFFSETS,name:`a_textOffsets`,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:`textUv`,type:oy.Attribute,descriptor:{name:`a_tex`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=12}=e;return Array.isArray(t)?[t[0]]:[t]}}})}bindEvent(){this.layer.isTileLayer||this.layer.on(`remapping`,this.mapping)}textExtent(){return Od(this.mapService.getBounds(),.5)}initTextFont(){let{fontWeight:e,fontFamily:t}=this.getTextStyle(),n=this.rawEncodeData,r=[];n.forEach(e=>{let{shape:t=``}=e;t=t.toString();for(let e of t)r.indexOf(e)===-1&&r.push(e)}),this.fontService.setFontOptions({characterSet:r,fontWeight:e,fontFamily:t,iconfont:!1})}initIconFontTex(){let{fontWeight:e,fontFamily:t}=this.getTextStyle(),n=this.rawEncodeData,r=[];n.forEach(e=>{let{shape:t=``}=e;t=`${t}`,r.indexOf(t)===-1&&r.push(t)}),this.fontService.setFontOptions({characterSet:r,fontWeight:e,fontFamily:t,iconfont:!0})}getTextStyle(){let{fontWeight:e=`400`,fontFamily:t=`sans-serif`,textAllowOverlap:n=!1,padding:r=[0,0],textAnchor:i=`center`,textOffset:a=[0,0],opacity:o=1,strokeOpacity:s=1,strokeWidth:c=0,stroke:l=`#000`}=this.layer.getLayerConfig();return{fontWeight:e,fontFamily:t,textAllowOverlap:n,padding:r,textAnchor:i,textOffset:a,opacity:o,strokeOpacity:s,strokeWidth:c,stroke:l}}generateGlyphLayout(e){let t=this.getFontServiceMapping(),{spacing:n=2,textAnchor:r=`center`,textOffset:i}=this.layer.getLayerConfig();this.glyphInfo=this.rawEncodeData.map(a=>{let{shape:o=``,id:s,size:c=1}=a,l=a.textOffset?a.textOffset:i||[0,0],u=a.textAnchor?a.textAnchor:r||`center`,d=wz(o.toString(),t,c,u,`left`,n,l,e),f=Tz(d,l,!1);return a.shaping=d,a.glyphQuads=f,a.centroid=Rd(a.coordinates),this.glyphInfoMap[s]={shaping:d,glyphQuads:f,centroid:Rd(a.coordinates)},a})}getFontServiceMapping(){let{fontWeight:e=`400`,fontFamily:t=`sans-serif`}=this.layer.getLayerConfig();return this.fontService.getMappingByKey(`${t}_${e}`)}getFontServiceCanvas(){let{fontWeight:e=`400`,fontFamily:t=`sans-serif`}=this.layer.getLayerConfig();return this.fontService.getCanvasByKey(`${t}_${e}`)}filterGlyphs(){let{padding:e=[0,0],textAllowOverlap:t=!1}=this.layer.getLayerConfig();if(t)return;this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();let{width:n,height:r}=this.rendererService.getViewportSize(),i=new _z(n,r);this.glyphInfo.filter(t=>{let{shaping:n,id:r=0}=t,a=t.centroid,o=t.size/16,s=this.mapService.lngLatToContainer(a),{box:c}=i.placeCollisionBox({x1:n.left*o-e[0],x2:n.right*o+e[0],y1:n.top*o-e[1],y2:n.bottom*o+e[1],anchorPointX:s.x,anchorPointY:s.y});return c&&c.length?(i.insertCollisionBox(c,r),!0):!1}).forEach(e=>{this.glyphInfoMap[e.id]=e})}initGlyph(){let{iconfont:e=!1}=this.layer.getLayerConfig();e?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(e)}updateTexture(){let{createTexture2D:e}=this.rendererService,t=this.getFontServiceCanvas();this.textureHeight=t.height,this.texture&&this.texture.destroy(),this.texture=e({data:t,mag:X.LINEAR,min:X.LINEAR,width:t.width,height:t.height}),this.textures=[this.texture]}reBuildModel(){var e=this;return Z(function*(){e.filterGlyphs();let t=yield e.layer.buildLayerModel({moduleName:`pointText`,vertexShader:kz,fragmentShader:Oz,triangulation:Dz.bind(e),defines:e.getDefines(),inject:e.getInject(),depth:{enable:!1}});e.layer.models=[t]})()}}})),Nz,Pz=o((()=>{PR(),zR(),UR(),qR(),ZR(),tz(),az(),uz(),mz(),Mz(),Nz={fillImage:ez,fill:XR,radar:pz,image:iz,normal:lz,simplePoint:NR,extrude:KR,text:jz,earthFill:HR,earthExtrude:RR}})),Fz,Iz=o((()=>{Py(),ov(),XP(),Pz(),Fz=class extends YP{constructor(...e){super(...e),J(this,`type`,`PointLayer`),J(this,`enableShaderEncodeStyles`,[`stroke`,`offsets`,`opacity`,`rotation`]),J(this,`enableDataEncodeStyles`,[`textOffset`,`textAnchor`]),J(this,`defaultSourceConfig`,{data:[],options:{parser:{type:`json`,x:`lng`,y:`lat`}}})}buildModels(){var e=this;return Z(function*(){let t=e.getModelType();e.layerModel&&e.layerModel.clearModels(),e.layerModel=new Nz[t](e),yield e.initLayerModels()})()}rebuildModels(){var e=this;return Z(function*(){yield e.buildModels()})()}getModelTypeWillEmptyData(){if(this.shapeOption){let{field:e,values:t}=this.shapeOption,{shape2d:n}=this.getLayerConfig(),r=this.iconService.getIconMap();if(e&&n?.indexOf(e)!==-1)return`fill`;if(t===`text`)return`text`;if(t&&t instanceof Array){for(let e of t)if(typeof e==`string`&&r.hasOwnProperty(e))return`image`}}return`normal`}getDefaultConfig(){return{fillImage:{},normal:{blend:`additive`},radar:{},simplePoint:{},fill:{blend:`normal`},extrude:{},image:{},text:{blend:`normal`},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}getModelType(){let e=this.getEncodedData(),{shape2d:t,shape3d:n,billboard:r=!0}=this.getLayerConfig(),i=this.iconService.getIconMap(),a=e.find(e=>e.hasOwnProperty(`shape`));if(a){let e=a.shape;return e===`dot`?`normal`:e===`simple`?`simplePoint`:e===`radar`?`radar`:this.layerType===`fillImage`||r===!1?`fillImage`:t?.indexOf(e)===-1?n?.indexOf(e)===-1?i.hasOwnProperty(e)?`image`:`text`:this.mapService.version===`GLOBEL`?`earthExtrude`:`extrude`:this.mapService.version===`GLOBEL`?`earthFill`:`fill`}else return this.getModelTypeWillEmptyData()}}}));function Lz(e){return Rz.apply(this,arguments)}function Rz(){return Rz=Z(function*(e){if(window.createImageBitmap){let t=yield fetch(e);return yield createImageBitmap(yield t.blob())}else{let t=new window.Image;return new Promise(n=>{t.onload=()=>n(t),t.src=e,t.crossOrigin=`Anonymous`})}}),Rz.apply(this,arguments)}var zz=o((()=>{Py()})),Bz,Vz,Hz,Uz,Wz,Gz,Kz,qz=o((()=>{Py(),cv(),ov(),UC(),kp(),dF(),TI(),zz(),Bz=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  // top face
  if (u_topsurface < 1.0) {
    discard;
  }

  outputColor = v_Color;

  outputColor = filterColor(outputColor);
}
`,Vz=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide = v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: 部分机型 GPU 计算精度兼容
  if (isSide < 0.999) {
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
      outputColor = v_Color;
    }
  } else {
    // top face
    if (u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,Hz=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_uvs = a_uvs;
  // cal style mapping - 数据纹理映射部分的计算
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(project_pos);
  v_texture_data = vec2(a_Position.z, lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,Uz=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float isSide = a_Position.z;
  float topU = a_uvs[0];
  float topV = 1.0 - a_uvs[1];
  float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

 gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  // Tip: 部分机型 GPU 计算精度兼容
  if (isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,Wz=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: 部分机型 GPU 计算精度兼容
  if (isSide < 0.999) {
    // 是否是边缘
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
    // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }

  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,Gz=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,Kz=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{mapTexture:e,heightfixed:t=!1,raisingHeight:n=0,topsurface:r=!0,sidesurface:i=!0,sourceColor:a,targetColor:o}=this.layer.getLayerConfig(),s=0,c=[1,1,1,1],l=[1,1,1,1];a&&o&&(c=Ls(a),l=Ls(o),s=1);let u={u_sourceColor:c,u_targetColor:l,u_linearColor:s,u_topsurface:Number(r),u_sidesurface:Number(i),u_heightfixed:Number(t),u_raisingHeight:Number(n)};return e&&this.texture&&(u.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(u)}initModels(){var e=this;return Z(function*(){return yield e.loadTexture(),e.buildModels()})()}buildModels(){var e=this;return Z(function*(){let{frag:t,vert:n,type:r}=e.getShaders();return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:r,vertexShader:n,fragmentShader:t,depth:{enable:!0},defines:e.getDefines(),inject:e.getInject(),triangulation:pI})]})()}getShaders(){let{pickLight:e,mapTexture:t}=this.layer.getLayerConfig();return t?{frag:Wz,vert:Gz,type:`polygonExtrudeTexture`}:e?{frag:Vz,vert:Hz,type:`polygonExtrudePickLight`}:{frag:Bz,vert:Uz,type:`polygonExtrude`}}clearModels(){var e;(e=this.texture)==null||e.destroy(),this.textures=[]}registerBuiltinAttributes(){let e=this.layer.getSource().extent,t=e[2]-e[0],n=e[3]-e[1];this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`uvs`,type:oy.Attribute,descriptor:{name:`a_uvs`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(r,i,a)=>{let o=a[0],s=a[1];return[(o-e[0])/t,(s-e[1])/n,a[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=10}=e;return Array.isArray(t)?[t[0]]:[t]}}})}loadTexture(){var e=this;return Z(function*(){let{mapTexture:t}=e.layer.getLayerConfig(),{createTexture2D:n}=e.rendererService;if(e.texture=n({height:1,width:1}),t){let r=yield Lz(t);e.texture=n({data:r,width:r.width,height:r.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.LINEAR,mag:X.LINEAR})}})()}}})),Jz,Yz,Xz,Zz=o((()=>{Py(),cv(),ov(),UC(),dF(),TI(),Jz=`in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,Yz=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,Xz=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,EXTRUSION_BASE:11})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){return this.getUniformsBufferInfo({})}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){let{frag:t,vert:n,type:r}=e.getShaders();return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:r,vertexShader:n,fragmentShader:t,defines:e.getDefines(),inject:e.getInject(),triangulation:pI,depth:{enable:!0}})]})()}getShaders(){return{frag:Jz,vert:Yz,type:`polygonExtrude`}}clearModels(){var e;(e=this.texture)==null||e.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`size`,type:oy.Attribute,descriptor:{name:`a_Size`,shaderLocation:this.attributeLocation.SIZE,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{size:t=10}=e;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:`extrusionBase`,type:oy.Attribute,descriptor:{name:`a_ExtrusionBase`,shaderLocation:this.attributeLocation.EXTRUSION_BASE,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:e=>{let{extrusionBase:t=0}=e;return[t]}}})}}})),Qz,$z,eB,tB,nB,rB=o((()=>{Py(),cv(),UC(),dF(),TI(),Qz=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,$z=`layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *=
      u_dir == 1.0
        ? 1.0 - length(v_pos - v_linear.xy) / v_linear.z
        : length(v_pos - v_linear.xy) / v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,eB=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_LINEAR) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}
`,tB=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  project_pos.z += u_raisingHeight;

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,nB=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,LINEAR:9})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{raisingHeight:e=0,opacityLinear:t={enable:!1,dir:`in`}}=this.layer.getLayerConfig(),n={u_raisingHeight:Number(e),u_opacitylinear:Number(t.enable),u_dir:t.dir===`in`?1:0};return this.getUniformsBufferInfo(n)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){let{frag:t,vert:n,triangulation:r,type:i}=e.getModelParams();return e.initUniformsBuffer(),e.layer.triangulation=r,[yield e.layer.buildLayerModel({moduleName:i,vertexShader:n,fragmentShader:t,defines:e.getDefines(),inject:e.getInject(),triangulation:r,primitive:X.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute();let{opacityLinear:e={enable:!1,dir:`in`}}=this.layer.getLayerConfig();e.enable&&this.styleAttributeService.registerStyleAttribute({name:`linear`,type:oy.Attribute,descriptor:{name:`a_linear`,shaderLocation:this.attributeLocation.LINEAR,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n)=>[n[3],n[4],n[5]]}})}getModelParams(){let{opacityLinear:e={enable:!1}}=this.layer.getLayerConfig();return e.enable?{frag:$z,vert:eB,type:`polygonLinear`,triangulation:dI}:{frag:Qz,vert:tB,type:`polygonFill`,triangulation:uI}}}})),iB,aB,oB,sB=o((()=>{Py(),cv(),ov(),UC(),kp(),dF(),TI(),iB=`layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.1;
float large_waveheight = 0.75; // change to adjust the "heavy" waves
float large_wavesize = 3.4; // factor to adjust the large wave size
float small_waveheight = 0.6; // change to adjust the small random waves
float small_wavesize = 0.5; // factor to ajust the small wave size
float water_softlight_fact = 15.0; // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact = 120.0; // range [1..200]
float particle_amount = 70.0;

vec3 water_specularcolor = vec3(1.3, 1.3, 0.9); // specular Color (RGB) of the water-highlights
#define light (vec3(-0.0, sin(u_time * 0.5) * 0.5 + 0.35, 2.8)) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

float hash(float n) {
  return fract(sin(n) * 43758.5453123);
}

// 2d noise function
float noise1(vec2 x) {
  vec2 p = floor(x);
  vec2 f = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y * 57.0;
  return mix(mix(hash(n + 0.0), hash(n + 1.0), f.x), mix(hash(n + 57.0), hash(n + 58.0), f.x), f.y);
}

float noise(vec2 p) {
  return texture(SAMPLER_2D(u_texture2), p * vec2(1.0 / 256.0)).x;
}

vec4 highness(vec2 p) {
  vec4 t = texture(SAMPLER_2D(u_texture1), fract(p));
  float clipped =
    -2.0 -
    smoothstep(3.0, 10.0, t.a) * 6.9 -
    smoothstep(10.0, 100.0, t.a) * 89.9 -
    smoothstep(0.0, 10000.0, t.a) * 10000.0;
  return clamp(t, 0.0, 3.0) + clamp(t / 3.0 - 1.0, 0.0, 1.0) + clamp(t / 16.0 - 1.0, 0.0, 1.0);
}

float height_map(vec2 p) {
  vec4 height = highness(p);
  /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

  mat2 m = mat2(0.9563 * 1.4, -0.2924 * 1.4, 0.2924 * 1.4, 0.9563 * 1.4);
  //p = p*6.;
  float f = 0.6 * noise1(p);
  p = m * p * 1.1 * 6.0;
  f += 0.25 * noise(p);
  p = m * p * 1.32;
  f += 0.1666 * noise(p);
  p = m * p * 1.11;
  f += 0.0834 * noise(p);
  p = m * p * 1.12;
  f += 0.0634 * noise(p);
  p = m * p * 1.13;
  f += 0.0444 * noise(p);
  p = m * p * 1.14;
  f += 0.0274 * noise(p);
  p = m * p * 1.15;
  f += 0.0134 * noise(p);
  p = m * p * 1.16;
  f += 0.0104 * noise(p);
  p = m * p * 1.17;
  f += 0.0084 * noise(p);
  f = 0.25 * f + dot(height, vec4(-0.03125, -0.125, 0.25, 0.25)) * 0.5;
  const float FLAT_LEVEL = 0.92525;
  //f = f*0.25+height*0.75;
  if (f < FLAT_LEVEL) f = f;
  else f = pow((f - FLAT_LEVEL) / (1.0 - FLAT_LEVEL), 2.0) * (1.0 - FLAT_LEVEL) * 2.0 + FLAT_LEVEL; // makes a smooth coast-increase
  return clamp(f, 0.0, 10.0);
}

vec3 plasma_quintic(float x) {
  x = clamp(x, 0.0, 1.0);
  vec4 x1 = vec4(1.0, x, x * x, x * x * x); // 1 x x2 x3
  vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
  return vec3(
    dot(x1.xyzw, vec4(+0.063861086, +1.992659096, -1.023901152, -0.490832805)) +
      dot(x2.xy, vec2(+1.308442123, -0.914547012)),
    dot(x1.xyzw, vec4(+0.04971859, -0.791144343, +2.892305078, +0.811726816)) +
      dot(x2.xy, vec2(-4.686502417, +2.717794514)),
    dot(x1.xyzw, vec4(+0.513275779, +1.58025506, -5.164414457, +4.559573646)) +
      dot(x2.xy, vec2(-1.916810682, +0.570638854))
  );
}

vec4 color(vec2 p) {
  vec4 c1 = vec4(1.7, 1.6, 0.9, 1);
  vec4 c2 = vec4(0.2, 0.94, 0.1, 1);
  vec4 c3 = vec4(0.3, 0.2, 0.0, 1);
  vec4 c4 = vec4(0.99, 0.99, 1.6, 1);
  vec4 v = highness(p);
  float los = smoothstep(0.1, 1.1, v.b);
  float his = smoothstep(3.5, 6.5, v.b);
  float ces = smoothstep(1.0, 5.0, v.a);
  vec4 lo = mix(c1, c2, los);
  vec4 hi = mix(c3, c4, his);
  vec4 ce = mix(lo, hi, ces);

  return vec4(plasma_quintic(ces), 1).ragb;
}

vec3 terrain_map(vec2 p) {
  return color(p).rgb * 0.75 +
  0.25 * vec3(0.7, 0.55, 0.4) +
  texture(SAMPLER_2D(u_texture3), fract(p * 5.0)).rgb * 0.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2(
   0.72, -1.6 ,
   1.6 ,  0.72
);

float water_map(vec2 p, float height) {
  vec2 p2 = p * large_wavesize;
  vec2 shift1 = 0.001 * vec2(u_time * 160.0 * 2.0, u_time * 120.0 * 2.0);
  vec2 shift2 = 0.001 * vec2(u_time * 190.0 * 2.0, -u_time * 130.0 * 2.0);

  // coarse crossing 'ocean' waves...
  float f = 0.6 * noise(p);
  f += 0.25 * noise(p * m);
  f += 0.1666 * noise(p * m * m);
  float wave =
    sin(p2.x * 0.622 + p2.y * 0.622 + shift2.x * 4.269) * large_waveheight * f * height * height;

  p *= small_wavesize;
  f = 0.0;
  float amp = 1.0,
    s = 0.5;
  for (int i = 0; i < 9; i++) {
    p = m * p * 0.947;
    f -= amp * abs(sin((noise(p + shift1 * s) - 0.5) * 2.0));
    amp = amp * 0.59;
    s *= -1.329;
  }

  return wave + f * small_waveheight;
}

float nautic(vec2 p) {
  p *= 18.0;
  float f = 0.0;
  float amp = 1.0,
    s = 0.5;
  for (int i = 0; i < 3; i++) {
    p = m * p * 1.2;
    f += amp * abs(smoothstep(0.0, 1.0, noise(p + u_time * s)) - 0.5);
    amp = amp * 0.5;
    s *= -1.227;
  }
  return pow(1.0 - f, 5.0);
}

float particles(vec2 p) {
  p *= 200.0;
  float f = 0.0;
  float amp = 1.0,
    s = 1.5;
  for (int i = 0; i < 3; i++) {
    p = m * p * 1.2;
    f += amp * noise(p + u_time * s);
    amp = amp * 0.5;
    s *= -1.227;
  }
  return pow(f * 0.35, 7.0) * particle_amount;
}

float test_shadow(vec2 xy, float height) {
  vec3 r0 = vec3(xy, height);
  vec3 rd = normalize(light - r0);

  float hit = 1.0;
  float t = 0.001;
  for (int j = 1; j < 25; j++) {
    vec3 p = r0 + t * rd;
    float h = height_map(p.xy);
    float height_diff = p.z - h;
    if (height_diff < 0.0) {
      return 0.0;
    }
    t += 0.01 + height_diff * 0.02;
    hit = min(hit, 2.0 * height_diff / t); // soft shaddow
  }
  return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
  vec3 col = terrain_map(uv);
  vec2 iResolution = vec2(512.0);
  float h1 = height_map(uv - vec2(0.0, 0.5) / iResolution.xy);
  float h2 = height_map(uv + vec2(0.0, 0.5) / iResolution.xy);
  float h3 = height_map(uv - vec2(0.5, 0.0) / iResolution.xy);
  float h4 = height_map(uv + vec2(0.5, 0.0) / iResolution.xy);
  vec3 norm = normalize(vec3(h3 - h4, h1 - h2, 1.0));
  vec3 r0 = vec3(uv, height);
  vec3 rd = normalize(light - r0);
  float grad = dot(norm, rd);
  col *= grad + pow(grad, 8.0);
  float terrainshade = test_shadow(uv, height);
  col = mix(col * 0.25, col, terrainshade);
  return col;
}

void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth = 0.4 + coast2water_fadedepth;
  float height = height_map(uv);
  vec3 col;

  float waveheight = clamp(WATER_LEVEL * 3.0 - 1.5, 0.0, 1.0);
  float level = WATER_LEVEL + 0.2 * water_map(uv * 15.0 + vec2(u_time * 0.1), waveheight);
  if (height > level) {
    col = CalcTerrain(uv, height);
  }
  if (height <= level) {
    vec2 dif = vec2(0.0, 0.01);
    vec2 pos = uv * 15.0 + vec2(u_time * 0.01);
    float h1 = water_map(pos - dif, waveheight);
    float h2 = water_map(pos + dif, waveheight);
    float h3 = water_map(pos - dif.yx, waveheight);
    float h4 = water_map(pos + dif.yx, waveheight);
    vec3 normwater = normalize(vec3(h3 - h4, h1 - h2, 0.125)); // norm-vector of the 'bumpy' water-plane
    uv += normwater.xy * 0.002 * (level - height);

    col = CalcTerrain(uv, height);

    float coastfade = clamp((level - height) / coast2water_fadedepth, 0.0, 1.0);
    float coastfade2 = clamp((level - height) / deepwater_fadedepth, 0.0, 1.0);
    float intensity = col.r * 0.2126 + col.g * 0.7152 + col.b * 0.0722;
    watercolor = mix(watercolor * intensity, watercolor2, smoothstep(0.0, 1.0, coastfade2));

    vec3 r0 = vec3(uv, WATER_LEVEL);
    vec3 rd = normalize(light - r0); // ray-direction to the light from water-position
    float grad = dot(normwater, rd); // dot-product of norm-vector and light-direction
    float specular = pow(grad, water_softlight_fact); // used for soft highlights
    float specular2 = pow(grad, water_glossylight_fact); // used for glossy highlights
    float gradpos = dot(vec3(0.0, 0.0, 1.0), rd);
    float specular1 = smoothstep(0.0, 1.0, pow(gradpos, 5.0)); // used for diffusity (some darker corona around light's specular reflections...)
    float watershade = test_shadow(uv, level);
    watercolor *= 2.2 + watershade;
    watercolor += (0.2 + 0.8 * watershade) * ((grad - 1.0) * 0.5 + specular) * 0.25;
    watercolor /= 1.0 + specular1 * 1.25;
    watercolor += watershade * specular2 * water_specularcolor;
    watercolor +=
      watershade *
      coastfade *
      (1.0 - coastfade2) *
      (vec3(0.5, 0.6, 0.7) * nautic(uv) + vec3(1.0, 1.0, 1.0) * particles(uv));

    col = mix(col, watercolor, coastfade);
  }

  outputColor = vec4(col, v_opacity);
}
`,aB=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`,oB=class extends uF{constructor(...e){super(...e),J(this,`texture1`,void 0),J(this,`texture2`,void 0),J(this,`texture3`,void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{watercolor:e=`#6D99A8`,watercolor2:t=`#0F121C`}=this.layer.getLayerConfig(),n={u_watercolor:Ls(e),u_watercolor2:Ls(t),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(n)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var e=this;return Z(function*(){return e.loadTexture(),e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`polygonOcean`,vertexShader:aB,fragmentShader:iB,defines:e.getDefines(),inject:e.getInject(),triangulation:uI,primitive:X.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var e,t,n;(e=this.texture1)==null||e.destroy(),(t=this.texture2)==null||t.destroy(),(n=this.texture3)==null||n.destroy()}registerBuiltinAttributes(){let[e,t,n,r]=this.layer.getSource().extent,i=n-e,a=r-t;this.styleAttributeService.registerStyleAttribute({name:`oceanUv`,type:oy.Attribute,descriptor:{name:`a_uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:(n,r,o)=>{let[s,c]=o;return[(s-e)/i,(c-t)/a]}}})}loadTexture(){let{createTexture2D:e}=this.rendererService,t={height:0,width:0};this.texture1=e(t),this.texture2=e(t),this.texture3=e(t),n(e=>{this.texture1=r(e[0]),this.texture2=r(e[1]),this.texture3=r(e[2]),this.layerService.reRender()});function n(e){let t=0,n=[];[`https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ`,`https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ`,`https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ`].map(r=>{let i=new Image;i.crossOrigin=``,i.src=r,n.push(i),i.onload=()=>{t++,t===3&&e(n)}})}function r(t){return e({data:t,width:t.width,height:t.height,wrapS:X.MIRRORED_REPEAT,wrapT:X.MIRRORED_REPEAT,min:X.LINEAR,mag:X.LINEAR})}}}})),cB,lB,uB,dB=o((()=>{Py(),cv(),ov(),UC(),dF(),TI(),cB=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;

in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) {
  return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.0;
  p.x += t * 2.0;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.0).xyz;
  p.z += t * 3.0;
  p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.0).xyz;
  p.z += t * 4.0;
  p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.0).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.0;
  return p.y + z / 4.0;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = 0.1;
  return normalize(
    vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    )
  );
}

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0, 1, 0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,lB=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`,uB=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{speed:e=.5}=this.layer.getLayerConfig(),t={u_speed:e,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(t)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var e=this;return Z(function*(){return e.loadTexture(),e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`polygonWater`,vertexShader:lB,fragmentShader:cB,triangulation:uI,defines:e.getDefines(),inject:e.getInject(),primitive:X.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1})]})()}clearModels(){var e;(e=this.texture)==null||e.destroy()}registerBuiltinAttributes(){let[e,t,n,r]=this.layer.getSource().extent,i=n-e,a=r-t;this.styleAttributeService.registerStyleAttribute({name:`waterUv`,type:oy.Attribute,descriptor:{name:`a_uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:(n,r,o)=>{let[s,c]=o;return[(s-e)/i,(c-t)/a]}}})}loadTexture(){let{waterTexture:e}=this.layer.getLayerConfig(),{createTexture2D:t}=this.rendererService;this.texture=t({height:1,width:1});let n=new Image;n.crossOrigin=``,e?(console.warn(`L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ`),n.src=e):n.src=`https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ`,n.onload=()=>{this.texture=t({data:n,width:n.width,height:n.height,wrapS:X.MIRRORED_REPEAT,wrapT:X.MIRRORED_REPEAT,min:X.LINEAR,mag:X.LINEAR}),this.layerService.reRender()}}}})),fB,pB=o((()=>{_R(),qR(),ZR(),az(),uz(),Mz(),qz(),Zz(),rB(),sB(),dB(),fB={fill:nB,line:gR,extrude:Kz,text:jz,point_fill:XR,point_image:iz,point_normal:lz,point_extrude:KR,water:uB,ocean:oB,extrusion:Xz}})),mB,hB=o((()=>{Py(),ov(),XP(),pB(),mB=class extends YP{constructor(...e){super(...e),J(this,`type`,`PolygonLayer`),J(this,`enableShaderEncodeStyles`,[`opacity`,`extrusionBase`,`rotation`,`offsets`,`stroke`])}buildModels(){var e=this;return Z(function*(){e.layerModel=new fB[e.getModelType()](e),yield e.initLayerModels()})()}getModelType(){var e;let t=this.styleAttributeService.getLayerStyleAttribute(`shape`),n=t==null||(e=t.scale)==null?void 0:e.field;return n===`fill`||!n?`fill`:n===`extrude`?`extrude`:n===`extrusion`?`extrusion`:n===`water`?`water`:n===`ocean`?`ocean`:n===`line`?`line`:this.getPointModelType()}getPointModelType(){let e=this.getEncodedData(),{shape2d:t,shape3d:n}=this.getLayerConfig(),r=this.iconService.getIconMap(),i=e.find(e=>e.hasOwnProperty(`shape`));if(i){let e=i.shape;return e===`dot`?`point_normal`:t?.indexOf(e)===-1?n?.indexOf(e)===-1?r.hasOwnProperty(e)?`point_image`:`text`:`point_extrude`:`point_fill`}else return`fill`}}})),gB,_B,vB,yB=o((()=>{Py(),cv(),ov(),UC(),kp(),dF(),TI(),gB=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) {
  return x > 0.0 || x < 0.0
    ? x != x
    : x != 0.0;
}

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if (u_clampLow < 0.5 && value < u_domain[0] || u_clampHigh < 0.5 && value > u_domain[1]) {
    discard;
  } else {
    float normalisedValue = (value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));

    outputColor = color;
    outputColor.a = outputColor.a * u_opacity;
    if (outputColor.a < 0.01) discard;
  }
}
`,_B=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`,vB=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`colorTexture`,void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{opacity:e=1,clampLow:t=!0,clampHigh:n=!0,noDataValue:r=-9999999,domain:i,rampColors:a}=this.layer.getLayerConfig(),o=i||Ks(a);this.colorTexture=this.layer.textureService.getColorTexture(a,o);let s={u_domain:o,u_opacity:e||1,u_noDataValue:r,u_clampLow:t?1:0,u_clampHigh:(n===void 0?t:n)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(s)}getRasterData(e){return Z(function*(){if(Array.isArray(e.data))return{data:e.data,width:e.width,height:e.height};{let{rasterData:t,width:n,height:r}=yield e.data;return{data:Array.from(t),width:n,height:r}}})()}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){e.initUniformsBuffer();let t=e.layer.getSource(),{createTexture2D:n,queryVerdorInfo:r}=e.rendererService,i=t.data.dataArray[0],{data:a,width:o,height:s}=yield e.getRasterData(i);return e.texture=n({data:new Float32Array(a),width:o,height:s,format:r()===`WebGL1`?X.LUMINANCE:X.RED,type:X.FLOAT,alignment:1}),[yield e.layer.buildLayerModel({moduleName:`rasterImageData`,vertexShader:_B,fragmentShader:gB,defines:e.getDefines(),triangulation:hI,primitive:X.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}clearModels(){var e,t;(e=this.texture)==null||e.destroy(),(t=this.colorTexture)==null||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{shaderLocation:this.attributeLocation.UV,name:`a_Uv`,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}}})),bB,xB,SB,CB,wB,TB=o((()=>{Ix(),Py(),cv(),ov(),UC(),dF(),TI(),bB=[`data`],xB=[`rasterData`],SB=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  vec2 u_rminmax;
  vec2 u_gminmax;
  vec2 u_bminmax;
  float u_opacity;
  float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {
  vec3 rgb = texture(SAMPLER_2D(u_texture), vec2(v_texCoord.x, v_texCoord.y)).rgb;

  if (rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(
      rgb.r / (u_rminmax.y - u_rminmax.x),
      rgb.g / (u_gminmax.y - u_gminmax.x),
      rgb.b / (u_bminmax.y - u_bminmax.x),
      u_opacity
    );
  }

  if (outputColor.a < 0.01) discard;

}
`,CB=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_rminmax;
  vec2 u_gminmax;
  vec2 u_bminmax;
  float u_opacity;
  float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`,wB=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`dataOption`,{})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{opacity:e=1,noDataValue:t=0}=this.layer.getLayerConfig(),{rMinMax:n=[0,255],gMinMax:r=[0,255],bMinMax:i=[0,255]}=this.dataOption,a={u_rminmax:n,u_gminmax:r,u_bminmax:i,u_opacity:e||1,u_noDataValue:t,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}getRasterData(e){var t=this;return Z(function*(){if(Array.isArray(e.data)){let{data:n}=e,r=Fx(e,bB);return t.dataOption=r,Y({data:n},r)}let n=yield e.data,{rasterData:r}=n,i=Fx(n,xB);return t.dataOption=i,Y(Array.isArray(r)?{data:r}:{data:Array.from(r)},i)})()}initModels(){var e=this;return Z(function*(){e.initUniformsBuffer();let t=e.layer.getSource(),{createTexture2D:n}=e.rendererService,r=t.data.dataArray[0],{data:i,width:a,height:o}=yield e.getRasterData(r);return e.texture=n({data:new Float32Array(i),width:a,height:o,format:X.RGB,type:X.FLOAT}),[yield e.layer.buildLayerModel({moduleName:`rasterImageDataRGBA`,vertexShader:CB,fragmentShader:SB,defines:e.getDefines(),triangulation:hI,primitive:X.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}buildModels(){var e=this;return Z(function*(){return e.initModels()})()}clearModels(){var e;(e=this.texture)==null||e.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}}})),EB,DB,OB,kB=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),EB=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
  vec4 u_unpack;
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;

float getElevation(vec2 coord, float bias) {
  // Convert encoded elevation value to meters
  vec4 data = texture(SAMPLER_2D(u_texture), coord, bias) * 255.0;
  data.a = -1.0;
  return dot(data, u_unpack);
}

vec4 getColor(float value) {
  float normalisedValue = (value - u_domain[0]) / (u_domain[1] - u_domain[0]);
  vec2 coord = vec2(normalisedValue, 0);
  return texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord, 0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if (u_clampLow < 0.5 && value < u_domain[0] || u_clampHigh < 0.5 && value > u_domain[1]) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = getColor(value);
    outputColor.a = outputColor.a * u_opacity;
    if (outputColor.a < 0.01) discard;
  }
}
`,DB=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec4 u_unpack;
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`,OB=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){let{opacity:e,clampLow:t=!0,clampHigh:n=!0,noDataValue:r=-9999999,domain:i,rampColors:a,colorTexture:o,rScaler:s=6553.6,gScaler:c=25.6,bScaler:l=.1,offset:u=1e4}=this.layer.getLayerConfig(),d=i||Ks(a),f=o;o?this.layer.textureService.setColorTexture(o,a,d):f=this.layer.textureService.getColorTexture(a,d);let p={u_unpack:[s,c,l,u],u_domain:d,u_opacity:e||1,u_noDataValue:r,u_clampLow:t,u_clampHigh:n===void 0?t:n,u_texture:this.texture,u_colorTexture:f};return this.textures=[this.texture,f],this.getUniformsBufferInfo(p)}initModels(){var e=this;return Z(function*(){e.initUniformsBuffer();let t=e.layer.getSource(),{createTexture2D:n}=e.rendererService,r=yield t.data.images;return e.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:X.LINEAR,mag:X.LINEAR}),[yield e.layer.buildLayerModel({moduleName:`RasterTileDataImage`,vertexShader:DB,fragmentShader:EB,defines:e.getDefines(),triangulation:hI,primitive:X.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var e;(e=this.texture)==null||e.destroy()}buildModels(){var e=this;return Z(function*(){return e.initModels()})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}}})),AB,jB=o((()=>{yB(),TB(),kB(),AB={raster:vB,rasterRgb:wB,raster3d:vB,rasterTerrainRgb:OB}})),MB,NB=o((()=>{Py(),ov(),XP(),XI(),jB(),MB=class extends YP{constructor(...e){super(...e),J(this,`type`,`RasterLayer`)}buildModels(){var e=this;return Z(function*(){e.layerModel=new AB[e.getModelType()](e),yield e.initLayerModels()})()}getDefaultConfig(){return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[this.getModelType()]}getModelType(){switch(this.layerSource.getParserType()){case`raster`:case`ndi`:return`raster`;case`rasterRgb`:return`rasterRgb`;case`rgb`:return`rasterRgb`;case`image`:return`rasterTerrainRgb`;default:return`raster`}}getLegend(e){if(e!==`color`)return{type:void 0,field:void 0,items:[]};let t=this.getLayerConfig().rampColors;return YI(t,e)}}})),PB,FB=o((()=>{Py(),ov(),PB=class{constructor({rendererService:e,layerService:t,parent:n}){J(this,`tileResource`,new Map),J(this,`rendererService`,void 0),J(this,`layerService`,void 0),J(this,`parent`,void 0),J(this,`layerTiles`,[]),this.rendererService=e,this.layerService=t,this.parent=n}get tiles(){return this.layerTiles}hasTile(e){return this.layerTiles.some(t=>t.key===e)}addTile(e){this.layerTiles.push(e)}getTile(e){return this.layerTiles.find(t=>t.key===e)}getVisibleTileBylngLat(e){return this.layerTiles.find(t=>t.isLoaded&&t.visible&&t.lnglatInBounds(e))}removeTile(e){let t=this.layerTiles.findIndex(t=>t.key===e),n=this.layerTiles.splice(t,1);n[0]&&n[0].destroy()}updateTileVisible(e){let t=this.getTile(e.key);if(e.isVisible)if(e.parent){let n=this.isChildrenLoaded(e.parent);t?.updateVisible(n)}else t?.updateVisible(!0);else if(e.parent){let n=this.isChildrenLoaded(e.parent);t?.updateVisible(!n)}else t?.updateVisible(!1)}isParentLoaded(e){let t=e.parent;if(!t)return!0;let n=this.getTile(t?.key);return!!(n!=null&&n.isLoaded)}isChildrenLoaded(e){let t=e?.children;return t.length===0?!0:t.every(e=>{let t=this.getTile(e?.key);return t?t?.isLoaded===!0:!0})}render(){var e=this;return Z(function*(){let t=e.getRenderLayers().map(function(){var t=Z(function*(t){yield e.layerService.renderTileLayer(t)});return function(e){return t.apply(this,arguments)}}());yield Promise.all(t)})()}getRenderLayers(){let e=this.layerTiles.filter(e=>e.visible&&e.isLoaded),t=[];return e.map(e=>t.push(...e.getLayers())),t}getLayers(){let e=this.layerTiles.filter(e=>e.isLoaded),t=[];return e.map(e=>t.push(...e.getLayers())),t}getTiles(){return this.layerTiles}destroy(){this.layerTiles.forEach(e=>e.destroy()),this.tileResource.clear()}}})),IB=s(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n=typeof globalThis<`u`?globalThis:n||self,n.polygonClipping=r())})(e,(function(){function e(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==`function`&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return c([e,t])}}function c(o){if(r)throw TypeError(`Generator is already executing.`);for(;n;)try{if(r=1,i&&(a=o[0]&2?i.return:o[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;switch(i=0,a&&(o=[o[0]&2,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,i=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if((a=n.trys,!(a=a.length>0&&a[a.length-1]))&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!a||o[1]>a[0]&&o[1]<a[3])){n.label=o[1];break}if(o[0]===6&&n.label<a[1]){n.label=a[1],a=o;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(o);break}a[2]&&n.ops.pop(),n.trys.pop();continue}o=t.call(e,n)}catch(e){o=[6,e],i=0}finally{r=a=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}var t=function(){function e(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return e}();function n(e,t){return e>t?1:e<t?-1:0}function r(e,n,r){for(var i=new t(null,null),a=i,o=i;;){var s=r(e,n.key);if(s<0){if(n.left===null)break;if(r(e,n.left.key)<0){var c=n.left;if(n.left=c.right,c.right=n,n=c,n.left===null)break}o.left=n,o=n,n=n.left}else if(s>0){if(n.right===null)break;if(r(e,n.right.key)>0){var c=n.right;if(n.right=c.left,c.left=n,n=c,n.right===null)break}a.right=n,a=n,n=n.right}else break}return a.right=n.left,o.left=n.right,n.left=i.right,n.right=i.left,n}function i(e,n,i,a){var o=new t(e,n);if(i===null)return o.left=o.right=null,o;i=r(e,i,a);var s=a(e,i.key);return s<0?(o.left=i.left,o.right=i,i.left=null):s>=0&&(o.right=i.right,o.left=i,i.right=null),o}function a(e,t,n){var i=null,a=null;if(t){t=r(e,t,n);var o=n(t.key,e);o===0?(i=t.left,a=t.right):o<0?(a=t.right,t.right=null,i=t):(i=t.left,t.left=null,a=t)}return{left:i,right:a}}function o(e,t,n){return t===null?e:e===null?t:(t=r(e.key,t,n),t.left=e,t)}function s(e,t,n,r,i){if(e){r(``+t+(n?`└── `:`├── `)+i(e)+`
`);var a=t+(n?`    `:`│   `);e.left&&s(e.left,a,!1,r,i),e.right&&s(e.right,a,!0,r,i)}}var c=function(){function c(e){e===void 0&&(e=n),this._root=null,this._size=0,this._comparator=e}return c.prototype.insert=function(e,t){return this._size++,this._root=i(e,t,this._root,this._comparator)},c.prototype.add=function(e,n){var i=new t(e,n);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var a=this._comparator,o=r(e,this._root,a),s=a(e,o.key);return s===0?this._root=o:(s<0?(i.left=o.left,i.right=o,o.left=null):s>0&&(i.right=o.right,i.left=o,o.right=null),this._size++,this._root=i),this._root},c.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},c.prototype._remove=function(e,t,n){var i;return t===null?null:(t=r(e,t,n),n(e,t.key)===0?(t.left===null?i=t.right:(i=r(e,t.left,n),i.right=t.right),this._size--,i):t)},c.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=r(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},c.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(r===0)return t;t=r<0?t.left:t.right}return null},c.prototype.find=function(e){return this._root&&(this._root=r(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},c.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(r===0)return!0;t=r<0?t.left:t.right}return!1},c.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)n===null?r.length===0?i=!0:(n=r.pop(),e.call(t,n),n=n.right):(r.push(n),n=n.left);return this},c.prototype.range=function(e,t,n,r){for(var i=[],a=this._comparator,o=this._root,s;i.length!==0||o;)if(o)i.push(o),o=o.left;else{if(o=i.pop(),s=a(o.key,t),s>0)break;if(a(o.key,e)>=0&&n.call(r,o))return this;o=o.right}return this},c.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},c.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},c.prototype.min=function(){return this._root?this.minNode(this._root).key:null},c.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},c.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},c.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},c.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},c.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(i===0)break;i<0?(n=t,t=t.left):t=t.right}return n},c.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(i===0)break;i<0?t=t.left:(n=t,t=t.right)}return n},c.prototype.clear=function(){return this._root=null,this._size=0,this},c.prototype.toList=function(){return d(this._root)},c.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var r=e.length,i=this._comparator;if(n&&m(e,t,0,r-1,i),this._root===null)this._root=l(e,t,0,r),this._size=r;else{var a=p(this.toList(),u(e,t),i);r=this._size+r,this._root=f({head:a},0,r)}return this},c.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(c.prototype,`size`,{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,`root`,{get:function(){return this._root},enumerable:!0,configurable:!0}),c.prototype.toString=function(e){e===void 0&&(e=function(e){return String(e.key)});var t=[];return s(this._root,``,!0,function(e){return t.push(e)},e),t.join(``)},c.prototype.update=function(e,t,n){var r=this._comparator,s=a(e,this._root,r),c=s.left,l=s.right;r(e,t)<0?l=i(t,n,l,r):c=i(t,n,c,r),this._root=o(c,l,r)},c.prototype.split=function(e){return a(e,this._root,this._comparator)},c.prototype[Symbol.iterator]=function(){var t,n,r;return e(this,function(e){switch(e.label){case 0:t=this._root,n=[],r=!1,e.label=1;case 1:return r?[3,6]:t===null?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return n.length===0?[3,4]:(t=n.pop(),[4,t]);case 3:return e.sent(),t=t.right,[3,5];case 4:r=!0,e.label=5;case 5:return[3,1];case 6:return[2]}})},c}();function l(e,n,r,i){var a=i-r;if(a>0){var o=r+Math.floor(a/2),s=e[o],c=n[o],u=new t(s,c);return u.left=l(e,n,r,o),u.right=l(e,n,o+1,i),u}return null}function u(e,n){for(var r=new t(null,null),i=r,a=0;a<e.length;a++)i=i.next=new t(e[a],n[a]);return i.next=null,r.next}function d(e){for(var n=e,r=[],i=!1,a=new t(null,null),o=a;!i;)n?(r.push(n),n=n.left):r.length>0?(n=o=o.next=r.pop(),n=n.right):i=!0;return o.next=null,a.next}function f(e,t,n){var r=n-t;if(r>0){var i=t+Math.floor(r/2),a=f(e,t,i),o=e.head;return o.left=a,e.head=e.head.next,o.right=f(e,i+1,n),o}return null}function p(e,n,r){for(var i=new t(null,null),a=i,o=e,s=n;o!==null&&s!==null;)r(o.key,s.key)<0?(a.next=o,o=o.next):(a.next=s,s=s.next),a=a.next;return o===null?s!==null&&(a.next=s):a.next=o,i.next}function m(e,t,n,r,i){if(!(n>=r)){for(var a=e[n+r>>1],o=n-1,s=r+1;;){do o++;while(i(e[o],a)<0);do s--;while(i(e[s],a)>0);if(o>=s)break;var c=e[o];e[o]=e[s],e[s]=c,c=t[o],t[o]=t[s],t[s]=c}m(e,t,n,s,i),m(e,t,s+1,r,i)}}let h=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,g=(e,t)=>{if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;let n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,a=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:a}}},_=2**-52;_===void 0&&(_=2**-52);let v=_*_,y=(e,t)=>{if(-_<e&&e<_&&-_<t&&t<_)return 0;let n=e-t;return n*n<v*e*t?0:e<t?-1:1};class b{constructor(){this.reset()}reset(){this.xRounder=new x,this.yRounder=new x}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class x{constructor(){this.tree=new c,this.round(0)}round(e){let t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&y(t.key,n.key)===0)return this.tree.remove(e),n.key;let r=this.tree.next(t);return r!==null&&y(t.key,r.key)===0?(this.tree.remove(e),r.key):e}}let S=new b,C=11102230246251565e-32,w=134217729;(3+8*C)*C;function E(e,t,n,r,i){let a,o,s,c,l=t[0],u=r[0],d=0,f=0;u>l==u>-l?(a=l,l=t[++d]):(a=u,u=r[++f]);let p=0;if(d<e&&f<n)for(u>l==u>-l?(o=l+a,s=a-(o-l),l=t[++d]):(o=u+a,s=a-(o-u),u=r[++f]),a=o,s!==0&&(i[p++]=s);d<e&&f<n;)u>l==u>-l?(o=a+l,c=o-a,s=a-(o-c)+(l-c),l=t[++d]):(o=a+u,c=o-a,s=a-(o-c)+(u-c),u=r[++f]),a=o,s!==0&&(i[p++]=s);for(;d<e;)o=a+l,c=o-a,s=a-(o-c)+(l-c),l=t[++d],a=o,s!==0&&(i[p++]=s);for(;f<n;)o=a+u,c=o-a,s=a-(o-c)+(u-c),u=r[++f],a=o,s!==0&&(i[p++]=s);return(a!==0||p===0)&&(i[p++]=a),p}function D(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}function O(e){return new Float64Array(e)}(3+16*C)*C,(2+12*C)*C,(9+64*C)*C*C;let k=O(4),A=O(8),j=O(12),M=O(16),N=O(4);function P(e,t,n,r,i,a,o){let s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,O,P=e-i,F=n-i,I=t-a,ee=r-a;b=P*ee,f=w*P,p=f-(f-P),m=P-p,f=w*ee,h=f-(f-ee),g=ee-h,x=m*g-(b-p*h-m*h-p*g),S=I*F,f=w*I,p=f-(f-I),m=I-p,f=w*F,h=f-(f-F),g=F-h,C=m*g-(S-p*h-m*h-p*g),_=x-C,d=x-_,k[0]=x-(_+d)+(d-C),v=b+_,d=v-b,y=b-(v-d)+(_-d),_=y-S,d=y-_,k[1]=y-(_+d)+(d-S),O=v+_,d=O-v,k[2]=v-(O-d)+(_-d),k[3]=O;let R=D(4,k),z=22204460492503146e-32*o;if(R>=z||-R>=z||(d=e-P,s=e-(P+d)+(d-i),d=n-F,l=n-(F+d)+(d-i),d=t-I,c=t-(I+d)+(d-a),d=r-ee,u=r-(ee+d)+(d-a),s===0&&c===0&&l===0&&u===0)||(z=11093356479670487e-47*o+33306690738754706e-32*Math.abs(R),R+=P*u+ee*s-(I*l+F*c),R>=z||-R>=z))return R;b=s*ee,f=w*s,p=f-(f-s),m=s-p,f=w*ee,h=f-(f-ee),g=ee-h,x=m*g-(b-p*h-m*h-p*g),S=c*F,f=w*c,p=f-(f-c),m=c-p,f=w*F,h=f-(f-F),g=F-h,C=m*g-(S-p*h-m*h-p*g),_=x-C,d=x-_,N[0]=x-(_+d)+(d-C),v=b+_,d=v-b,y=b-(v-d)+(_-d),_=y-S,d=y-_,N[1]=y-(_+d)+(d-S),O=v+_,d=O-v,N[2]=v-(O-d)+(_-d),N[3]=O;let B=E(4,k,4,N,A);b=P*u,f=w*P,p=f-(f-P),m=P-p,f=w*u,h=f-(f-u),g=u-h,x=m*g-(b-p*h-m*h-p*g),S=I*l,f=w*I,p=f-(f-I),m=I-p,f=w*l,h=f-(f-l),g=l-h,C=m*g-(S-p*h-m*h-p*g),_=x-C,d=x-_,N[0]=x-(_+d)+(d-C),v=b+_,d=v-b,y=b-(v-d)+(_-d),_=y-S,d=y-_,N[1]=y-(_+d)+(d-S),O=v+_,d=O-v,N[2]=v-(O-d)+(_-d),N[3]=O;let te=E(B,A,4,N,j);return b=s*u,f=w*s,p=f-(f-s),m=s-p,f=w*u,h=f-(f-u),g=u-h,x=m*g-(b-p*h-m*h-p*g),S=c*l,f=w*c,p=f-(f-c),m=c-p,f=w*l,h=f-(f-l),g=l-h,C=m*g-(S-p*h-m*h-p*g),_=x-C,d=x-_,N[0]=x-(_+d)+(d-C),v=b+_,d=v-b,y=b-(v-d)+(_-d),_=y-S,d=y-_,N[1]=y-(_+d)+(d-S),O=v+_,d=O-v,N[2]=v-(O-d)+(_-d),N[3]=O,M[E(te,j,4,N,M)-1]}function F(e,t,n,r,i,a){let o=(t-a)*(n-i),s=(e-i)*(r-a),c=o-s,l=Math.abs(o+s);return Math.abs(c)>=33306690738754716e-32*l?c:-P(e,t,n,r,i,a,l)}let I=(e,t)=>e.x*t.y-e.y*t.x,ee=(e,t)=>e.x*t.x+e.y*t.y,R=(e,t,n)=>{let r=F(e.x,e.y,t.x,t.y,n.x,n.y);return r>0?-1:r<0?1:0},z=e=>Math.sqrt(ee(e,e)),B=(e,t,n)=>{let r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return I(i,r)/z(i)/z(r)},te=(e,t,n)=>{let r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return ee(i,r)/z(i)/z(r)},ne=(e,t,n)=>t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n},re=(e,t,n)=>t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)},V=(e,t,n,r)=>{if(t.x===0)return re(n,r,e.x);if(r.x===0)return re(e,t,n.x);if(t.y===0)return ne(n,r,e.y);if(r.y===0)return ne(e,t,n.y);let i=I(t,r);if(i==0)return null;let a={x:n.x-e.x,y:n.y-e.y},o=I(a,t)/i,s=I(a,r)/i,c=e.x+s*t.x,l=n.x+o*r.x,u=e.y+s*t.y,d=n.y+o*r.y;return{x:(c+l)/2,y:(u+d)/2}};class ie{static compare(e,t){let n=ie.comparePoints(e.point,t.point);return n===0?(e.point!==t.point&&e.link(t),e.isLeft===t.isLeft?oe.compare(e.segment,t.segment):e.isLeft?1:-1):n}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw Error(`Tried to link already linked events`);let t=e.point.events;for(let e=0,n=t.length;e<n;e++){let n=t[e];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}checkForConsuming(){let e=this.point.events.length;for(let t=0;t<e;t++){let n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let r=t+1;r<e;r++){let e=this.point.events[r];e.consumedBy===void 0&&n.otherSE.point.events===e.otherSE.point.events&&n.segment.consume(e.segment)}}}getAvailableLinkedEvents(){let e=[];for(let t=0,n=this.point.events.length;t<n;t++){let n=this.point.events[t];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){let t=new Map,n=n=>{let r=n.otherSE;t.set(n,{sine:B(this.point,e.point,r.point),cosine:te(this.point,e.point,r.point)})};return(e,r)=>{t.has(e)||n(e),t.has(r)||n(r);let{sine:i,cosine:a}=t.get(e),{sine:o,cosine:s}=t.get(r);return i>=0&&o>=0?a<s?1:a>s?-1:0:i<0&&o<0?a<s?-1:a>s?1:0:o<i?-1:o>i?1:0}}}let ae=0;class oe{static compare(e,t){let n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,a=t.rightSE.point.x;if(a<n)return 1;if(i<r)return-1;let o=e.leftSE.point.y,s=t.leftSE.point.y,c=e.rightSE.point.y,l=t.rightSE.point.y;if(n<r){if(s<o&&s<c)return 1;if(s>o&&s>c)return-1;let n=e.comparePoint(t.leftSE.point);if(n<0)return 1;if(n>0)return-1;let r=t.comparePoint(e.rightSE.point);return r===0?-1:r}if(n>r){if(o<s&&o<l)return-1;if(o>s&&o>l)return 1;let n=t.comparePoint(e.leftSE.point);if(n!==0)return n;let r=e.comparePoint(t.rightSE.point);return r<0?1:r>0?-1:1}if(o<s)return-1;if(o>s)return 1;if(i<a){let n=t.comparePoint(e.rightSE.point);if(n!==0)return n}if(i>a){let n=e.comparePoint(t.rightSE.point);if(n<0)return 1;if(n>0)return-1}if(i!==a){let e=c-o,t=i-n,u=l-s,d=a-r;if(e>t&&u<d)return 1;if(e<t&&u>d)return-1}return i>a?1:i<a||c<l?-1:c>l?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,r){this.id=++ae,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=r}static fromRing(e,t,n){let r,i,a,o=ie.comparePoints(e,t);if(o<0)r=e,i=t,a=1;else if(o>0)r=t,i=e,a=-1;else throw Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);return new oe(new ie(r,!0),new ie(i,!1),[n],[a])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;let t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;let i=(e.y-t.y)/r.y,a=t.x+i*r.x;if(e.x===a)return 0;let o=(e.x-t.x)/r.x,s=t.y+o*r.y;return e.y===s?0:e.y<s?-1:1}getIntersection(e){let t=this.bbox(),n=e.bbox(),r=g(t,n);if(r===null)return null;let i=this.leftSE.point,a=this.rightSE.point,o=e.leftSE.point,s=e.rightSE.point,c=h(t,o)&&this.comparePoint(o)===0,l=h(n,i)&&e.comparePoint(i)===0,u=h(t,s)&&this.comparePoint(s)===0,d=h(n,a)&&e.comparePoint(a)===0;if(l&&c)return d&&!u?a:!d&&u?s:null;if(l)return u&&i.x===s.x&&i.y===s.y?null:i;if(c)return d&&a.x===o.x&&a.y===o.y?null:o;if(d&&u)return null;if(d)return a;if(u)return s;let f=V(i,this.vector(),o,e.vector());return f===null||!h(r,f)?null:S.round(f.x,f.y)}split(e){let t=[],n=e.events!==void 0,r=new ie(e,!0),i=new ie(e,!1),a=this.rightSE;this.replaceRightSE(i),t.push(i),t.push(r);let o=new oe(r,a,this.rings.slice(),this.windings.slice());return ie.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),ie.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(r.checkForConsuming(),i.checkForConsuming()),t}swapEvents(){let e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,t=this.windings.length;e<t;e++)this.windings[e]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;let r=oe.compare(t,n);if(r!==0){if(r>0){let e=t;t=n,n=e}if(t.prev===n){let e=t;t=n,n=e}for(let e=0,r=n.rings.length;e<r;e++){let r=n.rings[e],i=n.windings[e],a=t.rings.indexOf(r);a===-1?(t.rings.push(r),t.windings.push(i)):t.windings[a]+=i}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult===void 0&&(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){return this._beforeState===void 0&&(this.prev?this._beforeState=(this.prev.consumedBy||this.prev).afterState():this._beforeState={rings:[],windings:[],multiPolys:[]}),this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};let t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys;for(let e=0,r=this.rings.length;e<r;e++){let r=this.rings[e],i=this.windings[e],a=t.indexOf(r);a===-1?(t.push(r),n.push(i)):n[a]+=i}let i=[],a=[];for(let e=0,r=t.length;e<r;e++){if(n[e]===0)continue;let r=t[e],o=r.poly;if(a.indexOf(o)===-1)if(r.isExterior)i.push(o);else{a.indexOf(o)===-1&&a.push(o);let e=i.indexOf(r.poly);e!==-1&&i.splice(e,1)}}for(let e=0,t=i.length;e<t;e++){let t=i[e].multiPoly;r.indexOf(t)===-1&&r.push(t)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(W.type){case`union`:this._isInResult=e.length===0!=(t.length===0);break;case`intersection`:{let n,r;e.length<t.length?(n=e.length,r=t.length):(n=t.length,r=e.length),this._isInResult=r===W.numMultiPolys&&n<r;break}case`xor`:this._isInResult=Math.abs(e.length-t.length)%2==1;break;case`difference`:{let n=e=>e.length===1&&e[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw Error(`Unrecognized operation type found ${W.type}`)}return this._isInResult}}class se{constructor(e,t,n){if(!Array.isArray(e)||e.length===0||(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!=`number`||typeof e[0][1]!=`number`))throw Error(`Input geometry is not a valid Polygon or MultiPolygon`);let r=S.round(e[0][0],e[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let t=1,n=e.length;t<n;t++){if(typeof e[t][0]!=`number`||typeof e[t][1]!=`number`)throw Error(`Input geometry is not a valid Polygon or MultiPolygon`);let n=S.round(e[t][0],e[t][1]);n.x===i.x&&n.y===i.y||(this.segments.push(oe.fromRing(i,n,this)),n.x<this.bbox.ll.x&&(this.bbox.ll.x=n.x),n.y<this.bbox.ll.y&&(this.bbox.ll.y=n.y),n.x>this.bbox.ur.x&&(this.bbox.ur.x=n.x),n.y>this.bbox.ur.y&&(this.bbox.ur.y=n.y),i=n)}(r.x!==i.x||r.y!==i.y)&&this.segments.push(oe.fromRing(i,r,this))}getSweepEvents(){let e=[];for(let t=0,n=this.segments.length;t<n;t++){let n=this.segments[t];e.push(n.leftSE),e.push(n.rightSE)}return e}}class ce{constructor(e,t){if(!Array.isArray(e))throw Error(`Input geometry is not a valid Polygon or MultiPolygon`);this.exteriorRing=new se(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,n=e.length;t<n;t++){let n=new se(e[t],this,!1);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=t}getSweepEvents(){let e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){let n=this.interiorRings[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}}class H{constructor(e,t){if(!Array.isArray(e))throw Error(`Input geometry is not a valid Polygon or MultiPolygon`);try{typeof e[0][0][0]==`number`&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:1/0,y:1/0},ur:{x:-1/0,y:-1/0}};for(let t=0,n=e.length;t<n;t++){let n=new ce(e[t],this);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=t}getSweepEvents(){let e=[];for(let t=0,n=this.polys.length;t<n;t++){let n=this.polys[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}}class le{static factory(e){let t=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];if(!r.isInResult()||r.ringOut)continue;let i=null,a=r.leftSE,o=r.rightSE,s=[a],c=a.point,l=[];for(;i=a,a=o,s.push(a),a.point!==c;)for(;;){let e=a.getAvailableLinkedEvents();if(e.length===0){let e=s[0].point,t=s[s.length-1].point;throw Error(`Unable to complete output ring starting at [${e.x}, ${e.y}]. Last matching segment found ends at [${t.x}, ${t.y}].`)}if(e.length===1){o=e[0].otherSE;break}let n=null;for(let e=0,t=l.length;e<t;e++)if(l[e].point===a.point){n=e;break}if(n!==null){let e=l.splice(n)[0],r=s.splice(e.index);r.unshift(r[0].otherSE),t.push(new le(r.reverse()));continue}l.push({index:s.length,point:a.point});let r=a.getLeftmostComparator(i);o=e.sort(r)[0].otherSE;break}t.push(new le(s))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point,t=[e];for(let n=1,r=this.events.length-1;n<r;n++){let r=this.events[n].point,i=this.events[n+1].point;R(r,e,i)!==0&&(t.push(r),e=r)}if(t.length===1)return null;let n=t[0],r=t[1];R(n,e,r)===0&&t.shift(),t.push(t[0]);let i=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:t.length-1,o=this.isExteriorRing()?t.length:-1,s=[];for(let e=a;e!=o;e+=i)s.push([t[e].x,t[e].y]);return s}isExteriorRing(){if(this._isExteriorRing===void 0){let e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let t=1,n=this.events.length;t<n;t++){let n=this.events[t];ie.compare(e,n)>0&&(e=n)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()===t.ringOut?t.ringOut.enclosingRing():t.ringOut;t=n.prevInResult(),n=t?t.prevInResult():null}}}class ue{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){let e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){let n=this.interiorRings[t].getGeom();n!==null&&e.push(n)}return e}}class de{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){let e=[];for(let t=0,n=this.polys.length;t<n;t++){let n=this.polys[t].getGeom();n!==null&&e.push(n)}return e}_composePolys(e){let t=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];if(!r.poly)if(r.isExteriorRing())t.push(new ue(r));else{let e=r.enclosingRing();e.poly||t.push(new ue(e)),e.poly.addInterior(r)}}return t}}class U{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:oe.compare;this.queue=e,this.tree=new c(t),this.segments=[]}process(e){let t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;let r=e.isLeft?this.tree.add(t):this.tree.find(t);if(!r)throw Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let i=r,a=r,o,s;for(;o===void 0;)i=this.tree.prev(i),i===null?o=null:i.key.consumedBy===void 0&&(o=i.key);for(;s===void 0;)a=this.tree.next(a),a===null?s=null:a.key.consumedBy===void 0&&(s=a.key);if(e.isLeft){let r=null;if(o){let e=o.getIntersection(t);if(e!==null&&(t.isAnEndpoint(e)||(r=e),!o.isAnEndpoint(e))){let t=this._splitSafely(o,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}let i=null;if(s){let e=s.getIntersection(t);if(e!==null&&(t.isAnEndpoint(e)||(i=e),!s.isAnEndpoint(e))){let t=this._splitSafely(s,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}if(r!==null||i!==null){let e=null;e=r===null?i:i===null||ie.comparePoints(r,i)<=0?r:i,this.queue.remove(t.rightSE),n.push(t.rightSE);let a=t.split(e);for(let e=0,t=a.length;e<t;e++)n.push(a[e])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=o)}else{if(o&&s){let e=o.getIntersection(s);if(e!==null){if(!o.isAnEndpoint(e)){let t=this._splitSafely(o,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}if(!s.isAnEndpoint(e)){let t=this._splitSafely(s,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);let n=e.rightSE;this.queue.remove(n);let r=e.split(t);return r.push(n),e.consumedBy===void 0&&this.tree.add(e),r}}let fe=typeof process<`u`&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,pe=typeof process<`u`&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class me{run(e,t,n){W.type=e,S.reset();let r=[new H(t,!0)];for(let e=0,t=n.length;e<t;e++)r.push(new H(n[e],!1));if(W.numMultiPolys=r.length,W.type===`difference`){let e=r[0],t=1;for(;t<r.length;)g(r[t].bbox,e.bbox)===null?r.splice(t,1):t++}if(W.type===`intersection`)for(let e=0,t=r.length;e<t;e++){let t=r[e];for(let n=e+1,i=r.length;n<i;n++)if(g(t.bbox,r[n].bbox)===null)return[]}let i=new c(ie.compare);for(let e=0,t=r.length;e<t;e++){let t=r[e].getSweepEvents();for(let e=0,n=t.length;e<n;e++)if(i.insert(t[e]),i.size>fe)throw Error(`Infinite loop when putting segment endpoints in a priority queue (queue size too big).`)}let a=new U(i),o=i.size,s=i.pop();for(;s;){let e=s.key;if(i.size===o){let t=e.segment;throw Error(`Unable to pop() ${e.isLeft?`left`:`right`} SweepEvent [${e.point.x}, ${e.point.y}] from segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] from queue.`)}if(i.size>fe)throw Error(`Infinite loop when passing sweep line over endpoints (queue size too big).`);if(a.segments.length>pe)throw Error(`Infinite loop when passing sweep line over endpoints (too many sweep line segments).`);let t=a.process(e);for(let e=0,n=t.length;e<n;e++){let n=t[e];n.consumedBy===void 0&&i.insert(n)}o=i.size,s=i.pop()}return S.reset(),new de(le.factory(a.segments)).getGeom()}}let W=new me;return{union:function(e){var t=[...arguments].slice(1);return W.run(`union`,e,t)},intersection:function(e){var t=[...arguments].slice(1);return W.run(`intersection`,e,t)},xor:function(e){var t=[...arguments].slice(1);return W.run(`xor`,e,t)},difference:function(e){var t=[...arguments].slice(1);return W.run(`difference`,e,t)}}}))}));function LB(e,t,n){n===void 0&&(n={});var r=Bm(e),i=Bm(t),a=RB.default.union(r.coordinates,i.coordinates);return a.length===0?null:a.length===1?qu(a[0],n.properties):Xu(a,n.properties)}var RB,zB=o((()=>{RB=u(IB()),Vm(),nd()})),BB,VB=o((()=>{cv(),nd(),zB(),BB=class{getCombineFeature(e){let t=null,n=e[0];return e.map(e=>{let n=qu(e.coordinates);t=t===null?n:LB(t,n)}),n&&(t.properties=Y({},n)),t}}})),HB,UB,WB,GB=o((()=>{Py(),ov(),kp(),VB(),HB=`select`,UB=`active`,WB=class{constructor({layerService:e,tileLayerService:t,parent:n}){J(this,`layerService`,void 0),J(this,`tileLayerService`,void 0),J(this,`tileSourceService`,void 0),J(this,`parent`,void 0),J(this,`tilePickID`,new Map),this.layerService=e,this.tileLayerService=t,this.parent=n,this.tileSourceService=new BB}pickRender(e){let t=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);t&&t.getMainLayer()?.layerPickService.pickRender(e)}pick(e,t){var n=this;return Z(function*(){let r=n.parent.getContainer().pickingService;if(e.type===`RasterLayer`){let e=n.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(e&&e.getMainLayer()!==void 0){let r=e.getMainLayer();return r.layerPickService.pickRasterLayer(r,t,n.parent)}return!1}return n.pickRender(t),r.pickFromPickingFBO(e,t)})()}selectFeature(e){let[t,n,r]=e,i=this.color2PickId(t,n,r);this.tilePickID.set(HB,i),this.updateHighLight(t,n,r,HB)}highlightPickedFeature(e){let[t,n,r]=e,i=this.color2PickId(t,n,r);this.tilePickID.set(UB,i),this.updateHighLight(t,n,r,UB)}updateHighLight(e,t,n,r){this.tileLayerService.tiles.map(i=>{let a=i.getMainLayer();switch(r){case HB:a?.hooks.beforeSelect.call([e,t,n]);break;case UB:a?.hooks.beforeHighlight.call([e,t,n]);break}})}setPickState(){let e=this.tilePickID.get(HB),t=this.tilePickID.get(UB);if(e){let[t,n,r]=this.pickId2Color(e);this.updateHighLight(t,n,r,HB);return}if(t){let[e,n,r]=this.pickId2Color(t);this.updateHighLight(e,n,r,UB);return}}color2PickId(e,t,n){return Rs(new Uint8Array([e,t,n]))}pickId2Color(e){return zs(e)}getFeatureById(e){let t=this.tileLayerService.getTiles().filter(e=>e.visible),n=[];return t.forEach(t=>{n.push(...t.getFeatureById(e))}),n}pickRasterLayer(){return!1}}}));function KB(e){return e===`PolygonLayer`?mB:e===`LineLayer`?OR:Fz}function qB(e){return[`PolygonLayer`,`LineLayer`].indexOf(e)!==-1}var JB=o((()=>{kR(),Iz(),hB()})),YB,XB,ZB=o((()=>{Py(),cv(),ov(),UC(),YB=u(Mf()),hB(),JB(),XB=class extends YB.EventEmitter{constructor(e,t){super(),J(this,`x`,void 0),J(this,`y`,void 0),J(this,`z`,void 0),J(this,`key`,void 0),J(this,`parent`,void 0),J(this,`sourceTile`,void 0),J(this,`visible`,!0),J(this,`layers`,[]),J(this,`isLoaded`,!1),J(this,`tileMaskLayers`,[]),J(this,`tileMask`,void 0),this.parent=t,this.sourceTile=e,this.x=e.x,this.y=e.y,this.z=e.z,this.key=`${this.x}_${this.y}_${this.z}`}getLayers(){return this.layers}styleUpdate(...e){}lnglatInBounds(e){let[t,n,r,i]=this.sourceTile.bounds,{lng:a,lat:o}=e;return a>=t&&a<=r&&o>=n&&o<=i}getLayerOptions(){let e=this.parent.getLayerConfig();return Y(Y({},e),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:qB(this.parent.type),mask:e.mask||e.maskLayers?.length!==0&&e.enableMask})}getMaskLayer(){let{maskLayers:e}=this.parent.getLayerConfig(),t=[];return e?.forEach(e=>{if(!e.tileLayer)return t.push(e),e;let n=e.tileLayer.getTile(this.sourceTile.key)?.getLayers()[0];n&&t.push(n)}),t}addTileMask(){var e=this;return Z(function*(){let t=new mB({name:`mask`,visible:!0,enablePicking:!1}).source({type:`FeatureCollection`,features:[e.sourceTile.bboxPolygon]},{parser:{type:`geojson`,featureId:`id`}}).shape(`fill`).color(`#0f0`).style({opacity:.5}),n=EC(e.parent.container);t.setContainer(n),yield t.init(),e.tileMask=t;let r=e.getMainLayer();return r!==void 0&&(r.tileMask=t),t})()}addMask(e,t){var n=this;return Z(function*(){let r=EC(n.parent.container);t.setContainer(r),yield t.init(),e.addMask(t),n.tileMaskLayers.push(t)})()}addLayer(e){var t=this;return Z(function*(){e.isTileLayer=!0;let n=EC(t.parent.container);e.setContainer(n),t.layers.push(e),yield e.init()})()}updateVisible(e){this.visible=e,this.updateOptions(`visible`,e)}updateOptions(e,t){this.layers.forEach(n=>{n.updateLayerConfig({[e]:t})})}getMainLayer(){return this.layers[0]}getFeatures(e){return[]}getFeatureById(e){return[]}destroy(){var e;(e=this.tileMask)==null||e.destroy(),this.layers.forEach(e=>e.destroy())}}})),QB,$B=o((()=>{Py(),kR(),Iz(),ZB(),QB=class extends XB{initTileLayer(){var e=this;return Z(function*(){let t=e.getSourceOption(),n=t.data.features[0].properties,r=new OR().source(t.data,t.options).size(1).shape(`line`).color(`red`),i=new Fz({minZoom:e.z-1,maxZoom:e.z+1,textAllowOverlap:!0}).source([n],{parser:{type:`json`,x:`x`,y:`y`}}).size(20).color(`red`).shape(e.key).style({stroke:`#fff`,strokeWidth:2});yield e.addLayer(r),yield e.addLayer(i),e.isLoaded=!0})()}getSourceOption(){let e=this.parent.getSource();return{data:{type:`FeatureCollection`,features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:`geojson`},transforms:e.transforms}}}}})),eV,tV=o((()=>{cv(),Py(),jL(),ZB(),eV=class extends XB{initTileLayer(){var e=this;return Z(function*(){let t=e.parent.getLayerAttributeConfig(),n=e.getLayerOptions(),r=e.getSourceOption(),i=new AL(Y({},n)).source(r.data,r.options);t&&Object.keys(t).forEach(e=>{let n=e;i[n](t[n]?.field,t[n]?.values)}),yield e.addLayer(i),e.isLoaded=!0})()}getSourceOption(){let e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:`image`,extent:this.sourceTile.bounds},transforms:e.transforms}}}}})),nV,rV,iV,aV=o((()=>{Py(),cv(),kp(),dF(),TI(),nV=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,rV=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`,iV=class extends uF{getUninforms(){let e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Y(Y({},e.uniformsOption),t.uniformsOption)}getCommonUniformsInfo(){let{opacity:e=1,color:t=`#000`}=this.layer.getLayerConfig(),n={u_color:Ls(t),u_opacity:e||1};return this.getUniformsBufferInfo(n)}initModels(){var e=this;return Z(function*(){return e.buildModels()})()}buildModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),[yield e.layer.buildLayerModel({moduleName:`mask`,vertexShader:rV,fragmentShader:nV,defines:e.getDefines(),triangulation:uI,depth:{enable:!1},pick:!1})]})()}clearModels(e=!0){e&&this.layerService.clear()}registerBuiltinAttributes(){return``}}})),oV,sV=o((()=>{aV(),oV={fill:iV}})),cV,lV=o((()=>{Py(),ov(),XP(),sV(),cV=class extends YP{constructor(...e){super(...e),J(this,`type`,`MaskLayer`)}buildModels(){var e=this;return Z(function*(){e.layerModel=new oV[e.getModelType()](e),yield e.initLayerModels()})()}getModelType(){return`fill`}}})),uV,dV=o((()=>{cv(),Py(),lV(),ZB(),uV=class extends XB{initTileLayer(){var e=this;return Z(function*(){let t=e.parent.getLayerAttributeConfig(),n=e.getLayerOptions(),r=e.getSourceOption(),i=new cV(Y({},n)).source(r.data,r.options);t&&Object.keys(t).forEach(e=>{let n=e;i[n](t[n]?.field,t[n]?.values)}),yield e.addLayer(i),e.isLoaded=!0})()}getFeatures(e){return e?this.sourceTile.data.getTileData(e):[]}getSourceOption(){let e=this.parent.getSource(),{sourceLayer:t,featureId:n}=this.parent.getLayerConfig();return{data:{type:`FeatureCollection`,features:this.getFeatures(t)},options:{parser:{type:`geojson`,featureId:n},transforms:e.transforms}}}}})),fV,pV,mV=o((()=>{Ix(),cv(),Py(),NB(),ZB(),fV=[`rasterData`],pV=class extends XB{initTileLayer(){var e=this;return Z(function*(){let t=e.parent.getLayerAttributeConfig(),n=e.getLayerOptions(),r=e.getSourceOption(),i=new MB(Y({},n)).source(r.data,r.options);t&&Object.keys(t).forEach(e=>{let n=e;i[n](t[n]?.field,t[n]?.values)}),yield e.addLayer(i),e.isLoaded=!0})()}getSourceOption(){let e=this.parent.getSource(),t=this.sourceTile.data.data,{rasterData:n}=t,r=Fx(t,fV);return{data:n,options:{parser:Y({type:`rasterRgb`,extent:this.sourceTile.bounds},r),transforms:e.transforms}}}}})),hV,gV=o((()=>{cv(),Py(),NB(),ZB(),hV=class extends XB{initTileLayer(){var e=this;return Z(function*(){let t=e.parent.getLayerAttributeConfig(),n=e.getLayerOptions(),r=e.getSourceOption(),i=new MB(Y({},n)).source(r.data,r.options);t&&Object.keys(t).forEach(e=>{let n=e;i[n](t[n]?.field,t[n]?.values)}),yield e.addLayer(i),e.isLoaded=!0})()}getSourceOption(){let e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:`image`,extent:this.sourceTile.bounds},transforms:e.transforms}}}}})),_V,vV,yV,bV=o((()=>{Ix(),cv(),Py(),ov(),kp(),NB(),ZB(),_V=[`rasterData`],vV={positions:[0,1],colors:[`#000`,`#fff`]},yV=class extends XB{constructor(...e){super(...e),J(this,`colorTexture`,void 0)}initTileLayer(){var e=this;return Z(function*(){let t=e.parent.getLayerAttributeConfig(),n=e.getLayerOptions(),r=e.getSourceOption(),{rampColors:i,domain:a}=e.getLayerOptions();e.colorTexture=e.parent.textureService.getColorTexture(i,a);let o=new MB(Y(Y({},n),{},{colorTexture:e.colorTexture})).source(r.data,r.options);t&&Object.keys(t).forEach(e=>{let n=e;o[n](t[n]?.field,t[n]?.values)}),yield e.addLayer(o),e.isLoaded=!0})()}getSourceOption(){let e=this.parent.getSource(),t=this.sourceTile.data.data,{rasterData:n}=t,r=Fx(t,_V);return{data:n,options:{parser:Y({type:`raster`,extent:this.sourceTile.bounds},r),transforms:e.transforms}}}styleUpdate(...e){let{rampColors:t=vV,domain:n}=e;this.colorTexture=this.parent.textureService.getColorTexture(t,n||Ks(t)),this.layers.forEach(e=>e.style({colorTexture:this.colorTexture}))}destroy(){this.layers.forEach(e=>e.destroy())}}})),xV,SV=o((()=>{cv(),Py(),ZB(),JB(),xV=class extends XB{initTileLayer(){var e=this;return Z(function*(){let t=e.parent.getLayerAttributeConfig(),n=e.getLayerOptions(),r=KB(e.parent.type),i=e.getSourceOption();if(!i){e.isLoaded=!0,e.emit(`loaded`);return}let a=new r(Y({},n)).source(i.data,i.options);Object.keys(t).forEach(e=>{let n=e;a[n](t[n]?.field,t[n]?.values)}),yield e.addLayer(a),n.tileMask&&(yield e.addTileMask()),e.setLayerMinMaxZoom(a),e.isLoaded=!0,e.emit(`loaded`)})()}getSourceOption(){let e=this.parent.getSource(),{sourceLayer:t=`defaultLayer`,featureId:n=`id`}=this.parent.getLayerConfig();return{data:{type:`FeatureCollection`,features:this.getFeatures(t)},options:{parser:{type:`geojson`,featureId:n},transforms:e.transforms}}}setLayerMinMaxZoom(e){e.getModelType()===`text`&&e.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}getFeatures(e){return this.sourceTile.data.getTileData(e)}getFeatureById(e){let t=this.getMainLayer();return t?t.getSource().data.dataArray.filter(t=>t._id===e):[]}}})),CV=o((()=>{}));function wV(e){switch(e.type){case`PolygonLayer`:return xV;case`LineLayer`:return xV;case`PointLayer`:return xV;case`TileDebugLayer`:return QB;case`MaskLayer`:return uV;case`RasterLayer`:let{dataType:t}=e.getSource().parser;switch(t){case VC.RGB:case VC.CUSTOMRGB:return pV;case VC.ARRAYBUFFER:case VC.CUSTOMARRAYBUFFER:return yV;case VC.TERRAINRGB:case VC.CUSTOMTERRAINRGB:return hV;default:return eV}default:return xV}}var TV=o((()=>{UC(),$B(),tV(),dV(),mV(),gV(),bV(),SV(),CV(),ZB()})),EV,DV=o((()=>{EV=[`shape`,`color`,`size`,`style`,`animate`,`filter`,`rotate`,`scale`,`setBlend`,`setSelect`,`setActive`,`disableMask`,`enableMask`,`addMask`,`removeMask`]})),OV,kV,AV=o((()=>{Py(),ov(),kp(),FB(),GB(),TV(),DV(),{debounce:OV}=tu,kV=class{constructor(e){J(this,`parent`,void 0),J(this,`tileLayerService`,void 0),J(this,`mapService`,void 0),J(this,`layerService`,void 0),J(this,`rendererService`,void 0),J(this,`pickingService`,void 0),J(this,`tilePickService`,void 0),J(this,`tilesetManager`,void 0),J(this,`initedTileset`,!1),J(this,`lastViewStates`,void 0),J(this,`mapchange`,()=>{var e;if(this.parent.isVisible()===!1)return;let{latLonBounds:t,zoom:n}=this.getCurrentView();this.lastViewStates&&this.lastViewStates.zoom===n&&this.lastViewStates.latLonBounds.toString()===t.toString()||(this.lastViewStates={zoom:n,latLonBounds:t},(e=this.tilesetManager)==null||e.throttleUpdate(n,t))}),J(this,`viewchange`,OV(this.mapchange,24)),this.parent=e;let t=this.parent.getContainer();this.rendererService=t.rendererService,this.layerService=t.layerService,this.mapService=t.mapService,this.pickingService=t.pickingService,this.tileLayerService=new PB({rendererService:this.rendererService,layerService:this.layerService,parent:e}),this.tilePickService=new WB({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:e}),this.parent.setLayerPickService(this.tilePickService),this.proxy(e),this.initTileSetManager()}initTileSetManager(){var e;if(this.tilesetManager=this.parent.getSource().tileset,this.initedTileset||=(this.bindTilesetEvent(),!0),this.parent.isVisible()===!1)return;let{latLonBounds:t,zoom:n}=this.getCurrentView();(e=this.tilesetManager)==null||e.update(n,t)}getCurrentView(){let e=this.mapService.getBounds();return{latLonBounds:[e[0][0],e[0][1],e[1][0],e[1][1]],zoom:this.mapService.getZoom()}}bindTilesetEvent(){this.tilesetManager.on(`tile-loaded`,e=>{}),this.tilesetManager.on(`tile-unload`,e=>{this.tileUnLoad(e)}),this.tilesetManager.on(`tile-error`,(e,t)=>{this.tileError(e)}),this.tilesetManager.on(`tile-update`,()=>{this.tileUpdate()}),this.mapService.on(`zoomend`,this.mapchange),this.mapService.on(`moveend`,this.viewchange)}render(){this.tileLayerService.render()}getLayers(){return this.tileLayerService.getLayers()}getTiles(){return this.tileLayerService.getTiles()}getTile(e){return this.tileLayerService.getTile(e)}tileLoaded(e){}tileError(e){console.warn(`error:`,e)}destroy(){var e;this.mapService.off(`zoomend`,this.mapchange),this.mapService.off(`moveend`,this.viewchange),(e=this.tilesetManager)==null||e.destroy(),this.tileLayerService.destroy()}reload(){var e;this.tilesetManager.clear();let{latLonBounds:t,zoom:n}=this.getCurrentView();(e=this.tilesetManager)==null||e.update(n,t)}tileUnLoad(e){this.tileLayerService.removeTile(e.key)}tileUpdate(){var e=this;return Z(function*(){if(!e.tilesetManager)return;let t=e.parent.getMinZoom(),n=e.parent.getMaxZoom(),r=e.tilesetManager.tiles.filter(e=>e.isLoaded).filter(e=>e.isVisibleChange).filter(e=>e.data).filter(e=>e.z>=t&&e.z<n);yield Promise.all(r.map(function(){var t=Z(function*(t){if(e.tileLayerService.hasTile(t.key))e.tileLayerService.updateTileVisible(t),e.tilePickService.setPickState(),e.layerService.reRender();else{let n=new(wV(e.parent))(t,e.parent);yield n.initTileLayer(),e.tilePickService.setPickState(),n.getLayers().length!==0&&(e.tileLayerService.addTile(n),e.tileLayerService.updateTileVisible(t),e.layerService.reRender())}});return function(e){return t.apply(this,arguments)}}())),e.tilesetManager.isLoaded&&e.parent.emit(`tiles-loaded`,e.tilesetManager.currentTiles)})()}setPickState(e){}pickRender(e){this.tilePickService.pickRender(e)}selectFeature(e){this.tilePickService.selectFeature(e)}highlightPickedFeature(e){this.tilePickService.highlightPickedFeature(e)}proxy(e){EV.forEach(t=>{let n=e[t].bind(e);e[t]=(...r)=>(n(...r),this.getLayers().map(e=>{e[t](...r)}),t===`style`&&this.getTiles().forEach(e=>e.styleUpdate(...r)),e)})}}})),jV,MV=o((()=>{Py(),ov(),XP(),jV=class extends YP{constructor(...e){super(...e),J(this,`type`,`TileDebugLayer`),J(this,`zIndex`,1e4),J(this,`defaultSourceConfig`,{data:[],options:{parser:{type:`testTile`}}})}buildModels(){return Z(function*(){})()}}})),NV,PV,FV,IV,LV=o((()=>{Py(),UC(),kp(),dF(),TI(),NV=`layout(std140) uniform commonUniforms {
  float u_opacity;
};
in vec3 vVertexNormal;
in float v_offset;
in vec4 v_Color;

#pragma include "scene_uniforms"
out vec4 outputColor;
void main() {
  // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);
  float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);
  // 去除背面
  if (intensity > 1.0) intensity = 0.0;

  outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);
}
`,PV=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 float u_opacity;
};

#pragma include "scene_uniforms"
out vec3 vVertexNormal;
out vec4 v_Color;
out float v_offset;

void main() {
    float EARTH_RADIUS = 100.0;

    v_Color = a_Color;

    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);
    vVertexNormal = a_Normal;

    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);
}
`,{isNumber:FV}=tu,IV=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,NORMAL:9,UV:10})}getCommonUniformsInfo(){let{opacity:e=1}=this.layer.getLayerConfig(),t={u_opacity:FV(e)?e:1};return this.getUniformsBufferInfo(t)}initModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),e.buildModels()})()}clearModels(){return``}buildModels(){var e=this;return Z(function*(){return e.layer.zIndex=-997,[yield e.layer.buildLayerModel({moduleName:`earthAtmoSphere`,vertexShader:PV,fragmentShader:NV,defines:e.getDefines(),triangulation:xI,depth:{enable:!1},blend:e.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}}})),RV,zV,BV,VV=o((()=>{Py(),ov(),UC(),dF(),TI(),RV=`uniform sampler2D u_texture;

in vec2 v_texCoord;
in float v_lightWeight;
out vec4 outputColor;

void main() {
  vec4 color = texture(SAMPLER_2D(u_texture), vec2(v_texCoord.x, v_texCoord.y));
  color.xyz = color.xyz * v_lightWeight;
  outputColor = color;
}
`,zV=`// attribute vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

// attribute vec2 a_Extrude;
// attribute float a_Size;
// attribute float a_Shape;

layout(std140) uniform commonUniforms {
	vec4 u_sunLight: [1.0, -10.5, 12.0,0.0];
	float u_ambientRatio : 0.5;
	float u_diffuseRatio : 0.3;
	float u_specularRatio : 0.2;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
out float v_lightWeight;

float calc_lighting(vec4 pos) {

	vec3 worldPos = vec3(pos * u_ModelMatrix);

	vec3 worldNormal = a_Normal;

	// cal light weight
	vec3 viewDir = normalize(u_CameraPosition - worldPos);

	vec3 lightDir = normalize(u_sunLight.xyz);

	vec3 halfDir = normalize(viewDir+lightDir);
	// lambert
	float lambert = dot(worldNormal, lightDir);
	// specular
	float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
	//sum to light weight
	float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;

	return lightWeight;
}

void main() {

	v_texCoord = a_Uv;

	float lightWeight = calc_lighting(vec4(a_Position, 1.0));
	v_lightWeight = lightWeight;

	gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);
}
`,BV=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`earthTime`,3.4),J(this,`sunX`,1e3),J(this,`sunY`,1e3),J(this,`sunZ`,1e3),J(this,`sunRadius`,Math.sqrt(this.sunX*this.sunX+this.sunY*this.sunY+this.sunZ*this.sunZ))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,NORMAL:9,UV:10})}getCommonUniformsInfo(){let{animateOption:e,globalOptions:t}=this.layer.getLayerConfig();e!=null&&e.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY));let n={u_sunLight:[this.sunX,this.sunY,this.sunZ,0],u_ambientRatio:t?.ambientRatio||.6,u_diffuseRatio:t?.diffuseRatio||.4,u_specularRatio:t?.specularRatio||.1};return this.textures=[this.texture],this.getUniformsBufferInfo(n)}setEarthTime(e){this.earthTime=e,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}initModels(){var e=this;return Z(function*(){let{globalOptions:t}=e.layer.getLayerConfig();t?.earthTime!==void 0&&e.setEarthTime(t.earthTime);let n=e.layer.getSource(),{createTexture2D:r}=e.rendererService;return e.texture=r({height:0,width:0}),n.data.images.then(t=>{e.texture=r({data:t[0],width:t[0].width,height:t[0].height}),e.textures=[e.texture],e.layerService.reRender()}),e.initUniformsBuffer(),e.buildModels()})()}clearModels(){return``}buildModels(){var e=this;return Z(function*(){return e.layer.zIndex=-998,[yield e.layer.buildLayerModel({moduleName:`earthBase`,vertexShader:zV,fragmentShader:RV,defines:e.getDefines(),triangulation:xI,depth:{enable:!0},blend:e.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}}})),HV,UV,WV,GV,KV=o((()=>{Py(),UC(),kp(),dF(),TI(),HV=`in vec3 vVertexNormal;
in vec4 v_Color;

layout(std140) uniform commonUniforms {
  float u_opacity;
};
out vec4 outputColor;
#pragma include "scene_uniforms"
void main() {
  float intensity = -dot(normalize(vVertexNormal), normalize(u_CameraPosition));
  // 去除背面
  if (intensity > 1.0) intensity = 0.0;

  outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);
}
`,UV=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 float u_opacity;
};
#pragma include "scene_uniforms"

out vec3 vVertexNormal;
out vec4 v_Color;

void main() {
    v_Color = a_Color;

    vVertexNormal = a_Normal;

    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);
}
`,{isNumber:WV}=tu,GV=class extends uF{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,NORMAL:9,UV:10})}getCommonUniformsInfo(){let{opacity:e=1}=this.layer.getLayerConfig(),t={u_opacity:WV(e)?e:1};return this.getUniformsBufferInfo(t)}initModels(){var e=this;return Z(function*(){return e.initUniformsBuffer(),e.buildModels()})()}clearModels(){return``}buildModels(){var e=this;return Z(function*(){return e.layer.zIndex=-999,[yield e.layer.buildLayerModel({moduleName:`earthBloom`,vertexShader:UV,fragmentShader:HV,defines:e.getDefines(),triangulation:SI,depth:{enable:!1},blend:e.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`normal`,type:oy.Attribute,descriptor:{name:`a_Normal`,shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:(e,t,n,r,i)=>i}}),this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}}})),qV,JV,YV,XV=o((()=>{Py(),ov(),XP(),LV(),VV(),KV(),qV={base:BV,atomSphere:IV,bloomSphere:GV},JV=[`base`,`atomSphere`,`bloomSphere`],YV=class extends YP{constructor(...e){super(...e),J(this,`type`,`EarthLayer`),J(this,`defaultSourceConfig`,{data:[],options:{parser:{type:`json`}}})}buildModels(){var e=this;return Z(function*(){e.layerModel=new qV[e.getModelType()](e),yield e.initLayerModels()})()}setEarthTime(e){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(e):console.warn(`请在 scene loaded 之后执行该方法！`)}getModelType(){var e;let t=this.styleAttributeService.getLayerStyleAttribute(`shape`),n=(t==null||(e=t.scale)==null?void 0:e.field)||`base`;return JV.indexOf(n)<0&&(n=`base`),n}}}));function ZV(e,t,n){let r=QV(e,e.VERTEX_SHADER,t),i=QV(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;let a=e.createProgram();if(!a)return null;if(e.attachShader(a,r),e.attachShader(a,i),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){let t=e.getProgramInfoLog(a);return console.warn(`Failed to link program: `+t),e.deleteProgram(a),e.deleteShader(i),e.deleteShader(r),null}let o=e.getProgramParameter(a,e.ACTIVE_ATTRIBUTES);for(let t=0;t<o;t++){let n=e.getActiveAttrib(a,t);a[n.name]=e.getAttribLocation(a,n.name)}let s=e.getProgramParameter(a,e.ACTIVE_UNIFORMS);for(let t=0;t<s;t++){let n=e.getActiveUniform(a,t);a[n.name]=e.getUniformLocation(a,n.name)}return a.vertexShader=r,a.fragmentShader=i,a}function QV(e,t,n){let r=e.createShader(t);if(r==null)return console.warn(`unable to create shader`),null;if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){let t=e.getShaderInfoLog(r);return console.warn(`Failed to compile shader: `+t),e.deleteShader(r),null}return r}function $V(e,t,n,r,i){let a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),a}function eH(e,t,n){let r=e.createTexture();if(e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),n instanceof HTMLImageElement)e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n);else{let t=Math.sqrt(n.length/4),r=t;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,n)}return e.bindTexture(e.TEXTURE_2D,null),r}function tH(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function nH(e,t){let n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}var rH=o((()=>{})),iH,aH,oH,sH,cH,lH,uH=o((()=>{iH=`
 precision mediump float;

 attribute float a_index;

 uniform sampler2D u_particles;
 uniform float u_particles_res;

 varying vec2 v_particle_pos;

 void main() {
     vec4 color = texture2D(u_particles, vec2(
         fract(a_index / u_particles_res),
         floor(a_index / u_particles_res) / u_particles_res)
     );

     // decode current particle position from the pixel's RGBA value
     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);

     gl_PointSize = 1.0;
     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);
 }`,aH=`
 precision mediump float;

 uniform sampler2D u_wind;
 uniform vec2 u_wind_min;
 uniform vec2 u_wind_max;
 uniform sampler2D u_color_ramp;

 varying vec2 v_particle_pos;

 void main() {
     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);
     float speed_t = length(velocity) / length(u_wind_max);

     // color ramp is encoded in a 16x16 texture
     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);

     gl_FragColor = texture2D(u_color_ramp, ramp_pos);
 }`,oH=`
 precision mediump float;

 attribute vec2 a_pos;

 varying vec2 v_tex_pos;

 void main() {
     v_tex_pos = a_pos;
     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);
     // framebuffer 始终用铺满屏幕的 texture
 }`,sH=`
 precision highp float;

 uniform sampler2D u_particles;
 uniform sampler2D u_wind;
 uniform vec2 u_wind_res;
 uniform vec2 u_wind_min;
 uniform vec2 u_wind_max;
 uniform float u_rand_seed;
 uniform float u_speed_factor;
 uniform float u_drop_rate;
 uniform float u_drop_rate_bump;

 varying vec2 v_tex_pos;

 // pseudo-random generator
 const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);
 float rand(const vec2 co) {
 float t = dot(rand_constants.xy, co);
     return fract(sin(t) * (rand_constants.z + t));
 }

 // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation
 vec2 lookup_wind(const vec2 uv) {
     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering
     vec2 px = 1.0 / u_wind_res;
     vec2 vc = (floor(uv * u_wind_res)) * px;
     vec2 f = fract(uv * u_wind_res);
     vec2 tl = texture2D(u_wind, vc).rg;
     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;
     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;
     vec2 br = texture2D(u_wind, vc + px).rg;
     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);
 }

 void main() {
     vec4 color = texture2D(u_particles, v_tex_pos);
     vec2 pos = vec2(
         color.r / 255.0 + color.b,
         color.g / 255.0 + color.a); // decode particle position from pixel RGBA
     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));
     float speed_t = length(velocity) / length(u_wind_max);

     // take EPSG:4236 distortion into account for calculating where the particle moved
     float distortion = cos(radians(pos.y * 180.0 - 90.0));
     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;

     // update particle position, wrapping around the date line
     pos = fract(1.0 + pos + offset);

     // a random seed to use for the particle drop
     vec2 seed = (pos + v_tex_pos) * u_rand_seed;

     // drop rate is a chance a particle will restart at random position, to avoid degeneration
     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;
     float drop = step(1.0 - drop_rate, rand(seed));

     vec2 random_pos = vec2(
         rand(seed + 1.3),
         rand(seed + 2.1));
         pos = mix(pos, random_pos, drop);

     // encode the new particle position back into RGBA
     gl_FragColor = vec4(
         fract(pos * 255.0),
         floor(pos * 255.0) / 255.0);
 }`,cH=`
     precision mediump float;

     attribute vec2 a_pos;

     varying vec2 v_tex_pos;

     void main() {
         v_tex_pos = a_pos;
         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);
         gl_PointSize = 100.0;
 }`,lH=`
 precision mediump float;

 uniform sampler2D u_screen;
 uniform float u_opacity;
 varying vec2 v_tex_pos;

 void main() {
     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);

     // a hack to guarantee opacity fade out even with a value close to 1.0
     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);
 }`}));function dH(e){let t=document.createElement(`canvas`),n=t.getContext(`2d`);t.width=256,t.height=1;let r=n.createLinearGradient(0,0,256,0);for(let t of Object.keys(e))r.addColorStop(+t,e[+t]);return n.fillStyle=r,n.fillRect(0,0,256,1),t=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function fH(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function pH(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}var mH,hH=o((()=>{ov(),rH(),uH(),mH=class{constructor(e){J(this,`width`,512),J(this,`height`,512),J(this,`pixels`,void 0),J(this,`fadeOpacity`,void 0),J(this,`speedFactor`,void 0),J(this,`dropRate`,void 0),J(this,`dropRateBump`,void 0),J(this,`gl`,void 0),J(this,`drawProgram`,void 0),J(this,`fullScreenProgram`,void 0),J(this,`updateProgram`,void 0),J(this,`rampColors`,void 0),J(this,`numParticles`,65536),J(this,`numParticlesSize`,void 0),J(this,`particleStateResolution`,void 0),J(this,`quadBuffer`,void 0),J(this,`particleIndexBuffer`,void 0),J(this,`framebuffer`,void 0),J(this,`colorRampTexture`,void 0),J(this,`backgroundTexture`,void 0),J(this,`screenTexture`,void 0),J(this,`particleStateTexture0`,void 0),J(this,`particleStateTexture1`,void 0),J(this,`windTexture`,void 0),J(this,`windData`,void 0),this.gl=e.glContext,this.width=e.imageWidth,this.height=e.imageHeight,this.fadeOpacity=e.fadeOpacity,this.speedFactor=e.speedFactor,this.dropRate=e.dropRate,this.dropRateBump=e.dropRateBump,this.rampColors=e.rampColors,this.init()}init(){let e=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=ZV(e,iH,aH),this.fullScreenProgram=ZV(e,cH,lH),this.updateProgram=ZV(e,oH,sH),this.quadBuffer=nH(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=e.createFramebuffer(),this.colorRampTexture=$V(this.gl,this.gl.LINEAR,dH(this.rampColors),16,16);let t=new Uint8Array(this.width*this.height*4);this.backgroundTexture=$V(e,e.NEAREST,t,this.width,this.height),this.screenTexture=$V(e,e.NEAREST,t,this.width,this.height);let n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;let r=new Uint8Array(this.numParticlesSize*4);for(let e=0;e<r.length;e++)r[e]=Math.floor(Math.random()*256);this.particleStateTexture0=$V(e,e.NEAREST,r,n,n),this.particleStateTexture1=$V(e,e.NEAREST,r,n,n);let i=new Float32Array(this.numParticlesSize);for(let e=0;e<this.numParticlesSize;e++)i[e]=e;this.particleIndexBuffer=nH(e,i)}setWind(e){this.windData=e,this.windTexture=eH(this.gl,this.gl.LINEAR,e.image)}updateParticelNum(e){let t=this.gl;if(e!==this.numParticles){this.numParticles=e;let n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;let r=new Uint8Array(this.numParticlesSize*4);for(let e=0;e<r.length;e++)r[e]=Math.floor(Math.random()*256);this.particleStateTexture0=$V(t,t.NEAREST,r,n,n),this.particleStateTexture1=$V(t,t.NEAREST,r,n,n);let i=new Float32Array(this.numParticlesSize);for(let e=0;e<this.numParticlesSize;e++)i[e]=e;this.particleIndexBuffer=nH(t,i)}}updateWindDir(e,t,n,r){this.windData.uMin=e,this.windData.uMax=t,this.windData.vMin=n,this.windData.vMax=r}updateColorRampTexture(e){if(this.isColorChanged(e)){this.rampColors=e;let t=this.gl;t.deleteTexture(this.colorRampTexture),this.colorRampTexture=$V(t,t.LINEAR,dH(e),16,16)}}isColorChanged(e){let t=Object.keys(e);for(let n of t){let t=Number(n);if(!this.rampColors[t]||this.rampColors[t]&&this.rampColors[t]!==e[t])return!0}return!1}reSize(e,t){if(e!==this.width||t!==this.height){let n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=e,this.height=t;let r=new Uint8Array(e*t*4);this.backgroundTexture=$V(n,n.NEAREST,r,e,t),this.screenTexture=$V(n,n.NEAREST,r,e,t)}}draw(){var e;if((e=this.windData)!=null&&e.image){let e=this.gl;return tH(e,this.windTexture,0),tH(e,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}else return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}drawScreen(){let e=this.gl;pH(e,this.framebuffer,this.screenTexture),e.viewport(0,0,this.width,this.height),e.disable(e.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels),pH(e,null,null),e.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);let t=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=t}drawFullTexture(e,t){let n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),tH(n,e,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,t),n.drawArrays(n.TRIANGLES,0,6)}drawParticles(){let e=this.gl,t=this.drawProgram;e.useProgram(t),fH(e,this.particleIndexBuffer,t.a_index,1),tH(e,this.colorRampTexture,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1i(t.u_color_ramp,2),e.uniform1f(t.u_particles_res,this.particleStateResolution),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.drawArrays(e.POINTS,0,this.numParticlesSize)}updateParticles(){let e=this.gl;pH(e,this.framebuffer,this.particleStateTexture1),e.viewport(0,0,this.particleStateResolution,this.particleStateResolution);let t=this.updateProgram;e.useProgram(t),fH(e,this.quadBuffer,t.a_pos,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1f(t.u_rand_seed,Math.random()),e.uniform2f(t.u_wind_res,this.windData.image.width*2,this.windData.image.height*2),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.uniform1f(t.u_speed_factor,this.speedFactor),e.uniform1f(t.u_drop_rate,this.dropRate),e.uniform1f(t.u_drop_rate_bump,this.dropRateBump),e.drawArrays(e.TRIANGLES,0,6);let n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,pH(e,null,null)}destroy(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}})),gH,_H,vH,yH,bH=o((()=>{Py(),ov(),UC(),kp(),dF(),TI(),hH(),gH=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,_H=`precision highp float;
uniform mat4 u_ModelMatrix;

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

varying vec2 v_texCoord;
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`,vH={0:`#3288bd`,.1:`#66c2a5`,.2:`#abdda4`,.3:`#e6f598`,.4:`#fee08b`,.5:`#fdae61`,.6:`#f46d43`,1:`#d53e4f`},yH=class extends uF{constructor(...e){super(...e),J(this,`texture`,void 0),J(this,`colorModel`,void 0),J(this,`wind`,void 0),J(this,`imageCoords`,void 0),J(this,`sizeScale`,.5),J(this,`frequency`,new Wu(7.2)),J(this,`cacheZoom`,void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}render(e){this.drawColorMode(e),this.frequency.run(()=>{this.drawWind()})}getUninforms(){throw Error(`Method not implemented.`)}initModels(){var e=this;return Z(function*(){var t;let{uMin:n=-21.32,uMax:r=26.8,vMin:i=-21.57,vMax:a=21.42,fadeOpacity:o=.996,speedFactor:s=.25,dropRate:c=.003,dropRateBump:l=.01,rampColors:u=vH,sizeScale:d=.5}=e.layer.getLayerConfig(),{createTexture2D:f}=e.rendererService,p=e.layer.getSource();e.texture=f({height:0,width:0}),e.cacheZoom=Math.floor(e.mapService.getZoom());let m=e.rendererService.getGLContext();e.imageCoords=p.data?.dataArray[0].coordinates,(t=p.data)==null||(t=t.images)==null||t.then(t=>{var p;e.sizeScale=d*e.getZoomScale();let{imageWidth:h,imageHeight:g}=e.getWindSize();e.wind=new mH({glContext:m,imageWidth:h,imageHeight:g,fadeOpacity:o,speedFactor:s,dropRate:c,dropRateBump:l,rampColors:u}),e.wind.setWind({uMin:n,uMax:r,vMin:i,vMax:a,image:t[0]}),(p=e.texture)==null||p.destroy(),e.texture=f({width:h,height:g}),e.layerService.reRender()});let h=yield e.layer.buildLayerModel({moduleName:`wind`,vertexShader:_H,fragmentShader:gH,defines:e.getDefines(),triangulation:hI,primitive:X.TRIANGLES,depth:{enable:!1}});return e.colorModel=h,[h]})()}getWindSize(){let e=this.mapService.lngLatToPixel(this.imageCoords[0]),t=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.min(Math.floor((t.x-e.x)*this.sizeScale),2048),imageHeight:Math.min(Math.floor((e.y-t.y)*this.sizeScale),2048)}}buildModels(){var e=this;return Z(function*(){return e.initModels()})()}clearModels(){var e,t;(e=this.texture)==null||e.destroy(),(t=this.wind)==null||t.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:`uv`,type:oy.Attribute,descriptor:{name:`a_Uv`,shaderLocation:this.attributeLocation.UV,buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:(e,t,n)=>[n[3],n[4]]}})}getZoomScale(){return Math.min((this.cacheZoom+4)/30*2,2)}drawWind(){if(this.wind){let{uMin:e=-21.32,uMax:t=26.8,vMin:n=-21.57,vMax:r=21.42,numParticles:i=65535,fadeOpacity:a=.996,speedFactor:o=.25,dropRate:s=.003,dropRateBump:c=.01,rampColors:l=vH,sizeScale:u=.5}=this.layer.getLayerConfig(),d=i,f=Math.floor(this.mapService.getZoom());if(typeof u==`number`&&u!==this.sizeScale||f!==this.cacheZoom){let e=this.getZoomScale();this.sizeScale=u,d*=e;let{imageWidth:t,imageHeight:n}=this.getWindSize();this.wind.reSize(t,n),this.cacheZoom=f}this.wind.updateWindDir(e,t,n,r),this.wind.updateParticelNum(d),this.wind.updateColorRampTexture(l),this.wind.fadeOpacity=a,this.wind.speedFactor=o,this.wind.dropRate=s,this.wind.dropRateBump=c;let{d:p,w:m,h}=this.wind.draw();this.rendererService.setBaseState(),this.texture.update({data:p,width:m,height:h})}}drawColorMode(e={}){var t;let{opacity:n}=this.layer.getLayerConfig();this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),(t=this.colorModel)==null||t.draw({uniforms:{u_opacity:n||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(e)}),this.layer.hooks.afterRender.call()}}})),xH,SH=o((()=>{bH(),xH={wind:yH}})),CH,wH=o((()=>{Py(),ov(),XP(),SH(),CH=class extends YP{constructor(...e){super(...e),J(this,`type`,`WindLayer`)}buildModels(){var e=this;return Z(function*(){e.layerModel=new xH[e.getModelType()](e),yield e.initLayerModels()})()}renderModels(e={}){return this.layerModel&&this.layerModel.render(e),this}getDefaultConfig(){return{wind:{}}[this.getModelType()]}getModelType(){return`wind`}}})),TH=o((()=>{wF(),jI(),XP(),dF(),JI(),CL(),jL(),kR(),Iz(),hB(),NB(),AV(),MV(),XV(),lV(),wH(),_F()})),EH,DH=o((()=>{cv(),ov(),UC(),TH(),kp(),aD(),EH=class extends KE{constructor(...e){super(...e),J(this,`isMoving`,!1),J(this,`maskLayer`,void 0),J(this,`move`,e=>{switch(e.stopPropagation(),e.type){case`touchcancel`:case`touchend`:case`mouseup`:var t;this.isMoving=!1,[`mouseup`,`mousemove`,`touchend`,`touchcancel`,`touchmove`].forEach(e=>{document.removeEventListener(e,this.move)}),(t=this.scene)==null||t.render();break;case`mousedown`:case`touchstart`:this.isMoving=!0,[`mouseup`,`mousemove`,`touchend`,`touchcancel`,`touchmove`].forEach(e=>{document.addEventListener(e,this.move)});case`mousemove`:case`touchmove`:if(this.isMoving)if(this.controlOption.orientation===`vertical`){let t;if(`pageX`in e?t=e.pageX:e.touches&&e.touches.length&&e.touches[0].pageX?t=e.touches[0].pageX:e.changedTouches&&e.changedTouches.length&&(t=e.changedTouches[0].pageX),!t)break;let n=this.getContainerDOMRect(),r=this.getContainerSize(),i=r[0],a=n?.left||0,o=t-a+window.scrollX-document.documentElement.clientLeft,s=i-Math.min(Math.max(0,i-o),i),c=s/i;this.setOptions({ratio:c}),this.emit(`moving`,{size:[s,r[1]],ratio:[c,0]})}else{let t;if(`pageY`in e?t=e.pageY:e.touches&&e.touches.length&&e.touches[0].pageY?t=e.touches[0].pageY:e.changedTouches&&e.changedTouches.length&&(t=e.changedTouches[0].pageY),!t)break;let n=this.getContainerDOMRect(),r=this.getContainerSize(),i=r[1],a=n?.top||0,o=t-a+window.scrollY-document.documentElement.clientTop,s=i-Math.min(Math.max(0,i-o),i),c=s/i;this.setOptions({ratio:c}),this.emit(`moving`,{size:[r[0],s],ratio:[0,c]})}break;default:break}}),J(this,`getMaskLayer`,()=>(console.log(this.getMaskGeoData()),new mB({visible:!1}).source(this.getMaskGeoData()).shape(`fill`).color(`red`).style({opacity:.1}))),J(this,`updateMask`,()=>{var e;if(!this.mapsService)return;let t=this.getMaskGeoData();(e=this.maskLayer)==null||e.setData(t)})}getDefault(){return Y(Y({},super.getDefault()),{},{layers:[],rightLayers:[],ratio:.5,orientation:`vertical`})}onAdd(){let e=cu(`div`,`l7-control-swipe`);cu(`button`,`l7-control-swipe__button`,e);let{orientation:t=`vertical`,ratio:n=.5}=this.controlOption;return t===`horizontal`?(e.style.top=n*100+`%`,e.style.left=``):(e.style.left=n*100+`%`,e.style.top=``),e.classList.add(t),e}addTo(e){this.mapsService=e.mapService,this.renderService=e.rendererService,this.layerService=e.layerService,this.controlService=e.controlService,this.configService=e.globalConfigService,this.scene=e.sceneService,this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd();let{className:t,style:n,layers:r,rightLayers:i}=this.controlOption;t&&this.setClassName(t),n&&this.setStyle(n),this.mapsService.getMarkerContainer().appendChild(this.container),this.maskLayer=this.getMaskLayer(),this.registerEvent();let a=EC(e);return this.maskLayer.setContainer(a),this.scene.addLayer(this.maskLayer),this.addMaskToLayers(r,!1),this.addMaskToLayers(i,!0),this.emit(`add`,this),this}onRemove(){if(this.maskLayer){var e;let{layers:t,rightLayers:n}=this.controlOption;this.removeMaskFromLayers(t),this.removeMaskFromLayers(n),(e=this.layerService)==null||e.remove(this.maskLayer)}this.unRegisterEvent(),this.removeAllListeners()}show(){var e;let t=this.container;du(t,`l7-control-swipe_hide`);let{layers:n,rightLayers:r}=this.controlOption;n.forEach(e=>e.enableMask()),r.forEach(e=>e.enableMask()),(e=this.scene)==null||e.render(),this.isShow=!0,this.emit(`show`,this)}hide(){var e;let t=this.container;uu(t,`l7-control-swipe_hide`);let{layers:n,rightLayers:r}=this.controlOption;n.forEach(e=>e.disableMask()),r.forEach(e=>e.disableMask()),(e=this.scene)==null||e.render(),this.isShow=!1,this.emit(`hide`,this)}setOptions(e){let t=Y(Y({},this.controlOption),e);if(e.className&&this.setClassName(e.className),e.style&&this.setStyle(e.style),(e.orientation||e.ratio!==void 0)&&this.setOrientationAndRatio(t.orientation,t.ratio),e.layers){let t=e.layers,n=this.controlOption.layers;this.setLayers(t,n,!1)}if(e.rightLayers){let t=e.rightLayers,n=this.controlOption.rightLayers;this.setLayers(t,n,!0)}this.controlOption=t,this.updateMask()}registerEvent(){this.container.addEventListener(`mousedown`,this.move),this.container.addEventListener(`touchstart`,this.move),this.mapsService.on(`camerachange`,this.updateMask)}unRegisterEvent(){var e;this.container.removeEventListener(`mousedown`,this.move),this.container.removeEventListener(`touchstart`,this.move),(e=this.mapsService)==null||e.off(`camerachange`,this.updateMask)}setOrientationAndRatio(e=`vertical`,t=.5){this.container.classList.remove(`horizontal`,`vertical`),this.container.classList.add(e),e===`horizontal`?(this.container.style.top=t*100+`%`,this.container.style.left=``):(this.container.style.left=t*100+`%`,this.container.style.top=``)}setLayers(e,t,n=!1){let r=e.filter(e=>t.includes(e)===!1),i=t.filter(t=>e.includes(t)===!1);this.addMaskToLayers(r,n),this.removeMaskFromLayers(i)}addMaskToLayers(e,t){e.forEach(e=>{e.updateLayerConfig({maskInside:!t}),e.addMask(this.maskLayer)})}removeMaskFromLayers(e){e.forEach(e=>{e.updateLayerConfig({maskInside:!0}),e.removeMask(this.maskLayer)})}getMaskGeoData(){let{ratio:e=.5,orientation:t=`vertical`}=this.controlOption,n=t===`vertical`,[r,i]=this.getBounds(),[a,o]=r,[s,c]=i,l;if(n){let t=a+(s-a)*e;l=[[a,c],[t,c],[t,o],r,[a,c]]}else{let t=this.getContainerSize(),n=this.mapsService.containerToLngLat([t[0],t[1]*e]).lat;l=[[a,c],i,[s,n],[a,n],[a,c]]}return{type:`FeatureCollection`,features:[{type:`Feature`,properties:{},geometry:{type:`Polygon`,coordinates:[l]}}]}}getContainerDOMRect(){return this.mapsService.getContainer()?.getBoundingClientRect()}getContainerSize(){return this.mapsService.getSize()}getBounds(){return this.mapsService.getBounds()}addLayer(e,t=!1){let n=Array.isArray(e)?e:[e];if(t){let e=this.controlOption.rightLayers.concat(...n);this.setOptions({rightLayers:e})}else{let e=this.controlOption.layers.concat(...n);this.setOptions({layers:e})}}removeLayer(e){let t=Array.isArray(e)?e:[e],n=this.controlOption.layers.filter(e=>t.includes(e)),r=this.controlOption.rightLayers.filter(e=>t.includes(e));this.setOptions({layers:n,rightLayers:r})}removeLayers(){this.setOptions({layers:[],rightLayers:[]})}}})),OH,kH=o((()=>{cv(),ov(),UC(),kp(),sD(),aD(),OH=class extends KE{constructor(...e){super(...e),J(this,`disabled`,void 0),J(this,`zoomInButton`,void 0),J(this,`zoomOutButton`,void 0),J(this,`zoomNumDiv`,void 0),J(this,`zoomIn`,()=>{!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}),J(this,`zoomOut`,()=>{!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}),J(this,`updateDisabled`,()=>{let e=this.mapsService;this.zoomInButton.removeAttribute(`disabled`),this.zoomOutButton.removeAttribute(`disabled`),(this.disabled||e.getZoom()<=e.getMinZoom())&&this.zoomOutButton.setAttribute(`disabled`,`true`),this.controlOption.showZoom&&this.zoomNumDiv&&(this.zoomNumDiv.innerText=String(Math.floor(e.getZoom()))),(this.disabled||e.getZoom()>=e.getMaxZoom())&&this.zoomInButton.setAttribute(`disabled`,`true`)})}getDefault(e){return Y(Y({},super.getDefault(e)),{},{position:Bv.BOTTOMRIGHT,name:`zoom`,zoomInText:oD(`l7-icon-enlarge`),zoomInTitle:`Zoom in`,zoomOutText:oD(`l7-icon-narrow`),zoomOutTitle:`Zoom out`,showZoom:!1})}setOptions(e){super.setOptions(e),this.checkUpdateOption(e,[`zoomInText`,`zoomInTitle`,`zoomOutText`,`zoomOutTitle`,`showZoom`])&&this.resetButtonGroup(this.container)}onAdd(){let e=cu(`div`,`l7-control-zoom`);return this.resetButtonGroup(e),this.mapsService.on(`zoomend`,this.updateDisabled),this.mapsService.on(`zoomchange`,this.updateDisabled),e}onRemove(){this.mapsService.off(`zoomend`,this.updateDisabled),this.mapsService.off(`zoomchange`,this.updateDisabled)}disable(){return this.disabled=!0,this.updateDisabled(),this}enable(){return this.disabled=!1,this.updateDisabled(),this}resetButtonGroup(e){Du(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,`l7-button-control`,e,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton(`0`,``,`l7-button-control l7-control-zoom__number`,e)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,`l7-button-control`,e,this.zoomOut),this.updateDisabled()}createButton(e,t,n,r,i){let a=cu(`button`,n,r);return typeof e==`string`?a.innerHTML=e:a.append(e),a.title=t,i&&a.addEventListener(`click`,i),a}}})),AH=o((()=>{})),jH,MH,NH=o((()=>{cv(),ov(),kp(),jH=u(Mf()),sD(),MH=class extends jH.EventEmitter{get lngLat(){return this.popupOption.lngLat??{lng:0,lat:0}}set lngLat(e){this.popupOption.lngLat=e}constructor(e){super(),J(this,`popupOption`,void 0),J(this,`mapsService`,void 0),J(this,`sceneService`,void 0),J(this,`layerService`,void 0),J(this,`scene`,void 0),J(this,`closeButton`,void 0),J(this,`container`,void 0),J(this,`content`,void 0),J(this,`contentTitle`,void 0),J(this,`contentPanel`,void 0),J(this,`tip`,void 0),J(this,`isShow`,!0),J(this,`onMouseMove`,e=>{let{left:t=0,top:n=0}=this.mapsService.getMapContainer()?.getBoundingClientRect()??{};this.setPopupPosition(e.clientX-t,e.clientY-n)}),J(this,`updateLngLatPosition`,()=>{if(!this.mapsService||this.popupOption.followCursor)return;let{lng:e,lat:t}=this.lngLat,{x:n,y:r}=this.mapsService.lngLatToContainer([e,t]);this.setPopupPosition(n,r)}),J(this,`updateLngLatPositionWhenZoom`,e=>{if(!this.mapsService||this.popupOption.followCursor)return;let t=e.map,n=t.getSize();n.x/=2,n.y/=2;let r=e.center,i=e.zoom,a=t.DE(this.lngLat,i,r);a.x=Math.round(a.x),a.y=Math.round(a.y),this.setPopupPosition(a.x,a.y,!0)}),J(this,`onKeyDown`,e=>{e.keyCode===27&&this.remove()}),J(this,`onCloseButtonClick`,e=>{e.stopPropagation&&e.stopPropagation(),this.hide()}),J(this,`updatePosition`,(e,t=!0)=>{let n=!!this.lngLat,{className:r,style:i,maxWidth:a,anchor:o,stopPropagation:s}=this.popupOption;if(!this.mapsService||!n||!this.content)return;let c=this.mapsService.getMarkerContainer();if(!this.container&&c&&(this.container=cu(`div`,`l7-popup ${r??``} ${this.isShow?``:`l7-popup-hide`}`,c),i&&this.container.setAttribute(`style`,i),this.tip=cu(`div`,`l7-popup-tip`,this.container),this.container.appendChild(this.content),s&&[`mousemove`,`mousedown`,`mouseup`,`click`,`dblclick`].forEach(e=>{this.container.addEventListener(e,e=>{e.stopPropagation()})}),this.container.style.whiteSpace=`nowrap`),t?this.updateLngLatPositionWhenZoom(e):this.updateLngLatPosition(),_u(this.container,`${Qo[o]}`),Xo(this.container,o,`popup`),a){let{width:e}=this.container.getBoundingClientRect();e>parseFloat(a)&&(this.container.style.width=a)}else this.container.style.removeProperty(`width`)}),J(this,`updateWhenZoom`,e=>{this.updatePosition(e,!0)}),J(this,`update`,()=>{this.updatePosition(null,!1)}),this.popupOption=Y(Y({},this.getDefault(e??{})),e);let{lngLat:t}=this.popupOption;t&&(this.lngLat=t)}getIsShow(){return this.isShow}addTo(e){this.mapsService=e.mapService,this.sceneService=e.sceneService,this.layerService=e.layerService,this.mapsService.on(`camerachange`,this.update),this.mapsService.on(`viewchange`,this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();let{html:t,text:n,title:r}=this.popupOption;return t?this.setHTML(t):n&&this.setText(n),r&&this.setTitle(r),this.emit(`open`),this}remove(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&lu(this.content),this.container&&(lu(this.container),delete this.container),this.mapsService&&(this.mapsService.off(`camerachange`,this.update),this.mapsService.off(`viewchange`,this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit(`close`),this}getOptions(){return this.popupOption}setOptions(e){this.show();let{className:t}=this.popupOption;return this.popupOption=Y(Y({},this.popupOption),e),this.checkUpdateOption(e,[`html`,`text`,`title`,`closeButton`,`closeButtonOffsets`,`maxWidth`,`anchor`,`stopPropagation`,`lngLat`,`offsets`])&&(this.container&&=(lu(this.container),void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(e,[`closeOnEsc`])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,[`closeOnClick`])&&this.updateCloseOnClick(),this.checkUpdateOption(e,[`followCursor`])&&this.updateFollowCursor(),this.checkUpdateOption(e,[`html`])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,[`text`])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,[`className`])&&(t&&this.container.classList.remove(t??``),this.container.classList.add(e.className??``)),this.checkUpdateOption(e,[`style`])&&xu(this.container,e.style??``),this.checkUpdateOption(e,[`lngLat`])&&e.lngLat&&this.setLnglat(e.lngLat),this}open(){return this.addTo(this.scene),this}close(){return this.remove(),this}show(){if(!this.isShow)return this.container&&du(this.container,`l7-popup-hide`),this.isShow=!0,this.emit(`show`),this}hide(){if(this.isShow)return this.container&&uu(this.container,`l7-popup-hide`),this.isShow=!1,this.emit(`hide`),this}setHTML(e){return this.popupOption.html=e,this.setDOMContent(e)}setText(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}setTitle(e){this.show(),this.popupOption.title=e,e?(this.contentTitle||(this.contentTitle=cu(`div`,`l7-popup-content__title`),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Du(this.contentTitle),ku(this.contentTitle,e)):this.contentTitle&&=(lu(this.contentTitle),void 0)}panToPopup(){let{lng:e,lat:t}=this.lngLat;return this.popupOption.autoPan&&this.mapsService.panTo([e,t]),this}setLngLat(e){return this.setLnglat(e)}setLnglat(e){return this.show(),this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off(`camerachange`,this.update),this.mapsService.off(`viewchange`,this.update),this.mapsService.on(`camerachange`,this.update),this.mapsService.on(`viewchange`,this.update)),this.update(),this.popupOption.autoPan&&setTimeout(()=>{this.panToPopup()},0),this}getLnglat(){return this.lngLat}setMaxWidth(e){return this.popupOption.maxWidth=e,this.update(),this}isOpen(){return!!this.mapsService}getDefault(e){return{closeButton:!0,closeOnClick:!1,maxWidth:`240px`,offsets:[0,0],anchor:Zo.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}setDOMContent(e){return this.show(),this.createContent(),ku(this.contentPanel,e),this.update(),this}updateCloseOnClick(e){let t=this.mapsService;t&&(t?.off(`click`,this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&requestAnimationFrame(()=>{t?.on(`click`,this.onCloseButtonClick)}))}updateCloseOnEsc(e){window.removeEventListener(`keydown`,this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener(`keydown`,this.onKeyDown)}updateFollowCursor(e){let t=this.mapsService?.getContainer();t&&(t?.removeEventListener(`mousemove`,this.onMouseMove),this.popupOption.followCursor&&!e&&t?.addEventListener(`mousemove`,this.onMouseMove))}createContent(){if(this.content&&lu(this.content),this.contentTitle=void 0,this.content=cu(`div`,`l7-popup-content`,this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){let e=oD(`l7-icon-guanbi`);uu(e,`l7-popup-close-button`),this.content.appendChild(e),this.popupOption.closeButtonOffsets&&(e.style.right=this.popupOption.closeButtonOffsets[0]+`px`,e.style.top=this.popupOption.closeButtonOffsets[1]+`px`),e.setAttribute(`aria-label`,`Close popup`),e.addEventListener(`click`,()=>{this.hide()}),e.addEventListener(`pointerup`,e=>{e.stopPropagation()}),e.addEventListener(`pointerdown`,e=>{e.stopPropagation()}),this.closeButton=e}else this.closeButton=void 0;this.contentPanel=cu(`div`,`l7-popup-content__panel`,this.content)}setPopupPosition(e,t,n=!1){if(this.container){let{offsets:r}=this.popupOption;this.container.style.left=e+r[0]+`px`,this.container.style.top=t-r[1]+`px`,n?this.container.style.transition=`left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)`:this.container.style.transition=``}}checkUpdateOption(e,t){return t.some(t=>t in e)}}})),PH,FH,IH=o((()=>{cv(),ov(),kp(),NH(),{get:PH}=tu,FH=class extends MH{constructor(...e){super(...e),J(this,`layerClickCountByFrame`,0),J(this,`layerConfigMap`,new WeakMap),J(this,`displayFeatureInfo`,void 0),J(this,`onLayerClick`,(e,t)=>{requestAnimationFrame(()=>{if(this.popupOption.closeOnClick&&this.layerClickCountByFrame++,this.isShow&&this.isSameFeature(e,t.featureId))this.hide();else{let{title:n,content:r}=this.getLayerInfoFrag(e,t);this.setDOMContent(r),this.setLnglat(t.lngLat),this.setTitle(n),this.setDisplayFeatureInfo({layer:e,featureId:t.featureId}),this.show()}})}),J(this,`onSceneClick`,()=>{this.layerClickCountByFrame=0,requestAnimationFrame(()=>{this.layerClickCountByFrame||this.hide()})}),J(this,`onLayerHide`,()=>{this.hide(),this.setDisplayFeatureInfo(void 0)}),J(this,`updateCloseOnClick`,()=>{})}get layerConfigItems(){let{config:e,items:t}=this.popupOption;return e??t??[]}getActualTriggerEvent(){let{trigger:e}=this.popupOption;return e===`click`?Lu()?`click`:`touchend`:e}addTo(e){return super.addTo(e),this.bindLayerEvent(),this.hide(),this}remove(){return super.remove(),this.unbindLayerEvent(),this}setOptions(e){this.unbindLayerEvent();let t=Y({},e),n=t.trigger||this.popupOption.trigger,r=(t.items||this.popupOption.items)?.length===0;t.followCursor=n===`hover`&&!r;let i=this.isShow;return super.setOptions(t),this.bindLayerEvent(),(r||!i)&&this.hide(),this}getDefault(e){let t=e.trigger===`hover`;return Y(Y({},super.getDefault(e)),{},{trigger:`hover`,followCursor:t,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}bindLayerEvent(){let{trigger:e,closeOnClick:t}=this.popupOption,n=this.getActualTriggerEvent();this.layerConfigItems.forEach(r=>{var i;let a=this.getLayerByConfig(r);if(!a)return;let o=Y({},r);if(e===`hover`){let e=this.onLayerMouseMove.bind(this,a),t=this.onLayerMouseOut.bind(this,a);o.onMouseMove=e,o.onMouseOut=t,a?.on(`mousemove`,e),a?.on(`mouseout`,t)}else{let e=this.onLayerClick.bind(this,a);o.onClick=e,a?.on(n,e);let r=this.mapsService?.getMapContainer();r&&t&&r.addEventListener(n,this.onSceneClick)}let s=a==null||(i=a.getSource)==null?void 0:i.call(a),c=this.onSourceUpdate.bind(this);s?.on(`update`,c),o.onSourceUpdate=c,this.layerConfigMap.set(a,o)})}unbindLayerEvent(){let e=this.getActualTriggerEvent();this.layerConfigItems.forEach(t=>{let n=this.getLayerByConfig(t),r=n&&this.layerConfigMap.get(n);if(!r)return;let{onMouseMove:i,onMouseOut:a,onClick:o,onSourceUpdate:s}=r;if(i&&n.off(`mousemove`,i),a&&n.off(`mouseout`,a),o&&n.off(e,o),s){var c;n==null||(c=n.getSource())==null||c.off(`update`,s)}let l=this.mapsService?.getMapContainer();l&&l.removeEventListener(e,this.onSceneClick)})}onLayerMouseMove(e,t){if(!this.isSameFeature(e,t.featureId)){let{title:n,content:r}=this.getLayerInfoFrag(e,t);this.setDOMContent(r),this.setTitle(n),this.setDisplayFeatureInfo({layer:e,featureId:t.featureId}),this.show()}}onLayerMouseOut(e){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}onSourceUpdate(){this.hide(),this.setDisplayFeatureInfo(void 0)}getLayerInfoFrag(e,t){let n=this.layerConfigMap.get(e),r,i=document.createDocumentFragment();if(n){let e=t.feature;e.type===`Feature`&&`properties`in e&&`geometry`in e&&(e=e.properties);let{title:a,fields:o,customContent:s}=n;if(a){r=document.createDocumentFragment();let t=a instanceof Function?a(e):a;ku(r,t)}s?ku(i,s instanceof Function?s(e):s):o!=null&&o.length&&o?.forEach(n=>{let{field:r,formatField:a,formatValue:o,getValue:s}=typeof n==`string`?{field:n}:n,c=cu(`div`,`l7-layer-popup__row`),l=s?s(t.feature):PH(e,r),u=(a instanceof Function?a(r,e):a)??r,d=(o instanceof Function?o(l,e):o)??l,f=cu(`span`,`l7-layer-popup__key`,c);ku(f,u),ku(f,document.createTextNode(`：`));let p=cu(`span`,`l7-layer-popup__value`,c);Array.isArray(d)&&d.every(e=>!(e instanceof Object))&&(d=d.map(e=>String(e)).join(`,`)),ku(p,d),i.appendChild(c)})}return{title:r,content:i}}getLayerByConfig(e){let t=e.layer;if(t instanceof Object)return t;if(typeof t==`string`)return this.layerService.getLayer(t)||this.layerService.getLayerByName(t)}isSameFeature(e,t){let n=this.displayFeatureInfo;return n&&e===n.layer&&t===n.featureId}setDisplayFeatureInfo(e){let t=this.displayFeatureInfo;t&&t.layer.off(`hide`,this.onLayerHide),e&&e.layer.on(`hide`,this.onLayerHide),this.displayFeatureInfo=e}}}));function LH(e,t){var n=typeof my<`u`&&!!my&&typeof my.showToast==`function`&&my.isFRM!==!0,r=typeof wx<`u`&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0);if(!(n||r)&&(t||=document,t)){var i=t.head||t.getElementsByTagName(`head`)[0];if(!i){i=t.createElement(`head`);var a=t.body||t.getElementsByTagName(`body`)[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement(`style`);return o.type=`text/css`,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}var RH=o((()=>{RE(),UE(),WE(),aD(),lD(),_D(),yD(),SD(),wD(),kD(),jD(),ND(),DH(),kH(),AH(),IH(),NH(),LH(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgb(181 226 140 / 60%);
  background-clip: padding-box;
  border-radius: 20px;
}

.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font:
    12px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  text-align: center;
  background-color: rgb(110 204 57 / 60%);
  border-radius: 15px;
}

.l7-marker-cluster span {
  line-height: 30px;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  box-shadow: none;
}

.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgb(0 0 0 / 20%);
}

.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}

.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  box-sizing: border-box;
}

.l7-control-container {
  font:
    12px/1.5 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
}

.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblepainted;

  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}

.l7-control-container .l7-control.l7-control--hide {
  display: none;
}

.l7-control-container .l7-top {
  top: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}

.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}

.l7-control-container .l7-right {
  right: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}

.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}

.l7-control-container .l7-bottom {
  bottom: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}

.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}

.l7-control-container .l7-left {
  left: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}

.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}

.l7-control-container .l7-center {
  position: absolute;
  display: flex;
  justify-content: center;
}

.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}

.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}

.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}

.l7-control-container .l7-row {
  flex-direction: row;
}

.l7-control-container .l7-row.l7-top {
  align-items: flex-start;
}

.l7-control-container .l7-row.l7-bottom {
  align-items: flex-end;
}

.l7-control-container .l7-column {
  flex-direction: column;
}

.l7-control-container .l7-column.l7-left {
  align-items: flex-start;
}

.l7-control-container .l7-column.l7-right {
  align-items: flex-end;
}

.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 6px;
  box-shadow: 0 0 20px 0 rgb(0 0 0 / 15%);
  line-height: 16px;
}

.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}

.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}

.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}

.l7-button-control.l7-button-control--column {
  height: 44px;
  flex-direction: column;
}

.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}

.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}

.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}

.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}

.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}

.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}

.l7-button-control:disabled:hover {
  background-color: #fafafa;
}

.l7-button-control:disabled:active {
  background-color: #fafafa;
}

.l7-popper {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5;
  color: #595959;
}

.l7-popper.l7-popper-hide {
  display: none;
}

.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgb(0 0 0 / 15%);
}

.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-color: transparent;
  box-shadow: 0 0 20px 0 rgb(0 0 0 / 15%);
}

.l7-popper.l7-popper-left {
  flex-direction: row;
}

.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}

.l7-popper.l7-popper-right {
  flex-direction: row-reverse;
}

.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}

.l7-popper.l7-popper-top {
  flex-direction: column;
}

.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}

.l7-popper.l7-popper-bottom {
  flex-direction: column-reverse;
}

.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}

.l7-popper.l7-popper-start {
  align-items: flex-start;
}

.l7-popper.l7-popper-end {
  align-items: flex-end;
}

.l7-select-control--normal {
  padding: 4px 0;
}

.l7-select-control--normal .l7-select-control-item {
  display: flex;
  align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}

.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}

.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}

.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}

.l7-select-control--image {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow: hidden auto;
}

.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: flex;
  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  flex-direction: column;
  justify-content: center;
  box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}

.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}

.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}

.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 26px;
}

.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}

.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}

.l7-select-control-item {
  cursor: pointer;
}

.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}

.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}

.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-control-logo img {
  height: 100%;
  width: 100%;
}

.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}

.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}

.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgb(0 0 0 / 15%);
  padding: 2px 4px;
  min-width: 130px;
}

.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgb(0 0 0 / 15%);
}

.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  box-shadow: 0 0 0;
}

.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}

.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}

.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}

.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}

.l7-control-scale {
  display: flex;
  flex-direction: column;
}

.l7-control-scale .l7-control-scale-line {
  box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  transition: width 0.1s;
}

.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}

.l7-right .l7-control-scale {
  display: flex;
  align-items: flex-end;
}

.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}

.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: flex;
  will-change: transform;
  pointer-events: none;
}

.l7-popup.l7-popup-hide {
  display: none;
}

.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  box-shadow: 0 1px 2px rgb(0 0 0 / 10%);
}

.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}

.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}

.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}

.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}

.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  flex-direction: column-reverse;
}

.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}

.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  flex-direction: column;
}

.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}

.l7-popup.l7-popup-anchor-left {
  flex-direction: row;
}

.l7-popup.l7-popup-anchor-right {
  flex-direction: row-reverse;
}

.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}

.l7-popup-anchor-left .l7-popup-tip {
  align-self: center;
  border-right-color: #fff;
  border-left: none;
}

.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-layer-popup__row {
  font-size: 12px;
}

.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}

.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  touch-action: none;
}

.l7-control-swipe_hide {
  display: none;
}

.l7-control-swipe::before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}

.l7-control-swipe.horizontal::before {
  inset: 50% -5000px auto;
  width: auto;
  height: 4px;
}

.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}

.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}

.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}

.l7-control-swipe::after,
.l7-control-swipe__button::before,
.l7-control-swipe__button::after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentcolor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}

.l7-control-swipe__button::after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}

.l7-control-swipe__button::before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`)})),zH,BH=o((()=>{cv(),ov(),zH=class{constructor(e){J(this,`configService`,void 0),J(this,`config`,void 0),this.config=e}setContainer(e,t){this.configService=e.globalConfigService,e.mapConfig=Y(Y({},this.config),{},{id:t}),e.mapService=new(this.getServiceConstructor())(e)}getServiceConstructor(){throw Error(`Method not implemented.`)}}})),VH=s(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n||=self,n.AMapLoader=r())})(e,function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(n(e.Loca)),Promise.all(r)}function t(e){return new Promise(function(t,n){var s=[];if(e.plugins)for(var c=0;c<e.plugins.length;c+=1)i.AMapUI.plugins.indexOf(e.plugins[c])==-1&&s.push(e.plugins[c]);if(a.AMapUI===r.failed)n(`前次请求 AMapUI 失败`);else if(a.AMapUI===r.notload){a.AMapUI=r.loading,i.AMapUI.version=e.version||i.AMapUI.version,c=i.AMapUI.version;var l=document.body||document.head,u=document.createElement(`script`);u.type=`text/javascript`,u.src=`https://webapi.amap.com/ui/`+c+`/main.js`,u.onerror=function(e){a.AMapUI=r.failed,n(`请求 AMapUI 失败`)},u.onload=function(){if(a.AMapUI=r.loaded,s.length)window.AMapUI.loadUI(s,function(){for(var e=0,n=s.length;e<n;e++){var r=s[e].split(`/`).slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();o.AMapUI.length;)o.AMapUI.splice(0,1)[0]()});else for(t();o.AMapUI.length;)o.AMapUI.splice(0,1)[0]()},l.appendChild(u)}else a.AMapUI===r.loaded?e.version&&e.version!==i.AMapUI.version?n(`不允许多个版本 AMapUI 混用`):s.length?window.AMapUI.loadUI(s,function(){for(var e=0,n=s.length;e<n;e++){var r=s[e].split(`/`).slice(-1)[0];window.AMapUI[r]=arguments[e]}t()}):t():e.version&&e.version!==i.AMapUI.version?n(`不允许多个版本 AMapUI 混用`):o.AMapUI.push(function(e){e?n(e):s.length?window.AMapUI.loadUI(s,function(){for(var e=0,n=s.length;e<n;e++){var r=s[e].split(`/`).slice(-1)[0];window.AMapUI[r]=arguments[e]}t()}):t()})})}function n(e){return new Promise(function(t,n){if(a.Loca===r.failed)n(`前次请求 Loca 失败`);else if(a.Loca===r.notload){a.Loca=r.loading,i.Loca.version=e.version||i.Loca.version;var s=i.Loca.version,c=i.AMap.version.startsWith(`2`),l=s.startsWith(`2`);if(c&&!l||!c&&l)n(`JSAPI 与 Loca 版本不对应！！`);else{c=i.key,l=document.body||document.head;var u=document.createElement(`script`);u.type=`text/javascript`,u.src=`https://webapi.amap.com/loca?v=`+s+`&key=`+c,u.onerror=function(e){a.Loca=r.failed,n(`请求 AMapUI 失败`)},u.onload=function(){for(a.Loca=r.loaded,t();o.Loca.length;)o.Loca.splice(0,1)[0]()},l.appendChild(u)}}else a.Loca===r.loaded?e.version&&e.version!==i.Loca.version?n(`不允许多个版本 Loca 混用`):t():e.version&&e.version!==i.Loca.version?n(`不允许多个版本 Loca 混用`):o.Loca.push(function(e){e?n(e):n()})})}if(!window)throw Error(`AMap JSAPI can only be used in Browser.`);var r;(function(e){e.notload=`notload`,e.loading=`loading`,e.loaded=`loaded`,e.failed=`failed`})(r||={});var i={key:``,AMap:{version:`1.4.15`,plugins:[]},AMapUI:{version:`1.1`,plugins:[]},Loca:{version:`1.3.2`}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},o={AMap:[],AMapUI:[],Loca:[]},s=[],c=function(e){typeof e==`function`&&(a.AMap===r.loaded?e(window.AMap):s.push(e))};return{load:function(t){return new Promise(function(n,o){if(a.AMap==r.failed)o(``);else if(a.AMap==r.notload){var l=t.key,u=t.version,d=t.plugins;l?(window.AMap&&location.host!==`lbs.amap.com`&&o(`禁止多种API加载方式混用`),i.key=l,i.AMap.version=u||i.AMap.version,i.AMap.plugins=d||i.AMap.plugins,a.AMap=r.loading,u=document.body||document.head,window.___onAPILoaded=function(i){if(delete window.___onAPILoaded,i)a.AMap=r.failed,o(i);else for(a.AMap=r.loaded,e(t).then(function(){n(window.AMap)}).catch(o);s.length;)s.splice(0,1)[0]()},d=document.createElement(`script`),d.type=`text/javascript`,d.src=`https://webapi.amap.com/maps?callback=___onAPILoaded&v=`+i.AMap.version+`&key=`+l+`&plugin=`+i.AMap.plugins.join(`,`),d.onerror=function(e){a.AMap=r.failed,o(e)},u.appendChild(d)):o(`请填写key`)}else if(a.AMap==r.loaded)if(t.key&&t.key!==i.key)o(`多个不一致的 key`);else if(t.version&&t.version!==i.AMap.version)o(`不允许多个版本 JSAPI 混用`);else{if(l=[],t.plugins)for(u=0;u<t.plugins.length;u+=1)i.AMap.plugins.indexOf(t.plugins[u])==-1&&l.push(t.plugins[u]);l.length?window.AMap.plugin(l,function(){e(t).then(function(){n(window.AMap)}).catch(o)}):e(t).then(function(){n(window.AMap)}).catch(o)}else if(t.key&&t.key!==i.key)o(`多个不一致的 key`);else if(t.version&&t.version!==i.AMap.version)o(`不允许多个版本 JSAPI 混用`);else{var f=[];if(t.plugins)for(u=0;u<t.plugins.length;u+=1)i.AMap.plugins.indexOf(t.plugins[u])==-1&&f.push(t.plugins[u]);c(function(){f.length?window.AMap.plugin(f,function(){e(t).then(function(){n(window.AMap)}).catch(o)}):e(t).then(function(){n(window.AMap)}).catch(o)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,i={key:``,AMap:{version:`1.4.15`,plugins:[]},AMapUI:{version:`1.1`,plugins:[]},Loca:{version:`1.3.2`}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},o={AMap:[],AMapUI:[],Loca:[]}}}})})),HH=s(((e,t)=>{t.exports=n;function n(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=i/a}var o=0,s=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?o=n:s=n,n=(s-o)*.5+o;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}}}));function UH(e,t,n){return Math.min(n,Math.max(t,e))}function WH(e,t,n){let r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function GH(){return $H++}function KH(e,...t){for(let n of t)for(let t in n)e[t]=n[t];return e}function qH(e,t){let n={};for(let r=0;r<t.length;r++){let i=t[r];i in e&&(n[i]=e[i])}return n}function JH(e,t,n,r){let i=new ZH.default(e,t,n,r);return e=>i.solve(e)}function YH(e){tU[e]||(typeof console<`u`&&console.warn(e),tU[e]=!0)}function XH(e){return e*Math.PI/180}var ZH,QH,$H,eU,tU,nU=o((()=>{ZH=u(HH()),QH={number:function(e,t,n){return e+n*(t-e)}},$H=1,eU=JH(.25,.1,.25,1),tU={}}));function rU(e,t,n){n[e]&&n[e].indexOf(t)!==-1||(n[e]=n[e]||[],n[e].push(t))}function iU(e,t,n){if(n&&n[e]){let r=n[e].indexOf(t);r!==-1&&n[e].splice(r,1)}}var aU,oU,sU,cU=o((()=>{ov(),nU(),aU=class{constructor(e,t={}){J(this,`type`,void 0),KH(this,t),this.type=e}},oU=class extends aU{constructor(e,t={}){super(`error`,t),J(this,`error`,void 0),this.error=e}},sU=class{constructor(){J(this,`_listeners`,void 0),J(this,`_oneTimeListeners`,void 0),J(this,`_eventedParent`,void 0),J(this,`_eventedParentData`,void 0)}on(e,t){return this._listeners=this._listeners||{},rU(e,t,this._listeners),this}off(e,t){return iU(e,t,this._listeners),iU(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},rU(e,t,this._oneTimeListeners),this):new Promise(t=>this.once(e,t))}fire(e,t){typeof e==`string`&&(e=new aU(e,t||{}));let n=e.type;if(this.listens(n)){e.target=this;let t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(let n of t)n.call(this,e);let r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(let t of r)iU(n,t,this._oneTimeListeners),t.call(this,e);let i=this._eventedParent;i&&(KH(e,typeof this._eventedParentData==`function`?this._eventedParentData():this._eventedParentData),i.fire(e))}else e instanceof oU&&console.error(e.error);return this}emit(e,t){return this.fire(e,t)}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return e&&(this._eventedParent=e),this._eventedParentData=t,this}}})),lU,uU,dU,fU=o((()=>{ov(),lU=u(qg()),dU=class e{static testProp(t){if(!e.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in e.docStyle)return t[n];return t[0]}static create(e,t,n){let r=window.document.createElement(e);return t!==void 0&&(r.className=t),n&&n.appendChild(r),r}static createNS(e,t){return window.document.createElementNS(e,t)}static disableDrag(){e.docStyle&&e.selectProp&&(e.userSelect=e.docStyle[e.selectProp],e.docStyle[e.selectProp]=`none`)}static enableDrag(){e.docStyle&&e.selectProp&&(e.docStyle[e.selectProp]=e.userSelect)}static setTransform(t,n){t.style[e.transformProp]=n}static addEventListener(e,t,n,r={}){`passive`in r?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)}static removeEventListener(e,t,n,r={}){`passive`in r?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener(`click`,e.suppressClickInternal,!0)}static suppressClick(){window.addEventListener(`click`,e.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener(`click`,e.suppressClickInternal,!0)},0)}static getScale(e){let t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}static getPoint(e,t,n){let r=t.boundingClientRect;return new lU.default((n.clientX-r.left)/t.x-e.clientLeft,(n.clientY-r.top)/t.y-e.clientTop)}static mousePos(t,n){let r=e.getScale(t);return e.getPoint(t,r,n)}static touchPos(t,n){let r=[],i=e.getScale(t);for(let a=0;a<n.length;a++)r.push(e.getPoint(t,i,n[a]));return r}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}},uU=dU,J(dU,`docStyle`,typeof window<`u`&&window.document&&window.document.documentElement.style),J(dU,`userSelect`,void 0),J(dU,`selectProp`,uU.testProp([`userSelect`,`MozUserSelect`,`WebkitUserSelect`,`msUserSelect`])),J(dU,`transformProp`,uU.testProp([`transform`,`WebkitTransform`]))})),pU,mU=o((()=>{ov(),pU=class{constructor(e){J(this,`size`,1e4),this.size=e||1e4}setSize(e){this.size=e}getSize(){return[this.size,this.size]}mercatorXfromLng(e){return(180+e)/360*this.size}mercatorYfromLat(e){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360)*this.size}lngFromMercatorX(e){return e/this.size*360-180}latFromMercatorY(e){let t=180-(1-e/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}project(e){return[this.mercatorXfromLng(e[0]),this.mercatorYfromLat(e[1])]}unproject(e){return[this.lngFromMercatorX(e[0]),this.latFromMercatorY(e[1])]}}})),hU,gU,_U,vU,yU=o((()=>{ov(),cU(),hU=u(qg()),fU(),mU(),gU=class extends aU{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n,r={}){super(e,r),J(this,`target`,void 0),J(this,`originalEvent`,void 0),J(this,`point`,void 0),J(this,`lngLat`,void 0),J(this,`_defaultPrevented`,void 0);let i=dU.mousePos(t.getCanvasContainer(),n),a=t.unproject(i);if(this.point=i,this.lngLat=a,this.originalEvent=n,this._defaultPrevented=!1,this.target=t,t.version===`SIMPLE`){let[e,n]=new pU(t.mapSize).project([a.lng,a.lat]);this.lngLat={lng:e,lat:n}}}},_U=class extends aU{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e),J(this,`target`,void 0),J(this,`originalEvent`,void 0),J(this,`lngLat`,void 0),J(this,`point`,void 0),J(this,`points`,void 0),J(this,`lngLats`,void 0),J(this,`_defaultPrevented`,void 0);let r=e===`touchend`?n.changedTouches:n.touches,i=dU.touchPos(t.getCanvasContainer(),r),a=i.map(e=>t.unproject(e)),o=i.reduce((e,t,n,r)=>e.add(t.div(r.length)),new hU.default(0,0)),s=t.unproject(o);this.target=t,this.points=i,this.point=o,this.lngLats=a,this.lngLat=s,this.originalEvent=n,this._defaultPrevented=!1}},vU=class extends aU{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e),J(this,`target`,void 0),J(this,`originalEvent`,void 0),J(this,`_defaultPrevented`,void 0),this.target=t,this._defaultPrevented=!1,this.originalEvent=n}}})),bU,xU,SU=o((()=>{ov(),nU(),bU=6371008.8,xU=class e{constructor(e,t){if(J(this,`lng`,void 0),J(this,`lat`,void 0),isNaN(e)||isNaN(t))throw Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw Error(`Invalid LngLat latitude value: must be between -90 and 90`)}wrap(){return new e(WH(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return bU*Math.acos(Math.min(i,1))}static convert(t){if(t instanceof e)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t==`object`&&t)return new e(Number(`lng`in t?t.lng:t.lon),Number(t.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}}));function CU(e){return jU*Math.cos(e*Math.PI/180)}function wU(e){return(180+e)/360}function TU(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function EU(e,t){return e/CU(t)}function DU(e){return e*360-180}function OU(e){let t=180-e*360;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}function kU(e,t){return e*CU(OU(t))}function AU(e){return 1/Math.cos(e*Math.PI/180)}var jU,MU,NU=o((()=>{ov(),SU(),jU=2*Math.PI*bU,MU=class e{constructor(e,t,n=0){J(this,`x`,void 0),J(this,`y`,void 0),J(this,`z`,void 0),this.x=+e,this.y=+t,this.z=+n}static fromLngLat(t,n=0){let r=xU.convert(t);return new e(wU(r.lng),TU(r.lat),EU(n,r.lat))}toLngLat(){return new xU(DU(this.x),OU(this.y))}toAltitude(){return kU(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/jU*AU(OU(this.y))}}})),PU,FU=o((()=>{ov(),SU(),PU=class e{constructor(e,t){J(this,`_ne`,void 0),J(this,`_sw`,void 0),e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof xU?new xU(e.lng,e.lat):xU.convert(e),this}setSouthWest(e){return this._sw=e instanceof xU?new xU(e.lng,e.lat):xU.convert(e),this}extend(t){let n=this._sw,r=this._ne,i,a;if(t instanceof xU)i=t,a=t;else if(t instanceof e){if(i=t._sw,a=t._ne,!i||!a)return this}else{if(Array.isArray(t))if(t.length===4||t.every(Array.isArray)){let n=t;return this.extend(e.convert(n))}else{let e=t;return this.extend(xU.convert(e))}else if(t&&(`lng`in t||`lon`in t)&&`lat`in t)return this.extend(xU.convert(t));return this}return!n&&!r?(this._sw=new xU(i.lng,i.lat),this._ne=new xU(a.lng,a.lat)):(n.lng=Math.min(i.lng,n.lng),n.lat=Math.min(i.lat,n.lat),r.lng=Math.max(a.lng,r.lng),r.lat=Math.max(a.lat,r.lat)),this}getCenter(){return new xU((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new xU(this.getWest(),this.getNorth())}getSouthEast(){return new xU(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:t,lat:n}=xU.convert(e),r=this._sw.lat<=n&&n<=this._ne.lat,i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),r&&i}static convert(t){return t instanceof e?t:new e(t)}static fromLngLat(t,n=0){let r=360*n/40075017,i=r/Math.cos(Math.PI/180*t.lat);return new e(new xU(t.lng-i,t.lat-r),new xU(t.lng+i,t.lat+r))}}}));function IU(){return Error(LU)}var LU,RU=o((()=>{LU=`AbortError`})),zU,BU,VU,HU=o((()=>{RU(),zU=typeof performance<`u`&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),VU={now:zU,frameAsync(e){return new Promise((t,n)=>{let r=requestAnimationFrame(t);e.signal.addEventListener(`abort`,()=>{cancelAnimationFrame(r),n(IU())})})},get prefersReducedMotion(){return window.matchMedia?(BU??=window.matchMedia(`(prefers-reduced-motion: reduce)`),BU.matches):!1}}})),UU,WU,GU=o((()=>{ov(),UU=u(qg()),SU(),FU(),NU(),HU(),cU(),nU(),WU=class extends sU{constructor(e,t){super(),J(this,`transform`,void 0),J(this,`handlers`,void 0),J(this,`_moving`,void 0),J(this,`_zooming`,void 0),J(this,`_rotating`,void 0),J(this,`_pitching`,void 0),J(this,`_padding`,void 0),J(this,`_bearingSnap`,void 0),J(this,`_easeStart`,void 0),J(this,`_easeOptions`,void 0),J(this,`_easeId`,void 0),J(this,`_onEaseFrame`,void 0),J(this,`_onEaseEnd`,void 0),J(this,`_easeFrameId`,void 0),J(this,`_requestedCameraState`,void 0),J(this,`transformCameraUpdate`,void 0),J(this,`_renderFrameCallback`,()=>{let e=Math.min((VU.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=t.bearingSnap,this.on(`moveend`,()=>{delete this._requestedCameraState})}getCenter(){return new xU(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(e,t,n){return e=UU.default.convert(e).mult(-1),this.panTo(this.transform.center,KH({offset:e},t),n)}panTo(e,t,n){return this.easeTo(KH({center:e},t),n)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,n){return this.easeTo(KH({zoom:e},t),n)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,n){return this.easeTo(KH({bearing:e},t),n)}resetNorth(e,t){return this.rotateTo(0,KH({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(KH({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=PU.convert(e);let n=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,t)}_cameraForBoxAndBearing(e,t,n,r){let i={top:0,bottom:0,right:0,left:0};if(r=KH({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r),typeof r.padding==`number`){let e=r.padding;r.padding={top:e,bottom:e,right:e,left:e}}r.padding=KH(i,r.padding);let a=this.transform,o=a.padding,s=new PU(e,t),c=a.project(s.getNorthWest()),l=a.project(s.getNorthEast()),u=a.project(s.getSouthEast()),d=a.project(s.getSouthWest()),f=XH(-n),p=c.rotate(f),m=l.rotate(f),h=u.rotate(f),g=d.rotate(f),_=new UU.default(Math.max(p.x,m.x,g.x,h.x),Math.max(p.y,m.y,g.y,h.y)),v=new UU.default(Math.min(p.x,m.x,g.x,h.x),Math.min(p.y,m.y,g.y,h.y)),y=_.sub(v),b=(a.width-(o.left+o.right+r.padding.left+r.padding.right))/y.x,x=(a.height-(o.top+o.bottom+r.padding.top+r.padding.bottom))/y.y;if(x<0||b<0){YH(`Map cannot fit within canvas with the given bounds, padding, and/or offset.`);return}let S=Math.min(a.scaleZoom(a.scale*Math.min(b,x)),r.maxZoom),C=UU.default.convert(r.offset),w=new UU.default((r.padding.left-r.padding.right)/2,(r.padding.top-r.padding.bottom)/2).rotate(XH(n)),E=C.add(w).mult(a.scale/a.zoomScale(S));return{center:a.unproject(c.add(u).div(2).sub(E)),zoom:S,bearing:n}}fitBounds(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}fitScreenCoordinates(e,t,n,r,i){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(UU.default.convert(e)),this.transform.pointLocation(UU.default.convert(t)),n,r),r,i)}_fitInternal(e,t,n){return e?(t=KH(e,t),delete t.padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}jumpTo(e,t){this.stop();let n=this._getTransformForUpdate(),r=!1,i=!1,a=!1;return`zoom`in e&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),e.center!==void 0&&(n.center=xU.convert(e.center)),`bearing`in e&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),`pitch`in e&&n.pitch!==+e.pitch&&(a=!0,n.pitch=+e.pitch),e.padding!=null&&!n.isPaddingEqual(e.padding)&&(n.padding=e.padding),this._applyUpdatedTransform(n),this.fire(new aU(`movestart`,t)).fire(new aU(`move`,t)),r&&this.fire(new aU(`zoomstart`,t)).fire(new aU(`zoom`,t)).fire(new aU(`zoomend`,t)),i&&this.fire(new aU(`rotatestart`,t)).fire(new aU(`rotate`,t)).fire(new aU(`rotateend`,t)),a&&this.fire(new aU(`pitchstart`,t)).fire(new aU(`pitch`,t)).fire(new aU(`pitchend`,t)),this.fire(new aU(`moveend`,t))}calculateCameraOptionsFromTo(e,t,n,r=0){let i=MU.fromLngLat(e,t),a=MU.fromLngLat(n,r),o=a.x-i.x,s=a.y-i.y,c=a.z-i.z,l=Math.hypot(o,s,c);if(l===0)throw Error(`Can't calculate camera options with same From and To`);let u=Math.hypot(o,s),d=this.transform.scaleZoom(this.transform.cameraToCenterDistance/l/this.transform.tileSize),f=Math.atan2(o,-s)*180/Math.PI,p=Math.acos(u/l)*180/Math.PI;return p=c<0?90-p:90+p,{center:a.toLngLat(),zoom:d,pitch:p,bearing:f}}easeTo(e,t){this._stop(!1,e.easeId),e=KH({offset:[0,0],duration:500,easing:eU},e),(e.animate===!1||!e.essential&&VU.prefersReducedMotion)&&(e.duration=0);let n=this._getTransformForUpdate(),r=this.getZoom(),i=this.getBearing(),a=this.getPitch(),o=this.getPadding(),s=`bearing`in e?this._normalizeBearing(e.bearing,i):i,c=`pitch`in e?+e.pitch:a,l=`padding`in e?e.padding:n.padding,u=UU.default.convert(e.offset),d=n.centerPoint.add(u),f=n.pointLocation(d),{center:p,zoom:m}=n.getConstrained(xU.convert(e.center||f),e.zoom??r);this._normalizeCenter(p);let h=n.project(f),g=n.project(p).sub(h),_=n.zoomScale(m-r),v,y;e.around&&(v=xU.convert(e.around),y=n.locationPoint(v));let b={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||m!==r,this._rotating=this._rotating||i!==s,this._pitching=this._pitching||c!==a,this._padding=!n.isPaddingEqual(l),this._easeId=e.easeId,this._prepareEase(t,e.noMoveStart,b),this._ease(e=>{if(this._zooming&&(n.zoom=QH.number(r,m,e)),this._rotating&&(n.bearing=QH.number(i,s,e)),this._pitching&&(n.pitch=QH.number(a,c,e)),this._padding&&(n.interpolatePadding(o,l,e),d=n.centerPoint.add(u)),v)n.setLocationAtPoint(v,y);else{let t=n.zoomScale(n.zoom-r),i=(m>r?Math.min(2,_):Math.max(.5,_))**(1-e),a=n.unproject(h.add(g.mult(e*i)).mult(t));n.setLocationAtPoint(n.renderWorldCopies?a.wrap():a,d)}this._applyUpdatedTransform(n),this._fireMoveEvents(t)},e=>{this._afterEase(t,e)},e),this}_prepareEase(e,t,n={}){this._moving=!0,!t&&!n.moving&&this.fire(new aU(`movestart`,e)),this._zooming&&!n.zooming&&this.fire(new aU(`zoomstart`,e)),this._rotating&&!n.rotating&&this.fire(new aU(`rotatestart`,e)),this._pitching&&!n.pitching&&this.fire(new aU(`pitchstart`,e))}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||=this.transform.clone(),this._requestedCameraState):this.transform}_applyUpdatedTransform(e){if(!this.transformCameraUpdate)return;let t=e.clone(),{center:n,zoom:r,pitch:i,bearing:a,elevation:o}=this.transformCameraUpdate(t);n&&(t.center=n),r!==void 0&&(t.zoom=r),i!==void 0&&(t.pitch=i),a!==void 0&&(t.bearing=a),o!==void 0&&(t.elevation=o),this.transform.apply(t)}_fireMoveEvents(e){this.fire(new aU(`move`,e)),this._zooming&&this.fire(new aU(`zoom`,e)),this._rotating&&this.fire(new aU(`rotate`,e)),this._pitching&&this.fire(new aU(`pitch`,e))}_afterEase(e,t){if(this._easeId&&t&&this._easeId===t)return;delete this._easeId;let n=this._zooming,r=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new aU(`zoomend`,e)),r&&this.fire(new aU(`rotateend`,e)),i&&this.fire(new aU(`pitchend`,e)),this.fire(new aU(`moveend`,e))}flyTo(e,t){if(!e.essential&&VU.prefersReducedMotion){let n=qH(e,[`center`,`zoom`,`bearing`,`pitch`,`around`]);return this.jumpTo(n,t)}this.stop(),e=KH({offset:[0,0],speed:1.2,curve:1.42,easing:eU},e);let n=this._getTransformForUpdate(),r=this.getZoom(),i=this.getBearing(),a=this.getPitch(),o=this.getPadding(),s=`bearing`in e?this._normalizeBearing(e.bearing,i):i,c=`pitch`in e?+e.pitch:a,l=`padding`in e?e.padding:n.padding,u=UU.default.convert(e.offset),d=n.centerPoint.add(u),f=n.pointLocation(d),{center:p,zoom:m}=n.getConstrained(xU.convert(e.center||f),e.zoom??r);this._normalizeCenter(p);let h=n.zoomScale(m-r),g=n.project(f),_=n.project(p).sub(g),v=e.curve,y=Math.max(n.width,n.height),b=y/h,x=_.mag();if(`minZoom`in e){let t=UH(Math.min(e.minZoom,r,m),n.minZoom,n.maxZoom),i=y/n.zoomScale(t-r);v=Math.sqrt(i/x*2)}let S=v*v;function C(e){let t=(b*b-y*y+(e?-1:1)*S*S*x*x)/(2*(e?b:y)*S*x);return Math.log(Math.sqrt(t*t+1)-t)}function w(e){return(Math.exp(e)-Math.exp(-e))/2}function E(e){return(Math.exp(e)+Math.exp(-e))/2}function D(e){return w(e)/E(e)}let O=C(!1),k=function(e){return E(O)/E(O+v*e)},A=function(e){return y*((E(O)*D(O+v*e)-w(O))/S)/x},j=(C(!0)-O)/v;if(Math.abs(x)<1e-6||!isFinite(j)){if(Math.abs(y-b)<1e-6)return this.easeTo(e,t);let n=b<y?-1:1;j=Math.abs(Math.log(b/y))/v,A=()=>0,k=e=>Math.exp(n*v*e)}if(`duration`in e)e.duration=+e.duration;else{let t=`screenSpeed`in e?+e.screenSpeed/v:+e.speed;e.duration=1e3*j/t}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=i!==s,this._pitching=c!==a,this._padding=!n.isPaddingEqual(l),this._prepareEase(t,!1),this._ease(e=>{let f=e*j,h=1/k(f);n.zoom=e===1?m:r+n.scaleZoom(h),this._rotating&&(n.bearing=QH.number(i,s,e)),this._pitching&&(n.pitch=QH.number(a,c,e)),this._padding&&(n.interpolatePadding(o,l,e),d=n.centerPoint.add(u));let v=e===1?p:n.unproject(g.add(_.mult(A(f))).mult(h));n.setLocationAtPoint(n.renderWorldCopies?v.wrap():v,d),this._applyUpdatedTransform(n),this._fireMoveEvents(t)},()=>{this._afterEase(t)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}if(!e){var n;(n=this.handlers)==null||n.stop(!1)}return this}_ease(e,t,n){n.animate===!1||n.duration===0?(e(1),t()):(this._easeStart=VU.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,t){e=WH(e,-180,180);let n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}_normalizeCenter(e){let t=this.transform;if(!t.renderWorldCopies||t.lngRange)return;let n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}})),KU,qU,JU=o((()=>{ov(),KU=u(qg()),nU(),qU=class e{constructor(e=0,t=0,n=0,r=0){if(J(this,`top`,void 0),J(this,`bottom`,void 0),J(this,`left`,void 0),J(this,`right`,void 0),isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0)throw Error(`Invalid value for edge-insets, top, bottom, left and right must all be numbers`);this.top=e,this.bottom=t,this.left=n,this.right=r}interpolate(e,t,n){return t.top!=null&&e.top!=null&&(this.top=QH.number(e.top,t.top,n)),t.bottom!=null&&e.bottom!=null&&(this.bottom=QH.number(e.bottom,t.bottom,n)),t.left!=null&&e.left!=null&&(this.left=QH.number(e.left,t.left,n)),t.right!=null&&e.right!=null&&(this.right=QH.number(e.right,t.right,n)),this}getCenter(e,t){return new KU.default(UH((this.left+e-this.right)/2,0,e),UH((this.top+t-this.bottom)/2,0,t))}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new e(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}})),YU,XU,ZU,QU=o((()=>{ov(),YU=u(qg()),Rb(),nU(),JU(),SU(),FU(),NU(),XU=85.051129,ZU=class e{constructor(e,t,n,r,i){J(this,`tileSize`,void 0),J(this,`tileZoom`,void 0),J(this,`lngRange`,void 0),J(this,`latRange`,void 0),J(this,`scale`,void 0),J(this,`width`,void 0),J(this,`height`,void 0),J(this,`angle`,void 0),J(this,`rotationMatrix`,void 0),J(this,`pixelsToGLUnits`,void 0),J(this,`cameraToCenterDistance`,void 0),J(this,`mercatorMatrix`,void 0),J(this,`projMatrix`,void 0),J(this,`invProjMatrix`,void 0),J(this,`alignedProjMatrix`,void 0),J(this,`pixelMatrix`,void 0),J(this,`pixelMatrix3D`,void 0),J(this,`pixelMatrixInverse`,void 0),J(this,`glCoordMatrix`,void 0),J(this,`labelPlaneMatrix`,void 0),J(this,`minElevationForCurrentTile`,void 0),J(this,`_fov`,void 0),J(this,`_pitch`,void 0),J(this,`_zoom`,void 0),J(this,`_unmodified`,void 0),J(this,`_renderWorldCopies`,void 0),J(this,`_minZoom`,void 0),J(this,`_maxZoom`,void 0),J(this,`_minPitch`,void 0),J(this,`_maxPitch`,void 0),J(this,`_center`,void 0),J(this,`_elevation`,void 0),J(this,`_pixelPerMeter`,void 0),J(this,`_edgeInsets`,void 0),J(this,`_constraining`,void 0),J(this,`_posMatrixCache`,void 0),J(this,`_alignedPosMatrixCache`,void 0),this.tileSize=512,this._renderWorldCopies=i===void 0?!0:!!i,this._minZoom=e||0,this._maxZoom=t||22,this._minPitch=n??0,this._maxPitch=r??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new xU(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qU,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){let t=new e(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new YU.default(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){let t=-WH(e,-180,180)*Math.PI/180;this.angle!==t&&(this._unmodified=!1,this.angle=t,this._calcMatrices(),this.rotationMatrix=Uy(),Wy(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let t=UH(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==t&&(this._unmodified=!1,this._pitch=t,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){let t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._zoom=t,this.tileZoom=Math.max(0,Math.floor(t)),this.scale=this.zoomScale(t),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return 2**e}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let t=UH(e.lat,-XU,XU);return new YU.default(wU(e.lng)*this.worldSize,TU(t)*this.worldSize)}unproject(e){return new MU(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}setLocationAtPoint(e,t){let n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),a=new MU(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e){return this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}locationCoordinate(e){return MU.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e){let t=[e.x,e.y,0,1],n=[e.x,e.y,1,1];wb(t,t,this.pixelMatrixInverse),wb(n,n,this.pixelMatrixInverse);let r=t[3],i=n[3],a=t[0]/r,o=n[0]/i,s=t[1]/r,c=n[1]/i,l=t[2]/r,u=n[2]/i,d=l===u?0:(0-l)/(u-l);return new MU(QH.number(a,o,d)/this.worldSize,QH.number(s,c,d)/this.worldSize)}coordinatePoint(e,t=0,n=this.pixelMatrix){let r=[e.x*this.worldSize,e.y*this.worldSize,t,1];return wb(r,r,n),new YU.default(r[0]/r[3],r[1]/r[3])}getBounds(){let e=Math.max(0,this.height/2-this.getHorizon());return new PU().extend(this.pointLocation(new YU.default(0,e))).extend(this.pointLocation(new YU.default(this.width,e))).extend(this.pointLocation(new YU.default(this.width,this.height))).extend(this.pointLocation(new YU.default(0,this.height)))}getMaxBounds(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new PU([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-XU,XU])}customLayerMatrix(){return qy(this.mercatorMatrix)}getConstrained(e,t){t=UH(+t,this.minZoom,this.maxZoom);let n={center:new xU(e.lng,e.lat),zoom:t},r=this.lngRange;if(!this._renderWorldCopies&&r===null){let e=179.9999999999;r=[-e,e]}let i=this.tileSize*this.zoomScale(n.zoom),a=0,o=i,s=0,c=i,l=0,u=0,{x:d,y:f}=this.size;if(this.latRange){let e=this.latRange;a=TU(e[1])*i,o=TU(e[0])*i,o-a<f&&(l=f/(o-a))}r&&(s=WH(wU(r[0])*i,0,i),c=WH(wU(r[1])*i,0,i),c<s&&(c+=i),c-s<d&&(u=d/(c-s)));let{x:p,y:m}=this.project.call({worldSize:i},e),h,g,_=Math.max(u||0,l||0);if(_){let e=new YU.default(u?(c+s)/2:p,l?(o+a)/2:m);return n.center=this.unproject.call({worldSize:i},e).wrap(),n.zoom+=this.scaleZoom(_),n}if(this.latRange){let e=f/2;m-e<a&&(g=a+e),m+e>o&&(g=o-e)}if(r){let e=(s+c)/2,t=p;this._renderWorldCopies&&(t=WH(p,e-i/2,e+i/2));let n=d/2;t-n<s&&(h=s+n),t+n>c&&(h=c-n)}if(h!==void 0||g!==void 0){let e=new YU.default(h??p,g??m);n.center=this.unproject.call({worldSize:i},e).wrap()}return n}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:t,zoom:n}=this.getConstrained(this.center,this.zoom);this.center=t,this.zoom=n,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;let e=this._fov/2,t=this.centerOffset,n=this.point.x,r=this.point.y;this.cameraToCenterDistance=.5/Math.tan(e)*this.height,this._pixelPerMeter=EU(1,this.center.lat)*this.worldSize;let i=Yy(new Float64Array(16));$y(i,i,[this.width/2,-this.height/2,1]),Qy(i,i,[1,-1,0]),this.labelPlaneMatrix=i,i=Yy(new Float64Array(16)),$y(i,i,[1,-1,1]),Qy(i,i,[-1,-1,0]),$y(i,i,[2/this.width,2/this.height,1]),this.glCoordMatrix=i;let a=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),o=Math.min(this.elevation,this.minElevationForCurrentTile),s=a-o*this._pixelPerMeter/Math.cos(this._pitch),c=o<0?s:a,l=Math.PI/2+this._pitch,u=this._fov*(.5+t.y/this.height),d=Math.sin(u)*c/Math.sin(UH(Math.PI-l-u,.01,Math.PI-.01)),f=this.getHorizon(),p=2*Math.atan(f/this.cameraToCenterDistance)*(.5+t.y/(f*2)),m=Math.sin(p)*c/Math.sin(UH(Math.PI-l-p,.01,Math.PI-.01)),h=Math.min(d,m),g=(Math.cos(Math.PI/2-this._pitch)*h+c)*1.01,_=this.height/50;i=new Float64Array(16),ob(i,this._fov,this.width/this.height,_,g),i[8]=-t.x*2/this.width,i[9]=t.y*2/this.height,$y(i,i,[1,-1,1]),Qy(i,i,[0,0,-this.cameraToCenterDistance]),eb(i,i,this._pitch),nb(i,i,this.angle),Qy(i,i,[-n,-r,0]),this.mercatorMatrix=$y([],i,[this.worldSize,this.worldSize,this.worldSize]),$y(i,i,[1,1,this._pixelPerMeter]),this.pixelMatrix=Zy(new Float64Array(16),this.labelPlaneMatrix,i),Qy(i,i,[0,0,-this.elevation]),this.projMatrix=i,this.invProjMatrix=Xy([],i),this.pixelMatrix3D=Zy(new Float64Array(16),this.labelPlaneMatrix,i);let v=this.width%2/2,y=this.height%2/2,b=Math.cos(this.angle),x=Math.sin(this.angle),S=n-Math.round(n)+b*v+x*y,C=r-Math.round(r)+b*y+x*v,w=new Float64Array(i);if(Qy(w,w,[S>.5?S-1:S,C>.5?C-1:C,0]),this.alignedProjMatrix=w,i=Xy(new Float64Array(16),this.pixelMatrix),!i)throw Error(`failed to invert matrix`);this.pixelMatrixInverse=i,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let e=this.pointCoordinate(new YU.default(0,0)),t=[e.x*this.worldSize,e.y*this.worldSize,0,1];return wb(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new YU.default(0,t))}getCameraQueryGeometry(e){let t=this.getCameraPoint();if(e.length===1)return[e[0],t];{let n=t.x,r=t.y,i=t.x,a=t.y;for(let t of e)n=Math.min(n,t.x),r=Math.min(r,t.y),i=Math.max(i,t.x),a=Math.max(a,t.y);return[new YU.default(n,r),new YU.default(i,r),new YU.default(i,a),new YU.default(n,a),new YU.default(n,r)]}}lngLatToCameraDepth(e,t){let n=this.locationCoordinate(e),r=[n.x*this.worldSize,n.y*this.worldSize,t,1];return wb(r,r,this.projMatrix),r[2]/r[3]}}})),$U,eW,tW=o((()=>{ov(),$U=u(qg()),eW=class{constructor(e){J(this,`_map`,void 0),this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation($U.default.convert(e))}}})),nW,rW=o((()=>{ov(),fU(),cU(),tW(),nW=class{constructor(e,t){J(this,`_map`,void 0),J(this,`_tr`,void 0),J(this,`_el`,void 0),J(this,`_container`,void 0),J(this,`_enabled`,void 0),J(this,`_active`,void 0),J(this,`_startPos`,void 0),J(this,`_lastPos`,void 0),J(this,`_box`,void 0),J(this,`_clickTolerance`,void 0),this._map=e,this._tr=new eW(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&e.button===0&&(dU.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;let n=t;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;let r=this._startPos;this._lastPos=n,this._box||(this._box=dU.create(`div`,`l7-boxzoom`,this._container),this._container.classList.add(`l7-crosshair`),this._fireEvent(`boxzoomstart`,e));let i=Math.min(r.x,n.x),a=Math.max(r.x,n.x),o=Math.min(r.y,n.y),s=Math.max(r.y,n.y);dU.setTransform(this._box,`translate(${i}px,${o}px)`),this._box.style.width=`${a-i}px`,this._box.style.height=`${s-o}px`}mouseupWindow(e,t){if(!this._active||e.button!==0)return;let n=this._startPos,r=t;if(this.reset(),dU.suppressClick(),n.x===r.x&&n.y===r.y)this._fireEvent(`boxzoomcancel`,e);else return this._map.fire(new aU(`boxzoomend`,{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(n,r,this._tr.bearing,{linear:!0})}}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent(`boxzoomcancel`,e))}reset(){this._active=!1,this._container.classList.remove(`l7-crosshair`),this._box&&=(dU.remove(this._box),null),dU.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,t){return this._map.fire(new aU(e,{originalEvent:t}))}}})),iW,aW=o((()=>{ov(),tW(),iW=class{constructor(e){J(this,`_tr`,void 0),J(this,`_enabled`,void 0),J(this,`_active`,void 0),this._tr=new eW(e),this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}})),oW,sW=o((()=>{ov(),fU(),oW=class{constructor(e,t){J(this,`_options`,void 0),J(this,`_map`,void 0),J(this,`_container`,void 0),J(this,`_bypassKey`,navigator.userAgent.indexOf(`Mac`)===-1?`ctrlKey`:`metaKey`),J(this,`_enabled`,void 0),this._map=e,this._options=t,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add(`l7-cooperative-gestures`),this._container=dU.create(`div`,`l7-cooperative-gesture-screen`,e);let t=document.createElement(`div`);t.className=`l7-desktop-message`,t.textContent=`Missing UI string`,this._container.appendChild(t);let n=document.createElement(`div`);n.className=`l7-mobile-message`,n.textContent=`Missing UI string`,this._container.appendChild(n),this._container.setAttribute(`aria-hidden`,`true`)}_destoryUI(){this._container&&(dU.remove(this._container),this._map.getCanvasContainer().classList.remove(`l7-cooperative-gestures`)),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(e){this._onCooperativeGesture(e.touches.length===1)}wheel(e){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!e[this._bypassKey])}_onCooperativeGesture(e){!this._enabled||!e||(this._container.classList.add(`l7-show`),setTimeout(()=>{this._container.classList.remove(`l7-show`)},100))}}}));function cW(e){return e*(2-e)}var lW,uW,dW=o((()=>{ov(),tW(),lW={panStep:100,bearingStep:15,pitchStep:10},uW=class{constructor(e){J(this,`_tr`,void 0),J(this,`_enabled`,void 0),J(this,`_active`,void 0),J(this,`_panStep`,void 0),J(this,`_bearingStep`,void 0),J(this,`_pitchStep`,void 0),J(this,`_rotationDisabled`,void 0),this._tr=new eW(e);let t=lW;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,r=0,i=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),i=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),i=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(n=0,r=0),{cameraAnimation:o=>{let s=this._tr;o.easeTo({duration:300,easeId:`keyboardHandler`,easing:cW,zoom:t?Math.round(s.zoom)+t*(e.shiftKey?2:1):s.zoom,bearing:s.bearing+n*this._bearingStep,pitch:s.pitch+r*this._pitchStep,offset:[-i*this._panStep,-a*this._panStep],center:s.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}})),fW,pW,mW=o((()=>{ov(),yU(),fW=class{constructor(e,t){J(this,`_mousedownPos`,void 0),J(this,`_clickTolerance`,void 0),J(this,`_map`,void 0),this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new vU(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new gU(e.type,this._map,e))}mouseup(e){this._map.fire(new gU(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new gU(e.type,this._map,e))}dblclick(e){return this._firePreventable(new gU(e.type,this._map,e))}mouseover(e){this._map.fire(new gU(e.type,this._map,e))}mouseout(e){this._map.fire(new gU(e.type,this._map,e))}touchstart(e){return this._firePreventable(new _U(e.type,this._map,e))}touchmove(e){this._map.fire(new _U(e.type,this._map,e))}touchend(e){this._map.fire(new _U(e.type,this._map,e))}touchcancel(e){this._map.fire(new _U(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}},pW=class{constructor(e){J(this,`_map`,void 0),J(this,`_delayContextMenu`,void 0),J(this,`_ignoreContextMenu`,void 0),J(this,`_contextMenuEvent`,void 0),this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new gU(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gU(`contextmenu`,this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new gU(e.type,this._map,e)),this._map.listens(`contextmenu`)&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}})),hW,gW=o((()=>{ov(),fU(),hW=class{constructor(e){J(this,`contextmenu`,void 0),J(this,`mousedown`,void 0),J(this,`mousemoveWindow`,void 0),J(this,`mouseup`,void 0),J(this,`touchstart`,void 0),J(this,`touchmoveWindow`,void 0),J(this,`touchend`,void 0),J(this,`_clickTolerance`,void 0),J(this,`_moveFunction`,void 0),J(this,`_activateOnStart`,void 0),J(this,`_active`,void 0),J(this,`_enabled`,void 0),J(this,`_moved`,void 0),J(this,`_lastPoint`,void 0),J(this,`_moveStateManager`,void 0),this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let t=this._moveFunction(...e);if(t.bearingDelta||t.pitchDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(e,t){!this.isEnabled()||this._lastPoint||this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=t.length?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,t){if(!this.isEnabled())return;let n=this._lastPoint;if(!n)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e)){this.reset(e);return}let r=t.length?t[0]:t;if(!(!this._moved&&r.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(n,r)}dragEnd(e){!this.isEnabled()||!this._lastPoint||this._moveStateManager.isValidEndEvent(e)&&(this._moved&&dU.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}}));function _W(e,t){let n=bW[t];return e.buttons===void 0||(e.buttons&n)!==n}var vW,yW,bW,xW,SW=o((()=>{ov(),fU(),vW=0,yW=2,bW={[vW]:1,[yW]:2},xW=class{constructor(e){J(this,`_eventButton`,void 0),J(this,`_correctEvent`,void 0),this._correctEvent=e.checkCorrectEvent}startMove(e){this._eventButton=dU.mouseButton(e)}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!_W(e,this._eventButton)}isValidEndEvent(e){return dU.mouseButton(e)===this._eventButton}}})),CW,wW,TW,EW,DW,OW,kW=o((()=>{fU(),gW(),SW(),CW=0,wW=2,TW=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=e=>{e.preventDefault()}},EW=({enable:e,clickTolerance:t})=>new hW({clickTolerance:t,move:(e,t)=>({around:t,panDelta:t.sub(e)}),activateOnStart:!0,moveStateManager:new xW({checkCorrectEvent:e=>dU.mouseButton(e)===CW&&!e.ctrlKey}),enable:e,assignEvents:TW}),DW=({enable:e,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>new hW({clickTolerance:t,move:(e,t)=>({bearingDelta:(t.x-e.x)*n}),moveStateManager:new xW({checkCorrectEvent:e=>dU.mouseButton(e)===CW&&e.ctrlKey||dU.mouseButton(e)===wW}),enable:e,assignEvents:TW}),OW=({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>new hW({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*n}),moveStateManager:new xW({checkCorrectEvent:e=>dU.mouseButton(e)===CW&&e.ctrlKey||dU.mouseButton(e)===wW}),enable:e,assignEvents:TW})})),AW,jW,MW,NW,PW,FW=o((()=>{ov(),fU(),SU(),HU(),nU(),tW(),AW=4.000244140625,jW=1/100,MW=1/450,NW=2,PW=class{constructor(e,t){J(this,`_map`,void 0),J(this,`_tr`,void 0),J(this,`_enabled`,void 0),J(this,`_active`,void 0),J(this,`_zooming`,void 0),J(this,`_aroundCenter`,void 0),J(this,`_around`,void 0),J(this,`_aroundPoint`,void 0),J(this,`_type`,void 0),J(this,`_lastValue`,void 0),J(this,`_timeout`,void 0),J(this,`_finishTimeout`,void 0),J(this,`_lastWheelEvent`,void 0),J(this,`_lastWheelEventTime`,void 0),J(this,`_startZoom`,void 0),J(this,`_targetZoom`,void 0),J(this,`_delta`,void 0),J(this,`_easing`,void 0),J(this,`_prevEase`,void 0),J(this,`_frameId`,void 0),J(this,`_triggerRenderFrame`,void 0),J(this,`_defaultZoomRate`,void 0),J(this,`_wheelZoomRate`,void 0),J(this,`_onTimeout`,e=>{this._type=`wheel`,this._delta-=this._lastValue,this._active||this._start(e)}),this._map=e,this._tr=new eW(e),this._triggerRenderFrame=t,this._delta=0,this._defaultZoomRate=jW,this._wheelZoomRate=MW}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around===`center`)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!e[this._map.cooperativeGestures._bypassKey])return;let t=e.deltaMode===WheelEvent.DOM_DELTA_LINE?e.deltaY*40:e.deltaY,n=VU.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,t!==0&&t%AW===0?this._type=`wheel`:t!==0&&Math.abs(t)<4?this._type=`trackpad`:r>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*t)<200?`trackpad`:`wheel`,this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&(this._lastWheelEvent=e,this._delta-=t,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&=null,this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let t=dU.mousePos(this._map.getCanvasContainer(),e),n=this._tr;t.y>n.transform.height/2-n.transform.getHorizon()?this._around=xU.convert(this._aroundCenter?n.center:n.unproject(t)):this._around=xU.convert(n.center),this._aroundPoint=n.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(this._delta!==0){let t=this._type===`wheel`&&Math.abs(this._delta)>AW?this._wheelZoomRate:this._defaultZoomRate,n=NW/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&n!==0&&(n=1/n);let r=typeof this._targetZoom==`number`?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(r*n))),this._type===`wheel`&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let t=typeof this._targetZoom==`number`?this._targetZoom:e.zoom,n=this._startZoom,r=this._easing,i=!1,a;if(this._type===`wheel`&&n&&r){let e=Math.min((VU.now()-this._lastWheelEventTime)/200,1),o=r(e);a=QH.number(n,t,o),e<1?this._frameId||=!0:i=!0}else a=t,i=!0;return this._active=!0,i&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!i,zoomDelta:a-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let t=eU;if(this._prevEase){let e=this._prevEase,n=(VU.now()-e.start)/e.duration,r=e.easing(n+.01)-e.easing(n),i=.27/Math.sqrt(r*r+1e-4)*.01;t=JH(i,Math.sqrt(.27*.27-i*i),.25,1)}return this._prevEase={start:VU.now(),duration:e,easing:t},t}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}})),IW,LW=o((()=>{ov(),IW=class{constructor(e,t){J(this,`_clickZoom`,void 0),J(this,`_tapZoom`,void 0),this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}})),RW,zW=o((()=>{ov(),RW=class{constructor(e,t,n){J(this,`_el`,void 0),J(this,`_mousePan`,void 0),J(this,`_touchPan`,void 0),J(this,`_inertiaOptions`,void 0),this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add(`l7-touch-drag-pan`)}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove(`l7-touch-drag-pan`)}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}})),BW,VW=o((()=>{ov(),BW=class{constructor(e,t,n){J(this,`_mouseRotate`,void 0),J(this,`_mousePitch`,void 0),J(this,`_pitchWithRotate`,void 0),this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}})),HW,UW=o((()=>{ov(),HW=class{constructor(e,t,n,r){J(this,`_el`,void 0),J(this,`_touchZoom`,void 0),J(this,`_touchRotate`,void 0),J(this,`_tapDragZoom`,void 0),J(this,`_rotationDisabled`,void 0),J(this,`_enabled`,void 0),this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add(`l7-touch-zoom-rotate`)}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove(`l7-touch-zoom-rotate`)}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}}));function WW(e,t){if(e.length!==t.length)throw Error(`The number of touches and points are not equal - touches ${e.length}, points ${t.length}`);let n={};for(let r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var GW=o((()=>{}));function KW(e){let t=new qW.default(0,0);for(let n of e)t._add(n);return t.div(e.length)}var qW,JW,YW,XW,ZW=o((()=>{ov(),qW=u(qg()),GW(),JW=500,YW=class{constructor(e){J(this,`numTouches`,void 0),J(this,`centroid`,void 0),J(this,`startTime`,void 0),J(this,`aborted`,void 0),J(this,`touches`,void 0),this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=KW(t),this.touches=WW(n,t)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;let r=WW(n,t);for(let e in this.touches){let t=this.touches[e],n=r[e];(!n||n.dist(t)>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>JW)&&(this.aborted=!0),n.length===0){let e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}},XW=class{constructor(e){J(this,`singleTap`,void 0),J(this,`numTaps`,void 0),J(this,`lastTime`,void 0),J(this,`lastTap`,void 0),J(this,`count`,void 0),this.singleTap=new YW(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){let r=this.singleTap.touchend(e,t,n);if(r){let t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(r)<30;if((!t||!n)&&this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}})),QW,$W=o((()=>{ov(),ZW(),QW=class{constructor(){J(this,`_enabled`,void 0),J(this,`_active`,void 0),J(this,`_swipePoint`,void 0),J(this,`_swipeTouch`,void 0),J(this,`_tapTime`,void 0),J(this,`_tapPoint`,void 0),J(this,`_tap`,void 0),this._tap=new XW({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,t,n){if(!this._swipePoint)if(!this._tapTime)this._tap.touchstart(e,t,n);else{let r=t[0],i=e.timeStamp-this._tapTime<500,a=this._tapPoint.dist(r)<30;!i||!a?this.reset():n.length>0&&(this._swipePoint=r,this._swipeTouch=n[0].identifier)}}touchmove(e,t,n){if(!this._tapTime)this._tap.touchmove(e,t,n);else if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;let r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}touchend(e,t,n){if(this._tapTime)this._swipePoint&&n.length===0&&this.reset();else{let r=this._tap.touchend(e,t,n);r&&(this._tapTime=e.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}})),eG,tG=o((()=>{ov(),ZW(),tW(),eG=class{constructor(e){J(this,`_tr`,void 0),J(this,`_enabled`,void 0),J(this,`_active`,void 0),J(this,`_zoomIn`,void 0),J(this,`_zoomOut`,void 0),this._tr=new eW(e),this._zoomIn=new XW({numTouches:1,numTaps:2}),this._zoomOut=new XW({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){let r=this._zoomIn.touchend(e,t,n),i=this._zoomOut.touchend(e,t,n),a=this._tr;if(r)return this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:a.zoom+1,around:a.unproject(r)},{originalEvent:e})};if(i)return this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:a.zoom-1,around:a.unproject(i)},{originalEvent:e})}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}})),nG,rG,iG=o((()=>{ov(),nG=u(qg()),GW(),rG=class{constructor(e,t){J(this,`_enabled`,void 0),J(this,`_active`,void 0),J(this,`_touches`,void 0),J(this,`_clickTolerance`,void 0),J(this,`_sum`,void 0),J(this,`_map`,void 0),this._clickTolerance=e.clickTolerance||1,this._map=t,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new nG.default(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(!(!this._active||n.length<this.minTouchs()))return e.preventDefault(),this._calculateTransform(e,t,n)}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,t,n){n.length>0&&(this._active=!0);let r=WW(n,t),i=new nG.default(0,0),a=new nG.default(0,0),o=0;for(let e in r){let t=r[e],n=this._touches[e];n&&(i._add(t),a._add(t.sub(n)),o++,r[e]=t)}if(this._touches=r,o<this.minTouchs()||!a.mag())return;let s=a.div(o);if(this._sum._add(s),!(this._sum.mag()<this._clickTolerance))return{around:i.div(o),panDelta:s}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}}));function aG(e,t,n){for(let r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function oG(e,t){return Math.log(e/t)/Math.LN2}function sG(e,t){return e.angleWith(t)*180/Math.PI}function cG(e){return Math.abs(e.y)>Math.abs(e.x)}var lG,uG,dG,fG,pG,mG,hG,gG=o((()=>{ov(),fU(),lG=class{constructor(){J(this,`_enabled`,void 0),J(this,`_active`,void 0),J(this,`_firstTwoTouches`,void 0),J(this,`_vector`,void 0),J(this,`_startVector`,void 0),J(this,`_aroundCenter`,void 0),this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){if(!this._firstTwoTouches)return;e.preventDefault();let[r,i]=this._firstTwoTouches,a=aG(n,t,r),o=aG(n,t,i);if(!a||!o)return;let s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;let[r,i]=this._firstTwoTouches,a=aG(n,t,r),o=aG(n,t,i);a&&o||(this._active&&dU.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around===`center`}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}},uG=.1,dG=class extends lG{constructor(...e){super(...e),J(this,`_distance`,void 0),J(this,`_startDistance`,void 0)}reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){let n=this._distance;if(this._distance=e[0].dist(e[1]),!(!this._active&&Math.abs(oG(this._distance,this._startDistance))<uG))return this._active=!0,{zoomDelta:oG(this._distance,n),pinchAround:t}}},fG=25,pG=class extends lG{constructor(...e){super(...e),J(this,`_minDiameter`,void 0)}reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t,n){let r=this._vector;if(this._vector=e[0].sub(e[1]),!(!this._active&&this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:sG(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let t=fG/(Math.PI*this._minDiameter)*360,n=sG(e,this._startVector);return Math.abs(n)<t}},mG=100,hG=class extends lG{constructor(e){super(),J(this,`_valid`,void 0),J(this,`_firstMove`,void 0),J(this,`_lastPoints`,void 0),J(this,`_map`,void 0),J(this,`_currentTouchCount`,0),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,t,n){super.touchstart(e,t,n),this._currentTouchCount=n.length}_start(e){this._lastPoints=e,cG(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let r=e[0].sub(this._lastPoints[0]),i=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}}gestureBeginsVertically(e,t,n){if(this._valid!==void 0)return this._valid;let r=e.mag()>=2,i=t.mag()>=2;if(!r&&!i)return;if(!r||!i)return this._firstMove===void 0&&(this._firstMove=n),n-this._firstMove<mG?void 0:!1;let a=e.y>0==t.y>0;return cG(e)&&cG(t)&&a}}}));function _G(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function vG(e,t,n){let{maxSpeed:r,linearity:i,deceleration:a}=n,o=UH(e*i/(t/1e3),-r,r),s=Math.abs(o)/(a*i);return{easing:n.easing,duration:s*1e3,amount:s/2*o}}var yG,bG,xG,SG,CG,wG,TG,EG=o((()=>{ov(),yG=u(qg()),HU(),nU(),bG={linearity:.3,easing:JH(0,0,.3,1)},xG=KH({deceleration:2500,maxSpeed:1400},bG),SG=KH({deceleration:20,maxSpeed:1400},bG),CG=KH({deceleration:1e3,maxSpeed:360},bG),wG=KH({deceleration:1e3,maxSpeed:90},bG),TG=class{constructor(e){J(this,`_map`,void 0),J(this,`_inertiaBuffer`,void 0),this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:VU.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,t=VU.now();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let t={zoom:0,bearing:0,pitch:0,pan:new yG.default(0,0),pinchAround:void 0,around:void 0};for(let{settings:e}of this._inertiaBuffer)t.zoom+=e.zoomDelta||0,t.bearing+=e.bearingDelta||0,t.pitch+=e.pitchDelta||0,e.panDelta&&t.pan._add(e.panDelta),e.around&&(t.around=e.around),e.pinchAround&&(t.pinchAround=e.pinchAround);let n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(t.pan.mag()){let i=vG(t.pan.mag(),n,KH({},xG,e||{}));r.offset=t.pan.mult(i.amount/t.pan.mag()),r.center=this._map.transform.center,_G(r,i)}if(t.zoom){let e=vG(t.zoom,n,SG);r.zoom=this._map.transform.zoom+e.amount,_G(r,e)}if(t.bearing){let e=vG(t.bearing,n,CG);r.bearing=this._map.transform.bearing+UH(e.amount,-179,179),_G(r,e)}if(t.pitch){let e=vG(t.pitch,n,wG);r.pitch=this._map.transform.pitch+e.amount,_G(r,e)}if(r.zoom||r.bearing){let e=t.pinchAround===void 0?t.around:t.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),KH(r,{noMoveStart:!0})}}}));function DG(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var OG,kG,AG,jG,MG=o((()=>{ov(),OG=u(qg()),rW(),aW(),sW(),dW(),mW(),kW(),FW(),LW(),zW(),VW(),UW(),$W(),tG(),iG(),gG(),EG(),HU(),fU(),cU(),nU(),kG=e=>e.zoom||e.drag||e.pitch||e.rotate,AG=class extends aU{constructor(e,t){super(e),J(this,`type`,`renderFrame`),J(this,`timeStamp`,void 0),this.timeStamp=t}},jG=class{constructor(e,t){J(this,`_map`,void 0),J(this,`_el`,void 0),J(this,`_handlers`,void 0),J(this,`_eventsInProgress`,void 0),J(this,`_frameId`,void 0),J(this,`_inertia`,void 0),J(this,`_bearingSnap`,void 0),J(this,`_handlersById`,void 0),J(this,`_updatingCamera`,void 0),J(this,`_changes`,void 0),J(this,`_zoom`,void 0),J(this,`_previousActiveHandlers`,void 0),J(this,`_listeners`,void 0),J(this,`handleWindowEvent`,e=>{this.handleEvent(e,`${e.type}Window`)}),J(this,`handleEvent`,(e,t)=>{if(e.type===`blur`){this.stop(!0);return}this._updatingCamera=!0;let n=e.type===`renderFrame`?void 0:e,r={needsRenderFrame:!1},i={},a={},o=e.touches,s=o?this._getMapTouches(o):void 0,c=s?dU.touchPos(this._map.getCanvasContainer(),s):dU.mousePos(this._map.getCanvasContainer(),e);for(let{handlerName:o,handler:l,allowed:u}of this._handlers){if(!l.isEnabled())continue;let d;this._blockedByActive(a,u,o)?l.reset():l[t||e.type]&&(d=l[t||e.type](e,c,s),this.mergeHandlerResult(r,i,d,o,n),d&&d.needsRenderFrame&&this._triggerRenderFrame()),(d||l.isActive())&&(a[o]=l)}let l={};for(let e in this._previousActiveHandlers)a[e]||(l[e]=n);this._previousActiveHandlers=a,(Object.keys(l).length||DG(r))&&(this._changes.push([r,i,l]),this._triggerRenderFrame()),(Object.keys(a).length||DG(r))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}),this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new TG(e),this._bearingSnap=t.bearingSnap||7,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(t);let n=this._el;this._listeners=[[n,`touchstart`,{passive:!0}],[n,`touchmove`,{passive:!1}],[n,`touchend`,void 0],[n,`touchcancel`,void 0],[n,`mousedown`,void 0],[n,`mousemove`,void 0],[n,`mouseup`,void 0],[document,`mousemove`,{capture:!0}],[document,`mouseup`,void 0],[n,`mouseover`,void 0],[n,`mouseout`,void 0],[n,`dblclick`,void 0],[n,`click`,void 0],[n,`keydown`,{capture:!1}],[n,`keyup`,void 0],[n,`wheel`,{passive:!1}],[n,`contextmenu`,void 0],[window,`blur`,void 0]];for(let[e,t,n]of this._listeners)dU.addEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,n)}destroy(){for(let[e,t,n]of this._listeners)dU.removeEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){let t=this._map,n=t.getCanvasContainer();this._add(`mapEvent`,new fW(t,e));let r=t.boxZoom=new nW(t,e);this._add(`boxZoom`,r),e.interactive&&e.boxZoom&&r.enable();let i=t.cooperativeGestures=new oW(t,e.cooperativeGestures);this._add(`cooperativeGestures`,i),e.cooperativeGestures&&i.enable();let a=new eG(t),o=new iW(t);t.doubleClickZoom=new IW(o,a),this._add(`tapZoom`,a),this._add(`clickZoom`,o),e.interactive&&e.doubleClickZoom&&t.doubleClickZoom.enable();let s=new QW;this._add(`tapDragZoom`,s);let c=t.touchPitch=new hG(t);this._add(`touchPitch`,c),e.interactive&&e.touchPitch&&t.touchPitch.enable(e.touchPitch);let l=DW(e),u=OW(e);t.dragRotate=new BW(e,l,u),this._add(`mouseRotate`,l,[`mousePitch`]),this._add(`mousePitch`,u,[`mouseRotate`]),e.interactive&&e.dragRotate&&t.dragRotate.enable();let d=EW(e),f=new rG(e,t);t.dragPan=new RW(n,d,f),this._add(`mousePan`,d),this._add(`touchPan`,f,[`touchZoom`,`touchRotate`]),e.interactive&&e.dragPan&&t.dragPan.enable(e.dragPan);let p=new pG,m=new dG;t.touchZoomRotate=new HW(n,m,p,s),this._add(`touchRotate`,p,[`touchPan`,`touchZoom`]),this._add(`touchZoom`,m,[`touchPan`,`touchRotate`]),e.interactive&&e.touchZoomRotate&&t.touchZoomRotate.enable(e.touchZoomRotate);let h=t.scrollZoom=new PW(t,()=>this._triggerRenderFrame());this._add(`scrollZoom`,h,[`mousePan`]),e.interactive&&e.scrollZoom&&t.scrollZoom.enable(e.scrollZoom);let g=t.keyboard=new uW(t);this._add(`keyboard`,g),e.interactive&&e.keyboard&&t.keyboard.enable(),this._add(`blockableMapEvent`,new pW(t))}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(let{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kG(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,t,n){for(let r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}_getMapTouches(e){let t=[];for(let n of e){let e=n.target;this._el.contains(e)&&t.push(n)}return t}mergeHandlerResult(e,t,n,r,i){if(!n)return;KH(e,n);let a={handlerName:r,originalEvent:n.originalEvent||i};n.zoomDelta!==void 0&&(t.zoom=a),n.panDelta!==void 0&&(t.drag=a),n.pitchDelta!==void 0&&(t.pitch=a),n.bearingDelta!==void 0&&(t.rotate=a)}_applyChanges(){let e={},t={},n={};for(let[r,i,a]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new OG.default(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),r.around!==void 0&&(e.around=r.around),r.pinchAround!==void 0&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),KH(t,i),KH(n,a);this._updateMapTransform(e,t,n),this._changes=[]}_updateMapTransform(e,t,n){let r=this._map,i=r._getTransformForUpdate();if(!DG(e))return this._fireEvents(t,n,!0);let{panDelta:a,zoomDelta:o,bearingDelta:s,pitchDelta:c,pinchAround:l}=e,{around:u}=e;l!==void 0&&(u=l),r._stop(!0),u||=r.transform.centerPoint;let d=i.pointLocation(a?u.sub(a):u);s&&(i.bearing+=s),c&&(i.pitch+=c),o&&(i.zoom+=o),i.setLocationAtPoint(d,u),r._applyUpdatedTransform(i),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}_fireEvents(e,t,n){let r=kG(this._eventsInProgress),i=kG(e),a={};for(let t in e){let{originalEvent:n}=e[t];this._eventsInProgress[t]||(a[`${t}start`]=n),this._eventsInProgress[t]=e[t]}!r&&i&&this._fireEvent(`movestart`,i.originalEvent);for(let e in a)this._fireEvent(e,a[e]);i&&this._fireEvent(`move`,i.originalEvent);for(let t in e){let{originalEvent:n}=e[t];this._fireEvent(t,n)}let o={},s;for(let e in this._eventsInProgress){let{handlerName:n,originalEvent:r}=this._eventsInProgress[e];this._handlersById[n].isActive()||(delete this._eventsInProgress[e],s=t[n]||r,o[`${e}end`]=s)}for(let e in o)this._fireEvent(e,o[e]);let c=kG(this._eventsInProgress);if(n&&(r||i)&&!c){this._updatingCamera=!0;let e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),t=e=>e!==0&&-this._bearingSnap<e&&e<this._bearingSnap;e&&(e.essential||!VU.prefersReducedMotion)?(t(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:s})):(this._map.fire(new aU(`moveend`,{originalEvent:s})),t(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,t){this._map.fire(new aU(e,t?{originalEvent:t}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new AG(`renderFrame`,e)),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}})),NG,PG=o((()=>{ov(),NG=class{constructor(){J(this,`_queue`,void 0),J(this,`_id`,void 0),J(this,`_cleared`,void 0),J(this,`_currentlyRunning`,void 0),this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){let t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(let t of n)if(t.id===e){t.cancelled=!0;return}}run(e=0){if(this._currentlyRunning)throw Error(`Attempting to run(), but is already running.`);let t=this._currentlyRunning=this._queue;this._queue=[];for(let n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}}));function FG(e,t){var n=typeof my<`u`&&!!my&&typeof my.showToast==`function`&&my.isFRM!==!0,r=typeof wx<`u`&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0);if(!(n||r)&&(t||=document,t)){var i=t.head||t.getElementsByTagName(`head`)[0];if(!i){i=t.createElement(`head`);var a=t.body||t.getElementsByTagName(`body`)[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement(`style`);return o.type=`text/css`,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}var IG,LG,RG,zG,BG,VG,HG,UG,WG=o((()=>{cv(),ov(),IG=u(qg()),GU(),SU(),FU(),QU(),MG(),HU(),fU(),cU(),PG(),nU(),kp(),FG(`.l7-map {
  font:
    12px/20px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgb(0 0 0 / 0%);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: grab;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  touch-action: none;
}

.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures,
.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures .l7-canvas {
  touch-action: pan-x pan-y;
}

.l7-cooperative-gesture-screen {
  background: rgba(0 0 0 / 40%);
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  padding: 1rem;
  font-size: 1.4em;
  line-height: 1.2;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1s ease 1s;
  z-index: 99999;
}

.l7-cooperative-gesture-screen.l7-show {
  opacity: 1;
  transition: opacity 0.05s;
}

.l7-cooperative-gesture-screen .l7-mobile-message {
  display: none;
}

@media (hover: none), (width <= 480px) {
  .l7-cooperative-gesture-screen .l7-desktop-message {
    display: none;
  }

  .l7-cooperative-gesture-screen .l7-mobile-message {
    display: block;
  }
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right {
  position: absolute;
  pointer-events: none;
  z-index: 2;
}

.l7-ctrl-top-left {
  top: 0;
  left: 0;
}

.l7-ctrl-top-right {
  top: 0;
  right: 0;
}

.l7-ctrl-bottom-left {
  bottom: 0;
  left: 0;
}

.l7-ctrl-bottom-right {
  right: 0;
  bottom: 0;
}

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}

.l7-ctrl-top-left .l7-ctrl {
  margin: 10px 0 0 10px;
  float: left;
}

.l7-ctrl-top-right .l7-ctrl {
  margin: 10px 10px 0 0;
  float: right;
}

.l7-ctrl-bottom-left .l7-ctrl {
  margin: 0 0 10px 10px;
  float: left;
}

.l7-ctrl-bottom-right .l7-ctrl {
  margin: 0 10px 10px 0;
  float: right;
}

.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
  cursor: crosshair;
}

.l7-boxzoom {
  position: absolute;
  top: 0;
  left: 0;
  width: 0;
  height: 0;
  background: #fff;
  border: 2px dotted #202020;
  opacity: 0.5;
  z-index: 10;
}
`),LG=-2,RG=22,zG=0,BG=60,VG=85,HG={interactive:!0,bearingSnap:7,scrollZoom:!0,minZoom:LG,maxZoom:RG,minPitch:zG,maxPitch:BG,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,fadeDuration:300,clickTolerance:3,pitchWithRotate:!0},UG=class extends WU{constructor(e){let t=Y(Y({},HG),e);if(t.minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw Error(`maxZoom must be greater than or equal to minZoom`);if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw Error(`maxPitch must be greater than or equal to minPitch`);if(t.minPitch!=null&&t.minPitch<zG)throw Error(`minPitch must be greater than or equal to ${zG}`);if(t.maxPitch!=null&&t.maxPitch>VG)throw Error(`maxPitch must be less than or equal to ${VG}`);let n=new ZU(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies);if(super(n,{bearingSnap:t.bearingSnap}),J(this,`_container`,void 0),J(this,`_canvasContainer`,void 0),J(this,`_interactive`,void 0),J(this,`_frameRequest`,void 0),J(this,`_loaded`,void 0),J(this,`_idleTriggered`,!1),J(this,`_fullyLoaded`,void 0),J(this,`_trackResize`,void 0),J(this,`_resizeObserver`,void 0),J(this,`_preserveDrawingBuffer`,void 0),J(this,`_failIfMajorPerformanceCaveat`,void 0),J(this,`_fadeDuration`,void 0),J(this,`_crossSourceCollisions`,void 0),J(this,`_crossFadingFactor`,1),J(this,`_collectResourceTiming`,void 0),J(this,`_renderTaskQueue`,new NG),J(this,`_mapId`,GH()),J(this,`_removed`,void 0),J(this,`_clickTolerance`,void 0),J(this,`version`,void 0),J(this,`mapSize`,void 0),J(this,`scrollZoom`,void 0),J(this,`boxZoom`,void 0),J(this,`dragRotate`,void 0),J(this,`dragPan`,void 0),J(this,`keyboard`,void 0),J(this,`doubleClickZoom`,void 0),J(this,`touchZoomRotate`,void 0),J(this,`touchPitch`,void 0),J(this,`cooperativeGestures`,void 0),J(this,`_onMapScroll`,e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}),this._interactive=t.interactive,this._trackResize=t.trackResize===!0,this._bearingSnap=t.bearingSnap,this._fadeDuration=t.fadeDuration,this._clickTolerance=t.clickTolerance,this.version=e.version,this.mapSize=e.mapSize,typeof t.container==`string`){if(this._container=document.getElementById(t.container),!this._container)throw Error(`Container '${t.container}' not found.`)}else if(t.container instanceof HTMLElement)this._container=t.container;else throw Error(`Invalid type: 'container' must be a String or HTMLElement.`);if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this.on(`move`,()=>this._update()).on(`moveend`,()=>this._update()).on(`zoom`,()=>this._update()).once(`idle`,()=>{this._idleTriggered=!0}),typeof window<`u`){let e=!1,t=tu.throttle(e=>{this._trackResize&&!this._removed&&this.resize(e)._update()},50);this._resizeObserver=new ResizeObserver(n=>{if(!e){e=!0;return}t(n)}),this._resizeObserver.observe(this._container)}this.handlers=new jG(this,t),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,KH({},t.fitBoundsOptions,{duration:0}))),this.resize()}_getMapId(){return this._mapId}calculateCameraOptionsFromTo(e,t,n,r){return super.calculateCameraOptionsFromTo(e,t,n,r)}resize(e){var t;let n=this._containerDimensions(),r=n[0],i=n[1];this.transform.resize(r,i),(t=this._requestedCameraState)==null||t.resize(r,i);let a=!this._moving;return a&&(this.stop(),this.fire(new aU(`movestart`,e)).fire(new aU(`move`,e))),this.fire(new aU(`resize`,e)),a&&this.fire(new aU(`moveend`,e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(e&&PU.convert(e)),this._update()}setMinZoom(e){if(e??=LG,e>=LG&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw Error(`minZoom must be between ${LG} and the current maxZoom, inclusive`)}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if(e??=RG,e>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw Error(`maxZoom must be greater than the current minZoom`)}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if(e??=zG,e<zG)throw Error(`minPitch must be greater than or equal to ${zG}`);if(e>=zG&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw Error(`minPitch must be between ${zG} and the current maxPitch, inclusive`)}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if(e??=BG,e>VG)throw Error(`maxPitch must be less than or equal to ${VG}`);if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw Error(`maxPitch must be greater than the current minPitch`)}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){this.transform.renderWorldCopies=e}project(e){return this.transform.locationPoint(xU.convert(e))}unproject(e){return this.transform.pointLocation(IG.default.convert(e))}isMoving(){return this._moving||this.handlers?.isMoving()}isZooming(){return this._zooming||this.handlers?.isZooming()}isRotating(){return this._rotating||this.handlers?.isRotating()}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}off(e,t){return super.off(e,t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_setupContainer(){let e=this._container;e.classList.add(`l7-map`);let t=this._canvasContainer=dU.create(`div`,`l7-canvas-container`,e);this._interactive&&t.classList.add(`l7-interactive`),this._container.addEventListener(`scroll`,this._onMapScroll,!1)}_update(){return this.triggerRepaint(),this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(e){if(this._renderTaskQueue.run(e),!this._removed)return this.fire(new aU(`render`)),this.isMoving()||this.fire(new aU(`idle`)),this}remove(){var e;this._frameRequest&&=(this._frameRequest.abort(),null),this._renderTaskQueue.clear(),this.handlers.destroy(),delete this.handlers,(e=this._resizeObserver)==null||e.disconnect(),dU.remove(this._canvasContainer),this._container.classList.remove(`l7-map`),this._removed=!0,this.fire(new aU(`remove`))}triggerRepaint(){this._frameRequest||(this._frameRequest=new AbortController,VU.frameAsync(this._frameRequest).then(e=>{this._frameRequest=null,this._render(e)}).catch(()=>{}))}getCameraTargetElevation(){return this.transform.elevation}}})),GG=o((()=>{yU(),NU(),WG(),mU()})),KG,qG,JG,YG=o((()=>{ov(),UC(),GG(),KG=u(Mf()),qG=12,JG=class{constructor(e){J(this,`map`,void 0),J(this,`simpleMapCoord`,new pU),J(this,`bgColor`,`rgba(0.0, 0.0, 0.0, 0.0)`),J(this,`config`,void 0),J(this,`configService`,void 0),J(this,`coordinateSystemService`,void 0),J(this,`eventEmitter`,void 0),J(this,`markerContainer`,void 0),J(this,`mapContainer`,void 0),J(this,`cameraChangedCallback`,void 0),this.config=e.mapConfig,this.configService=e.globalConfigService,this.coordinateSystemService=e.coordinateSystemService,this.eventEmitter=new KG.EventEmitter}onCameraChanged(e){this.cameraChangedCallback=e}updateView(e){var t;this.emit(`mapchange`),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom}),this.updateCoordinateSystemService(),(t=this.cameraChangedCallback)==null||t.call(this,this.viewport)}updateCoordinateSystemService(){let{offsetCoordinate:e=!0}=this.config;this.viewport.getZoom()>qG&&e?this.coordinateSystemService.setCoordinateSystem(Gv.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Gv.LNGLAT)}creatMapContainer(e){let t;return t=typeof e==`string`?document.getElementById(e):e,t}getMapStyleValue(e){return this.getMapStyleConfig()[e]??e}setBgColor(e){this.bgColor=e}getMapContainer(){return this.mapContainer}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}emit(e,...t){this.eventEmitter.emit(e,...t)}once(e,t){this.eventEmitter.once(e,t)}meterToCoord(e,t){return 1}destroy(){this.eventEmitter.removeAllListeners()}}}));function XG(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}var ZG=o((()=>{}));function QG(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,iv(r.key),r)}}function $G(e,t,n){return t&&QG(e.prototype,t),n&&QG(e,n),Object.defineProperty(e,`prototype`,{writable:!1}),e}var eK=o((()=>{av()}));function tK(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}var nK=o((()=>{}));function rK(e,t){if(t&&(ev(t)==`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return tK(e)}var iK=o((()=>{tv(),nK()}));function aK(e){return aK=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},aK(e)}var oK=o((()=>{}));function sK(e,t){return sK=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sK(e,t)}var cK=o((()=>{}));function lK(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&sK(e,t)}var uK=o((()=>{cK()}));function dK(e){if(Array.isArray(e))return e}var fK=o((()=>{}));function pK(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}var mK=o((()=>{}));function hK(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var gK=o((()=>{}));function _K(e,t){if(e){if(typeof e==`string`)return hK(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?hK(e,t):void 0}}var vK=o((()=>{gK()}));function yK(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var bK=o((()=>{}));function xK(e,t){return dK(e)||pK(e,t)||_K(e,t)||yK()}var SK=o((()=>{fK(),mK(),vK(),bK()}));function CK(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wK(e,t){var n=wb([],t,e);return Cb(n,n,1/n[3]),n}var TK=o((()=>{Tb()}));function EK(e,t){if(!e)throw Error(t||`viewport-mercator-project: assertion failed.`)}var DK=o((()=>{}));function OK(e){return 2**e}function kK(e,t){var n=xK(e,2),r=n[0],i=n[1];EK(Number.isFinite(r)&&Number.isFinite(t)),EK(Number.isFinite(i)&&i>=-90&&i<=90,`invalid latitude`),t*=VK;var a=r*zK,o=i*zK;return[t*(a+LK)/(2*LK),t*(LK-Math.log(Math.tan(RK+o*.5)))/(2*LK)]}function AK(e,t){var n=xK(e,2),r=n[0],i=n[1];t*=VK;var a=r/t*(2*LK)-LK,o=2*(Math.atan(Math.exp(LK-i/t*(2*LK)))-RK);return[a*BK,o*BK]}function jK(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,a=e.highPrecision,o=a===void 0?!1:a;i=i===void 0?OK(r):i,EK(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var s={},c=VK*i,l=Math.cos(t*zK),u=c/360,d=u/l,f=c/HK/l;if(s.pixelsPerMeter=[f,-f,f],s.metersPerPixel=[1/f,-1/f,1/f],s.pixelsPerDegree=[u,-d,f],s.degreesPerPixel=[1/u,-1/d,1/f],o){var p=zK*Math.tan(t*zK)/l,m=u*p/2,h=c/HK*p,g=h/d*f;s.pixelsPerDegree2=[0,-m,h],s.pixelsPerMeter2=[g,0,g]}return s}function MK(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,a=e.center,o=a===void 0?null:a,s=e.flipY,c=s===void 0?!1:s,l=CK();return Qy(l,l,[0,0,-i]),$y(l,l,[1,1,1/t]),eb(l,l,-n*zK),nb(l,l,r*zK),c&&$y(l,l,[1,-1,1]),o&&Qy(l,l,pb([],o)),l}function NK(e){var t=e.width,n=e.height,r=e.altitude,i=r===void 0?UK:r,a=e.pitch,o=a===void 0?0:a,s=e.nearZMultiplier,c=s===void 0?1:s,l=e.farZMultiplier,u=l===void 0?1:l,d=o*zK,f=Math.atan(.5/i),p=Math.sin(f)*i/Math.sin(Math.PI/2-d-f),m=Math.cos(Math.PI/2-d)*p+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:c,far:m*u}}function PK(e){var t=e.width,n=e.height,r=e.pitch,i=e.altitude,a=e.nearZMultiplier,o=e.farZMultiplier,s=NK({width:t,height:n,altitude:i,pitch:r,nearZMultiplier:a,farZMultiplier:o}),c=s.fov,l=s.aspect,u=s.near,d=s.far;return ob([],c,l,u,d)}function FK(e,t){var n=xK(e,3),r=n[0],i=n[1],a=n[2],o=a===void 0?0:a;return EK(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(o)),wK(t,[r,i,o,1])}function IK(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=xK(e,3),i=r[0],a=r[1],o=r[2];if(EK(Number.isFinite(i)&&Number.isFinite(a),`invalid pixel coordinate`),Number.isFinite(o))return wK(t,[i,a,o,1]);var s=wK(t,[i,a,0,1]),c=wK(t,[i,a,1,1]),l=s[2],u=c[2];return Fb([],s,c,l===u?0:((n||0)-l)/(u-l))}var LK,RK,zK,BK,VK,HK,UK,WK=o((()=>{SK(),TK(),sb(),Lb(),bb(),DK(),LK=Math.PI,RK=LK/4,zK=LK/180,BK=180/LK,VK=512,HK=4003e4,UK=1.5})),GK,KK,qK=o((()=>{SK(),ZG(),eK(),TK(),WK(),sb(),GK=CK(),KK=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,a=i===void 0?GK:i,o=t.projectionMatrix,s=o===void 0?GK:o;XG(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=s;var c=CK();Zy(c,c,this.projectionMatrix),Zy(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var l=CK();$y(l,l,[this.width/2,-this.height/2,1]),Qy(l,l,[1,-1,0]),Zy(l,l,this.viewProjectionMatrix);var u=Xy(CK(),l);if(!u)throw Error(`Pixel project matrix not invertible`);this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=u,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return $G(e,[{key:`equals`,value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&ab(t.projectionMatrix,this.projectionMatrix)&&ab(t.viewMatrix,this.viewMatrix):!1}},{key:`project`,value:function(e){var t=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).topLeft,n=t===void 0?!0:t,r=FK(this.projectPosition(e),this.pixelProjectionMatrix),i=xK(r,2),a=i[0],o=i[1],s=n?o:this.height-o;return e.length===2?[a,s]:[a,s,r[2]]}},{key:`unproject`,value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.topLeft,r=n===void 0?!0:n,i=t.targetZ,a=xK(e,3),o=a[0],s=a[1],c=a[2],l=r?s:this.height-s,u=i&&i*this.pixelsPerMeter,d=IK([o,l,c],this.pixelUnprojectionMatrix,u),f=xK(this.unprojectPosition(d),3),p=f[0],m=f[1],h=f[2];return Number.isFinite(c)?[p,m,h]:Number.isFinite(i)?[p,m,i]:[p,m]}},{key:`projectPosition`,value:function(e){var t=xK(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:`unprojectPosition`,value:function(e){var t=xK(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:`projectFlat`,value:function(e){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,e}},{key:`unprojectFlat`,value:function(e){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,e}}]),e}()}));function JK(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,a=i===void 0?0:i,o=e.maxZoom,s=o===void 0?24:o,c=e.padding,l=c===void 0?0:c,u=e.offset,d=u===void 0?[0,0]:u,f=xK(r,2),p=xK(f[0],2),m=p[0],h=p[1],g=xK(f[1],2),_=g[0],v=g[1];if(Number.isFinite(l)){var y=l;l={top:y,bottom:y,left:y,right:y}}else EK(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var b=new XK({width:t,height:n,longitude:0,latitude:0,zoom:0}),x=b.project([m,v]),S=b.project([_,h]),C=[Math.max(Math.abs(S[0]-x[0]),a),Math.max(Math.abs(S[1]-x[1]),a)],w=[t-l.left-l.right-Math.abs(d[0])*2,n-l.top-l.bottom-Math.abs(d[1])*2];EK(w[0]>0&&w[1]>0);var E=w[0]/C[0],D=w[1]/C[1],O=(l.right-l.left)/2/E,k=(l.bottom-l.top)/2/D,A=[(S[0]+x[0])/2+O,(S[1]+x[1])/2+k],j=b.unproject(A),M=b.zoom+Math.log2(Math.abs(Math.min(E,D)));return{longitude:j[0],latitude:j[1],zoom:Math.min(M,s)}}var YK=o((()=>{SK(),ZK(),DK()})),XK,ZK=o((()=>{ZG(),eK(),iK(),oK(),uK(),nK(),qK(),WK(),YK(),Lb(),XK=function(e){lK(t,e);function t(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,i=n.height,a=n.latitude,o=a===void 0?0:a,s=n.longitude,c=s===void 0?0:s,l=n.zoom,u=l===void 0?0:l,d=n.pitch,f=d===void 0?0:d,p=n.bearing,m=p===void 0?0:p,h=n.altitude,g=h===void 0?1.5:h,_=n.nearZMultiplier,v=n.farZMultiplier;XG(this,t),r||=1,i||=1;var y=OK(u);g=Math.max(.75,g);var b=kK([c,o],y);b[2]=0;var x=PK({width:r,height:i,pitch:f,bearing:m,altitude:g,nearZMultiplier:_||1/i,farZMultiplier:v||1.01}),S=MK({height:i,center:b,pitch:f,bearing:m,altitude:g,flipY:!0});return e=rK(this,aK(t).call(this,{width:r,height:i,viewMatrix:S,projectionMatrix:x})),e.latitude=o,e.longitude=c,e.zoom=u,e.pitch=f,e.bearing=m,e.altitude=g,e.scale=y,e.center=b,e.pixelsPerMeter=jK(tK(tK(e))).pixelsPerMeter[2],Object.freeze(tK(tK(e))),e}return $G(t,[{key:`projectFlat`,value:function(e){return kK(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale)}},{key:`unprojectFlat`,value:function(e){return AK(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale)}},{key:`getMapCenterByLngLatPosition`,value:function(e){var t=e.lngLat,n=e.pos,r=IK(n,this.pixelUnprojectionMatrix),i=Ab([],kK(t,this.scale),Mb([],r));return AK(Ab([],this.center,i),this.scale)}},{key:`getLocationAtPoint`,value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:`fitBounds`,value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.width,i=this.height,a=JK(Object.assign({width:r,height:i,bounds:e},n)),o=a.longitude,s=a.latitude,c=a.zoom;return new t({width:r,height:i,longitude:o,latitude:s,zoom:c})}}]),t}(KK)})),QK=o((()=>{ZK()})),$K,eq=o((()=>{cv(),ov(),QK(),$K=class{constructor(){J(this,`viewport`,new XK)}syncWithMapCamera(e){let{center:t,zoom:n,pitch:r,bearing:i,viewportHeight:a,viewportWidth:o}=e;this.viewport=new XK(Y(Y({},{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}),{},{width:o,height:a,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i}))}getZoom(){return this.viewport.zoom}getZoomScale(){return 2**this.getZoom()}getCenter(){return[this.viewport.longitude,this.viewport.latitude]}getProjectionMatrix(){return this.viewport.projectionMatrix}getModelMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}getViewMatrix(){return this.viewport.viewMatrix}getViewMatrixUncentered(){return this.viewport.viewMatrixUncentered}getViewProjectionMatrix(){return this.viewport.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.viewport.viewProjectionMatrix}getFocalDistance(){return 1}projectFlat(e,t){return this.viewport.projectFlat(e,t)}}})),tq,nq=o((()=>{tq=function(e){return e.GAODE=`GAODE`,e.MAPBOX=`MAPBOX`,e.DEFAULT=`DEFAUlTMAP`,e.SIMPLE=`SIMPLE`,e.GLOBEL=`GLOBEL`,e}({})}));function rq(e={}){let t={top:0,right:0,bottom:0,left:0};if(typeof e==`number`)return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return Y(Y({},t),e)}var iq=o((()=>{cv()})),aq,oq=o((()=>{aq={normal:`amap://styles/normal`,light:`amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true`,dark:`amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true`,blank:`amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true`,fresh:`amap://styles/fresh`,grey:`amap://styles/grey`,graffiti:`amap://styles/graffiti`,macaron:`amap://styles/macaron`,darkblue:`amap://styles/darkblue`,wine:`amap://styles/wine`}}));function sq(e,t){var n=typeof my<`u`&&!!my&&typeof my.showToast==`function`&&my.isFRM!==!0,r=typeof wx<`u`&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0);if(!(n||r)&&(t||=document,t)){var i=t.head||t.getElementsByTagName(`head`)[0];if(!i){i=t.createElement(`head`);var a=t.body||t.getElementsByTagName(`body`)[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement(`style`);return o.type=`text/css`,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}function cq(e){let t=e._view.getOptions();return{center:t.center,zoom:t.zoom}}var lq,uq,dq,fq,pq,mq,hq,gq=o((()=>{cv(),Ix(),Py(),ov(),lq=u(VH()),UC(),kp(),Rb(),YG(),eq(),nq(),iq(),oq(),uq=[`id`,`style`,`minZoom`,`maxZoom`,`token`,`mapInstance`,`plugin`],sq(`.amap-logo {
  display: none !important;
}

.amap-copyright {
  display: none !important;
}

.amap-overlays {
  z-index: 3 !important;
}
`),dq=`2.0`,fq=`f59bcf249433f8b05caaee19f349b3d7`,pq=1,window.forceWebGL=!0,mq={contextmenu:`rightclick`,camerachange:`viewchange`},hq=class extends JG{constructor(...e){super(...e),J(this,`viewport`,new $K),J(this,`version`,tq.GAODE),J(this,`handleCameraChanged`,()=>{let e=this.getViewState();this.updateView(e)})}getType(){return`amap`}init(){var e=this;return Z(function*(){let t=e.config,{id:n,style:r=`light`,minZoom:i=0,maxZoom:a=24,token:o=fq,mapInstance:s,plugin:c=[]}=t,l=Fx(t,uq);if(window.AMap||s||(c.push(`Map3D`),yield lq.default.load({key:o,version:dq,plugins:c})),s)e.map=s,e.mapContainer=e.map.getContainer(),e.map.on(`viewchange`,e.handleCameraChanged);else{let t=Y({mapStyle:e.getMapStyleValue(r),zooms:[i,a],viewMode:`3D`},l);if(t.zoom&&(t.zoom+=pq),o===fq&&(window._AMapSecurityConfig={securityJsCode:`2653011adeb04230b3a26cc9a780a800`},console.warn(`%c${e.configService.getSceneWarninfo(`MapToken`)}!`,`color: #873bf4;font-weigh:900;font-size: 16px;`)),!n)throw Error(`No container id specified`);window.forceWebGL=!0,e.mapContainer=e.creatMapContainer(n);let s=new AMap.Map(e.mapContainer,t);e.map=s,s.on(`viewchange`,e.handleCameraChanged)}e.syncInitViewPort()})()}syncInitViewPort(){let e=this.getViewState();this.updateView(e)}getViewState(){let{center:e,zoom:t}=cq(this.map);return{center:e,viewportWidth:this.map.getContainer().clientWidth,viewportHeight:this.map.getContainer().clientHeight,bearing:-this.map.getRotation(),pitch:this.map.getPitch(),zoom:t-pq}}creatMapContainer(e){let t=super.creatMapContainer(e),n=document.createElement(`div`);return n.style.cssText+=`
       position: absolute;
       top: 0;
       height: 100%;
       width: 100%;
     `,n.id=tu.uniqueId(`l7_amap_div`),t.appendChild(n),n}getContainer(){return this.map.getContainer()}addMarkerContainer(){if(!this.map)return;let e=this.map.getContainer();if(e!==null){let t=e.getElementsByClassName(`amap-maps`)[0];t.style.zIndex=`auto`,this.markerContainer=cu(`div`,`l7-marker-container2`,t)}}getMarkerContainer(){return this.markerContainer}getCanvasOverlays(){return this.mapContainer?.querySelector(`.amap-overlays`)}on(e,t){cy.indexOf(e)===-1?this.map.on(mq[e]||e,t):this.eventEmitter.on(e,t)}off(e,t){cy.indexOf(e)===-1?this.map.off(mq[e]||e,t):this.eventEmitter.off(e,t)}getSize(){let e=this.map.getSize();return[e.getWidth(),e.getHeight()]}getMinZoom(){return this.map.getZooms()[0]-pq}getMaxZoom(){return this.map.getZooms()[1]-pq}getZoom(){return this.map.getZoom()-pq}getCenter(e){if(e!=null&&e.padding){let t=this.getCenter(),n=rq(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}let t=this.map.getCenter();return{lng:t.getLng(),lat:t.getLat()}}getPitch(){return this.map.getPitch()}getRotation(){return 360-this.map.getRotation()}getBounds(){let e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}getMapContainer(){return this.mapContainer}getMapCanvasContainer(){return this.map.getContainer()?.getElementsByClassName(`amap-maps`)[0]}getMapStyleConfig(){return aq}getMapStyleValue(e){return this.getMapStyleConfig()[e]||e}getMapStyle(){return this.map.getMapStyle()}setMapStyle(e){this.map.setMapStyle(this.getMapStyleValue(e))}setRotation(e){return this.map.setRotation(e)}zoomIn(){this.map.zoomIn()}zoomOut(){this.map.zoomOut()}panTo(e){this.map.panTo(e)}panBy(e=0,t=0){this.map.panBy(e,t)}fitBounds(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]),!0)}setZoomAndCenter(e,t){this.map.setZoomAndCenter(e+pq,t)}setCenter(e,t){if(t!=null&&t.padding){let n=rq(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],a=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([a.lng,a.lat])}else this.map.setCenter(e)}setPitch(e){return this.map.setPitch(e)}setZoom(e){return this.map.setZoom(e+pq)}setMaxZoom(e){throw Error(`Method not implemented.`)}setMinZoom(e){throw Error(`Method not implemented.`)}setMapStatus(e){this.map.setStatus(e)}meterToCoord(e,t){let n=AMap.GeometryUtil.distance(new AMap.LngLat(...e),new AMap.LngLat(...t)),[r,i]=wd(...e),[a,o]=wd(...t);return Math.sqrt((r-a)**2+(i-o)**2)/n}pixelToLngLat(e){let t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}lngLatToPixel(e){let t=this.map.lnglatToPixel(e);return{x:t.getX(),y:t.getY()}}containerToLngLat(e){let t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:n?.getLng(),lat:n?.getLat()}}lngLatToContainer(e){let t=this.map.lngLatToContainer(e);return{x:t.getX(),y:t.getY()}}lngLatToMercator([e,t],n){let[r,i]=wd(e,t);return{x:r,y:i,z:n}}getModelMatrix(e,t,n,r=[1,1,1]){let i=this.viewport.projectFlat(e),a=Ky();return Qy(a,a,lb(i[0],i[1],t)),$y(a,a,lb(r[0],r[1],r[2])),eb(a,a,n[0]),tb(a,a,n[1]),nb(a,a,n[2]),a}exportMap(e){let t=this.getContainer()?.getElementsByClassName(`amap-layer`)[0];if(console.log(`renderCanvas`,t),!t)throw Error(`地图尚未初始化完成，无法导出图片`);return e===`jpg`?t?.toDataURL(`image/jpeg`):t?.toDataURL(`image/png`)}destroy(){var e;super.destroy(),(e=this.mapContainer)==null||(e=e.parentNode)==null||e.removeChild(this.mapContainer),delete window.initAMap;let t=document.getElementById(`amap-script`);t&&document.head.removeChild(t),this.map.destroy()}}})),_q,vq=o((()=>{BH(),gq(),_q=class extends zH{getServiceConstructor(){return hq}}})),yq,bq=o((()=>{yq={light:`mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29`,dark:`mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7`,normal:`mapbox://styles/mapbox/streets-v11`,blank:{version:8,sources:{},layers:[{id:`background`,type:`background`,layout:{visibility:`none`}}]}}})),xq,Sq,Cq,wq,Tq=o((()=>{ov(),UC(),GG(),kp(),xq=u(Mf()),bq(),Sq={mapmove:`move`,camerachange:`move`,zoomchange:`zoom`,dragging:`drag`},Cq=12,wq=class{constructor(e){J(this,`version`,`DEFAUlTMAP`),J(this,`map`,void 0),J(this,`simpleMapCoord`,new pU),J(this,`bgColor`,`rgba(0.0, 0.0, 0.0, 0.0)`),J(this,`config`,void 0),J(this,`configService`,void 0),J(this,`coordinateSystemService`,void 0),J(this,`eventEmitter`,void 0),J(this,`evtCbProxyMap`,new globalThis.Map),J(this,`markerContainer`,void 0),J(this,`cameraChangedCallback`,void 0),J(this,`$mapContainer`,void 0),J(this,`handleCameraChanged`,e=>{let{lat:t,lng:n}=this.map.getCenter();this.emit(`mapchange`),this.viewport.syncWithMapCamera({bearing:this.map.getBearing(),center:[n,t],viewportHeight:this.map.transform.height,pitch:this.map.getPitch(),viewportWidth:this.map.transform.width,zoom:this.map.getZoom(),cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}),this.config=e.mapConfig,this.configService=e.globalConfigService,this.coordinateSystemService=e.coordinateSystemService,this.eventEmitter=new xq.EventEmitter}setBgColor(e){this.bgColor=e}addMarkerContainer(){this.markerContainer=cu(`div`,`l7-marker-container`,this.map.getCanvasContainer()),this.markerContainer.setAttribute(`tabindex`,`-1`)}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}on(e,t){if(cy.indexOf(e)!==-1){this.eventEmitter.on(e,t);return}let n=Sq[e]||e,r=this.evtCbProxyMap.get(n);if(r||(r=new globalThis.Map,this.evtCbProxyMap.set(n,r)),!r.has(t)){let e=(...e)=>{try{t(...e)}catch(e){console.error(`Error in map event handler`,e)}};r.set(t,e),this.map.on(n,e)}}off(e,t){if(cy.indexOf(e)!==-1){this.eventEmitter.off(e,t);return}let n=Sq[e]||e,r=this.evtCbProxyMap.get(n);if(r){let e=r.get(t);e&&(this.map.off(n,e),r.delete(t)),r.size===0&&this.evtCbProxyMap.delete(n)}}getContainer(){return this.map.getContainer()}getMapCanvasContainer(){return this.map.getCanvasContainer()}getSize(){if(this.version===`SIMPLE`)return this.simpleMapCoord.getSize();let e=this.map.transform;return[e.width,e.height]}getType(){return`default`}getZoom(){return this.map.getZoom()}setZoom(e){return this.map.setZoom(e)}getCenter(){return this.map.getCenter()}setCenter(e){this.map.setCenter(e)}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getBearing()}getBounds(){return this.map.getBounds().toArray()}getMinZoom(){return this.map.getMinZoom()}getMaxZoom(){return this.map.getMaxZoom()}setRotation(e){this.map.setBearing(e)}zoomIn(e,t){this.map.zoomIn(e,t)}zoomOut(e,t){this.map.zoomOut(e,t)}setPitch(e){return this.map.setPitch(e)}panTo(e){this.map.panTo(e)}panBy(e=0,t=0){this.map.panBy([e,t])}fitBounds(e,t){this.map.fitBounds(e,t)}setMaxZoom(e){this.map.setMaxZoom(e)}setMinZoom(e){this.map.setMinZoom(e)}setMapStatus(e){e.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),e.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),e.dragEnable===!1&&this.map.dragPan.disable(),e.dragEnable===!0&&this.map.dragPan.enable(),e.rotateEnable===!1&&this.map.dragRotate.disable(),e.dragEnable===!0&&this.map.dragRotate.enable(),e.keyboardEnable===!1&&this.map.keyboard.disable(),e.keyboardEnable===!0&&this.map.keyboard.enable(),e.zoomEnable===!1&&this.map.scrollZoom.disable(),e.zoomEnable===!0&&this.map.scrollZoom.enable()}setZoomAndCenter(e,t){this.map.flyTo({zoom:e,center:t})}setMapStyle(e){var t;(t=this.map)==null||t.setStyle(this.getMapStyleValue(e))}meterToCoord(e,t){return 1}pixelToLngLat(e){return this.map.unproject(e)}lngLatToPixel(e){return this.map.project(e)}containerToLngLat(e){return this.map.unproject(e)}lngLatToContainer(e){return this.map.project(e)}getMapStyle(){try{let e=this.map.getStyle().sprite??``;return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(e)?e?.replace(/\/\w+$/,``).replace(/sprites/,`styles`):e}catch{return``}}getMapStyleConfig(){return yq}getMapStyleValue(e){return this.getMapStyleConfig()[e]??e}destroy(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(e,...t){this.eventEmitter.emit(e,...t)}once(e,...t){this.eventEmitter.once(e,...t)}getMapContainer(){return this.$mapContainer}exportMap(e){let t=this.map?.getCanvas();return e===`jpg`?t?.toDataURL(`image/jpeg`):t?.toDataURL(`image/png`)}onCameraChanged(e){this.cameraChangedCallback=e}creatMapContainer(e){let t=e;return typeof e==`string`&&(t=document.getElementById(e)),t}updateView(e){this.emit(`mapchange`),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}updateCoordinateSystemService(){let{offsetCoordinate:e=!0}=this.config;this.viewport.getZoom()>Cq&&e?this.coordinateSystemService.setCoordinateSystem(Gv.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Gv.LNGLAT)}}})),Eq,Dq,Oq,kq,Aq,jq,Mq,Nq,Pq=o((()=>{if(!window)throw Error(`BMapGL JSAPI can only be used in Browser.`);Eq=function(e){return e.notload=`notload`,e.loading=`loading`,e.loaded=`loaded`,e.failed=`failed`,e}(Eq||{}),Dq={key:``,BMapGL:{version:`1.0`}},Oq={BMapGL:Eq.notload},kq=[],Aq=e=>{if(typeof e==`function`){if(Oq.BMapGL===Eq.loaded){e(window.BMapGL);return}kq.push(e)}},jq=e=>new Promise((t,n)=>{if(Oq.BMapGL===Eq.failed)n(``);else if(Oq.BMapGL===Eq.notload){let{key:r,version:i}=e;if(!r){n(`请填写key`);return}Dq.key=r,Dq.BMapGL.version=i||Dq.BMapGL.version,Oq.BMapGL=Eq.loading;let a=document.body||document.head;window.___onBMapGLAPILoaded=e=>{if(delete window.___onBMapGLAPILoaded,e)Oq.BMapGL=Eq.failed,n(e);else for(Oq.BMapGL=Eq.loaded;kq.length;)kq.splice(0,1)[0](window.BMapGL)};let o=document.createElement(`script`);o.type=`text/javascript`,o.src=`https://api.map.baidu.com/api?type=webgl&v=${Dq.BMapGL.version}&ak=${Dq.key}&callback=___onBMapGLAPILoaded`,o.onerror=e=>{Oq.BMapGL=Eq.failed,n(e)},a.appendChild(o),Aq(t)}else if(Oq.BMapGL===Eq.loaded){if(e.key&&e.key!==Dq.key){n(`多个不一致的 key`);return}if(e.version&&e.version!==Dq.BMapGL.version){n(`不允许多个版本 JSAPI 混用`);return}t(window.BMapGL)}else{if(e.key&&e.key!==Dq.key){n(`多个不一致的 key`);return}if(e.version&&e.version!==Dq.BMapGL.version){n(`不允许多个版本 JSAPI 混用`);return}Aq(t)}}),Mq=()=>{delete window.BMapGL,Dq={key:``,BMapGL:{version:`1.0`}},Oq={BMapGL:Eq.notload}},Nq={load:jq,reset:Mq}}));function Fq(e,t){var n=typeof my<`u`&&!!my&&typeof my.showToast==`function`&&my.isFRM!==!0,r=typeof wx<`u`&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0);if(!(n||r)&&(t||=document,t)){var i=t.head||t.getElementsByTagName(`head`)[0];if(!i){i=t.createElement(`head`);var a=t.body||t.getElementsByTagName(`body`)[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement(`style`);return o.type=`text/css`,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}var Iq,Lq,Rq,zq,Bq,Vq=o((()=>{cv(),Ix(),Py(),ov(),UC(),kp(),Rb(),eq(),Tq(),iq(),Pq(),Iq=[`id`,`center`,`zoom`,`token`,`mapInstance`,`version`,`mapSize`,`minZoom`,`maxZoom`],Fq(`.BMap_cpyCtrl .anchorBL {
  display: none !important;
}

.anchorBL {
  display: none !important;
}
`),Lq={mapmove:`moving`,contextmenu:`rightclick`,camerachange:`update`,zoomchange:`zoomend`},Rq=`zLhopYPPERGtpGOgimcdKcCimGRyyIsh`,zq=`1.0`,Bq=class extends wq{constructor(...e){super(...e),J(this,`viewport`,void 0),J(this,`styleConfig`,{normal:[]}),J(this,`currentStyle`,`normal`),J(this,`evtCbProxyMap`,new Map),J(this,`handleCameraChanged`,()=>{this.emit(`mapchange`);let e=this.getMap(),{lng:t,lat:n}=e.getCenter(),r={center:[t,n],viewportHeight:e.getContainer().clientHeight,viewportWidth:e.getContainer().clientWidth,bearing:360-e.getHeading(),pitch:e.getTilt(),zoom:e.getZoom()-1.75};this.viewport.syncWithMapCamera(r),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)})}getMap(){return this.map}setBgColor(e){this.bgColor=e}init(){var e=this;return Z(function*(){e.viewport=new $K;let t=e.config,{id:n,center:r=[121.30654632240122,31.25744185633306],zoom:i=12,token:a=Rq,mapInstance:o,version:s=zq,mapSize:c=1e4,minZoom:l=0,maxZoom:u=21}=t,d=Fx(t,Iq);if(e.viewport=new $K,e.version=s,e.simpleMapCoord.setSize(c),window.BMapGL||o||(yield Nq.load({key:a,version:zq})),o){e.map=o,e.$mapContainer=e.map.getContainer();let t=new BMapGL.Point(r[0],r[1]);e.map.isLoaded()||e.map.centerAndZoom(t,i),e.initMapByConfig(e.config),e.map.on(`update`,e.handleCameraChanged)}else{let t=Y({enableWheelZoom:!0,minZoom:l,maxZoom:u},d);if(a===Rq&&console.warn(`%c${e.configService.getSceneWarninfo(`MapToken`)}!`,`color: #873bf4;font-weigh:900;font-size: 16px;`),!n)throw Error(`No container id specified`);let o=iu(n),s=[...o.childNodes],c=new BMapGL.Map(o,t);e.$mapContainer=c.getContainer(),s.forEach(t=>{e.$mapContainer.appendChild(t)}),s=null,e.map=c;let f=new BMapGL.Point(r[0],r[1]);e.map.centerAndZoom(f,i),e.initMapByConfig(e.config),c.on(`update`,e.handleCameraChanged)}})()}destroy(){this.getMap().destroy()}onCameraChanged(e){this.cameraChangedCallback=e}addMarkerContainer(){}getMarkerContainer(){return this.map.getPanes().markerPane}getCanvasOverlays(){return this.getMap().getContainer().querySelector(`#platform`)?.lastChild}on(e,t){if(cy.indexOf(e)!==-1){this.eventEmitter.on(e,t);return}let n=this.evtCbProxyMap.get(e);if(n||this.evtCbProxyMap.set(e,n=new Map),n.get(t))return;let r=(...e)=>{e[0]&&typeof e[0]==`object`&&!e[0].lngLat&&!e[0].lnglat&&(e[0].lngLat=e[0].latlng||e[0].latLng),t(...e)};n.set(t,r),this.map.on(Lq[e]||e,r)}off(e,t){var n;if(cy.indexOf(e)!==-1){this.eventEmitter.off(e,t);return}let r=this.evtCbProxyMap.get(e)?.get(t);r&&((n=this.evtCbProxyMap.get(e))==null||n.delete(t),this.map.off(Lq[e]||e,r))}once(e,t){this.eventEmitter.once(e,t)}getContainer(){return this.getMap().getContainer()}getSize(){let e=this.getMap().getSize();return[e.width,e.height]}getMinZoom(){return this.map.getMinZoom()}getMaxZoom(){return this.map.getMaxZoom()}getType(){return`bmap`}getZoom(){return this.getMap().getZoom()}getCenter(e){if(e!=null&&e.padding){let t=this.getCenter(),n=rq(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}let t=this.map.getCenter();return{lng:t.lng,lat:t.lat}}getPitch(){return this.getMap().getTilt()}getRotation(){return 360-this.getMap().getHeading()}getBounds(){let e=this.getMap().getBounds(),t=e.getNorthEast(),n=e.getSouthWest();return[[n.lng,n.lat],[t.lng,t.lat]]}getMapContainer(){return this.getMap().getContainer()}getMapCanvasContainer(){return this.getMap().getContainer()}getMapStyleConfig(){return this.styleConfig}getMapStyleValue(e){return this.styleConfig[e]}setMapStyle(e){if(this.currentStyle===e)return;let t=Array.isArray(e)?e:this.styleConfig[e]||e;if(Array.isArray(t)){this.map.setMapStyleV2({styleJson:t}),this.currentStyle=e;return}if(typeof t==`string`){this.map.setMapStyleV2({styleId:t}),this.currentStyle=e;return}}setRotation(e){this.getMap().setHeading(e)}zoomIn(){this.getMap().zoomIn()}zoomOut(){this.getMap().zoomOut()}panTo(e){this.getMap().panTo(new BMapGL.Point(e[0],e[1]))}panBy(e,t){this.getMap().panBy(e,t)}fitBounds(e,t){this.map.setViewport(e.map(e=>new BMapGL.Point(e[0],e[1])),t)}setZoomAndCenter(e,[t,n]){this.getMap().centerAndZoom(new BMapGL.Point(t,n),e+1.75)}setCenter([e,t],n){let r={lng:e,lat:t};if(n!=null&&n.padding){let i=rq(n.padding),a=this.lngLatToPixel([e,t]),o=[(i.right-i.left)/2,(i.bottom-i.top)/2];r=this.pixelToLngLat([a.x+o[0],a.y+o[1]])}this.getMap().setCenter(new BMapGL.Point(r.lng,r.lat))}setPitch(e){this.getMap().setTilt(e)}setZoom(e){this.getMap().setZoom(e)}setMapStatus(e){let t=this.getMap();Object.keys(e).forEach(n=>{switch(n){case`doubleClickZoom`:e.doubleClickZoom?t.enableDoubleClickZoom():t.disableDoubleClickZoom();break;case`dragEnable`:e.dragEnable?t.enableDragging():t.disableDragging();break;case`keyboardEnable`:e.keyboardEnable?t.enableKeyboard():t.disableKeyboard();break;case`resizeEnable`:e.resizeEnable?t.enableAutoResize():t.disableAutoResize();break;case`rotateEnable`:e.rotateEnable?(t.enableRotate(),t.enableRotateGestures()):(t.disableRotate(),t.disableRotateGestures());break;case`zoomEnable`:e.zoomEnable?(this.map.enableDoubleClickZoom(),this.map.enableScrollWheelZoom(),this.map.enablePinchToZoom()):(this.map.disableDoubleClickZoom(),this.map.disableScrollWheelZoom(),this.map.disablePinchToZoom());break;case`showIndoorMap`:t.setDisplayOptions({indoor:!!e.showIndoorMap});break;default:}})}meterToCoord(e,t){let n=this.getMap().getDistance(new BMapGL.Point(...e),new BMapGL.Point(...t)),[r,i]=this.lngLatToCoord(e),[a,o]=this.lngLatToCoord(t);return Math.sqrt((r-a)**2+(i-o)**2)/n}pixelToLngLat([e,t]){let n=this.getMap().pixelToPoint(new BMapGL.Pixel(e,t));return{lng:n.lng,lat:n.lat}}lngLatToPixel([e,t]){let n=this.getMap().pointToPixel(new BMapGL.Point(e,t));return{x:n.x,y:n.y}}containerToLngLat([e,t]){let n=this.getMap().overlayPixelToPoint(new BMapGL.Pixel(e,t));return{lng:n.lng,lat:n.lat}}lngLatToContainer([e,t]){let n=this.getMap().pointToOverlayPixel(new BMapGL.Point(e,t));return{x:n.x,y:n.y}}lngLatToCoord([e,t]){let{x:n,y:r}=this.getMap().pointToPixel(new BMapGL.Point(e,t));return[n,-r]}lngLatToCoords(e){return e.map(e=>Array.isArray(e[0])?this.lngLatToCoords(e):this.lngLatToCoord(e))}lngLatToMercator([e,t],n){let[r,i]=this.getMap().lnglatToMercator(e,t);return{x:r,y:i,z:n}}getModelMatrix(e,t,n,r=[1,1,1]){let i=this.viewport.projectFlat(e),a=Ky();return Qy(a,a,lb(i[0],i[1],t)),$y(a,a,lb(r[0],r[1],r[2])),eb(a,a,n[0]),tb(a,a,n[1]),nb(a,a,n[2]),a}getCustomCoordCenter(){throw Error(`Method not implemented.`)}exportMap(e){let t=this.getMap()._webglPainter._canvas;return e===`jpg`?t?.toDataURL(`image/jpeg`):t?.toDataURL(`image/png`)}hideLogo(){let e=this.map.getContainer();e&&uu(e,`bmap-contianer--hide-logo`)}initMapByConfig(e){let{style:t,pitch:n=0,rotation:r=0,logoVisible:i=!0}=e;t&&this.setMapStyle(t),n&&this.setPitch(n),r&&this.setRotation(r),i===!1&&this.hideLogo()}}})),Hq,Uq=o((()=>{BH(),Vq(),Hq=class extends zH{getServiceConstructor(){return Bq}}})),Wq,Gq=o((()=>{ov(),Rb(),Wq=class{constructor(){J(this,`xzReg`,-Math.PI*.6),J(this,`yReg`,Math.PI*.2),J(this,`earthCameraRadius`,200),J(this,`earthCameraZoom`,1),J(this,`cameraPosition`,cb()),J(this,`viewport`,void 0),J(this,`projectionMatrix`,Ky()),J(this,`modelMatrix`,Ky()),J(this,`viewMatrix`,Ky()),J(this,`viewProjectionMatrix`,Ky()),J(this,`ViewProjectionMatrixUncentered`,Ky()),J(this,`viewUncenteredMatrix`,Ky())}syncWithMapCamera(e){let{viewportHeight:t=1,viewportWidth:n=1}=e,r=n/t;ob(this.projectionMatrix,20,r,.1,1e4);let i=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg);this.cameraPosition=lb(i,this.earthCameraRadius*Math.sin(this.yReg),a),mb(this.cameraPosition,this.cameraPosition),db(this.cameraPosition,this.cameraPosition,lb(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),fb(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);let o=cb();gb(o,this.cameraPosition,lb(0,1,0));let s=lb(0,1,0);gb(s,o,this.cameraPosition);let c=lb(0,0,0);ib(this.viewMatrix,this.cameraPosition,c,s),this.viewUncenteredMatrix=qy(this.viewMatrix),Zy(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),Zy(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}rotateY(e){this.xzReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}rotateX(e){this.yReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}scaleZoom(e){this.earthCameraZoom+=e,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}getZoom(){return 4}getZoomScale(){return 2**this.getZoom()}getCenter(){return[0,0]}getProjectionMatrix(){return this.projectionMatrix}getModelMatrix(){return this.modelMatrix}getViewMatrix(){return this.viewMatrix}getViewMatrixUncentered(){return this.viewMatrix}getViewProjectionMatrix(){return this.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.viewProjectionMatrix}getFocalDistance(){return 1}projectFlat(e,t){return this.viewport.projectFlat(e,t)}}})),Kq,qq,Jq,Yq,Xq=o((()=>{cv(),Ix(),Py(),ov(),UC(),GG(),Tq(),Gq(),Kq=[`id`,`style`,`rotation`],qq={mapmove:`move`,camerachange:`move`,zoomchange:`zoom`,dragging:`drag`},Jq=12,Yq=class extends wq{constructor(...e){super(...e),J(this,`version`,`GLOBEL`),J(this,`dragging`,!1),J(this,`viewport`,void 0),J(this,`handleCameraChanging`,void 0),J(this,`handleCameraTimer`,void 0),J(this,`handleCameraChanged`,e=>{this.emit(`mapchange`),this.handleCameraChanging=!0,this.handleCameraTimer&&clearTimeout(this.handleCameraTimer),this.handleCameraTimer=setTimeout(()=>{this.handleCameraChanging=!1},2e3);let t=.02;e.type&&e.originalEvent&&(e.originalEvent.type===`wheel`&&this.viewport.scaleZoom(.01*Math.sign(e.originalEvent.wheelDelta)*-1),Math.abs(e.originalEvent.movementX)>Math.abs(e.originalEvent.movementY)?e.originalEvent.movementX>0?this.viewport.rotateY(t):e.originalEvent.movementX<0&&this.viewport.rotateY(-t):e.originalEvent.movementY>0?this.viewport.rotateX(t):e.originalEvent.movementY<0&&this.viewport.rotateX(-t));let{offsetCoordinate:n=!0}=this.config;this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.viewport.getZoom()>Jq&&n?this.coordinateSystemService.setCoordinateSystem(Gv.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Gv.LNGLAT),this.cameraChangedCallback(this.viewport)})}lngLatToMercator(e,t){throw Error(`Method not implemented.`)}getModelMatrix(e,t,n,r,i){throw Error(`Method not implemented.`)}on(e,t){cy.indexOf(e)===-1?this.map.on(qq[e]||e,t):this.eventEmitter.on(e,t)}off(e,t){this.map.off(qq[e]||e,t),this.eventEmitter.off(e,t)}getMapCanvasContainer(){return this.map.getCanvasContainer()}getSize(){let e=this.map.transform;return[e.width,e.height]}getType(){return`earth`}init(){var e=this;return Z(function*(){let t=e.config,{id:n=`map`,style:r=`light`,rotation:i=0}=t,a=Fx(t,Kq);e.viewport=new Wq,e.$mapContainer=e.creatMapContainer(n),e.map=new UG(Y({container:e.$mapContainer,bearing:i},a)),e.map.on(`load`,e.handleCameraChanged),e.map.on(`move`,e.handleCameraChanged),e.handleCameraChanged({})})()}destroy(){var e;(e=this.$mapContainer)==null||(e=e.parentNode)==null||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(e,...t){this.eventEmitter.emit(e,...t)}once(e,...t){this.eventEmitter.once(e,...t)}getMapContainer(){return this.$mapContainer}getCanvasOverlays(){}onCameraChanged(e){this.cameraChangedCallback=e}rotateY(e){let{force:t=!1,reg:n=.01}=e||{};this.handleCameraChanging&&!t||this.viewport&&(this.viewport.rotateY(n),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}})),Zq,Qq=o((()=>{BH(),Xq(),Zq=class extends zH{getServiceConstructor(){return Yq}}})),$q,eJ,tJ,nJ,rJ,iJ,aJ,oJ,sJ=o((()=>{if(!window)throw Error(`Google Map JSAPI can only be used in Browser.`);$q=function(e){return e.notload=`notload`,e.loading=`loading`,e.loaded=`loaded`,e.failed=`failed`,e}($q||{}),eJ={key:``},tJ={GMap:$q.notload},nJ=[],rJ=e=>{if(typeof e==`function`){if(tJ.GMap===$q.loaded){e(window.google.maps.Map);return}nJ.push(e)}},iJ=e=>new Promise((t,n)=>{if(tJ.GMap===$q.failed)n(``);else if(tJ.GMap===$q.notload){let{key:r}=e;if(!r){n(`请填写key`);return}eJ.key=r,tJ.GMap=$q.loading,window.initMap=e=>{if(delete window.initMap,e)tJ.GMap=$q.failed,n(e);else for(tJ.GMap=$q.loaded;nJ.length;)nJ.splice(0,1)[0](window.google.maps.Map)};let i=document.createElement(`script`);i.type=`text/javascript`,i.async=!1,i.src=`https://maps.googleapis.com/maps/api/js?key=${eJ.key}&callback=initMap`,i.onerror=e=>{tJ.GMap=$q.failed,n(e)},(document.body||document.head).appendChild(i),rJ(t)}else if(tJ.GMap===$q.loaded){if(e.key&&e.key!==eJ.key){n(`多个不一致的 key`);return}rJ(t)}}),aJ=()=>{delete window.google,tJ={GMap:$q.notload}},oJ={load:iJ,reset:aJ}}));function cJ(e,t){var n=typeof my<`u`&&!!my&&typeof my.showToast==`function`&&my.isFRM!==!0,r=typeof wx<`u`&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0);if(!(n||r)&&(t||=document,t)){var i=t.head||t.getElementsByTagName(`head`)[0];if(!i){i=t.createElement(`head`);var a=t.body||t.getElementsByTagName(`body`)[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement(`style`);return o.type=`text/css`,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}var lJ,uJ,dJ,fJ,pJ=o((()=>{cv(),Ix(),Py(),ov(),UC(),GG(),kp(),Rb(),eq(),Tq(),sJ(),lJ=[`id`,`mapInstance`,`center`,`token`,`minZoom`,`maxZoom`,`logoVisible`],cJ(`img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],
.logo-text {
  display: none !important;
}
`),uJ=`AIzaSyDBDCfl4pvuDtaazdCog3LmhA7CQLhmcRE`,dJ={mapmove:`center_changed`,camerachange:[`drag`,`pan`,`rotate`,`tilt`,`zoom_changed`],zoomchange:`zoom_changed`,dragging:`drag`},fJ=class extends wq{constructor(...e){super(...e),J(this,`viewport`,null),J(this,`evtCbProxyMap`,new Map),J(this,`handleCameraChanged`,()=>{this.emit(`mapchange`);let e=this.map,{lng:t,lat:n}=e.getCenter(),r={center:[t(),n()],viewportHeight:e.getDiv().clientHeight,viewportWidth:e.getDiv().clientWidth,bearing:e.getHeading(),pitch:e.getTilt(),zoom:e.getZoom()-1};this.viewport.syncWithMapCamera(r),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)})}init(){var e=this;return Z(function*(){var t;e.viewport=new $K;let n=e.config,{id:r,mapInstance:i,center:a=[121.30654632240122,31.25744185633306],token:o=uJ,minZoom:s=3,maxZoom:c=18,logoVisible:l=!0}=n,u=Fx(n,lJ);if((t=window.google)!=null&&(t=t.maps)!=null&&t.Map||i||(yield oJ.load({key:o})),i)e.map=i,e.$mapContainer=e.map.getDiv(),l===!1&&e.hideLogo();else{if(!r)throw Error(`No container id specified`);let t=iu(r),n=new google.maps.Map(t,Y({maxZoom:c,minZoom:s,zoomControl:!1,fullscreenControl:!1,center:new google.maps.LatLng(a[1],a[0])},u));e.map=n,e.$mapContainer=n.getDiv(),l===!1&&e.hideLogo()}google.maps.event.addListener(e.map,`drag`,e.handleCameraChanged),google.maps.event.addListener(e.map,`pan`,e.handleCameraChanged),google.maps.event.addListener(e.map,`rotate`,e.handleCameraChanged),google.maps.event.addListener(e.map,`idle`,e.handleCameraChanged),google.maps.event.addListener(e.map,`zoom_changed`,e.handleCameraChanged),e.handleCameraChanged()})()}destroy(){this.map.setMap(null)}onCameraChanged(e){this.cameraChangedCallback=e}addMarkerContainer(){}getMarkerContainer(){return this.markerContainer}getCanvasOverlays(){return this.map.getDiv()}on(e,t){if(cy.indexOf(e)!==-1)this.eventEmitter.on(e,t);else{let n=e=>{let n=this.evtCbProxyMap.get(e);if(n||this.evtCbProxyMap.set(e,n=new Map),n.get(t))return;let r=(...e)=>{e[0]&&typeof e[0]==`object`&&!e[0].lngLat&&!e[0].lnglat&&(e[0].lngLat=e[0].latlng||e[0].latLng),t(...e)};n.set(t,r),this.map.on(e,r)};Array.isArray(dJ[e])?dJ[e].forEach(t=>{n(t||e)}):n(dJ[e]||e)}}off(e,t){if(cy.indexOf(e)!==-1){this.eventEmitter.off(e,t);return}let n=n=>{var r;let i=this.evtCbProxyMap.get(e)?.get(t);i&&((r=this.evtCbProxyMap.get(n))==null||r.delete(t),this.map.off(n,i))};Array.isArray(dJ[e])?dJ[e].forEach(t=>{n(t||e)}):n(dJ[e]||e)}once(){throw Error(`Method not implemented.`)}getContainer(){return this.map.getDiv()}getSize(){return[this.map.width,this.map.height]}getMinZoom(){return this.map.transform._minZoom}getMaxZoom(){return this.map.transform._maxZoom}getType(){return`googlemap`}getZoom(){return this.map.getZoom()}getCenter(){let{lng:e,lat:t}=this.map.getCenter();return{lng:e(),lat:t()}}getPitch(){return this.map.getTilt()}getRotation(){return this.map.getHeading()}getBounds(){let e=this.map.getBounds(),t=e?.getNorthEast(),n=e?.getSouthWest();return[[n.lng(),n.lat()],[t.lng(),t.lat()]]}getMapContainer(){return this.map.getDiv()}getMapCanvasContainer(){return this.map.getDiv()?.getElementsByTagName(`canvas`)[0]}getMapStyleConfig(){throw Error(`Method not implemented.`)}setBgColor(e){this.bgColor=e}setMapStyle(e){this.map.setMapStyleId(e)}setRotation(e){this.map.setHeading(e)}zoomIn(){let e=this.map.getZoom();this.map.setZoom(e+1)}zoomOut(){let e=this.map.getZoom();this.map.setZoom(e-1)}panTo([e,t]){this.map.panTo({lat:t,lng:e})}panBy(e,t){this.map.panBy(e,t)}fitBounds(e,t){let[n,r]=e,i=new google.maps.LatLngBounds({lat:n[1],lng:n[0]},{lat:r[1],lng:r[0]});this.map.fitBounds(i,t)}setZoomAndCenter(e,[t,n]){this.map.setZoom(e),this.map.setCenter({lat:n,lng:t})}setCenter([e,t]){this.map.setCenter({lat:t,lng:e})}setPitch(e){this.map.setTilt(e)}setZoom(e){this.map.setZoom(e)}setMapStatus(e){Object.keys(e).map(t=>{switch(t){case`doubleClickZoom`:this.map.setOptions({gestureHandling:e.doubleClickZoom?`auto`:`none`});break;case`dragEnable`:this.map.setOptions({draggable:e.dragEnable});break;case`rotateEnable`:break;case`zoomEnable`:this.map.setOptions({zoomControl:e.zoomEnable});break;case`keyboardEnable`:case`resizeEnable`:case`showIndoorMap`:throw Error(`Options may not be supported`);default:}})}meterToCoord([e,t],[n,r]){let i=google.maps.geometry.spherical.computeDistanceBetween([new google.maps.LatLng(t,e),new google.maps.LatLng(r,n)]),[a,o]=this.lngLatToCoord([e,t]),[s,c]=this.lngLatToCoord([n,r]);return Math.sqrt((a-s)**2+(o-c)**2)/i}pixelToLngLat([e,t]){let{lng:n,lat:r}=this.map.getCenter(),{x:i,y:a}=this.lngLatToPixel([n(),r()]),{x:o,y:s}=this.lngLatToContainer([n(),r()]),{lng:c,lat:l}=this.map.unprojectFromContainer(new google.maps.Point(o+(e-i),s+(t-a)));return this.containerToLngLat([c,l])}lngLatToPixel([e,t]){let n=new google.maps.LatLng(t,e),r=this.map.getProjection().fromLatLngToPoint(n);return{x:r.x,y:r.y}}containerToLngLat([e,t]){let n=new google.maps.Point(e,t),r=this.map.getProjection()?.fromPointToLatLng(n);return{lng:r.lng(),lat:r.lat()}}lngLatToContainer([e,t]){var n,r;let i=new google.maps.LatLng(t,e),a=(n=this.map.getProjection())==null||(r=n.fromLatLngToContainerPixel)==null?void 0:r.call(n,i);return{x:a.x,y:a.y}}lngLatToCoord([e,t]){let{x:n,y:r}=this.lngLatToPixel([e,t]);return[n,-r]}lngLatToCoords(e){return e.map(e=>Array.isArray(e[0])?this.lngLatToCoords(e):this.lngLatToCoord(e))}lngLatToMercator(e,t){let{x:n=0,y:r=0,z:i=0}=MU.fromLngLat(e,t);return{x:n,y:r,z:i}}getModelMatrix(e,t,n,r=[1,1,1]){let i=this.viewport.projectFlat(e),a=Ky();return Qy(a,a,lb(i[0],i[1],t)),$y(a,a,lb(r[0],r[1],r[2])),eb(a,a,n[0]),tb(a,a,n[1]),nb(a,a,n[2]),a}getCustomCoordCenter(){throw Error(`Method not implemented.`)}exportMap(e){let t=this.getMapCanvasContainer();return e===`jpg`?t?.toDataURL(`image/jpeg`):t?.toDataURL(`image/png`)}rotateY(){throw Error(`Method not implemented.`)}hideLogo(){let e=this.map.getDiv();e&&uu(e,`tmap-contianer--hide-logo`)}}})),mJ,hJ=o((()=>{BH(),pJ(),mJ=class extends zH{getServiceConstructor(){return fJ}}})),gJ,_J,vJ=o((()=>{cv(),Ix(),Py(),ov(),GG(),Rb(),eq(),nq(),Tq(),gJ=[`id`,`style`,`rotation`,`mapInstance`,`version`,`mapSize`,`interactive`],_J=class extends wq{constructor(...e){super(...e),J(this,`version`,tq.DEFAULT),J(this,`viewport`,void 0)}lngLatToCoord(e,t={x:0,y:0,z:0}){let{x:n,y:r}=this.lngLatToMercator(e,0);return[n-t.x,r-t.y]}lngLatToMercator(e,t){let{x:n=0,y:r=0,z:i=0}=MU.fromLngLat(e,t);return{x:n,y:r,z:i}}getModelMatrix(e,t,n,r=[1,1,1],i={x:0,y:0,z:0}){let a=MU.fromLngLat(e,t),o=a.meterInMercatorCoordinateUnits(),s=Ky();return Qy(s,s,lb(a.x-i.x,a.y-i.y,a.z||0-i.z)),$y(s,s,lb(o*r[0],-o*r[1],o*r[2])),eb(s,s,n[0]),tb(s,s,n[1]),nb(s,s,n[2]),s}init(){var e=this;return Z(function*(){let t=e.config,{id:n=`map`,style:r=`light`,rotation:i=0,mapInstance:a,version:o=`DEFAULTMAP`,mapSize:s=1e4,interactive:c=!0}=t,l=Fx(t,gJ);e.viewport=new $K,e.version=o,e.simpleMapCoord.setSize(s),o===`SIMPLE`&&l.center&&(l.center=e.simpleMapCoord.unproject(l.center)),a?(e.map=a,e.$mapContainer=e.map.getContainer()):(e.$mapContainer=e.creatMapContainer(n),e.map=new UG(Y({container:e.$mapContainer,bearing:i,version:o,mapSize:s},l))),e.map.on(`load`,()=>{e.handleCameraChanged()}),c&&e.map.on(`move`,e.handleCameraChanged),setTimeout(()=>{e.handleCameraChanged()},100),e.handleCameraChanged()})()}creatMapContainer(e){let t=e;typeof e==`string`&&(t=document.getElementById(e));let n=document.createElement(`div`);return n.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,t.appendChild(n),n}exportMap(e){return``}setMapStyle(e){}getCanvasOverlays(){return this.getContainer()}}})),yJ,bJ=o((()=>{BH(),vJ(),yJ=class extends zH{getServiceConstructor(){return _J}}})),xJ=s(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n||=self,n.mapboxgl=r())})(e,(function(){var e,t,n;function r(r,i){if(!e)e=i;else if(!t)t=i;else{var a=`var sharedChunk = {}; (`+e+`)(sharedChunk); (`+t+`)(sharedChunk);`,o={};e(o),n=i(o),typeof window<`u`&&(n.workerUrl=window.URL.createObjectURL(new Blob([a],{type:`text/javascript`})))}}return r([`exports`],(function(e){function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=r;function r(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}r.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},r.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},r.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},r.prototype.solveCurveX=function(e,t){var n,r,i,a,o;for(t===void 0&&(t=1e-6),i=e,o=0;o<8;o++){if(a=this.sampleCurveX(i)-e,Math.abs(a)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=a/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(a=this.sampleCurveX(i),Math.abs(a-e)<t)return i;e>a?n=i:r=i,i=.5*(r-n)+n}return i},r.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var i=a;function a(e,t){this.x=e,this.y=t}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=r,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-r*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(e){return e instanceof a?e:Array.isArray(e)?new a(e[0],e[1]):e};var o=typeof self<`u`?self:{},s=2**53-1;function c(e,t,r,i){var a=new n(e,t,r,i);return function(e){return a.solve(e)}}var l=c(.25,.1,.25,1);function u(e,t,n){return Math.min(n,Math.max(t,e))}function d(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function f(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var r=0,i=t;r<i.length;r+=1){var a=i[r];for(var o in a)e[o]=a[o]}return e}var p=1;function m(){return p++}function h(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function g(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function _(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}function v(e,t){return e.indexOf(t,e.length-t.length)!==-1}function y(e,t,n){var r={};for(var i in e)r[i]=t.call(n||this,e[i],i,e);return r}function b(e,t,n){var r={};for(var i in e)t.call(n||this,e[i],i,e)&&(r[i]=e[i]);return r}function x(e){return Array.isArray(e)?e.map(x):typeof e==`object`&&e?y(e,x):e}var S={};function C(e){S[e]||(typeof console<`u`&&console.warn(e),S[e]=!0)}function w(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function E(e){for(var t=0,n=0,r=e.length,i=r-1,a=void 0,o=void 0;n<r;i=n++)t+=((o=e[i]).x-(a=e[n]).x)*(a.y+o.y);return t}function D(){return typeof WorkerGlobalScope<`u`&&typeof self<`u`&&self instanceof WorkerGlobalScope}function O(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(e,n,r,i){var a=r||i;return t[n]=!a||a.toLowerCase(),``})),t[`max-age`]){var n=parseInt(t[`max-age`],10);isNaN(n)?delete t[`max-age`]:t[`max-age`]=n}return t}var k=null;function A(e){if(k==null){var t=e.navigator?e.navigator.userAgent:null;k=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match(`Safari`)&&!t.match(`Chrome`)))}return k}function j(e){try{var t=o[e];return t.setItem(`_mapbox_test_`,1),t.removeItem(`_mapbox_test_`),!0}catch{return!1}}var M,N,P,F,I=o.performance&&o.performance.now?o.performance.now.bind(o.performance):Date.now.bind(Date),ee=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,R=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.msCancelAnimationFrame,z={now:I,frame:function(e){var t=ee(e);return{cancel:function(){return R(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var n=o.document.createElement(`canvas`),r=n.getContext(`2d`);if(!r)throw Error(`failed to create canvas 2d context`);return n.width=e.width,n.height=e.height,r.drawImage(e,0,0,e.width,e.height),r.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return M||=o.document.createElement(`a`),M.href=e,M.href},hardwareConcurrency:o.navigator&&o.navigator.hardwareConcurrency||4,get devicePixelRatio(){return o.devicePixelRatio},get prefersReducedMotion(){return!!o.matchMedia&&(N??=o.matchMedia(`(prefers-reduced-motion: reduce)`),N.matches)}},B={API_URL:`https://api.mapbox.com`,get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf(`https://api.mapbox.cn`)===0?`https://events.mapbox.cn/events/v2`:this.API_URL.indexOf(`https://api.mapbox.com`)===0?`https://events.mapbox.com/events/v2`:null:null},FEEDBACK_URL:`https://apps.mapbox.com/feedback`,REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},te={supported:!1,testSupport:function(e){!ne&&F&&(re?V(e):P=e)}},ne=!1,re=!1;function V(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,F),e.isContextLost())return;te.supported=!0}catch{}e.deleteTexture(t),ne=!0}o.document&&((F=o.document.createElement(`img`)).onload=function(){P&&V(P),P=null,re=!0},F.onerror=function(){ne=!0,P=null},F.src=`data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=`);var ie=`01`,ae=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function oe(e){return e.indexOf(`mapbox:`)===0}ae.prototype._createSkuToken=function(){var e=function(){for(var e=``,t=0;t<10;t++)e+=`0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ`[Math.floor(62*Math.random())];return{token:[`1`,ie,e].join(``),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},ae.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ae.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},ae.prototype.normalizeStyleURL=function(e,t){if(!oe(e))return e;var n=le(e);return n.path=`/styles/v1`+n.path,this._makeAPIURL(n,this._customAccessToken||t)},ae.prototype.normalizeGlyphsURL=function(e,t){if(!oe(e))return e;var n=le(e);return n.path=`/fonts/v1`+n.path,this._makeAPIURL(n,this._customAccessToken||t)},ae.prototype.normalizeSourceURL=function(e,t){if(!oe(e))return e;var n=le(e);return n.path=`/v4/`+n.authority+`.json`,n.params.push(`secure`),this._makeAPIURL(n,this._customAccessToken||t)},ae.prototype.normalizeSpriteURL=function(e,t,n,r){var i=le(e);return oe(e)?(i.path=`/styles/v1`+i.path+`/sprite`+t+n,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=``+t+n,ue(i))},ae.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!oe(e))return e;var n=le(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(z.devicePixelRatio>=2||t===512?`@2x`:``)+(te.supported?`.webp`:`$1`)),n.path=n.path.replace(/^.+\/v4\//,`/`),n.path=`/v4`+n.path;var r=this._customAccessToken||function(e){for(var t=0,n=e;t<n.length;t+=1){var r=n[t].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(n.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push(`sku=`+this._skuToken),this._makeAPIURL(n,r)},ae.prototype.canonicalizeTileURL=function(e,t){var n=le(e);if(!n.path.match(/(^\/v4\/)/)||!n.path.match(/\.[\w]+$/))return e;var r=`mapbox://tiles/`;r+=n.path.replace(`/v4/`,``);var i=n.params;return t&&(i=i.filter((function(e){return!e.match(/^access_token=/)}))),i.length&&(r+=`?`+i.join(`&`)),r},ae.prototype.canonicalizeTileset=function(e,t){for(var n=!!t&&oe(t),r=[],i=0,a=e.tiles||[];i<a.length;i+=1){var o=a[i];ce(o)?r.push(this.canonicalizeTileURL(o,n)):r.push(o)}return r},ae.prototype._makeAPIURL=function(e,t){var n=`See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes`,r=le(B.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,e.protocol===`http`){var i=e.params.indexOf(`secure`);i>=0&&e.params.splice(i,1)}if(r.path!==`/`&&(e.path=``+r.path+e.path),!B.REQUIRE_ACCESS_TOKEN)return ue(e);if(!(t||=B.ACCESS_TOKEN))throw Error(`An API access token is required to use Mapbox GL. `+n);if(t[0]===`s`)throw Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). `+n);return e.params=e.params.filter((function(e){return e.indexOf(`access_token`)===-1})),e.params.push(`access_token=`+t),ue(e)};var se=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ce(e){return se.test(e)}var H=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function le(e){var t=e.match(H);if(!t)throw Error(`Unable to parse URL object`);return{protocol:t[1],authority:t[2],path:t[3]||`/`,params:t[4]?t[4].split(`&`):[]}}function ue(e){var t=e.params.length?`?`+e.params.join(`&`):``;return e.protocol+`://`+e.authority+e.path+t}function de(e){if(!e)return null;var t=e.split(`.`);if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(o.atob(t[1]).split(``).map((function(e){return`%`+(`00`+e.charCodeAt(0).toString(16)).slice(-2)})).join(``)))}catch{return null}}var U=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};U.prototype.getStorageKey=function(e){var t,n=de(B.ACCESS_TOKEN);return t=n&&n.u?o.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number(`0x`+t))}))):B.ACCESS_TOKEN||``,e?`mapbox.eventData.`+e+`:`+t:`mapbox.eventData:`+t},U.prototype.fetchEventData=function(){var e=j(`localStorage`),t=this.getStorageKey(),n=this.getStorageKey(`uuid`);if(e)try{var r=o.localStorage.getItem(t);r&&(this.eventData=JSON.parse(r));var i=o.localStorage.getItem(n);i&&(this.anonId=i)}catch{C(`Unable to read from LocalStorage`)}},U.prototype.saveEventData=function(){var e=j(`localStorage`),t=this.getStorageKey(),n=this.getStorageKey(`uuid`);if(e)try{o.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&o.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{C(`Unable to write to LocalStorage`)}},U.prototype.processRequests=function(e){},U.prototype.postEvent=function(e,t,n,r){var i=this;if(B.EVENTS_URL){var a=le(B.EVENTS_URL);a.params.push(`access_token=`+(r||B.ACCESS_TOKEN||``));var o={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:`mapbox-gl-js`,sdkVersion:`1.13.3`,skuId:ie,userId:this.anonId},s=t?f(o,t):o;this.pendingRequest=Ae({url:ue(a),headers:{"Content-Type":`text/plain`},body:JSON.stringify([s])},(function(e){i.pendingRequest=null,n(e),i.saveEventData(),i.processRequests(r)}))}},U.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var fe,pe,me=function(e){function t(){e.call(this,`map.load`),this.success={},this.skuToken=``}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(e,t,n,r){this.skuToken=n;var i=!(!r&&!B.ACCESS_TOKEN),a=Array.isArray(e)&&e.some((function(e){return oe(e)||ce(e)}));B.EVENTS_URL&&i&&a&&this.queueRequest({id:t,timestamp:Date.now()},r)},t.prototype.processRequests=function(e){var t=this;if(!this.pendingRequest&&this.queue.length!==0){var n=this.queue.shift(),r=n.id,i=n.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),g(this.anonId)||(this.anonId=h()),this.postEvent(i,{skuToken:this.skuToken},(function(e){e||r&&(t.success[r]=!0)}),e))}},t}(U),W=new(function(e){function t(t){e.call(this,`appUserTurnstile`),this._customAccessToken=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(e,t){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(e)&&e.some((function(e){return oe(e)||ce(e)}))&&this.queueRequest(Date.now(),t)},t.prototype.processRequests=function(e){var t=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=de(B.ACCESS_TOKEN),r=n?n.u:B.ACCESS_TOKEN,i=r!==this.eventData.tokenU;g(this.anonId)||(this.anonId=h(),i=!0);var a=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(a),c=(a-this.eventData.lastSuccess)/864e5;i=i||c>=1||c<-1||o.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(a,{"enabled.telemetry":!1},(function(e){e||(t.eventData.lastSuccess=a,t.eventData.tokenU=r)}),e)}},t}(U)),he=W.postTurnstileEvent.bind(W),ge=new me,_e=ge.postMapLoadEvent.bind(ge),G=500,K=50;function ve(){o.caches&&!fe&&(fe=o.caches.open(`mapbox-tiles`))}function ye(e){var t=e.indexOf(`?`);return t<0?e:e.slice(0,t)}var be,xe=1/0;function Se(){return be??=o.OffscreenCanvas&&new o.OffscreenCanvas(1,1).getContext(`2d`)&&typeof o.createImageBitmap==`function`,be}var Ce={Unknown:`Unknown`,Style:`Style`,Source:`Source`,Tile:`Tile`,Glyphs:`Glyphs`,SpriteImage:`SpriteImage`,SpriteJSON:`SpriteJSON`,Image:`Image`};typeof Object.freeze==`function`&&Object.freeze(Ce);var we=function(e){function t(t,n,r){n===401&&ce(r)&&(t+=`: you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes`),e.call(this,t),this.status=n,this.url=r,this.name=this.constructor.name,this.message=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+`: `+this.message+` (`+this.status+`): `+this.url},t}(Error),Te=D()?function(){return self.worker&&self.worker.referrer}:function(){return(o.location.protocol===`blob:`?o.parent:o).location.href},Ee,De,Oe=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Te())&&!/^\w+:/.test(n))){if(o.fetch&&o.Request&&o.AbortController&&o.Request.prototype.hasOwnProperty(`signal`))return function(e,t){var n,r=new o.AbortController,i=new o.Request(e.url,{method:e.method||`GET`,body:e.body,credentials:e.credentials,headers:e.headers,referrer:Te(),signal:r.signal}),a=!1,s=!1,c=(n=i.url).indexOf(`sku=`)>0&&ce(n);e.type===`json`&&i.headers.set(`Accept`,`application/json`);var l=function(n,r,a){if(!s){if(n&&n.message!==`SecurityError`&&C(n),r&&a)return u(r);var l=Date.now();o.fetch(i).then((function(n){return n.ok?u(n,c?n.clone():null,l):t(new we(n.statusText,n.status,e.url))})).catch((function(e){e.code!==20&&t(Error(e.message))}))}},u=function(n,r,c){(e.type===`arrayBuffer`?n.arrayBuffer():e.type===`json`?n.json():n.text()).then((function(e){s||(r&&c&&function(e,t,n){if(ve(),fe){var r={status:t.status,statusText:t.statusText,headers:new o.Headers};t.headers.forEach((function(e,t){return r.headers.set(t,e)}));var i=O(t.headers.get(`Cache-Control`)||``);i[`no-store`]||(i[`max-age`]&&r.headers.set(`Expires`,new Date(n+1e3*i[`max-age`]).toUTCString()),new Date(r.headers.get(`Expires`)).getTime()-n<42e4||function(e,t){if(pe===void 0)try{new Response(new ReadableStream),pe=!0}catch{pe=!1}pe?t(e.body):e.blob().then(t)}(t,(function(t){var n=new o.Response(t,r);ve(),fe&&fe.then((function(t){return t.put(ye(e.url),n)})).catch((function(e){return C(e.message)}))})))}}(i,r,c),a=!0,t(null,e,n.headers.get(`Cache-Control`),n.headers.get(`Expires`)))})).catch((function(e){s||t(Error(e.message))}))};return c?function(e,t){if(ve(),!fe)return t(null);var n=ye(e.url);fe.then((function(e){e.match(n).then((function(r){var i=function(e){if(!e)return!1;var t=new Date(e.headers.get(`Expires`)||0),n=O(e.headers.get(`Cache-Control`)||``);return t>Date.now()&&!n[`no-cache`]}(r);e.delete(n),i&&e.put(n,r.clone()),t(null,r,i)})).catch(t)})).catch(t)}(i,l):l(null,null),{cancel:function(){s=!0,a||r.abort()}}}(e,t);if(D()&&self.worker&&self.worker.actor)return self.worker.actor.send(`getResource`,e,t,void 0,!0)}var n;return function(e,t){var n=new o.XMLHttpRequest;for(var r in n.open(e.method||`GET`,e.url,!0),e.type===`arrayBuffer`&&(n.responseType=`arraybuffer`),e.headers)n.setRequestHeader(r,e.headers[r]);return e.type===`json`&&(n.responseType=`text`,n.setRequestHeader(`Accept`,`application/json`)),n.withCredentials=e.credentials===`include`,n.onerror=function(){t(Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||n.status===0)&&n.response!==null){var r=n.response;if(e.type===`json`)try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r,n.getResponseHeader(`Cache-Control`),n.getResponseHeader(`Expires`))}else t(new we(n.statusText,n.status,e.url))},n.send(e.body),{cancel:function(){return n.abort()}}}(e,t)},ke=function(e,t){return Oe(f(e,{type:`arrayBuffer`}),t)},Ae=function(e,t){return Oe(f(e,{method:`POST`}),t)},je=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=`;Ee=[],De=0;var Me=function(e,t){if(te.supported&&(e.headers||={},e.headers.accept=`image/webp,*/*`),De>=B.MAX_PARALLEL_IMAGE_REQUESTS){var n={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ee.push(n),n}De++;var r=!1,i=function(){if(!r)for(r=!0,De--;Ee.length&&De<B.MAX_PARALLEL_IMAGE_REQUESTS;){var e=Ee.shift();e.cancelled||(e.cancel=Me(e.requestParameters,e.callback).cancel)}},a=ke(e,(function(e,n,r,a){i(),e?t(e):n&&(Se()?function(e,t){var n=new o.Blob([new Uint8Array(e)],{type:`image/png`});o.createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(Error(`Could not load image because of `+e.message+`. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(n,t):function(e,t,n,r){var i=new o.Image,a=o.URL;i.onload=function(){t(null,i),a.revokeObjectURL(i.src),i.onload=null,o.requestAnimationFrame((function(){i.src=je}))},i.onerror=function(){return t(Error(`Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))};var s=new o.Blob([new Uint8Array(e)],{type:`image/png`});i.cacheControl=n,i.expires=r,i.src=e.byteLength?a.createObjectURL(s):je}(n,t,r,a))}));return{cancel:function(){a.cancel(),i()}}};function Ne(e,t,n){n[e]&&n[e].indexOf(t)!==-1||(n[e]=n[e]||[],n[e].push(t))}function Pe(e,t,n){if(n&&n[e]){var r=n[e].indexOf(t);r!==-1&&n[e].splice(r,1)}}var Fe=function(e,t){t===void 0&&(t={}),f(this,t),this.type=e},Ie=function(e){function t(t,n){n===void 0&&(n={}),e.call(this,`error`,f({error:t},n))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Fe),Le=function(){};Le.prototype.on=function(e,t){return this._listeners=this._listeners||{},Ne(e,t,this._listeners),this},Le.prototype.off=function(e,t){return Pe(e,t,this._listeners),Pe(e,t,this._oneTimeListeners),this},Le.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},Ne(e,t,this._oneTimeListeners),this},Le.prototype.fire=function(e,t){typeof e==`string`&&(e=new Fe(e,t||{}));var n=e.type;if(this.listens(n)){e.target=this;for(var r=0,i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];r<i.length;r+=1)i[r].call(this,e);for(var a=0,o=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];a<o.length;a+=1){var s=o[a];Pe(n,s,this._oneTimeListeners),s.call(this,e)}var c=this._eventedParent;c&&(f(e,typeof this._eventedParentData==`function`?this._eventedParentData():this._eventedParentData),c.fire(e))}else e instanceof Ie&&console.error(e.error);return this},Le.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Le.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var q={$version:8,$root:{version:{required:!0,type:`enum`,values:[8]},name:{type:`string`},metadata:{type:`*`},center:{type:`array`,value:`number`},zoom:{type:`number`},bearing:{type:`number`,default:0,period:360,units:`degrees`},pitch:{type:`number`,default:0,units:`degrees`},light:{type:`light`},sources:{required:!0,type:`sources`},sprite:{type:`string`},glyphs:{type:`string`},transition:{type:`transition`},layers:{required:!0,type:`array`,value:`layer`}},sources:{"*":{type:`source`}},source:[`source_vector`,`source_raster`,`source_raster_dem`,`source_geojson`,`source_video`,`source_image`],source_vector:{type:{required:!0,type:`enum`,values:{vector:{}}},url:{type:`string`},tiles:{type:`array`,value:`string`},bounds:{type:`array`,value:`number`,length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:`enum`,values:{xyz:{},tms:{}},default:`xyz`},minzoom:{type:`number`,default:0},maxzoom:{type:`number`,default:22},attribution:{type:`string`},promoteId:{type:`promoteId`},volatile:{type:`boolean`,default:!1},"*":{type:`*`}},source_raster:{type:{required:!0,type:`enum`,values:{raster:{}}},url:{type:`string`},tiles:{type:`array`,value:`string`},bounds:{type:`array`,value:`number`,length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:`number`,default:0},maxzoom:{type:`number`,default:22},tileSize:{type:`number`,default:512,units:`pixels`},scheme:{type:`enum`,values:{xyz:{},tms:{}},default:`xyz`},attribution:{type:`string`},volatile:{type:`boolean`,default:!1},"*":{type:`*`}},source_raster_dem:{type:{required:!0,type:`enum`,values:{"raster-dem":{}}},url:{type:`string`},tiles:{type:`array`,value:`string`},bounds:{type:`array`,value:`number`,length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:`number`,default:0},maxzoom:{type:`number`,default:22},tileSize:{type:`number`,default:512,units:`pixels`},attribution:{type:`string`},encoding:{type:`enum`,values:{terrarium:{},mapbox:{}},default:`mapbox`},volatile:{type:`boolean`,default:!1},"*":{type:`*`}},source_geojson:{type:{required:!0,type:`enum`,values:{geojson:{}}},data:{type:`*`},maxzoom:{type:`number`,default:18},attribution:{type:`string`},buffer:{type:`number`,default:128,maximum:512,minimum:0},filter:{type:`*`},tolerance:{type:`number`,default:.375},cluster:{type:`boolean`,default:!1},clusterRadius:{type:`number`,default:50,minimum:0},clusterMaxZoom:{type:`number`},clusterMinPoints:{type:`number`},clusterProperties:{type:`*`},lineMetrics:{type:`boolean`,default:!1},generateId:{type:`boolean`,default:!1},promoteId:{type:`promoteId`}},source_video:{type:{required:!0,type:`enum`,values:{video:{}}},urls:{required:!0,type:`array`,value:`string`},coordinates:{required:!0,type:`array`,length:4,value:{type:`array`,length:2,value:`number`}}},source_image:{type:{required:!0,type:`enum`,values:{image:{}}},url:{required:!0,type:`string`},coordinates:{required:!0,type:`array`,length:4,value:{type:`array`,length:2,value:`number`}}},layer:{id:{type:`string`,required:!0},type:{type:`enum`,values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:`*`},source:{type:`string`},"source-layer":{type:`string`},minzoom:{type:`number`,minimum:0,maximum:24},maxzoom:{type:`number`,minimum:0,maximum:24},filter:{type:`filter`},layout:{type:`layout`},paint:{type:`paint`}},layout:[`layout_fill`,`layout_line`,`layout_circle`,`layout_heatmap`,`layout_fill-extrusion`,`layout_symbol`,`layout_raster`,`layout_hillshade`,`layout_background`],layout_background:{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_fill:{"fill-sort-key":{type:`number`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_circle:{"circle-sort-key":{type:`number`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_heatmap:{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},"layout_fill-extrusion":{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_line:{"line-cap":{type:`enum`,values:{butt:{},round:{},square:{}},default:`butt`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"line-join":{type:`enum`,values:{bevel:{},round:{},miter:{}},default:`miter`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"line-miter-limit":{type:`number`,default:2,requires:[{"line-join":`miter`}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"line-round-limit":{type:`number`,default:1.05,requires:[{"line-join":`round`}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"line-sort-key":{type:`number`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_symbol:{"symbol-placement":{type:`enum`,values:{point:{},line:{},"line-center":{}},default:`point`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"symbol-spacing":{type:`number`,default:250,minimum:1,units:`pixels`,requires:[{"symbol-placement":`line`}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"symbol-avoid-edges":{type:`boolean`,default:!1,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"symbol-sort-key":{type:`number`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"symbol-z-order":{type:`enum`,values:{auto:{},"viewport-y":{},source:{}},default:`auto`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-allow-overlap":{type:`boolean`,default:!1,requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-ignore-placement":{type:`boolean`,default:!1,requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-optional":{type:`boolean`,default:!1,requires:[`icon-image`,`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-rotation-alignment":{type:`enum`,values:{map:{},viewport:{},auto:{}},default:`auto`,requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-size":{type:`number`,default:1,minimum:0,units:`factor of the original icon size`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-text-fit":{type:`enum`,values:{none:{},width:{},height:{},both:{}},default:`none`,requires:[`icon-image`,`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-text-fit-padding":{type:`array`,value:`number`,length:4,default:[0,0,0,0],units:`pixels`,requires:[`icon-image`,`text-field`,{"icon-text-fit":[`both`,`width`,`height`]}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"icon-image":{type:`resolvedImage`,tokens:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-rotate":{type:`number`,default:0,period:360,units:`degrees`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-padding":{type:`number`,default:2,minimum:0,units:`pixels`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"icon-keep-upright":{type:`boolean`,default:!1,requires:[`icon-image`,{"icon-rotation-alignment":`map`},{"symbol-placement":[`line`,`line-center`]}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-offset":{type:`array`,value:`number`,length:2,default:[0,0],requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-anchor":{type:`enum`,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:`center`,requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-pitch-alignment":{type:`enum`,values:{map:{},viewport:{},auto:{}},default:`auto`,requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-pitch-alignment":{type:`enum`,values:{map:{},viewport:{},auto:{}},default:`auto`,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-rotation-alignment":{type:`enum`,values:{map:{},viewport:{},auto:{}},default:`auto`,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-field":{type:`formatted`,default:``,tokens:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-font":{type:`array`,value:`string`,default:[`Open Sans Regular`,`Arial Unicode MS Regular`],requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-size":{type:`number`,default:16,minimum:0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-max-width":{type:`number`,default:10,minimum:0,units:`ems`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-line-height":{type:`number`,default:1.2,units:`ems`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"text-letter-spacing":{type:`number`,default:0,units:`ems`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-justify":{type:`enum`,values:{auto:{},left:{},center:{},right:{}},default:`center`,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-radial-offset":{type:`number`,units:`ems`,default:0,requires:[`text-field`],"property-type":`data-driven`,expression:{interpolated:!0,parameters:[`zoom`,`feature`]}},"text-variable-anchor":{type:`array`,value:`enum`,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:[`text-field`,{"symbol-placement":[`point`]}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-anchor":{type:`enum`,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:`center`,requires:[`text-field`,{"!":`text-variable-anchor`}],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-max-angle":{type:`number`,default:45,units:`degrees`,requires:[`text-field`,{"symbol-placement":[`line`,`line-center`]}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"text-writing-mode":{type:`array`,value:`enum`,values:{horizontal:{},vertical:{}},requires:[`text-field`,{"symbol-placement":[`point`]}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-rotate":{type:`number`,default:0,period:360,units:`degrees`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-padding":{type:`number`,default:2,minimum:0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"text-keep-upright":{type:`boolean`,default:!0,requires:[`text-field`,{"text-rotation-alignment":`map`},{"symbol-placement":[`line`,`line-center`]}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-transform":{type:`enum`,values:{none:{},uppercase:{},lowercase:{}},default:`none`,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-offset":{type:`array`,value:`number`,units:`ems`,length:2,default:[0,0],requires:[`text-field`,{"!":`text-radial-offset`}],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-allow-overlap":{type:`boolean`,default:!1,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-ignore-placement":{type:`boolean`,default:!1,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-optional":{type:`boolean`,default:!1,requires:[`text-field`,`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_raster:{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_hillshade:{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},filter:{type:`array`,value:`*`},filter_operator:{type:`enum`,values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:`enum`,values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:`expression`},stops:{type:`array`,value:`function_stop`},base:{type:`number`,default:1,minimum:0},property:{type:`string`,default:`$zoom`},type:{type:`enum`,values:{identity:{},exponential:{},interval:{},categorical:{}},default:`exponential`},colorSpace:{type:`enum`,values:{rgb:{},lab:{},hcl:{}},default:`rgb`},default:{type:`*`,required:!1}},function_stop:{type:`array`,minimum:0,maximum:24,value:[`number`,`color`],length:2},expression:{type:`array`,value:`*`,minimum:1},light:{anchor:{type:`enum`,default:`viewport`,values:{map:{},viewport:{}},"property-type":`data-constant`,transition:!1,expression:{interpolated:!1,parameters:[`zoom`]}},position:{type:`array`,default:[1.15,210,30],length:3,value:`number`,"property-type":`data-constant`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]}},color:{type:`color`,"property-type":`data-constant`,default:`#ffffff`,expression:{interpolated:!0,parameters:[`zoom`]},transition:!0},intensity:{type:`number`,"property-type":`data-constant`,default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:[`zoom`]},transition:!0}},paint:[`paint_fill`,`paint_line`,`paint_circle`,`paint_heatmap`,`paint_fill-extrusion`,`paint_symbol`,`paint_raster`,`paint_hillshade`,`paint_background`],paint_fill:{"fill-antialias":{type:`boolean`,default:!0,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"fill-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-color":{type:`color`,default:`#000000`,transition:!0,requires:[{"!":`fill-pattern`}],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-outline-color":{type:`color`,transition:!0,requires:[{"!":`fill-pattern`},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"fill-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`fill-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"fill-pattern":{type:`resolvedImage`,transition:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`cross-faded-data-driven`}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"fill-extrusion-color":{type:`color`,default:`#000000`,transition:!0,requires:[{"!":`fill-extrusion-pattern`}],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-extrusion-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"fill-extrusion-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`fill-extrusion-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"fill-extrusion-pattern":{type:`resolvedImage`,transition:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`cross-faded-data-driven`},"fill-extrusion-height":{type:`number`,default:0,minimum:0,units:`meters`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-extrusion-base":{type:`number`,default:0,minimum:0,units:`meters`,transition:!0,requires:[`fill-extrusion-height`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-extrusion-vertical-gradient":{type:`boolean`,default:!0,transition:!1,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`}},paint_line:{"line-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-color":{type:`color`,default:`#000000`,transition:!0,requires:[{"!":`line-pattern`}],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"line-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`line-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"line-width":{type:`number`,default:1,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-gap-width":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-offset":{type:`number`,default:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-blur":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-dasharray":{type:`array`,value:`number`,minimum:0,transition:!0,units:`line widths`,requires:[{"!":`line-pattern`}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`cross-faded`},"line-pattern":{type:`resolvedImage`,transition:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`cross-faded-data-driven`},"line-gradient":{type:`color`,transition:!1,requires:[{"!":`line-dasharray`},{"!":`line-pattern`},{source:`geojson`,has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:[`line-progress`]},"property-type":`color-ramp`}},paint_circle:{"circle-radius":{type:`number`,default:5,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-color":{type:`color`,default:`#000000`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-blur":{type:`number`,default:0,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"circle-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`circle-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"circle-pitch-scale":{type:`enum`,values:{map:{},viewport:{}},default:`map`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"circle-pitch-alignment":{type:`enum`,values:{map:{},viewport:{}},default:`viewport`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"circle-stroke-width":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-stroke-color":{type:`color`,default:`#000000`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-stroke-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`}},paint_heatmap:{"heatmap-radius":{type:`number`,default:30,minimum:1,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"heatmap-weight":{type:`number`,default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"heatmap-intensity":{type:`number`,default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"heatmap-color":{type:`color`,default:[`interpolate`,[`linear`],[`heatmap-density`],0,`rgba(0, 0, 255, 0)`,.1,`royalblue`,.3,`cyan`,.5,`lime`,.7,`yellow`,1,`red`],transition:!1,expression:{interpolated:!0,parameters:[`heatmap-density`]},"property-type":`color-ramp`},"heatmap-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`}},paint_symbol:{"icon-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-color":{type:`color`,default:`#000000`,transition:!0,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-halo-color":{type:`color`,default:`rgba(0, 0, 0, 0)`,transition:!0,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-halo-width":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-halo-blur":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"icon-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`icon-image`,`icon-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-color":{type:`color`,default:`#000000`,transition:!0,overridable:!0,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-halo-color":{type:`color`,default:`rgba(0, 0, 0, 0)`,transition:!0,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-halo-width":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-halo-blur":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"text-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`text-field`,`text-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`}},paint_raster:{"raster-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-hue-rotate":{type:`number`,default:0,period:360,transition:!0,units:`degrees`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-brightness-min":{type:`number`,default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-brightness-max":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-saturation":{type:`number`,default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-contrast":{type:`number`,default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-resampling":{type:`enum`,values:{linear:{},nearest:{}},default:`linear`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"raster-fade-duration":{type:`number`,default:300,minimum:0,transition:!1,units:`milliseconds`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`}},paint_hillshade:{"hillshade-illumination-direction":{type:`number`,default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-illumination-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`viewport`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-exaggeration":{type:`number`,default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-shadow-color":{type:`color`,default:`#000000`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-highlight-color":{type:`color`,default:`#FFFFFF`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-accent-color":{type:`color`,default:`#000000`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`}},paint_background:{"background-color":{type:`color`,default:`#000000`,transition:!0,requires:[{"!":`background-pattern`}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"background-pattern":{type:`resolvedImage`,transition:!0,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`cross-faded`},"background-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`}},transition:{duration:{type:`number`,default:300,minimum:0,units:`milliseconds`},delay:{type:`number`,default:0,minimum:0,units:`milliseconds`}},"property-type":{"data-driven":{type:`property-type`},"cross-faded":{type:`property-type`},"cross-faded-data-driven":{type:`property-type`},"color-ramp":{type:`property-type`},"data-constant":{type:`property-type`},constant:{type:`property-type`}},promoteId:{"*":{type:`string`}}},Re=function(e,t,n,r){this.message=(e?e+`: `:``)+n,r&&(this.identifier=r),t!=null&&t.__line__&&(this.line=t.__line__)};function ze(e){var t=e.value;return t?[new Re(e.key,t,`constants have been deprecated as of v8`)]:[]}function Be(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var r=0,i=t;r<i.length;r+=1){var a=i[r];for(var o in a)e[o]=a[o]}return e}function Ve(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function He(e){if(Array.isArray(e))return e.map(He);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var n in e)t[n]=He(e[n]);return t}return Ve(e)}var Ue=function(e){function t(t,n){e.call(this,n),this.message=n,this.key=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),We=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var n=0,r=t;n<r.length;n+=1){var i=r[n];this.bindings[i[0]]=i[1]}};We.prototype.concat=function(e){return new We(this,e)},We.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw Error(e+` not found in scope.`)},We.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Ge={kind:`null`},Ke={kind:`number`},qe={kind:`string`},Je={kind:`boolean`},Ye={kind:`color`},Xe={kind:`object`},Ze={kind:`value`},Qe={kind:`collator`},$e={kind:`formatted`},et={kind:`resolvedImage`};function tt(e,t){return{kind:`array`,itemType:e,N:t}}function nt(e){if(e.kind===`array`){var t=nt(e.itemType);return typeof e.N==`number`?`array<`+t+`, `+e.N+`>`:e.itemType.kind===`value`?`array`:`array<`+t+`>`}return e.kind}var rt=[Ge,Ke,qe,Je,Ye,$e,Xe,tt(Ze),et];function it(e,t){if(t.kind===`error`)return null;if(e.kind===`array`){if(t.kind===`array`&&(t.N===0&&t.itemType.kind===`value`||!it(e.itemType,t.itemType))&&(typeof e.N!=`number`||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind===`value`){for(var n=0,r=rt;n<r.length;n+=1)if(!it(r[n],t))return null}}return`Expected `+nt(e)+` but found `+nt(t)+` instead.`}function at(e,t){return t.some((function(t){return t.kind===e.kind}))}function ot(e,t){return t.some((function(t){return t===`null`?e===null:t===`array`?Array.isArray(e):t===`object`?e&&!Array.isArray(e)&&typeof e==`object`:t===typeof e}))}var st=t((function(e,t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function i(e){return r(e[e.length-1]===`%`?parseFloat(e)/100*255:parseInt(e))}function a(e){return(t=e[e.length-1]===`%`?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function o(e,t,n){return n<0?n+=1:n>1&&--n,6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{t.parseCSSColor=function(e){var t,s=e.replace(/ /g,``).toLowerCase();if(s in n)return n[s].slice();if(s[0]===`#`)return s.length===4?(t=parseInt(s.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:s.length===7&&(t=parseInt(s.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var c=s.indexOf(`(`),l=s.indexOf(`)`);if(c!==-1&&l+1===s.length){var u=s.substr(0,c),d=s.substr(c+1,l-(c+1)).split(`,`),f=1;switch(u){case`rgba`:if(d.length!==4)return null;f=a(d.pop());case`rgb`:return d.length===3?[i(d[0]),i(d[1]),i(d[2]),f]:null;case`hsla`:if(d.length!==4)return null;f=a(d.pop());case`hsl`:if(d.length!==3)return null;var p=(parseFloat(d[0])%360+360)%360/360,m=a(d[1]),h=a(d[2]),g=h<=.5?h*(m+1):h+m-h*m,_=2*h-g;return[r(255*o(_,g,p+1/3)),r(255*o(_,g,p)),r(255*o(_,g,p-1/3)),f];default:return null}}return null}}catch{}})).parseCSSColor,ct=function(e,t,n,r){r===void 0&&(r=1),this.r=e,this.g=t,this.b=n,this.a=r};ct.parse=function(e){if(e){if(e instanceof ct)return e;if(typeof e==`string`){var t=st(e);if(t)return new ct(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},ct.prototype.toString=function(){var e=this.toArray(),t=e[1],n=e[2],r=e[3];return`rgba(`+Math.round(e[0])+`,`+Math.round(t)+`,`+Math.round(n)+`,`+r+`)`},ct.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},ct.black=new ct(0,0,0,1),ct.white=new ct(1,1,1,1),ct.transparent=new ct(0,0,0,0),ct.red=new ct(1,0,0,1);var lt=function(e,t,n){this.sensitivity=e?t?`variant`:`case`:t?`accent`:`base`,this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:`search`})};lt.prototype.compare=function(e,t){return this.collator.compare(e,t)},lt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ut=function(e,t,n,r,i){this.text=e,this.image=t,this.scale=n,this.fontStack=r,this.textColor=i},dt=function(e){this.sections=e};dt.fromString=function(e){return new dt([new ut(e,null,null,null,null)])},dt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some((function(e){return e.text.length!==0||e.image&&e.image.name.length!==0}))},dt.factory=function(e){return e instanceof dt?e:dt.fromString(e)},dt.prototype.toString=function(){return this.sections.length===0?``:this.sections.map((function(e){return e.text})).join(``)},dt.prototype.serialize=function(){for(var e=[`format`],t=0,n=this.sections;t<n.length;t+=1){var r=n[t];if(r.image)e.push([`image`,r.image.name]);else{e.push(r.text);var i={};r.fontStack&&(i[`text-font`]=[`literal`,r.fontStack.split(`,`)]),r.scale&&(i[`font-scale`]=r.scale),r.textColor&&(i[`text-color`]=[`rgba`].concat(r.textColor.toArray())),e.push(i)}}return e};var ft=function(e){this.name=e.name,this.available=e.available};function pt(e,t,n,r){return typeof e==`number`&&e>=0&&e<=255&&typeof t==`number`&&t>=0&&t<=255&&typeof n==`number`&&n>=0&&n<=255?r===void 0||typeof r==`number`&&r>=0&&r<=1?null:`Invalid rgba value [`+[e,t,n,r].join(`, `)+`]: 'a' must be between 0 and 1.`:`Invalid rgba value [`+(typeof r==`number`?[e,t,n,r]:[e,t,n]).join(`, `)+`]: 'r', 'g', and 'b' must be between 0 and 255.`}function mt(e){if(e===null||typeof e==`string`||typeof e==`boolean`||typeof e==`number`||e instanceof ct||e instanceof lt||e instanceof dt||e instanceof ft)return!0;if(Array.isArray(e)){for(var t=0,n=e;t<n.length;t+=1)if(!mt(n[t]))return!1;return!0}if(typeof e==`object`){for(var r in e)if(!mt(e[r]))return!1;return!0}return!1}function ht(e){if(e===null)return Ge;if(typeof e==`string`)return qe;if(typeof e==`boolean`)return Je;if(typeof e==`number`)return Ke;if(e instanceof ct)return Ye;if(e instanceof lt)return Qe;if(e instanceof dt)return $e;if(e instanceof ft)return et;if(Array.isArray(e)){for(var t,n=e.length,r=0,i=e;r<i.length;r+=1){var a=ht(i[r]);if(t){if(t===a)continue;t=Ze;break}t=a}return tt(t||Ze,n)}return Xe}function gt(e){var t=typeof e;return e===null?``:t===`string`||t===`number`||t===`boolean`?String(e):e instanceof ct||e instanceof dt||e instanceof ft?e.toString():JSON.stringify(e)}ft.prototype.toString=function(){return this.name},ft.fromString=function(e){return e?new ft({name:e,available:!1}):null},ft.prototype.serialize=function(){return[`image`,this.name]};var _t=function(e,t){this.type=e,this.value=t};_t.parse=function(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found `+(e.length-1)+` instead.`);if(!mt(e[1]))return t.error(`invalid value`);var n=e[1],r=ht(n),i=t.expectedType;return r.kind!==`array`||r.N!==0||!i||i.kind!==`array`||typeof i.N==`number`&&i.N!==0||(r=i),new _t(r,n)},_t.prototype.evaluate=function(){return this.value},_t.prototype.eachChild=function(){},_t.prototype.outputDefined=function(){return!0},_t.prototype.serialize=function(){return this.type.kind===`array`||this.type.kind===`object`?[`literal`,this.value]:this.value instanceof ct?[`rgba`].concat(this.value.toArray()):this.value instanceof dt?this.value.serialize():this.value};var vt=function(e){this.name=`ExpressionEvaluationError`,this.message=e};vt.prototype.toJSON=function(){return this.message};var yt={string:qe,number:Ke,boolean:Je,object:Xe},bt=function(e,t){this.type=e,this.args=t};bt.parse=function(e,t){if(e.length<2)return t.error(`Expected at least one argument.`);var n,r=1,i=e[0];if(i===`array`){var a,o;if(e.length>2){var s=e[1];if(typeof s!=`string`||!(s in yt)||s===`object`)return t.error(`The item type argument of "array" must be one of string, number, boolean`,1);a=yt[s],r++}else a=Ze;if(e.length>3){if(e[2]!==null&&(typeof e[2]!=`number`||e[2]<0||e[2]!==Math.floor(e[2])))return t.error(`The length argument to "array" must be a positive integer literal`,2);o=e[2],r++}n=tt(a,o)}else n=yt[i];for(var c=[];r<e.length;r++){var l=t.parse(e[r],r,Ze);if(!l)return null;c.push(l)}return new bt(n,c)},bt.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var n=this.args[t].evaluate(e);if(!it(this.type,ht(n)))return n;if(t===this.args.length-1)throw new vt(`Expected value to be of type `+nt(this.type)+`, but found `+nt(ht(n))+` instead.`)}return null},bt.prototype.eachChild=function(e){this.args.forEach(e)},bt.prototype.outputDefined=function(){return this.args.every((function(e){return e.outputDefined()}))},bt.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind===`array`){var n=e.itemType;if(n.kind===`string`||n.kind===`number`||n.kind===`boolean`){t.push(n.kind);var r=e.N;(typeof r==`number`||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((function(e){return e.serialize()})))};var xt=function(e){this.type=$e,this.sections=e};xt.parse=function(e,t){if(e.length<2)return t.error(`Expected at least one argument.`);var n=e[1];if(!Array.isArray(n)&&typeof n==`object`)return t.error(`First argument must be an image or text section.`);for(var r=[],i=!1,a=1;a<=e.length-1;++a){var o=e[a];if(i&&typeof o==`object`&&!Array.isArray(o)){i=!1;var s=null;if(o[`font-scale`]&&!(s=t.parse(o[`font-scale`],1,Ke)))return null;var c=null;if(o[`text-font`]&&!(c=t.parse(o[`text-font`],1,tt(qe))))return null;var l=null;if(o[`text-color`]&&!(l=t.parse(o[`text-color`],1,Ye)))return null;var u=r[r.length-1];u.scale=s,u.font=c,u.textColor=l}else{var d=t.parse(e[a],1,Ze);if(!d)return null;var f=d.type.kind;if(f!==`string`&&f!==`value`&&f!==`null`&&f!==`resolvedImage`)return t.error(`Formatted text type must be 'string', 'value', 'image' or 'null'.`);i=!0,r.push({content:d,scale:null,font:null,textColor:null})}}return new xt(r)},xt.prototype.evaluate=function(e){return new dt(this.sections.map((function(t){var n=t.content.evaluate(e);return ht(n)===et?new ut(``,n,null,null,null):new ut(gt(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(`,`):null,t.textColor?t.textColor.evaluate(e):null)})))},xt.prototype.eachChild=function(e){for(var t=0,n=this.sections;t<n.length;t+=1){var r=n[t];e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}},xt.prototype.outputDefined=function(){return!1},xt.prototype.serialize=function(){for(var e=[`format`],t=0,n=this.sections;t<n.length;t+=1){var r=n[t];e.push(r.content.serialize());var i={};r.scale&&(i[`font-scale`]=r.scale.serialize()),r.font&&(i[`text-font`]=r.font.serialize()),r.textColor&&(i[`text-color`]=r.textColor.serialize()),e.push(i)}return e};var St=function(e){this.type=et,this.input=e};St.parse=function(e,t){if(e.length!==2)return t.error(`Expected two arguments.`);var n=t.parse(e[1],1,qe);return n?new St(n):t.error(`No image name provided.`)},St.prototype.evaluate=function(e){var t=this.input.evaluate(e),n=ft.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n},St.prototype.eachChild=function(e){e(this.input)},St.prototype.outputDefined=function(){return!1},St.prototype.serialize=function(){return[`image`,this.input.serialize()]};var Ct={"to-boolean":Je,"to-color":Ye,"to-number":Ke,"to-string":qe},wt=function(e,t){this.type=e,this.args=t};wt.parse=function(e,t){if(e.length<2)return t.error(`Expected at least one argument.`);var n=e[0];if((n===`to-boolean`||n===`to-string`)&&e.length!==2)return t.error(`Expected one argument.`);for(var r=Ct[n],i=[],a=1;a<e.length;a++){var o=t.parse(e[a],a,Ze);if(!o)return null;i.push(o)}return new wt(r,i)},wt.prototype.evaluate=function(e){if(this.type.kind===`boolean`)return!!this.args[0].evaluate(e);if(this.type.kind===`color`){for(var t,n,r=0,i=this.args;r<i.length;r+=1){if(n=null,(t=i[r].evaluate(e))instanceof ct)return t;if(typeof t==`string`){var a=e.parseColor(t);if(a)return a}else if(Array.isArray(t)&&!(n=t.length<3||t.length>4?`Invalid rbga value `+JSON.stringify(t)+`: expected an array containing either three or four numeric values.`:pt(t[0],t[1],t[2],t[3])))return new ct(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new vt(n||`Could not parse color from value '`+(typeof t==`string`?t:String(JSON.stringify(t)))+`'`)}if(this.type.kind===`number`){for(var o=null,s=0,c=this.args;s<c.length;s+=1){if((o=c[s].evaluate(e))===null)return 0;var l=Number(o);if(!isNaN(l))return l}throw new vt(`Could not convert `+JSON.stringify(o)+` to number.`)}return this.type.kind===`formatted`?dt.fromString(gt(this.args[0].evaluate(e))):this.type.kind===`resolvedImage`?ft.fromString(gt(this.args[0].evaluate(e))):gt(this.args[0].evaluate(e))},wt.prototype.eachChild=function(e){this.args.forEach(e)},wt.prototype.outputDefined=function(){return this.args.every((function(e){return e.outputDefined()}))},wt.prototype.serialize=function(){if(this.type.kind===`formatted`)return new xt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind===`resolvedImage`)return new St(this.args[0]).serialize();var e=[`to-`+this.type.kind];return this.eachChild((function(t){e.push(t.serialize())})),e};var Tt=[`Unknown`,`Point`,`LineString`,`Polygon`],Et=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Et.prototype.id=function(){return this.feature&&`id`in this.feature?this.feature.id:null},Et.prototype.geometryType=function(){return this.feature?typeof this.feature.type==`number`?Tt[this.feature.type]:this.feature.type:null},Et.prototype.geometry=function(){return this.feature&&`geometry`in this.feature?this.feature.geometry:null},Et.prototype.canonicalID=function(){return this.canonical},Et.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Et.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||=this._parseColorCache[e]=ct.parse(e),t};var Dt=function(e,t,n,r){this.name=e,this.type=t,this._evaluate=n,this.args=r};Dt.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Dt.prototype.eachChild=function(e){this.args.forEach(e)},Dt.prototype.outputDefined=function(){return!1},Dt.prototype.serialize=function(){return[this.name].concat(this.args.map((function(e){return e.serialize()})))},Dt.parse=function(e,t){var n,r=e[0],i=Dt.definitions[r];if(!i)return t.error(`Unknown expression "`+r+`". If you wanted a literal array, use ["literal", [...]].`,0);for(var a=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=o.filter((function(t){var n=t[0];return!Array.isArray(n)||n.length===e.length-1})),c=null,l=0,u=s;l<u.length;l+=1){var d=u[l],f=d[0],p=d[1];c=new Yt(t.registry,t.path,null,t.scope);for(var m=[],h=!1,g=1;g<e.length;g++){var _=e[g],v=Array.isArray(f)?f[g-1]:f.type,y=c.parse(_,1+m.length,v);if(!y){h=!0;break}m.push(y)}if(!h)if(Array.isArray(f)&&f.length!==m.length)c.error(`Expected `+f.length+` arguments, but found `+m.length+` instead.`);else{for(var b=0;b<m.length;b++){var x=Array.isArray(f)?f[b]:f.type,S=m[b];c.concat(b+1).checkSubtype(x,S.type)}if(c.errors.length===0)return new Dt(r,a,p,m)}}if(s.length===1)(n=t.errors).push.apply(n,c.errors);else{for(var C=(s.length?s:o).map((function(e){var t;return t=e[0],Array.isArray(t)?`(`+t.map(nt).join(`, `)+`)`:`(`+nt(t.type)+`...)`})).join(` | `),w=[],E=1;E<e.length;E++){var D=t.parse(e[E],1+w.length);if(!D)return null;w.push(nt(D.type))}t.error(`Expected arguments of type `+C+`, but found (`+w.join(`, `)+`) instead.`)}return null},Dt.register=function(e,t){for(var n in Dt.definitions=t,t)e[n]=Dt};var Ot=function(e,t,n){this.type=Qe,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t};function kt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function At(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function jt(e,t){var n=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=2**t.z;return[Math.round(n*i*8192),Math.round(r*i*8192)]}function Mt(e,t,n){return t[1]>e[1]!=n[1]>e[1]&&e[0]<(n[0]-t[0])*(e[1]-t[1])/(n[1]-t[1])+t[0]}function Nt(e,t){for(var n,r,i,a,o,s,c,l=!1,u=0,d=t.length;u<d;u++)for(var f=t[u],p=0,m=f.length;p<m-1;p++){if((a=(n=e)[0]-(r=f[p])[0])*(c=n[1]-(i=f[p+1])[1])-(s=n[0]-i[0])*(o=n[1]-r[1])==0&&a*s<=0&&o*c<=0)return!1;Mt(e,f[p],f[p+1])&&(l=!l)}return l}function Pt(e,t){for(var n=0;n<t.length;n++)if(Nt(e,t[n]))return!0;return!1}function Ft(e,t,n,r){var i=r[0]-n[0],a=r[1]-n[1],o=(e[0]-n[0])*a-i*(e[1]-n[1]),s=(t[0]-n[0])*a-i*(t[1]-n[1]);return o>0&&s<0||o<0&&s>0}function It(e,t,n){for(var r=0,i=n;r<i.length;r+=1)for(var a=i[r],o=0;o<a.length-1;++o)if((d=[(u=a[o+1])[0]-(l=a[o])[0],u[1]-l[1]])[0]*(f=[(c=t)[0]-(s=e)[0],c[1]-s[1]])[1]-d[1]*f[0]!=0&&Ft(s,c,l,u)&&Ft(l,u,s,c))return!0;var s,c,l,u,d,f;return!1}function Lt(e,t){for(var n=0;n<e.length;++n)if(!Nt(e[n],t))return!1;for(var r=0;r<e.length-1;++r)if(It(e[r],e[r+1],t))return!1;return!0}function Rt(e,t){for(var n=0;n<t.length;n++)if(Lt(e,t[n]))return!0;return!1}function zt(e,t,n){for(var r=[],i=0;i<e.length;i++){for(var a=[],o=0;o<e[i].length;o++){var s=jt(e[i][o],n);kt(t,s),a.push(s)}r.push(a)}return r}function Bt(e,t,n){for(var r=[],i=0;i<e.length;i++){var a=zt(e[i],t,n);r.push(a)}return r}function Vt(e,t,n,r){if(e[0]<n[0]||e[0]>n[2]){var i=.5*r,a=e[0]-n[0]>i?-r:n[0]-e[0]>i?r:0;a===0&&(a=e[0]-n[2]>i?-r:n[2]-e[0]>i?r:0),e[0]+=a}kt(t,e)}function Ht(e,t,n,r){for(var i=8192*2**r.z,a=[8192*r.x,8192*r.y],o=[],s=0,c=e;s<c.length;s+=1)for(var l=0,u=c[s];l<u.length;l+=1){var d=u[l],f=[d.x+a[0],d.y+a[1]];Vt(f,t,n,i),o.push(f)}return o}function Ut(e,t,n,r){for(var i,a=8192*2**r.z,o=[8192*r.x,8192*r.y],s=[],c=0,l=e;c<l.length;c+=1){for(var u=[],d=0,f=l[c];d<f.length;d+=1){var p=f[d],m=[p.x+o[0],p.y+o[1]];kt(t,m),u.push(m)}s.push(u)}if(t[2]-t[0]<=a/2){(i=t)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var h=0,g=s;h<g.length;h+=1)for(var _=0,v=g[h];_<v.length;_+=1)Vt(v[_],t,n,a)}return s}Ot.parse=function(e,t){if(e.length!==2)return t.error(`Expected one argument.`);var n=e[1];if(typeof n!=`object`||Array.isArray(n))return t.error(`Collator options argument must be an object.`);var r=t.parse(n[`case-sensitive`]!==void 0&&n[`case-sensitive`],1,Je);if(!r)return null;var i=t.parse(n[`diacritic-sensitive`]!==void 0&&n[`diacritic-sensitive`],1,Je);if(!i)return null;var a=null;return n.locale&&!(a=t.parse(n.locale,1,qe))?null:new Ot(r,i,a)},Ot.prototype.evaluate=function(e){return new lt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},Ot.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},Ot.prototype.outputDefined=function(){return!1},Ot.prototype.serialize=function(){var e={};return e[`case-sensitive`]=this.caseSensitive.serialize(),e[`diacritic-sensitive`]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),[`collator`,e]};var Wt=function(e,t){this.type=Je,this.geojson=e,this.geometries=t};function Gt(e){if(e instanceof Dt&&(e.name===`get`&&e.args.length===1||e.name===`feature-state`||e.name===`has`&&e.args.length===1||e.name===`properties`||e.name===`geometry-type`||e.name===`id`||/^filter-/.test(e.name))||e instanceof Wt)return!1;var t=!0;return e.eachChild((function(e){t&&!Gt(e)&&(t=!1)})),t}function Kt(e){if(e instanceof Dt&&e.name===`feature-state`)return!1;var t=!0;return e.eachChild((function(e){t&&!Kt(e)&&(t=!1)})),t}function qt(e,t){if(e instanceof Dt&&t.indexOf(e.name)>=0)return!1;var n=!0;return e.eachChild((function(e){n&&!qt(e,t)&&(n=!1)})),n}Wt.parse=function(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found `+(e.length-1)+` instead.`);if(mt(e[1])){var n=e[1];if(n.type===`FeatureCollection`)for(var r=0;r<n.features.length;++r){var i=n.features[r].geometry.type;if(i===`Polygon`||i===`MultiPolygon`)return new Wt(n,n.features[r].geometry)}else if(n.type===`Feature`){var a=n.geometry.type;if(a===`Polygon`||a===`MultiPolygon`)return new Wt(n,n.geometry)}else if(n.type===`Polygon`||n.type===`MultiPolygon`)return new Wt(n,n)}return t.error(`'within' expression requires valid geojson object that contains polygon geometry type.`)},Wt.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()===`Point`)return function(e,t){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(t.type===`Polygon`){var a=zt(t.coordinates,r,i),o=Ht(e.geometry(),n,r,i);if(!At(n,r))return!1;for(var s=0,c=o;s<c.length;s+=1)if(!Nt(c[s],a))return!1}if(t.type===`MultiPolygon`){var l=Bt(t.coordinates,r,i),u=Ht(e.geometry(),n,r,i);if(!At(n,r))return!1;for(var d=0,f=u;d<f.length;d+=1)if(!Pt(f[d],l))return!1}return!0}(e,this.geometries);if(e.geometryType()===`LineString`)return function(e,t){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(t.type===`Polygon`){var a=zt(t.coordinates,r,i),o=Ut(e.geometry(),n,r,i);if(!At(n,r))return!1;for(var s=0,c=o;s<c.length;s+=1)if(!Lt(c[s],a))return!1}if(t.type===`MultiPolygon`){var l=Bt(t.coordinates,r,i),u=Ut(e.geometry(),n,r,i);if(!At(n,r))return!1;for(var d=0,f=u;d<f.length;d+=1)if(!Rt(f[d],l))return!1}return!0}(e,this.geometries)}return!1},Wt.prototype.eachChild=function(){},Wt.prototype.outputDefined=function(){return!0},Wt.prototype.serialize=function(){return[`within`,this.geojson]};var Jt=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};Jt.parse=function(e,t){if(e.length!==2||typeof e[1]!=`string`)return t.error(`'var' expression requires exactly one string literal argument.`);var n=e[1];return t.scope.has(n)?new Jt(n,t.scope.get(n)):t.error(`Unknown variable "`+n+`". Make sure "`+n+`" has been bound in an enclosing "let" expression before using it.`,1)},Jt.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Jt.prototype.eachChild=function(){},Jt.prototype.outputDefined=function(){return!1},Jt.prototype.serialize=function(){return[`var`,this.name]};var Yt=function(e,t,n,r,i){t===void 0&&(t=[]),r===void 0&&(r=new We),i===void 0&&(i=[]),this.registry=e,this.path=t,this.key=t.map((function(e){return`[`+e+`]`})).join(``),this.scope=r,this.errors=i,this.expectedType=n};function Xt(e,t){for(var n,r=e.length-1,i=0,a=r,o=0;i<=a;)if((n=e[o=Math.floor((i+a)/2)])<=t){if(o===r||t<e[o+1])return o;i=o+1}else{if(!(n>t))throw new vt(`Input is not a number.`);a=o-1}return 0}Yt.prototype.parse=function(e,t,n,r,i){return i===void 0&&(i={}),t?this.concat(t,n,r)._parse(e,i):this._parse(e,i)},Yt.prototype._parse=function(e,t){function n(e,t,n){return n===`assert`?new bt(t,[e]):n===`coerce`?new wt(t,[e]):e}if(e!==null&&typeof e!=`string`&&typeof e!=`boolean`&&typeof e!=`number`||(e=[`literal`,e]),Array.isArray(e)){if(e.length===0)return this.error(`Expected an array with at least one element. If you wanted a literal array, use ["literal", []].`);var r=e[0];if(typeof r!=`string`)return this.error(`Expression name must be a string, but found `+typeof r+` instead. If you wanted a literal array, use ["literal", [...]].`,0),null;var i=this.registry[r];if(i){var a=i.parse(e,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if(o.kind!==`string`&&o.kind!==`number`&&o.kind!==`boolean`&&o.kind!==`object`&&o.kind!==`array`||s.kind!==`value`)if(o.kind!==`color`&&o.kind!==`formatted`&&o.kind!==`resolvedImage`||s.kind!==`value`&&s.kind!==`string`){if(this.checkSubtype(o,s))return null}else a=n(a,o,t.typeAnnotation||`coerce`);else a=n(a,o,t.typeAnnotation||`assert`)}if(!(a instanceof _t)&&a.type.kind!==`resolvedImage`&&function e(t){if(t instanceof Jt)return e(t.boundExpression);if(t instanceof Dt&&t.name===`error`||t instanceof Ot||t instanceof Wt)return!1;var n=t instanceof wt||t instanceof bt,r=!0;return t.eachChild((function(t){r=n?r&&e(t):r&&t instanceof _t})),!!r&&Gt(t)&&qt(t,[`zoom`,`heatmap-density`,`line-progress`,`accumulated`,`is-supported-script`])}(a)){var c=new Et;try{a=new _t(a.type,a.evaluate(c))}catch(e){return this.error(e.message),null}}return a}return this.error(`Unknown expression "`+r+`". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?`'undefined' value invalid. Use null instead.`:typeof e==`object`?`Bare objects invalid. Use ["literal", {...}] instead.`:`Expected an array, but found `+typeof e+` instead.`)},Yt.prototype.concat=function(e,t,n){var r=typeof e==`number`?this.path.concat(e):this.path,i=n?this.scope.concat(n):this.scope;return new Yt(this.registry,r,t||null,i,this.errors)},Yt.prototype.error=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=``+this.key+t.map((function(e){return`[`+e+`]`})).join(``);this.errors.push(new Ue(r,e))},Yt.prototype.checkSubtype=function(e,t){var n=it(e,t);return n&&this.error(n),n};var Zt=function(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var r=0,i=n;r<i.length;r+=1){var a=i[r],o=a[1];this.labels.push(a[0]),this.outputs.push(o)}};function Qt(e,t,n){return e*(1-n)+t*n}Zt.parse=function(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only `+(e.length-1)+`.`);if((e.length-1)%2!=0)return t.error(`Expected an even number of arguments.`);var n=t.parse(e[1],1,Ke);if(!n)return null;var r=[],i=null;t.expectedType&&t.expectedType.kind!==`value`&&(i=t.expectedType);for(var a=1;a<e.length;a+=2){var o=a===1?-1/0:e[a],s=e[a+1],c=a,l=a+1;if(typeof o!=`number`)return t.error(`Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.`,c);if(r.length&&r[r.length-1][0]>=o)return t.error(`Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.`,c);var u=t.parse(s,l,i);if(!u)return null;i||=u.type,r.push([o,u])}return new Zt(i,n,r)},Zt.prototype.evaluate=function(e){var t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);var r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);var i=t.length;return r>=t[i-1]?n[i-1].evaluate(e):n[Xt(t,r)].evaluate(e)},Zt.prototype.eachChild=function(e){e(this.input);for(var t=0,n=this.outputs;t<n.length;t+=1)e(n[t])},Zt.prototype.outputDefined=function(){return this.outputs.every((function(e){return e.outputDefined()}))},Zt.prototype.serialize=function(){for(var e=[`step`,this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var $t=Object.freeze({__proto__:null,number:Qt,color:function(e,t,n){return new ct(Qt(e.r,t.r,n),Qt(e.g,t.g,n),Qt(e.b,t.b,n),Qt(e.a,t.a,n))},array:function(e,t,n){return e.map((function(e,r){return Qt(e,t[r],n)}))}}),en=6/29*3*(6/29),tn=Math.PI/180,nn=180/Math.PI;function rn(e){return e>.008856451679035631?e**(1/3):e/en+4/29}function an(e){return e>6/29?e*e*e:en*(e-4/29)}function on(e){return 255*(e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055)}function sn(e){return(e/=255)<=.04045?e/12.92:((e+.055)/1.055)**2.4}function cn(e){var t=sn(e.r),n=sn(e.g),r=sn(e.b),i=rn((.4124564*t+.3575761*n+.1804375*r)/.95047),a=rn((.2126729*t+.7151522*n+.072175*r)/1);return{l:116*a-16,a:500*(i-a),b:200*(a-rn((.0193339*t+.119192*n+.9503041*r)/1.08883)),alpha:e.a}}function ln(e){var t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*an(t),n=.95047*an(n),r=1.08883*an(r),new ct(on(3.2404542*n-1.5371385*t-.4985314*r),on(-.969266*n+1.8760108*t+.041556*r),on(.0556434*n-.2040259*t+1.0572252*r),e.alpha)}function un(e,t,n){var r=t-e;return e+n*(r>180||r<-180?r-360*Math.round(r/360):r)}var dn={forward:cn,reverse:ln,interpolate:function(e,t,n){return{l:Qt(e.l,t.l,n),a:Qt(e.a,t.a,n),b:Qt(e.b,t.b,n),alpha:Qt(e.alpha,t.alpha,n)}}},fn={forward:function(e){var t=cn(e),n=t.l,r=t.a,i=t.b,a=Math.atan2(i,r)*nn;return{h:a<0?a+360:a,c:Math.sqrt(r*r+i*i),l:n,alpha:e.a}},reverse:function(e){var t=e.h*tn,n=e.c;return ln({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:un(e.h,t.h,n),c:Qt(e.c,t.c,n),l:Qt(e.l,t.l,n),alpha:Qt(e.alpha,t.alpha,n)}}},pn=Object.freeze({__proto__:null,lab:dn,hcl:fn}),mn=function(e,t,n,r,i){this.type=e,this.operator=t,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(var a=0,o=i;a<o.length;a+=1){var s=o[a],c=s[1];this.labels.push(s[0]),this.outputs.push(c)}};function hn(e,t,n,r){var i=r-n,a=e-n;return i===0?0:t===1?a/i:(t**+a-1)/(t**+i-1)}mn.interpolationFactor=function(e,t,r,i){var a=0;if(e.name===`exponential`)a=hn(t,e.base,r,i);else if(e.name===`linear`)a=hn(t,1,r,i);else if(e.name===`cubic-bezier`){var o=e.controlPoints;a=new n(o[0],o[1],o[2],o[3]).solve(hn(t,1,r,i))}return a},mn.parse=function(e,t){var n=e[0],r=e[1],i=e[2],a=e.slice(3);if(!Array.isArray(r)||r.length===0)return t.error(`Expected an interpolation type expression.`,1);if(r[0]===`linear`)r={name:`linear`};else if(r[0]===`exponential`){var o=r[1];if(typeof o!=`number`)return t.error(`Exponential interpolation requires a numeric base.`,1,1);r={name:`exponential`,base:o}}else{if(r[0]!==`cubic-bezier`)return t.error(`Unknown interpolation type `+String(r[0]),1,0);var s=r.slice(1);if(s.length!==4||s.some((function(e){return typeof e!=`number`||e<0||e>1})))return t.error(`Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.`,1);r={name:`cubic-bezier`,controlPoints:s}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only `+(e.length-1)+`.`);if((e.length-1)%2!=0)return t.error(`Expected an even number of arguments.`);if(!(i=t.parse(i,2,Ke)))return null;var c=[],l=null;n===`interpolate-hcl`||n===`interpolate-lab`?l=Ye:t.expectedType&&t.expectedType.kind!==`value`&&(l=t.expectedType);for(var u=0;u<a.length;u+=2){var d=a[u],f=a[u+1],p=u+3,m=u+4;if(typeof d!=`number`)return t.error(`Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.`,p);if(c.length&&c[c.length-1][0]>=d)return t.error(`Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.`,p);var h=t.parse(f,m,l);if(!h)return null;l||=h.type,c.push([d,h])}return l.kind===`number`||l.kind===`color`||l.kind===`array`&&l.itemType.kind===`number`&&typeof l.N==`number`?new mn(l,n,r,i,c):t.error(`Type `+nt(l)+` is not interpolatable.`)},mn.prototype.evaluate=function(e){var t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);var r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);var i=t.length;if(r>=t[i-1])return n[i-1].evaluate(e);var a=Xt(t,r),o=mn.interpolationFactor(this.interpolation,r,t[a],t[a+1]),s=n[a].evaluate(e),c=n[a+1].evaluate(e);return this.operator===`interpolate`?$t[this.type.kind.toLowerCase()](s,c,o):this.operator===`interpolate-hcl`?fn.reverse(fn.interpolate(fn.forward(s),fn.forward(c),o)):dn.reverse(dn.interpolate(dn.forward(s),dn.forward(c),o))},mn.prototype.eachChild=function(e){e(this.input);for(var t=0,n=this.outputs;t<n.length;t+=1)e(n[t])},mn.prototype.outputDefined=function(){return this.outputs.every((function(e){return e.outputDefined()}))},mn.prototype.serialize=function(){for(var e=this.interpolation.name===`linear`?[`linear`]:this.interpolation.name===`exponential`?this.interpolation.base===1?[`linear`]:[`exponential`,this.interpolation.base]:[`cubic-bezier`].concat(this.interpolation.controlPoints),t=[this.operator,e,this.input.serialize()],n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t};var gn=function(e,t){this.type=e,this.args=t};gn.parse=function(e,t){if(e.length<2)return t.error(`Expectected at least one argument.`);var n=null,r=t.expectedType;r&&r.kind!==`value`&&(n=r);for(var i=[],a=0,o=e.slice(1);a<o.length;a+=1){var s=t.parse(o[a],1+i.length,n,void 0,{typeAnnotation:`omit`});if(!s)return null;n||=s.type,i.push(s)}return new gn(r&&i.some((function(e){return it(r,e.type)}))?Ze:n,i)},gn.prototype.evaluate=function(e){for(var t,n=null,r=0,i=0,a=this.args;i<a.length&&(r++,(n=a[i].evaluate(e))&&n instanceof ft&&!n.available&&(t||=n.name,n=null,r===this.args.length&&(n=t)),n===null);i+=1);return n},gn.prototype.eachChild=function(e){this.args.forEach(e)},gn.prototype.outputDefined=function(){return this.args.every((function(e){return e.outputDefined()}))},gn.prototype.serialize=function(){var e=[`coalesce`];return this.eachChild((function(t){e.push(t.serialize())})),e};var _n=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};_n.prototype.evaluate=function(e){return this.result.evaluate(e)},_n.prototype.eachChild=function(e){for(var t=0,n=this.bindings;t<n.length;t+=1)e(n[t][1]);e(this.result)},_n.parse=function(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found `+(e.length-1)+` instead.`);for(var n=[],r=1;r<e.length-1;r+=2){var i=e[r];if(typeof i!=`string`)return t.error(`Expected string, but found `+typeof i+` instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return t.error(`Variable names must contain only alphanumeric characters or '_'.`,r);var a=t.parse(e[r+1],r+1);if(!a)return null;n.push([i,a])}var o=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return o?new _n(n,o):null},_n.prototype.outputDefined=function(){return this.result.outputDefined()},_n.prototype.serialize=function(){for(var e=[`let`],t=0,n=this.bindings;t<n.length;t+=1){var r=n[t];e.push(r[0],r[1].serialize())}return e.push(this.result.serialize()),e};var vn=function(e,t,n){this.type=e,this.index=t,this.input=n};vn.parse=function(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found `+(e.length-1)+` instead.`);var n=t.parse(e[1],1,Ke),r=t.parse(e[2],2,tt(t.expectedType||Ze));return n&&r?new vn(r.type.itemType,n,r):null},vn.prototype.evaluate=function(e){var t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new vt(`Array index out of bounds: `+t+` < 0.`);if(t>=n.length)throw new vt(`Array index out of bounds: `+t+` > `+(n.length-1)+`.`);if(t!==Math.floor(t))throw new vt(`Array index must be an integer, but found `+t+` instead.`);return n[t]},vn.prototype.eachChild=function(e){e(this.index),e(this.input)},vn.prototype.outputDefined=function(){return!1},vn.prototype.serialize=function(){return[`at`,this.index.serialize(),this.input.serialize()]};var yn=function(e,t){this.type=Je,this.needle=e,this.haystack=t};yn.parse=function(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found `+(e.length-1)+` instead.`);var n=t.parse(e[1],1,Ze),r=t.parse(e[2],2,Ze);return n&&r?at(n.type,[Je,qe,Ke,Ge,Ze])?new yn(n,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found `+nt(n.type)+` instead`):null},yn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!ot(t,[`boolean`,`string`,`number`,`null`]))throw new vt(`Expected first argument to be of type boolean, string, number or null, but found `+nt(ht(t))+` instead.`);if(!ot(n,[`string`,`array`]))throw new vt(`Expected second argument to be of type array or string, but found `+nt(ht(n))+` instead.`);return n.indexOf(t)>=0},yn.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},yn.prototype.outputDefined=function(){return!0},yn.prototype.serialize=function(){return[`in`,this.needle.serialize(),this.haystack.serialize()]};var bn=function(e,t,n){this.type=Ke,this.needle=e,this.haystack=t,this.fromIndex=n};bn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found `+(e.length-1)+` instead.`);var n=t.parse(e[1],1,Ze),r=t.parse(e[2],2,Ze);if(!n||!r)return null;if(!at(n.type,[Je,qe,Ke,Ge,Ze]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found `+nt(n.type)+` instead`);if(e.length===4){var i=t.parse(e[3],3,Ke);return i?new bn(n,r,i):null}return new bn(n,r)},bn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!ot(t,[`boolean`,`string`,`number`,`null`]))throw new vt(`Expected first argument to be of type boolean, string, number or null, but found `+nt(ht(t))+` instead.`);if(!ot(n,[`string`,`array`]))throw new vt(`Expected second argument to be of type array or string, but found `+nt(ht(n))+` instead.`);if(this.fromIndex){var r=this.fromIndex.evaluate(e);return n.indexOf(t,r)}return n.indexOf(t)},bn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},bn.prototype.outputDefined=function(){return!1},bn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return[`index-of`,this.needle.serialize(),this.haystack.serialize(),e]}return[`index-of`,this.needle.serialize(),this.haystack.serialize()]};var xn=function(e,t,n,r,i,a){this.inputType=e,this.type=t,this.input=n,this.cases=r,this.outputs=i,this.otherwise=a};xn.parse=function(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only `+(e.length-1)+`.`);if(e.length%2!=1)return t.error(`Expected an even number of arguments.`);var n,r;t.expectedType&&t.expectedType.kind!==`value`&&(r=t.expectedType);for(var i={},a=[],o=2;o<e.length-1;o+=2){var s=e[o],c=e[o+1];Array.isArray(s)||(s=[s]);var l=t.concat(o);if(s.length===0)return l.error(`Expected at least one branch label.`);for(var u=0,d=s;u<d.length;u+=1){var f=d[u];if(typeof f!=`number`&&typeof f!=`string`)return l.error(`Branch labels must be numbers or strings.`);if(typeof f==`number`&&Math.abs(f)>2**53-1)return l.error(`Branch labels must be integers no larger than `+(2**53-1)+`.`);if(typeof f==`number`&&Math.floor(f)!==f)return l.error(`Numeric branch labels must be integer values.`);if(n){if(l.checkSubtype(n,ht(f)))return null}else n=ht(f);if(i[String(f)]!==void 0)return l.error(`Branch labels must be unique.`);i[String(f)]=a.length}var p=t.parse(c,o,r);if(!p)return null;r||=p.type,a.push(p)}var m=t.parse(e[1],1,Ze);if(!m)return null;var h=t.parse(e[e.length-1],e.length-1,r);return h?m.type.kind!==`value`&&t.concat(1).checkSubtype(n,m.type)?null:new xn(n,r,m,i,a,h):null},xn.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(ht(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},xn.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},xn.prototype.outputDefined=function(){return this.outputs.every((function(e){return e.outputDefined()}))&&this.otherwise.outputDefined()},xn.prototype.serialize=function(){for(var e=this,t=[`match`,this.input.serialize()],n=[],r={},i=0,a=Object.keys(this.cases).sort();i<a.length;i+=1){var o=a[i];(d=r[this.cases[o]])===void 0?(r[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[d][1].push(o)}for(var s=function(t){return e.inputType.kind===`number`?Number(t):t},c=0,l=n;c<l.length;c+=1){var u=l[c],d=u[0],f=u[1];t.push(f.length===1?s(f[0]):f.map(s)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var Sn=function(e,t,n){this.type=e,this.branches=t,this.otherwise=n};Sn.parse=function(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only `+(e.length-1)+`.`);if(e.length%2!=0)return t.error(`Expected an odd number of arguments.`);var n;t.expectedType&&t.expectedType.kind!==`value`&&(n=t.expectedType);for(var r=[],i=1;i<e.length-1;i+=2){var a=t.parse(e[i],i,Je);if(!a)return null;var o=t.parse(e[i+1],i+1,n);if(!o)return null;r.push([a,o]),n||=o.type}var s=t.parse(e[e.length-1],e.length-1,n);return s?new Sn(n,r,s):null},Sn.prototype.evaluate=function(e){for(var t=0,n=this.branches;t<n.length;t+=1){var r=n[t],i=r[1];if(r[0].evaluate(e))return i.evaluate(e)}return this.otherwise.evaluate(e)},Sn.prototype.eachChild=function(e){for(var t=0,n=this.branches;t<n.length;t+=1){var r=n[t],i=r[1];e(r[0]),e(i)}e(this.otherwise)},Sn.prototype.outputDefined=function(){return this.branches.every((function(e){return e[1].outputDefined()}))&&this.otherwise.outputDefined()},Sn.prototype.serialize=function(){var e=[`case`];return this.eachChild((function(t){e.push(t.serialize())})),e};var Cn=function(e,t,n,r){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=r};function wn(e,t){return e===`==`||e===`!=`?t.kind===`boolean`||t.kind===`string`||t.kind===`number`||t.kind===`null`||t.kind===`value`:t.kind===`string`||t.kind===`number`||t.kind===`value`}function Tn(e,t,n,r){return r.compare(t,n)===0}function En(e,t,n){var r=e!==`==`&&e!==`!=`;return function(){function i(e,t,n){this.type=Je,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument=e.type.kind===`value`||t.type.kind===`value`}return i.parse=function(e,t){if(e.length!==3&&e.length!==4)return t.error(`Expected two or three arguments.`);var n=e[0],a=t.parse(e[1],1,Ze);if(!a)return null;if(!wn(n,a.type))return t.concat(1).error(`"`+n+`" comparisons are not supported for type '`+nt(a.type)+`'.`);var o=t.parse(e[2],2,Ze);if(!o)return null;if(!wn(n,o.type))return t.concat(2).error(`"`+n+`" comparisons are not supported for type '`+nt(o.type)+`'.`);if(a.type.kind!==o.type.kind&&a.type.kind!==`value`&&o.type.kind!==`value`)return t.error(`Cannot compare types '`+nt(a.type)+`' and '`+nt(o.type)+`'.`);r&&(a.type.kind===`value`&&o.type.kind!==`value`?a=new bt(o.type,[a]):a.type.kind!==`value`&&o.type.kind===`value`&&(o=new bt(a.type,[o])));var s=null;if(e.length===4){if(a.type.kind!==`string`&&o.type.kind!==`string`&&a.type.kind!==`value`&&o.type.kind!==`value`)return t.error(`Cannot use collator to compare non-string types.`);if(!(s=t.parse(e[3],3,Qe)))return null}return new i(a,o,s)},i.prototype.evaluate=function(i){var a=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){var s=ht(a),c=ht(o);if(s.kind!==c.kind||s.kind!==`string`&&s.kind!==`number`)throw new vt(`Expected arguments for "`+e+`" to be (string, string) or (number, number), but found (`+s.kind+`, `+c.kind+`) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){var l=ht(a),u=ht(o);if(l.kind!==`string`||u.kind!==`string`)return t(i,a,o)}return this.collator?n(i,a,o,this.collator.evaluate(i)):t(i,a,o)},i.prototype.eachChild=function(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var t=[e];return this.eachChild((function(e){t.push(e.serialize())})),t},i}()}Cn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found `+(e.length-1)+` instead.`);var n=t.parse(e[1],1,Ze),r=t.parse(e[2],2,Ke);if(!n||!r)return null;if(!at(n.type,[tt(Ze),qe,Ze]))return t.error(`Expected first argument to be of type array or string, but found `+nt(n.type)+` instead`);if(e.length===4){var i=t.parse(e[3],3,Ke);return i?new Cn(n.type,n,r,i):null}return new Cn(n.type,n,r)},Cn.prototype.evaluate=function(e){var t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!ot(t,[`string`,`array`]))throw new vt(`Expected first argument to be of type array or string, but found `+nt(ht(t))+` instead.`);if(this.endIndex){var r=this.endIndex.evaluate(e);return t.slice(n,r)}return t.slice(n)},Cn.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},Cn.prototype.outputDefined=function(){return!1},Cn.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return[`slice`,this.input.serialize(),this.beginIndex.serialize(),e]}return[`slice`,this.input.serialize(),this.beginIndex.serialize()]};var Dn=En(`==`,(function(e,t,n){return t===n}),Tn),On=En(`!=`,(function(e,t,n){return t!==n}),(function(e,t,n,r){return!Tn(0,t,n,r)})),kn=En(`<`,(function(e,t,n){return t<n}),(function(e,t,n,r){return r.compare(t,n)<0})),An=En(`>`,(function(e,t,n){return t>n}),(function(e,t,n,r){return r.compare(t,n)>0})),jn=En(`<=`,(function(e,t,n){return t<=n}),(function(e,t,n,r){return r.compare(t,n)<=0})),Mn=En(`>=`,(function(e,t,n){return t>=n}),(function(e,t,n,r){return r.compare(t,n)>=0})),Nn=function(e,t,n,r,i){this.type=qe,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i};Nn.parse=function(e,t){if(e.length!==3)return t.error(`Expected two arguments.`);var n=t.parse(e[1],1,Ke);if(!n)return null;var r=e[2];if(typeof r!=`object`||Array.isArray(r))return t.error(`NumberFormat options argument must be an object.`);var i=null;if(r.locale&&!(i=t.parse(r.locale,1,qe)))return null;var a=null;if(r.currency&&!(a=t.parse(r.currency,1,qe)))return null;var o=null;if(r[`min-fraction-digits`]&&!(o=t.parse(r[`min-fraction-digits`],1,Ke)))return null;var s=null;return r[`max-fraction-digits`]&&!(s=t.parse(r[`max-fraction-digits`],1,Ke))?null:new Nn(n,i,a,o,s)},Nn.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?`currency`:`decimal`,currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Nn.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Nn.prototype.outputDefined=function(){return!1},Nn.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e[`min-fraction-digits`]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e[`max-fraction-digits`]=this.maxFractionDigits.serialize()),[`number-format`,this.number.serialize(),e]};var Pn=function(e){this.type=Ke,this.input=e};Pn.parse=function(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found `+(e.length-1)+` instead.`);var n=t.parse(e[1],1);return n?n.type.kind!==`array`&&n.type.kind!==`string`&&n.type.kind!==`value`?t.error(`Expected argument of type string or array, but found `+nt(n.type)+` instead.`):new Pn(n):null},Pn.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t==`string`||Array.isArray(t))return t.length;throw new vt(`Expected value to be of type string or array, but found `+nt(ht(t))+` instead.`)},Pn.prototype.eachChild=function(e){e(this.input)},Pn.prototype.outputDefined=function(){return!1},Pn.prototype.serialize=function(){var e=[`length`];return this.eachChild((function(t){e.push(t.serialize())})),e};var Fn={"==":Dn,"!=":On,">":An,"<":kn,">=":Mn,"<=":jn,array:bt,at:vn,boolean:bt,case:Sn,coalesce:gn,collator:Ot,format:xt,image:St,in:yn,"index-of":bn,interpolate:mn,"interpolate-hcl":mn,"interpolate-lab":mn,length:Pn,let:_n,literal:_t,match:xn,number:bt,"number-format":Nn,object:bt,slice:Cn,step:Zt,string:bt,"to-boolean":wt,"to-color":wt,"to-number":wt,"to-string":wt,var:Jt,within:Wt};function In(e,t){var n=t[0],r=t[1],i=t[2],a=t[3];n=n.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);var o=a?a.evaluate(e):1,s=pt(n,r,i,o);if(s)throw new vt(s);return new ct(n/255*o,r/255*o,i/255*o,o)}function Ln(e,t){return e in t}function Rn(e,t){var n=t[e];return n===void 0?null:n}function zn(e){return{type:e}}function Bn(e){return{result:`success`,value:e}}function Vn(e){return{result:`error`,value:e}}function Hn(e){return e[`property-type`]===`data-driven`||e[`property-type`]===`cross-faded-data-driven`}function Un(e){return!!e.expression&&e.expression.parameters.indexOf(`zoom`)>-1}function Wn(e){return!!e.expression&&e.expression.interpolated}function Gn(e){return e instanceof Number?`number`:e instanceof String?`string`:e instanceof Boolean?`boolean`:Array.isArray(e)?`array`:e===null?`null`:typeof e}function Kn(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}function qn(e){return e}function Jn(e,t,n){return e===void 0?t===void 0?n===void 0?void 0:n:t:e}function Yn(e,t,n,r,i){return Jn(typeof n===i?r[n]:void 0,e.default,t.default)}function Xn(e,t,n){if(Gn(n)!==`number`)return Jn(e.default,t.default);var r=e.stops.length;if(r===1||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];var i=Xt(e.stops.map((function(e){return e[0]})),n);return e.stops[i][1]}function Zn(e,t,n){var r=e.base===void 0?1:e.base;if(Gn(n)!==`number`)return Jn(e.default,t.default);var i=e.stops.length;if(i===1||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];var a=Xt(e.stops.map((function(e){return e[0]})),n),o=function(e,t,n,r){var i=r-n,a=e-n;return i===0?0:t===1?a/i:(t**+a-1)/(t**+i-1)}(n,r,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],c=e.stops[a+1][1],l=$t[t.type]||qn;if(e.colorSpace&&e.colorSpace!==`rgb`){var u=pn[e.colorSpace];l=function(e,t){return u.reverse(u.interpolate(u.forward(e),u.forward(t),o))}}return typeof s.evaluate==`function`?{evaluate:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var n=s.evaluate.apply(void 0,e),r=c.evaluate.apply(void 0,e);if(n!==void 0&&r!==void 0)return l(n,r,o)}}:l(s,c,o)}function Qn(e,t,n){return t.type===`color`?n=ct.parse(n):t.type===`formatted`?n=dt.fromString(n.toString()):t.type===`resolvedImage`?n=ft.fromString(n.toString()):Gn(n)===t.type||t.type===`enum`&&t.values[n]||(n=void 0),Jn(n,e.default,t.default)}Dt.register(Fn,{error:[{kind:`error`},[qe],function(e,t){throw new vt(t[0].evaluate(e))}],typeof:[qe,[Ze],function(e,t){return nt(ht(t[0].evaluate(e)))}],"to-rgba":[tt(Ke,4),[Ye],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[Ye,[Ke,Ke,Ke],In],rgba:[Ye,[Ke,Ke,Ke,Ke],In],has:{type:Je,overloads:[[[qe],function(e,t){return Ln(t[0].evaluate(e),e.properties())}],[[qe,Xe],function(e,t){var n=t[1];return Ln(t[0].evaluate(e),n.evaluate(e))}]]},get:{type:Ze,overloads:[[[qe],function(e,t){return Rn(t[0].evaluate(e),e.properties())}],[[qe,Xe],function(e,t){var n=t[1];return Rn(t[0].evaluate(e),n.evaluate(e))}]]},"feature-state":[Ze,[qe],function(e,t){return Rn(t[0].evaluate(e),e.featureState||{})}],properties:[Xe,[],function(e){return e.properties()}],"geometry-type":[qe,[],function(e){return e.geometryType()}],id:[Ze,[],function(e){return e.id()}],zoom:[Ke,[],function(e){return e.globals.zoom}],"heatmap-density":[Ke,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[Ke,[],function(e){return e.globals.lineProgress||0}],accumulated:[Ze,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[Ke,zn(Ke),function(e,t){for(var n=0,r=0,i=t;r<i.length;r+=1)n+=i[r].evaluate(e);return n}],"*":[Ke,zn(Ke),function(e,t){for(var n=1,r=0,i=t;r<i.length;r+=1)n*=i[r].evaluate(e);return n}],"-":{type:Ke,overloads:[[[Ke,Ke],function(e,t){var n=t[1];return t[0].evaluate(e)-n.evaluate(e)}],[[Ke],function(e,t){return-t[0].evaluate(e)}]]},"/":[Ke,[Ke,Ke],function(e,t){var n=t[1];return t[0].evaluate(e)/n.evaluate(e)}],"%":[Ke,[Ke,Ke],function(e,t){var n=t[1];return t[0].evaluate(e)%n.evaluate(e)}],ln2:[Ke,[],function(){return Math.LN2}],pi:[Ke,[],function(){return Math.PI}],e:[Ke,[],function(){return Math.E}],"^":[Ke,[Ke,Ke],function(e,t){var n=t[1];return t[0].evaluate(e)**+n.evaluate(e)}],sqrt:[Ke,[Ke],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[Ke,[Ke],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[Ke,[Ke],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[Ke,[Ke],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[Ke,[Ke],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[Ke,[Ke],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[Ke,[Ke],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[Ke,[Ke],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[Ke,[Ke],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[Ke,[Ke],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[Ke,zn(Ke),function(e,t){return Math.min.apply(Math,t.map((function(t){return t.evaluate(e)})))}],max:[Ke,zn(Ke),function(e,t){return Math.max.apply(Math,t.map((function(t){return t.evaluate(e)})))}],abs:[Ke,[Ke],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[Ke,[Ke],function(e,t){var n=t[0].evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ke,[Ke],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[Ke,[Ke],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[Je,[qe,Ze],function(e,t){var n=t[0],r=t[1];return e.properties()[n.value]===r.value}],"filter-id-==":[Je,[Ze],function(e,t){var n=t[0];return e.id()===n.value}],"filter-type-==":[Je,[qe],function(e,t){var n=t[0];return e.geometryType()===n.value}],"filter-<":[Je,[qe,Ze],function(e,t){var n=t[0],r=t[1],i=e.properties()[n.value],a=r.value;return typeof i==typeof a&&i<a}],"filter-id-<":[Je,[Ze],function(e,t){var n=t[0],r=e.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[Je,[qe,Ze],function(e,t){var n=t[0],r=t[1],i=e.properties()[n.value],a=r.value;return typeof i==typeof a&&i>a}],"filter-id->":[Je,[Ze],function(e,t){var n=t[0],r=e.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[Je,[qe,Ze],function(e,t){var n=t[0],r=t[1],i=e.properties()[n.value],a=r.value;return typeof i==typeof a&&i<=a}],"filter-id-<=":[Je,[Ze],function(e,t){var n=t[0],r=e.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[Je,[qe,Ze],function(e,t){var n=t[0],r=t[1],i=e.properties()[n.value],a=r.value;return typeof i==typeof a&&i>=a}],"filter-id->=":[Je,[Ze],function(e,t){var n=t[0],r=e.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[Je,[Ze],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[Je,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[Je,[tt(qe)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[Je,[tt(Ze)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[Je,[qe,tt(Ze)],function(e,t){var n=t[0];return t[1].value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[Je,[qe,tt(Ze)],function(e,t){var n=t[0],r=t[1];return function(e,t,n,r){for(;n<=r;){var i=n+r>>1;if(t[i]===e)return!0;t[i]>e?r=i-1:n=i+1}return!1}(e.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:Je,overloads:[[[Je,Je],function(e,t){var n=t[1];return t[0].evaluate(e)&&n.evaluate(e)}],[zn(Je),function(e,t){for(var n=0,r=t;n<r.length;n+=1)if(!r[n].evaluate(e))return!1;return!0}]]},any:{type:Je,overloads:[[[Je,Je],function(e,t){var n=t[1];return t[0].evaluate(e)||n.evaluate(e)}],[zn(Je),function(e,t){for(var n=0,r=t;n<r.length;n+=1)if(r[n].evaluate(e))return!0;return!1}]]},"!":[Je,[Je],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[Je,[qe],function(e,t){var n=e.globals&&e.globals.isSupportedScript;return!n||n(t[0].evaluate(e))}],upcase:[qe,[qe],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[qe,[qe],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[qe,zn(Ze),function(e,t){return t.map((function(t){return gt(t.evaluate(e))})).join(``)}],"resolved-locale":[qe,[Qe],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var $n=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Et,this._defaultValue=t?function(e){return e.type===`color`&&Kn(e.default)?new ct(0,0,0,0):e.type===`color`?ct.parse(e.default)||null:e.default===void 0?null:e.default}(t):null,this._enumValues=t&&t.type===`enum`?t.values:null};function er(e){return Array.isArray(e)&&e.length>0&&typeof e[0]==`string`&&e[0]in Fn}function tr(e,t){var n=new Yt(Fn,[],t?function(e){var t={color:Ye,string:qe,number:Ke,enum:qe,boolean:Je,formatted:$e,resolvedImage:et};return e.type===`array`?tt(t[e.value]||Ze,e.length):t[e.type]}(t):void 0),r=n.parse(e,void 0,void 0,void 0,t&&t.type===`string`?{typeAnnotation:`coerce`}:void 0);return r?Bn(new $n(r,t)):Vn(n.errors)}$n.prototype.evaluateWithoutErrorHandling=function(e,t,n,r,i,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)},$n.prototype.evaluate=function(e,t,n,r,i,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a||null;try{var o=this.expression.evaluate(this._evaluator);if(o==null||typeof o==`number`&&o!=o)return this._defaultValue;if(this._enumValues&&!(o in this._enumValues))throw new vt(`Expected value to be one of `+Object.keys(this._enumValues).map((function(e){return JSON.stringify(e)})).join(`, `)+`, but found `+JSON.stringify(o)+` instead.`);return o}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,typeof console<`u`&&console.warn(e.message)),this._defaultValue}};var nr=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!==`constant`&&!Kt(t.expression)};nr.prototype.evaluateWithoutErrorHandling=function(e,t,n,r,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,a)},nr.prototype.evaluate=function(e,t,n,r,i,a){return this._styleExpression.evaluate(e,t,n,r,i,a)};var rr=function(e,t,n,r){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!==`camera`&&!Kt(t.expression),this.interpolationType=r};function ir(e,t){if((e=tr(e,t)).result===`error`)return e;var n=e.value.expression,r=Gt(n);if(!r&&!Hn(t))return Vn([new Ue(``,`data expressions not supported`)]);var i=qt(n,[`zoom`]);if(!i&&!Un(t))return Vn([new Ue(``,`zoom expressions not supported`)]);var a=function e(t){var n=null;if(t instanceof _n)n=e(t.result);else if(t instanceof gn)for(var r=0,i=t.args;r<i.length&&!(n=e(i[r]));r+=1);else (t instanceof Zt||t instanceof mn)&&t.input instanceof Dt&&t.input.name===`zoom`&&(n=t);return n instanceof Ue||t.eachChild((function(t){var r=e(t);r instanceof Ue?n=r:!n&&r?n=new Ue(``,`"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.`):n&&r&&n!==r&&(n=new Ue(``,`Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.`))})),n}(n);return a||i?a instanceof Ue?Vn([a]):a instanceof mn&&!Wn(t)?Vn([new Ue(``,`"interpolate" expressions cannot be used with this property`)]):Bn(a?new rr(r?`camera`:`composite`,e.value,a.labels,a instanceof mn?a.interpolation:void 0):new nr(r?`constant`:`source`,e.value)):Vn([new Ue(``,`"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.`)])}rr.prototype.evaluateWithoutErrorHandling=function(e,t,n,r,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,a)},rr.prototype.evaluate=function(e,t,n,r,i,a){return this._styleExpression.evaluate(e,t,n,r,i,a)},rr.prototype.interpolationFactor=function(e,t,n){return this.interpolationType?mn.interpolationFactor(this.interpolationType,e,t,n):0};var ar=function(e,t){this._parameters=e,this._specification=t,Be(this,function e(t,n){var r,i,a,o=n.type===`color`,s=t.stops&&typeof t.stops[0][0]==`object`,c=s||!(s||t.property!==void 0),l=t.type||(Wn(n)?`exponential`:`interval`);if(o&&((t=Be({},t)).stops&&(t.stops=t.stops.map((function(e){return[e[0],ct.parse(e[1])]}))),t.default=ct.parse(t.default?t.default:n.default)),t.colorSpace&&t.colorSpace!==`rgb`&&!pn[t.colorSpace])throw Error(`Unknown color space: `+t.colorSpace);if(l===`exponential`)r=Zn;else if(l===`interval`)r=Xn;else if(l===`categorical`){r=Yn,i=Object.create(null);for(var u=0,d=t.stops;u<d.length;u+=1){var f=d[u];i[f[0]]=f[1]}a=typeof t.stops[0][0]}else{if(l!==`identity`)throw Error(`Unknown function type "`+l+`"`);r=Qn}if(s){for(var p={},m=[],h=0;h<t.stops.length;h++){var g=t.stops[h],_=g[0].zoom;p[_]===void 0&&(p[_]={zoom:_,type:t.type,property:t.property,default:t.default,stops:[]},m.push(_)),p[_].stops.push([g[0].value,g[1]])}for(var v=[],y=0,b=m;y<b.length;y+=1){var x=b[y];v.push([p[x].zoom,e(p[x],n)])}var S={name:`linear`};return{kind:`composite`,interpolationType:S,interpolationFactor:mn.interpolationFactor.bind(void 0,S),zoomStops:v.map((function(e){return e[0]})),evaluate:function(e,r){var i=e.zoom;return Zn({stops:v,base:t.base},n,i).evaluate(i,r)}}}if(c){var C=l===`exponential`?{name:`exponential`,base:t.base===void 0?1:t.base}:null;return{kind:`camera`,interpolationType:C,interpolationFactor:mn.interpolationFactor.bind(void 0,C),zoomStops:t.stops.map((function(e){return e[0]})),evaluate:function(e){return r(t,n,e.zoom,i,a)}}}return{kind:`source`,evaluate:function(e,o){var s=o&&o.properties?o.properties[t.property]:void 0;return s===void 0?Jn(t.default,n.default):r(t,n,s,i,a)}}}(this._parameters,this._specification))};function or(e){var t=e.key,n=e.value,r=e.valueSpec||{},i=e.objectElementValidators||{},a=e.style,o=e.styleSpec,s=[],c=Gn(n);if(c!==`object`)return[new Re(t,n,`object expected, `+c+` found`)];for(var l in n){var u=l.split(`.`)[0],d=r[u]||r[`*`],f=void 0;if(i[u])f=i[u];else if(r[u])f=jr;else if(i[`*`])f=i[`*`];else{if(!r[`*`]){s.push(new Re(t,n[l],`unknown property "`+l+`"`));continue}f=jr}s=s.concat(f({key:(t&&t+`.`)+l,value:n[l],valueSpec:d,style:a,styleSpec:o,object:n,objectKey:l},n))}for(var p in r)i[p]||r[p].required&&r[p].default===void 0&&n[p]===void 0&&s.push(new Re(t,n,`missing required property "`+p+`"`));return s}function sr(e){var t=e.value,n=e.valueSpec,r=e.style,i=e.styleSpec,a=e.key,o=e.arrayElementValidator||jr;if(Gn(t)!==`array`)return[new Re(a,t,`array expected, `+Gn(t)+` found`)];if(n.length&&t.length!==n.length)return[new Re(a,t,`array length `+n.length+` expected, length `+t.length+` found`)];if(n[`min-length`]&&t.length<n[`min-length`])return[new Re(a,t,`array length at least `+n[`min-length`]+` expected, length `+t.length+` found`)];var s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),Gn(n.value)===`object`&&(s=n.value);for(var c=[],l=0;l<t.length;l++)c=c.concat(o({array:t,arrayIndex:l,value:t[l],valueSpec:s,style:r,styleSpec:i,key:a+`[`+l+`]`}));return c}function cr(e){var t=e.key,n=e.value,r=e.valueSpec,i=Gn(n);return i===`number`&&n!=n&&(i=`NaN`),i===`number`?`minimum`in r&&n<r.minimum?[new Re(t,n,n+` is less than the minimum value `+r.minimum)]:`maximum`in r&&n>r.maximum?[new Re(t,n,n+` is greater than the maximum value `+r.maximum)]:[]:[new Re(t,n,`number expected, `+i+` found`)]}function lr(e){var t,n,r,i=e.valueSpec,a=Ve(e.value.type),o={},s=a!==`categorical`&&e.value.property===void 0,c=!s,l=Gn(e.value.stops)===`array`&&Gn(e.value.stops[0])===`array`&&Gn(e.value.stops[0][0])===`object`,u=or({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if(a===`identity`)return[new Re(e.key,e.value,`identity function may not have a "stops" property`)];var t=[],n=e.value;return t=t.concat(sr({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:d})),Gn(n)===`array`&&n.length===0&&t.push(new Re(e.key,n,`array must have at least one stop`)),t},default:function(e){return jr({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return a===`identity`&&s&&u.push(new Re(e.key,e.value,`missing required property "property"`)),a===`identity`||e.value.stops||u.push(new Re(e.key,e.value,`missing required property "stops"`)),a===`exponential`&&e.valueSpec.expression&&!Wn(e.valueSpec)&&u.push(new Re(e.key,e.value,`exponential functions not supported`)),e.styleSpec.$version>=8&&(c&&!Hn(e.valueSpec)?u.push(new Re(e.key,e.value,`property functions not supported`)):s&&!Un(e.valueSpec)&&u.push(new Re(e.key,e.value,`zoom functions not supported`))),a!==`categorical`&&!l||e.value.property!==void 0||u.push(new Re(e.key,e.value,`"property" property is required`)),u;function d(e){var t=[],a=e.value,s=e.key;if(Gn(a)!==`array`)return[new Re(s,a,`array expected, `+Gn(a)+` found`)];if(a.length!==2)return[new Re(s,a,`array length 2 expected, length `+a.length+` found`)];if(l){if(Gn(a[0])!==`object`)return[new Re(s,a,`object expected, `+Gn(a[0])+` found`)];if(a[0].zoom===void 0)return[new Re(s,a,`object stop key must have zoom`)];if(a[0].value===void 0)return[new Re(s,a,`object stop key must have value`)];if(r&&r>Ve(a[0].zoom))return[new Re(s,a[0].zoom,`stop zoom values must appear in ascending order`)];Ve(a[0].zoom)!==r&&(r=Ve(a[0].zoom),n=void 0,o={}),t=t.concat(or({key:s+`[0]`,value:a[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:cr,value:f}}))}else t=t.concat(f({key:s+`[0]`,value:a[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},a));return er(He(a[1]))?t.concat([new Re(s+`[1]`,a[1],`expressions are not allowed in function stops.`)]):t.concat(jr({key:s+`[1]`,value:a[1],valueSpec:i,style:e.style,styleSpec:e.styleSpec}))}function f(e,r){var s=Gn(e.value),c=Ve(e.value),l=e.value===null?r:e.value;if(t){if(s!==t)return[new Re(e.key,l,s+` stop domain type must match previous stop domain type `+t)]}else t=s;if(s!==`number`&&s!==`string`&&s!==`boolean`)return[new Re(e.key,l,`stop domain value must be a number, string, or boolean`)];if(s!==`number`&&a!==`categorical`){var u=`number expected, `+s+` found`;return Hn(i)&&a===void 0&&(u+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(e.key,l,u)]}return a!==`categorical`||s!==`number`||isFinite(c)&&Math.floor(c)===c?a!==`categorical`&&s===`number`&&n!==void 0&&c<n?[new Re(e.key,l,`stop domain values must appear in ascending order`)]:(n=c,a===`categorical`&&c in o?[new Re(e.key,l,`stop domain values must be unique`)]:(o[c]=!0,[])):[new Re(e.key,l,`integer expected, found `+c)]}}function ur(e){var t=(e.expressionContext===`property`?ir:tr)(He(e.value),e.valueSpec);if(t.result===`error`)return t.value.map((function(t){return new Re(``+e.key+t.key,e.value,t.message)}));var n=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext===`property`&&e.propertyKey===`text-font`&&!n.outputDefined())return[new Re(e.key,e.value,`Invalid data expression for "`+e.propertyKey+`". Output values must be contained as literals within the expression.`)];if(e.expressionContext===`property`&&e.propertyType===`layout`&&!Kt(n))return[new Re(e.key,e.value,`"feature-state" data expressions are not supported with layout properties.`)];if(e.expressionContext===`filter`&&!Kt(n))return[new Re(e.key,e.value,`"feature-state" data expressions are not supported with filters.`)];if(e.expressionContext&&e.expressionContext.indexOf(`cluster`)===0){if(!qt(n,[`zoom`,`feature-state`]))return[new Re(e.key,e.value,`"zoom" and "feature-state" expressions are not supported with cluster properties.`)];if(e.expressionContext===`cluster-initial`&&!Gt(n))return[new Re(e.key,e.value,`Feature data expressions are not supported with initial expression part of cluster properties.`)]}return[]}function dr(e){var t=e.key,n=e.value,r=e.valueSpec,i=[];return Array.isArray(r.values)?r.values.indexOf(Ve(n))===-1&&i.push(new Re(t,n,`expected one of [`+r.values.join(`, `)+`], `+JSON.stringify(n)+` found`)):Object.keys(r.values).indexOf(Ve(n))===-1&&i.push(new Re(t,n,`expected one of [`+Object.keys(r.values).join(`, `)+`], `+JSON.stringify(n)+` found`)),i}function fr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case`has`:return e.length>=2&&e[1]!==`$id`&&e[1]!==`$type`;case`in`:return e.length>=3&&(typeof e[1]!=`string`||Array.isArray(e[2]));case`!in`:case`!has`:case`none`:return!1;case`==`:case`!=`:case`>`:case`>=`:case`<`:case`<=`:return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case`any`:case`all`:for(var t=0,n=e.slice(1);t<n.length;t+=1){var r=n[t];if(!fr(r)&&typeof r!=`boolean`)return!1}return!0;default:return!0}}ar.deserialize=function(e){return new ar(e._parameters,e._specification)},ar.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var pr={type:`boolean`,default:!1,transition:!1,"property-type":`data-driven`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]}};function mr(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};fr(e)||(e=gr(e));var t=tr(e,pr);if(t.result===`error`)throw Error(t.value.map((function(e){return e.key+`: `+e.message})).join(`, `));return{filter:function(e,n,r){return t.value.evaluate(e,n,{},r)},needGeometry:function e(t){if(!Array.isArray(t))return!1;if(t[0]===`within`)return!0;for(var n=1;n<t.length;n++)if(e(t[n]))return!0;return!1}(e)}}function hr(e,t){return e<t?-1:e>t?1:0}function gr(e){if(!e)return!0;var t,n=e[0];return e.length<=1?n!==`any`:n===`==`?_r(e[1],e[2],`==`):n===`!=`?br(_r(e[1],e[2],`==`)):n===`<`||n===`>`||n===`<=`||n===`>=`?_r(e[1],e[2],n):n===`any`?(t=e.slice(1),[`any`].concat(t.map(gr))):n===`all`?[`all`].concat(e.slice(1).map(gr)):n===`none`?[`all`].concat(e.slice(1).map(gr).map(br)):n===`in`?vr(e[1],e.slice(2)):n===`!in`?br(vr(e[1],e.slice(2))):n===`has`?yr(e[1]):n===`!has`?br(yr(e[1])):n!==`within`||e}function _r(e,t,n){switch(e){case`$type`:return[`filter-type-`+n,t];case`$id`:return[`filter-id-`+n,t];default:return[`filter-`+n,e,t]}}function vr(e,t){if(t.length===0)return!1;switch(e){case`$type`:return[`filter-type-in`,[`literal`,t]];case`$id`:return[`filter-id-in`,[`literal`,t]];default:return t.length>200&&!t.some((function(e){return typeof e!=typeof t[0]}))?[`filter-in-large`,e,[`literal`,t.sort(hr)]]:[`filter-in-small`,e,[`literal`,t]]}}function yr(e){switch(e){case`$type`:return!0;case`$id`:return[`filter-has-id`];default:return[`filter-has`,e]}}function br(e){return[`!`,e]}function xr(e){return fr(He(e.value))?ur(Be({},e,{expressionContext:`filter`,valueSpec:{value:`boolean`}})):function e(t){var n=t.value,r=t.key;if(Gn(n)!==`array`)return[new Re(r,n,`array expected, `+Gn(n)+` found`)];var i,a=t.styleSpec,o=[];if(n.length<1)return[new Re(r,n,`filter array must have at least 1 element`)];switch(o=o.concat(dr({key:r+`[0]`,value:n[0],valueSpec:a.filter_operator,style:t.style,styleSpec:t.styleSpec})),Ve(n[0])){case`<`:case`<=`:case`>`:case`>=`:n.length>=2&&Ve(n[1])===`$type`&&o.push(new Re(r,n,`"$type" cannot be use with operator "`+n[0]+`"`));case`==`:case`!=`:n.length!==3&&o.push(new Re(r,n,`filter array for operator "`+n[0]+`" must have 3 elements`));case`in`:case`!in`:n.length>=2&&(i=Gn(n[1]))!==`string`&&o.push(new Re(r+`[1]`,n[1],`string expected, `+i+` found`));for(var s=2;s<n.length;s++)i=Gn(n[s]),Ve(n[1])===`$type`?o=o.concat(dr({key:r+`[`+s+`]`,value:n[s],valueSpec:a.geometry_type,style:t.style,styleSpec:t.styleSpec})):i!==`string`&&i!==`number`&&i!==`boolean`&&o.push(new Re(r+`[`+s+`]`,n[s],`string, number, or boolean expected, `+i+` found`));break;case`any`:case`all`:case`none`:for(var c=1;c<n.length;c++)o=o.concat(e({key:r+`[`+c+`]`,value:n[c],style:t.style,styleSpec:t.styleSpec}));break;case`has`:case`!has`:i=Gn(n[1]),n.length===2?i!==`string`&&o.push(new Re(r+`[1]`,n[1],`string expected, `+i+` found`)):o.push(new Re(r,n,`filter array for "`+n[0]+`" operator must have 2 elements`));break;case`within`:i=Gn(n[1]),n.length===2?i!==`object`&&o.push(new Re(r+`[1]`,n[1],`object expected, `+i+` found`)):o.push(new Re(r,n,`filter array for "`+n[0]+`" operator must have 2 elements`))}return o}(e)}function Sr(e,t){var n=e.key,r=e.style,i=e.styleSpec,a=e.value,o=e.objectKey,s=i[t+`_`+e.layerType];if(!s)return[];var c=o.match(/^(.*)-transition$/);if(t===`paint`&&c&&s[c[1]]&&s[c[1]].transition)return jr({key:n,value:a,valueSpec:i.transition,style:r,styleSpec:i});var l,u=e.valueSpec||s[o];if(!u)return[new Re(n,a,`unknown property "`+o+`"`)];if(Gn(a)===`string`&&Hn(u)&&!u.tokens&&(l=/^{([^}]+)}$/.exec(a)))return[new Re(n,a,`"`+o+`" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": `+JSON.stringify(l[1])+" }`.")];var d=[];return e.layerType===`symbol`&&(o===`text-field`&&r&&!r.glyphs&&d.push(new Re(n,a,`use of "text-field" requires a style "glyphs" property`)),o===`text-font`&&Kn(He(a))&&Ve(a.type)===`identity`&&d.push(new Re(n,a,`"text-font" does not support identity functions`))),d.concat(jr({key:e.key,value:a,valueSpec:u,style:r,styleSpec:i,expressionContext:`property`,propertyType:t,propertyKey:o}))}function Cr(e){return Sr(e,`paint`)}function wr(e){return Sr(e,`layout`)}function Tr(e){var t=[],n=e.value,r=e.key,i=e.style,a=e.styleSpec;n.type||n.ref||t.push(new Re(r,n,`either "type" or "ref" is required`));var o,s=Ve(n.type),c=Ve(n.ref);if(n.id)for(var l=Ve(n.id),u=0;u<e.arrayIndex;u++){var d=i.layers[u];Ve(d.id)===l&&t.push(new Re(r,n.id,`duplicate layer id "`+n.id+`", previously used at line `+d.id.__line__))}if(`ref`in n)[`type`,`source`,`source-layer`,`filter`,`layout`].forEach((function(e){e in n&&t.push(new Re(r,n[e],`"`+e+`" is prohibited for ref layers`))})),i.layers.forEach((function(e){Ve(e.id)===c&&(o=e)})),o?o.ref?t.push(new Re(r,n.ref,`ref cannot reference another ref layer`)):s=Ve(o.type):t.push(new Re(r,n.ref,`ref layer "`+c+`" not found`));else if(s!==`background`)if(n.source){var f=i.sources&&i.sources[n.source],p=f&&Ve(f.type);f?p===`vector`&&s===`raster`?t.push(new Re(r,n.source,`layer "`+n.id+`" requires a raster source`)):p===`raster`&&s!==`raster`?t.push(new Re(r,n.source,`layer "`+n.id+`" requires a vector source`)):p!==`vector`||n[`source-layer`]?p===`raster-dem`&&s!==`hillshade`?t.push(new Re(r,n.source,`raster-dem source can only be used with layer type 'hillshade'.`)):s!==`line`||!n.paint||!n.paint[`line-gradient`]||p===`geojson`&&f.lineMetrics||t.push(new Re(r,n,`layer "`+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Re(r,n,`layer "`+n.id+`" must specify a "source-layer"`)):t.push(new Re(r,n.source,`source "`+n.source+`" not found`))}else t.push(new Re(r,n,`missing required property "source"`));return t=t.concat(or({key:r,value:n,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return jr({key:r+`.type`,value:n.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:`type`})},filter:xr,layout:function(e){return or({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return wr(Be({layerType:s},e))}}})},paint:function(e){return or({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return Cr(Be({layerType:s},e))}}})}}}))}function Er(e){var t=e.value,n=e.key,r=Gn(t);return r===`string`?[]:[new Re(n,t,`string expected, `+r+` found`)]}var Dr={promoteId:function(e){var t=e.key,n=e.value;if(Gn(n)===`string`)return Er({key:t,value:n});var r=[];for(var i in n)r.push.apply(r,Er({key:t+`.`+i,value:n[i]}));return r}};function Or(e){var t=e.value,n=e.key,r=e.styleSpec,i=e.style;if(!t.type)return[new Re(n,t,`"type" is required`)];var a,o=Ve(t.type);switch(o){case`vector`:case`raster`:case`raster-dem`:return or({key:n,value:t,valueSpec:r[`source_`+o.replace(`-`,`_`)],style:e.style,styleSpec:r,objectElementValidators:Dr});case`geojson`:if(a=or({key:n,value:t,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:Dr}),t.cluster)for(var s in t.clusterProperties){var c=t.clusterProperties[s],l=c[0],u=typeof l==`string`?[l,[`accumulated`],[`get`,s]]:l;a.push.apply(a,ur({key:n+`.`+s+`.map`,value:c[1],expressionContext:`cluster-map`})),a.push.apply(a,ur({key:n+`.`+s+`.reduce`,value:u,expressionContext:`cluster-reduce`}))}return a;case`video`:return or({key:n,value:t,valueSpec:r.source_video,style:i,styleSpec:r});case`image`:return or({key:n,value:t,valueSpec:r.source_image,style:i,styleSpec:r});case`canvas`:return[new Re(n,null,`Please use runtime APIs to add canvas sources, rather than including them in stylesheets.`,`source.canvas`)];default:return dr({key:n+`.type`,value:t.type,valueSpec:{values:[`vector`,`raster`,`raster-dem`,`geojson`,`video`,`image`]},style:i,styleSpec:r})}}function kr(e){var t=e.value,n=e.styleSpec,r=n.light,i=e.style,a=[],o=Gn(t);if(t===void 0)return a;if(o!==`object`)return a.concat([new Re(`light`,t,`object expected, `+o+` found`)]);for(var s in t){var c=s.match(/^(.*)-transition$/);a=a.concat(c&&r[c[1]]&&r[c[1]].transition?jr({key:s,value:t[s],valueSpec:n.transition,style:i,styleSpec:n}):r[s]?jr({key:s,value:t[s],valueSpec:r[s],style:i,styleSpec:n}):[new Re(s,t[s],`unknown property "`+s+`"`)])}return a}var Ar={"*":function(){return[]},array:sr,boolean:function(e){var t=e.value,n=e.key,r=Gn(t);return r===`boolean`?[]:[new Re(n,t,`boolean expected, `+r+` found`)]},number:cr,color:function(e){var t=e.key,n=e.value,r=Gn(n);return r===`string`?st(n)===null?[new Re(t,n,`color expected, "`+n+`" found`)]:[]:[new Re(t,n,`color expected, `+r+` found`)]},constants:ze,enum:dr,filter:xr,function:lr,layer:Tr,object:or,source:Or,light:kr,string:Er,formatted:function(e){return Er(e).length===0?[]:ur(e)},resolvedImage:function(e){return Er(e).length===0?[]:ur(e)}};function jr(e){var t=e.value,n=e.valueSpec,r=e.styleSpec;return n.expression&&Kn(Ve(t))?lr(e):n.expression&&er(He(t))?ur(e):n.type&&Ar[n.type]?Ar[n.type](e):or(Be({},e,{valueSpec:n.type?r[n.type]:n}))}function Mr(e){var t=e.value,n=e.key,r=Er(e);return r.length||(t.indexOf(`{fontstack}`)===-1&&r.push(new Re(n,t,`"glyphs" url must include a "{fontstack}" token`)),t.indexOf(`{range}`)===-1&&r.push(new Re(n,t,`"glyphs" url must include a "{range}" token`))),r}function Nr(e,t){t===void 0&&(t=q);var n=[];return n=n.concat(jr({key:``,value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Mr,"*":function(){return[]}}})),e.constants&&(n=n.concat(ze({key:`constants`,value:e.constants,style:e,styleSpec:t}))),Pr(n)}function Pr(e){return[].concat(e).sort((function(e,t){return e.line-t.line}))}function Fr(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return Pr(e.apply(this,t))}}Nr.source=Fr(Or),Nr.light=Fr(kr),Nr.layer=Fr(Tr),Nr.filter=Fr(xr),Nr.paintProperty=Fr(Cr),Nr.layoutProperty=Fr(wr);var Ir=Nr,Lr=Ir.light,Rr=Ir.paintProperty,zr=Ir.layoutProperty;function Br(e,t){var n=!1;if(t&&t.length)for(var r=0,i=t;r<i.length;r+=1)e.fire(new Ie(Error(i[r].message))),n=!0;return n}var Vr=Hr;function Hr(e,t,n){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(n=i[2]);for(var a=0;a<this.d*this.d;a++){var o=i[3+a],s=i[3+a+1];r.push(o===s?null:i.subarray(o,s))}var c=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],c),this.bboxes=i.subarray(c),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var l=0;l<this.d*this.d;l++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var u=n/t*e;this.min=-u,this.max=e+u}Hr.prototype.insert=function(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Hr.prototype._insertReadonly=function(){throw`Cannot insert into a GridIndex created from an ArrayBuffer.`},Hr.prototype._insertCell=function(e,t,n,r,i,a){this.cells[i].push(a)},Hr.prototype.query=function(e,t,n,r,i){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=n&&o<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,n,r,this._queryCell,s,{},i),s},Hr.prototype._queryCell=function(e,t,n,r,i,a,o,s){var c=this.cells[i];if(c!==null)for(var l=this.keys,u=this.bboxes,d=0;d<c.length;d++){var f=c[d];if(o[f]===void 0){var p=4*f;(s?s(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&n>=u[p+0]&&r>=u[p+1])?(o[f]=!0,a.push(l[f])):o[f]=!1}}},Hr.prototype._forEachCell=function(e,t,n,r,i,a,o,s){for(var c=this._convertToCellCoord(e),l=this._convertToCellCoord(t),u=this._convertToCellCoord(n),d=this._convertToCellCoord(r),f=c;f<=u;f++)for(var p=l;p<=d;p++){var m=this.d*p+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(p),this._convertFromCellCoord(f+1),this._convertFromCellCoord(p+1)))&&i.call(this,e,t,n,r,m,a,o,s))return}},Hr.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Hr.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Hr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(t+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];i[3+o]=a,i.set(s,a),a+=s.length}return i[3+e.length]=a,i.set(this.keys,a),i[3+e.length+1]=a+=this.keys.length,i.set(this.bboxes,a),a+=this.bboxes.length,i.buffer};var Ur=o.ImageData,Wr=o.ImageBitmap,Gr={};function Kr(e,t,n){n===void 0&&(n={}),Object.defineProperty(t,`_classRegistryKey`,{value:e,writeable:!1}),Gr[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}for(var qr in Kr(`Object`,Object),Vr.serialize=function(e,t){var n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}},Vr.deserialize=function(e){return new Vr(e.buffer)},Kr(`Grid`,Vr),Kr(`Color`,ct),Kr(`Error`,Error),Kr(`ResolvedImage`,ft),Kr(`StylePropertyFunction`,ar),Kr(`StyleExpression`,$n,{omit:[`_evaluator`]}),Kr(`ZoomDependentExpression`,rr),Kr(`ZoomConstantExpression`,nr),Kr(`CompoundExpression`,Dt,{omit:[`_evaluate`]}),Fn)Fn[qr]._classRegistryKey||Kr(`Expression_`+qr,Fn[qr]);function Jr(e){return e&&typeof ArrayBuffer<`u`&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name===`ArrayBuffer`)}function Yr(e){return Wr&&e instanceof Wr}function Xr(e,t){if(e==null||typeof e==`boolean`||typeof e==`number`||typeof e==`string`||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Jr(e)||Yr(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var n=e;return t&&t.push(n.buffer),n}if(e instanceof Ur)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var r=[],i=0,a=e;i<a.length;i+=1)r.push(Xr(a[i],t));return r}if(typeof e==`object`){var o=e.constructor,s=o._classRegistryKey;if(!s)throw Error(`can't serialize object of unregistered class`);var c=o.serialize?o.serialize(e,t):{};if(!o.serialize){for(var l in e)if(e.hasOwnProperty(l)&&!(Gr[s].omit.indexOf(l)>=0)){var u=e[l];c[l]=Gr[s].shallow.indexOf(l)>=0?u:Xr(u,t)}e instanceof Error&&(c.message=e.message)}if(c.$name)throw Error(`$name property is reserved for worker serialization logic.`);return s!==`Object`&&(c.$name=s),c}throw Error(`can't serialize object of type `+typeof e)}function Zr(e){if(e==null||typeof e==`boolean`||typeof e==`number`||typeof e==`string`||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Jr(e)||Yr(e)||ArrayBuffer.isView(e)||e instanceof Ur)return e;if(Array.isArray(e))return e.map(Zr);if(typeof e==`object`){var t=e.$name||`Object`,n=Gr[t].klass;if(!n)throw Error(`can't deserialize unregistered class `+t);if(n.deserialize)return n.deserialize(e);for(var r=Object.create(n.prototype),i=0,a=Object.keys(e);i<a.length;i+=1){var o=a[i];if(o!==`$name`){var s=e[o];r[o]=Gr[t].shallow.indexOf(o)>=0?s:Zr(s)}}return r}throw Error(`can't deserialize object of type `+typeof e)}var Qr=function(){this.first=!0};Qr.prototype.update=function(e,t){var n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))};var $r={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function ei(e){for(var t=0,n=e;t<n.length;t+=1)if(ti(n[t].charCodeAt(0)))return!0;return!1}function ti(e){return!(e!==746&&e!==747&&(e<4352||!($r[`Bopomofo Extended`](e)||$r.Bopomofo(e)||$r[`CJK Compatibility Forms`](e)&&!(e>=65097&&e<=65103)||$r[`CJK Compatibility Ideographs`](e)||$r[`CJK Compatibility`](e)||$r[`CJK Radicals Supplement`](e)||$r[`CJK Strokes`](e)||!(!$r[`CJK Symbols and Punctuation`](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||$r[`CJK Unified Ideographs Extension A`](e)||$r[`CJK Unified Ideographs`](e)||$r[`Enclosed CJK Letters and Months`](e)||$r[`Hangul Compatibility Jamo`](e)||$r[`Hangul Jamo Extended-A`](e)||$r[`Hangul Jamo Extended-B`](e)||$r[`Hangul Jamo`](e)||$r[`Hangul Syllables`](e)||$r.Hiragana(e)||$r[`Ideographic Description Characters`](e)||$r.Kanbun(e)||$r[`Kangxi Radicals`](e)||$r[`Katakana Phonetic Extensions`](e)||$r.Katakana(e)&&e!==12540||!(!$r[`Halfwidth and Fullwidth Forms`](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!$r[`Small Form Variants`](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||$r[`Unified Canadian Aboriginal Syllabics`](e)||$r[`Unified Canadian Aboriginal Syllabics Extended`](e)||$r[`Vertical Forms`](e)||$r[`Yijing Hexagram Symbols`](e)||$r[`Yi Syllables`](e)||$r[`Yi Radicals`](e))))}function ni(e){return!(ti(e)||function(e){return!!($r[`Latin-1 Supplement`](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||$r[`General Punctuation`](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||$r[`Letterlike Symbols`](e)||$r[`Number Forms`](e)||$r[`Miscellaneous Technical`](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||$r[`Control Pictures`](e)&&e!==9251||$r[`Optical Character Recognition`](e)||$r[`Enclosed Alphanumerics`](e)||$r[`Geometric Shapes`](e)||$r[`Miscellaneous Symbols`](e)&&!(e>=9754&&e<=9759)||$r[`Miscellaneous Symbols and Arrows`](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||$r[`CJK Symbols and Punctuation`](e)||$r.Katakana(e)||$r[`Private Use Area`](e)||$r[`CJK Compatibility Forms`](e)||$r[`Small Form Variants`](e)||$r[`Halfwidth and Fullwidth Forms`](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(e))}function ri(e){return e>=1424&&e<=2303||$r[`Arabic Presentation Forms-A`](e)||$r[`Arabic Presentation Forms-B`](e)}function ii(e,t){return!(!t&&ri(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||$r.Khmer(e))}function ai(e){for(var t=0,n=e;t<n.length;t+=1)if(ri(n[t].charCodeAt(0)))return!0;return!1}var oi=null,si=`unavailable`,ci=null,li=function(e){e&&typeof e==`string`&&e.indexOf(`NetworkError`)>-1&&(si=`error`),oi&&oi(e)};function ui(){di.fire(new Fe(`pluginStateChange`,{pluginStatus:si,pluginURL:ci}))}var di=new Le,fi=function(){return si},pi=function(){if(si!==`deferred`||!ci)throw Error(`rtl-text-plugin cannot be downloaded unless a pluginURL is specified`);si=`loading`,ui(),ci&&ke({url:ci},(function(e){e?li(e):(si=`loaded`,ui())}))},mi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return si===`loaded`||mi.applyArabicShaping!=null},isLoading:function(){return si===`loading`},setState:function(e){si=e.pluginStatus,ci=e.pluginURL},isParsed:function(){return mi.applyArabicShaping!=null&&mi.processBidirectionalText!=null&&mi.processStyledBidirectionalText!=null},getPluginURL:function(){return ci}},hi=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Qr,this.transition={})};hi.prototype.isSupportedScript=function(e){return function(e,t){for(var n=0,r=e;n<r.length;n+=1)if(!ii(r[n].charCodeAt(0),t))return!1;return!0}(e,mi.isLoaded())},hi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},hi.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}};var gi=function(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Kn(e))return new ar(e,t);if(er(e)){var n=ir(e,t);if(n.result===`error`)throw Error(n.value.map((function(e){return e.key+`: `+e.message})).join(`, `));return n.value}var r=e;return typeof e==`string`&&t.type===`color`&&(r=ct.parse(e)),{kind:`constant`,evaluate:function(){return r}}}(t===void 0?e.specification.default:t,e.specification)};gi.prototype.isDataDriven=function(){return this.expression.kind===`source`||this.expression.kind===`composite`},gi.prototype.possiblyEvaluate=function(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)};var _i=function(e){this.property=e,this.value=new gi(e,void 0)};_i.prototype.transitioned=function(e,t){return new yi(this.property,this.value,t,f({},e.transition,this.transition),e.now)},_i.prototype.untransitioned=function(){return new yi(this.property,this.value,null,{},0)};var vi=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};vi.prototype.getValue=function(e){return x(this._values[e].value.value)},vi.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new _i(this._values[e].property)),this._values[e].value=new gi(this._values[e].property,t===null?void 0:x(t))},vi.prototype.getTransition=function(e){return x(this._values[e].transition)},vi.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new _i(this._values[e].property)),this._values[e].transition=x(t)||void 0},vi.prototype.serialize=function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t+=1){var r=n[t],i=this.getValue(r);i!==void 0&&(e[r]=i);var a=this.getTransition(r);a!==void 0&&(e[r+`-transition`]=a)}return e},vi.prototype.transitioned=function(e,t){for(var n=new bi(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var a=i[r];n._values[a]=this._values[a].transitioned(e,t._values[a])}return n},vi.prototype.untransitioned=function(){for(var e=new bi(this._properties),t=0,n=Object.keys(this._values);t<n.length;t+=1){var r=n[t];e._values[r]=this._values[r].untransitioned()}return e};var yi=function(e,t,n,r,i){this.property=e,this.value=t,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,e.specification.transition&&(r.delay||r.duration)&&(this.prior=n)};yi.prototype.possiblyEvaluate=function(e,t,n){var r=e.now||0,i=this.value.possiblyEvaluate(e,t,n),a=this.prior;if(a){if(r>this.end||this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return a.possiblyEvaluate(e,t,n);var o=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,n),i,function(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}(o))}return i};var bi=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};bi.prototype.possiblyEvaluate=function(e,t,n){for(var r=new Ci(this._properties),i=0,a=Object.keys(this._values);i<a.length;i+=1){var o=a[i];r._values[o]=this._values[o].possiblyEvaluate(e,t,n)}return r},bi.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var xi=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};xi.prototype.getValue=function(e){return x(this._values[e].value)},xi.prototype.setValue=function(e,t){this._values[e]=new gi(this._values[e].property,t===null?void 0:x(t))},xi.prototype.serialize=function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t+=1){var r=n[t],i=this.getValue(r);i!==void 0&&(e[r]=i)}return e},xi.prototype.possiblyEvaluate=function(e,t,n){for(var r=new Ci(this._properties),i=0,a=Object.keys(this._values);i<a.length;i+=1){var o=a[i];r._values[o]=this._values[o].possiblyEvaluate(e,t,n)}return r};var Si=function(e,t,n){this.property=e,this.value=t,this.parameters=n};Si.prototype.isConstant=function(){return this.value.kind===`constant`},Si.prototype.constantOr=function(e){return this.value.kind===`constant`?this.value.value:e},Si.prototype.evaluate=function(e,t,n,r){return this.property.evaluate(this.value,this.parameters,e,t,n,r)};var Ci=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Ci.prototype.get=function(e){return this._values[e]};var wi=function(e){this.specification=e};wi.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},wi.prototype.interpolate=function(e,t,n){var r=$t[this.specification.type];return r?r(e,t,n):e};var Ti=function(e,t){this.specification=e,this.overrides=t};Ti.prototype.possiblyEvaluate=function(e,t,n,r){return new Si(this,e.expression.kind===`constant`||e.expression.kind===`camera`?{kind:`constant`,value:e.expression.evaluate(t,null,{},n,r)}:e.expression,t)},Ti.prototype.interpolate=function(e,t,n){if(e.value.kind!==`constant`||t.value.kind!==`constant`)return e;if(e.value.value===void 0||t.value.value===void 0)return new Si(this,{kind:`constant`,value:void 0},e.parameters);var r=$t[this.specification.type];return r?new Si(this,{kind:`constant`,value:r(e.value.value,t.value.value,n)},e.parameters):e},Ti.prototype.evaluate=function(e,t,n,r,i,a){return e.kind===`constant`?e.value:e.evaluate(t,n,r,i,a)};var Ei=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(e,t,n,r){if(e.value===void 0)return new Si(this,{kind:`constant`,value:void 0},t);if(e.expression.kind===`constant`){var i=e.expression.evaluate(t,null,{},n,r),a=e.property.specification.type===`resolvedImage`&&typeof i!=`string`?i.name:i,o=this._calculate(a,a,a,t);return new Si(this,{kind:`constant`,value:o},t)}if(e.expression.kind===`camera`){var s=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Si(this,{kind:`constant`,value:s},t)}return new Si(this,e.expression,t)},t.prototype.evaluate=function(e,t,n,r,i,a){if(e.kind===`source`){var o=e.evaluate(t,n,r,i,a);return this._calculate(o,o,o,t)}return e.kind===`composite`?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,r),e.evaluate({zoom:Math.floor(t.zoom)},n,r),e.evaluate({zoom:Math.floor(t.zoom)+1},n,r),t):e.value},t.prototype._calculate=function(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}},t.prototype.interpolate=function(e){return e},t}(Ti),Di=function(e){this.specification=e};Di.prototype.possiblyEvaluate=function(e,t,n,r){if(e.value!==void 0){if(e.expression.kind===`constant`){var i=e.expression.evaluate(t,null,{},n,r);return this._calculate(i,i,i,t)}return this._calculate(e.expression.evaluate(new hi(Math.floor(t.zoom-1),t)),e.expression.evaluate(new hi(Math.floor(t.zoom),t)),e.expression.evaluate(new hi(Math.floor(t.zoom+1),t)),t)}},Di.prototype._calculate=function(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}},Di.prototype.interpolate=function(e){return e};var Oi=function(e){this.specification=e};Oi.prototype.possiblyEvaluate=function(e,t,n,r){return!!e.expression.evaluate(t,null,{},n,r)},Oi.prototype.interpolate=function(){return!1};var ki=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var n=e[t];n.specification.overridable&&this.overridableProperties.push(t);var r=this.defaultPropertyValues[t]=new gi(n,void 0),i=this.defaultTransitionablePropertyValues[t]=new _i(n);this.defaultTransitioningPropertyValues[t]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=r.possiblyEvaluate({})}};Kr(`DataDrivenProperty`,Ti),Kr(`DataConstantProperty`,wi),Kr(`CrossFadedDataDrivenProperty`,Ei),Kr(`CrossFadedProperty`,Di),Kr(`ColorRampProperty`,Oi);var Ai=function(e){function t(t,n){if(e.call(this),this.id=t.id,this.type=t.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},t.type!==`custom`&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!==`background`&&(this.source=t.source,this.sourceLayer=t[`source-layer`],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new xi(n.layout)),n.paint)){for(var r in this._transitionablePaint=new vi(n.paint),t.paint)this.setPaintProperty(r,t.paint[r],{validate:!1});for(var i in t.layout)this.setLayoutProperty(i,t.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ci(n.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(e){return e===`visibility`?this.visibility:this._unevaluatedLayout.getValue(e)},t.prototype.setLayoutProperty=function(e,t,n){n===void 0&&(n={}),t!=null&&this._validate(zr,`layers.`+this.id+`.layout.`+e,e,t,n)||(e===`visibility`?this.visibility=t:this._unevaluatedLayout.setValue(e,t))},t.prototype.getPaintProperty=function(e){return v(e,`-transition`)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)},t.prototype.setPaintProperty=function(e,t,n){if(n===void 0&&(n={}),t!=null&&this._validate(Rr,`layers.`+this.id+`.paint.`+e,e,t,n))return!1;if(v(e,`-transition`))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;var r=this._transitionablePaint._values[e],i=r.property.specification[`property-type`]===`cross-faded-data-driven`,a=r.value.isDataDriven(),o=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);var s=this._transitionablePaint._values[e].value;return s.isDataDriven()||a||i||this._handleOverridablePaintPropertyUpdate(e,o,s)},t.prototype._handleSpecialPaintPropertyUpdate=function(e){},t.prototype._handleOverridablePaintPropertyUpdate=function(e,t,n){return!1},t.prototype.isHidden=function(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility===`none`},t.prototype.updateTransitions=function(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)},t.prototype.serialize=function(){var e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),b(e,(function(e,t){return!(e===void 0||t===`layout`&&!Object.keys(e).length||t===`paint`&&!Object.keys(e).length)}))},t.prototype._validate=function(e,t,n,r,i){return i===void 0&&(i={}),(!i||!1!==i.validate)&&Br(this,e.call(Ir,{key:t,layerType:this.type,objectKey:n,value:r,styleSpec:q,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var e in this.paint._values){var t=this.paint.get(e);if(t instanceof Si&&Hn(t.property.specification)&&(t.value.kind===`source`||t.value.kind===`composite`)&&t.value.isStateDependent)return!0}return!1},t}(Le),ji={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Mi=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ni=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Pi(e,t){t===void 0&&(t=1);var n=0,r=0;return{members:e.map((function(e){var i=ji[e.type].BYTES_PER_ELEMENT,a=n=Fi(n,Math.max(t,i)),o=e.components||1;return r=Math.max(r,i),n+=i*o,{name:e.name,type:e.type,components:o,offset:a}})),size:Fi(n,Math.max(r,t)),alignment:t}}function Fi(e,t){return Math.ceil(e/t)*t}Ni.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Ni.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Ni.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ni.prototype.clear=function(){this.length=0},Ni.prototype.resize=function(e){this.reserve(e),this.length=e},Ni.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Ni.prototype._refreshViews=function(){throw Error(`_refreshViews() must be implemented by each concrete StructArray layout`)};var Ii=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)},t.prototype.emplace=function(e,t,n){var r=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,e},t}(Ni);Ii.prototype.bytesPerElement=4,Kr(`StructArrayLayout2i4`,Ii);var Li=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)},t.prototype.emplace=function(e,t,n,r,i){var a=4*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=r,this.int16[a+3]=i,e},t}(Ni);Li.prototype.bytesPerElement=8,Kr(`StructArrayLayout4i8`,Li);var Ri=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i,a)},t.prototype.emplace=function(e,t,n,r,i,a,o){var s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,e},t}(Ni);Ri.prototype.bytesPerElement=12,Kr(`StructArrayLayout2i4i12`,Ri);var zi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i,a)},t.prototype.emplace=function(e,t,n,r,i,a,o){var s=4*e,c=8*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.uint8[c+4]=r,this.uint8[c+5]=i,this.uint8[c+6]=a,this.uint8[c+7]=o,e},t}(Ni);zi.prototype.bytesPerElement=8,Kr(`StructArrayLayout2i4ub8`,zi);var Bi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)},t.prototype.emplace=function(e,t,n){var r=2*e;return this.float32[r+0]=t,this.float32[r+1]=n,e},t}(Ni);Bi.prototype.bytesPerElement=8,Kr(`StructArrayLayout2f8`,Bi);var Vi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,a,o,s,c,l){var u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,r,i,a,o,s,c,l)},t.prototype.emplace=function(e,t,n,r,i,a,o,s,c,l,u){var d=10*e;return this.uint16[d+0]=t,this.uint16[d+1]=n,this.uint16[d+2]=r,this.uint16[d+3]=i,this.uint16[d+4]=a,this.uint16[d+5]=o,this.uint16[d+6]=s,this.uint16[d+7]=c,this.uint16[d+8]=l,this.uint16[d+9]=u,e},t}(Ni);Vi.prototype.bytesPerElement=20,Kr(`StructArrayLayout10ui20`,Vi);var Hi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,a,o,s,c,l,u,d){var f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,r,i,a,o,s,c,l,u,d)},t.prototype.emplace=function(e,t,n,r,i,a,o,s,c,l,u,d,f){var p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=r,this.int16[p+3]=i,this.uint16[p+4]=a,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=c,this.int16[p+8]=l,this.int16[p+9]=u,this.int16[p+10]=d,this.int16[p+11]=f,e},t}(Ni);Hi.prototype.bytesPerElement=24,Kr(`StructArrayLayout4i4ui4i24`,Hi);var Ui=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)},t.prototype.emplace=function(e,t,n,r){var i=3*e;return this.float32[i+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e},t}(Ni);Ui.prototype.bytesPerElement=12,Kr(`StructArrayLayout3f12`,Ui);var Wi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)},t.prototype.emplace=function(e,t){return this.uint32[1*e+0]=t,e},t}(Ni);Wi.prototype.bytesPerElement=4,Kr(`StructArrayLayout1ul4`,Wi);var Gi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,a,o,s,c){var l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,r,i,a,o,s,c)},t.prototype.emplace=function(e,t,n,r,i,a,o,s,c,l){var u=10*e,d=5*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=r,this.int16[u+3]=i,this.int16[u+4]=a,this.int16[u+5]=o,this.uint32[d+3]=s,this.uint16[u+8]=c,this.uint16[u+9]=l,e},t}(Ni);Gi.prototype.bytesPerElement=20,Kr(`StructArrayLayout6i1ul2ui20`,Gi);var Ki=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i,a)},t.prototype.emplace=function(e,t,n,r,i,a,o){var s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,e},t}(Ni);Ki.prototype.bytesPerElement=12,Kr(`StructArrayLayout2i2i2i12`,Ki);var qi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i)},t.prototype.emplace=function(e,t,n,r,i,a){var o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=r,this.int16[s+6]=i,this.int16[s+7]=a,e},t}(Ni);qi.prototype.bytesPerElement=16,Kr(`StructArrayLayout2f1f2i16`,qi);var Ji=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)},t.prototype.emplace=function(e,t,n,r,i){var a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[o+1]=r,this.float32[o+2]=i,e},t}(Ni);Ji.prototype.bytesPerElement=12,Kr(`StructArrayLayout2ub2f12`,Ji);var Yi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)},t.prototype.emplace=function(e,t,n,r){var i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,this.uint16[i+2]=r,e},t}(Ni);Yi.prototype.bytesPerElement=6,Kr(`StructArrayLayout3ui6`,Yi);var Xi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g){var _=this.length;return this.resize(_+1),this.emplace(_,e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g)},t.prototype.emplace=function(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_){var v=24*e,y=12*e,b=48*e;return this.int16[v+0]=t,this.int16[v+1]=n,this.uint16[v+2]=r,this.uint16[v+3]=i,this.uint32[y+2]=a,this.uint32[y+3]=o,this.uint32[y+4]=s,this.uint16[v+10]=c,this.uint16[v+11]=l,this.uint16[v+12]=u,this.float32[y+7]=d,this.float32[y+8]=f,this.uint8[b+36]=p,this.uint8[b+37]=m,this.uint8[b+38]=h,this.uint32[y+10]=g,this.int16[v+22]=_,e},t}(Ni);Xi.prototype.bytesPerElement=48,Kr(`StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48`,Xi);var Zi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,E,D,O){var k=this.length;return this.resize(k+1),this.emplace(k,e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,E,D,O)},t.prototype.emplace=function(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,E,D,O,k){var A=34*e,j=17*e;return this.int16[A+0]=t,this.int16[A+1]=n,this.int16[A+2]=r,this.int16[A+3]=i,this.int16[A+4]=a,this.int16[A+5]=o,this.int16[A+6]=s,this.int16[A+7]=c,this.uint16[A+8]=l,this.uint16[A+9]=u,this.uint16[A+10]=d,this.uint16[A+11]=f,this.uint16[A+12]=p,this.uint16[A+13]=m,this.uint16[A+14]=h,this.uint16[A+15]=g,this.uint16[A+16]=_,this.uint16[A+17]=v,this.uint16[A+18]=y,this.uint16[A+19]=b,this.uint16[A+20]=x,this.uint16[A+21]=S,this.uint16[A+22]=C,this.uint32[j+12]=w,this.float32[j+13]=E,this.float32[j+14]=D,this.float32[j+15]=O,this.float32[j+16]=k,e},t}(Ni);Zi.prototype.bytesPerElement=68,Kr(`StructArrayLayout8i15ui1ul4f68`,Zi);var Qi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)},t.prototype.emplace=function(e,t){return this.float32[1*e+0]=t,e},t}(Ni);Qi.prototype.bytesPerElement=4,Kr(`StructArrayLayout1f4`,Qi);var $i=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)},t.prototype.emplace=function(e,t,n,r){var i=3*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.int16[i+2]=r,e},t}(Ni);$i.prototype.bytesPerElement=6,Kr(`StructArrayLayout3i6`,$i);var ea=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)},t.prototype.emplace=function(e,t,n,r){var i=4*e;return this.uint32[2*e+0]=t,this.uint16[i+2]=n,this.uint16[i+3]=r,e},t}(Ni);ea.prototype.bytesPerElement=8,Kr(`StructArrayLayout1ul2ui8`,ea);var ta=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)},t.prototype.emplace=function(e,t,n){var r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,e},t}(Ni);ta.prototype.bytesPerElement=4,Kr(`StructArrayLayout2ui4`,ta);var na=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)},t.prototype.emplace=function(e,t){return this.uint16[1*e+0]=t,e},t}(Ni);na.prototype.bytesPerElement=2,Kr(`StructArrayLayout1ui2`,na);var ra=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(e,t,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)},t.prototype.emplace=function(e,t,n,r,i){var a=4*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=r,this.float32[a+3]=i,e},t}(Ni);ra.prototype.bytesPerElement=16,Kr(`StructArrayLayout4f16`,ra);var ia=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,n),t}(Mi);ia.prototype.size=20;var aa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new ia(this,e)},t}(Gi);Kr(`CollisionBoxArray`,aa);var oa=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(e){this._structArray.uint8[this._pos1+37]=e},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(e){this._structArray.uint8[this._pos1+38]=e},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(e){this._structArray.uint32[this._pos4+10]=e},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,n),t}(Mi);oa.prototype.size=48;var sa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new oa(this,e)},t}(Xi);Kr(`PlacedSymbolArray`,sa);var ca=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},n.crossTileID.set=function(e){this._structArray.uint32[this._pos4+12]=e},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},n.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,n),t}(Mi);ca.prototype.size=68;var la=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new ca(this,e)},t}(Zi);Kr(`SymbolInstanceArray`,la);var ua=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(e){return this.float32[1*e+0]},t}(Qi);Kr(`GlyphOffsetArray`,ua);var da=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(e){return this.int16[3*e+0]},t.prototype.gety=function(e){return this.int16[3*e+1]},t.prototype.gettileUnitDistanceFromAnchor=function(e){return this.int16[3*e+2]},t}($i);Kr(`SymbolLineVertexArray`,da);var fa=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,n),t}(Mi);fa.prototype.size=8;var pa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(e){return new fa(this,e)},t}(ea);Kr(`FeatureIndexArray`,pa);var ma=Pi([{name:`a_pos`,components:2,type:`Int16`}],4).members,ha=function(e){e===void 0&&(e=[]),this.segments=e};function ga(e,t){return 256*(e=u(Math.floor(e),0,255))+u(Math.floor(t),0,255)}ha.prototype.prepareSegment=function(e,t,n,r){var i=this.segments[this.segments.length-1];return e>ha.MAX_VERTEX_ARRAY_LENGTH&&C(`Max vertices per segment is `+ha.MAX_VERTEX_ARRAY_LENGTH+`: bucket requested `+e),(!i||i.vertexLength+e>ha.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},r!==void 0&&(i.sortKey=r),this.segments.push(i)),i},ha.prototype.get=function(){return this.segments},ha.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var n=t[e];for(var r in n.vaos)n.vaos[r].destroy()}},ha.simpleSegment=function(e,t,n,r){return new ha([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])},ha.MAX_VERTEX_ARRAY_LENGTH=2**16-1,Kr(`SegmentVector`,ha);var _a=Pi([{name:`a_pattern_from`,components:4,type:`Uint16`},{name:`a_pattern_to`,components:4,type:`Uint16`},{name:`a_pixel_ratio_from`,components:1,type:`Uint16`},{name:`a_pixel_ratio_to`,components:1,type:`Uint16`}]),va=t((function(e){e.exports=function(e,t){var n,r,i,a,o,s,c,l;for(r=e.length-(n=3&e.length),i=t,o=3432918353,s=461845907,l=0;l<r;)c=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,i=27492+(65535&(a=5*(65535&(i=(i^=c=(65535&(c=(c=(65535&c)*o+(((c>>>16)*o&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(c=0,n){case 3:c^=(255&e.charCodeAt(l+2))<<16;case 2:c^=(255&e.charCodeAt(l+1))<<8;case 1:i^=c=(65535&(c=(c=(65535&(c^=255&e.charCodeAt(l)))*o+(((c>>>16)*o&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),ya=t((function(e){e.exports=function(e,t){for(var n,r=e.length,i=t^r,a=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:i^=(255&e.charCodeAt(a+2))<<16;case 2:i^=(255&e.charCodeAt(a+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(a)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),ba=va,xa=ya;ba.murmur3=va,ba.murmur2=xa;var Sa=function(){this.ids=[],this.positions=[],this.indexed=!1};Sa.prototype.add=function(e,t,n,r){this.ids.push(wa(e)),this.positions.push(t,n,r)},Sa.prototype.getPositions=function(e){for(var t=wa(e),n=0,r=this.ids.length-1;n<r;){var i=n+r>>1;this.ids[i]>=t?r=i:n=i+1}for(var a=[];this.ids[n]===t;)a.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return a},Sa.serialize=function(e,t){var n=new Float64Array(e.ids),r=new Uint32Array(e.positions);return function e(t,n,r,i){for(;r<i;){for(var a=t[r+i>>1],o=r-1,s=i+1;;){do o++;while(t[o]<a);do s--;while(t[s]>a);if(o>=s)break;Ta(t,o,s),Ta(n,3*o,3*s),Ta(n,3*o+1,3*s+1),Ta(n,3*o+2,3*s+2)}s-r<i-s?(e(t,n,r,s),r=s+1):(e(t,n,s+1,i),i=s)}}(n,r,0,n.length-1),t&&t.push(n.buffer,r.buffer),{ids:n,positions:r}},Sa.deserialize=function(e){var t=new Sa;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Ca=2**53-1;function wa(e){var t=+e;return!isNaN(t)&&t<=Ca?t:ba(String(e))}function Ta(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}Kr(`FeaturePositionMap`,Sa);var Ea=function(e,t){this.gl=e.gl,this.location=t},Da=function(e){function t(t,n){e.call(this,t,n),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))},t}(Ea),Oa=function(e){function t(t,n){e.call(this,t,n),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))},t}(Ea),ka=function(e){function t(t,n){e.call(this,t,n),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))},t}(Ea),Aa=function(e){function t(t,n){e.call(this,t,n),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))},t}(Ea),ja=function(e){function t(t,n){e.call(this,t,n),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))},t}(Ea),Ma=function(e){function t(t,n){e.call(this,t,n),this.current=ct.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))},t}(Ea),Na=new Float32Array(16),Pa=function(e){function t(t,n){e.call(this,t,n),this.current=Na}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(var t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}},t}(Ea);function Fa(e){return[ga(255*e.r,255*e.g),ga(255*e.b,255*e.a)]}var Ia=function(e,t,n){this.value=e,this.uniformNames=t.map((function(e){return`u_`+e})),this.type=n};Ia.prototype.setUniform=function(e,t,n){e.set(n.constantOr(this.value))},Ia.prototype.getBinding=function(e,t,n){return this.type===`color`?new Ma(e,t):new Oa(e,t)};var La=function(e,t){this.uniformNames=t.map((function(e){return`u_`+e})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};La.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},La.prototype.setUniform=function(e,t,n,r){var i=r===`u_pattern_to`?this.patternTo:r===`u_pattern_from`?this.patternFrom:r===`u_pixel_ratio_to`?this.pixelRatioTo:r===`u_pixel_ratio_from`?this.pixelRatioFrom:null;i&&e.set(i)},La.prototype.getBinding=function(e,t,n){return n.substr(0,9)===`u_pattern`?new ja(e,t):new Oa(e,t)};var Ra=function(e,t,n,r){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((function(e){return{name:`a_`+e,type:`Float32`,components:n===`color`?2:1,offset:0}})),this.paintVertexArray=new r};Ra.prototype.populatePaintArray=function(e,t,n,r,i){var a=this.paintVertexArray.length,o=this.expression.evaluate(new hi(0),t,{},r,[],i);this.paintVertexArray.resize(e),this._setPaintValue(a,e,o)},Ra.prototype.updatePaintArray=function(e,t,n,r){var i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(e,t,i)},Ra.prototype._setPaintValue=function(e,t,n){if(this.type===`color`)for(var r=Fa(n),i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1]);else{for(var a=e;a<t;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}},Ra.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ra.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var za=function(e,t,n,r,i,a){this.expression=e,this.uniformNames=t.map((function(e){return`u_`+e+`_t`})),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map((function(e){return{name:`a_`+e,type:`Float32`,components:n===`color`?4:2,offset:0}})),this.paintVertexArray=new a};za.prototype.populatePaintArray=function(e,t,n,r,i){var a=this.expression.evaluate(new hi(this.zoom),t,{},r,[],i),o=this.expression.evaluate(new hi(this.zoom+1),t,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(s,e,a,o)},za.prototype.updatePaintArray=function(e,t,n,r){var i=this.expression.evaluate({zoom:this.zoom},n,r),a=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(e,t,i,a)},za.prototype._setPaintValue=function(e,t,n,r){if(this.type===`color`)for(var i=Fa(n),a=Fa(r),o=e;o<t;o++)this.paintVertexArray.emplace(o,i[0],i[1],a[0],a[1]);else{for(var s=e;s<t;s++)this.paintVertexArray.emplace(s,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}},za.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},za.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},za.prototype.setUniform=function(e,t){var n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=u(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(r)},za.prototype.getBinding=function(e,t,n){return new Oa(e,t)};var Ba=function(e,t,n,r,i,a){this.expression=e,this.type=t,this.useIntegerZoom=n,this.zoom=r,this.layerId=a,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i};Ba.prototype.populatePaintArray=function(e,t,n){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],n)},Ba.prototype.updatePaintArray=function(e,t,n,r,i){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],i)},Ba.prototype._setPaintValues=function(e,t,n,r){if(r&&n){var i=r[n.min],a=r[n.mid],o=r[n.max];if(i&&a&&o)for(var s=e;s<t;s++)this.zoomInPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],a.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],a.pixelRatio,o.pixelRatio)}},Ba.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,_a.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,_a.members,this.expression.isStateDependent))},Ba.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Va=function(e,t,n){this.binders={},this._buffers=[];var r=[];for(var i in e.paint._values)if(n(i)){var a=e.paint.get(i);if(a instanceof Si&&Hn(a.property.specification)){var o=Ua(i,e.type),s=a.value,c=a.property.specification.type,l=a.property.useIntegerZoom,u=a.property.specification[`property-type`],d=u===`cross-faded`||u===`cross-faded-data-driven`;if(s.kind===`constant`)this.binders[i]=d?new La(s.value,o):new Ia(s.value,o,c),r.push(`/u_`+i);else if(s.kind===`source`||d){var f=Wa(i,c,`source`);this.binders[i]=d?new Ba(s,c,l,t,f,e.id):new Ra(s,o,c,f),r.push(`/a_`+i)}else{var p=Wa(i,c,`composite`);this.binders[i]=new za(s,o,c,l,t,p),r.push(`/z_`+i)}}}this.cacheKey=r.sort().join(``)};Va.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof Ra||t instanceof za?t.maxValue:0},Va.prototype.populatePaintArrays=function(e,t,n,r,i){for(var a in this.binders){var o=this.binders[a];(o instanceof Ra||o instanceof za||o instanceof Ba)&&o.populatePaintArray(e,t,n,r,i)}},Va.prototype.setConstantPatternPositions=function(e,t){for(var n in this.binders){var r=this.binders[n];r instanceof La&&r.setConstantPatternPositions(e,t)}},Va.prototype.updatePaintArrays=function(e,t,n,r,i){var a=!1;for(var o in e)for(var s=0,c=t.getPositions(o);s<c.length;s+=1){var l=c[s],u=n.feature(l.index);for(var d in this.binders){var f=this.binders[d];(f instanceof Ra||f instanceof za||f instanceof Ba)&&!0===f.expression.isStateDependent&&(f.expression=r.paint.get(d).value,f.updatePaintArray(l.start,l.end,u,e[o],i),a=!0)}}return a},Va.prototype.defines=function(){var e=[];for(var t in this.binders){var n=this.binders[t];(n instanceof Ia||n instanceof La)&&e.push.apply(e,n.uniformNames.map((function(e){return`#define HAS_UNIFORM_`+e})))}return e},Va.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof Ra||n instanceof za)for(var r=0;r<n.paintVertexAttributes.length;r++)e.push(n.paintVertexAttributes[r].name);else if(n instanceof Ba)for(var i=0;i<_a.members.length;i++)e.push(_a.members[i].name)}return e},Va.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof Ia||n instanceof La||n instanceof za)for(var r=0,i=n.uniformNames;r<i.length;r+=1)e.push(i[r])}return e},Va.prototype.getPaintVertexBuffers=function(){return this._buffers},Va.prototype.getUniforms=function(e,t){var n=[];for(var r in this.binders){var i=this.binders[r];if(i instanceof Ia||i instanceof La||i instanceof za)for(var a=0,o=i.uniformNames;a<o.length;a+=1){var s=o[a];if(t[s]){var c=i.getBinding(e,t[s],s);n.push({name:s,property:r,binding:c})}}}return n},Va.prototype.setUniforms=function(e,t,n,r){for(var i=0,a=t;i<a.length;i+=1){var o=a[i],s=o.name,c=o.property;this.binders[c].setUniform(o.binding,r,n.get(c),s)}},Va.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var n=this.binders[t];if(e&&n instanceof Ba){var r=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else (n instanceof Ra||n instanceof za)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}},Va.prototype.upload=function(e){for(var t in this.binders){var n=this.binders[t];(n instanceof Ra||n instanceof za||n instanceof Ba)&&n.upload(e)}this.updatePaintBuffers()},Va.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof Ra||t instanceof za||t instanceof Ba)&&t.destroy()}};var Ha=function(e,t,n){n===void 0&&(n=function(){return!0}),this.programConfigurations={};for(var r=0,i=e;r<i.length;r+=1){var a=i[r];this.programConfigurations[a.id]=new Va(a,t,n)}this.needsUpload=!1,this._featureMap=new Sa,this._bufferOffset=0};function Ua(e,t){return{"text-opacity":[`opacity`],"icon-opacity":[`opacity`],"text-color":[`fill_color`],"icon-color":[`fill_color`],"text-halo-color":[`halo_color`],"icon-halo-color":[`halo_color`],"text-halo-blur":[`halo_blur`],"icon-halo-blur":[`halo_blur`],"text-halo-width":[`halo_width`],"icon-halo-width":[`halo_width`],"line-gap-width":[`gapwidth`],"line-pattern":[`pattern_to`,`pattern_from`,`pixel_ratio_to`,`pixel_ratio_from`],"fill-pattern":[`pattern_to`,`pattern_from`,`pixel_ratio_to`,`pixel_ratio_from`],"fill-extrusion-pattern":[`pattern_to`,`pattern_from`,`pixel_ratio_to`,`pixel_ratio_from`]}[e]||[e.replace(t+`-`,``).replace(/-/g,`_`)]}function Wa(e,t,n){var r={color:{source:Bi,composite:ra},number:{source:Qi,composite:Bi}},i=function(e){return{"line-pattern":{source:Vi,composite:Vi},"fill-pattern":{source:Vi,composite:Vi},"fill-extrusion-pattern":{source:Vi,composite:Vi}}[e]}(e);return i&&i[n]||r[t][n]}Ha.prototype.populatePaintArrays=function(e,t,n,r,i,a){for(var o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(e,t,r,i,a);t.id!==void 0&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},Ha.prototype.updatePaintArrays=function(e,t,n,r){for(var i=0,a=n;i<a.length;i+=1){var o=a[i];this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,t,o,r)||this.needsUpload}},Ha.prototype.get=function(e){return this.programConfigurations[e]},Ha.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},Ha.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Kr(`ConstantBinder`,Ia),Kr(`CrossFadedConstantBinder`,La),Kr(`SourceExpressionBinder`,Ra),Kr(`CrossFadedCompositeBinder`,Ba),Kr(`CompositeExpressionBinder`,za),Kr(`ProgramConfiguration`,Va,{omit:[`_buffers`]}),Kr(`ProgramConfigurationSet`,Ha);var Ga=2**14-1,Ka=-Ga-1;function qa(e){for(var t=8192/e.extent,n=e.loadGeometry(),r=0;r<n.length;r++)for(var i=n[r],a=0;a<i.length;a++){var o=i[a],s=Math.round(o.x*t),c=Math.round(o.y*t);o.x=u(s,Ka,Ga),o.y=u(c,Ka,Ga),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&C(`Geometry exceeds allowed extent, reduce your vector tile buffer size`)}return n}function Ja(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?qa(e):[]}}function Ya(e,t,n,r,i){e.emplaceBack(2*t+(r+1)/2,2*n+(i+1)/2)}var Xa=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ii,this.indexArray=new Yi,this.segments=new ha,this.programConfigurations=new Ha(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};function Za(e,t){for(var n=0;n<e.length;n++)if(oo(t,e[n]))return!0;for(var r=0;r<t.length;r++)if(oo(e,t[r]))return!0;return!!to(e,t)}function Qa(e,t,n){return!!oo(e,t)||!!ro(t,e,n)}function $a(e,t){if(e.length===1)return ao(t,e[0]);for(var n=0;n<t.length;n++)for(var r=t[n],i=0;i<r.length;i++)if(oo(e,r[i]))return!0;for(var a=0;a<e.length;a++)if(ao(t,e[a]))return!0;for(var o=0;o<t.length;o++)if(to(e,t[o]))return!0;return!1}function eo(e,t,n){if(e.length>1){if(to(e,t))return!0;for(var r=0;r<t.length;r++)if(ro(t[r],e,n))return!0}for(var i=0;i<e.length;i++)if(ro(e[i],t,n))return!0;return!1}function to(e,t){if(e.length===0||t.length===0)return!1;for(var n=0;n<e.length-1;n++)for(var r=e[n],i=e[n+1],a=0;a<t.length-1;a++)if(no(r,i,t[a],t[a+1]))return!0;return!1}function no(e,t,n,r){return w(e,n,r)!==w(t,n,r)&&w(e,t,n)!==w(e,t,r)}function ro(e,t,n){var r=n*n;if(t.length===1)return e.distSqr(t[0])<r;for(var i=1;i<t.length;i++)if(io(e,t[i-1],t[i])<r)return!0;return!1}function io(e,t,n){var r=t.distSqr(n);if(r===0)return e.distSqr(t);var i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;return e.distSqr(i<0?t:i>1?n:n.sub(t)._mult(i)._add(t))}function ao(e,t){for(var n,r,i,a=!1,o=0;o<e.length;o++)for(var s=0,c=(n=e[o]).length-1;s<n.length;c=s++)(r=n[s]).y>t.y!=(i=n[c]).y>t.y&&t.x<(i.x-r.x)*(t.y-r.y)/(i.y-r.y)+r.x&&(a=!a);return a}function oo(e,t){for(var n=!1,r=0,i=e.length-1;r<e.length;i=r++){var a=e[r],o=e[i];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(n=!n)}return n}function so(e,t,n){var r=n[0],i=n[2];if(e.x<r.x&&t.x<r.x||e.x>i.x&&t.x>i.x||e.y<r.y&&t.y<r.y||e.y>i.y&&t.y>i.y)return!1;var a=w(e,t,n[0]);return a!==w(e,t,n[1])||a!==w(e,t,n[2])||a!==w(e,t,n[3])}function co(e,t,n){var r=t.paint.get(e).value;return r.kind===`constant`?r.value:n.programConfigurations.get(t.id).getMaxValue(e)}function lo(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function uo(e,t,n,r,a){if(!t[0]&&!t[1])return e;var o=i.convert(t)._mult(a);n===`viewport`&&o._rotate(-r);for(var s=[],c=0;c<e.length;c++)s.push(e[c].sub(o));return s}Xa.prototype.populate=function(e,t,n){var r=this.layers[0],i=[],a=null;r.type===`circle`&&(a=r.layout.get(`circle-sort-key`));for(var o=0,s=e;o<s.length;o+=1){var c=s[o],l=c.feature,u=c.id,d=c.index,f=c.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,m=Ja(l,p);if(this.layers[0]._featureFilter.filter(new hi(this.zoom),m,n)){var h=a?a.evaluate(m,{},n):void 0,g={id:u,properties:l.properties,type:l.type,sourceLayerIndex:f,index:d,geometry:p?m.geometry:qa(l),patterns:{},sortKey:h};i.push(g)}}a&&i.sort((function(e,t){return e.sortKey-t.sortKey}));for(var _=0,v=i;_<v.length;_+=1){var y=v[_],b=y.geometry,x=y.index,S=y.sourceLayerIndex,C=e[x].feature;this.addFeature(y,b,x,n),t.featureIndex.insert(C,b,x,S,this.index)}},Xa.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},Xa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xa.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ma),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Xa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Xa.prototype.addFeature=function(e,t,n,r){for(var i=0,a=t;i<a.length;i+=1)for(var o=0,s=a[i];o<s.length;o+=1){var c=s[o],l=c.x,u=c.y;if(!(l<0||l>=8192||u<0||u>=8192)){var d=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),f=d.vertexLength;Ya(this.layoutVertexArray,l,u,-1,-1),Ya(this.layoutVertexArray,l,u,1,-1),Ya(this.layoutVertexArray,l,u,1,1),Ya(this.layoutVertexArray,l,u,-1,1),this.indexArray.emplaceBack(f,f+1,f+2),this.indexArray.emplaceBack(f,f+3,f+2),d.vertexLength+=4,d.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},r)},Kr(`CircleBucket`,Xa,{omit:[`layers`]});var fo=new ki({"circle-sort-key":new Ti(q.layout_circle[`circle-sort-key`])}),po={paint:new ki({"circle-radius":new Ti(q.paint_circle[`circle-radius`]),"circle-color":new Ti(q.paint_circle[`circle-color`]),"circle-blur":new Ti(q.paint_circle[`circle-blur`]),"circle-opacity":new Ti(q.paint_circle[`circle-opacity`]),"circle-translate":new wi(q.paint_circle[`circle-translate`]),"circle-translate-anchor":new wi(q.paint_circle[`circle-translate-anchor`]),"circle-pitch-scale":new wi(q.paint_circle[`circle-pitch-scale`]),"circle-pitch-alignment":new wi(q.paint_circle[`circle-pitch-alignment`]),"circle-stroke-width":new Ti(q.paint_circle[`circle-stroke-width`]),"circle-stroke-color":new Ti(q.paint_circle[`circle-stroke-color`]),"circle-stroke-opacity":new Ti(q.paint_circle[`circle-stroke-opacity`])}),layout:fo},mo=typeof Float32Array<`u`?Float32Array:Array;function ho(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function go(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=t[9],p=t[10],m=t[11],h=t[12],g=t[13],_=t[14],v=t[15],y=n[0],b=n[1],x=n[2],S=n[3];return e[0]=y*r+b*s+x*d+S*h,e[1]=y*i+b*c+x*f+S*g,e[2]=y*a+b*l+x*p+S*_,e[3]=y*o+b*u+x*m+S*v,e[4]=(y=n[4])*r+(b=n[5])*s+(x=n[6])*d+(S=n[7])*h,e[5]=y*i+b*c+x*f+S*g,e[6]=y*a+b*l+x*p+S*_,e[7]=y*o+b*u+x*m+S*v,e[8]=(y=n[8])*r+(b=n[9])*s+(x=n[10])*d+(S=n[11])*h,e[9]=y*i+b*c+x*f+S*g,e[10]=y*a+b*l+x*p+S*_,e[11]=y*o+b*u+x*m+S*v,e[12]=(y=n[12])*r+(b=n[13])*s+(x=n[14])*d+(S=n[15])*h,e[13]=y*i+b*c+x*f+S*g,e[14]=y*a+b*l+x*p+S*_,e[15]=y*o+b*u+x*m+S*v,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,n=arguments.length;n--;)t+=e[n]*e[n];return Math.sqrt(t)});var _o,vo=go;function yo(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e}_o=new mo(3),mo!=Float32Array&&(_o[0]=0,_o[1]=0,_o[2]=0),function(){var e=new mo(4);mo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var bo=(function(){var e=new mo(2);mo!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(t){e.call(this,t,po)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(e){return new Xa(e)},t.prototype.queryRadius=function(e){var t=e;return co(`circle-radius`,this,t)+co(`circle-stroke-width`,this,t)+lo(this.paint.get(`circle-translate`))},t.prototype.queryIntersectsFeature=function(e,t,n,r,i,a,o,s){for(var c=uo(e,this.paint.get(`circle-translate`),this.paint.get(`circle-translate-anchor`),a.angle,o),l=this.paint.get(`circle-radius`).evaluate(t,n)+this.paint.get(`circle-stroke-width`).evaluate(t,n),u=this.paint.get(`circle-pitch-alignment`)===`map`,d=u?c:function(e,t){return e.map((function(e){return xo(e,t)}))}(c,s),f=u?l*o:l,p=0,m=r;p<m.length;p+=1)for(var h=0,g=m[p];h<g.length;h+=1){var _=g[h],v=u?_:xo(_,s),y=f,b=yo([],[_.x,_.y,0,1],s);if(this.paint.get(`circle-pitch-scale`)===`viewport`&&this.paint.get(`circle-pitch-alignment`)===`map`?y*=b[3]/a.cameraToCenterDistance:this.paint.get(`circle-pitch-scale`)===`map`&&this.paint.get(`circle-pitch-alignment`)===`viewport`&&(y*=a.cameraToCenterDistance/b[3]),Qa(d,v,y))return!0}return!1},t}(Ai));function xo(e,t){var n=yo([],[e.x,e.y,0,1],t);return new i(n[0]/n[3],n[1]/n[3])}var So=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Xa);function Co(e,t,n,r){var i=t.width,a=t.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*a*n)throw RangeError(`mismatched image size`)}else r=new Uint8Array(i*a*n);return e.width=i,e.height=a,e.data=r,e}function wo(e,t,n){var r=t.width,i=t.height;if(r!==e.width||i!==e.height){var a=Co({},{width:r,height:i},n);To(e,a,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},n),e.width=r,e.height=i,e.data=a.data}}function To(e,t,n,r,i,a){if(i.width===0||i.height===0)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw RangeError(`out of range source coordinates for image copy`);if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw RangeError(`out of range destination coordinates for image copy`);for(var o=e.data,s=t.data,c=0;c<i.height;c++)for(var l=((n.y+c)*e.width+n.x)*a,u=((r.y+c)*t.width+r.x)*a,d=0;d<i.width*a;d++)s[u+d]=o[l+d];return t}Kr(`HeatmapBucket`,So,{omit:[`layers`]});var Eo=function(e,t){Co(this,e,1,t)};Eo.prototype.resize=function(e){wo(this,e,1)},Eo.prototype.clone=function(){return new Eo({width:this.width,height:this.height},new Uint8Array(this.data))},Eo.copy=function(e,t,n,r,i){To(e,t,n,r,i,1)};var Do=function(e,t){Co(this,e,4,t)};Do.prototype.resize=function(e){wo(this,e,4)},Do.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Do.prototype.clone=function(){return new Do({width:this.width,height:this.height},new Uint8Array(this.data))},Do.copy=function(e,t,n,r,i){To(e,t,n,r,i,4)},Kr(`AlphaImage`,Eo),Kr(`RGBAImage`,Do);var Oo={paint:new ki({"heatmap-radius":new Ti(q.paint_heatmap[`heatmap-radius`]),"heatmap-weight":new Ti(q.paint_heatmap[`heatmap-weight`]),"heatmap-intensity":new wi(q.paint_heatmap[`heatmap-intensity`]),"heatmap-color":new Oi(q.paint_heatmap[`heatmap-color`]),"heatmap-opacity":new wi(q.paint_heatmap[`heatmap-opacity`])})};function ko(e){var t={},n=e.resolution||256,r=e.clips?e.clips.length:1,i=e.image||new Do({width:n,height:r}),a=function(n,r,a){t[e.evaluationKey]=a;var o=e.expression.evaluate(t);i.data[n+r+0]=Math.floor(255*o.r/o.a),i.data[n+r+1]=Math.floor(255*o.g/o.a),i.data[n+r+2]=Math.floor(255*o.b/o.a),i.data[n+r+3]=Math.floor(255*o.a)};if(e.clips)for(var o=0,s=0;o<r;++o,s+=4*n)for(var c=0,l=0;c<n;c++,l+=4){var u=c/(n-1),d=e.clips[o];a(s,l,d.start*(1-u)+d.end*u)}else for(var f=0,p=0;f<n;f++,p+=4)a(0,p,f/(n-1));return i}var Ao=function(e){function t(t){e.call(this,t,Oo),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(e){return new So(e)},t.prototype._handleSpecialPaintPropertyUpdate=function(e){e===`heatmap-color`&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=ko({expression:this._transitionablePaint._values[`heatmap-color`].value.expression,evaluationKey:`heatmapDensity`,image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&=(this.heatmapFbo.destroy(),null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get(`heatmap-opacity`)!==0&&this.visibility!==`none`},t}(Ai),jo={paint:new ki({"hillshade-illumination-direction":new wi(q.paint_hillshade[`hillshade-illumination-direction`]),"hillshade-illumination-anchor":new wi(q.paint_hillshade[`hillshade-illumination-anchor`]),"hillshade-exaggeration":new wi(q.paint_hillshade[`hillshade-exaggeration`]),"hillshade-shadow-color":new wi(q.paint_hillshade[`hillshade-shadow-color`]),"hillshade-highlight-color":new wi(q.paint_hillshade[`hillshade-highlight-color`]),"hillshade-accent-color":new wi(q.paint_hillshade[`hillshade-accent-color`])})},Mo=function(e){function t(t){e.call(this,t,jo)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get(`hillshade-exaggeration`)!==0&&this.visibility!==`none`},t}(Ai),No=Pi([{name:`a_pos`,components:2,type:`Int16`}],4).members,Po=Io,Fo=Io;function Io(e,t,n){n||=2;var r,i,a,o,s,c,l,u=t&&t.length,d=u?t[0]*n:e.length,f=Lo(e,0,d,n,!0),p=[];if(!f||f.next===f.prev)return p;if(u&&(f=function(e,t,n,r){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=Lo(e,t[i]*r,i<a-1?t[i+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(Jo(o));for(s.sort(Wo),i=0;i<s.length;i++)Go(s[i],n),n=Ro(n,n.next);return n}(e,t,f,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var m=n;m<d;m+=n)(s=e[m])<r&&(r=s),(c=e[m+1])<i&&(i=c),s>a&&(a=s),c>o&&(o=c);l=(l=Math.max(a-r,o-i))===0?0:1/l}return zo(f,p,n,r,i,l),p}function Lo(e,t,n,r,i){var a,o;if(i===ss(e,t,n,r)>0)for(a=t;a<n;a+=r)o=is(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=is(a,e[a],e[a+1],o);return o&&Qo(o,o.next)&&(as(o),o=o.next),o}function Ro(e,t){if(!e)return e;t||=e;var n,r=e;do if(n=!1,r.steiner||!Qo(r,r.next)&&Zo(r.prev,r,r.next)!==0)r=r.next;else{if(as(r),(r=t=r.prev)===r.next)break;n=!0}while(n||r!==t);return t}function zo(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do i.z===null&&(i.z=qo(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,c,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(c=l;s>0||c>0&&r;)s!==0&&(c===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,l*=2}while(o>1)}(i)}(e,r,i,a);for(var s,c,l=e;e.prev!==e.next;)if(s=e.prev,c=e.next,a?Vo(e,r,i,a):Bo(e))t.push(s.i/n),t.push(e.i/n),t.push(c.i/n),as(e),e=c.next,l=c.next;else if((e=c)===l){o?o===1?zo(e=Ho(Ro(e),t,n),t,n,r,i,a,2):o===2&&Uo(e,t,n,r,i,a):zo(Ro(e),t,n,r,i,a,1);break}}}function Bo(e){var t=e.prev,n=e,r=e.next;if(Zo(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Yo(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Zo(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Vo(e,t,n,r){var i=e.prev,a=e,o=e.next;if(Zo(i,a,o)>=0)return!1;for(var s=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,l=qo(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,t,n,r),u=qo(s,c,t,n,r),d=e.prevZ,f=e.nextZ;d&&d.z>=l&&f&&f.z<=u;){if(d!==e.prev&&d!==e.next&&Yo(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Zo(d.prev,d,d.next)>=0||(d=d.prevZ,f!==e.prev&&f!==e.next&&Yo(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Zo(f.prev,f,f.next)>=0))return!1;f=f.nextZ}for(;d&&d.z>=l;){if(d!==e.prev&&d!==e.next&&Yo(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Zo(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=u;){if(f!==e.prev&&f!==e.next&&Yo(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Zo(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Ho(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!Qo(i,a)&&$o(i,r,r.next,a)&&ns(i,a)&&ns(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),as(r),as(r.next),r=e=a),r=r.next}while(r!==e);return Ro(r)}function Uo(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Xo(o,s)){var c=rs(o,s);o=Ro(o,o.next),c=Ro(c,c.next),zo(o,t,n,r,i,a),zo(c,t,n,r,i,a);return}s=s.next}o=o.next}while(o!==e)}function Wo(e,t){return e.x-t.x}function Go(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var c,l=n,u=n.x,d=n.y,f=1/0;r=n;do i>=r.x&&r.x>=u&&i!==r.x&&Yo(a<d?i:o,a,u,d,a<d?o:i,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(i-r.x),ns(r,e)&&(c<f||c===f&&(r.x>n.x||r.x===n.x&&Ko(n,r)))&&(n=r,f=c)),r=r.next;while(r!==l);return n}(e,t)){var n=rs(t,e);Ro(t,t.next),Ro(n,n.next)}}function Ko(e,t){return Zo(e.prev,e,t.prev)<0&&Zo(t.next,e,e.next)<0}function qo(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Jo(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function Yo(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function Xo(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&$o(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(ns(e,t)&&ns(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}(e,t)&&(Zo(e.prev,e,t.prev)||Zo(e,t.prev,t))||Qo(e,t)&&Zo(e.prev,e,e.next)>0&&Zo(t.prev,t,t.next)>0)}function Zo(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Qo(e,t){return e.x===t.x&&e.y===t.y}function $o(e,t,n,r){var i=ts(Zo(e,t,n)),a=ts(Zo(e,t,r)),o=ts(Zo(n,r,e)),s=ts(Zo(n,r,t));return i!==a&&o!==s||!(i!==0||!es(e,n,t))||!(a!==0||!es(e,r,t))||!(o!==0||!es(n,e,r))||!(s!==0||!es(n,t,r))}function es(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function ts(e){return e>0?1:e<0?-1:0}function ns(e,t){return Zo(e.prev,e,e.next)<0?Zo(e,t,e.next)>=0&&Zo(e,e.prev,t)>=0:Zo(e,t,e.prev)<0||Zo(e,e.next,t)<0}function rs(e,t){var n=new os(e.i,e.x,e.y),r=new os(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function is(e,t,n,r){var i=new os(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function as(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function os(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ss(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}function cs(e,t,n,r,i){(function e(t,n,r,i,a){for(;i>r;){if(i-r>600){var o=i-r+1,s=n-r+1,c=Math.log(o),l=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*l*(o-l)/o)*(s-o/2<0?-1:1);e(t,n,Math.max(r,Math.floor(n-s*l/o+u)),Math.min(i,Math.floor(n+(o-s)*l/o+u)),a)}var d=t[n],f=r,p=i;for(ls(t,r,n),a(t[i],d)>0&&ls(t,r,i);f<p;){for(ls(t,f,p),f++,p--;a(t[f],d)<0;)f++;for(;a(t[p],d)>0;)p--}a(t[r],d)===0?ls(t,r,p):ls(t,++p,i),p<=n&&(r=p+1),n<=p&&(i=p-1)}})(e,t,n||0,r||e.length-1,i||us)}function ls(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function us(e,t){return e<t?-1:e>t?1:0}function ds(e,t){var n=e.length;if(n<=1)return[e];for(var r,i,a=[],o=0;o<n;o++){var s=E(e[o]);s!==0&&(e[o].area=Math.abs(s),i===void 0&&(i=s<0),i===s<0?(r&&a.push(r),r=[e[o]]):r.push(e[o]))}if(r&&a.push(r),t>1)for(var c=0;c<a.length;c++)a[c].length<=t||(cs(a[c],t,1,a[c].length-1,fs),a[c]=a[c].slice(0,t));return a}function fs(e,t){return t.area-e.area}function ps(e,t,n){for(var r=n.patternDependencies,i=!1,a=0,o=t;a<o.length;a+=1){var s=o[a].paint.get(e+`-pattern`);s.isConstant()||(i=!0);var c=s.constantOr(null);c&&(i=!0,r[c.to]=!0,r[c.from]=!0)}return i}function ms(e,t,n,r,i){for(var a=i.patternDependencies,o=0,s=t;o<s.length;o+=1){var c=s[o],l=c.paint.get(e+`-pattern`).value;if(l.kind!==`constant`){var u=l.evaluate({zoom:r-1},n,{},i.availableImages),d=l.evaluate({zoom:r},n,{},i.availableImages),f=l.evaluate({zoom:r+1},n,{},i.availableImages);d=d&&d.name?d.name:d,f=f&&f.name?f.name:f,a[u=u&&u.name?u.name:u]=!0,a[d]=!0,a[f]=!0,n.patterns[c.id]={min:u,mid:d,max:f}}}return n}Io.deviation=function(e,t,n,r){var i=t&&t.length,a=Math.abs(ss(e,0,i?t[0]*n:e.length,n));if(i)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(ss(e,t[o]*n,o<s-1?t[o+1]*n:e.length,n));var c=0;for(o=0;o<r.length;o+=3){var l=r[o]*n,u=r[o+1]*n,d=r[o+2]*n;c+=Math.abs((e[l]-e[d])*(e[u+1]-e[l+1])-(e[l]-e[u])*(e[d+1]-e[l+1]))}return a===0&&c===0?0:Math.abs((c-a)/a)},Io.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&n.holes.push(r+=e[i-1].length)}return n},Po.default=Fo;var hs=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ii,this.indexArray=new Yi,this.indexArray2=new ta,this.programConfigurations=new Ha(e.layers,e.zoom),this.segments=new ha,this.segments2=new ha,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};hs.prototype.populate=function(e,t,n){this.hasPattern=ps(`fill`,this.layers,t);for(var r=this.layers[0].layout.get(`fill-sort-key`),i=[],a=0,o=e;a<o.length;a+=1){var s=o[a],c=s.feature,l=s.id,u=s.index,d=s.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,p=Ja(c,f);if(this.layers[0]._featureFilter.filter(new hi(this.zoom),p,n)){var m=r?r.evaluate(p,{},n,t.availableImages):void 0,h={id:l,properties:c.properties,type:c.type,sourceLayerIndex:d,index:u,geometry:f?p.geometry:qa(c),patterns:{},sortKey:m};i.push(h)}}r&&i.sort((function(e,t){return e.sortKey-t.sortKey}));for(var g=0,_=i;g<_.length;g+=1){var v=_[g],y=v.geometry,b=v.index,x=v.sourceLayerIndex;if(this.hasPattern){var S=ms(`fill`,this.layers,v,this.zoom,t);this.patternFeatures.push(S)}else this.addFeature(v,y,b,n,{});t.featureIndex.insert(e[b].feature,y,b,x,this.index)}},hs.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},hs.prototype.addFeatures=function(e,t,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var a=i[r];this.addFeature(a,a.geometry,a.index,t,n)}},hs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},hs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},hs.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,No),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},hs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},hs.prototype.addFeature=function(e,t,n,r,i){for(var a=0,o=ds(t,500);a<o.length;a+=1){for(var s=o[a],c=0,l=0,u=s;l<u.length;l+=1)c+=u[l].length;for(var d=this.segments.prepareSegment(c,this.layoutVertexArray,this.indexArray),f=d.vertexLength,p=[],m=[],h=0,g=s;h<g.length;h+=1){var _=g[h];if(_.length!==0){_!==s[0]&&m.push(p.length/2);var v=this.segments2.prepareSegment(_.length,this.layoutVertexArray,this.indexArray2),y=v.vertexLength;this.layoutVertexArray.emplaceBack(_[0].x,_[0].y),this.indexArray2.emplaceBack(y+_.length-1,y),p.push(_[0].x),p.push(_[0].y);for(var b=1;b<_.length;b++)this.layoutVertexArray.emplaceBack(_[b].x,_[b].y),this.indexArray2.emplaceBack(y+b-1,y+b),p.push(_[b].x),p.push(_[b].y);v.vertexLength+=_.length,v.primitiveLength+=_.length}}for(var x=Po(p,m),S=0;S<x.length;S+=3)this.indexArray.emplaceBack(f+x[S],f+x[S+1],f+x[S+2]);d.vertexLength+=c,d.primitiveLength+=x.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)},Kr(`FillBucket`,hs,{omit:[`layers`,`patternFeatures`]});var gs=new ki({"fill-sort-key":new Ti(q.layout_fill[`fill-sort-key`])}),_s={paint:new ki({"fill-antialias":new wi(q.paint_fill[`fill-antialias`]),"fill-opacity":new Ti(q.paint_fill[`fill-opacity`]),"fill-color":new Ti(q.paint_fill[`fill-color`]),"fill-outline-color":new Ti(q.paint_fill[`fill-outline-color`]),"fill-translate":new wi(q.paint_fill[`fill-translate`]),"fill-translate-anchor":new wi(q.paint_fill[`fill-translate-anchor`]),"fill-pattern":new Ei(q.paint_fill[`fill-pattern`])}),layout:gs},vs=function(e){function t(t){e.call(this,t,_s)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(t,n){e.prototype.recalculate.call(this,t,n);var r=this.paint._values[`fill-outline-color`];r.value.kind===`constant`&&r.value.value===void 0&&(this.paint._values[`fill-outline-color`]=this.paint._values[`fill-color`])},t.prototype.createBucket=function(e){return new hs(e)},t.prototype.queryRadius=function(){return lo(this.paint.get(`fill-translate`))},t.prototype.queryIntersectsFeature=function(e,t,n,r,i,a,o){return $a(uo(e,this.paint.get(`fill-translate`),this.paint.get(`fill-translate-anchor`),a.angle,o),r)},t.prototype.isTileClipped=function(){return!0},t}(Ai),ys=Pi([{name:`a_pos`,components:2,type:`Int16`},{name:`a_normal_ed`,components:4,type:`Int16`}],4).members,bs=xs;function xs(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(Ss,this,t)}function Ss(e,t,n){e==1?t.id=n.readVarint():e==2?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):e==3?t.type=n.readVarint():e==4&&(t._geometry=n.pos)}function Cs(e){for(var t,n,r=0,i=0,a=e.length,o=a-1;i<a;o=i++)r+=((n=e[o]).x-(t=e[i]).x)*(t.y+n.y);return r}xs.types=[`Unknown`,`Point`,`LineString`,`Polygon`],xs.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,r=1,a=0,o=0,s=0,c=[];e.pos<n;){if(a<=0){var l=e.readVarint();r=7&l,a=l>>3}if(a--,r===1||r===2)o+=e.readSVarint(),s+=e.readSVarint(),r===1&&(t&&c.push(t),t=[]),t.push(new i(o,s));else{if(r!==7)throw Error(`unknown command `+r);t&&t.push(t[0].clone())}}return t&&c.push(t),c},xs.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,a=0,o=1/0,s=-1/0,c=1/0,l=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();n=7&u,r=u>>3}if(r--,n===1||n===2)(i+=e.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=e.readSVarint())<c&&(c=a),a>l&&(l=a);else if(n!==7)throw Error(`unknown command `+n)}return[o,c,s,l]},xs.prototype.toGeoJSON=function(e,t,n){var r,i,a=this.extent*2**n,o=this.extent*e,s=this.extent*t,c=this.loadGeometry(),l=xs.types[this.type];function u(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(r=0;r<c.length;r++)d[r]=c[r][0];u(c=d);break;case 2:for(r=0;r<c.length;r++)u(c[r]);break;case 3:for(c=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],a=0;a<t;a++){var o=Cs(e[a]);o!==0&&(r===void 0&&(r=o<0),r===o<0?(n&&i.push(n),n=[e[a]]):n.push(e[a]))}return n&&i.push(n),i}(c),r=0;r<c.length;r++)for(i=0;i<c[r].length;i++)u(c[r][i])}c.length===1?c=c[0]:l=`Multi`+l;var f={type:`Feature`,geometry:{type:l,coordinates:c},properties:this.properties};return`id`in this&&(f.id=this.id),f};var ws=Ts;function Ts(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Es,this,t),this.length=this._features.length}function Es(e,t,n){e===15?t.version=n.readVarint():e===1?t.name=n.readString():e===5?t.extent=n.readVarint():e===2?t._features.push(n.pos):e===3?t._keys.push(n.readString()):e===4&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var r=e.readVarint()>>3;t=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null}return t}(n))}function Ds(e,t,n){if(e===3){var r=new ws(n,n.readVarint()+n.pos);r.length&&(t[r.name]=r)}}Ts.prototype.feature=function(e){if(e<0||e>=this._features.length)throw Error(`feature index out of bounds`);this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new bs(this._pbf,t,this.extent,this._keys,this._values)};var Os={VectorTile:function(e,t){this.layers=e.readFields(Ds,{},t)},VectorTileFeature:bs,VectorTileLayer:ws},ks=Os.VectorTileFeature.types,As=2**13;function js(e,t,n,r,i,a,o,s){e.emplaceBack(t,n,2*Math.floor(r*As)+o,i*As*2,a*As*2,Math.round(s))}var Ms=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ri,this.indexArray=new Yi,this.programConfigurations=new Ha(e.layers,e.zoom),this.segments=new ha,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};function Ns(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Ms.prototype.populate=function(e,t,n){this.features=[],this.hasPattern=ps(`fill-extrusion`,this.layers,t);for(var r=0,i=e;r<i.length;r+=1){var a=i[r],o=a.feature,s=a.id,c=a.index,l=a.sourceLayerIndex,u=this.layers[0]._featureFilter.needGeometry,d=Ja(o,u);if(this.layers[0]._featureFilter.filter(new hi(this.zoom),d,n)){var f={id:s,sourceLayerIndex:l,index:c,geometry:u?d.geometry:qa(o),properties:o.properties,type:o.type,patterns:{}};this.hasPattern?this.features.push(ms(`fill-extrusion`,this.layers,f,this.zoom,t)):this.addFeature(f,f.geometry,c,n,{}),t.featureIndex.insert(o,f.geometry,c,l,this.index,!0)}}},Ms.prototype.addFeatures=function(e,t,n){for(var r=0,i=this.features;r<i.length;r+=1){var a=i[r];this.addFeature(a,a.geometry,a.index,t,n)}},Ms.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},Ms.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ms.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ms.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ys),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Ms.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ms.prototype.addFeature=function(e,t,n,r,i){for(var a=0,o=ds(t,500);a<o.length;a+=1){for(var s=o[a],c=0,l=0,u=s;l<u.length;l+=1)c+=u[l].length;for(var d=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),f=0,p=s;f<p.length;f+=1){var m=p[f];if(m.length!==0&&!((N=m).every((function(e){return e.x<0}))||N.every((function(e){return e.x>8192}))||N.every((function(e){return e.y<0}))||N.every((function(e){return e.y>8192}))))for(var h=0,g=0;g<m.length;g++){var _=m[g];if(g>=1){var v=m[g-1];if(!Ns(_,v)){d.vertexLength+4>ha.MAX_VERTEX_ARRAY_LENGTH&&(d=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var y=_.sub(v)._perp()._unit(),b=v.dist(_);h+b>32768&&(h=0),js(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,0,h),js(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,1,h),js(this.layoutVertexArray,v.x,v.y,y.x,y.y,0,0,h+=b),js(this.layoutVertexArray,v.x,v.y,y.x,y.y,0,1,h);var x=d.vertexLength;this.indexArray.emplaceBack(x,x+2,x+1),this.indexArray.emplaceBack(x+1,x+2,x+3),d.vertexLength+=4,d.primitiveLength+=2}}}}if(d.vertexLength+c>ha.MAX_VERTEX_ARRAY_LENGTH&&(d=this.segments.prepareSegment(c,this.layoutVertexArray,this.indexArray)),ks[e.type]===`Polygon`){for(var S=[],C=[],w=d.vertexLength,E=0,D=s;E<D.length;E+=1){var O=D[E];if(O.length!==0){O!==s[0]&&C.push(S.length/2);for(var k=0;k<O.length;k++){var A=O[k];js(this.layoutVertexArray,A.x,A.y,0,0,1,1,0),S.push(A.x),S.push(A.y)}}}for(var j=Po(S,C),M=0;M<j.length;M+=3)this.indexArray.emplaceBack(w+j[M],w+j[M+2],w+j[M+1]);d.primitiveLength+=j.length/3,d.vertexLength+=c}}var N;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)},Kr(`FillExtrusionBucket`,Ms,{omit:[`layers`,`features`]});var Ps={paint:new ki({"fill-extrusion-opacity":new wi(q[`paint_fill-extrusion`][`fill-extrusion-opacity`]),"fill-extrusion-color":new Ti(q[`paint_fill-extrusion`][`fill-extrusion-color`]),"fill-extrusion-translate":new wi(q[`paint_fill-extrusion`][`fill-extrusion-translate`]),"fill-extrusion-translate-anchor":new wi(q[`paint_fill-extrusion`][`fill-extrusion-translate-anchor`]),"fill-extrusion-pattern":new Ei(q[`paint_fill-extrusion`][`fill-extrusion-pattern`]),"fill-extrusion-height":new Ti(q[`paint_fill-extrusion`][`fill-extrusion-height`]),"fill-extrusion-base":new Ti(q[`paint_fill-extrusion`][`fill-extrusion-base`]),"fill-extrusion-vertical-gradient":new wi(q[`paint_fill-extrusion`][`fill-extrusion-vertical-gradient`])})},Fs=function(e){function t(t){e.call(this,t,Ps)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(e){return new Ms(e)},t.prototype.queryRadius=function(){return lo(this.paint.get(`fill-extrusion-translate`))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(e,t,n,r,a,o,s,c){var l=uo(e,this.paint.get(`fill-extrusion-translate`),this.paint.get(`fill-extrusion-translate-anchor`),o.angle,s),u=this.paint.get(`fill-extrusion-height`).evaluate(t,n),d=this.paint.get(`fill-extrusion-base`).evaluate(t,n),f=function(e,t,n,r){for(var a=[],o=0,s=e;o<s.length;o+=1){var c=s[o],l=[c.x,c.y,0,1];yo(l,l,t),a.push(new i(l[0]/l[3],l[1]/l[3]))}return a}(l,c),p=function(e,t,n,r){for(var a=[],o=[],s=r[8]*t,c=r[9]*t,l=r[10]*t,u=r[11]*t,d=r[8]*n,f=r[9]*n,p=r[10]*n,m=r[11]*n,h=0,g=e;h<g.length;h+=1){for(var _=[],v=[],y=0,b=g[h];y<b.length;y+=1){var x=b[y],S=x.x,C=x.y,w=r[0]*S+r[4]*C+r[12],E=r[1]*S+r[5]*C+r[13],D=r[2]*S+r[6]*C+r[14],O=r[3]*S+r[7]*C+r[15],k=D+l,A=O+u,j=w+d,M=E+f,N=D+p,P=O+m,F=new i((w+s)/A,(E+c)/A);F.z=k/A,_.push(F);var I=new i(j/P,M/P);I.z=N/P,v.push(I)}a.push(_),o.push(v)}return[a,o]}(r,d,u,c);return function(e,t,n){var r=1/0;$a(n,t)&&(r=Ls(n,t[0]));for(var i=0;i<t.length;i++)for(var a=t[i],o=e[i],s=0;s<a.length-1;s++){var c=a[s],l=[c,a[s+1],o[s+1],o[s],c];Za(n,l)&&(r=Math.min(r,Ls(n,l)))}return r!==1/0&&r}(p[0],p[1],f)},t}(Ai);function Is(e,t){return e.x*t.x+e.y*t.y}function Ls(e,t){if(e.length===1){for(var n,r=0,i=t[r++];!n||i.equals(n);)if(!(n=t[r++]))return 1/0;for(;r<t.length;r++){var a=t[r],o=e[0],s=n.sub(i),c=a.sub(i),l=o.sub(i),u=Is(s,s),d=Is(s,c),f=Is(c,c),p=Is(l,s),m=Is(l,c),h=u*f-d*d,g=(f*p-d*m)/h,_=(u*m-d*p)/h,v=i.z*(1-g-_)+n.z*g+a.z*_;if(isFinite(v))return v}return 1/0}for(var y=1/0,b=0,x=t;b<x.length;b+=1)y=Math.min(y,x[b].z);return y}var Rs=Pi([{name:`a_pos_normal`,components:2,type:`Int16`},{name:`a_data`,components:4,type:`Uint8`}],4).members,zs=Pi([{name:`a_uv_x`,components:1,type:`Float32`},{name:`a_split_index`,components:1,type:`Float32`}]).members,Bs=Os.VectorTileFeature.types,Vs=Math.cos(Math.PI/180*37.5),Hs=2**14/.5,Us=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(e){t.gradients[e.id]={}})),this.layoutVertexArray=new zi,this.layoutVertexArray2=new Bi,this.indexArray=new Yi,this.programConfigurations=new Ha(e.layers,e.zoom),this.segments=new ha,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))};Us.prototype.populate=function(e,t,n){this.hasPattern=ps(`line`,this.layers,t);for(var r=this.layers[0].layout.get(`line-sort-key`),i=[],a=0,o=e;a<o.length;a+=1){var s=o[a],c=s.feature,l=s.id,u=s.index,d=s.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,p=Ja(c,f);if(this.layers[0]._featureFilter.filter(new hi(this.zoom),p,n)){var m=r?r.evaluate(p,{},n):void 0,h={id:l,properties:c.properties,type:c.type,sourceLayerIndex:d,index:u,geometry:f?p.geometry:qa(c),patterns:{},sortKey:m};i.push(h)}}r&&i.sort((function(e,t){return e.sortKey-t.sortKey}));for(var g=0,_=i;g<_.length;g+=1){var v=_[g],y=v.geometry,b=v.index,x=v.sourceLayerIndex;if(this.hasPattern){var S=ms(`line`,this.layers,v,this.zoom,t);this.patternFeatures.push(S)}else this.addFeature(v,y,b,n,{});t.featureIndex.insert(e[b].feature,y,b,x,this.index)}},Us.prototype.update=function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)},Us.prototype.addFeatures=function(e,t,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var a=i[r];this.addFeature(a,a.geometry,a.index,t,n)}},Us.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Us.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,zs)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rs),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Us.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty(`mapbox_clip_start`)&&e.properties.hasOwnProperty(`mapbox_clip_end`))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Us.prototype.addFeature=function(e,t,n,r,i){var a=this.layers[0].layout,o=a.get(`line-join`).evaluate(e,{}),s=a.get(`line-cap`),c=a.get(`line-miter-limit`),l=a.get(`line-round-limit`);this.lineClips=this.lineFeatureClips(e);for(var u=0,d=t;u<d.length;u+=1)this.addLine(d[u],e,o,s,c,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)},Us.prototype.addLine=function(e,t,n,r,i,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var o=0;o<e.length-1;o++)this.totalDistance+=e[o].dist(e[o+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s=Bs[t.type]===`Polygon`,c=e.length;c>=2&&e[c-1].equals(e[c-2]);)c--;for(var l=0;l<c-1&&e[l].equals(e[l+1]);)l++;if(!(c<(s?3:2))){n===`bevel`&&(i=1.05);var u,d=this.overscaling<=16?122880/(512*this.overscaling):0,f=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray),p=void 0,m=void 0,h=void 0,g=void 0;this.e1=this.e2=-1,s&&(g=e[l].sub(u=e[c-2])._unit()._perp());for(var _=l;_<c;_++)if(!(m=_===c-1?s?e[l+1]:void 0:e[_+1])||!e[_].equals(m)){g&&(h=g),u&&(p=u),u=e[_],g=m?m.sub(u)._unit()._perp():h;var v=(h||=g).add(g);v.x===0&&v.y===0||v._unit();var y=h.x*g.x+h.y*g.y,b=v.x*g.x+v.y*g.y,x=b===0?1/0:1/b,S=2*Math.sqrt(2-2*b),C=b<Vs&&p&&m,w=h.x*g.y-h.y*g.x>0;if(C&&_>l){var E=u.dist(p);if(E>2*d){var D=u.sub(u.sub(p)._mult(d/E)._round());this.updateDistance(p,D),this.addCurrentVertex(D,h,0,0,f),p=D}}var O=p&&m,k=O?n:s?`butt`:r;if(O&&k===`round`&&(x<a?k=`miter`:x<=2&&(k=`fakeround`)),k===`miter`&&x>i&&(k=`bevel`),k===`bevel`&&(x>2&&(k=`flipbevel`),x<i&&(k=`miter`)),p&&this.updateDistance(p,u),k===`miter`)v._mult(x),this.addCurrentVertex(u,v,0,0,f);else if(k===`flipbevel`){if(x>100)v=g.mult(-1);else{var A=x*h.add(g).mag()/h.sub(g).mag();v._perp()._mult(A*(w?-1:1))}this.addCurrentVertex(u,v,0,0,f),this.addCurrentVertex(u,v.mult(-1),0,0,f)}else if(k===`bevel`||k===`fakeround`){var j=-Math.sqrt(x*x-1),M=w?j:0,N=w?0:j;if(p&&this.addCurrentVertex(u,h,M,N,f),k===`fakeround`)for(var P=Math.round(180*S/Math.PI/20),F=1;F<P;F++){var I=F/P;if(I!==.5){var ee=I-.5;I+=I*ee*(I-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*ee*ee+(.848013+y*(.215638*y-1.06021)))}var R=g.sub(h)._mult(I)._add(h)._unit()._mult(w?-1:1);this.addHalfVertex(u,R.x,R.y,!1,w,0,f)}m&&this.addCurrentVertex(u,g,-M,-N,f)}else if(k===`butt`)this.addCurrentVertex(u,v,0,0,f);else if(k===`square`){var z=p?1:-1;this.addCurrentVertex(u,v,z,z,f)}else k===`round`&&(p&&(this.addCurrentVertex(u,h,0,0,f),this.addCurrentVertex(u,h,1,1,f,!0)),m&&(this.addCurrentVertex(u,g,-1,-1,f,!0),this.addCurrentVertex(u,g,0,0,f)));if(C&&_<c-1){var B=u.dist(m);if(B>2*d){var te=u.add(m.sub(u)._mult(d/B)._round());this.updateDistance(u,te),this.addCurrentVertex(te,g,0,0,f),u=te}}}}},Us.prototype.addCurrentVertex=function(e,t,n,r,i,a){a===void 0&&(a=!1);var o=t.y*r-t.x,s=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,a,!1,n,i),this.addHalfVertex(e,o,s,a,!0,-r,i),this.distance>Hs/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,n,r,i,a))},Us.prototype.addHalfVertex=function(e,t,n,r,i,a,o){var s=.5*(this.lineClips?this.scaledDistance*(Hs-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(r?1:0),(e.y<<1)+(i?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(a===0?0:a<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var c=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),o.primitiveLength++),i?this.e2=c:this.e1=c},Us.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Us.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Kr(`LineBucket`,Us,{omit:[`layers`,`patternFeatures`]});var Ws=new ki({"line-cap":new wi(q.layout_line[`line-cap`]),"line-join":new Ti(q.layout_line[`line-join`]),"line-miter-limit":new wi(q.layout_line[`line-miter-limit`]),"line-round-limit":new wi(q.layout_line[`line-round-limit`]),"line-sort-key":new Ti(q.layout_line[`line-sort-key`])}),Gs={paint:new ki({"line-opacity":new Ti(q.paint_line[`line-opacity`]),"line-color":new Ti(q.paint_line[`line-color`]),"line-translate":new wi(q.paint_line[`line-translate`]),"line-translate-anchor":new wi(q.paint_line[`line-translate-anchor`]),"line-width":new Ti(q.paint_line[`line-width`]),"line-gap-width":new Ti(q.paint_line[`line-gap-width`]),"line-offset":new Ti(q.paint_line[`line-offset`]),"line-blur":new Ti(q.paint_line[`line-blur`]),"line-dasharray":new Di(q.paint_line[`line-dasharray`]),"line-pattern":new Ei(q.paint_line[`line-pattern`]),"line-gradient":new Oi(q.paint_line[`line-gradient`])}),layout:Ws},Ks=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(t,n){return n=new hi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),e.prototype.possiblyEvaluate.call(this,t,n)},t.prototype.evaluate=function(t,n,r,i){return n=f({},n,{zoom:Math.floor(n.zoom)}),e.prototype.evaluate.call(this,t,n,r,i)},t}(Ti))(Gs.paint.properties[`line-width`].specification);Ks.useIntegerZoom=!0;var qs=function(e){function t(t){e.call(this,t,Gs),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(e){e===`line-gradient`&&(this.stepInterpolant=this._transitionablePaint._values[`line-gradient`].value.expression._styleExpression.expression instanceof Zt,this.gradientVersion=(this.gradientVersion+1)%s)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values[`line-gradient`].value.expression},t.prototype.recalculate=function(t,n){e.prototype.recalculate.call(this,t,n),this.paint._values[`line-floorwidth`]=Ks.possiblyEvaluate(this._transitioningPaint._values[`line-width`].value,t)},t.prototype.createBucket=function(e){return new Us(e)},t.prototype.queryRadius=function(e){var t=e,n=Js(co(`line-width`,this,t),co(`line-gap-width`,this,t)),r=co(`line-offset`,this,t);return n/2+Math.abs(r)+lo(this.paint.get(`line-translate`))},t.prototype.queryIntersectsFeature=function(e,t,n,r,a,o,s){var c=uo(e,this.paint.get(`line-translate`),this.paint.get(`line-translate-anchor`),o.angle,s),l=s/2*Js(this.paint.get(`line-width`).evaluate(t,n),this.paint.get(`line-gap-width`).evaluate(t,n)),u=this.paint.get(`line-offset`).evaluate(t,n);return u&&(r=function(e,t){for(var n=[],r=new i(0,0),a=0;a<e.length;a++){for(var o=e[a],s=[],c=0;c<o.length;c++){var l=o[c],u=o[c+1],d=c===0?r:l.sub(o[c-1])._unit()._perp(),f=c===o.length-1?r:u.sub(l)._unit()._perp(),p=d._add(f)._unit();p._mult(1/(p.x*f.x+p.y*f.y)),s.push(p._mult(t)._add(l))}n.push(s)}return n}(r,u*s)),function(e,t,n){for(var r=0;r<t.length;r++){var i=t[r];if(e.length>=3){for(var a=0;a<i.length;a++)if(oo(e,i[a]))return!0}if(eo(e,i,n))return!0}return!1}(c,r,l)},t.prototype.isTileClipped=function(){return!0},t}(Ai);function Js(e,t){return t>0?t+2*e:e}var Ys=Pi([{name:`a_pos_offset`,components:4,type:`Int16`},{name:`a_data`,components:4,type:`Uint16`},{name:`a_pixeloffset`,components:4,type:`Int16`}],4),Xs=Pi([{name:`a_projected_pos`,components:3,type:`Float32`}],4),Zs=(Pi([{name:`a_fade_opacity`,components:1,type:`Uint32`}],4),Pi([{name:`a_placed`,components:2,type:`Uint8`},{name:`a_shift`,components:2,type:`Float32`}])),Qs=(Pi([{type:`Int16`,name:`anchorPointX`},{type:`Int16`,name:`anchorPointY`},{type:`Int16`,name:`x1`},{type:`Int16`,name:`y1`},{type:`Int16`,name:`x2`},{type:`Int16`,name:`y2`},{type:`Uint32`,name:`featureIndex`},{type:`Uint16`,name:`sourceLayerIndex`},{type:`Uint16`,name:`bucketIndex`}]),Pi([{name:`a_pos`,components:2,type:`Int16`},{name:`a_anchor_pos`,components:2,type:`Int16`},{name:`a_extrude`,components:2,type:`Int16`}],4)),$s=Pi([{name:`a_pos`,components:2,type:`Float32`},{name:`a_radius`,components:1,type:`Float32`},{name:`a_flags`,components:2,type:`Int16`}],4);function ec(e,t,n){return e.sections.forEach((function(e){e.text=function(e,t,n){var r=t.layout.get(`text-transform`).evaluate(n,{});return r===`uppercase`?e=e.toLocaleUpperCase():r===`lowercase`&&(e=e.toLocaleLowerCase()),mi.applyArabicShaping&&(e=mi.applyArabicShaping(e)),e}(e.text,t,n)})),e}Pi([{name:`triangle`,components:3,type:`Uint16`}]),Pi([{type:`Int16`,name:`anchorX`},{type:`Int16`,name:`anchorY`},{type:`Uint16`,name:`glyphStartIndex`},{type:`Uint16`,name:`numGlyphs`},{type:`Uint32`,name:`vertexStartIndex`},{type:`Uint32`,name:`lineStartIndex`},{type:`Uint32`,name:`lineLength`},{type:`Uint16`,name:`segment`},{type:`Uint16`,name:`lowerSize`},{type:`Uint16`,name:`upperSize`},{type:`Float32`,name:`lineOffsetX`},{type:`Float32`,name:`lineOffsetY`},{type:`Uint8`,name:`writingMode`},{type:`Uint8`,name:`placedOrientation`},{type:`Uint8`,name:`hidden`},{type:`Uint32`,name:`crossTileID`},{type:`Int16`,name:`associatedIconIndex`}]),Pi([{type:`Int16`,name:`anchorX`},{type:`Int16`,name:`anchorY`},{type:`Int16`,name:`rightJustifiedTextSymbolIndex`},{type:`Int16`,name:`centerJustifiedTextSymbolIndex`},{type:`Int16`,name:`leftJustifiedTextSymbolIndex`},{type:`Int16`,name:`verticalPlacedTextSymbolIndex`},{type:`Int16`,name:`placedIconSymbolIndex`},{type:`Int16`,name:`verticalPlacedIconSymbolIndex`},{type:`Uint16`,name:`key`},{type:`Uint16`,name:`textBoxStartIndex`},{type:`Uint16`,name:`textBoxEndIndex`},{type:`Uint16`,name:`verticalTextBoxStartIndex`},{type:`Uint16`,name:`verticalTextBoxEndIndex`},{type:`Uint16`,name:`iconBoxStartIndex`},{type:`Uint16`,name:`iconBoxEndIndex`},{type:`Uint16`,name:`verticalIconBoxStartIndex`},{type:`Uint16`,name:`verticalIconBoxEndIndex`},{type:`Uint16`,name:`featureIndex`},{type:`Uint16`,name:`numHorizontalGlyphVertices`},{type:`Uint16`,name:`numVerticalGlyphVertices`},{type:`Uint16`,name:`numIconVertices`},{type:`Uint16`,name:`numVerticalIconVertices`},{type:`Uint16`,name:`useRuntimeCollisionCircles`},{type:`Uint32`,name:`crossTileID`},{type:`Float32`,name:`textBoxScale`},{type:`Float32`,components:2,name:`textOffset`},{type:`Float32`,name:`collisionCircleDiameter`}]),Pi([{type:`Float32`,name:`offsetX`}]),Pi([{type:`Int16`,name:`x`},{type:`Int16`,name:`y`},{type:`Int16`,name:`tileUnitDistanceFromAnchor`}]);var tc={"!":`︕`,"#":`＃`,$:`＄`,"%":`％`,"&":`＆`,"(":`︵`,")":`︶`,"*":`＊`,"+":`＋`,",":`︐`,"-":`︲`,".":`・`,"/":`／`,":":`︓`,";":`︔`,"<":`︿`,"=":`＝`,">":`﹀`,"?":`︖`,"@":`＠`,"[":`﹇`,"\\":`＼`,"]":`﹈`,"^":`＾`,_:`︳`,"`":`｀`,"{":`︷`,"|":`―`,"}":`︸`,"~":`～`,"¢":`￠`,"£":`￡`,"¥":`￥`,"¦":`￤`,"¬":`￢`,"¯":`￣`,"–":`︲`,"—":`︱`,"‘":`﹃`,"’":`﹄`,"“":`﹁`,"”":`﹂`,"…":`︙`,"‧":`・`,"₩":`￦`,"、":`︑`,"。":`︒`,"〈":`︿`,"〉":`﹀`,"《":`︽`,"》":`︾`,"「":`﹁`,"」":`﹂`,"『":`﹃`,"』":`﹄`,"【":`︻`,"】":`︼`,"〔":`︹`,"〕":`︺`,"〖":`︗`,"〗":`︘`,"！":`︕`,"（":`︵`,"）":`︶`,"，":`︐`,"－":`︲`,"．":`・`,"：":`︓`,"；":`︔`,"＜":`︿`,"＞":`﹀`,"？":`︖`,"［":`﹇`,"］":`﹈`,"＿":`︳`,"｛":`︷`,"｜":`―`,"｝":`︸`,"｟":`︵`,"｠":`︶`,"｡":`︒`,"｢":`﹁`,"｣":`﹂`},nc=function(e,t,n,r,i){var a,o,s=8*i-r-1,c=(1<<s)-1,l=c>>1,u=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,a=p&(1<<-u)-1,p>>=-u,u+=s;u>0;a=256*a+e[t+d],d+=f,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+d],d+=f,u-=8);if(a===0)a=1-l;else{if(a===c)return o?NaN:1/0*(p?-1:1);o+=2**r,a-=l}return(p?-1:1)*o*2**(a-r)},rc=function(e,t,n,r,i,a){var o,s,c,l=8*a-i-1,u=(1<<l)-1,d=u>>1,f=i===23?2**-24-2**-77:0,p=r?0:a-1,m=r?1:-1,h=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=2**-o)<1&&(o--,c*=2),(t+=o+d>=1?f/c:f*2**(1-d))*c>=2&&(o++,c/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*c-1)*2**i,o+=d):(s=t*2**(d-1)*2**i,o=0));i>=8;e[n+p]=255&s,p+=m,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[n+p]=255&o,p+=m,o/=256,l-=8);e[n+p-m]|=128*h},ic=ac;function ac(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ac.Varint=0,ac.Fixed64=1,ac.Bytes=2,ac.Fixed32=5;var oc=typeof TextDecoder>`u`?null:new TextDecoder(`utf8`);function sc(e){return e.type===ac.Bytes?e.readVarint()+e.pos:e.pos+1}function cc(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function lc(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function uc(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function dc(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function fc(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function pc(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function mc(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function hc(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function gc(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function _c(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function vc(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function yc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function bc(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function xc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Sc(e,t,n){e===1&&n.readMessage(Cc,t)}function Cc(e,t,n){if(e===3){var r=n.readMessage(wc,{}),i=r.width,a=r.height,o=r.left,s=r.top,c=r.advance;t.push({id:r.id,bitmap:new Eo({width:i+6,height:a+6},r.bitmap),metrics:{width:i,height:a,left:o,top:s,advance:c}})}}function wc(e,t,n){e===1?t.id=n.readVarint():e===2?t.bitmap=n.readBytes():e===3?t.width=n.readVarint():e===4?t.height=n.readVarint():e===5?t.left=n.readSVarint():e===6?t.top=n.readSVarint():e===7&&(t.advance=n.readVarint())}function Tc(e){for(var t=0,n=0,r=0,i=e;r<i.length;r+=1){var a=i[r];t+=a.w*a.h,n=Math.max(n,a.w)}e.sort((function(e,t){return t.h-e.h}));for(var o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}],s=0,c=0,l=0,u=e;l<u.length;l+=1)for(var d=u[l],f=o.length-1;f>=0;f--){var p=o[f];if(!(d.w>p.w||d.h>p.h)){if(d.x=p.x,d.y=p.y,c=Math.max(c,d.y+d.h),s=Math.max(s,d.x+d.w),d.w===p.w&&d.h===p.h){var m=o.pop();f<o.length&&(o[f]=m)}else d.h===p.h?(p.x+=d.w,p.w-=d.w):d.w===p.w?(p.y+=d.h,p.h-=d.h):(o.push({x:p.x+d.w,y:p.y,w:p.w-d.w,h:d.h}),p.y+=d.h,p.h-=d.h);break}}return{w:s,h:c,fill:t/(s*c)||0}}ac.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n||=this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,a=this.pos;this.type=7&r,e(i,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=yc(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=xc(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=yc(this.buf,this.pos)+4294967296*yc(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=yc(this.buf,this.pos)+4294967296*xc(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=nc(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=nc(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,a=n.buf;if(r=(112&(i=a[n.pos++]))>>4,i<128||(r|=(127&(i=a[n.pos++]))<<3,i<128)||(r|=(127&(i=a[n.pos++]))<<10,i<128)||(r|=(127&(i=a[n.pos++]))<<17,i<128)||(r|=(127&(i=a[n.pos++]))<<24,i<128)||(r|=(1&(i=a[n.pos++]))<<31,i<128))return cc(e,r,t);throw Error(`Expected varint not more than 10 bytes`)}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&oc?function(e,t,n){return oc.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var r=``,i=t;i<n;){var a,o,s,c=e[i],l=null,u=c>239?4:c>223?3:c>191?2:1;if(i+u>n)break;u===1?c<128&&(l=c):u===2?(192&(a=e[i+1]))==128&&(l=(31&c)<<6|63&a)<=127&&(l=null):u===3?(o=e[i+2],(192&(a=e[i+1]))==128&&(192&o)==128&&((l=(15&c)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):u===4&&(o=e[i+2],s=e[i+3],(192&(a=e[i+1]))==128&&(192&o)==128&&(192&s)==128&&((l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),l===null?(l=65533,u=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ac.Bytes)return e.push(this.readVarint(t));var n=sc(this);for(e||=[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ac.Bytes)return e.push(this.readSVarint());var t=sc(this);for(e||=[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ac.Bytes)return e.push(this.readBoolean());var t=sc(this);for(e||=[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ac.Bytes)return e.push(this.readFloat());var t=sc(this);for(e||=[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ac.Bytes)return e.push(this.readDouble());var t=sc(this);for(e||=[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ac.Bytes)return e.push(this.readFixed32());var t=sc(this);for(e||=[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ac.Bytes)return e.push(this.readSFixed32());var t=sc(this);for(e||=[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ac.Bytes)return e.push(this.readFixed64());var t=sc(this);for(e||=[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ac.Bytes)return e.push(this.readSFixed64());var t=sc(this);for(e||=[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ac.Varint)for(;this.buf[this.pos++]>127;);else if(t===ac.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ac.Fixed32)this.pos+=4;else{if(t!==ac.Fixed64)throw Error(`Unimplemented type: `+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),bc(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),bc(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),bc(this.buf,-1&e,this.pos),bc(this.buf,Math.floor(1/4294967296*e),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),bc(this.buf,-1&e,this.pos),bc(this.buf,Math.floor(1/4294967296*e),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw Error(`Given varint doesn't fit into 10 bytes`);t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,a=0;a<t.length;a++){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){r>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&=(e[n++]=239,e[n++]=191,e[n++]=189,null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&lc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),rc(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),rc(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&lc(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,ac.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,uc,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,dc,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,mc,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,fc,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,pc,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,hc,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,gc,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,_c,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,vc,t)},writeBytesField:function(e,t){this.writeTag(e,ac.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ac.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ac.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ac.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ac.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ac.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ac.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ac.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ac.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ac.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var Ec=function(e,t){var n=t.pixelRatio,r=t.version,i=t.stretchX,a=t.stretchY,o=t.content;this.paddedRect=e,this.pixelRatio=n,this.stretchX=i,this.stretchY=a,this.content=o,this.version=r},Dc={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Dc.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Dc.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Dc.tlbr.get=function(){return this.tl.concat(this.br)},Dc.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Ec.prototype,Dc);var Oc=function(e,t){var n={},r={};this.haveRenderCallbacks=[];var i=[];this.addImages(e,n,i),this.addImages(t,r,i);var a=Tc(i),o=new Do({width:a.w||1,height:a.h||1});for(var s in e){var c=e[s],l=n[s].paddedRect;Do.copy(c.data,o,{x:0,y:0},{x:l.x+1,y:l.y+1},c.data)}for(var u in t){var d=t[u],f=r[u].paddedRect,p=f.x+1,m=f.y+1,h=d.data.width,g=d.data.height;Do.copy(d.data,o,{x:0,y:0},{x:p,y:m},d.data),Do.copy(d.data,o,{x:0,y:g-1},{x:p,y:m-1},{width:h,height:1}),Do.copy(d.data,o,{x:0,y:0},{x:p,y:m+g},{width:h,height:1}),Do.copy(d.data,o,{x:h-1,y:0},{x:p-1,y:m},{width:1,height:g}),Do.copy(d.data,o,{x:0,y:0},{x:p+h,y:m},{width:1,height:g})}this.image=o,this.iconPositions=n,this.patternPositions=r};Oc.prototype.addImages=function(e,t,n){for(var r in e){var i=e[r],a={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(a),t[r]=new Ec(a,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},Oc.prototype.patchUpdatedImages=function(e,t){for(var n in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)},Oc.prototype.patchUpdatedImage=function(e,t,n){if(e&&t&&e.version!==t.version){e.version=t.version;var r=e.tl;n.update(t.data,void 0,{x:r[0],y:r[1]})}},Kr(`ImagePosition`,Ec),Kr(`ImageAtlas`,Oc);var kc={horizontal:1,vertical:2,horizontalOnly:3},Ac=function(){this.scale=1,this.fontStack=``,this.imageName=null};Ac.forText=function(e,t){var n=new Ac;return n.scale=e||1,n.fontStack=t,n},Ac.forImage=function(e){var t=new Ac;return t.imageName=e,t};var jc=function(){this.text=``,this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Mc(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){var g,_=jc.fromFeature(e,i);d===kc.vertical&&_.verticalizePunctuation();var v=mi.processBidirectionalText,y=mi.processStyledBidirectionalText;if(v&&_.sections.length===1){g=[];for(var b=0,x=v(_.toString(),zc(_,l,a,t,r,p,m));b<x.length;b+=1){var S=x[b],C=new jc;C.text=S,C.sections=_.sections;for(var w=0;w<S.length;w++)C.sectionIndex.push(0);g.push(C)}}else if(y){g=[];for(var E=0,D=y(_.text,_.sectionIndex,zc(_,l,a,t,r,p,m));E<D.length;E+=1){var O=D[E],k=new jc;k.text=O[0],k.sectionIndex=O[1],k.sections=_.sections,g.push(k)}}else g=function(e,t){for(var n=[],r=e.text,i=0,a=0,o=t;a<o.length;a+=1){var s=o[a];n.push(e.substring(i,s)),i=s}return i<r.length&&n.push(e.substring(i,r.length)),n}(_,zc(_,l,a,t,r,p,m));var A=[],j={positionedLines:A,text:_.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,t,n,r,i,a,o,s,c,l,u,d){for(var f=0,p=-17,m=0,h=0,g=s===`right`?1:s===`left`?0:.5,_=0,v=0,y=i;v<y.length;v+=1){var b=y[v];b.trim();var x=b.getMaxScale(),S=24*(x-1),C={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=C;var w=C.positionedGlyphs,E=0;if(b.length()){for(var D=0;D<b.length();D++){var O=b.getSection(D),k=b.getSectionIndex(D),A=b.getCharCode(D),j=0,M=null,N=null,P=null,F=24,I=!(c===kc.horizontal||!u&&!ti(A)||u&&(Nc[A]||(ie=A,$r.Arabic(ie)||$r[`Arabic Supplement`](ie)||$r[`Arabic Extended-A`](ie)||$r[`Arabic Presentation Forms-A`](ie)||$r[`Arabic Presentation Forms-B`](ie))));if(O.imageName){var ee=r[O.imageName];if(!ee)continue;P=O.imageName,e.iconsInText=e.iconsInText||!0,N=ee.paddedRect;var R=ee.displaySize;O.scale=24*O.scale/d,j=S+(24-R[1]*O.scale),F=(M={width:R[0],height:R[1],left:1,top:-3,advance:I?R[1]:R[0]}).advance;var z=I?R[0]*O.scale-24*x:R[1]*O.scale-24*x;z>0&&z>E&&(E=z)}else{var B=n[O.fontStack],te=B&&B[A];if(te&&te.rect)N=te.rect,M=te.metrics;else{var ne=t[O.fontStack],re=ne&&ne[A];if(!re)continue;M=re.metrics}j=24*(x-O.scale)}I?(e.verticalizable=!0,w.push({glyph:A,imageName:P,x:f,y:p+j,vertical:I,scale:O.scale,fontStack:O.fontStack,sectionIndex:k,metrics:M,rect:N}),f+=F*O.scale+l):(w.push({glyph:A,imageName:P,x:f,y:p+j,vertical:I,scale:O.scale,fontStack:O.fontStack,sectionIndex:k,metrics:M,rect:N}),f+=M.advance*O.scale+l)}w.length!==0&&(m=Math.max(f-l,m),Vc(w,0,w.length-1,g,E)),f=0;var V=a*x+E;C.lineOffset=Math.max(E,S),p+=V,h=Math.max(V,h),++_}else p+=a,++_}var ie,ae=p- -17,oe=Bc(o),se=oe.horizontalAlign,ce=oe.verticalAlign;(function(e,t,n,r,i,a,o,s,c){var l,u=(t-n)*i;l=a===o?(-r*c+.5)*o:-s*r- -17;for(var d=0,f=e;d<f.length;d+=1)for(var p=0,m=f[d].positionedGlyphs;p<m.length;p+=1){var h=m[p];h.x+=u,h.y+=l}})(e.positionedLines,g,se,ce,m,h,a,ae,i.length),e.top+=-ce*ae,e.bottom=e.top+ae,e.left+=-se*m,e.right=e.left+m}(j,t,n,r,g,o,s,c,d,l,f,h),!function(e){for(var t=0,n=e;t<n.length;t+=1)if(n[t].positionedGlyphs.length!==0)return!1;return!0}(A)&&j}jc.fromFeature=function(e,t){for(var n=new jc,r=0;r<e.sections.length;r++){var i=e.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,t)}return n},jc.prototype.length=function(){return this.text.length},jc.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},jc.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},jc.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},jc.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t=``,n=0;n<e.length;n++){var r=e.charCodeAt(n+1)||null,i=e.charCodeAt(n-1)||null;t+=r&&ni(r)&&!tc[e[n+1]]||i&&ni(i)&&!tc[e[n-1]]||!tc[e[n]]?e[n]:tc[e[n]]}return t}(this.text)},jc.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Nc[this.text.charCodeAt(t)];t++)e++;for(var n=this.text.length,r=this.text.length-1;r>=0&&r>=e&&Nc[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)},jc.prototype.substring=function(e,t){var n=new jc;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n},jc.prototype.toString=function(){return this.text},jc.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce((function(t,n){return Math.max(t,e.sections[n].scale)}),0)},jc.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(Ac.forText(e.scale,e.fontStack||t));for(var n=this.sections.length-1,r=0;r<e.text.length;++r)this.sectionIndex.push(n)},jc.prototype.addImageSection=function(e){var t=e.image?e.image.name:``;if(t.length!==0){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Ac.forImage(t)),this.sectionIndex.push(this.sections.length-1)):C(`Reached maximum number of images 6401`)}else C(`Can't add FormattedSection with an empty image.`)},jc.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Nc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pc={};function Fc(e,t,n,r,i,a){if(t.imageName){var o=r[t.imageName];return o?o.displaySize[0]*t.scale*24/a+i:0}var s=n[t.fontStack],c=s&&s[e];return c?c.metrics.advance*t.scale+i:0}function Ic(e,t,n,r){var i=(e-t)**2;return r?e<t?i/2:2*i:i+Math.abs(n)*n}function Lc(e,t,n){var r=0;return e===10&&(r-=1e4),n&&(r+=150),e!==40&&e!==65288||(r+=50),t!==41&&t!==65289||(r+=50),r}function Rc(e,t,n,r,i,a){for(var o=null,s=Ic(t,n,i,a),c=0,l=r;c<l.length;c+=1){var u=l[c],d=Ic(t-u.x,n,i,a)+u.badness;d<=s&&(o=u,s=d)}return{index:e,x:t,priorBreak:o,badness:s}}function zc(e,t,n,r,i,a,o){if(a!==`point`||!e)return[];for(var s,c=[],l=function(e,t,n,r,i,a){for(var o=0,s=0;s<e.length();s++){var c=e.getSection(s);o+=Fc(e.getCharCode(s),c,r,i,t,a)}return o/Math.max(1,Math.ceil(o/n))}(e,t,n,r,i,o),u=e.text.indexOf(`​`)>=0,d=0,f=0;f<e.length();f++){var p=e.getSection(f),m=e.getCharCode(f);if(Nc[m]||(d+=Fc(m,p,r,i,t,o)),f<e.length()-1){var h=!((s=m)<11904||!($r[`Bopomofo Extended`](s)||$r.Bopomofo(s)||$r[`CJK Compatibility Forms`](s)||$r[`CJK Compatibility Ideographs`](s)||$r[`CJK Compatibility`](s)||$r[`CJK Radicals Supplement`](s)||$r[`CJK Strokes`](s)||$r[`CJK Symbols and Punctuation`](s)||$r[`CJK Unified Ideographs Extension A`](s)||$r[`CJK Unified Ideographs`](s)||$r[`Enclosed CJK Letters and Months`](s)||$r[`Halfwidth and Fullwidth Forms`](s)||$r.Hiragana(s)||$r[`Ideographic Description Characters`](s)||$r[`Kangxi Radicals`](s)||$r[`Katakana Phonetic Extensions`](s)||$r.Katakana(s)||$r[`Vertical Forms`](s)||$r[`Yi Radicals`](s)||$r[`Yi Syllables`](s)));(Pc[m]||h||p.imageName)&&c.push(Rc(f+1,d,l,c,Lc(m,e.getCharCode(f+1),h&&u),!1))}}return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(Rc(e.length(),d,l,c,0,!0))}function Bc(e){var t=.5,n=.5;switch(e){case`right`:case`top-right`:case`bottom-right`:t=1;break;case`left`:case`top-left`:case`bottom-left`:t=0}switch(e){case`bottom`:case`bottom-right`:case`bottom-left`:n=1;break;case`top`:case`top-right`:case`top-left`:n=0}return{horizontalAlign:t,verticalAlign:n}}function Vc(e,t,n,r,i){if(r||i)for(var a=e[n],o=(e[n].x+a.metrics.advance*a.scale)*r,s=t;s<=n;s++)e[s].x-=o,e[s].y+=i}function Hc(e,t,n,r,i,a){var o,s=e.image;if(s.content){var c=s.content,l=s.pixelRatio||1;o=[c[0]/l,c[1]/l,s.displaySize[0]-c[2]/l,s.displaySize[1]-c[3]/l]}var u,d,f,p,m=t.left*a,h=t.right*a;n===`width`||n===`both`?(p=i[0]+m-r[3],d=i[0]+h+r[1]):d=(p=i[0]+(m+h-s.displaySize[0])/2)+s.displaySize[0];var g=t.top*a,_=t.bottom*a;return n===`height`||n===`both`?(u=i[1]+g-r[0],f=i[1]+_+r[2]):f=(u=i[1]+(g+_-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:u,right:d,bottom:f,left:p,collisionPadding:o}}Pc[10]=!0,Pc[32]=!0,Pc[38]=!0,Pc[40]=!0,Pc[41]=!0,Pc[43]=!0,Pc[45]=!0,Pc[47]=!0,Pc[173]=!0,Pc[183]=!0,Pc[8203]=!0,Pc[8208]=!0,Pc[8211]=!0,Pc[8231]=!0;var Uc=function(e){function t(t,n,r,i){e.call(this,t,n),this.angle=r,i!==void 0&&(this.segment=i)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(i);function Wc(e,t){var n=t.expression;if(n.kind===`constant`)return{kind:`constant`,layoutSize:n.evaluate(new hi(e+1))};if(n.kind===`source`)return{kind:`source`};for(var r=n.zoomStops,i=n.interpolationType,a=0;a<r.length&&r[a]<=e;)a++;for(var o=a=Math.max(0,a-1);o<r.length&&r[o]<e+1;)o++;o=Math.min(r.length-1,o);var s=r[a],c=r[o];return n.kind===`composite`?{kind:`composite`,minZoom:s,maxZoom:c,interpolationType:i}:{kind:`camera`,minZoom:s,maxZoom:c,minSize:n.evaluate(new hi(s)),maxSize:n.evaluate(new hi(c)),interpolationType:i}}function Gc(e,t,n){var r=t.uSize,i=n.lowerSize;return e.kind===`source`?i/128:e.kind===`composite`?Qt(i/128,n.upperSize/128,t.uSizeT):r}function Kc(e,t){var n=0,r=0;if(e.kind===`constant`)r=e.layoutSize;else if(e.kind!==`source`){var i=e.interpolationType,a=i?u(mn.interpolationFactor(i,t,e.minZoom,e.maxZoom),0,1):0;e.kind===`camera`?r=Qt(e.minSize,e.maxSize,a):n=a}return{uSizeT:n,uSize:r}}Kr(`Anchor`,Uc);var qc=Object.freeze({__proto__:null,getSizeData:Wc,evaluateSizeForFeature:Gc,evaluateSizeForZoom:Kc,SIZE_PACK_FACTOR:128});function Jc(e,t,n,r,i){if(t.segment===void 0)return!0;for(var a=t,o=t.segment+1,s=0;s>-n/2;){if(--o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;for(var c=[],l=0;s<n/2;){var u=e[o],d=e[o+1];if(!d)return!1;var f=e[o-1].angleTo(u)-u.angleTo(d);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),c.push({distance:s,angleDelta:f}),l+=f;s-c[0].distance>r;)l-=c.shift().angleDelta;if(l>i)return!1;o++,s+=u.dist(d)}return!0}function Yc(e){for(var t=0,n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Xc(e,t,n){return e?.6*t*n:0}function Zc(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Qc(e,t,n,r,i,a){for(var o=Xc(n,i,a),s=Zc(n,r)*a,c=0,l=Yc(e)/2,u=0;u<e.length-1;u++){var d=e[u],f=e[u+1],p=d.dist(f);if(c+p>l){var m=(l-c)/p,h=new Uc(Qt(d.x,f.x,m),Qt(d.y,f.y,m),f.angleTo(d),u);return h._round(),!o||Jc(e,h,s,o,t)?h:void 0}c+=p}}function $c(e,t,n,r,i,a,o,s,c){var l=Xc(r,a,o),u=Zc(r,i),d=u*o,f=e[0].x===0||e[0].x===c||e[0].y===0||e[0].y===c;return t-d<t/4&&(t=d+t/4),function e(t,n,r,i,a,o,s,c,l){for(var u=o/2,d=Yc(t),f=0,p=n-r,m=[],h=0;h<t.length-1;h++){for(var g=t[h],_=t[h+1],v=g.dist(_),y=_.angleTo(g);p+r<f+v;){var b=((p+=r)-f)/v,x=Qt(g.x,_.x,b),S=Qt(g.y,_.y,b);if(x>=0&&x<l&&S>=0&&S<l&&p-u>=0&&p+u<=d){var C=new Uc(x,S,y,h);C._round(),i&&!Jc(t,C,o,i,a)||m.push(C)}}f+=v}return c||m.length||s||(m=e(t,f/2,r,i,a,o,s,!0,l)),m}(e,f?t/2*s%t:(u/2+2*a)*o*s%t,t,l,n,d,f,!1,c)}function el(e,t,n,r,a){for(var o=[],s=0;s<e.length;s++)for(var c=e[s],l=void 0,u=0;u<c.length-1;u++){var d=c[u],f=c[u+1];d.x<t&&f.x<t||(d.x<t?d=new i(t,d.y+(t-d.x)/(f.x-d.x)*(f.y-d.y))._round():f.x<t&&(f=new i(t,d.y+(t-d.x)/(f.x-d.x)*(f.y-d.y))._round()),d.y<n&&f.y<n||(d.y<n?d=new i(d.x+(n-d.y)/(f.y-d.y)*(f.x-d.x),n)._round():f.y<n&&(f=new i(d.x+(n-d.y)/(f.y-d.y)*(f.x-d.x),n)._round()),d.x>=r&&f.x>=r||(d.x>=r?d=new i(r,d.y+(r-d.x)/(f.x-d.x)*(f.y-d.y))._round():f.x>=r&&(f=new i(r,d.y+(r-d.x)/(f.x-d.x)*(f.y-d.y))._round()),d.y>=a&&f.y>=a||(d.y>=a?d=new i(d.x+(a-d.y)/(f.y-d.y)*(f.x-d.x),a)._round():f.y>=a&&(f=new i(d.x+(a-d.y)/(f.y-d.y)*(f.x-d.x),a)._round()),l&&d.equals(l[l.length-1])||o.push(l=[d]),l.push(f)))))}return o}function tl(e,t,n,r){var a=[],o=e.image,s=o.pixelRatio,c=o.paddedRect.w-2,l=o.paddedRect.h-2,u=e.right-e.left,d=e.bottom-e.top,f=o.stretchX||[[0,c]],p=o.stretchY||[[0,l]],m=function(e,t){return e+t[1]-t[0]},h=f.reduce(m,0),g=p.reduce(m,0),_=c-h,v=l-g,y=0,b=h,x=0,S=g,C=0,w=_,E=0,D=v;if(o.content&&r){var O=o.content;y=nl(f,0,O[0]),x=nl(p,0,O[1]),b=nl(f,O[0],O[2]),S=nl(p,O[1],O[3]),C=O[0]-y,E=O[1]-x,w=O[2]-O[0]-b,D=O[3]-O[1]-S}var k=function(r,a,c,l){var f=il(r.stretch-y,b,u,e.left),p=al(r.fixed-C,w,r.stretch,h),m=il(a.stretch-x,S,d,e.top),_=al(a.fixed-E,D,a.stretch,g),v=il(c.stretch-y,b,u,e.left),O=al(c.fixed-C,w,c.stretch,h),k=il(l.stretch-x,S,d,e.top),A=al(l.fixed-E,D,l.stretch,g),j=new i(f,m),M=new i(v,m),N=new i(v,k),P=new i(f,k),F=new i(p/s,_/s),I=new i(O/s,A/s),ee=t*Math.PI/180;if(ee){var R=Math.sin(ee),z=Math.cos(ee),B=[z,-R,R,z];j._matMult(B),M._matMult(B),P._matMult(B),N._matMult(B)}var te=r.stretch+r.fixed,ne=a.stretch+a.fixed;return{tl:j,tr:M,bl:P,br:N,tex:{x:o.paddedRect.x+1+te,y:o.paddedRect.y+1+ne,w:c.stretch+c.fixed-te,h:l.stretch+l.fixed-ne},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:F,pixelOffsetBR:I,minFontScaleX:w/s/u,minFontScaleY:D/s/d,isSDF:n}};if(r&&(o.stretchX||o.stretchY))for(var A=rl(f,_,h),j=rl(p,v,g),M=0;M<A.length-1;M++)for(var N=A[M],P=A[M+1],F=0;F<j.length-1;F++)a.push(k(N,j[F],P,j[F+1]));else a.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:c+1},{fixed:0,stretch:l+1}));return a}function nl(e,t,n){for(var r=0,i=0,a=e;i<a.length;i+=1){var o=a[i];r+=Math.max(t,Math.min(n,o[1]))-Math.max(t,Math.min(n,o[0]))}return r}function rl(e,t,n){for(var r=[{fixed:-1,stretch:0}],i=0,a=e;i<a.length;i+=1){var o=a[i],s=o[0],c=o[1],l=r[r.length-1];r.push({fixed:s-l.stretch,stretch:l.stretch}),r.push({fixed:s-l.stretch,stretch:l.stretch+(c-s)})}return r.push({fixed:t+1,stretch:n}),r}function il(e,t,n,r){return e/t*n+r}function al(e,t,n,r){return e-t*n/r}var ol=function(e,t,n,r,a,o,s,c,l,u){if(this.boxStartIndex=e.length,l){var d=o.top,f=o.bottom,p=o.collisionPadding;p&&(d-=p[1],f+=p[3]);var m=f-d;m>0&&(m=Math.max(10,m),this.circleDiameter=m)}else{var h=o.top*s-c,g=o.bottom*s+c,_=o.left*s-c,v=o.right*s+c,y=o.collisionPadding;if(y&&(_-=y[0]*s,h-=y[1]*s,v+=y[2]*s,g+=y[3]*s),u){var b=new i(_,h),x=new i(v,h),S=new i(_,g),C=new i(v,g),w=u*Math.PI/180;b._rotate(w),x._rotate(w),S._rotate(w),C._rotate(w),_=Math.min(b.x,x.x,S.x,C.x),v=Math.max(b.x,x.x,S.x,C.x),h=Math.min(b.y,x.y,S.y,C.y),g=Math.max(b.y,x.y,S.y,C.y)}e.emplaceBack(t.x,t.y,_,h,v,g,n,r,a)}this.boxEndIndex=e.length},sl=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=cl),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function cl(e,t){return e<t?-1:e>t?1:0}function ll(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!1);for(var r=1/0,a=1/0,o=-1/0,s=-1/0,c=e[0],l=0;l<c.length;l++){var u=c[l];(!l||u.x<r)&&(r=u.x),(!l||u.y<a)&&(a=u.y),(!l||u.x>o)&&(o=u.x),(!l||u.y>s)&&(s=u.y)}var d=Math.min(o-r,s-a),f=d/2,p=new sl([],ul);if(d===0)return new i(r,a);for(var m=r;m<o;m+=d)for(var h=a;h<s;h+=d)p.push(new dl(m+f,h+f,f,e));for(var g=function(e){for(var t=0,n=0,r=0,i=e[0],a=0,o=i.length,s=o-1;a<o;s=a++){var c=i[a],l=i[s],u=c.x*l.y-l.x*c.y;n+=(c.x+l.x)*u,r+=(c.y+l.y)*u,t+=3*u}return new dl(n/t,r/t,0,e)}(e),_=p.length;p.length;){var v=p.pop();(v.d>g.d||!g.d)&&(g=v,n&&console.log(`found best %d after %d probes`,Math.round(1e4*v.d)/1e4,_)),v.max-g.d<=t||(p.push(new dl(v.p.x-(f=v.h/2),v.p.y-f,f,e)),p.push(new dl(v.p.x+f,v.p.y-f,f,e)),p.push(new dl(v.p.x-f,v.p.y+f,f,e)),p.push(new dl(v.p.x+f,v.p.y+f,f,e)),_+=4)}return n&&(console.log(`num probes: `+_),console.log(`best distance: `+g.d)),g.p}function ul(e,t){return t.max-e.max}function dl(e,t,n,r){this.p=new i(e,t),this.h=n,this.d=function(e,t){for(var n=!1,r=1/0,i=0;i<t.length;i++)for(var a=t[i],o=0,s=a.length,c=s-1;o<s;c=o++){var l=a[o],u=a[c];l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(n=!n),r=Math.min(r,io(e,l,u))}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}sl.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},sl.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},sl.prototype.peek=function(){return this.data[0]},sl.prototype._up=function(e){for(var t=this.data,n=this.compare,r=t[e];e>0;){var i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r},sl.prototype._down=function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var a=1+(e<<1),o=t[a],s=a+1;if(s<this.length&&n(t[s],o)<0&&(a=s,o=t[s]),n(o,i)>=0)break;t[e]=o,e=a}t[e]=i};var fl=1/0;function pl(e,t){return t[1]===fl?function(e,t){var n=0,r=0;t<0&&(t=0);var i=t/Math.sqrt(2);switch(e){case`top-right`:case`top-left`:r=i-7;break;case`bottom-right`:case`bottom-left`:r=7-i;break;case`bottom`:r=7-t;break;case`top`:r=t-7}switch(e){case`top-right`:case`bottom-right`:n=-i;break;case`top-left`:case`bottom-left`:n=i;break;case`left`:n=t;break;case`right`:n=-t}return[n,r]}(e,t[0]):function(e,t,n){var r=0,i=0;switch(t=Math.abs(t),n=Math.abs(n),e){case`top-right`:case`top-left`:case`top`:i=n-7;break;case`bottom-right`:case`bottom-left`:case`bottom`:i=7-n}switch(e){case`top-right`:case`bottom-right`:case`right`:r=-t;break;case`top-left`:case`bottom-left`:case`left`:r=t}return[r,i]}(e,t[0],t[1])}function ml(e){switch(e){case`right`:case`top-right`:case`bottom-right`:return`right`;case`left`:case`top-left`:case`bottom-left`:return`left`}return`center`}function hl(e,t,n,r,a,o,s,c,l,u,d,f,p,m,h){var g=function(e,t,n,r,a,o,s,c){for(var l=r.layout.get(`text-rotate`).evaluate(o,{})*Math.PI/180,u=[],d=0,f=t.positionedLines;d<f.length;d+=1)for(var p=f[d],m=0,h=p.positionedGlyphs;m<h.length;m+=1){var g=h[m];if(g.rect){var _=g.rect||{},v=4,y=!0,b=1,x=0,S=(a||c)&&g.vertical,C=g.metrics.advance*g.scale/2;if(c&&t.verticalizable&&(x=p.lineOffset/2-(g.imageName?-(24-g.metrics.width*g.scale)/2:24*(g.scale-1))),g.imageName){var w=s[g.imageName];y=w.sdf,v=1/(b=w.pixelRatio)}var E=a?[g.x+C,g.y]:[0,0],D=a?[0,0]:[g.x+C+n[0],g.y+n[1]-x],O=[0,0];S&&(O=D,D=[0,0]);var k=(g.metrics.left-v)*g.scale-C+D[0],A=(-g.metrics.top-v)*g.scale+D[1],j=k+_.w*g.scale/b,M=A+_.h*g.scale/b,N=new i(k,A),P=new i(j,A),F=new i(k,M),I=new i(j,M);if(S){var ee=new i(-C,C- -17),R=-Math.PI/2,z=12-C,B=new i(22-z,-(g.imageName?z:0)),te=new(Function.prototype.bind.apply(i,[null].concat(O)));N._rotateAround(R,ee)._add(B)._add(te),P._rotateAround(R,ee)._add(B)._add(te),F._rotateAround(R,ee)._add(B)._add(te),I._rotateAround(R,ee)._add(B)._add(te)}if(l){var ne=Math.sin(l),re=Math.cos(l),V=[re,-ne,ne,re];N._matMult(V),P._matMult(V),F._matMult(V),I._matMult(V)}var ie=new i(0,0),ae=new i(0,0);u.push({tl:N,tr:P,bl:F,br:I,tex:_,writingMode:t.writingMode,glyphOffset:E,sectionIndex:g.sectionIndex,isSDF:y,pixelOffsetTL:ie,pixelOffsetBR:ae,minFontScaleX:0,minFontScaleY:0})}}return u}(0,n,c,a,o,s,r,e.allowVerticalPlacement),_=e.textSizeData,v=null;_.kind===`source`?(v=[128*a.layout.get(`text-size`).evaluate(s,{})])[0]>32640&&C(e.layerIds[0]+`: Value for "text-size" is >= 255. Reduce your "text-size".`):_.kind===`composite`&&((v=[128*m.compositeTextSizes[0].evaluate(s,{},h),128*m.compositeTextSizes[1].evaluate(s,{},h)])[0]>32640||v[1]>32640)&&C(e.layerIds[0]+`: Value for "text-size" is >= 255. Reduce your "text-size".`),e.addSymbols(e.text,g,v,c,o,s,u,t,l.lineStartIndex,l.lineLength,p,h);for(var y=0,b=d;y<b.length;y+=1)f[b[y]]=e.text.placedSymbolArray.length-1;return 4*g.length}function gl(e){for(var t in e)return e[t];return null}function _l(e,t,n,r){var i=e.compareText;if(t in i){for(var a=i[t],o=a.length-1;o>=0;o--)if(r.dist(a[o])<n)return!0}else i[t]=[];return i[t].push(r),!1}var vl=Os.VectorTileFeature.types,yl=[{name:`a_fade_opacity`,components:1,type:`Uint8`,offset:0}];function bl(e,t,n,r,i,a,o,s,c,l,u,d,f){var p=s?Math.min(32640,Math.round(s[0])):0,m=s?Math.min(32640,Math.round(s[1])):0;e.emplaceBack(t,n,Math.round(32*r),Math.round(32*i),a,o,(p<<1)+(c?1:0),m,16*l,16*u,256*d,256*f)}function xl(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function Sl(e){for(var t=0,n=e.sections;t<n.length;t+=1)if(ai(n[t].text))return!0;return!1}var Cl=function(e){this.layoutVertexArray=new Hi,this.indexArray=new Yi,this.programConfigurations=e,this.segments=new ha,this.dynamicLayoutVertexArray=new Ui,this.opacityVertexArray=new Wi,this.placedSymbolArray=new sa};Cl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Cl.prototype.upload=function(e,t,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ys.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Xs.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,yl,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(e))},Cl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Kr(`SymbolBuffers`,Cl);var wl=function(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new ha,this.collisionVertexArray=new Ji};wl.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Zs.members,!0)},wl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Kr(`CollisionBuffers`,wl);var Tl=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ho([]),this.placementViewportMatrix=ho([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wc(this.zoom,t[`text-size`]),this.iconSizeData=Wc(this.zoom,t[`icon-size`]);var n=this.layers[0].layout,r=n.get(`symbol-sort-key`),i=n.get(`symbol-z-order`);this.canOverlap=n.get(`text-allow-overlap`)||n.get(`icon-allow-overlap`)||n.get(`text-ignore-placement`)||n.get(`icon-ignore-placement`),this.sortFeaturesByKey=i!==`viewport-y`&&r.constantOr(1)!==void 0,this.sortFeaturesByY=(i===`viewport-y`||i===`auto`&&!this.sortFeaturesByKey)&&this.canOverlap,n.get(`symbol-placement`)===`point`&&(this.writingModes=n.get(`text-writing-mode`).map((function(e){return kc[e]}))),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.sourceID=e.sourceID};Tl.prototype.createArrays=function(){this.text=new Cl(new Ha(this.layers,this.zoom,(function(e){return/^text/.test(e)}))),this.icon=new Cl(new Ha(this.layers,this.zoom,(function(e){return/^icon/.test(e)}))),this.glyphOffsetArray=new ua,this.lineVertexArray=new da,this.symbolInstances=new la},Tl.prototype.calculateGlyphDependencies=function(e,t,n,r,i){for(var a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,(n||r)&&i){var o=tc[e.charAt(a)];o&&(t[o.charCodeAt(0)]=!0)}},Tl.prototype.populate=function(e,t,n){var r=this.layers[0],i=r.layout,a=i.get(`text-font`),o=i.get(`text-field`),s=i.get(`icon-image`),c=(o.value.kind!==`constant`||o.value.value instanceof dt&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&(a.value.kind!==`constant`||a.value.value.length>0),l=s.value.kind!==`constant`||!!s.value.value||Object.keys(s.parameters).length>0,u=i.get(`symbol-sort-key`);if(this.features=[],c||l){for(var d=t.iconDependencies,f=t.glyphDependencies,p=t.availableImages,m=new hi(this.zoom),h=0,g=e;h<g.length;h+=1){var _=g[h],v=_.feature,y=_.id,b=_.index,x=_.sourceLayerIndex,S=r._featureFilter.needGeometry,C=Ja(v,S);if(r._featureFilter.filter(m,C,n)){S||(C.geometry=qa(v));var w=void 0;if(c){var E=r.getValueAndResolveTokens(`text-field`,C,n,p),D=dt.factory(E);Sl(D)&&(this.hasRTLText=!0),(!this.hasRTLText||fi()===`unavailable`||this.hasRTLText&&mi.isParsed())&&(w=ec(D,r,C))}var O=void 0;if(l){var k=r.getValueAndResolveTokens(`icon-image`,C,n,p);O=k instanceof ft?k:ft.fromString(k)}if(w||O){var A=this.sortFeaturesByKey?u.evaluate(C,{},n):void 0;if(this.features.push({id:y,text:w,icon:O,index:b,sourceLayerIndex:x,geometry:C.geometry,properties:v.properties,type:vl[v.type],sortKey:A}),O&&(d[O.name]=!0),w){var j=a.evaluate(C,{},n).join(`,`),M=i.get(`text-rotation-alignment`)===`map`&&i.get(`symbol-placement`)!==`point`;this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(kc.vertical)>=0;for(var N=0,P=w.sections;N<P.length;N+=1){var F=P[N];if(F.image)d[F.image.name]=!0;else{var I=ei(w.toString()),ee=F.fontStack||j,R=f[ee]=f[ee]||{};this.calculateGlyphDependencies(F.text,R,M,this.allowVerticalPlacement,I)}}}}}}i.get(`symbol-placement`)===`line`&&(this.features=function(e){var t={},n={},r=[],i=0;function a(t){r.push(e[t]),i++}function o(e,t,i){var a=n[e];return delete n[e],n[t]=a,r[a].geometry[0].pop(),r[a].geometry[0]=r[a].geometry[0].concat(i[0]),a}function s(e,n,i){var a=t[n];return delete t[n],t[e]=a,r[a].geometry[0].shift(),r[a].geometry[0]=i[0].concat(r[a].geometry[0]),a}function c(e,t,n){var r=n?t[0][t[0].length-1]:t[0][0];return e+`:`+r.x+`:`+r.y}for(var l=0;l<e.length;l++){var u=e[l],d=u.geometry,f=u.text?u.text.toString():null;if(f){var p=c(f,d),m=c(f,d,!0);if(p in n&&m in t&&n[p]!==t[m]){var h=s(p,m,d),g=o(p,m,r[h].geometry);delete t[p],delete n[m],n[c(f,r[g].geometry,!0)]=g,r[h].geometry=null}else p in n?o(p,m,d):m in t?s(p,m,d):(a(l),t[p]=i-1,n[m]=i-1)}else a(l)}return r.filter((function(e){return e.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(e,t){return e.sortKey-t.sortKey}))}},Tl.prototype.update=function(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))},Tl.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Tl.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Tl.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Tl.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Tl.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Tl.prototype.addToLineVertexArray=function(e,t){var n=this.lineVertexArray.length;if(e.segment!==void 0){for(var r=e.dist(t[e.segment+1]),i=e.dist(t[e.segment]),a={},o=e.segment+1;o<t.length;o++)a[o]={x:t[o].x,y:t[o].y,tileUnitDistanceFromAnchor:r},o<t.length-1&&(r+=t[o+1].dist(t[o]));for(var s=e.segment||0;s>=0;s--)a[s]={x:t[s].x,y:t[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=t[s-1].dist(t[s]));for(var c=0;c<t.length;c++){var l=a[c];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},Tl.prototype.addSymbols=function(e,t,n,r,i,a,o,s,c,l,u,d){for(var f=e.indexArray,p=e.layoutVertexArray,m=e.segments.prepareSegment(4*t.length,p,f,this.canOverlap?a.sortKey:void 0),h=this.glyphOffsetArray.length,g=m.vertexLength,_=this.allowVerticalPlacement&&o===kc.vertical?Math.PI/2:0,v=a.text&&a.text.sections,y=0;y<t.length;y++){var b=t[y],x=b.tl,S=b.tr,C=b.bl,w=b.br,E=b.tex,D=b.pixelOffsetTL,O=b.pixelOffsetBR,k=b.minFontScaleX,A=b.minFontScaleY,j=b.glyphOffset,M=b.isSDF,N=b.sectionIndex,P=m.vertexLength,F=j[1];bl(p,s.x,s.y,x.x,F+x.y,E.x,E.y,n,M,D.x,D.y,k,A),bl(p,s.x,s.y,S.x,F+S.y,E.x+E.w,E.y,n,M,O.x,D.y,k,A),bl(p,s.x,s.y,C.x,F+C.y,E.x,E.y+E.h,n,M,D.x,O.y,k,A),bl(p,s.x,s.y,w.x,F+w.y,E.x+E.w,E.y+E.h,n,M,O.x,O.y,k,A),xl(e.dynamicLayoutVertexArray,s,_),f.emplaceBack(P,P+1,P+2),f.emplaceBack(P+1,P+2,P+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(j[0]),y!==t.length-1&&N===t[y+1].sectionIndex||e.programConfigurations.populatePaintArrays(p.length,a,a.index,{},d,v&&v[N])}e.placedSymbolArray.emplaceBack(s.x,s.y,h,this.glyphOffsetArray.length-h,g,c,l,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],o,0,!1,0,u)},Tl.prototype._addCollisionDebugVertex=function(e,t,n,r,i,a){return t.emplaceBack(0,0),e.emplaceBack(n.x,n.y,r,i,Math.round(a.x),Math.round(a.y))},Tl.prototype.addCollisionDebugVertices=function(e,t,n,r,a,o,s){var c=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),l=c.vertexLength,u=a.layoutVertexArray,d=a.collisionVertexArray,f=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(u,d,o,f,p,new i(e,t)),this._addCollisionDebugVertex(u,d,o,f,p,new i(n,t)),this._addCollisionDebugVertex(u,d,o,f,p,new i(n,r)),this._addCollisionDebugVertex(u,d,o,f,p,new i(e,r)),c.vertexLength+=4;var m=a.indexArray;m.emplaceBack(l,l+1),m.emplaceBack(l+1,l+2),m.emplaceBack(l+2,l+3),m.emplaceBack(l+3,l),c.primitiveLength+=4},Tl.prototype.addDebugCollisionBoxes=function(e,t,n,r){for(var i=e;i<t;i++){var a=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(a.x1,a.y1,a.x2,a.y2,r?this.textCollisionBox:this.iconCollisionBox,a.anchorPoint,n)}},Tl.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wl(Ki,Qs.members,ta),this.iconCollisionBox=new wl(Ki,Qs.members,ta);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},Tl.prototype._deserializeCollisionBoxesForSymbol=function(e,t,n,r,i,a,o,s,c){for(var l={},u=t;u<n;u++){var d=e.get(u);l.textBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},l.textFeatureIndex=d.featureIndex;break}for(var f=r;f<i;f++){var p=e.get(f);l.verticalTextBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},l.verticalTextFeatureIndex=p.featureIndex;break}for(var m=a;m<o;m++){var h=e.get(m);l.iconBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},l.iconFeatureIndex=h.featureIndex;break}for(var g=s;g<c;g++){var _=e.get(g);l.verticalIconBox={x1:_.x1,y1:_.y1,x2:_.x2,y2:_.y2,anchorPointX:_.anchorPointX,anchorPointY:_.anchorPointY},l.verticalIconFeatureIndex=_.featureIndex;break}return l},Tl.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},Tl.prototype.hasTextData=function(){return this.text.segments.get().length>0},Tl.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Tl.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Tl.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Tl.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Tl.prototype.addIndicesForPlacedSymbol=function(e,t){for(var n=e.placedSymbolArray.get(t),r=n.vertexStartIndex+4*n.numGlyphs,i=n.vertexStartIndex;i<r;i+=4)e.indexArray.emplaceBack(i,i+1,i+2),e.indexArray.emplaceBack(i+1,i+2,i+3)},Tl.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),n=Math.cos(e),r=[],i=[],a=[],o=0;o<this.symbolInstances.length;++o){a.push(o);var s=this.symbolInstances.get(o);r.push(0|Math.round(t*s.anchorX+n*s.anchorY)),i.push(s.featureIndex)}return a.sort((function(e,t){return r[e]-r[t]||i[t]-i[e]})),a},Tl.prototype.addToSortKeyRanges=function(e,t){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},Tl.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,r=this.symbolInstanceIndexes;n<r.length;n+=1){var i=this.symbolInstances.get(r[n]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(e,n,r){e>=0&&r.indexOf(e)===n&&t.addIndicesForPlacedSymbol(t.text,e)})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Kr(`SymbolBucket`,Tl,{omit:[`layers`,`collisionBoxArray`,`features`,`compareText`]}),Tl.MAX_GLYPHS=65535,Tl.addDynamicAttributes=xl;var El=new ki({"symbol-placement":new wi(q.layout_symbol[`symbol-placement`]),"symbol-spacing":new wi(q.layout_symbol[`symbol-spacing`]),"symbol-avoid-edges":new wi(q.layout_symbol[`symbol-avoid-edges`]),"symbol-sort-key":new Ti(q.layout_symbol[`symbol-sort-key`]),"symbol-z-order":new wi(q.layout_symbol[`symbol-z-order`]),"icon-allow-overlap":new wi(q.layout_symbol[`icon-allow-overlap`]),"icon-ignore-placement":new wi(q.layout_symbol[`icon-ignore-placement`]),"icon-optional":new wi(q.layout_symbol[`icon-optional`]),"icon-rotation-alignment":new wi(q.layout_symbol[`icon-rotation-alignment`]),"icon-size":new Ti(q.layout_symbol[`icon-size`]),"icon-text-fit":new wi(q.layout_symbol[`icon-text-fit`]),"icon-text-fit-padding":new wi(q.layout_symbol[`icon-text-fit-padding`]),"icon-image":new Ti(q.layout_symbol[`icon-image`]),"icon-rotate":new Ti(q.layout_symbol[`icon-rotate`]),"icon-padding":new wi(q.layout_symbol[`icon-padding`]),"icon-keep-upright":new wi(q.layout_symbol[`icon-keep-upright`]),"icon-offset":new Ti(q.layout_symbol[`icon-offset`]),"icon-anchor":new Ti(q.layout_symbol[`icon-anchor`]),"icon-pitch-alignment":new wi(q.layout_symbol[`icon-pitch-alignment`]),"text-pitch-alignment":new wi(q.layout_symbol[`text-pitch-alignment`]),"text-rotation-alignment":new wi(q.layout_symbol[`text-rotation-alignment`]),"text-field":new Ti(q.layout_symbol[`text-field`]),"text-font":new Ti(q.layout_symbol[`text-font`]),"text-size":new Ti(q.layout_symbol[`text-size`]),"text-max-width":new Ti(q.layout_symbol[`text-max-width`]),"text-line-height":new wi(q.layout_symbol[`text-line-height`]),"text-letter-spacing":new Ti(q.layout_symbol[`text-letter-spacing`]),"text-justify":new Ti(q.layout_symbol[`text-justify`]),"text-radial-offset":new Ti(q.layout_symbol[`text-radial-offset`]),"text-variable-anchor":new wi(q.layout_symbol[`text-variable-anchor`]),"text-anchor":new Ti(q.layout_symbol[`text-anchor`]),"text-max-angle":new wi(q.layout_symbol[`text-max-angle`]),"text-writing-mode":new wi(q.layout_symbol[`text-writing-mode`]),"text-rotate":new Ti(q.layout_symbol[`text-rotate`]),"text-padding":new wi(q.layout_symbol[`text-padding`]),"text-keep-upright":new wi(q.layout_symbol[`text-keep-upright`]),"text-transform":new Ti(q.layout_symbol[`text-transform`]),"text-offset":new Ti(q.layout_symbol[`text-offset`]),"text-allow-overlap":new wi(q.layout_symbol[`text-allow-overlap`]),"text-ignore-placement":new wi(q.layout_symbol[`text-ignore-placement`]),"text-optional":new wi(q.layout_symbol[`text-optional`])}),Dl={paint:new ki({"icon-opacity":new Ti(q.paint_symbol[`icon-opacity`]),"icon-color":new Ti(q.paint_symbol[`icon-color`]),"icon-halo-color":new Ti(q.paint_symbol[`icon-halo-color`]),"icon-halo-width":new Ti(q.paint_symbol[`icon-halo-width`]),"icon-halo-blur":new Ti(q.paint_symbol[`icon-halo-blur`]),"icon-translate":new wi(q.paint_symbol[`icon-translate`]),"icon-translate-anchor":new wi(q.paint_symbol[`icon-translate-anchor`]),"text-opacity":new Ti(q.paint_symbol[`text-opacity`]),"text-color":new Ti(q.paint_symbol[`text-color`],{runtimeType:Ye,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Ti(q.paint_symbol[`text-halo-color`]),"text-halo-width":new Ti(q.paint_symbol[`text-halo-width`]),"text-halo-blur":new Ti(q.paint_symbol[`text-halo-blur`]),"text-translate":new wi(q.paint_symbol[`text-translate`]),"text-translate-anchor":new wi(q.paint_symbol[`text-translate-anchor`])}),layout:El},Ol=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ge,this.defaultValue=e};Ol.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Ol.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Ol.prototype.outputDefined=function(){return!1},Ol.prototype.serialize=function(){return null},Kr(`FormatSectionOverride`,Ol,{omit:[`defaultValue`]});var kl=function(e){function t(t){e.call(this,t,Dl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(t,n){if(e.prototype.recalculate.call(this,t,n),this.layout.get(`icon-rotation-alignment`)===`auto`&&(this.layout._values[`icon-rotation-alignment`]=this.layout.get(`symbol-placement`)===`point`?`viewport`:`map`),this.layout.get(`text-rotation-alignment`)===`auto`&&(this.layout._values[`text-rotation-alignment`]=this.layout.get(`symbol-placement`)===`point`?`viewport`:`map`),this.layout.get(`text-pitch-alignment`)===`auto`&&(this.layout._values[`text-pitch-alignment`]=this.layout.get(`text-rotation-alignment`)),this.layout.get(`icon-pitch-alignment`)===`auto`&&(this.layout._values[`icon-pitch-alignment`]=this.layout.get(`icon-rotation-alignment`)),this.layout.get(`symbol-placement`)===`point`){var r=this.layout.get(`text-writing-mode`);if(r){for(var i=[],a=0,o=r;a<o.length;a+=1){var s=o[a];i.indexOf(s)<0&&i.push(s)}this.layout._values[`text-writing-mode`]=i}else this.layout._values[`text-writing-mode`]=[`horizontal`]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(e,t,n,r){var i=this.layout.get(e).evaluate(t,{},n,r),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||er(a.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,(function(t,n){return n in e?String(e[n]):``}))}(t.properties,i)},t.prototype.createBucket=function(e){return new Tl(e)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var e=0,n=Dl.paint.overridableProperties;e<n.length;e+=1){var r=n[e];if(t.hasPaintOverride(this.layout,r)){var i,a=this.paint.get(r),o=new $n(new Ol(a),a.property.specification);i=a.value.kind===`constant`||a.value.kind===`source`?new nr(`source`,o):new rr(`composite`,o,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new Si(a.property,i,a.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(e,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&t.hasPaintOverride(this.layout,e)},t.hasPaintOverride=function(e,t){var n=e.get(`text-field`),r=Dl.paint.properties[t],i=!1,a=function(e){for(var t=0,n=e;t<n.length;t+=1)if(r.overrides&&r.overrides.hasOverride(n[t]))return void(i=!0)};if(n.value.kind===`constant`&&n.value.value instanceof dt)a(n.value.value.sections);else if(n.value.kind===`source`){var o=function(e){i||(e instanceof _t&&ht(e.value)===$e?a(e.value.sections):e instanceof xt?a(e.sections):e.eachChild(o))},s=n.value;s._styleExpression&&o(s._styleExpression.expression)}return i},t}(Ai),Al={paint:new ki({"background-color":new wi(q.paint_background[`background-color`]),"background-pattern":new Di(q.paint_background[`background-pattern`]),"background-opacity":new wi(q.paint_background[`background-opacity`])})},jl=function(e){function t(t){e.call(this,t,Al)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Ai),Ml={paint:new ki({"raster-opacity":new wi(q.paint_raster[`raster-opacity`]),"raster-hue-rotate":new wi(q.paint_raster[`raster-hue-rotate`]),"raster-brightness-min":new wi(q.paint_raster[`raster-brightness-min`]),"raster-brightness-max":new wi(q.paint_raster[`raster-brightness-max`]),"raster-saturation":new wi(q.paint_raster[`raster-saturation`]),"raster-contrast":new wi(q.paint_raster[`raster-contrast`]),"raster-resampling":new wi(q.paint_raster[`raster-resampling`]),"raster-fade-duration":new wi(q.paint_raster[`raster-fade-duration`])})},Nl=function(e){function t(t){e.call(this,t,Ml)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Ai),Pl=function(e){function t(t){e.call(this,t,{}),this.implementation=t}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode===`3d`},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},t.prototype.onRemove=function(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},t}(Ai),Fl={circle:bo,heatmap:Ao,hillshade:Mo,fill:vs,"fill-extrusion":Fs,line:qs,symbol:kl,background:jl,raster:Nl},Il=o.HTMLImageElement,Ll=o.HTMLCanvasElement,Rl=o.HTMLVideoElement,zl=o.ImageData,Bl=o.ImageBitmap,Vl=function(e,t,n,r){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,r)};Vl.prototype.update=function(e,t,n){var r=e.width,i=e.height,a=!(this.size&&this.size[0]===r&&this.size[1]===i||n),o=this.context,s=o.gl;if(this.useMipmap=!!(t&&t.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!t||!1!==t.premultiply)),a)this.size=[r,i],e instanceof Il||e instanceof Ll||e instanceof Rl||e instanceof zl||Bl&&e instanceof Bl?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,e):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,e.data);else{var c=n||{x:0,y:0},l=c.x,u=c.y;e instanceof Il||e instanceof Ll||e instanceof Rl||e instanceof zl||Bl&&e instanceof Bl?s.texSubImage2D(s.TEXTURE_2D,0,l,u,s.RGBA,s.UNSIGNED_BYTE,e):s.texSubImage2D(s.TEXTURE_2D,0,l,u,r,i,s.RGBA,s.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Vl.prototype.bind=function(e,t,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)},Vl.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Vl.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Hl=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel<`u`&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Hl.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){e._triggered=!1,e._callback()}),0))},Hl.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ul=function(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},_([`receive`,`process`],this),this.invoker=new Hl(this.process),this.target.addEventListener(`message`,this.receive,!1),this.globalScope=D()?e:o};function Wl(e,t,n){var r=2*Math.PI*6378137/256/2**n;return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}Ul.prototype.send=function(e,t,n,r,i){var a=this;i===void 0&&(i=!1);var o=Math.round(0xde0b6b3a7640000*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[o]=n);var s=A(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:e,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Xr(t,s)},s),{cancel:function(){n&&delete a.callbacks[o],a.target.postMessage({id:o,type:`<cancel>`,targetMapId:r,sourceMapId:a.mapId})}}},Ul.prototype.receive=function(e){var t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type===`<cancel>`){delete this.tasks[n];var r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r()}else D()||t.mustQueue?(this.tasks[n]=t,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,t)},Ul.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Ul.prototype.processTask=function(e,t){var n=this;if(t.type===`<response>`){var r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(Zr(t.error)):r(null,Zr(t.data)))}else{var i=!1,a=A(this.globalScope)?void 0:[],o=t.hasCallback?function(t,r){i=!0,delete n.cancelCallbacks[e],n.target.postMessage({id:e,type:`<response>`,sourceMapId:n.mapId,error:t?Xr(t):null,data:Xr(r,a)},a)}:function(e){i=!0},s=null,c=Zr(t.data);if(this.parent[t.type])s=this.parent[t.type](t.sourceMapId,c,o);else if(this.parent.getWorkerSource){var l=t.type.split(`.`);s=this.parent.getWorkerSource(t.sourceMapId,l[0],c.source)[l[1]](c,o)}else o(Error(`Could not find function `+t.type));!i&&s&&s.cancel&&(this.cancelCallbacks[e]=s.cancel)}},Ul.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener(`message`,this.receive,!1)};var Gl=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Gl.prototype.setNorthEast=function(e){return this._ne=e instanceof Kl?new Kl(e.lng,e.lat):Kl.convert(e),this},Gl.prototype.setSouthWest=function(e){return this._sw=e instanceof Kl?new Kl(e.lng,e.lat):Kl.convert(e),this},Gl.prototype.extend=function(e){var t,n,r=this._sw,i=this._ne;if(e instanceof Kl)t=e,n=e;else{if(!(e instanceof Gl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Gl.convert(e)):this.extend(Kl.convert(e)):this;if(n=e._ne,!(t=e._sw)||!n)return this}return r||i?(r.lng=Math.min(t.lng,r.lng),r.lat=Math.min(t.lat,r.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new Kl(t.lng,t.lat),this._ne=new Kl(n.lng,n.lat)),this},Gl.prototype.getCenter=function(){return new Kl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Gl.prototype.getSouthWest=function(){return this._sw},Gl.prototype.getNorthEast=function(){return this._ne},Gl.prototype.getNorthWest=function(){return new Kl(this.getWest(),this.getNorth())},Gl.prototype.getSouthEast=function(){return new Kl(this.getEast(),this.getSouth())},Gl.prototype.getWest=function(){return this._sw.lng},Gl.prototype.getSouth=function(){return this._sw.lat},Gl.prototype.getEast=function(){return this._ne.lng},Gl.prototype.getNorth=function(){return this._ne.lat},Gl.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Gl.prototype.toString=function(){return`LngLatBounds(`+this._sw.toString()+`, `+this._ne.toString()+`)`},Gl.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Gl.prototype.contains=function(e){var t=Kl.convert(e),n=t.lng,r=t.lat,i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i},Gl.convert=function(e){return!e||e instanceof Gl?e:new Gl(e)};var Kl=function(e,t){if(isNaN(e)||isNaN(t))throw Error(`Invalid LngLat object: (`+e+`, `+t+`)`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw Error(`Invalid LngLat latitude value: must be between -90 and 90`)};Kl.prototype.wrap=function(){return new Kl(d(this.lng,-180,180),this.lat)},Kl.prototype.toArray=function(){return[this.lng,this.lat]},Kl.prototype.toString=function(){return`LngLat(`+this.lng+`, `+this.lat+`)`},Kl.prototype.distanceTo=function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(i,1))},Kl.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new Gl(new Kl(this.lng-n,this.lat-t),new Kl(this.lng+n,this.lat+t))},Kl.convert=function(e){if(e instanceof Kl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Kl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e==`object`&&e)return new Kl(Number(`lng`in e?e.lng:e.lon),Number(e.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ql=2*Math.PI*6371008.8;function Jl(e){return ql*Math.cos(e*Math.PI/180)}function Yl(e){return(180+e)/360}function Xl(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Zl(e,t){return e/Jl(t)}function Ql(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var $l=function(e,t,n){n===void 0&&(n=0),this.x=+e,this.y=+t,this.z=+n};$l.fromLngLat=function(e,t){t===void 0&&(t=0);var n=Kl.convert(e);return new $l(Yl(n.lng),Xl(n.lat),Zl(t,n.lat))},$l.prototype.toLngLat=function(){return new Kl(360*this.x-180,Ql(this.y))},$l.prototype.toAltitude=function(){return this.z*Jl(Ql(this.y))},$l.prototype.meterInMercatorCoordinateUnits=function(){return 1/ql*(e=Ql(this.y),1/Math.cos(e*Math.PI/180));var e};var eu=function(e,t,n){this.z=e,this.x=t,this.y=n,this.key=ru(0,e,e,t,n)};eu.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},eu.prototype.url=function(e,t){var n,r,i,a,o,s=(r=this.y,i=this.z,a=Wl(256*(n=this.x),256*(r=2**i-r-1),i),o=Wl(256*(n+1),256*(r+1),i),a[0]+`,`+a[1]+`,`+o[0]+`,`+o[1]),c=function(e,t,n){for(var r,i=``,a=e;a>0;a--)i+=(t&(r=1<<a-1)?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(`{prefix}`,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(`{z}`,String(this.z)).replace(`{x}`,String(this.x)).replace(`{y}`,String(t===`tms`?2**this.z-this.y-1:this.y)).replace(`{quadkey}`,c).replace(`{bbox-epsg-3857}`,s)},eu.prototype.getTilePoint=function(e){var t=2**this.z;return new i(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},eu.prototype.toString=function(){return this.z+`/`+this.x+`/`+this.y};var tu=function(e,t){this.wrap=e,this.canonical=t,this.key=ru(e,t.z,t.z,t.x,t.y)},nu=function(e,t,n,r,i){this.overscaledZ=e,this.wrap=t,this.canonical=new eu(n,+r,+i),this.key=ru(t,e,n,r,i)};function ru(e,t,n,r,i){(e*=2)<0&&(e=-1*e-1);var a=1<<n;return(a*a*e+a*i+r).toString(36)+n.toString(36)+t.toString(36)}nu.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},nu.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new nu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},nu.prototype.calculateScaledKey=function(e,t){var n=this.canonical.z-e;return e>this.canonical.z?ru(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):ru(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)},nu.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},nu.prototype.children=function(e){if(this.overscaledZ>=e)return[new nu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new nu(t,this.wrap,t,n,r),new nu(t,this.wrap,t,n+1,r),new nu(t,this.wrap,t,n,r+1),new nu(t,this.wrap,t,n+1,r+1)]},nu.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},nu.prototype.wrapped=function(){return new nu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},nu.prototype.unwrapTo=function(e){return new nu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},nu.prototype.overscaleFactor=function(){return 2**(this.overscaledZ-this.canonical.z)},nu.prototype.toUnwrapped=function(){return new tu(this.wrap,this.canonical)},nu.prototype.toString=function(){return this.overscaledZ+`/`+this.canonical.x+`/`+this.canonical.y},nu.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new $l(e.x-this.wrap,e.y))},Kr(`CanonicalTileID`,eu),Kr(`OverscaledTileID`,nu,{omit:[`posMatrix`]});var iu=function(e,t,n){if(this.uid=e,t.height!==t.width)throw RangeError(`DEM tiles must be square`);if(n&&n!==`mapbox`&&n!==`terrarium`)return C(`"`+n+`" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;var r=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=n||`mapbox`;for(var i=0;i<r;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(r,i)]=this.data[this._idx(r-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,r)]=this.data[this._idx(i,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)]};iu.prototype.get=function(e,t){var n=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return(this.encoding===`terrarium`?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])},iu.prototype.getUnpackVector=function(){return this.encoding===`terrarium`?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},iu.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw RangeError(`out of range source coordinates for DEM data`);return(t+1)*this.stride+(e+1)},iu.prototype._unpackMapbox=function(e,t,n){return(256*e*256+256*t+n)/10-1e4},iu.prototype._unpackTerrarium=function(e,t,n){return 256*e+t+n/256-32768},iu.prototype.getPixels=function(){return new Do({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},iu.prototype.backfillBorder=function(e,t,n){if(this.dim!==e.dim)throw Error(`dem dimension mismatch`);var r=t*this.dim,i=t*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(t){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}for(var s=-t*this.dim,c=-n*this.dim,l=a;l<o;l++)for(var u=r;u<i;u++)this.data[this._idx(u,l)]=e.data[this._idx(u+s,l+c)]},Kr(`DEMData`,iu);var au=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}};au.prototype.encode=function(e){return this._stringToNumber[e]},au.prototype.decode=function(e){return this._numberToString[e]};var ou=function(e,t,n,r,i){this.type=`Feature`,this._vectorTileFeature=e,e._z=t,e._x=n,e._y=r,this.properties=e.properties,this.id=i},su={geometry:{configurable:!0}};su.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},su.geometry.set=function(e){this._geometry=e},ou.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!==`_geometry`&&t!==`_vectorTileFeature`&&(e[t]=this[t]);return e},Object.defineProperties(ou.prototype,su);var cu=function(){this.state={},this.stateChanges={},this.deletedStates={}};cu.prototype.updateState=function(e,t,n){var r=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},f(this.stateChanges[e][r],n),this.deletedStates[e]===null)for(var i in this.deletedStates[e]={},this.state[e])i!==r&&(this.deletedStates[e][i]=null);else if(this.deletedStates[e]&&this.deletedStates[e][r]===null)for(var a in this.deletedStates[e][r]={},this.state[e][r])n[a]||(this.deletedStates[e][r][a]=null);else for(var o in n)this.deletedStates[e]&&this.deletedStates[e][r]&&this.deletedStates[e][r][o]===null&&delete this.deletedStates[e][r][o]},cu.prototype.removeFeatureState=function(e,t,n){if(this.deletedStates[e]!==null){var r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&t!==void 0)this.deletedStates[e][r]!==null&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][n]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][r])for(n in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][n]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}},cu.prototype.getState=function(e,t){var n=String(t),r=f({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var i=this.deletedStates[e][t];if(i===null)return{};for(var a in i)delete r[a]}return r},cu.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},cu.prototype.coalesceChanges=function(e,t){var n={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var i={};for(var a in this.stateChanges[r])this.state[r][a]||(this.state[r][a]={}),f(this.state[r][a],this.stateChanges[r][a]),i[a]=this.state[r][a];n[r]=i}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(this.deletedStates[o]===null)for(var c in this.state[o])s[c]={},this.state[o][c]={};else for(var l in this.deletedStates[o]){if(this.deletedStates[o][l]===null)this.state[o][l]={};else for(var u=0,d=Object.keys(this.deletedStates[o][l]);u<d.length;u+=1)delete this.state[o][l][d[u]];s[l]=this.state[o][l]}n[o]=n[o]||{},f(n[o],s)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(var p in e)e[p].setFeatureState(n,t)};var lu=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Vr(8192,16,0),this.grid3D=new Vr(8192,16,0),this.featureIndexArray=new pa,this.promoteId=t};function uu(e,t,n,r,i){return y(e,(function(e,a){var o=t instanceof Ci?t.get(a):null;return o&&o.evaluate?o.evaluate(n,r,i):o}))}function du(e){for(var t=1/0,n=1/0,r=-1/0,i=-1/0,a=0,o=e;a<o.length;a+=1){var s=o[a];t=Math.min(t,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}return{minX:t,minY:n,maxX:r,maxY:i}}function fu(e,t){return t-e}lu.prototype.insert=function(e,t,n,r,i,a){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);for(var s=a?this.grid3D:this.grid,c=0;c<t.length;c++){for(var l=t[c],u=[1/0,1/0,-1/0,-1/0],d=0;d<l.length;d++){var f=l[d];u[0]=Math.min(u[0],f.x),u[1]=Math.min(u[1],f.y),u[2]=Math.max(u[2],f.x),u[3]=Math.max(u[3],f.y)}u[0]<8192&&u[1]<8192&&u[2]>=0&&u[3]>=0&&s.insert(o,u[0],u[1],u[2],u[3])}},lu.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Os.VectorTile(new ic(this.rawTileData)).layers,this.sourceLayerCoder=new au(this.vtLayers?Object.keys(this.vtLayers).sort():[`_geojsonTileLayer`])),this.vtLayers},lu.prototype.query=function(e,t,n,r){var a=this;this.loadVTLayers();for(var o=e.params||{},s=8192/e.tileSize/e.scale,c=mr(o.filter),l=e.queryGeometry,u=e.queryPadding*s,d=du(l),f=this.grid.query(d.minX-u,d.minY-u,d.maxX+u,d.maxY+u),p=du(e.cameraQueryGeometry),m=this.grid3D.query(p.minX-u,p.minY-u,p.maxX+u,p.maxY+u,(function(t,n,r,a){return function(e,t,n,r,a){for(var o=0,s=e;o<s.length;o+=1){var c=s[o];if(t<=c.x&&n<=c.y&&r>=c.x&&a>=c.y)return!0}var l=[new i(t,n),new i(t,a),new i(r,a),new i(r,n)];if(e.length>2){for(var u=0,d=l;u<d.length;u+=1)if(oo(e,d[u]))return!0}for(var f=0;f<e.length-1;f++)if(so(e[f],e[f+1],l))return!0;return!1}(e.cameraQueryGeometry,t-u,n-u,r+u,a+u)})),h=0,g=m;h<g.length;h+=1)f.push(g[h]);f.sort(fu);for(var _,v={},y=function(i){var u=f[i];if(u!==_){_=u;var d=a.featureIndexArray.get(u),p=null;a.loadMatchingFeature(v,d.bucketIndex,d.sourceLayerIndex,d.featureIndex,c,o.layers,o.availableImages,t,n,r,(function(t,n,r){return p||=qa(t),n.queryIntersectsFeature(l,t,r,p,a.z,e.transform,s,e.pixelPosMatrix)}))}},b=0;b<f.length;b++)y(b);return v},lu.prototype.loadMatchingFeature=function(e,t,n,r,i,a,o,s,c,l,u){var d=this.bucketLayerIDs[t];if(!a||function(e,t){for(var n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(a,d)){var p=this.sourceLayerCoder.decode(n),m=this.vtLayers[p].feature(r);if(i.needGeometry){var h=Ja(m,!0);if(!i.filter(new hi(this.tileID.overscaledZ),h,this.tileID.canonical))return}else if(!i.filter(new hi(this.tileID.overscaledZ),m))return;for(var g=this.getId(m,p),_=0;_<d.length;_++){var v=d[_];if(!(a&&a.indexOf(v)<0)){var y=s[v];if(y){var b={};g!==void 0&&l&&(b=l.getState(y.sourceLayer||`_geojsonTileLayer`,g));var x=f({},c[v]);x.paint=uu(x.paint,y.paint,m,b,o),x.layout=uu(x.layout,y.layout,m,b,o);var S=!u||u(m,y,b);if(S){var C=new ou(m,this.z,this.x,this.y,g);C.layer=x;var w=e[v];w===void 0&&(w=e[v]=[]),w.push({featureIndex:r,feature:C,intersectionZ:S})}}}}}},lu.prototype.lookupSymbolFeatures=function(e,t,n,r,i,a,o,s){var c={};this.loadVTLayers();for(var l=mr(i),u=0,d=e;u<d.length;u+=1)this.loadMatchingFeature(c,n,r,d[u],l,a,o,s,t);return c},lu.prototype.hasLayer=function(e){for(var t=0,n=this.bucketLayerIDs;t<n.length;t+=1)for(var r=0,i=n[t];r<i.length;r+=1)if(e===i[r])return!0;return!1},lu.prototype.getId=function(e,t){var n=e.id;return this.promoteId&&typeof(n=e.properties[typeof this.promoteId==`string`?this.promoteId:this.promoteId[t]])==`boolean`&&(n=Number(n)),n},Kr(`FeatureIndex`,lu,{omit:[`rawTileData`,`sourceLayerCoder`]});var pu=function(e,t){this.tileID=e,this.uid=m(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state=`loading`};pu.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<z.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},pu.prototype.wasRequested=function(){return this.state===`errored`||this.state===`loaded`||this.state===`reloading`},pu.prototype.loadVectorData=function(e,t,n){if(this.hasData()&&this.unloadVectorData(),this.state=`loaded`,e){for(var r in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){var n={};if(!t)return n;for(var r=function(){var e=a[i],r=e.layerIds.map((function(e){return t.getLayer(e)})).filter(Boolean);if(r.length!==0){e.layers=r,e.stateDependentLayerIds&&(e.stateDependentLayers=e.stateDependentLayerIds.map((function(e){return r.filter((function(t){return t.id===e}))[0]})));for(var o=0,s=r;o<s.length;o+=1)n[s[o].id]=e}},i=0,a=e;i<a.length;i+=1)r();return n}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[r];if(i instanceof Tl){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var a in this.buckets){var o=this.buckets[a];if(o instanceof Tl&&o.hasRTLText){this.hasRTLText=!0,mi.isLoading()||mi.isLoaded()||fi()!==`deferred`||pi();break}}for(var s in this.queryPadding=0,this.buckets){var c=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(s).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new aa},pu.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&=null,this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state=`unloaded`},pu.prototype.getBucket=function(e){return this.buckets[e.id]},pu.prototype.upload=function(e){for(var t in this.buckets){var n=this.buckets[t];n.uploadPending()&&n.upload(e)}var r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vl(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&=(this.glyphAtlasTexture=new Vl(e,this.glyphAtlasImage,r.ALPHA),null)},pu.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},pu.prototype.queryRenderedFeatures=function(e,t,n,r,i,a,o,s,c,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:a,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:o,queryPadding:this.queryPadding*c},e,t,n):{}},pu.prototype.querySourceFeatures=function(e,t){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var r=n.loadVTLayers(),i=t?t.sourceLayer:``,a=r._geojsonTileLayer||r[i];if(a)for(var o=mr(t&&t.filter),s=this.tileID.canonical,c=s.z,l=s.x,u=s.y,d={z:c,x:l,y:u},f=0;f<a.length;f++){var p=a.feature(f);if(o.needGeometry){var m=Ja(p,!0);if(!o.filter(new hi(this.tileID.overscaledZ),m,this.tileID.canonical))continue}else if(!o.filter(new hi(this.tileID.overscaledZ),p))continue;var h=new ou(p,c,l,u,n.getId(p,i));h.tile=d,e.push(h)}}},pu.prototype.hasData=function(){return this.state===`loaded`||this.state===`reloading`||this.state===`expired`},pu.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},pu.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var n=O(e.cacheControl);n[`max-age`]&&(this.expirationTime=Date.now()+1e3*n[`max-age`])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var r=Date.now(),i=!1;if(this.expirationTime>r)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{var a=this.expirationTime-t;a?this.expirationTime=r+Math.max(a,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state=`expired`):this.expiredRequestCount=0}},pu.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),2**31-1)},pu.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var n=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(t.style.hasLayer(r)){var i=this.buckets[r],a=i.layers[0].sourceLayer||`_geojsonTileLayer`,o=n[a],s=e[a];if(o&&s&&Object.keys(s).length!==0){i.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});var c=t&&t.style&&t.style.getLayer(r);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(i)))}}}},pu.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},pu.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<z.now()},pu.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},pu.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=z.now()+e},pu.prototype.setDependencies=function(e,t){for(var n={},r=0,i=t;r<i.length;r+=1)n[i[r]]=!0;this.dependencies[e]=n},pu.prototype.hasDependency=function(e,t){for(var n=0,r=e;n<r.length;n+=1){var i=this.dependencies[r[n]];if(i){for(var a=0,o=t;a<o.length;a+=1)if(i[o[a]])return!0}}return!1};var mu=o.performance,hu=function(e){this._marks={start:[e.url,`start`].join(`#`),end:[e.url,`end`].join(`#`),measure:e.url.toString()},mu.mark(this._marks.start)};hu.prototype.finish=function(){mu.mark(this._marks.end);var e=mu.getEntriesByName(this._marks.measure);return e.length===0&&(mu.measure(this._marks.measure,this._marks.start,this._marks.end),e=mu.getEntriesByName(this._marks.measure),mu.clearMarks(this._marks.start),mu.clearMarks(this._marks.end),mu.clearMeasures(this._marks.measure)),e},e.Actor=Ul,e.AlphaImage=Eo,e.CanonicalTileID=eu,e.CollisionBoxArray=aa,e.Color=ct,e.DEMData=iu,e.DataConstantProperty=wi,e.DictionaryCoder=au,e.EXTENT=8192,e.ErrorEvent=Ie,e.EvaluationParameters=hi,e.Event=Fe,e.Evented=Le,e.FeatureIndex=lu,e.FillBucket=hs,e.FillExtrusionBucket=Ms,e.ImageAtlas=Oc,e.ImagePosition=Ec,e.LineBucket=Us,e.LngLat=Kl,e.LngLatBounds=Gl,e.MercatorCoordinate=$l,e.ONE_EM=24,e.OverscaledTileID=nu,e.Point=i,e.Point$1=i,e.Properties=ki,e.Protobuf=ic,e.RGBAImage=Do,e.RequestManager=ae,e.RequestPerformance=hu,e.ResourceType=Ce,e.SegmentVector=ha,e.SourceFeatureState=cu,e.StructArrayLayout1ui2=na,e.StructArrayLayout2f1f2i16=qi,e.StructArrayLayout2i4=Ii,e.StructArrayLayout3ui6=Yi,e.StructArrayLayout4i8=Li,e.SymbolBucket=Tl,e.Texture=Vl,e.Tile=pu,e.Transitionable=vi,e.Uniform1f=Oa,e.Uniform1i=Da,e.Uniform2f=ka,e.Uniform3f=Aa,e.Uniform4f=ja,e.UniformColor=Ma,e.UniformMatrix4f=Pa,e.UnwrappedTileID=tu,e.ValidationError=Re,e.WritingMode=kc,e.ZoomHistory=Qr,e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},e.addDynamicAttributes=xl,e.asyncAll=function(e,t,n){if(!e.length)return n(null,[]);var r=e.length,i=Array(e.length),a=null;e.forEach((function(e,o){t(e,(function(e,t){e&&(a=e),i[o]=t,--r==0&&n(a,i)}))}))},e.bezier=c,e.bindAll=_,e.browser=z,e.cacheEntryPossiblyAdded=function(e){++xe>K&&(e.getActor().send(`enforceCacheSizeLimit`,G),xe=0)},e.clamp=u,e.clearTileCache=function(e){var t=o.caches.delete(`mapbox-tiles`);e&&t.catch(e).then((function(){return e()}))},e.clipLine=el,e.clone=function(e){var t=new mo(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=x,e.clone$2=function(e){var t=new mo(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.collisionCircleLayout=$s,e.config=B,e.create=function(){var e=new mo(16);return mo!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=function(){var e=new mo(9);return mo!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},e.create$2=function(){var e=new mo(4);return mo!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.createCommonjsModule=t,e.createExpression=tr,e.createLayout=Pi,e.createStyleLayer=function(e){return e.type===`custom`?new Pl(e):new Fl[e.type](e)},e.cross=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],c=n[2];return e[0]=i*c-a*s,e[1]=a*o-r*c,e[2]=r*s-i*o,e},e.deepEqual=function e(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}if(typeof t==`object`&&t&&n!==null){if(typeof n!=`object`||Object.keys(t).length!==Object.keys(n).length)return!1;for(var i in t)if(!e(t[i],n[i]))return!1;return!0}return t===n},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.ease=l,e.emitValidationErrors=Br,e.endsWith=v,e.enforceCacheSizeLimit=function(e){ve(),fe&&fe.then((function(t){t.keys().then((function(n){for(var r=0;r<n.length-e;r++)t.delete(n[r])}))}))},e.evaluateSizeForFeature=Gc,e.evaluateSizeForZoom=Kc,e.evaluateVariableOffset=pl,e.evented=di,e.extend=f,e.featureFilter=mr,e.filterObject=b,e.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.getAnchorAlignment=Bc,e.getAnchorJustification=ml,e.getArrayBuffer=ke,e.getImage=Me,e.getJSON=function(e,t){return Oe(f(e,{type:`json`}),t)},e.getRTLTextPluginStatus=fi,e.getReferrer=Te,e.getVideo=function(e,t){var n,r,i=o.document.createElement(`video`);i.muted=!0,i.onloadstart=function(){t(null,i)};for(var a=0;a<e.length;a++){var s=o.document.createElement(`source`);n=e[a],r=void 0,(r=o.document.createElement(`a`)).href=n,(r.protocol!==o.document.location.protocol||r.host!==o.document.location.host)&&(i.crossOrigin=`Anonymous`),s.src=e[a],i.appendChild(s)}return{cancel:function(){}}},e.identity=ho,e.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],h=t[13],g=t[14],_=t[15],v=n*s-r*o,y=n*c-i*o,b=n*l-a*o,x=r*c-i*s,S=r*l-a*s,C=i*l-a*c,w=u*h-d*m,E=u*g-f*m,D=u*_-p*m,O=d*g-f*h,k=d*_-p*h,A=f*_-p*g,j=v*A-y*k+b*O+x*D-S*E+C*w;return j?(e[0]=(s*A-c*k+l*O)*(j=1/j),e[1]=(i*k-r*A-a*O)*j,e[2]=(h*C-g*S+_*x)*j,e[3]=(f*S-d*C-p*x)*j,e[4]=(c*D-o*A-l*E)*j,e[5]=(n*A-i*D+a*E)*j,e[6]=(g*b-m*C-_*y)*j,e[7]=(u*C-f*b+p*y)*j,e[8]=(o*k-s*D+l*w)*j,e[9]=(r*D-n*k-a*w)*j,e[10]=(m*S-h*b+_*v)*j,e[11]=(d*b-u*S-p*v)*j,e[12]=(s*E-o*O-c*w)*j,e[13]=(n*O-r*E+i*w)*j,e[14]=(h*y-m*x-g*v)*j,e[15]=(u*x-d*y+f*v)*j,e):null},e.isChar=$r,e.isMapboxURL=oe,e.keysDifference=function(e,t){var n=[];for(var r in e)r in t||n.push(r);return n},e.makeRequest=Oe,e.mapObject=y,e.mercatorXfromLng=Yl,e.mercatorYfromLat=Xl,e.mercatorZfromAltitude=Zl,e.mul=vo,e.multiply=go,e.mvt=Os,e.nextPowerOfTwo=function(e){return e<=1?1:2**Math.ceil(Math.log(e)/Math.LN2)},e.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e},e.number=Qt,e.offscreenCanvasSupported=Se,e.ortho=function(e,t,n,r,i,a,o){var s=1/(t-n),c=1/(r-i),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*c,e[14]=(o+a)*l,e[15]=1,e},e.parseGlyphPBF=function(e){return new ic(e).readFields(Sc,[])},e.pbf=ic,e.performSymbolLayout=function(e,t,n,r,i,a,o){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var s=e.layers[0].layout,c=e.layers[0]._unevaluatedLayout._values,l={};if(e.textSizeData.kind===`composite`){var u=e.textSizeData,d=u.maxZoom;l.compositeTextSizes=[c[`text-size`].possiblyEvaluate(new hi(u.minZoom),o),c[`text-size`].possiblyEvaluate(new hi(d),o)]}if(e.iconSizeData.kind===`composite`){var f=e.iconSizeData,p=f.maxZoom;l.compositeIconSizes=[c[`icon-size`].possiblyEvaluate(new hi(f.minZoom),o),c[`icon-size`].possiblyEvaluate(new hi(p),o)]}l.layoutTextSize=c[`text-size`].possiblyEvaluate(new hi(e.zoom+1),o),l.layoutIconSize=c[`icon-size`].possiblyEvaluate(new hi(e.zoom+1),o),l.textMaxSize=c[`text-size`].possiblyEvaluate(new hi(18));for(var m=24*s.get(`text-line-height`),h=s.get(`text-rotation-alignment`)===`map`&&s.get(`symbol-placement`)!==`point`,g=s.get(`text-keep-upright`),_=s.get(`text-size`),v=function(){var a=b[y],c=s.get(`text-font`).evaluate(a,{},o).join(`,`),u=_.evaluate(a,{},o),d=l.layoutTextSize.evaluate(a,{},o),f=l.layoutIconSize.evaluate(a,{},o),p={horizontal:{},vertical:void 0},v=a.text,x=[0,0];if(v){var S=v.toString(),w=24*s.get(`text-letter-spacing`).evaluate(a,{},o),E=function(e){for(var t=0,n=e;t<n.length;t+=1)if(r=n[t].charCodeAt(0),$r.Arabic(r)||$r[`Arabic Supplement`](r)||$r[`Arabic Extended-A`](r)||$r[`Arabic Presentation Forms-A`](r)||$r[`Arabic Presentation Forms-B`](r))return!1;var r;return!0}(S)?w:0,D=s.get(`text-anchor`).evaluate(a,{},o),O=s.get(`text-variable-anchor`);if(!O){var k=s.get(`text-radial-offset`).evaluate(a,{},o);x=k?pl(D,[24*k,fl]):s.get(`text-offset`).evaluate(a,{},o).map((function(e){return 24*e}))}var A=h?`center`:s.get(`text-justify`).evaluate(a,{},o),j=s.get(`symbol-placement`),M=j===`point`?24*s.get(`text-max-width`).evaluate(a,{},o):0,N=function(){e.allowVerticalPlacement&&ei(S)&&(p.vertical=Mc(v,t,n,i,c,M,m,D,`left`,E,x,kc.vertical,!0,j,d,u))};if(!h&&O){for(var P=A===`auto`?O.map((function(e){return ml(e)})):[A],F=!1,I=0;I<P.length;I++){var ee=P[I];if(!p.horizontal[ee])if(F)p.horizontal[ee]=p.horizontal[0];else{var R=Mc(v,t,n,i,c,M,m,`center`,ee,E,x,kc.horizontal,!1,j,d,u);R&&(p.horizontal[ee]=R,F=R.positionedLines.length===1)}}N()}else{A===`auto`&&(A=ml(D));var z=Mc(v,t,n,i,c,M,m,D,A,E,x,kc.horizontal,!1,j,d,u);z&&(p.horizontal[A]=z),N(),ei(S)&&h&&g&&(p.vertical=Mc(v,t,n,i,c,M,m,D,A,E,x,kc.vertical,!1,j,d,u))}}var B=void 0,te=!1;if(a.icon&&a.icon.name){var ne=r[a.icon.name];ne&&(B=function(e,t,n){var r=Bc(n),i=t[0]-e.displaySize[0]*r.horizontalAlign,a=t[1]-e.displaySize[1]*r.verticalAlign;return{image:e,top:a,bottom:a+e.displaySize[1],left:i,right:i+e.displaySize[0]}}(i[a.icon.name],s.get(`icon-offset`).evaluate(a,{},o),s.get(`icon-anchor`).evaluate(a,{},o)),te=ne.sdf,e.sdfIcons===void 0?e.sdfIcons=ne.sdf:e.sdfIcons!==ne.sdf&&C(`Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer`),(ne.pixelRatio!==e.pixelRatio||s.get(`icon-rotate`).constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var re=gl(p.horizontal)||p.vertical;e.iconsInText=!!re&&re.iconsInText,(re||B)&&function(e,t,n,r,i,a,o,s,c,l,u){var d=a.textMaxSize.evaluate(t,{});d===void 0&&(d=o);var f,p=e.layers[0].layout,m=p.get(`icon-offset`).evaluate(t,{},u),h=gl(n.horizontal),g=o/24,_=e.tilePixelRatio*g,v=e.tilePixelRatio*d/24,y=e.tilePixelRatio*s,b=e.tilePixelRatio*p.get(`symbol-spacing`),x=p.get(`text-padding`)*e.tilePixelRatio,S=p.get(`icon-padding`)*e.tilePixelRatio,w=p.get(`text-max-angle`)/180*Math.PI,E=p.get(`text-rotation-alignment`)===`map`&&p.get(`symbol-placement`)!==`point`,D=p.get(`icon-rotation-alignment`)===`map`&&p.get(`symbol-placement`)!==`point`,O=p.get(`symbol-placement`),k=b/2,A=p.get(`icon-text-fit`);r&&A!==`none`&&(e.allowVerticalPlacement&&n.vertical&&(f=Hc(r,n.vertical,A,p.get(`icon-text-fit-padding`),m,g)),h&&(r=Hc(r,h,A,p.get(`icon-text-fit-padding`),m,g)));var j=function(s,d){d.x<0||d.x>=8192||d.y<0||d.y>=8192||function(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,w,E){var D,O,k,A,j,M=e.addToLineVertexArray(t,n),N=0,P=0,F=0,I=0,ee=-1,R=-1,z={},B=ba(``),te=0,ne=0;if(s._unevaluatedLayout.getValue(`text-radial-offset`)===void 0?(te=(D=s.layout.get(`text-offset`).evaluate(b,{},w).map((function(e){return 24*e})))[0],ne=D[1]):(te=24*s.layout.get(`text-radial-offset`).evaluate(b,{},w),ne=fl),e.allowVerticalPlacement&&r.vertical){var re=s.layout.get(`text-rotate`).evaluate(b,{},w)+90;A=new ol(c,t,l,u,d,r.vertical,f,p,m,re),o&&(j=new ol(c,t,l,u,d,o,g,_,m,re))}if(i){var V=s.layout.get(`icon-rotate`).evaluate(b,{}),ie=s.layout.get(`icon-text-fit`)!==`none`,ae=tl(i,V,S,ie),oe=o?tl(o,V,S,ie):void 0;k=new ol(c,t,l,u,d,i,g,_,!1,V),N=4*ae.length;var se=e.iconSizeData,ce=null;se.kind===`source`?(ce=[128*s.layout.get(`icon-size`).evaluate(b,{})])[0]>32640&&C(e.layerIds[0]+`: Value for "icon-size" is >= 255. Reduce your "icon-size".`):se.kind===`composite`&&((ce=[128*x.compositeIconSizes[0].evaluate(b,{},w),128*x.compositeIconSizes[1].evaluate(b,{},w)])[0]>32640||ce[1]>32640)&&C(e.layerIds[0]+`: Value for "icon-size" is >= 255. Reduce your "icon-size".`),e.addSymbols(e.icon,ae,ce,y,v,b,!1,t,M.lineStartIndex,M.lineLength,-1,w),ee=e.icon.placedSymbolArray.length-1,oe&&(P=4*oe.length,e.addSymbols(e.icon,oe,ce,y,v,b,kc.vertical,t,M.lineStartIndex,M.lineLength,-1,w),R=e.icon.placedSymbolArray.length-1)}for(var H in r.horizontal){var le=r.horizontal[H];O||=(B=ba(le.text),new ol(c,t,l,u,d,le,f,p,m,s.layout.get(`text-rotate`).evaluate(b,{},w)));var ue=le.positionedLines.length===1;if(F+=hl(e,t,le,a,s,m,b,h,M,r.vertical?kc.horizontal:kc.horizontalOnly,ue?Object.keys(r.horizontal):[H],z,ee,x,w),ue)break}r.vertical&&(I+=hl(e,t,r.vertical,a,s,m,b,h,M,kc.vertical,[`vertical`],z,R,x,w));var de=O?O.boxStartIndex:e.collisionBoxArray.length,U=O?O.boxEndIndex:e.collisionBoxArray.length,fe=A?A.boxStartIndex:e.collisionBoxArray.length,pe=A?A.boxEndIndex:e.collisionBoxArray.length,me=k?k.boxStartIndex:e.collisionBoxArray.length,W=k?k.boxEndIndex:e.collisionBoxArray.length,he=j?j.boxStartIndex:e.collisionBoxArray.length,ge=j?j.boxEndIndex:e.collisionBoxArray.length,_e=-1,G=function(e,t){return e&&e.circleDiameter?Math.max(e.circleDiameter,t):t};_e=G(O,_e),_e=G(A,_e),_e=G(k,_e);var K=(_e=G(j,_e))>-1?1:0;K&&(_e*=E/24),e.glyphOffsetArray.length>=Tl.MAX_GLYPHS&&C(`Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907`),b.sortKey!==void 0&&e.addToSortKeyRanges(e.symbolInstances.length,b.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,z.right>=0?z.right:-1,z.center>=0?z.center:-1,z.left>=0?z.left:-1,z.vertical||-1,ee,R,B,de,U,fe,pe,me,W,he,ge,l,F,I,N,P,K,0,f,te,ne,_e)}(e,d,s,n,r,i,f,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,_,x,E,c,y,S,D,m,t,a,l,u,o)};if(O===`line`)for(var M=0,N=el(t.geometry,0,0,8192,8192);M<N.length;M+=1)for(var P=N[M],F=0,I=$c(P,b,w,n.vertical||h,r,24,v,e.overscaling,8192);F<I.length;F+=1){var ee=I[F];h&&_l(e,h.text,k,ee)||j(P,ee)}else if(O===`line-center`)for(var R=0,z=t.geometry;R<z.length;R+=1){var B=z[R];if(B.length>1){var te=Qc(B,w,n.vertical||h,r,24,v);te&&j(B,te)}}else if(t.type===`Polygon`)for(var ne=0,re=ds(t.geometry,0);ne<re.length;ne+=1){var V=re[ne],ie=ll(V,16);j(V[0],new Uc(ie.x,ie.y,0))}else if(t.type===`LineString`)for(var ae=0,oe=t.geometry;ae<oe.length;ae+=1){var se=oe[ae];j(se,new Uc(se[0].x,se[0].y,0))}else if(t.type===`Point`)for(var ce=0,H=t.geometry;ce<H.length;ce+=1)for(var le=0,ue=H[ce];le<ue.length;le+=1){var de=ue[le];j([de],new Uc(de.x,de.y,0))}}(e,a,p,B,r,l,d,f,x,te,o)},y=0,b=e.features;y<b.length;y+=1)v();a&&e.generateCollisionDebugBuffers()},e.perspective=function(e,t,n,r,i){var a,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(e[10]=(i+r)*(a=1/(r-i)),e[14]=2*i*r*a):(e[10]=-1,e[14]=-2*r),e},e.pick=function(e,t){for(var n={},r=0;r<t.length;r++){var i=t[r];i in e&&(n[i]=e[i])}return n},e.plugin=mi,e.polygonIntersectsPolygon=Za,e.postMapLoadEvent=_e,e.postTurnstileEvent=he,e.potpack=Tc,e.refProperties=[`type`,`source`,`source-layer`,`minzoom`,`maxzoom`,`filter`,`layout`],e.register=Kr,e.registerForPluginStateChange=function(e){return e({pluginStatus:si,pluginURL:ci}),di.on(`pluginStateChange`,e),e},e.renderColorRamp=ko,e.rotate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+a*s,e[1]=i*c+o*s,e[2]=r*-s+a*c,e[3]=i*-s+o*c,e},e.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*r,e[5]=o*i+u*r,e[6]=s*i+d*r,e[7]=c*i+f*r,e[8]=l*i-a*r,e[9]=u*i-o*r,e[10]=d*i-s*r,e[11]=f*i-c*r,e},e.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],l=t[4],u=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+l*r,e[1]=o*i+u*r,e[2]=s*i+d*r,e[3]=c*i+f*r,e[4]=l*i-a*r,e[5]=u*i-o*r,e[6]=d*i-s*r,e[7]=f*i-c*r,e},e.scale=function(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scale$1=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},e.scale$2=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},e.setCacheLimits=function(e,t){G=e,K=t},e.setRTLTextPlugin=function(e,t,n){if(n===void 0&&(n=!1),si===`deferred`||si===`loading`||si===`loaded`)throw Error(`setRTLTextPlugin cannot be called multiple times.`);ci=z.resolveURL(e),si=`deferred`,oi=t,ui(),n||pi()},e.sphericalToCartesian=function(e){var t=e[0],n=e[1],r=e[2];return n+=90,n*=Math.PI/180,r*=Math.PI/180,{x:t*Math.cos(n)*Math.sin(r),y:t*Math.sin(n)*Math.sin(r),z:t*Math.cos(r)}},e.sqrLen=function(e){var t=e[0],n=e[1];return t*t+n*n},e.styleSpec=q,e.sub=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},e.symbolSize=qc,e.transformMat3=function(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e},e.transformMat4=yo,e.translate=function(e,t,n){var r,i,a,o,s,c,l,u,d,f,p,m,h=n[0],g=n[1],_=n[2];return t===e?(e[12]=t[0]*h+t[4]*g+t[8]*_+t[12],e[13]=t[1]*h+t[5]*g+t[9]*_+t[13],e[14]=t[2]*h+t[6]*g+t[10]*_+t[14],e[15]=t[3]*h+t[7]*g+t[11]*_+t[15]):(i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=t[9],p=t[10],m=t[11],e[0]=r=t[0],e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=c,e[6]=l,e[7]=u,e[8]=d,e[9]=f,e[10]=p,e[11]=m,e[12]=r*h+s*g+d*_+t[12],e[13]=i*h+c*g+f*_+t[13],e[14]=a*h+l*g+p*_+t[14],e[15]=o*h+u*g+m*_+t[15]),e},e.triggerPluginCompletionEvent=li,e.uniqueId=m,e.validateCustomStyleLayer=function(e){var t=[],n=e.id;return n===void 0&&t.push({message:`layers.`+n+`: missing required property "id"`}),e.render===void 0&&t.push({message:`layers.`+n+`: missing required method "render"`}),e.renderingMode&&e.renderingMode!==`2d`&&e.renderingMode!==`3d`&&t.push({message:`layers.`+n+`: property "renderingMode" must be either "2d" or "3d"`}),t},e.validateLight=Lr,e.validateStyle=Ir,e.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},e.vectorTile=Os,e.version=`1.13.3`,e.warnOnce=C,e.webpSupported=te,e.window=o,e.wrap=d})),r([`./shared`],(function(e){function t(e){var n=typeof e;if(n===`number`||n===`boolean`||n===`string`||e==null)return JSON.stringify(e);if(Array.isArray(e)){for(var r=`[`,i=0,a=e;i<a.length;i+=1)r+=t(a[i])+`,`;return r+`]`}for(var o=Object.keys(e).sort(),s=`{`,c=0;c<o.length;c++)s+=JSON.stringify(o[c])+`:`+t(e[o[c]])+`,`;return s+`}`}function n(n){for(var r=``,i=0,a=e.refProperties;i<a.length;i+=1)r+=`/`+t(n[a[i]]);return r}var r=function(e){this.keyCache={},e&&this.replace(e)};r.prototype.replace=function(e){this._layerConfigs={},this._layers={},this.update(e,[])},r.prototype.update=function(t,r){for(var i=this,a=0,o=t;a<o.length;a+=1){var s=o[a];this._layerConfigs[s.id]=s;var c=this._layers[s.id]=e.createStyleLayer(s);c._featureFilter=e.featureFilter(c.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var l=0,u=r;l<u.length;l+=1){var d=u[l];delete this.keyCache[d],delete this._layerConfigs[d],delete this._layers[d]}this.familiesBySource={};for(var f=0,p=function(e,t){for(var r={},i=0;i<e.length;i++){var a=t&&t[e[i].id]||n(e[i]);t&&(t[e[i].id]=a);var o=r[a];o||=r[a]=[],o.push(e[i])}var s=[];for(var c in r)s.push(r[c]);return s}(e.values(this._layerConfigs),this.keyCache);f<p.length;f+=1){var m=p[f].map((function(e){return i._layers[e.id]})),h=m[0];if(h.visibility!==`none`){var g=h.source||``,_=this.familiesBySource[g];_||=this.familiesBySource[g]={};var v=h.sourceLayer||`_geojsonTileLayer`,y=_[v];y||=_[v]=[],y.push(m)}}};var i=function(t){var n={},r=[];for(var i in t){var a=t[i],o=n[i]={};for(var s in a){var c=a[+s];if(c&&c.bitmap.width!==0&&c.bitmap.height!==0){var l={x:0,y:0,w:c.bitmap.width+2,h:c.bitmap.height+2};r.push(l),o[s]={rect:l,metrics:c.metrics}}}}var u=e.potpack(r),d=new e.AlphaImage({width:u.w||1,height:u.h||1});for(var f in t){var p=t[f];for(var m in p){var h=p[+m];if(h&&h.bitmap.width!==0&&h.bitmap.height!==0){var g=n[f][m].rect;e.AlphaImage.copy(h.bitmap,d,{x:0,y:0},{x:g.x+1,y:g.y+1},h.bitmap)}}}this.image=d,this.positions=n};e.register(`GlyphAtlas`,i);var a=function(t){this.tileID=new e.OverscaledTileID(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId};function o(t,n,r){for(var i=new e.EvaluationParameters(n),a=0,o=t;a<o.length;a+=1)o[a].recalculate(i,r)}function s(t,n){var r=e.getArrayBuffer(t.request,(function(t,r,i,a){t?n(t):r&&n(null,{vectorTile:new e.vectorTile.VectorTile(new e.pbf(r)),rawData:r,cacheControl:i,expires:a})}));return function(){r.cancel(),n()}}a.prototype.parse=function(t,n,r,a,s){var c=this;this.status=`parsing`,this.data=t,this.collisionBoxArray=new e.CollisionBoxArray;var l=new e.DictionaryCoder(Object.keys(t.layers).sort()),u=new e.FeatureIndex(this.tileID,this.promoteId);u.bucketLayerIDs=[];var d,f,p,m,h={},g={featureIndex:u,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:r},_=n.familiesBySource[this.source];for(var v in _){var y=t.layers[v];if(y){y.version===1&&e.warnOnce(`Vector tile source "`+this.source+`" layer "`+v+`" does not use vector tile spec v2 and therefore may have some rendering errors.`);for(var b=l.encode(v),x=[],S=0;S<y.length;S++){var C=y.feature(S),w=u.getId(C,v);x.push({feature:C,id:w,index:S,sourceLayerIndex:b})}for(var E=0,D=_[v];E<D.length;E+=1){var O=D[E],k=O[0];k.minzoom&&this.zoom<Math.floor(k.minzoom)||k.maxzoom&&this.zoom>=k.maxzoom||k.visibility!==`none`&&(o(O,this.zoom,r),(h[k.id]=k.createBucket({index:u.bucketLayerIDs.length,layers:O,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:b,sourceID:this.source})).populate(x,g,this.tileID.canonical),u.bucketLayerIDs.push(O.map((function(e){return e.id}))))}}}var A=e.mapObject(g.glyphDependencies,(function(e){return Object.keys(e).map(Number)}));Object.keys(A).length?a.send(`getGlyphs`,{uid:this.uid,stacks:A},(function(e,t){d||(d=e,f=t,N.call(c))})):f={};var j=Object.keys(g.iconDependencies);j.length?a.send(`getImages`,{icons:j,source:this.source,tileID:this.tileID,type:`icons`},(function(e,t){d||(d=e,p=t,N.call(c))})):p={};var M=Object.keys(g.patternDependencies);function N(){if(d)return s(d);if(f&&p&&m){var t=new i(f),n=new e.ImageAtlas(p,m);for(var a in h){var c=h[a];c instanceof e.SymbolBucket?(o(c.layers,this.zoom,r),e.performSymbolLayout(c,f,t.positions,p,n.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):c.hasPattern&&(c instanceof e.LineBucket||c instanceof e.FillBucket||c instanceof e.FillExtrusionBucket)&&(o(c.layers,this.zoom,r),c.addFeatures(g,this.tileID.canonical,n.patternPositions))}this.status=`done`,s(null,{buckets:e.values(h).filter((function(e){return!e.isEmpty()})),featureIndex:u,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,imageAtlas:n,glyphMap:this.returnDependencies?f:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?t.positions:null})}}M.length?a.send(`getImages`,{icons:M,source:this.source,tileID:this.tileID,type:`patterns`},(function(e,t){d||(d=e,m=t,N.call(c))})):m={},N.call(this)};var c=function(e,t,n,r){this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=r||s,this.loading={},this.loaded={}};c.prototype.loadTile=function(t,n){var r=this,i=t.uid;this.loading||={};var o=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.RequestPerformance(t.request),s=this.loading[i]=new a(t);s.abort=this.loadVectorData(t,(function(t,a){if(delete r.loading[i],t||!a)return s.status=`done`,r.loaded[i]=s,n(t);var c=a.rawData,l={};a.expires&&(l.expires=a.expires),a.cacheControl&&(l.cacheControl=a.cacheControl);var u={};if(o){var d=o.finish();d&&(u.resourceTiming=JSON.parse(JSON.stringify(d)))}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(t,r){if(t||!r)return n(t);n(null,e.extend({rawTileData:c.slice(0)},r,l,u))})),r.loaded=r.loaded||{},r.loaded[i]=s}))},c.prototype.reloadTile=function(e,t){var n=this,r=this.loaded,i=e.uid,a=this;if(r&&r[i]){var o=r[i];o.showCollisionBoxes=e.showCollisionBoxes;var s=function(e,r){var i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,a.layerIndex,n.availableImages,a.actor,i)),t(e,r)};o.status===`parsing`?o.reloadCallback=s:o.status===`done`&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},c.prototype.abortTile=function(e,t){var n=this.loading,r=e.uid;n&&n[r]&&n[r].abort&&(n[r].abort(),delete n[r]),t()},c.prototype.removeTile=function(e,t){var n=this.loaded,r=e.uid;n&&n[r]&&delete n[r],t()};var l=e.window.ImageBitmap,u=function(){this.loaded={}};function d(e,t){if(e.length!==0){f(e[0],t);for(var n=1;n<e.length;n++)f(e[n],!t)}}function f(e,t){for(var n=0,r=0,i=0,a=e.length,o=a-1;i<a;o=i++){var s=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]),c=n+s;r+=Math.abs(n)>=Math.abs(s)?n-c+s:s-c+n,n=c}n+r>=0!=!!t&&e.reverse()}u.prototype.loadTile=function(t,n){var r=t.uid,i=t.encoding,a=t.rawImageData,o=l&&a instanceof l?this.getImageData(a):a,s=new e.DEMData(r,o,i);this.loaded=this.loaded||{},this.loaded[r]=s,n(null,s)},u.prototype.getImageData=function(t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext(`2d`)),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);var n=this.offscreenCanvasContext.getImageData(-1,-1,t.width+2,t.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new e.RGBAImage({width:n.width,height:n.height},n.data)},u.prototype.removeTile=function(e){var t=this.loaded,n=e.uid;t&&t[n]&&delete t[n]};var p=e.vectorTile.VectorTileFeature.prototype.toGeoJSON,m=function(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,`id`in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))};m.prototype.loadGeometry=function(){if(this._feature.type===1){for(var t=[],n=0,r=this._feature.geometry;n<r.length;n+=1){var i=r[n];t.push([new e.Point$1(i[0],i[1])])}return t}for(var a=[],o=0,s=this._feature.geometry;o<s.length;o+=1){for(var c=[],l=0,u=s[o];l<u.length;l+=1){var d=u[l];c.push(new e.Point$1(d[0],d[1]))}a.push(c)}return a},m.prototype.toGeoJSON=function(e,t,n){return p.call(this,e,t,n)};var h=function(t){this.layers={_geojsonTileLayer:this},this.name=`_geojsonTileLayer`,this.extent=e.EXTENT,this.length=t.length,this._features=t};h.prototype.feature=function(e){return new m(this._features[e])};var g=e.vectorTile.VectorTileFeature,_=v;function v(e,t){this.options=t||{},this.features=e,this.length=e.length}function y(e,t){this.id=typeof e.id==`number`?e.id:void 0,this.type=e.type,this.rawGeometry=e.type===1?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}v.prototype.feature=function(e){return new y(this.features[e],this.options.extent)},y.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var n=0;n<t.length;n++){for(var r=t[n],i=[],a=0;a<r.length;a++)i.push(new e.Point$1(r[a][0],r[a][1]));this.geometry.push(i)}return this.geometry},y.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,r=1/0,i=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var c=o[s];t=Math.min(t,c.x),n=Math.max(n,c.x),r=Math.min(r,c.y),i=Math.max(i,c.y)}return[t,r,n,i]},y.prototype.toGeoJSON=g.prototype.toGeoJSON;var b=S,x=_;function S(t){var n=new e.pbf;return function(e,t){for(var n in e.layers)t.writeMessage(3,C,e.layers[n])}(t,n),n.finish()}function C(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||``),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)r.feature=e.feature(n),t.writeMessage(2,w,r);var i=r.keys;for(n=0;n<i.length;n++)t.writeStringField(3,i[n]);var a=r.values;for(n=0;n<a.length;n++)t.writeMessage(4,A,a[n])}function w(e,t){var n=e.feature;n.id!==void 0&&t.writeVarintField(1,n.id),t.writeMessage(2,E,e),t.writeVarintField(3,n.type),t.writeMessage(4,k,n)}function E(e,t){var n=e.feature,r=e.keys,i=e.values,a=e.keycache,o=e.valuecache;for(var s in n.properties){var c=a[s];c===void 0&&(r.push(s),a[s]=c=r.length-1),t.writeVarint(c);var l=n.properties[s],u=typeof l;u!==`string`&&u!==`boolean`&&u!==`number`&&(l=JSON.stringify(l));var d=u+`:`+l,f=o[d];f===void 0&&(i.push(l),o[d]=f=i.length-1),t.writeVarint(f)}}function D(e,t){return(t<<3)+(7&e)}function O(e){return e<<1^e>>31}function k(e,t){for(var n=e.loadGeometry(),r=e.type,i=0,a=0,o=n.length,s=0;s<o;s++){var c=n[s],l=1;r===1&&(l=c.length),t.writeVarint(D(1,l));for(var u=r===3?c.length-1:c.length,d=0;d<u;d++){d===1&&r!==1&&t.writeVarint(D(2,u-1));var f=c[d].x-i,p=c[d].y-a;t.writeVarint(O(f)),t.writeVarint(O(p)),i+=f,a+=p}r===3&&t.writeVarint(D(7,1))}}function A(e,t){var n=typeof e;n===`string`?t.writeStringField(1,e):n===`boolean`?t.writeBooleanField(7,e):n===`number`&&(e%1==0?e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e):t.writeDoubleField(3,e))}function j(e,t,n,r){M(e,n,r),M(t,2*n,2*r),M(t,2*n+1,2*r+1)}function M(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function N(e,t,n,r){var i=e-n,a=t-r;return i*i+a*a}b.fromVectorTileJs=S,b.fromGeojsonVt=function(e,t){t||={};var n={};for(var r in e)n[r]=new _(e[r].features,t),n[r].name=r,n[r].version=t.version,n[r].extent=t.extent;return S({layers:n})},b.GeoJSONWrapper=x;var P=function(e){return e[0]},F=function(e){return e[1]},I=function(e,t,n,r,i){t===void 0&&(t=P),n===void 0&&(n=F),r===void 0&&(r=64),i===void 0&&(i=Float64Array),this.nodeSize=r,this.points=e;for(var a=this.ids=new(e.length<65536?Uint16Array:Uint32Array)(e.length),o=this.coords=new i(2*e.length),s=0;s<e.length;s++)a[s]=s,o[2*s]=t(e[s]),o[2*s+1]=n(e[s]);(function e(t,n,r,i,a,o){if(!(a-i<=r)){var s=i+a>>1;(function e(t,n,r,i,a,o){for(;a>i;){if(a-i>600){var s=a-i+1,c=r-i+1,l=Math.log(s),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(s-u)/s)*(c-s/2<0?-1:1);e(t,n,r,Math.max(i,Math.floor(r-c*u/s+d)),Math.min(a,Math.floor(r+(s-c)*u/s+d)),o)}var f=n[2*r+o],p=i,m=a;for(j(t,n,i,r),n[2*a+o]>f&&j(t,n,i,a);p<m;){for(j(t,n,p,m),p++,m--;n[2*p+o]<f;)p++;for(;n[2*m+o]>f;)m--}n[2*i+o]===f?j(t,n,i,m):j(t,n,++m,a),m<=r&&(i=m+1),r<=m&&(a=m-1)}})(t,n,s,i,a,o%2),e(t,n,r,i,s-1,o+1),e(t,n,r,s+1,a,o+1)}})(a,o,r,0,a.length-1,0)};I.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,a,o){for(var s,c,l=[0,e.length-1,0],u=[];l.length;){var d=l.pop(),f=l.pop(),p=l.pop();if(f-p<=o)for(var m=p;m<=f;m++)c=t[2*m+1],(s=t[2*m])>=n&&s<=i&&c>=r&&c<=a&&u.push(e[m]);else{var h=Math.floor((p+f)/2);c=t[2*h+1],(s=t[2*h])>=n&&s<=i&&c>=r&&c<=a&&u.push(e[h]);var g=(d+1)%2;(d===0?n<=s:r<=c)&&(l.push(p),l.push(h-1),l.push(g)),(d===0?i>=s:a>=c)&&(l.push(h+1),l.push(f),l.push(g))}}return u}(this.ids,this.coords,e,t,n,r,this.nodeSize)},I.prototype.within=function(e,t,n){return function(e,t,n,r,i,a){for(var o=[0,e.length-1,0],s=[],c=i*i;o.length;){var l=o.pop(),u=o.pop(),d=o.pop();if(u-d<=a)for(var f=d;f<=u;f++)N(t[2*f],t[2*f+1],n,r)<=c&&s.push(e[f]);else{var p=Math.floor((d+u)/2),m=t[2*p],h=t[2*p+1];N(m,h,n,r)<=c&&s.push(e[p]);var g=(l+1)%2;(l===0?n-i<=m:r-i<=h)&&(o.push(d),o.push(p-1),o.push(g)),(l===0?n+i>=m:r+i>=h)&&(o.push(p+1),o.push(u),o.push(g))}}return s}(this.ids,this.coords,e,t,n,this.nodeSize)};var ee={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},R=function(e){this.options=ie(Object.create(ee),e),this.trees=Array(this.options.maxZoom+1)};function z(e,t,n,r,i){return{x:e,y:t,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function B(e,t){var n=e.geometry.coordinates,r=n[1];return{x:re(n[0]),y:V(r),zoom:1/0,index:t,parentId:-1}}function te(e){return{type:`Feature`,id:e.id,properties:ne(e),geometry:{type:`Point`,coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function ne(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+`k`:t>=1e3?Math.round(t/100)/10+`k`:t;return ie(ie({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function re(e){return e/360+.5}function V(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function ie(e,t){for(var n in t)e[n]=t[n];return e}function ae(e){return e.x}function oe(e){return e.y}function se(e,t,n,r,i,a){var o=i-n,s=a-r;if(o!==0||s!==0){var c=((e-n)*o+(t-r)*s)/(o*o+s*s);c>1?(n=i,r=a):c>0&&(n+=o*c,r+=s*c)}return(o=e-n)*o+(s=t-r)*s}function ce(e,t,n,r){var i={id:e===void 0?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if(n===`Point`||n===`MultiPoint`||n===`LineString`)H(e,t);else if(n===`Polygon`||n===`MultiLineString`)for(var r=0;r<t.length;r++)H(e,t[r]);else if(n===`MultiPolygon`)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)H(e,t[r][i])}(i),i}function H(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function le(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,a=t.geometry.type,o=(n.tolerance/((1<<n.maxZoom)*n.extent))**2,s=[],c=t.id;if(n.promoteId?c=t.properties[n.promoteId]:n.generateId&&(c=r||0),a===`Point`)ue(i,s);else if(a===`MultiPoint`)for(var l=0;l<i.length;l++)ue(i[l],s);else if(a===`LineString`)de(i,s,o,!1);else if(a===`MultiLineString`){if(n.lineMetrics){for(l=0;l<i.length;l++)de(i[l],s=[],o,!1),e.push(ce(c,`LineString`,s,t.properties));return}U(i,s,o,!1)}else if(a===`Polygon`)U(i,s,o,!0);else{if(a!==`MultiPolygon`){if(a===`GeometryCollection`){for(l=0;l<t.geometry.geometries.length;l++)le(e,{id:c,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw Error(`Input data is not a valid GeoJSON object.`)}for(l=0;l<i.length;l++){var u=[];U(i[l],u,o,!0),s.push(u)}}e.push(ce(c,a,s,t.properties))}}function ue(e,t){t.push(fe(e[0])),t.push(pe(e[1])),t.push(0)}function de(e,t,n,r){for(var i,a,o=0,s=0;s<e.length;s++){var c=fe(e[s][0]),l=pe(e[s][1]);t.push(c),t.push(l),t.push(0),s>0&&(o+=r?(i*l-c*a)/2:Math.sqrt((c-i)**2+(l-a)**2)),i=c,a=l}var u=t.length-3;t[2]=1,function e(t,n,r,i){for(var a,o=i,s=r-n>>1,c=r-n,l=t[n],u=t[n+1],d=t[r],f=t[r+1],p=n+3;p<r;p+=3){var m=se(t[p],t[p+1],l,u,d,f);if(m>o)a=p,o=m;else if(m===o){var h=Math.abs(p-s);h<c&&(a=p,c=h)}}o>i&&(a-n>3&&e(t,n,a,i),t[a+2]=o,r-a>3&&e(t,a,r,i))}(t,0,u,n),t[u+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function U(e,t,n,r){for(var i=0;i<e.length;i++){var a=[];de(e[i],a,n,r),t.push(a)}}function fe(e){return e/360+.5}function pe(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function me(e,t,n,r,i,a,o,s){if(r/=t,a>=(n/=t)&&o<r)return e;if(o<n||a>=r)return null;for(var c=[],l=0;l<e.length;l++){var u=e[l],d=u.geometry,f=u.type,p=i===0?u.minX:u.minY,m=i===0?u.maxX:u.maxY;if(p>=n&&m<r)c.push(u);else if(!(m<n||p>=r)){var h=[];if(f===`Point`||f===`MultiPoint`)W(d,h,n,r,i);else if(f===`LineString`)he(d,h,n,r,i,!1,s.lineMetrics);else if(f===`MultiLineString`)_e(d,h,n,r,i,!1);else if(f===`Polygon`)_e(d,h,n,r,i,!0);else if(f===`MultiPolygon`)for(var g=0;g<d.length;g++){var _=[];_e(d[g],_,n,r,i,!0),_.length&&h.push(_)}if(h.length){if(s.lineMetrics&&f===`LineString`){for(g=0;g<h.length;g++)c.push(ce(u.id,f,h[g],u.tags));continue}f!==`LineString`&&f!==`MultiLineString`||(h.length===1?(f=`LineString`,h=h[0]):f=`MultiLineString`),f!==`Point`&&f!==`MultiPoint`||(f=h.length===3?`Point`:`MultiPoint`),c.push(ce(u.id,f,h,u.tags))}}}return c.length?c:null}function W(e,t,n,r,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=n&&o<=r&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function he(e,t,n,r,i,a,o){for(var s,c,l=ge(e),u=i===0?K:ve,d=e.start,f=0;f<e.length-3;f+=3){var p=e[f],m=e[f+1],h=e[f+2],g=e[f+3],_=e[f+4],v=i===0?p:m,y=i===0?g:_,b=!1;o&&(s=Math.sqrt((p-g)**2+(m-_)**2)),v<n?y>n&&(c=u(l,p,m,g,_,n),o&&(l.start=d+s*c)):v>r?y<r&&(c=u(l,p,m,g,_,r),o&&(l.start=d+s*c)):G(l,p,m,h),y<n&&v>=n&&(c=u(l,p,m,g,_,n),b=!0),y>r&&v<=r&&(c=u(l,p,m,g,_,r),b=!0),!a&&b&&(o&&(l.end=d+s*c),t.push(l),l=ge(e)),o&&(d+=s)}var x=e.length-3;p=e[x],m=e[x+1],h=e[x+2],(v=i===0?p:m)>=n&&v<=r&&G(l,p,m,h),x=l.length-3,a&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&G(l,l[0],l[1],l[2]),l.length&&t.push(l)}function ge(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function _e(e,t,n,r,i,a){for(var o=0;o<e.length;o++)he(e[o],t,n,r,i,a,!1)}function G(e,t,n,r){e.push(t),e.push(n),e.push(r)}function K(e,t,n,r,i,a){var o=(a-t)/(r-t);return e.push(a),e.push(n+(i-n)*o),e.push(1),o}function ve(e,t,n,r,i,a){var o=(a-n)/(i-n);return e.push(t+(r-t)*o),e.push(a),e.push(1),o}function ye(e,t){for(var n=[],r=0;r<e.length;r++){var i,a=e[r],o=a.type;if(o===`Point`||o===`MultiPoint`||o===`LineString`)i=be(a.geometry,t);else if(o===`MultiLineString`||o===`Polygon`){i=[];for(var s=0;s<a.geometry.length;s++)i.push(be(a.geometry[s],t))}else if(o===`MultiPolygon`)for(i=[],s=0;s<a.geometry.length;s++){for(var c=[],l=0;l<a.geometry[s].length;l++)c.push(be(a.geometry[s][l],t));i.push(c)}n.push(ce(a.id,o,i,a.tags))}return n}function be(e,t){var n=[];n.size=e.size,e.start!==void 0&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function xe(e,t){if(e.transformed)return e;var n,r,i,a=1<<e.z,o=e.x,s=e.y;for(n=0;n<e.features.length;n++){var c=e.features[n],l=c.geometry,u=c.type;if(c.geometry=[],u===1)for(r=0;r<l.length;r+=2)c.geometry.push(Se(l[r],l[r+1],t,a,o,s));else for(r=0;r<l.length;r++){var d=[];for(i=0;i<l[r].length;i+=2)d.push(Se(l[r][i],l[r][i+1],t,a,o,s));c.geometry.push(d)}}return e.transformed=!0,e}function Se(e,t,n,r,i,a){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-a))]}function Ce(e,t,n,r,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,we(o,e[s],a,i);var c=e[s].minX,l=e[s].minY,u=e[s].maxX,d=e[s].maxY;c<o.minX&&(o.minX=c),l<o.minY&&(o.minY=l),u>o.maxX&&(o.maxX=u),d>o.maxY&&(o.maxY=d)}return o}function we(e,t,n,r){var i=t.geometry,a=t.type,o=[];if(a===`Point`||a===`MultiPoint`)for(var s=0;s<i.length;s+=3)o.push(i[s]),o.push(i[s+1]),e.numPoints++,e.numSimplified++;else if(a===`LineString`)Te(o,i,e,n,!1,!1);else if(a===`MultiLineString`||a===`Polygon`)for(s=0;s<i.length;s++)Te(o,i[s],e,n,a===`Polygon`,s===0);else if(a===`MultiPolygon`)for(var c=0;c<i.length;c++){var l=i[c];for(s=0;s<l.length;s++)Te(o,l[s],e,n,!0,s===0)}if(o.length){var u=t.tags||null;if(a===`LineString`&&r.lineMetrics){for(var d in u={},t.tags)u[d]=t.tags[d];u.mapbox_clip_start=i.start/i.size,u.mapbox_clip_end=i.end/i.size}var f={geometry:o,type:a===`Polygon`||a===`MultiPolygon`?3:a===`LineString`||a===`MultiLineString`?2:1,tags:u};t.id!==null&&(f.id=t.id),e.features.push(f)}}function Te(e,t,n,r,i,a){var o=r*r;if(r>0&&t.size<(i?o:r))n.numPoints+=t.length/3;else{for(var s=[],c=0;c<t.length;c+=3)(r===0||t[c+2]>o)&&(n.numSimplified++,s.push(t[c]),s.push(t[c+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,a=i-2;r<i;a=r,r+=2)n+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var o=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=o,e[i-1-r]=s}}(s,a),e.push(s)}}function Ee(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time(`preprocess data`),t.maxZoom<0||t.maxZoom>24)throw Error(`maxZoom should be in the 0-24 range`);if(t.promoteId&&t.generateId)throw Error(`promoteId and generateId cannot be used together.`);var r=function(e,t){var n=[];if(e.type===`FeatureCollection`)for(var r=0;r<e.features.length;r++)le(n,e.features[r],t,r);else le(n,e.type===`Feature`?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd(`preprocess data`),console.log(`index: maxZoom: %d, maxPoints: %d`,t.indexMaxZoom,t.indexMaxPoints),console.time(`generate tiles`),this.stats={},this.total=0),(r=function(e,t){var n=t.buffer/t.extent,r=e,i=me(e,1,-1-n,n,0,-1,2,t),a=me(e,1,1-n,2+n,0,-1,2,t);return(i||a)&&(r=me(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=ye(i,1).concat(r)),a&&(r=r.concat(ye(a,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log(`features: %d, points: %d`,this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd(`generate tiles`),console.log(`tiles generated:`,this.total,JSON.stringify(this.stats)))}function De(e,t,n){return 32*((1<<e)*n+t)+e}function Oe(e,t){var n=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);var r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return t(null,null);var i=new h(r.features),a=b(i);a.byteOffset===0&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),t(null,{vectorTile:i,rawData:a.buffer})}R.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,a=t.nodeSize;n&&console.time(`total time`);var o=`prepare `+e.length+` points`;n&&console.time(o),this.points=e;for(var s=[],c=0;c<e.length;c++)e[c].geometry&&s.push(B(e[c],c));this.trees[i+1]=new I(s,ae,oe,a,Float32Array),n&&console.timeEnd(o);for(var l=i;l>=r;l--){var u=+Date.now();s=this._cluster(s,l),this.trees[l]=new I(s,ae,oe,a,Float32Array),n&&console.log(`z%d: %d clusters in %dms`,l,s.length,+Date.now()-u)}return n&&console.timeEnd(`total time`),this},R.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=e[2]===180?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var o=this.getClusters([n,r,180,a],t),s=this.getClusters([-180,r,i,a],t);return o.concat(s)}for(var c=this.trees[this._limitZoom(t)],l=[],u=0,d=c.range(re(n),V(a),re(i),V(r));u<d.length;u+=1){var f=c.points[d[u]];l.push(f.numPoints?te(f):this.points[f.index])}return l},R.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r=`No cluster with the specified id.`,i=this.trees[n];if(!i)throw Error(r);var a=i.points[t];if(!a)throw Error(r);for(var o=this.options.radius/(this.options.extent*2**(n-1)),s=[],c=0,l=i.within(a.x,a.y,o);c<l.length;c+=1){var u=i.points[l[c]];u.parentId===e&&s.push(u.numPoints?te(u):this.points[u.index])}if(s.length===0)throw Error(r);return s},R.prototype.getLeaves=function(e,t,n){var r=[];return this._appendLeaves(r,e,t||=10,n||=0,0),r},R.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=2**e,a=this.options,o=a.radius/a.extent,s=(n-o)/i,c=(n+1+o)/i,l={features:[]};return this._addTileFeatures(r.range((t-o)/i,s,(t+1+o)/i,c),r.points,t,n,i,l),t===0&&this._addTileFeatures(r.range(1-o/i,s,1,c),r.points,i,n,i,l),t===i-1&&this._addTileFeatures(r.range(0,s,o/i,c),r.points,-1,n,i,l),l.features.length?l:null},R.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,n.length!==1)break;e=n[0].properties.cluster_id}return t},R.prototype._appendLeaves=function(e,t,n,r,i){for(var a=0,o=this.getChildren(t);a<o.length;a+=1){var s=o[a],c=s.properties;if(c&&c.cluster?i+c.point_count<=r?i+=c.point_count:i=this._appendLeaves(e,c.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},R.prototype._addTileFeatures=function(e,t,n,r,i,a){for(var o=0,s=e;o<s.length;o+=1){var c=t[s[o]],l=c.numPoints,u={type:1,geometry:[[Math.round(this.options.extent*(c.x*i-n)),Math.round(this.options.extent*(c.y*i-r))]],tags:l?ne(c):this.points[c.index].properties},d=void 0;l?d=c.id:this.options.generateId?d=c.index:this.points[c.index].id&&(d=this.points[c.index].id),d!==void 0&&(u.id=d),a.features.push(u)}},R.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))},R.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.reduce,a=r.minPoints,o=r.radius/(r.extent*2**t),s=0;s<e.length;s++){var c=e[s];if(!(c.zoom<=t)){c.zoom=t;for(var l=this.trees[t+1],u=l.within(c.x,c.y,o),d=c.numPoints||1,f=d,p=0,m=u;p<m.length;p+=1){var h=l.points[m[p]];h.zoom>t&&(f+=h.numPoints||1)}if(f>=a){for(var g=c.x*d,_=c.y*d,v=i&&d>1?this._map(c,!0):null,y=(s<<5)+(t+1)+this.points.length,b=0,x=u;b<x.length;b+=1){var S=l.points[x[b]];if(!(S.zoom<=t)){S.zoom=t;var C=S.numPoints||1;g+=S.x*C,_+=S.y*C,S.parentId=y,i&&(v||=this._map(c,!0),i(v,this._map(S)))}}c.parentId=y,n.push(z(g/f,_/f,y,f,v))}else if(n.push(c),f>1)for(var w=0,E=u;w<E.length;w+=1){var D=l.points[E[w]];D.zoom<=t||(D.zoom=t,n.push(D))}}}return n},R.prototype._getOriginId=function(e){return e-this.points.length>>5},R.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},R.prototype._map=function(e,t){if(e.numPoints)return t?ie({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?ie({},r):r},Ee.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ee.prototype.splitTile=function(e,t,n,r,i,a,o){for(var s=[e,t,n,r],c=this.options,l=c.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var u=1<<t,d=De(t,n,r),f=this.tiles[d];if(!f&&(l>1&&console.time(`creation`),f=this.tiles[d]=Ce(e,t,n,r,c),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log(`tile z%d-%d-%d (features: %d, points: %d, simplified: %d)`,t,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd(`creation`));var p=`z`+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,i){if(t===c.maxZoom||t===i)continue;var m=1<<i-t;if(n!==Math.floor(a/m)||r!==Math.floor(o/m))continue}else if(t===c.indexMaxZoom||f.numPoints<=c.indexMaxPoints)continue;if(f.source=null,e.length!==0){l>1&&console.time(`clipping`);var h,g,_,v,y,b,x=.5*c.buffer/c.extent,S=.5-x,C=.5+x,w=1+x;h=g=_=v=null,y=me(e,u,n-x,n+C,0,f.minX,f.maxX,c),b=me(e,u,n+S,n+w,0,f.minX,f.maxX,c),e=null,y&&=(h=me(y,u,r-x,r+C,1,f.minY,f.maxY,c),g=me(y,u,r+S,r+w,1,f.minY,f.maxY,c),null),b&&=(_=me(b,u,r-x,r+C,1,f.minY,f.maxY,c),v=me(b,u,r+S,r+w,1,f.minY,f.maxY,c),null),l>1&&console.timeEnd(`clipping`),s.push(h||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(_||[],t+1,2*n+1,2*r),s.push(v||[],t+1,2*n+1,2*r+1)}}},Ee.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,a=r.debug;if(e<0||e>24)return null;var o=1<<e,s=De(e,t=(t%o+o)%o,n);if(this.tiles[s])return xe(this.tiles[s],i);a>1&&console.log(`drilling down to z%d-%d-%d`,e,t,n);for(var c,l=e,u=t,d=n;!c&&l>0;)l--,u=Math.floor(u/2),d=Math.floor(d/2),c=this.tiles[De(l,u,d)];return c&&c.source?(a>1&&console.log(`found parent tile z%d-%d-%d`,l,u,d),a>1&&console.time(`drilling down`),this.splitTile(c.source,l,u,d,e,t,n),a>1&&console.timeEnd(`drilling down`),this.tiles[s]?xe(this.tiles[s],i):null):null};var ke=function(t){function n(e,n,r,i){t.call(this,e,n,r,Oe),i&&(this.loadGeoJSON=i)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.loadData=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=t,this._pendingLoadDataParams=e,this._state&&this._state!==`Idle`?this._state=`NeedsLoadData`:(this._state=`Coalescing`,this._loadData())},n.prototype._loadData=function(){var t=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(r&&r.request&&r.request.collectResourceTiming)&&new e.RequestPerformance(r.request);this.loadGeoJSON(r,(function(a,o){if(a||!o)return n(a);if(typeof o!=`object`)return n(Error(`Input data given to '`+r.source+`' is not a valid GeoJSON object.`));(function e(t,n){var r,i=t&&t.type;if(i===`FeatureCollection`)for(r=0;r<t.features.length;r++)e(t.features[r],n);else if(i===`GeometryCollection`)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],n);else if(i===`Feature`)e(t.geometry,n);else if(i===`Polygon`)d(t.coordinates,n);else if(i===`MultiPolygon`)for(r=0;r<t.coordinates.length;r++)d(t.coordinates[r],n);return t})(o,!0);try{if(r.filter){var s=e.createExpression(r.filter,{type:`boolean`,"property-type":`data-driven`,overridable:!1,transition:!1});if(s.result===`error`)throw Error(s.value.map((function(e){return e.key+`: `+e.message})).join(`, `));o={type:`FeatureCollection`,features:o.features.filter((function(e){return s.value.evaluate({zoom:0},e)}))}}t._geoJSONIndex=r.cluster?new R(function(t){var n=t.superclusterOptions,r=t.clusterProperties;if(!r||!n)return n;for(var i={},a={},o={accumulated:null,zoom:0},s={properties:null},c=Object.keys(r),l=0,u=c;l<u.length;l+=1){var d=u[l],f=r[d],p=f[0],m=e.createExpression(f[1]),h=e.createExpression(typeof p==`string`?[p,[`accumulated`],[`get`,d]]:p);i[d]=m.value,a[d]=h.value}return n.map=function(e){s.properties=e;for(var t={},n=0,r=c;n<r.length;n+=1){var a=r[n];t[a]=i[a].evaluate(o,s)}return t},n.reduce=function(e,t){s.properties=t;for(var n=0,r=c;n<r.length;n+=1){var i=r[n];o.accumulated=e[i],e[i]=a[i].evaluate(o,s)}},n}(r)).load(o.features):function(e,t){return new Ee(e,t)}(o,r.geojsonVtOptions)}catch(e){return n(e)}t.loaded={};var c={};if(i){var l=i.finish();l&&(c.resourceTiming={},c.resourceTiming[r.source]=JSON.parse(JSON.stringify(l)))}n(null,c)}))}},n.prototype.coalesce=function(){this._state===`Coalescing`?this._state=`Idle`:this._state===`NeedsLoadData`&&(this._state=`Coalescing`,this._loadData())},n.prototype.reloadTile=function(e,n){var r=this.loaded;return r&&r[e.uid]?t.prototype.reloadTile.call(this,e,n):this.loadTile(e,n)},n.prototype.loadGeoJSON=function(t,n){if(t.request)e.getJSON(t.request,n);else{if(typeof t.data!=`string`)return n(Error(`Input data given to '`+t.source+`' is not a valid GeoJSON object.`));try{return n(null,JSON.parse(t.data))}catch{return n(Error(`Input data given to '`+t.source+`' is not a valid GeoJSON object.`))}}},n.prototype.removeSource=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t()},n.prototype.getClusterExpansionZoom=function(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}},n.prototype.getClusterChildren=function(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}},n.prototype.getClusterLeaves=function(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}},n}(c),Ae=function(t){var n=this;this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:c,geojson:ke},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,t){if(n.workerSourceTypes[e])throw Error(`Worker source with name "`+e+`" already registered.`);n.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=function(t){if(e.plugin.isParsed())throw Error(`RTL text plugin already registered.`);e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}};return Ae.prototype.setReferrer=function(e,t){this.referrer=t},Ae.prototype.setImages=function(e,t,n){for(var r in this.availableImages[e]=t,this.workerSources[e]){var i=this.workerSources[e][r];for(var a in i)i[a].availableImages=t}n()},Ae.prototype.setLayers=function(e,t,n){this.getLayerIndex(e).replace(t),n()},Ae.prototype.updateLayers=function(e,t,n){this.getLayerIndex(e).update(t.layers,t.removedIds),n()},Ae.prototype.loadTile=function(e,t,n){this.getWorkerSource(e,t.type,t.source).loadTile(t,n)},Ae.prototype.loadDEMTile=function(e,t,n){this.getDEMWorkerSource(e,t.source).loadTile(t,n)},Ae.prototype.reloadTile=function(e,t,n){this.getWorkerSource(e,t.type,t.source).reloadTile(t,n)},Ae.prototype.abortTile=function(e,t,n){this.getWorkerSource(e,t.type,t.source).abortTile(t,n)},Ae.prototype.removeTile=function(e,t,n){this.getWorkerSource(e,t.type,t.source).removeTile(t,n)},Ae.prototype.removeDEMTile=function(e,t){this.getDEMWorkerSource(e,t.source).removeTile(t)},Ae.prototype.removeSource=function(e,t,n){if(this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]){var r=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],r.removeSource===void 0?n():r.removeSource(t,n)}},Ae.prototype.loadWorkerSource=function(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}},Ae.prototype.syncRTLPluginState=function(t,n,r){try{e.plugin.setState(n);var i=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&i!=null){this.self.importScripts(i);var a=e.plugin.isParsed();r(a?void 0:Error(`RTL Text Plugin failed to import scripts from `+i),a)}}catch(e){r(e.toString())}},Ae.prototype.getAvailableImages=function(e){var t=this.availableImages[e];return t||=[],t},Ae.prototype.getLayerIndex=function(e){var t=this.layerIndexes[e];return t||=this.layerIndexes[e]=new r,t},Ae.prototype.getWorkerSource=function(e,t,n){var r=this;return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][n]||(this.workerSources[e][t][n]=new this.workerSourceTypes[t]({send:function(t,n,i){r.actor.send(t,n,i,e)}},this.getLayerIndex(e),this.getAvailableImages(e))),this.workerSources[e][t][n]},Ae.prototype.getDEMWorkerSource=function(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new u),this.demWorkerSources[e][t]},Ae.prototype.enforceCacheSizeLimit=function(t,n){e.enforceCacheSizeLimit(n)},typeof WorkerGlobalScope<`u`&&typeof self<`u`&&self instanceof WorkerGlobalScope&&(self.worker=new Ae(self)),Ae})),r([`./shared`],(function(e){var t=e.createCommonjsModule((function(e){function t(e){return!n(e)}function n(e){return typeof window>`u`||typeof document>`u`?`not a browser`:Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?`JSON`in window&&`parse`in JSON&&`stringify`in JSON?function(){if(!(`Worker`in window&&`Blob`in window&&`URL`in window))return!1;var e,t,n=new Blob([``],{type:`text/javascript`}),r=URL.createObjectURL(n);try{t=new Worker(r),e=!0}catch{e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?`Uint8ClampedArray`in window?ArrayBuffer.isView?function(){var e=document.createElement(`canvas`);e.width=e.height=1;var t=e.getContext(`2d`);if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(r[n=e&&e.failIfMajorPerformanceCaveat]===void 0&&(r[n]=function(e){var n=function(e){var n=document.createElement(`canvas`),r=Object.create(t.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,n.probablySupportsContext?n.probablySupportsContext(`webgl`,r)||n.probablySupportsContext(`experimental-webgl`,r):n.supportsContext?n.supportsContext(`webgl`,r)||n.supportsContext(`experimental-webgl`,r):n.getContext(`webgl`,r)||n.getContext(`experimental-webgl`,r)}(e);if(!n)return!1;var r=n.createShader(n.VERTEX_SHADER);return!(!r||n.isContextLost())&&(n.shaderSource(r,`void main() {}`),n.compileShader(r),!0===n.getShaderParameter(r,n.COMPILE_STATUS))}(n)),r[n]?void 0:`insufficient WebGL support`):`insufficient Canvas/getImageData support`:`insufficient ArrayBuffer support`:`insufficient Uint8ClampedArray support`:`insufficient worker support`:`insufficient JSON support`:`insufficient Object support`:`insufficient Function support`:`insufficent Array support`;var n}e.exports?e.exports=t:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=t,window.mapboxgl.notSupportedReason=n);var r={};t.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(t,n,r){var i=e.window.document.createElement(t);return n!==void 0&&(i.className=n),r&&r.appendChild(i),i},createNS:function(t,n){return e.window.document.createElementNS(t,n)}},r=e.window.document&&e.window.document.documentElement.style;function i(e){if(!r)return e[0];for(var t=0;t<e.length;t++)if(e[t]in r)return e[t];return e[0]}var a,o=i([`userSelect`,`MozUserSelect`,`WebkitUserSelect`,`msUserSelect`]);n.disableDrag=function(){r&&o&&(a=r[o],r[o]=`none`)},n.enableDrag=function(){r&&o&&(r[o]=a)};var s=i([`transform`,`WebkitTransform`]);n.setTransform=function(e,t){e.style[s]=t};var c=!1;try{var l=Object.defineProperty({},`passive`,{get:function(){c=!0}});e.window.addEventListener(`test`,l,l),e.window.removeEventListener(`test`,l,l)}catch{c=!1}n.addEventListener=function(e,t,n,r){r===void 0&&(r={}),e.addEventListener(t,n,`passive`in r&&c?r:r.capture)},n.removeEventListener=function(e,t,n,r){r===void 0&&(r={}),e.removeEventListener(t,n,`passive`in r&&c?r:r.capture)};var u=function(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener(`click`,u,!0)};function d(e){var t=e.userImage;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}n.suppressClick=function(){e.window.addEventListener(`click`,u,!0),e.window.setTimeout((function(){e.window.removeEventListener(`click`,u,!0)}),0)},n.mousePos=function(t,n){var r=t.getBoundingClientRect();return new e.Point(n.clientX-r.left-t.clientLeft,n.clientY-r.top-t.clientTop)},n.touchPos=function(t,n){for(var r=t.getBoundingClientRect(),i=[],a=0;a<n.length;a++)i.push(new e.Point(n[a].clientX-r.left-t.clientLeft,n[a].clientY-r.top-t.clientTop));return i},n.mouseButton=function(t){return e.window.InstallTrigger!==void 0&&t.button===2&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf(`MAC`)>=0?0:t.button},n.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var f=function(t){function n(){t.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(e){if(this.loaded!==e&&(this.loaded=e,e)){for(var t=0,n=this.requestors;t<n.length;t+=1){var r=n[t];this._notify(r.ids,r.callback)}this.requestors=[]}},n.prototype.getImage=function(e){return this.images[e]},n.prototype.addImage=function(e,t){this._validate(e,t)&&(this.images[e]=t)},n.prototype._validate=function(t,n){var r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.ErrorEvent(Error(`Image "`+t+`" has invalid "stretchX" value`))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.ErrorEvent(Error(`Image "`+t+`" has invalid "stretchY" value`))),r=!1),this._validateContent(n.content,n)||(this.fire(new e.ErrorEvent(Error(`Image "`+t+`" has invalid "content" value`))),r=!1),r},n.prototype._validateStretch=function(e,t){if(!e)return!0;for(var n=0,r=0,i=e;r<i.length;r+=1){var a=i[r];if(a[0]<n||a[1]<a[0]||t<a[1])return!1;n=a[1]}return!0},n.prototype._validateContent=function(e,t){return!(e&&(e.length!==4||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))},n.prototype.updateImage=function(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0},n.prototype.removeImage=function(e){var t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(e,t){var n=!0;if(!this.isLoaded())for(var r=0,i=e;r<i.length;r+=1)this.images[i[r]]||(n=!1);this.isLoaded()||n?this._notify(e,t):this.requestors.push({ids:e,callback:t})},n.prototype._notify=function(t,n){for(var r={},i=0,a=t;i<a.length;i+=1){var o=a[i];this.images[o]||this.fire(new e.Event(`styleimagemissing`,{id:o}));var s=this.images[o];s?r[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:!!(s.userImage&&s.userImage.render)}:e.warnOnce(`Image "`+o+`" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,r)},n.prototype.getPixelSize=function(){var e=this.atlasImage;return{width:e.width,height:e.height}},n.prototype.getPattern=function(t){var n=this.patterns[t],r=this.getImage(t);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{var i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},a=new e.ImagePosition(i,r);this.patterns[t]={bin:i,position:a}}return this._updatePatternAtlas(),this.patterns[t].position},n.prototype.bind=function(t){var n=t.gl;this.atlasTexture?this.dirty&&=(this.atlasTexture.update(this.atlasImage),!1):this.atlasTexture=new e.Texture(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var t=[];for(var n in this.patterns)t.push(this.patterns[n].bin);var r=e.potpack(t),i=r.w,a=r.h,o=this.atlasImage;for(var s in o.resize({width:i||1,height:a||1}),this.patterns){var c=this.patterns[s].bin,l=c.x+1,u=c.y+1,d=this.images[s].data,f=d.width,p=d.height;e.RGBAImage.copy(d,o,{x:0,y:0},{x:l,y:u},{width:f,height:p}),e.RGBAImage.copy(d,o,{x:0,y:p-1},{x:l,y:u-1},{width:f,height:1}),e.RGBAImage.copy(d,o,{x:0,y:0},{x:l,y:u+p},{width:f,height:1}),e.RGBAImage.copy(d,o,{x:f-1,y:0},{x:l-1,y:u},{width:1,height:p}),e.RGBAImage.copy(d,o,{x:0,y:0},{x:l+f,y:u},{width:1,height:p})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(e){for(var t=0,n=e;t<n.length;t+=1){var r=n[t];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var i=this.images[r];d(i)&&this.updateImage(r,i)}}},n}(e.Evented),p=g,m=g,h=0x56bc75e2d63100000;function g(e,t,n,r,i,a){this.fontSize=e||24,this.buffer=t===void 0?3:t,this.cutoff=r||.25,this.fontFamily=i||`sans-serif`,this.fontWeight=a||`normal`,this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement(`canvas`),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext(`2d`),this.ctx.font=this.fontWeight+` `+this.fontSize+`px `+this.fontFamily,this.ctx.textBaseline=`middle`,this.ctx.fillStyle=`black`,this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf(`Gecko/`)>=0?1.2:1))}function _(e,t,n,r,i,a,o){for(var s=0;s<t;s++){for(var c=0;c<n;c++)r[c]=e[c*t+s];for(v(r,i,a,o,n),c=0;c<n;c++)e[c*t+s]=i[c]}for(c=0;c<n;c++){for(s=0;s<t;s++)r[s]=e[c*t+s];for(v(r,i,a,o,t),s=0;s<t;s++)e[c*t+s]=Math.sqrt(i[s])}}function v(e,t,n,r,i){n[0]=0,r[0]=-h,r[1]=+h;for(var a=1,o=0;a<i;a++){for(var s=(e[a]+a*a-(e[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);s<=r[o];)o--,s=(e[a]+a*a-(e[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);n[++o]=a,r[o]=s,r[o+1]=+h}for(a=0,o=0;a<i;a++){for(;r[o+1]<a;)o++;t[a]=(a-n[o])*(a-n[o])+e[n[o]]}}g.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=t.data[4*r+3]/255;this.gridOuter[r]=i===1?0:i===0?h:Math.max(0,.5-i)**2,this.gridInner[r]=i===1?h:i===0?0:Math.max(0,i-.5)**2}for(_(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),_(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)n[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return n},p.default=m;var y=function(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}};y.prototype.setURL=function(e){this.url=e},y.prototype.getGlyphs=function(t,n){var r=this,i=[];for(var a in t)for(var o=0,s=t[a];o<s.length;o+=1)i.push({stack:a,id:s[o]});e.asyncAll(i,(function(e,t){var n=e.stack,i=e.id,a=r.entries[n];a||=r.entries[n]={glyphs:{},requests:{},ranges:{}};var o=a.glyphs[i];if(o===void 0){if(o=r._tinySDF(a,n,i))return a.glyphs[i]=o,void t(null,{stack:n,id:i,glyph:o});var s=Math.floor(i/256);if(256*s>65535)t(Error(`glyphs > 65535 not supported`));else if(a.ranges[s])t(null,{stack:n,id:i,glyph:o});else{var c=a.requests[s];c||(c=a.requests[s]=[],y.loadGlyphRange(n,s,r.url,r.requestManager,(function(e,t){if(t){for(var n in t)r._doesCharSupportLocalGlyph(+n)||(a.glyphs[+n]=t[+n]);a.ranges[s]=!0}for(var i=0,o=c;i<o.length;i+=1)(0,o[i])(e,t);delete a.requests[s]}))),c.push((function(e,r){e?t(e):r&&t(null,{stack:n,id:i,glyph:r[i]||null})}))}}else t(null,{stack:n,id:i,glyph:o})}),(function(e,t){if(e)n(e);else if(t){for(var r={},i=0,a=t;i<a.length;i+=1){var o=a[i],s=o.stack,c=o.id,l=o.glyph;(r[s]||(r[s]={}))[c]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}n(null,r)}}))},y.prototype._doesCharSupportLocalGlyph=function(t){return!!this.localIdeographFontFamily&&(e.isChar[`CJK Unified Ideographs`](t)||e.isChar[`Hangul Syllables`](t)||e.isChar.Hiragana(t)||e.isChar.Katakana(t))},y.prototype._tinySDF=function(t,n,r){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(r)){var a=t.tinySDF;if(!a){var o=`400`;/bold/i.test(n)?o=`900`:/medium/i.test(n)?o=`500`:/light/i.test(n)&&(o=`200`),a=t.tinySDF=new y.TinySDF(24,3,8,.25,i,o)}return{id:r,bitmap:new e.AlphaImage({width:30,height:30},a.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},y.loadGlyphRange=function(t,n,r,i,a){var o=256*n,s=o+255,c=i.transformRequest(i.normalizeGlyphsURL(r).replace(`{fontstack}`,t).replace(`{range}`,o+`-`+s),e.ResourceType.Glyphs);e.getArrayBuffer(c,(function(t,n){if(t)a(t);else if(n){for(var r={},i=0,o=e.parseGlyphPBF(n);i<o.length;i+=1){var s=o[i];r[s.id]=s}a(null,r)}}))},y.TinySDF=p;var b=function(){this.specification=e.styleSpec.light.position};b.prototype.possiblyEvaluate=function(t,n){return e.sphericalToCartesian(t.expression.evaluate(n))},b.prototype.interpolate=function(t,n,r){return{x:e.number(t.x,n.x,r),y:e.number(t.y,n.y,r),z:e.number(t.z,n.z,r)}};var x=new e.Properties({anchor:new e.DataConstantProperty(e.styleSpec.light.anchor),position:new b,color:new e.DataConstantProperty(e.styleSpec.light.color),intensity:new e.DataConstantProperty(e.styleSpec.light.intensity)}),S=function(t){function n(n){t.call(this),this._transitionable=new e.Transitionable(x),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(t,n){if(n===void 0&&(n={}),!this._validate(e.validateLight,t,n))for(var r in t){var i=t[r];e.endsWith(r,`-transition`)?this._transitionable.setTransition(r.slice(0,-11),i):this._transitionable.setValue(r,i)}},n.prototype.updateTransitions=function(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(e){this.properties=this._transitioning.possiblyEvaluate(e)},n.prototype._validate=function(t,n,r){return(!r||!1!==r.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.styleSpec})))},n}(e.Evented),C=function(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};C.prototype.getDash=function(e,t){var n=e.join(`,`)+String(t);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,t)),this.dashEntry[n]},C.prototype.getDashRanges=function(e,t,n){var r=[],i=e.length%2==1?-e[e.length-1]*n:0,a=e[0]*n,o=!0;r.push({left:i,right:a,isDash:o,zeroLength:e[0]===0});for(var s=e[0],c=1;c<e.length;c++){var l=e[c];r.push({left:i=s*n,right:a=(s+=l)*n,isDash:o=!o,zeroLength:l===0})}return r},C.prototype.addRoundDash=function(e,t,n){for(var r=t/2,i=-n;i<=n;i++)for(var a=this.width*(this.nextRow+n+i),o=0,s=e[o],c=0;c<this.width;c++){c/s.right>1&&(s=e[++o]);var l=Math.abs(c-s.left),u=Math.abs(c-s.right),d=Math.min(l,u),f=void 0,p=i/n*(r+1);if(s.isDash){var m=r-Math.abs(p);f=Math.sqrt(d*d+m*m)}else f=r-Math.sqrt(d*d+p*p);this.data[a+c]=Math.max(0,Math.min(255,f+128))}},C.prototype.addRegularDash=function(e){for(var t=e.length-1;t>=0;--t){var n=e[t],r=e[t+1];n.zeroLength?e.splice(t,1):r&&r.isDash===n.isDash&&(r.left=n.left,e.splice(t,1))}var i=e[0],a=e[e.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);for(var o=this.width*this.nextRow,s=0,c=e[s],l=0;l<this.width;l++){l/c.right>1&&(c=e[++s]);var u=Math.abs(l-c.left),d=Math.abs(l-c.right),f=Math.min(u,d);this.data[o+l]=Math.max(0,Math.min(255,(c.isDash?f:-f)+128))}},C.prototype.addDash=function(t,n){var r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return e.warnOnce(`LineAtlas out of space`),null;for(var a=0,o=0;o<t.length;o++)a+=t[o];if(a!==0){var s=this.width/a,c=this.getDashRanges(t,this.width,s);n?this.addRoundDash(c,s,r):this.addRegularDash(c)}var l={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:a};return this.nextRow+=i,this.dirty=!0,l},C.prototype.bind=function(e){var t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))};var w=function t(n,r){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=e.uniqueId();for(var i=this.workerPool.acquire(this.id),a=0;a<i.length;a++){var o=new t.Actor(i[a],r,this.id);o.name=`Worker `+a,this.actors.push(o)}};function E(t,n,r){var i=function(i,a){if(i)return r(i);if(a){var o=e.pick(e.extend(a,t),[`tiles`,`minzoom`,`maxzoom`,`attribution`,`mapbox_logo`,`bounds`,`scheme`,`tileSize`,`encoding`]);a.vector_layers&&(o.vectorLayers=a.vector_layers,o.vectorLayerIds=o.vectorLayers.map((function(e){return e.id}))),o.tiles=n.canonicalizeTileset(o,t.url),r(null,o)}};return t.url?e.getJSON(n.transformRequest(n.normalizeSourceURL(t.url),e.ResourceType.Source),i):e.browser.frame((function(){return i(null,t)}))}w.prototype.broadcast=function(t,n,r){e.asyncAll(this.actors,(function(e,r){e.send(t,n,r)}),r||=function(){})},w.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},w.prototype.remove=function(){this.actors.forEach((function(e){e.remove()})),this.actors=[],this.workerPool.release(this.id)},w.Actor=e.Actor;var D=function(t,n,r){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=r||24};D.prototype.validateBounds=function(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]},D.prototype.contains=function(t){var n=2**t.z,r=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*n),a=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*n),o=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=r&&t.x<a&&t.y>=i&&t.y<o};var O=function(t){function n(n,r,i,a){if(t.call(this),this.id=n,this.dispatcher=i,this.type=`vector`,this.minzoom=0,this.maxzoom=22,this.scheme=`xyz`,this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(r,[`url`,`scheme`,`tileSize`,`promoteId`])),this._options=e.extend({type:`vector`},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw Error(`vector tile sources must have a tileSize of 512`);this.setEventedParent(a)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){var t=this;this._loaded=!1,this.fire(new e.Event(`dataloading`,{dataType:`source`})),this._tileJSONRequest=E(this._options,this.map._requestManager,(function(n,r){t._tileJSONRequest=null,t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):r&&(e.extend(t,r),r.bounds&&(t.tileBounds=new D(r.bounds,t.minzoom,t.maxzoom)),e.postTurnstileEvent(r.tiles,t.map._requestManager._customAccessToken),e.postMapLoadEvent(r.tiles,t.map._getMapId(),t.map._requestManager._skuToken,t.map._requestManager._customAccessToken),t.fire(new e.Event(`data`,{dataType:`source`,sourceDataType:`metadata`})),t.fire(new e.Event(`data`,{dataType:`source`,sourceDataType:`content`})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},n.prototype.onAdd=function(e){this.map=e,this.load()},n.prototype.setSourceProperty=function(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},n.prototype.setTiles=function(e){var t=this;return this.setSourceProperty((function(){t._options.tiles=e})),this},n.prototype.setUrl=function(e){var t=this;return this.setSourceProperty((function(){t.url=e,t._options.url=e})),this},n.prototype.onRemove=function(){this._tileJSONRequest&&=(this._tileJSONRequest.cancel(),null)},n.prototype.serialize=function(){return e.extend({},this._options)},n.prototype.loadTile=function(t,n){var r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,e.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function a(r,i){return delete t.request,t.aborted?n(null):r&&r.status!==404?n(r):(i&&i.resourceTiming&&(t.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&t.setExpiryData(i),t.loadVectorData(i,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&=(this.loadTile(t,t.reloadCallback),null)))}i.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!==`expired`?t.state===`loading`?t.reloadCallback=n:t.request=t.actor.send(`reloadTile`,i,a.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send(`loadTile`,i,a.bind(this)))},n.prototype.abortTile=function(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send(`abortTile`,{uid:e.uid,type:this.type,source:this.id},void 0)},n.prototype.unloadTile=function(e){e.unloadVectorData(),e.actor&&e.actor.send(`removeTile`,{uid:e.uid,type:this.type,source:this.id},void 0)},n.prototype.hasTransition=function(){return!1},n}(e.Evented),k=function(t){function n(n,r,i,a){t.call(this),this.id=n,this.dispatcher=i,this.setEventedParent(a),this.type=`raster`,this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme=`xyz`,this.tileSize=512,this._loaded=!1,this._options=e.extend({type:`raster`},r),e.extend(this,e.pick(r,[`url`,`scheme`,`tileSize`]))}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){var t=this;this._loaded=!1,this.fire(new e.Event(`dataloading`,{dataType:`source`})),this._tileJSONRequest=E(this._options,this.map._requestManager,(function(n,r){t._tileJSONRequest=null,t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):r&&(e.extend(t,r),r.bounds&&(t.tileBounds=new D(r.bounds,t.minzoom,t.maxzoom)),e.postTurnstileEvent(r.tiles),e.postMapLoadEvent(r.tiles,t.map._getMapId(),t.map._requestManager._skuToken),t.fire(new e.Event(`data`,{dataType:`source`,sourceDataType:`metadata`})),t.fire(new e.Event(`data`,{dataType:`source`,sourceDataType:`content`})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.onAdd=function(e){this.map=e,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&=(this._tileJSONRequest.cancel(),null)},n.prototype.serialize=function(){return e.extend({},this._options)},n.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},n.prototype.loadTile=function(t,n){var r=this,i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(i,e.ResourceType.Tile),(function(i,a){if(delete t.request,t.aborted)t.state=`unloaded`,n(null);else if(i)t.state=`errored`,n(i);else if(a){r.map._refreshExpiredTiles&&t.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=r.map.painter.context,s=o.gl;t.texture=r.map.painter.getTileTexture(a.width),t.texture?t.texture.update(a,{useMipmap:!0}):(t.texture=new e.Texture(o,a,s.RGBA,{useMipmap:!0}),t.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),t.state=`loaded`,e.cacheEntryPossiblyAdded(r.dispatcher),n(null)}}))},n.prototype.abortTile=function(e,t){e.request&&(e.request.cancel(),delete e.request),t()},n.prototype.unloadTile=function(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()},n.prototype.hasTransition=function(){return!1},n}(e.Evented),A=function(t){function n(n,r,i,a){t.call(this,n,r,i,a),this.type=`raster-dem`,this.maxzoom=22,this._options=e.extend({type:`raster-dem`},r),this.encoding=r.encoding||`mapbox`}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.serialize=function(){return{type:`raster-dem`,url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(t,n){var r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function i(e,r){e&&(t.state=`errored`,n(e)),r&&(t.dem=r,t.needsHillshadePrepare=!0,t.state=`loaded`,n(null))}t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),function(r,a){if(delete t.request,t.aborted)t.state=`unloaded`,n(null);else if(r)t.state=`errored`,n(r);else if(a){this.map._refreshExpiredTiles&&t.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=e.window.ImageBitmap&&a instanceof e.window.ImageBitmap&&e.offscreenCanvasSupported()?a:e.browser.getImageData(a,1),s={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:o,encoding:this.encoding};t.actor&&t.state!==`expired`||(t.actor=this.dispatcher.getActor(),t.actor.send(`loadDEMTile`,s,i.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)},n.prototype._getNeighboringTiles=function(t){var n=t.canonical,r=2**n.z,i=(n.x-1+r)%r,a=n.x===0?t.wrap-1:t.wrap,o=(n.x+1+r)%r,s=n.x+1===r?t.wrap+1:t.wrap,c={};return c[new e.OverscaledTileID(t.overscaledZ,a,n.z,i,n.y).key]={backfilled:!1},c[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(c[new e.OverscaledTileID(t.overscaledZ,a,n.z,i,n.y-1).key]={backfilled:!1},c[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},c[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<r&&(c[new e.OverscaledTileID(t.overscaledZ,a,n.z,i,n.y+1).key]={backfilled:!1},c[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},c[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y+1).key]={backfilled:!1}),c},n.prototype.unloadTile=function(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state=`unloaded`,e.actor&&e.actor.send(`removeDEMTile`,{uid:e.uid,source:this.id})},n}(k),j=function(t){function n(n,r,i,a){t.call(this),this.id=n,this.type=`geojson`,this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(a),this._data=r.data,this._options=e.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;var o=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer===void 0?128:r.buffer)*o,tolerance:(r.tolerance===void 0?.375:r.tolerance)*o,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom===void 0?this.maxzoom-1:Math.min(r.clusterMaxZoom,this.maxzoom-1),minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.EXTENT,radius:(r.clusterRadius||50)*o,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){var t=this;this.fire(new e.Event(`dataloading`,{dataType:`source`})),this._updateWorkerData((function(n){if(n)t.fire(new e.ErrorEvent(n));else{var r={dataType:`source`,sourceDataType:`metadata`};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(r.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire(new e.Event(`data`,r))}}))},n.prototype.onAdd=function(e){this.map=e,this.load()},n.prototype.setData=function(t){var n=this;return this._data=t,this.fire(new e.Event(`dataloading`,{dataType:`source`})),this._updateWorkerData((function(t){if(t)n.fire(new e.ErrorEvent(t));else{var r={dataType:`source`,sourceDataType:`content`};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(r.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new e.Event(`data`,r))}})),this},n.prototype.getClusterExpansionZoom=function(e,t){return this.actor.send(`geojson.getClusterExpansionZoom`,{clusterId:e,source:this.id},t),this},n.prototype.getClusterChildren=function(e,t){return this.actor.send(`geojson.getClusterChildren`,{clusterId:e,source:this.id},t),this},n.prototype.getClusterLeaves=function(e,t,n,r){return this.actor.send(`geojson.getClusterLeaves`,{source:this.id,clusterId:e,limit:t,offset:n},r),this},n.prototype._updateWorkerData=function(t){var n=this;this._loaded=!1;var r=e.extend({},this.workerOptions),i=this._data;typeof i==`string`?(r.request=this.map._requestManager.transformRequest(e.browser.resolveURL(i),e.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this.actor.send(this.type+`.loadData`,r,(function(e,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.actor.send(n.type+`.coalesce`,{source:r.source},null),t(e))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.loadTile=function(t,n){var r=this,i=t.actor?`reloadTile`:`loadTile`;t.actor=this.actor,t.request=this.actor.send(i,{type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(e,a){return delete t.request,t.unloadVectorData(),t.aborted?n(null):e?n(e):(t.loadVectorData(a,r.map.painter,i===`reloadTile`),n(null))}))},n.prototype.abortTile=function(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0},n.prototype.unloadTile=function(e){e.unloadVectorData(),this.actor.send(`removeTile`,{uid:e.uid,type:this.type,source:this.id})},n.prototype.onRemove=function(){this._removed=!0,this.actor.send(`removeSource`,{type:this.type,source:this.id})},n.prototype.serialize=function(){return e.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(e.Evented),M=e.createLayout([{name:`a_pos`,type:`Int16`,components:2},{name:`a_texture_pos`,type:`Int16`,components:2}]),N=function(t){function n(e,n,r,i){t.call(this),this.id=e,this.dispatcher=r,this.coordinates=n.coordinates,this.type=`image`,this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=n}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(t,n){var r=this;this._loaded=!1,this.fire(new e.Event(`dataloading`,{dataType:`source`})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),(function(i,a){r._loaded=!0,i?r.fire(new e.ErrorEvent(i)):a&&(r.image=a,t&&(r.coordinates=t),n&&n(),r._finishLoading())}))},n.prototype.loaded=function(){return this._loaded},n.prototype.updateImage=function(e){var t=this;return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(function(){t.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event(`data`,{dataType:`source`,sourceDataType:`metadata`})))},n.prototype.onAdd=function(e){this.map=e,this.load()},n.prototype.setCoordinates=function(t){var n=this;this.coordinates=t;var r=t.map(e.MercatorCoordinate.fromLngLat);this.tileID=function(t){for(var n=1/0,r=1/0,i=-1/0,a=-1/0,o=0,s=t;o<s.length;o+=1){var c=s[o];n=Math.min(n,c.x),r=Math.min(r,c.y),i=Math.max(i,c.x),a=Math.max(a,c.y)}var l=Math.max(i-n,a-r),u=Math.max(0,Math.floor(-Math.log(l)/Math.LN2)),d=2**u;return new e.CanonicalTileID(u,Math.floor((n+i)/2*d),Math.floor((r+a)/2*d))}(r),this.minzoom=this.maxzoom=this.tileID.z;var i=r.map((function(e){return n.tileID.getTilePoint(e)._round()}));return this._boundsArray=new e.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,e.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,e.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,e.EXTENT,e.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.Event(`data`,{dataType:`source`,sourceDataType:`content`})),this},n.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var t=this.map.painter.context,n=t.gl;for(var r in this.boundsBuffer||=t.createVertexBuffer(this._boundsArray,M.members),this.boundsSegments||=e.SegmentVector.simpleSegment(0,0,4,2),this.texture||(this.texture=new e.Texture(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];i.state!==`loaded`&&(i.state=`loaded`,i.texture=this.texture)}}},n.prototype.loadTile=function(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state=`errored`,t(null))},n.prototype.serialize=function(){return{type:`image`,url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(e.Evented),P=function(t){function n(e,n,r,i){t.call(this,e,n,r,i),this.roundZoom=!0,this.type=`video`,this.options=n}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){var t=this;this._loaded=!1;var n=this.options;this.urls=[];for(var r=0,i=n.urls;r<i.length;r+=1)this.urls.push(this.map._requestManager.transformRequest(i[r],e.ResourceType.Source).url);e.getVideo(this.urls,(function(n,r){t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):r&&(t.video=r,t.video.loop=!0,t.video.setAttribute(`playsinline`,``),t.video.addEventListener(`playing`,(function(){t.map.triggerRepaint()})),t.map&&t.video.play(),t._finishLoading())}))},n.prototype.pause=function(){this.video&&this.video.pause()},n.prototype.play=function(){this.video&&this.video.play()},n.prototype.seek=function(t){if(this.video){var n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError(`sources.`+this.id,null,`Playback for this video can be set only between the `+n.start(0)+` and `+n.end(0)+`-second mark.`))):this.video.currentTime=t}},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var t=this.map.painter.context,n=t.gl;for(var r in this.boundsBuffer||=t.createVertexBuffer(this._boundsArray,M.members),this.boundsSegments||=e.SegmentVector.simpleSegment(0,0,4,2),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];i.state!==`loaded`&&(i.state=`loaded`,i.texture=this.texture)}}},n.prototype.serialize=function(){return{type:`video`,urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(N),F=function(t){function n(n,r,i,a){t.call(this,n,r,i,a),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((function(e){return!Array.isArray(e)||e.length!==2||e.some((function(e){return typeof e!=`number`}))}))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.`+n,null,`"coordinates" property must be an array of 4 longitude/latitude array pairs`))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.`+n,null,`missing required property "coordinates"`))),r.animate&&typeof r.animate!=`boolean`&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.`+n,null,`optional "animate" property must be a boolean value`))),r.canvas?typeof r.canvas==`string`||r.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.`+n,null,`"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance`))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.`+n,null,`missing required property "canvas"`))),this.options=r,this.animate=r.animate===void 0||r.animate}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.load=function(){this._loaded=!0,this.canvas||=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(Error(`Canvas dimensions cannot be less than or equal to zero.`))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&=(this.prepare(),!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var n=this.map.painter.context,r=n.gl;for(var i in this.boundsBuffer||=n.createVertexBuffer(this._boundsArray,M.members),this.boundsSegments||=e.SegmentVector.simpleSegment(0,0,4,2),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(n,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var a=this.tiles[i];a.state!==`loaded`&&(a.state=`loaded`,a.texture=this.texture)}}},n.prototype.serialize=function(){return{type:`canvas`,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var e=0,t=[this.canvas.width,this.canvas.height];e<t.length;e+=1){var n=t[e];if(isNaN(n)||n<=0)return!0}return!1},n}(N),I={vector:O,raster:k,"raster-dem":A,geojson:j,video:P,image:N,canvas:F};function ee(t,n){var r=e.identity([]);return e.translate(r,r,[1,1,0]),e.scale(r,r,[.5*t.width,.5*t.height,1]),e.multiply(r,r,t.calculatePosMatrix(n.toUnwrapped()))}function R(e,t,n,r,i,a){var o=function(e,t,n){if(e)for(var r=0,i=e;r<i.length;r+=1){var a=t[i[r]];if(a&&a.source===n&&a.type===`fill-extrusion`)return!0}else for(var o in t){var s=t[o];if(s.source===n&&s.type===`fill-extrusion`)return!0}return!1}(i&&i.layers,t,e.id),s=a.maxPitchScaleFactor(),c=e.tilesIn(r,s,o);c.sort(z);for(var l=[],u=0,d=c;u<d.length;u+=1){var f=d[u];l.push({wrappedTileID:f.tileID.wrapped().key,queryResults:f.tile.queryRenderedFeatures(t,n,e._state,f.queryGeometry,f.cameraQueryGeometry,f.scale,i,a,s,ee(e.transform,f.tileID))})}var p=function(e){for(var t={},n={},r=0,i=e;r<i.length;r+=1){var a=i[r],o=a.queryResults,s=a.wrappedTileID,c=n[s]=n[s]||{};for(var l in o)for(var u=o[l],d=c[l]=c[l]||{},f=t[l]=t[l]||[],p=0,m=u;p<m.length;p+=1){var h=m[p];d[h.featureIndex]||(d[h.featureIndex]=!0,f.push(h))}}return t}(l);for(var m in p)p[m].forEach((function(t){var n=t.feature,r=e.getFeatureState(n.layer[`source-layer`],n.id);n.source=n.layer.source,n.layer[`source-layer`]&&(n.sourceLayer=n.layer[`source-layer`]),n.state=r}));return p}function z(e,t){var n=e.tileID,r=t.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}var B=function(e,t){this.max=e,this.onRemove=t,this.reset()};B.prototype.reset=function(){for(var e in this.data)for(var t=0,n=this.data[e];t<n.length;t+=1){var r=n[t];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},B.prototype.add=function(e,t,n){var r=this,i=e.wrapped().key;this.data[i]===void 0&&(this.data[i]=[]);var a={value:t,timeout:void 0};if(n!==void 0&&(a.timeout=setTimeout((function(){r.remove(e,a)}),n)),this.data[i].push(a),this.order.push(i),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},B.prototype.has=function(e){return e.wrapped().key in this.data},B.prototype.getAndRemove=function(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null},B.prototype._getAndRemoveByKey=function(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value},B.prototype.getByKey=function(e){var t=this.data[e];return t?t[0].value:null},B.prototype.get=function(e){return this.has(e)?this.data[e.wrapped().key][0].value:null},B.prototype.remove=function(e,t){if(!this.has(e))return this;var n=e.wrapped().key,r=t===void 0?0:this.data[n].indexOf(t),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this},B.prototype.setMaxSize=function(e){for(this.max=e;this.order.length>this.max;){var t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this},B.prototype.filter=function(e){var t=[];for(var n in this.data)for(var r=0,i=this.data[n];r<i.length;r+=1){var a=i[r];e(a.value)||t.push(a)}for(var o=0,s=t;o<s.length;o+=1){var c=s[o];this.remove(c.value.tileID,c)}};var te=function(e,t,n){this.context=e;var r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=!!n,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer};te.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},te.prototype.updateData=function(e){var t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)},te.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ne={Int8:`BYTE`,Uint8:`UNSIGNED_BYTE`,Int16:`SHORT`,Uint16:`UNSIGNED_SHORT`,Int32:`INT`,Uint32:`UNSIGNED_INT`,Float32:`FLOAT`},re=function(e,t,n,r){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;var i=e.gl;this.buffer=i.createBuffer(),e.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer};re.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},re.prototype.updateData=function(e){var t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)},re.prototype.enableAttributes=function(e,t){for(var n=0;n<this.attributes.length;n++){var r=t.attributes[this.attributes[n].name];r!==void 0&&e.enableVertexAttribArray(r)}},re.prototype.setVertexAttribPointers=function(e,t,n){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],a=t.attributes[i.name];a!==void 0&&e.vertexAttribPointer(a,i.components,e[ne[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}},re.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var V=function(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};V.prototype.get=function(){return this.current},V.prototype.set=function(e){},V.prototype.getDefault=function(){return this.default},V.prototype.setDefault=function(){this.set(this.default)};var ie=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getDefault=function(){return e.Color.transparent},n.prototype.set=function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)},n}(V),ae=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 1},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)},t}(V),oe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 0},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)},t}(V),se=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return[!0,!0,!0,!0]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)},t}(V),ce=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!0},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)},t}(V),H=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 255},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)},t}(V),le=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},t.prototype.set=function(e){var t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)},t}(V),ue=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){var e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)},t}(V),de=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}},t}(V),U=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return[0,1]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)},t}(V),fe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}},t}(V),pe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.LESS},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)},t}(V),me=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}},t}(V),W=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){var e=this.gl;return[e.ONE,e.ZERO]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)},t}(V),he=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getDefault=function(){return e.Color.transparent},n.prototype.set=function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)},n}(V),ge=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.FUNC_ADD},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)},t}(V),_e=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}},t}(V),G=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.BACK},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)},t}(V),K=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.CCW},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)},t}(V),ve=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)},t}(V),ye=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return this.gl.TEXTURE0},t.prototype.set=function(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)},t}(V),be=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){var e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]},t.prototype.set=function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)},t}(V),xe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}},t}(V),Se=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}},t}(V),Ce=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}},t}(V),we=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}},t}(V),Te=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1},t}(V),Ee=function(e){function t(t){e.call(this,t),this.vao=t.extVertexArrayObject}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t.prototype.set=function(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)},t}(V),De=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return 4},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}},t}(V),Oe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}},t}(V),ke=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return!1},t.prototype.set=function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}},t}(V),Ae=function(e){function t(t,n){e.call(this,t),this.context=t,this.parent=n}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getDefault=function(){return null},t}(V),je=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.setDirty=function(){this.dirty=!0},t.prototype.set=function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}},t}(Ae),Me=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}},t}(Ae),Ne=function(e,t,n,r){this.context=e,this.width=t,this.height=n;var i=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new je(e,i),r&&(this.depthAttachment=new Me(e,i))};Ne.prototype.destroy=function(){var e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){var n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}e.deleteFramebuffer(this.framebuffer)};var Pe=function(e,t,n){this.func=e,this.mask=t,this.range=n};Pe.ReadOnly=!1,Pe.ReadWrite=!0,Pe.disabled=new Pe(519,Pe.ReadOnly,[0,1]);var Fe=function(e,t,n,r,i,a){this.test=e,this.ref=t,this.mask=n,this.fail=r,this.depthFail=i,this.pass=a};Fe.disabled=new Fe({func:519,mask:0},0,0,7680,7680,7680);var Ie=function(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n};Ie.disabled=new Ie(Ie.Replace=[1,0],e.Color.transparent,[!1,!1,!1,!1]),Ie.unblended=new Ie(Ie.Replace,e.Color.transparent,[!0,!0,!0,!0]),Ie.alphaBlended=new Ie([1,771],e.Color.transparent,[!0,!0,!0,!0]);var Le=function(e,t,n){this.enable=e,this.mode=t,this.frontFace=n};Le.disabled=new Le(!1,1029,2305),Le.backCCW=new Le(!0,1029,2305);var q=function(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension(`OES_vertex_array_object`),this.clearColor=new ie(this),this.clearDepth=new ae(this),this.clearStencil=new oe(this),this.colorMask=new se(this),this.depthMask=new ce(this),this.stencilMask=new H(this),this.stencilFunc=new le(this),this.stencilOp=new ue(this),this.stencilTest=new de(this),this.depthRange=new U(this),this.depthTest=new fe(this),this.depthFunc=new pe(this),this.blend=new me(this),this.blendFunc=new W(this),this.blendColor=new he(this),this.blendEquation=new ge(this),this.cullFace=new _e(this),this.cullFaceSide=new G(this),this.frontFace=new K(this),this.program=new ve(this),this.activeTexture=new ye(this),this.viewport=new be(this),this.bindFramebuffer=new xe(this),this.bindRenderbuffer=new Se(this),this.bindTexture=new Ce(this),this.bindVertexBuffer=new we(this),this.bindElementBuffer=new Te(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ee(this),this.pixelStoreUnpack=new De(this),this.pixelStoreUnpackPremultiplyAlpha=new Oe(this),this.pixelStoreUnpackFlipY=new ke(this),this.extTextureFilterAnisotropic=e.getExtension(`EXT_texture_filter_anisotropic`)||e.getExtension(`MOZ_EXT_texture_filter_anisotropic`)||e.getExtension(`WEBKIT_EXT_texture_filter_anisotropic`),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=e.getExtension(`OES_texture_half_float`),this.extTextureHalfFloat&&(e.getExtension(`OES_texture_half_float_linear`),this.extRenderToTextureHalfFloat=e.getExtension(`EXT_color_buffer_half_float`)),this.extTimerQuery=e.getExtension(`EXT_disjoint_timer_query`),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)};q.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},q.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},q.prototype.createIndexBuffer=function(e,t){return new te(this,e,t)},q.prototype.createVertexBuffer=function(e,t,n){return new re(this,e,t,n)},q.prototype.createRenderbuffer=function(e,t,n){var r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),i},q.prototype.createFramebuffer=function(e,t,n){return new Ne(this,e,t,n)},q.prototype.clear=function(e){var t=e.color,n=e.depth,r=this.gl,i=0;t&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),r.clear(i)},q.prototype.setCullFace=function(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))},q.prototype.setDepthMode=function(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)},q.prototype.setStencilMode=function(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)},q.prototype.setColorMode=function(t){e.deepEqual(t.blendFunction,Ie.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)},q.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Re=function(t){function n(n,r,i){var a=this;t.call(this),this.id=n,this.dispatcher=i,this.on(`data`,(function(e){e.dataType===`source`&&e.sourceDataType===`metadata`&&(a._sourceLoaded=!0),a._sourceLoaded&&!a._paused&&e.dataType===`source`&&e.sourceDataType===`content`&&(a.reload(),a.transform&&a.update(a.transform))})),this.on(`error`,(function(){a._sourceErrored=!0})),this._source=function(t,n,r,i){var a=new I[n.type](t,n,r,i);if(a.id!==t)throw Error(`Expected Source id to be `+t+` instead of `+a.id);return e.bindAll([`load`,`abort`,`unload`,`serialize`,`prepare`],a),a}(n,r,i,this),this._tiles={},this._cache=new B(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new e.SourceFeatureState}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.onAdd=function(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e)},n.prototype.onRemove=function(e){this._source&&this._source.onRemove&&this._source.onRemove(e)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var e in this._tiles){var t=this._tiles[e];if(t.state!==`loaded`&&t.state!==`errored`)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(e,t){return this._source.loadTile(e,t)},n.prototype._unloadTile=function(e){if(this._source.unloadTile)return this._source.unloadTile(e,(function(){}))},n.prototype._abortTile=function(e){if(this._source.abortTile)return this._source.abortTile(e,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(e){for(var t in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return e.values(this._tiles).map((function(e){return e.tileID})).sort(ze).map((function(e){return e.key}))},n.prototype.getRenderableIds=function(t){var n=this,r=[];for(var i in this._tiles)this._isIdRenderable(i,t)&&r.push(this._tiles[i]);return t?r.sort((function(t,r){var i=t.tileID,a=r.tileID,o=new e.Point(i.canonical.x,i.canonical.y)._rotate(n.transform.angle),s=new e.Point(a.canonical.x,a.canonical.y)._rotate(n.transform.angle);return i.overscaledZ-a.overscaledZ||s.y-o.y||s.x-o.x})).map((function(e){return e.tileID.key})):r.map((function(e){return e.tileID})).sort(ze).map((function(e){return e.key}))},n.prototype.hasRenderableParent=function(e){var t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)},n.prototype._isIdRenderable=function(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var e in this._cache.reset(),this._tiles)this._tiles[e].state!==`errored`&&this._reloadTile(e,`reloading`)},n.prototype._reloadTile=function(e,t){var n=this._tiles[e];n&&(n.state!==`loading`&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))},n.prototype._tileLoaded=function(t,n,r,i){if(i)return t.state=`errored`,void(i.status===404?this.update(this.transform):this._source.fire(new e.ErrorEvent(i,{tile:t})));t.timeAdded=e.browser.now(),r===`expired`&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type===`raster-dem`&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.Event(`data`,{dataType:`source`,tile:t,coord:t.tileID}))},n.prototype._backfillDEM=function(e){for(var t=this.getRenderableIds(),n=0;n<t.length;n++){var r=t[n];if(e.neighboringTiles&&e.neighboringTiles[r]){var i=this.getTileByID(r);a(e,i),a(i,e)}}function a(e,t){e.needsHillshadePrepare=!0;var n=t.tileID.canonical.x-e.tileID.canonical.x,r=t.tileID.canonical.y-e.tileID.canonical.y,i=2**e.tileID.canonical.z,a=t.tileID.key;n===0&&r===0||Math.abs(r)>1||(Math.abs(n)>1&&(Math.abs(n+i)===1?n+=i:Math.abs(n-i)===1&&(n-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,r),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}},n.prototype.getTile=function(e){return this.getTileByID(e.key)},n.prototype.getTileByID=function(e){return this._tiles[e]},n.prototype._retainLoadedChildren=function(e,t,n,r){for(var i in this._tiles){var a=this._tiles[i];if(!(r[i]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>n)){for(var o=a.tileID;a&&a.tileID.overscaledZ>t+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var c=o;c.overscaledZ>t;)if(e[(c=c.scaledTo(c.overscaledZ-1)).key]){r[o.key]=o;break}}}},n.prototype.findLoadedParent=function(e,t){if(e.key in this._loadedParentTiles){var n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(var r=e.overscaledZ-1;r>=t;r--){var i=e.scaledTo(r),a=this._getLoadedTile(i);if(a)return a}},n.prototype._getLoadedTile=function(e){var t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(e.wrapped().key)},n.prototype.updateCacheSize=function(e){var t=Math.ceil(e.width/this._source.tileSize)+1,n=Math.ceil(e.height/this._source.tileSize)+1,r=Math.floor(t*n*5),i=typeof this._maxTileCacheSize==`number`?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(i)},n.prototype.handleWrapJump=function(e){var t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){var n={};for(var r in this._tiles){var i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),n[i.tileID.key]=i}for(var a in this._tiles=n,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}},n.prototype.update=function(t){var r=this;if(this.transform=t,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(t){return new e.OverscaledTileID(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)})):(i=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(e){return r._source.hasTile(e)})))):i=[];var a=t.coveringZoomLevel(this._source),o=Math.max(a-n.maxOverzooming,this._source.minzoom),s=Math.max(a+n.maxUnderzooming,this._source.minzoom),c=this._updateRetainedTiles(i,a);if(Be(this._source.type)){for(var l={},u={},d=0,f=Object.keys(c);d<f.length;d+=1){var p=f[d],m=c[p],h=this._tiles[p];if(h&&!(h.fadeEndTime&&h.fadeEndTime<=e.browser.now())){var g=this.findLoadedParent(m,o);g&&(this._addTile(g.tileID),l[g.tileID.key]=g.tileID),u[p]=m}}for(var _ in this._retainLoadedChildren(u,a,s,c),l)c[_]||(this._coveredTiles[_]=!0,c[_]=l[_])}for(var v in c)this._tiles[v].clearFadeHold();for(var y=0,b=e.keysDifference(this._tiles,c);y<b.length;y+=1){var x=b[y],S=this._tiles[x];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(x)}this._updateLoadedParentTileCache()}},n.prototype.releaseSymbolFadeTiles=function(){for(var e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)},n.prototype._updateRetainedTiles=function(e,t){for(var r={},i={},a=Math.max(t-n.maxOverzooming,this._source.minzoom),o=Math.max(t+n.maxUnderzooming,this._source.minzoom),s={},c=0,l=e;c<l.length;c+=1){var u=l[c],d=this._addTile(u);r[u.key]=u,d.hasData()||t<this._source.maxzoom&&(s[u.key]=u)}this._retainLoadedChildren(s,t,o,r);for(var f=0,p=e;f<p.length;f+=1){var m=p[f],h=this._tiles[m.key];if(!h.hasData()){if(t+1>this._source.maxzoom){var g=m.children(this._source.maxzoom)[0],_=this.getTile(g);if(_&&_.hasData()){r[g.key]=g;continue}}else{var v=m.children(this._source.maxzoom);if(r[v[0].key]&&r[v[1].key]&&r[v[2].key]&&r[v[3].key])continue}for(var y=h.wasRequested(),b=m.overscaledZ-1;b>=a;--b){var x=m.scaledTo(b);if(i[x.key]||(i[x.key]=!0,!(h=this.getTile(x))&&y&&(h=this._addTile(x)),h&&(r[x.key]=x,y=h.wasRequested(),h.hasData())))break}}}return r},n.prototype._updateLoadedParentTileCache=function(){for(var e in this._loadedParentTiles={},this._tiles){for(var t=[],n=void 0,r=this._tiles[e].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}t.push(r.key);var i=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(i))break;r=i}for(var a=0,o=t;a<o.length;a+=1)this._loadedParentTiles[o[a]]=n}},n.prototype._addTile=function(t){var n=this._tiles[t.key];if(n)return n;(n=this._cache.getAndRemove(t))&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));var r=!!n;return r||(n=new e.Tile(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n?(n.uses++,this._tiles[t.key]=n,r||this._source.fire(new e.Event(`dataloading`,{tile:n,coord:n.tileID,dataType:`source`})),n):null},n.prototype._setTileReloadTimer=function(e,t){var n=this;e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);var r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout((function(){n._reloadTile(e,`expired`),delete n._timers[e]}),r))},n.prototype._removeTile=function(e){var t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!==`reloading`?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))},n.prototype.clearTiles=function(){for(var e in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(e);this._cache.reset()},n.prototype.tilesIn=function(t,n,r){var i=this,a=[],o=this.transform;if(!o)return a;for(var s=r?o.getCameraQueryGeometry(t):t,c=t.map((function(e){return o.pointCoordinate(e)})),l=s.map((function(e){return o.pointCoordinate(e)})),u=this.getIds(),d=1/0,f=1/0,p=-1/0,m=-1/0,h=0,g=l;h<g.length;h+=1){var _=g[h];d=Math.min(d,_.x),f=Math.min(f,_.y),p=Math.max(p,_.x),m=Math.max(m,_.y)}for(var v=function(t){var r=i._tiles[u[t]];if(!r.holdingForFade()){var s=r.tileID,h=2**(o.zoom-r.tileID.overscaledZ),g=n*r.queryPadding*e.EXTENT/r.tileSize/h,_=[s.getTilePoint(new e.MercatorCoordinate(d,f)),s.getTilePoint(new e.MercatorCoordinate(p,m))];if(_[0].x-g<e.EXTENT&&_[0].y-g<e.EXTENT&&_[1].x+g>=0&&_[1].y+g>=0){var v=c.map((function(e){return s.getTilePoint(e)})),y=l.map((function(e){return s.getTilePoint(e)}));a.push({tile:r,tileID:s,queryGeometry:v,cameraQueryGeometry:y,scale:h})}}},y=0;y<u.length;y++)v(y);return a},n.prototype.getVisibleCoordinates=function(e){for(var t=this,n=this.getRenderableIds(e).map((function(e){return t._tiles[e].tileID})),r=0,i=n;r<i.length;r+=1){var a=i[r];a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Be(this._source.type))for(var t in this._tiles){var n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=e.browser.now())return!0}return!1},n.prototype.setFeatureState=function(e,t,n){this._state.updateState(e||=`_geojsonTileLayer`,t,n)},n.prototype.removeFeatureState=function(e,t,n){this._state.removeFeatureState(e||=`_geojsonTileLayer`,t,n)},n.prototype.getFeatureState=function(e,t){return this._state.getState(e||=`_geojsonTileLayer`,t)},n.prototype.setDependencies=function(e,t,n){var r=this._tiles[e];r&&r.setDependencies(t,n)},n.prototype.reloadTilesForDependencies=function(e,t){for(var n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(n,`reloading`);this._cache.filter((function(n){return!n.hasDependency(e,t)}))},n}(e.Evented);function ze(e,t){var n=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Be(e){return e===`raster`||e===`image`||e===`video`}function Ve(){return new e.window.Worker(ra.workerUrl)}Re.maxOverzooming=10,Re.maxUnderzooming=3;var He=`mapboxgl_preloaded_worker_pool`,Ue=function(){this.active={}};Ue.prototype.acquire=function(e){if(!this.workers)for(this.workers=[];this.workers.length<Ue.workerCount;)this.workers.push(new Ve);return this.active[e]=!0,this.workers.slice()},Ue.prototype.release=function(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((function(e){e.terminate()})),this.workers=null)},Ue.prototype.isPreloaded=function(){return!!this.active[He]},Ue.prototype.numActive=function(){return Object.keys(this.active).length};var We,Ge=Math.floor(e.browser.hardwareConcurrency/2);function Ke(){return We||=new Ue,We}function qe(t,n){var r={};for(var i in t)i!==`ref`&&(r[i]=t[i]);return e.refProperties.forEach((function(e){e in n&&(r[e]=n[e])})),r}function Je(e){e=e.slice();for(var t=Object.create(null),n=0;n<e.length;n++)t[e[n].id]=e[n];for(var r=0;r<e.length;r++)`ref`in e[r]&&(e[r]=qe(e[r],t[e[r].ref]));return e}Ue.workerCount=Math.max(Math.min(Ge,6),1);var Ye={setStyle:`setStyle`,addLayer:`addLayer`,removeLayer:`removeLayer`,setPaintProperty:`setPaintProperty`,setLayoutProperty:`setLayoutProperty`,setFilter:`setFilter`,addSource:`addSource`,removeSource:`removeSource`,setGeoJSONSourceData:`setGeoJSONSourceData`,setLayerZoomRange:`setLayerZoomRange`,setLayerProperty:`setLayerProperty`,setCenter:`setCenter`,setZoom:`setZoom`,setBearing:`setBearing`,setPitch:`setPitch`,setSprite:`setSprite`,setGlyphs:`setGlyphs`,setTransition:`setTransition`,setLight:`setLight`};function Xe(e,t,n){n.push({command:Ye.addSource,args:[e,t[e]]})}function Ze(e,t,n){t.push({command:Ye.removeSource,args:[e]}),n[e]=!0}function Qe(e,t,n,r){Ze(e,n,r),Xe(e,t,n)}function $e(t,n,r){for(var i in t[r])if(t[r].hasOwnProperty(i)&&i!==`data`&&!e.deepEqual(t[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&i!==`data`&&!e.deepEqual(t[r][i],n[r][i]))return!1;return!0}function et(t,n,r,i,a,o){for(var s in n||={},t||={})t.hasOwnProperty(s)&&(e.deepEqual(t[s],n[s])||r.push({command:o,args:[i,s,n[s],a]}));for(s in n)n.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(e.deepEqual(t[s],n[s])||r.push({command:o,args:[i,s,n[s],a]}))}function tt(e){return e.id}function nt(e,t){return e[t.id]=t,e}var rt=function(e,t){this.reset(e,t)};rt.prototype.reset=function(e,t){this.points=e||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding},rt.prototype.lerp=function(t){if(this.points.length===1)return this.points[0];t=e.clamp(t,0,1);for(var n=1,r=this._distances[n],i=t*this.paddedLength+this.padding;r<i&&n<this._distances.length;)r=this._distances[++n];var a=n-1,o=this._distances[a],s=r-o,c=s>0?(i-o)/s:0;return this.points[a].mult(1-c).add(this.points[n].mult(c))};var it=function(e,t,n){var r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0};function at(t,n,r,i,a){var o=e.create();return n?(e.scale(o,o,[1/a,1/a,1]),r||e.rotateZ(o,o,i.angle)):e.multiply(o,i.labelPlaneMatrix,t),o}function ot(t,n,r,i,a){if(n){var o=e.clone(t);return e.scale(o,o,[a,a,1]),r||e.rotateZ(o,o,-i.angle),o}return i.glCoordMatrix}function st(t,n){var r=[t.x,t.y,0,1];vt(r,r,n);var i=r[3];return{point:new e.Point(r[0]/i,r[1]/i),signedDistanceFromCamera:i}}function ct(e,t){return .5+e/t*.5}function lt(e,t){var n=e[0]/e[3],r=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&r>=-t[1]&&r<=t[1]}function ut(t,n,r,i,a,o,s,c){var l=i?t.textSizeData:t.iconSizeData,u=e.evaluateSizeForZoom(l,r.transform.zoom),d=[256/r.width*2+1,256/r.height*2+1],f=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;f.clear();for(var p=t.lineVertexArray,m=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,h=r.transform.width/r.transform.height,g=!1,_=0;_<m.length;_++){var v=m.get(_);if(v.hidden||v.writingMode===e.WritingMode.vertical&&!g)_t(v.numGlyphs,f);else{g=!1;var y=[v.anchorX,v.anchorY,0,1];if(e.transformMat4(y,y,n),lt(y,d)){var b=ct(r.transform.cameraToCenterDistance,y[3]),x=e.evaluateSizeForFeature(l,u,v),S=s?x/b:x*b,C=new e.Point(v.anchorX,v.anchorY),w=st(C,a).point,E={},D=pt(v,S,!1,c,n,a,o,t.glyphOffsetArray,p,f,w,C,E,h);g=D.useVertical,(D.notEnoughRoom||g||D.needsFlipping&&pt(v,S,!0,c,n,a,o,t.glyphOffsetArray,p,f,w,C,E,h).notEnoughRoom)&&_t(v.numGlyphs,f)}else _t(v.numGlyphs,f)}}i?t.text.dynamicLayoutVertexBuffer.updateData(f):t.icon.dynamicLayoutVertexBuffer.updateData(f)}function dt(e,t,n,r,i,a,o,s,c,l,u){var d=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,p=s.lineStartIndex+s.lineLength,m=t.getoffsetX(s.glyphStartIndex),h=t.getoffsetX(d-1),g=ht(e*m,n,r,i,a,o,s.segment,f,p,c,l,u);if(!g)return null;var _=ht(e*h,n,r,i,a,o,s.segment,f,p,c,l,u);return _?{first:g,last:_}:null}function ft(t,n,r,i){return t===e.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(t===e.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function pt(t,n,r,i,a,o,s,c,l,u,d,f,p,m){var h,g=n/24,_=t.lineOffsetX*g,v=t.lineOffsetY*g;if(t.numGlyphs>1){var y=t.glyphStartIndex+t.numGlyphs,b=t.lineStartIndex,x=t.lineStartIndex+t.lineLength,S=dt(g,c,_,v,r,d,f,t,l,o,p);if(!S)return{notEnoughRoom:!0};var C=st(S.first.point,s).point,w=st(S.last.point,s).point;if(i&&!r){var E=ft(t.writingMode,C,w,m);if(E)return E}h=[S.first];for(var D=t.glyphStartIndex+1;D<y-1;D++)h.push(ht(g*c.getoffsetX(D),_,v,r,d,f,t.segment,b,x,l,o,p));h.push(S.last)}else{if(i&&!r){var O=st(f,a).point,k=t.lineStartIndex+t.segment+1,A=new e.Point(l.getx(k),l.gety(k)),j=st(A,a),M=j.signedDistanceFromCamera>0?j.point:mt(f,A,O,1,a),N=ft(t.writingMode,O,M,m);if(N)return N}var P=ht(g*c.getoffsetX(t.glyphStartIndex),_,v,r,d,f,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,l,o,p);if(!P)return{notEnoughRoom:!0};h=[P]}for(var F=0,I=h;F<I.length;F+=1){var ee=I[F];e.addDynamicAttributes(u,ee.point,ee.angle)}return{}}function mt(e,t,n,r,i){var a=st(e.add(e.sub(t)._unit()),i).point,o=n.sub(a);return n.add(o._mult(r/o.mag()))}function ht(t,n,r,i,a,o,s,c,l,u,d,f){var p=i?t-n:t+n,m=p>0?1:-1,h=0;i&&(m*=-1,h=Math.PI),m<0&&(h+=Math.PI);for(var g=m>0?c+s:c+s+1,_=a,v=a,y=0,b=0,x=Math.abs(p),S=[];y+b<=x;){if((g+=m)<c||g>=l)return null;if(v=_,S.push(_),(_=f[g])===void 0){var C=new e.Point(u.getx(g),u.gety(g)),w=st(C,d);if(w.signedDistanceFromCamera>0)_=f[g]=w.point;else{var E=g-m;_=mt(y===0?o:new e.Point(u.getx(E),u.gety(E)),C,v,x-y+1,d)}}y+=b,b=v.dist(_)}var D=(x-y)/b,O=_.sub(v),k=O.mult(D)._add(v);k._add(O._unit()._perp()._mult(r*m));var A=h+Math.atan2(_.y-v.y,_.x-v.x);return S.push(k),{point:k,angle:A,path:S}}it.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},it.prototype.insert=function(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},it.prototype.insertCircle=function(e,t,n,r){this._forEachCell(t-r,n-r,t+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(r)},it.prototype._insertBoxCell=function(e,t,n,r,i,a){this.boxCells[i].push(a)},it.prototype._insertCircleCell=function(e,t,n,r,i,a){this.circleCells[i].push(a)},it.prototype._query=function(e,t,n,r,i,a){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var o=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var c=0;c<this.circleKeys.length;c++){var l=this.circles[3*c],u=this.circles[3*c+1],d=this.circles[3*c+2];o.push({key:this.circleKeys[c],x1:l-d,y1:u-d,x2:l+d,y2:u+d})}return a?o.filter(a):o}return this._forEachCell(e,t,n,r,this._queryCell,o,{hitTest:i,seenUids:{box:{},circle:{}}},a),i?o.length>0:o},it.prototype._queryCircle=function(e,t,n,r,i){var a=e-n,o=e+n,s=t-n,c=t+n;if(o<0||a>this.width||c<0||s>this.height)return!r&&[];var l=[];return this._forEachCell(a,s,o,c,this._queryCellCircle,l,{hitTest:r,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},i),r?l.length>0:l},it.prototype.query=function(e,t,n,r,i){return this._query(e,t,n,r,!1,i)},it.prototype.hitTest=function(e,t,n,r,i){return this._query(e,t,n,r,!0,i)},it.prototype.hitTestCircle=function(e,t,n,r){return this._queryCircle(e,t,n,!0,r)},it.prototype._queryCell=function(e,t,n,r,i,a,o,s){var c=o.seenUids,l=this.boxCells[i];if(l!==null)for(var u=this.bboxes,d=0,f=l;d<f.length;d+=1){var p=f[d];if(!c.box[p]){c.box[p]=!0;var m=4*p;if(e<=u[m+2]&&t<=u[m+3]&&n>=u[m+0]&&r>=u[m+1]&&(!s||s(this.boxKeys[p]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[p],x1:u[m],y1:u[m+1],x2:u[m+2],y2:u[m+3]})}}}var h=this.circleCells[i];if(h!==null)for(var g=this.circles,_=0,v=h;_<v.length;_+=1){var y=v[_];if(!c.circle[y]){c.circle[y]=!0;var b=3*y;if(this._circleAndRectCollide(g[b],g[b+1],g[b+2],e,t,n,r)&&(!s||s(this.circleKeys[y]))){if(o.hitTest)return a.push(!0),!0;var x=g[b],S=g[b+1],C=g[b+2];a.push({key:this.circleKeys[y],x1:x-C,y1:S-C,x2:x+C,y2:S+C})}}}},it.prototype._queryCellCircle=function(e,t,n,r,i,a,o,s){var c=o.circle,l=o.seenUids,u=this.boxCells[i];if(u!==null)for(var d=this.bboxes,f=0,p=u;f<p.length;f+=1){var m=p[f];if(!l.box[m]){l.box[m]=!0;var h=4*m;if(this._circleAndRectCollide(c.x,c.y,c.radius,d[h+0],d[h+1],d[h+2],d[h+3])&&(!s||s(this.boxKeys[m])))return a.push(!0),!0}}var g=this.circleCells[i];if(g!==null)for(var _=this.circles,v=0,y=g;v<y.length;v+=1){var b=y[v];if(!l.circle[b]){l.circle[b]=!0;var x=3*b;if(this._circlesCollide(_[x],_[x+1],_[x+2],c.x,c.y,c.radius)&&(!s||s(this.circleKeys[b])))return a.push(!0),!0}}},it.prototype._forEachCell=function(e,t,n,r,i,a,o,s){for(var c=this._convertToXCellCoord(e),l=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),d=this._convertToYCellCoord(r),f=c;f<=u;f++)for(var p=l;p<=d;p++)if(i.call(this,e,t,n,r,this.xCellCount*p+f,a,o,s))return},it.prototype._convertToXCellCoord=function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))},it.prototype._convertToYCellCoord=function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))},it.prototype._circlesCollide=function(e,t,n,r,i,a){var o=r-e,s=i-t,c=n+a;return c*c>o*o+s*s},it.prototype._circleAndRectCollide=function(e,t,n,r,i,a,o){var s=(a-r)/2,c=Math.abs(e-(r+s));if(c>s+n)return!1;var l=(o-i)/2,u=Math.abs(t-(i+l));if(u>l+n)return!1;if(c<=s||u<=l)return!0;var d=c-s,f=u-l;return d*d+f*f<=n*n};var gt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function _t(e,t){for(var n=0;n<e;n++){var r=t.length;t.resize(r+4),t.float32.set(gt,3*r)}}function vt(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e[3]=n[3]*r+n[7]*i+n[15],e}var yt=function(e,t,n){t===void 0&&(t=new it(e.width+200,e.height+200,25)),n===void 0&&(n=new it(e.width+200,e.height+200,25)),this.transform=e,this.grid=t,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200};function bt(t,n,r){return n*(e.EXTENT/(t.tileSize*2**(r-t.tileID.overscaledZ)))}yt.prototype.placeCollisionBox=function(e,t,n,r,i){var a=this.projectAndGetPerspectiveRatio(r,e.anchorPointX,e.anchorPointY),o=n*a.perspectiveRatio,s=e.x1*o+a.point.x,c=e.y1*o+a.point.y,l=e.x2*o+a.point.x,u=e.y2*o+a.point.y;return!this.isInsideGrid(s,c,l,u)||!t&&this.grid.hitTest(s,c,l,u,i)?{box:[],offscreen:!1}:{box:[s,c,l,u],offscreen:this.isOffscreen(s,c,l,u)}},yt.prototype.placeCollisionCircles=function(t,n,r,i,a,o,s,c,l,u,d,f,p){var m=[],h=new e.Point(n.anchorX,n.anchorY),g=st(h,o),_=ct(this.transform.cameraToCenterDistance,g.signedDistanceFromCamera),v=(u?a/_:a*_)/e.ONE_EM,y=st(h,s).point,b=dt(v,i,n.lineOffsetX*v,n.lineOffsetY*v,!1,y,h,n,r,s,{}),x=!1,S=!1,C=!0;if(b){for(var w=.5*f*_+p,E=new e.Point(-100,-100),D=new e.Point(this.screenRightBoundary,this.screenBottomBoundary),O=new rt,k=b.first,A=b.last,j=[],M=k.path.length-1;M>=1;M--)j.push(k.path[M]);for(var N=1;N<A.path.length;N++)j.push(A.path[N]);var P=2.5*w;if(c){var F=j.map((function(e){return st(e,c)}));j=F.some((function(e){return e.signedDistanceFromCamera<=0}))?[]:F.map((function(e){return e.point}))}var I=[];if(j.length>0){for(var ee=j[0].clone(),R=j[0].clone(),z=1;z<j.length;z++)ee.x=Math.min(ee.x,j[z].x),ee.y=Math.min(ee.y,j[z].y),R.x=Math.max(R.x,j[z].x),R.y=Math.max(R.y,j[z].y);I=ee.x>=E.x&&R.x<=D.x&&ee.y>=E.y&&R.y<=D.y?[j]:R.x<E.x||ee.x>D.x||R.y<E.y||ee.y>D.y?[]:e.clipLine([j],E.x,E.y,D.x,D.y)}for(var B=0,te=I;B<te.length;B+=1){var ne;O.reset(te[B],.25*w),ne=O.length<=.5*w?1:Math.ceil(O.paddedLength/P)+1;for(var re=0;re<ne;re++){var V=re/Math.max(ne-1,1),ie=O.lerp(V),ae=ie.x+100,oe=ie.y+100;m.push(ae,oe,w,0);var se=ae-w,ce=oe-w,H=ae+w,le=oe+w;if(C&&=this.isOffscreen(se,ce,H,le),S||=this.isInsideGrid(se,ce,H,le),!t&&this.grid.hitTestCircle(ae,oe,w,d)&&(x=!0,!l))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!l&&x||!S?[]:m,offscreen:C,collisionDetected:x}},yt.prototype.queryRenderedSymbols=function(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var n=[],r=1/0,i=1/0,a=-1/0,o=-1/0,s=0,c=t;s<c.length;s+=1){var l=c[s],u=new e.Point(l.x+100,l.y+100);r=Math.min(r,u.x),i=Math.min(i,u.y),a=Math.max(a,u.x),o=Math.max(o,u.y),n.push(u)}for(var d={},f={},p=0,m=this.grid.query(r,i,a,o).concat(this.ignoredGrid.query(r,i,a,o));p<m.length;p+=1){var h=m[p],g=h.key;if(d[g.bucketInstanceId]===void 0&&(d[g.bucketInstanceId]={}),!d[g.bucketInstanceId][g.featureIndex]){var _=[new e.Point(h.x1,h.y1),new e.Point(h.x2,h.y1),new e.Point(h.x2,h.y2),new e.Point(h.x1,h.y2)];e.polygonIntersectsPolygon(n,_)&&(d[g.bucketInstanceId][g.featureIndex]=!0,f[g.bucketInstanceId]===void 0&&(f[g.bucketInstanceId]=[]),f[g.bucketInstanceId].push(g.featureIndex))}}return f},yt.prototype.insertCollisionBox=function(e,t,n,r,i){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},e[0],e[1],e[2],e[3])},yt.prototype.insertCollisionCircles=function(e,t,n,r,i){for(var a=t?this.ignoredGrid:this.grid,o={bucketInstanceId:n,featureIndex:r,collisionGroupID:i},s=0;s<e.length;s+=4)a.insertCircle(o,e[s],e[s+1],e[s+2])},yt.prototype.projectAndGetPerspectiveRatio=function(t,n,r){var i=[n,r,0,1];return vt(i,i,t),{point:new e.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},yt.prototype.isOffscreen=function(e,t,n,r){return n<100||e>=this.screenRightBoundary||r<100||t>this.screenBottomBoundary},yt.prototype.isInsideGrid=function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary},yt.prototype.getViewportMatrix=function(){var t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t};var xt=function(e,t,n,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&n?1:0,this.placed=n};xt.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var St=function(e,t,n,r,i){this.text=new xt(e?e.text:null,t,n,i),this.icon=new xt(e?e.icon:null,t,r,i)};St.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ct=function(e,t,n){this.text=e,this.icon=t,this.skipFade=n},wt=function(){this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]},Tt=function(e,t,n,r,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i},Et=function(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}};function Dt(t,n,r,i,a){var o=e.getAnchorAlignment(t),s=-(o.horizontalAlign-.5)*n,c=-(o.verticalAlign-.5)*r,l=e.evaluateVariableOffset(t,i);return new e.Point(s+l[0]*a,c+l[1]*a)}function Ot(t,n,r,i,a,o){var s=t.x1,c=t.x2,l=t.y1,u=t.y2,d=t.anchorPointX,f=t.anchorPointY,p=new e.Point(n,r);return i&&p._rotate(a?o:-o),{x1:s+p.x,y1:l+p.y,x2:c+p.x,y2:u+p.y,anchorPointX:d,anchorPointY:f}}Et.prototype.get=function(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){var t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:function(e){return e.collisionGroupID===t}}}return this.collisionGroups[e]};var kt=function(e,t,n,r){this.transform=e.clone(),this.collisionIndex=new yt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Et(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}};function At(e,t,n,r,i){e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0)}kt.prototype.getBucketParts=function(t,n,r,i){var a=r.getBucket(n),o=r.latestFeatureIndex;if(a&&o&&n.id===a.layerIds[0]){var s=r.collisionBoxArray,c=a.layers[0].layout,l=2**(this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/e.EXTENT,d=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),f=c.get(`text-pitch-alignment`)===`map`,p=c.get(`text-rotation-alignment`)===`map`,m=bt(r,1,this.transform.zoom),h=at(d,f,p,this.transform,m),g=null;if(f){var _=ot(d,f,p,this.transform,m);g=e.multiply([],this.transform.labelPlaneMatrix,_)}this.retainedQueryData[a.bucketInstanceId]=new Tt(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,r.tileID);var v={bucket:a,layout:c,posMatrix:d,textLabelPlaneMatrix:h,labelToScreenMatrix:g,scale:l,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(i)for(var y=0,b=a.sortKeyRanges;y<b.length;y+=1){var x=b[y];t.push({sortKey:x.sortKey,symbolInstanceStart:x.symbolInstanceStart,symbolInstanceEnd:x.symbolInstanceEnd,parameters:v})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:v})}},kt.prototype.attemptAnchorPlacement=function(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m){var h,g=[d.textOffset0,d.textOffset1],_=Dt(e,n,r,g,i),v=this.collisionIndex.placeCollisionBox(Ot(t,_.x,_.y,a,o,this.transform.angle),u,s,c,l.predicate);if(!m||this.collisionIndex.placeCollisionBox(Ot(m,_.x,_.y,a,o,this.transform.angle),u,s,c,l.predicate).box.length!==0)return v.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID].text&&(h=this.prevPlacement.variableOffsets[d.crossTileID].anchor),this.variableOffsets[d.crossTileID]={textOffset:g,width:n,height:r,anchor:e,textBoxScale:i,prevAnchor:h},this.markUsedJustification(f,e,d,p),f.allowVerticalPlacement&&(this.markUsedOrientation(f,p,d),this.placedOrientations[d.crossTileID]=p),{shift:_,placedGlyphBoxes:v}):void 0},kt.prototype.placeLayerBucketPart=function(t,n,r){var i=this,a=t.parameters,o=a.bucket,s=a.layout,c=a.posMatrix,l=a.textLabelPlaneMatrix,u=a.labelToScreenMatrix,d=a.textPixelRatio,f=a.holdingForFade,p=a.collisionBoxArray,m=a.partiallyEvaluatedTextSize,h=a.collisionGroup,g=s.get(`text-optional`),_=s.get(`icon-optional`),v=s.get(`text-allow-overlap`),y=s.get(`icon-allow-overlap`),b=s.get(`text-rotation-alignment`)===`map`,x=s.get(`text-pitch-alignment`)===`map`,S=s.get(`icon-text-fit`)!==`none`,C=s.get(`symbol-z-order`)===`viewport-y`,w=v&&(y||!o.hasIconData()||_),E=y&&(v||!o.hasTextData()||g);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p);var D=function(t,a){if(!n[t.crossTileID])if(f)i.placements[t.crossTileID]=new Ct(!1,!1,!1);else{var p,C=!1,D=!1,O=!0,k=null,A={box:null,offscreen:null},j={box:null,offscreen:null},M=null,N=null,P=0,F=0,I=0;a.textFeatureIndex?P=a.textFeatureIndex:t.useRuntimeCollisionCircles&&(P=t.featureIndex),a.verticalTextFeatureIndex&&(F=a.verticalTextFeatureIndex);var ee=a.textBox;if(ee){var R=function(n){var r=e.WritingMode.horizontal;if(o.allowVerticalPlacement&&!n&&i.prevPlacement){var a=i.prevPlacement.placedOrientations[t.crossTileID];a&&(i.placedOrientations[t.crossTileID]=a,i.markUsedOrientation(o,r=a,t))}return r},z=function(n,r){if(o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&a.verticalTextBox)for(var i=0,s=o.writingModes;i<s.length&&(s[i]===e.WritingMode.vertical?(A=r(),j=A):A=n(),!(A&&A.box&&A.box.length));i+=1);else A=n()};if(s.get(`text-variable-anchor`)){var B=s.get(`text-variable-anchor`);if(i.prevPlacement&&i.prevPlacement.variableOffsets[t.crossTileID]){var te=i.prevPlacement.variableOffsets[t.crossTileID];B.indexOf(te.anchor)>0&&(B=B.filter((function(e){return e!==te.anchor}))).unshift(te.anchor)}var ne=function(e,n,r){for(var a=e.x2-e.x1,s=e.y2-e.y1,l=t.textBoxScale,u=S&&!y?n:null,f={box:[],offscreen:!1},p=v?2*B.length:B.length,m=0;m<p;++m){var g=i.attemptAnchorPlacement(B[m%B.length],e,a,s,l,b,x,d,c,h,m>=B.length,t,o,r,u);if(g&&(f=g.placedGlyphBoxes)&&f.box&&f.box.length){C=!0,k=g.shift;break}}return f};z((function(){return ne(ee,a.iconBox,e.WritingMode.horizontal)}),(function(){var n=a.verticalTextBox;return o.allowVerticalPlacement&&!(A&&A.box&&A.box.length)&&t.numVerticalGlyphVertices>0&&n?ne(n,a.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null}})),A&&(C=A.box,O=A.offscreen);var re=R(A&&A.box);if(!C&&i.prevPlacement){var V=i.prevPlacement.variableOffsets[t.crossTileID];V&&(i.variableOffsets[t.crossTileID]=V,i.markUsedJustification(o,V.anchor,t,re))}}else{var ie=function(e,n){var r=i.collisionIndex.placeCollisionBox(e,v,d,c,h.predicate);return r&&r.box&&r.box.length&&(i.markUsedOrientation(o,n,t),i.placedOrientations[t.crossTileID]=n),r};z((function(){return ie(ee,e.WritingMode.horizontal)}),(function(){var n=a.verticalTextBox;return o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&n?ie(n,e.WritingMode.vertical):{box:null,offscreen:null}})),R(A&&A.box&&A.box.length)}}if(C=(p=A)&&p.box&&p.box.length>0,O=p&&p.offscreen,t.useRuntimeCollisionCircles){var ae=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),oe=e.evaluateSizeForFeature(o.textSizeData,m,ae),se=s.get(`text-padding`);M=i.collisionIndex.placeCollisionCircles(v,ae,o.lineVertexArray,o.glyphOffsetArray,oe,c,l,u,r,x,h.predicate,t.collisionCircleDiameter,se),C=v||M.circles.length>0&&!M.collisionDetected,O&&=M.offscreen}if(a.iconFeatureIndex&&(I=a.iconFeatureIndex),a.iconBox){var ce=function(e){var t=S&&k?Ot(e,k.x,k.y,b,x,i.transform.angle):e;return i.collisionIndex.placeCollisionBox(t,y,d,c,h.predicate)};D=j&&j.box&&j.box.length&&a.verticalIconBox?(N=ce(a.verticalIconBox)).box.length>0:(N=ce(a.iconBox)).box.length>0,O&&=N.offscreen}var H=g||t.numHorizontalGlyphVertices===0&&t.numVerticalGlyphVertices===0,le=_||t.numIconVertices===0;if(H||le?le?H||(D&&=C):C=D&&C:D=C=D&&C,C&&p&&p.box&&i.collisionIndex.insertCollisionBox(p.box,s.get(`text-ignore-placement`),o.bucketInstanceId,j&&j.box&&F?F:P,h.ID),D&&N&&i.collisionIndex.insertCollisionBox(N.box,s.get(`icon-ignore-placement`),o.bucketInstanceId,I,h.ID),M&&(C&&i.collisionIndex.insertCollisionCircles(M.circles,s.get(`text-ignore-placement`),o.bucketInstanceId,P,h.ID),r)){var ue=o.bucketInstanceId,de=i.collisionCircleArrays[ue];de===void 0&&(de=i.collisionCircleArrays[ue]=new wt);for(var U=0;U<M.circles.length;U+=4)de.circles.push(M.circles[U+0]),de.circles.push(M.circles[U+1]),de.circles.push(M.circles[U+2]),de.circles.push(M.collisionDetected?1:0)}i.placements[t.crossTileID]=new Ct(C||w,D||E,O||o.justReloaded),n[t.crossTileID]=!0}};if(C)for(var O=o.getSortedSymbolIndexes(this.transform.angle),k=O.length-1;k>=0;--k){var A=O[k];D(o.symbolInstances.get(A),o.collisionArrays[A])}else for(var j=t.symbolInstanceStart;j<t.symbolInstanceEnd;j++)D(o.symbolInstances.get(j),o.collisionArrays[j]);if(r&&o.bucketInstanceId in this.collisionCircleArrays){var M=this.collisionCircleArrays[o.bucketInstanceId];e.invert(M.invProjMatrix,c),M.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1},kt.prototype.markUsedJustification=function(t,n,r,i){for(var a=i===e.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(n)],o=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];o<s.length;o+=1){var c=s[o];c>=0&&(t.text.placedSymbolArray.get(c).crossTileID=a>=0&&c!==a?0:r.crossTileID)}},kt.prototype.markUsedOrientation=function(t,n,r){for(var i=n===e.WritingMode.horizontal||n===e.WritingMode.horizontalOnly?n:0,a=n===e.WritingMode.vertical?n:0,o=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];o<s.length;o+=1)t.text.placedSymbolArray.get(s[o]).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=a)},kt.prototype.commit=function(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;var t=this.prevPlacement,n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;var r=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(var s in this.placements){var c=this.placements[s],l=i[s];l?(this.opacities[s]=new St(l,r,c.text,c.icon),n=n||c.text!==l.text.placed||c.icon!==l.icon.placed):(this.opacities[s]=new St(null,r,c.text,c.icon,c.skipFade),n=n||c.text||c.icon)}for(var u in i){var d=i[u];if(!this.opacities[u]){var f=new St(d,r,!1,!1);f.isHidden()||(this.opacities[u]=f,n=n||d.text.placed||d.icon.placed)}}for(var p in a)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=a[p]);for(var m in o)this.placedOrientations[m]||!this.opacities[m]||this.opacities[m].isHidden()||(this.placedOrientations[m]=o[m]);n?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!=`number`&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)},kt.prototype.updateLayerOpacities=function(e,t){for(var n={},r=0,i=t;r<i.length;r+=1){var a=i[r],o=a.getBucket(e);o&&a.latestFeatureIndex&&e.id===o.layerIds[0]&&this.updateBucketOpacities(o,n,a.collisionBoxArray)}},kt.prototype.updateBucketOpacities=function(t,n,r){var i=this;t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();var a=t.layers[0].layout,o=new St(null,0,!1,!1,!0),s=a.get(`text-allow-overlap`),c=a.get(`icon-allow-overlap`),l=a.get(`text-variable-anchor`),u=a.get(`text-rotation-alignment`)===`map`,d=a.get(`text-pitch-alignment`)===`map`,f=a.get(`icon-text-fit`)!==`none`,p=new St(null,0,s&&(c||!t.hasIconData()||a.get(`icon-optional`)),c&&(s||!t.hasTextData()||a.get(`text-optional`)),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);for(var m=function(e,t,n){for(var r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(n)},h=function(r){var a=t.symbolInstances.get(r),s=a.numHorizontalGlyphVertices,c=a.numVerticalGlyphVertices,h=a.crossTileID,g=i.opacities[h];n[h]?g=o:g||(i.opacities[h]=g=p),n[h]=!0;var _=a.numIconVertices>0,v=i.placedOrientations[a.crossTileID],y=v===e.WritingMode.vertical,b=v===e.WritingMode.horizontal||v===e.WritingMode.horizontalOnly;if(s>0||c>0){var x=Rt(g.text);m(t.text,s,y?zt:x),m(t.text,c,b?zt:x);var S=g.text.isHidden();[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((function(e){e>=0&&(t.text.placedSymbolArray.get(e).hidden=S||y?1:0)})),a.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden=S||b?1:0);var C=i.variableOffsets[a.crossTileID];C&&i.markUsedJustification(t,C.anchor,a,v);var w=i.placedOrientations[a.crossTileID];w&&(i.markUsedJustification(t,`left`,a,w),i.markUsedOrientation(t,w,a))}if(_){var E=Rt(g.icon),D=!(f&&a.verticalPlacedIconSymbolIndex&&y);a.placedIconSymbolIndex>=0&&(m(t.icon,a.numIconVertices,D?E:zt),t.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden=g.icon.isHidden()),a.verticalPlacedIconSymbolIndex>=0&&(m(t.icon,a.numVerticalIconVertices,D?zt:E),t.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden=g.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){var O=t.collisionArrays[r];if(O){var k=new e.Point(0,0);if(O.textBox||O.verticalTextBox){var A=!0;if(l){var j=i.variableOffsets[h];j?(k=Dt(j.anchor,j.width,j.height,j.textOffset,j.textBoxScale),u&&k._rotate(d?i.transform.angle:-i.transform.angle)):A=!1}O.textBox&&At(t.textCollisionBox.collisionVertexArray,g.text.placed,!A||y,k.x,k.y),O.verticalTextBox&&At(t.textCollisionBox.collisionVertexArray,g.text.placed,!A||b,k.x,k.y)}var M=!!(!b&&O.verticalIconBox);O.iconBox&&At(t.iconCollisionBox.collisionVertexArray,g.icon.placed,M,f?k.x:0,f?k.y:0),O.verticalIconBox&&At(t.iconCollisionBox.collisionVertexArray,g.icon.placed,!M,f?k.x:0,f?k.y:0)}}},g=0;g<t.symbolInstances.length;g++)h(g);if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){var _=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=_.invProjMatrix,t.placementViewportMatrix=_.viewportMatrix,t.collisionCircleArray=_.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}},kt.prototype.symbolFadeChange=function(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},kt.prototype.zoomAdjustment=function(e){return Math.max(0,(this.transform.zoom-e)/1.5)},kt.prototype.hasTransitions=function(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration},kt.prototype.stillRecent=function(e,t){var n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e},kt.prototype.setStale=function(){this.stale=!0};var jt=2**25,Mt=2**24,Nt=2**17,Pt=2**16,Ft=2**9,It=2**8,Lt=2**1;function Rt(e){if(e.opacity===0&&!e.placed)return 0;if(e.opacity===1&&e.placed)return 4294967295;var t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*jt+t*Mt+n*Nt+t*Pt+n*Ft+t*It+n*Lt+t}var zt=0,Bt=function(e){this._sortAcrossTiles=e.layout.get(`symbol-z-order`)!==`viewport-y`&&e.layout.get(`symbol-sort-key`).constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Bt.prototype.continuePlacement=function(e,t,n,r,i){for(var a=this._bucketParts;this._currentTileIndex<e.length;)if(t.getBucketParts(a,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((function(e,t){return e.sortKey-t.sortKey})));this._currentPartIndex<a.length;)if(t.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1};var Vt=function(e,t,n,r,i,a,o){this.placement=new kt(e,i,a,o),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1};Vt.prototype.isDone=function(){return this._done},Vt.prototype.continuePlacement=function(t,n,r){for(var i=this,a=e.browser.now(),o=function(){var t=e.browser.now()-a;return!i._forceFullPlacement&&t>2};this._currentPlacementIndex>=0;){var s=n[t[this._currentPlacementIndex]],c=this.placement.collisionIndex.transform.zoom;if(s.type===`symbol`&&(!s.minzoom||s.minzoom<=c)&&(!s.maxzoom||s.maxzoom>c)){if(this._inProgressLayer||=new Bt(s),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Vt.prototype.commit=function(e){return this.placement.commit(e),this.placement};var Ht=512/e.EXTENT/2,Ut=function(e,t,n){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var r=0;r<t.length;r++){var i=t.get(r),a=i.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,e)})}};Ut.prototype.getScaledCoordinates=function(t,n){var r=Ht/2**(n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*e.EXTENT+t.anchorX)*r),y:Math.floor((n.canonical.y*e.EXTENT+t.anchorY)*r)}},Ut.prototype.findMatches=function(e,t,n){for(var r=this.tileID.canonical.z<t.canonical.z?1:2**(this.tileID.canonical.z-t.canonical.z),i=0;i<e.length;i++){var a=e.get(i);if(!a.crossTileID){var o=this.indexedSymbolInstances[a.key];if(o)for(var s=this.getScaledCoordinates(a,t),c=0,l=o;c<l.length;c+=1){var u=l[c];if(Math.abs(u.coord.x-s.x)<=r&&Math.abs(u.coord.y-s.y)<=r&&!n[u.crossTileID]){n[u.crossTileID]=!0,a.crossTileID=u.crossTileID;break}}}}};var Wt=function(){this.maxCrossTileID=0};Wt.prototype.generate=function(){return++this.maxCrossTileID};var Gt=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Gt.prototype.handleWrapJump=function(e){var t=Math.round((e-this.lng)/360);if(t!==0)for(var n in this.indexes){var r=this.indexes[n],i={};for(var a in r){var o=r[a];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+t),i[o.tileID.key]=o}this.indexes[n]=i}this.lng=e},Gt.prototype.addBucket=function(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(var r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});var i=this.usedCrossTileIDs[e.overscaledZ];for(var a in this.indexes){var o=this.indexes[a];if(Number(a)>e.overscaledZ)for(var s in o){var c=o[s];c.tileID.isChildOf(e)&&c.findMatches(t.symbolInstances,e,i)}else{var l=o[e.scaledTo(Number(a)).key];l&&l.findMatches(t.symbolInstances,e,i)}}for(var u=0;u<t.symbolInstances.length;u++){var d=t.symbolInstances.get(u);d.crossTileID||(d.crossTileID=n.generate(),i[d.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ut(e,t.symbolInstances,t.bucketInstanceId),!0},Gt.prototype.removeBucketCrossTileIDs=function(e,t){for(var n in t.indexedSymbolInstances)for(var r=0,i=t.indexedSymbolInstances[n];r<i.length;r+=1)delete this.usedCrossTileIDs[e][i[r].crossTileID]},Gt.prototype.removeStaleBuckets=function(e){var t=!1;for(var n in this.indexes){var r=this.indexes[n];for(var i in r)e[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],t=!0)}return t};var Kt=function(){this.layerIndexes={},this.crossTileIDs=new Wt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Kt.prototype.addLayer=function(e,t,n){var r=this.layerIndexes[e.id];r===void 0&&(r=this.layerIndexes[e.id]=new Gt);var i=!1,a={};r.handleWrapJump(n);for(var o=0,s=t;o<s.length;o+=1){var c=s[o],l=c.getBucket(e);l&&e.id===l.layerIds[0]&&(l.bucketInstanceId||=++this.maxBucketInstanceId,r.addBucket(c.tileID,l,this.crossTileIDs)&&(i=!0),a[l.bucketInstanceId]=!0)}return r.removeStaleBuckets(a)&&(i=!0),i},Kt.prototype.pruneUnusedLayers=function(e){var t={};for(var n in e.forEach((function(e){t[e]=!0})),this.layerIndexes)t[n]||delete this.layerIndexes[n]};var qt=function(t,n){return e.emitValidationErrors(t,n&&n.filter((function(e){return e.identifier!==`source.canvas`})))},Jt=e.pick(Ye,[`addLayer`,`removeLayer`,`setPaintProperty`,`setLayoutProperty`,`setFilter`,`addSource`,`removeSource`,`setLayerZoomRange`,`setLight`,`setTransition`,`setGeoJSONSourceData`]),Yt=e.pick(Ye,[`setCenter`,`setZoom`,`setBearing`,`setPitch`]),Xt=function(){var t={},n=e.styleSpec.$version;for(var r in e.styleSpec.$root){var i,a=e.styleSpec.$root[r];a.required&&(i=r===`version`?n:a.type===`array`?[]:{})!=null&&(t[r]=i)}return t}(),Zt=function(t){function n(r,i){var a=this;i===void 0&&(i={}),t.call(this),this.map=r,this.dispatcher=new w(Ke(),this),this.imageManager=new f,this.imageManager.setEventedParent(this),this.glyphManager=new y(r._requestManager,i.localIdeographFontFamily),this.lineAtlas=new C(256,512),this.crossTileSymbolIndex=new Kt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast(`setReferrer`,e.getReferrer());var o=this;this._rtlTextPluginCallback=n.registerForPluginStateChange((function(t){o.dispatcher.broadcast(`syncRTLPluginState`,{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(function(t,n){if(e.triggerPluginCompletionEvent(t),n&&n.every((function(e){return e})))for(var r in o.sourceCaches)o.sourceCaches[r].reload()}))})),this.on(`data`,(function(e){if(e.dataType===`source`&&e.sourceDataType===`metadata`){var t=a.sourceCaches[e.sourceId];if(t){var n=t.getSource();if(n&&n.vectorLayerIds)for(var r in a._layers){var i=a._layers[r];i.source===n.id&&a._validateLayer(i)}}}}))}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.loadURL=function(t,n){var r=this;n===void 0&&(n={}),this.fire(new e.Event(`dataloading`,{dataType:`style`}));var i=typeof n.validate==`boolean`?n.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,n.accessToken);var a=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(a,(function(t,n){r._request=null,t?r.fire(new e.ErrorEvent(t)):n&&r._load(n,i)}))},n.prototype.loadJSON=function(t,n){var r=this;n===void 0&&(n={}),this.fire(new e.Event(`dataloading`,{dataType:`style`})),this._request=e.browser.frame((function(){r._request=null,r._load(t,!1!==n.validate)}))},n.prototype.loadEmpty=function(){this.fire(new e.Event(`dataloading`,{dataType:`style`})),this._load(Xt,!1)},n.prototype._load=function(t,n){if(!n||!qt(this,e.validateStyle(t))){for(var r in this._loaded=!0,this.stylesheet=t,t.sources)this.addSource(r,t.sources[r],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);var i=Je(this.stylesheet.layers);this._order=i.map((function(e){return e.id})),this._layers={},this._serializedLayers={};for(var a=0,o=i;a<o.length;a+=1){var s=o[a];(s=e.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast(`setLayers`,this._serializeLayers(this._order)),this.light=new S(this.stylesheet.light),this.fire(new e.Event(`data`,{dataType:`style`})),this.fire(new e.Event(`style.load`))}},n.prototype._loadSprite=function(t){var n=this;this._spriteRequest=function(t,n,r){var i,a,o,s=e.browser.devicePixelRatio>1?`@2x`:``,c=e.getJSON(n.transformRequest(n.normalizeSpriteURL(t,s,`.json`),e.ResourceType.SpriteJSON),(function(e,t){c=null,o||(o=e,i=t,u())})),l=e.getImage(n.transformRequest(n.normalizeSpriteURL(t,s,`.png`),e.ResourceType.SpriteImage),(function(e,t){l=null,o||(o=e,a=t,u())}));function u(){if(o)r(o);else if(i&&a){var t=e.browser.getImageData(a),n={};for(var s in i){var c=i[s],l=c.width,u=c.height,d=c.x,f=c.y,p=c.sdf,m=c.pixelRatio,h=c.stretchX,g=c.stretchY,_=c.content,v=new e.RGBAImage({width:l,height:u});e.RGBAImage.copy(t,v,{x:d,y:f},{x:0,y:0},{width:l,height:u}),n[s]={data:v,pixelRatio:m,sdf:p,stretchX:h,stretchY:g,content:_}}r(null,n)}}return{cancel:function(){c&&=(c.cancel(),null),l&&=(l.cancel(),null)}}}(t,this.map._requestManager,(function(t,r){if(n._spriteRequest=null,t)n.fire(new e.ErrorEvent(t));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast(`setImages`,n._availableImages),n.fire(new e.Event(`data`,{dataType:`style`}))}))},n.prototype._validateLayer=function(t){var n=this.sourceCaches[t.source];if(n){var r=t.sourceLayer;if(r){var i=n.getSource();(i.type===`geojson`||i.vectorLayerIds&&i.vectorLayerIds.indexOf(r)===-1)&&this.fire(new e.ErrorEvent(Error(`Source layer "`+r+`" does not exist on source "`+i.id+`" as specified by style layer "`+t.id+`"`)))}}},n.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(e){for(var t=[],n=0,r=e;n<r.length;n+=1){var i=this._layers[r[n]];i.type!==`custom`&&t.push(i.serialize())}return t},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(var t in this._layers)if(this._layers[t].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw Error(`Style is not done loading`)},n.prototype.update=function(t){if(this._loaded){var n=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var a in(r.length||i.length)&&this._updateWorkerLayers(r,i),this._updatedSources){var o=this._updatedSources[a];o===`reload`?this._reloadSource(a):o===`clear`&&this._clearSource(a)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}var c={};for(var l in this.sourceCaches){var u=this.sourceCaches[l];c[l]=u.used,u.used=!1}for(var d=0,f=this._order;d<f.length;d+=1){var p=this._layers[f[d]];p.recalculate(t,this._availableImages),!p.isHidden(t.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(var m in c){var h=this.sourceCaches[m];c[m]!==h.used&&h.fire(new e.Event(`data`,{sourceDataType:`visibility`,dataType:`source`,sourceId:m}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new e.Event(`data`,{dataType:`style`}))}},n.prototype._updateTilesForChangedImages=function(){var e=Object.keys(this._changedImages);if(e.length){for(var t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies([`icons`,`patterns`],e);this._changedImages={}}},n.prototype._updateWorkerLayers=function(e,t){this.dispatcher.broadcast(`updateLayers`,{layers:this._serializeLayers(e),removedIds:t})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},n.prototype.setState=function(t){var n=this;if(this._checkLoaded(),qt(this,e.validateStyle(t)))return!1;(t=e.clone$1(t)).layers=Je(t.layers);var r=function(t,n){if(!t)return[{command:Ye.setStyle,args:[n]}];var r=[];try{if(!e.deepEqual(t.version,n.version))return[{command:Ye.setStyle,args:[n]}];e.deepEqual(t.center,n.center)||r.push({command:Ye.setCenter,args:[n.center]}),e.deepEqual(t.zoom,n.zoom)||r.push({command:Ye.setZoom,args:[n.zoom]}),e.deepEqual(t.bearing,n.bearing)||r.push({command:Ye.setBearing,args:[n.bearing]}),e.deepEqual(t.pitch,n.pitch)||r.push({command:Ye.setPitch,args:[n.pitch]}),e.deepEqual(t.sprite,n.sprite)||r.push({command:Ye.setSprite,args:[n.sprite]}),e.deepEqual(t.glyphs,n.glyphs)||r.push({command:Ye.setGlyphs,args:[n.glyphs]}),e.deepEqual(t.transition,n.transition)||r.push({command:Ye.setTransition,args:[n.transition]}),e.deepEqual(t.light,n.light)||r.push({command:Ye.setLight,args:[n.light]});var i={},a=[];(function(t,n,r,i){for(var a in n||={},t||={})t.hasOwnProperty(a)&&(n.hasOwnProperty(a)||Ze(a,r,i));for(a in n)n.hasOwnProperty(a)&&(t.hasOwnProperty(a)?e.deepEqual(t[a],n[a])||(t[a].type===`geojson`&&n[a].type===`geojson`&&$e(t,n,a)?r.push({command:Ye.setGeoJSONSourceData,args:[a,n[a].data]}):Qe(a,n,r,i)):Xe(a,n,r))})(t.sources,n.sources,a,i);var o=[];t.layers&&t.layers.forEach((function(e){i[e.source]?r.push({command:Ye.removeLayer,args:[e.id]}):o.push(e)})),r=r.concat(a),function(t,n,r){n||=[];var i,a,o,s,c,l,u,d=(t||=[]).map(tt),f=n.map(tt),p=t.reduce(nt,{}),m=n.reduce(nt,{}),h=d.slice(),g=Object.create(null);for(i=0,a=0;i<d.length;i++)m.hasOwnProperty(o=d[i])?a++:(r.push({command:Ye.removeLayer,args:[o]}),h.splice(h.indexOf(o,a),1));for(i=0,a=0;i<f.length;i++)h[h.length-1-i]!==(o=f[f.length-1-i])&&(p.hasOwnProperty(o)?(r.push({command:Ye.removeLayer,args:[o]}),h.splice(h.lastIndexOf(o,h.length-a),1)):a++,r.push({command:Ye.addLayer,args:[m[o],l=h[h.length-i]]}),h.splice(h.length-i,0,o),g[o]=!0);for(i=0;i<f.length;i++)if(s=p[o=f[i]],c=m[o],!g[o]&&!e.deepEqual(s,c))if(e.deepEqual(s.source,c.source)&&e.deepEqual(s[`source-layer`],c[`source-layer`])&&e.deepEqual(s.type,c.type)){for(u in et(s.layout,c.layout,r,o,null,Ye.setLayoutProperty),et(s.paint,c.paint,r,o,null,Ye.setPaintProperty),e.deepEqual(s.filter,c.filter)||r.push({command:Ye.setFilter,args:[o,c.filter]}),e.deepEqual(s.minzoom,c.minzoom)&&e.deepEqual(s.maxzoom,c.maxzoom)||r.push({command:Ye.setLayerZoomRange,args:[o,c.minzoom,c.maxzoom]}),s)s.hasOwnProperty(u)&&u!==`layout`&&u!==`paint`&&u!==`filter`&&u!==`metadata`&&u!==`minzoom`&&u!==`maxzoom`&&(u.indexOf(`paint.`)===0?et(s[u],c[u],r,o,u.slice(6),Ye.setPaintProperty):e.deepEqual(s[u],c[u])||r.push({command:Ye.setLayerProperty,args:[o,u,c[u]]}));for(u in c)c.hasOwnProperty(u)&&!s.hasOwnProperty(u)&&u!==`layout`&&u!==`paint`&&u!==`filter`&&u!==`metadata`&&u!==`minzoom`&&u!==`maxzoom`&&(u.indexOf(`paint.`)===0?et(s[u],c[u],r,o,u.slice(6),Ye.setPaintProperty):e.deepEqual(s[u],c[u])||r.push({command:Ye.setLayerProperty,args:[o,u,c[u]]}))}else r.push({command:Ye.removeLayer,args:[o]}),l=h[h.lastIndexOf(o)+1],r.push({command:Ye.addLayer,args:[c,l]})}(o,n.layers,r)}catch(e){console.warn(`Unable to compute style diff:`,e),r=[{command:Ye.setStyle,args:[n]}]}return r}(this.serialize(),t).filter((function(e){return!(e.command in Yt)}));if(r.length===0)return!1;var i=r.filter((function(e){return!(e.command in Jt)}));if(i.length>0)throw Error(`Unimplemented: `+i.map((function(e){return e.command})).join(`, `)+`.`);return r.forEach((function(e){e.command!==`setTransition`&&n[e.command].apply(n,e.args)})),this.stylesheet=t,!0},n.prototype.addImage=function(t,n){if(this.getImage(t))return this.fire(new e.ErrorEvent(Error(`An image with this name already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)},n.prototype.updateImage=function(e,t){this.imageManager.updateImage(e,t)},n.prototype.getImage=function(e){return this.imageManager.getImage(e)},n.prototype.removeImage=function(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(Error(`No image with this name exists.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)},n.prototype._afterImageUpdated=function(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast(`setImages`,this._availableImages),this.fire(new e.Event(`data`,{dataType:`style`}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(t,n,r){var i=this;if(r===void 0&&(r={}),this._checkLoaded(),this.sourceCaches[t]!==void 0)throw Error(`There is already a source with this ID`);if(!n.type)throw Error(`The type property must be defined, but only the following properties were given: `+Object.keys(n).join(`, `)+`.`);if(!([`vector`,`raster`,`geojson`,`video`,`image`].indexOf(n.type)>=0&&this._validate(e.validateStyle.source,`sources.`+t,n,null,r))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var a=this.sourceCaches[t]=new Re(t,n,this.dispatcher);a.style=this,a.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:a.serialize(),sourceId:t}})),a.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw Error(`There is no source with this ID`);for(var n in this._layers)if(this._layers[n].source===t)return this.fire(new e.ErrorEvent(Error(`Source "`+t+`" cannot be removed while layer "`+n+`" is using it.`)));var r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new e.Event(`data`,{sourceDataType:`metadata`,dataType:`source`,sourceId:t})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(e,t){this._checkLoaded(),this.sourceCaches[e].getSource().setData(t),this._changed=!0},n.prototype.getSource=function(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()},n.prototype.addLayer=function(t,n,r){r===void 0&&(r={}),this._checkLoaded();var i=t.id;if(this.getLayer(i))this.fire(new e.ErrorEvent(Error(`Layer with id "`+i+`" already exists on this map`)));else{var a;if(t.type===`custom`){if(qt(this,e.validateCustomStyleLayer(t)))return;a=e.createStyleLayer(t)}else{if(typeof t.source==`object`&&(this.addSource(i,t.source),t=e.clone$1(t),t=e.extend(t,{source:i})),this._validate(e.validateStyle.layer,`layers.`+i,t,{arrayIndex:-1},r))return;a=e.createStyleLayer(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[a.id]=a.serialize()}var o=n?this._order.indexOf(n):this._order.length;if(n&&o===-1)this.fire(new e.ErrorEvent(Error(`Layer with id "`+n+`" does not exist on this map.`)));else{if(this._order.splice(o,0,i),this._layerOrderChanged=!0,this._layers[i]=a,this._removedLayers[i]&&a.source&&a.type!==`custom`){var s=this._removedLayers[i];delete this._removedLayers[i],s.type===a.type?(this._updatedSources[a.source]=`reload`,this.sourceCaches[a.source].pause()):this._updatedSources[a.source]=`clear`}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}},n.prototype.moveLayer=function(t,n){if(this._checkLoaded(),this._changed=!0,this._layers[t]){if(t!==n){var r=this._order.indexOf(t);this._order.splice(r,1);var i=n?this._order.indexOf(n):this._order.length;n&&i===-1?this.fire(new e.ErrorEvent(Error(`Layer with id "`+n+`" does not exist on this map.`))):(this._order.splice(i,0,t),this._layerOrderChanged=!0)}}else this.fire(new e.ErrorEvent(Error(`The layer '`+t+`' does not exist in the map's style and cannot be moved.`)))},n.prototype.removeLayer=function(t){this._checkLoaded();var n=this._layers[t];if(n){n.setEventedParent(null);var r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}else this.fire(new e.ErrorEvent(Error(`The layer '`+t+`' does not exist in the map's style and cannot be removed.`)))},n.prototype.getLayer=function(e){return this._layers[e]},n.prototype.hasLayer=function(e){return e in this._layers},n.prototype.setLayerZoomRange=function(t,n,r){this._checkLoaded();var i=this.getLayer(t);i?i.minzoom===n&&i.maxzoom===r||(n!=null&&(i.minzoom=n),r!=null&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new e.ErrorEvent(Error(`The layer '`+t+`' does not exist in the map's style and cannot have zoom extent.`)))},n.prototype.setFilter=function(t,n,r){r===void 0&&(r={}),this._checkLoaded();var i=this.getLayer(t);if(i){if(!e.deepEqual(i.filter,n))return n==null?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(e.validateStyle.filter,`layers.`+i.id+`.filter`,n,null,r)||(i.filter=e.clone$1(n),this._updateLayer(i)))}else this.fire(new e.ErrorEvent(Error(`The layer '`+t+`' does not exist in the map's style and cannot be filtered.`)))},n.prototype.getFilter=function(t){return e.clone$1(this.getLayer(t).filter)},n.prototype.setLayoutProperty=function(t,n,r,i){i===void 0&&(i={}),this._checkLoaded();var a=this.getLayer(t);a?e.deepEqual(a.getLayoutProperty(n),r)||(a.setLayoutProperty(n,r,i),this._updateLayer(a)):this.fire(new e.ErrorEvent(Error(`The layer '`+t+`' does not exist in the map's style and cannot be styled.`)))},n.prototype.getLayoutProperty=function(t,n){var r=this.getLayer(t);if(r)return r.getLayoutProperty(n);this.fire(new e.ErrorEvent(Error(`The layer '`+t+`' does not exist in the map's style.`)))},n.prototype.setPaintProperty=function(t,n,r,i){i===void 0&&(i={}),this._checkLoaded();var a=this.getLayer(t);a?e.deepEqual(a.getPaintProperty(n),r)||(a.setPaintProperty(n,r,i)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.ErrorEvent(Error(`The layer '`+t+`' does not exist in the map's style and cannot be styled.`)))},n.prototype.getPaintProperty=function(e,t){return this.getLayer(e).getPaintProperty(t)},n.prototype.setFeatureState=function(t,n){this._checkLoaded();var r=t.source,i=t.sourceLayer,a=this.sourceCaches[r];if(a!==void 0){var o=a.getSource().type;o===`geojson`&&i?this.fire(new e.ErrorEvent(Error(`GeoJSON sources cannot have a sourceLayer parameter.`))):o!==`vector`||i?(t.id===void 0&&this.fire(new e.ErrorEvent(Error(`The feature id parameter must be provided.`))),a.setFeatureState(i,t.id,n)):this.fire(new e.ErrorEvent(Error(`The sourceLayer parameter must be provided for vector source types.`)))}else this.fire(new e.ErrorEvent(Error(`The source '`+r+`' does not exist in the map's style.`)))},n.prototype.removeFeatureState=function(t,n){this._checkLoaded();var r=t.source,i=this.sourceCaches[r];if(i!==void 0){var a=i.getSource().type,o=a===`vector`?t.sourceLayer:void 0;a!==`vector`||o?n&&typeof t.id!=`string`&&typeof t.id!=`number`?this.fire(new e.ErrorEvent(Error(`A feature id is required to remove its specific state property.`))):i.removeFeatureState(o,t.id,n):this.fire(new e.ErrorEvent(Error(`The sourceLayer parameter must be provided for vector source types.`)))}else this.fire(new e.ErrorEvent(Error(`The source '`+r+`' does not exist in the map's style.`)))},n.prototype.getFeatureState=function(t){this._checkLoaded();var n=t.source,r=t.sourceLayer,i=this.sourceCaches[n];if(i!==void 0){if(i.getSource().type!==`vector`||r)return t.id===void 0&&this.fire(new e.ErrorEvent(Error(`The feature id parameter must be provided.`))),i.getFeatureState(r,t.id);this.fire(new e.ErrorEvent(Error(`The sourceLayer parameter must be provided for vector source types.`)))}else this.fire(new e.ErrorEvent(Error(`The source '`+n+`' does not exist in the map's style.`)))},n.prototype.getTransition=function(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e.mapObject(this.sourceCaches,(function(e){return e.serialize()})),layers:this._serializeLayers(this._order)},(function(e){return e!==void 0}))},n.prototype._updateLayer=function(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!==`raster`&&(this._updatedSources[e.source]=`reload`,this.sourceCaches[e.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(e){for(var t=this,n=function(e){return t._layers[e].type===`fill-extrusion`},r={},i=[],a=this._order.length-1;a>=0;a--){var o=this._order[a];if(n(o)){r[o]=a;for(var s=0,c=e;s<c.length;s+=1){var l=c[s][o];if(l)for(var u=0,d=l;u<d.length;u+=1)i.push(d[u])}}}i.sort((function(e,t){return t.intersectionZ-e.intersectionZ}));for(var f=[],p=this._order.length-1;p>=0;p--){var m=this._order[p];if(n(m))for(var h=i.length-1;h>=0;h--){var g=i[h].feature;if(r[g.layer.id]<p)break;f.push(g),i.pop()}else for(var _=0,v=e;_<v.length;_+=1){var y=v[_][m];if(y)for(var b=0,x=y;b<x.length;b+=1)f.push(x[b].feature)}}return f},n.prototype.queryRenderedFeatures=function(t,n,r){n&&n.filter&&this._validate(e.validateStyle.filter,`queryRenderedFeatures.filter`,n.filter,null,n);var i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.ErrorEvent(Error(`parameters.layers must be an Array.`))),[];for(var a=0,o=n.layers;a<o.length;a+=1){var s=o[a],c=this._layers[s];if(!c)return this.fire(new e.ErrorEvent(Error(`The layer '`+s+`' does not exist in the map's style and cannot be queried for features.`))),[];i[c.source]=!0}}var l=[];for(var u in n.availableImages=this._availableImages,this.sourceCaches)n.layers&&!i[u]||l.push(R(this.sourceCaches[u],this._layers,this._serializedLayers,t,n,r));return this.placement&&l.push(function(e,t,n,r,i,a,o){for(var s={},c=a.queryRenderedSymbols(r),l=[],u=0,d=Object.keys(c).map(Number);u<d.length;u+=1)l.push(o[d[u]]);l.sort(z);for(var f=function(){var n=m[p],r=n.featureIndex.lookupSymbolFeatures(c[n.bucketInstanceId],t,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,e);for(var a in r){var o=s[a]=s[a]||[],l=r[a];l.sort((function(e,t){var r=n.featureSortOrder;if(r){var i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(var u=0,d=l;u<d.length;u+=1)o.push(d[u])}},p=0,m=l;p<m.length;p+=1)f();var h=function(t){s[t].forEach((function(r){var i=r.feature,a=n[e[t].source].getFeatureState(i.layer[`source-layer`],i.id);i.source=i.layer.source,i.layer[`source-layer`]&&(i.sourceLayer=i.layer[`source-layer`]),i.state=a}))};for(var g in s)h(g);return s}(this._layers,this._serializedLayers,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},n.prototype.querySourceFeatures=function(t,n){n&&n.filter&&this._validate(e.validateStyle.filter,`querySourceFeatures.filter`,n.filter,null,n);var r=this.sourceCaches[t];return r?function(e,t){for(var n=e.getRenderableIds().map((function(t){return e.getTileByID(t)})),r=[],i={},a=0;a<n.length;a++){var o=n[a],s=o.tileID.canonical.key;i[s]||(i[s]=!0,o.querySourceFeatures(r,t))}return r}(r,n):[]},n.prototype.addSourceType=function(e,t,r){return n.getSourceType(e)?r(Error(`A source type called "`+e+`" already exists.`)):(n.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast(`loadWorkerSource`,{name:e,url:t.workerSourceURL},r):r(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(t,n){n===void 0&&(n={}),this._checkLoaded();var r=this.light.getLight(),i=!1;for(var a in t)if(!e.deepEqual(t[a],r[a])){i=!0;break}if(i){var o={now:e.browser.now(),transition:e.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(o)}},n.prototype._validate=function(t,n,r,i,a){return a===void 0&&(a={}),(!a||!1!==a.validate)&&qt(this,t.call(e.validateStyle,e.extend({key:n,style:this.serialize(),value:r,styleSpec:e.styleSpec},i)))},n.prototype._remove=function(){for(var t in this._request&&=(this._request.cancel(),null),this._spriteRequest&&=(this._spriteRequest.cancel(),null),e.evented.off(`pluginStateChange`,this._rtlTextPluginCallback),this._layers)this._layers[t].setEventedParent(null);for(var n in this.sourceCaches)this.sourceCaches[n].clearTiles(),this.sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},n.prototype._clearSource=function(e){this.sourceCaches[e].clearTiles()},n.prototype._reloadSource=function(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()},n.prototype._updateSources=function(e){for(var t in this.sourceCaches)this.sourceCaches[t].update(e)},n.prototype._generateCollisionBoxes=function(){for(var e in this.sourceCaches)this._reloadSource(e)},n.prototype._updatePlacement=function(t,n,r,i,a){a===void 0&&(a=!1);for(var o=!1,s=!1,c={},l=0,u=this._order;l<u.length;l+=1){var d=this._layers[u[l]];if(d.type===`symbol`){if(!c[d.source]){var f=this.sourceCaches[d.source];c[d.source]=f.getRenderableIds(!0).map((function(e){return f.getTileByID(e)})).sort((function(e,t){return t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)}))}var p=this.crossTileSymbolIndex.addLayer(d,c[d.source],t.center.lng);o||=p}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((a=a||this._layerOrderChanged||r===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.browser.now(),t.zoom))&&(this.pauseablePlacement=new Vt(t,this._order,a,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.browser.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(var m=0,h=this._order;m<h.length;m+=1){var g=this._layers[h[m]];g.type===`symbol`&&this.placement.updateLayerOpacities(g,c[g.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()},n.prototype.getImages=function(e,t,n){this.imageManager.getImages(t.icons,n),this._updateTilesForChangedImages();var r=this.sourceCaches[t.source];r&&r.setDependencies(t.tileID.key,t.type,t.icons)},n.prototype.getGlyphs=function(e,t,n){this.glyphManager.getGlyphs(t.stacks,n)},n.prototype.getResource=function(t,n,r){return e.makeRequest(n,r)},n}(e.Evented);Zt.getSourceType=function(e){return I[e]},Zt.setSourceType=function(e,t){I[e]=t},Zt.registerForPluginStateChange=e.registerForPluginStateChange;var Qt=e.createLayout([{name:`a_pos`,type:`Int16`,components:2}]),$t=En(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),en=En(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}`),tn=En(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}`),nn=En(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),rn=En(`void main() {gl_FragColor=vec4(1.0);}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}`),an=En(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),on=En(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}`),sn=En(`varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}`,`attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),cn=En(`varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}`,`attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),ln=En(`uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}`,`attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}`),un=En(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),dn=En(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fn=En(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),pn=En(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),mn=En(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),hn=En(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),gn=En(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}`),_n=En(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}`),vn=En(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),yn=En(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),bn=En(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),xn=En(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Sn=En(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),Cn=En(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),wn=En(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Tn=En(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function En(e,t){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=t.match(/attribute ([\w]+) ([\w]+)/g),i=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=a?a.concat(i):i,s={};return{fragmentSource:e=e.replace(n,(function(e,t,n,r,i){return s[i]=!0,t===`define`?`
#ifndef HAS_UNIFORM_u_`+i+`
varying `+n+` `+r+` `+i+`;
#else
uniform `+n+` `+r+` u_`+i+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+i+`
    `+n+` `+r+` `+i+` = u_`+i+`;
#endif
`})),vertexSource:t=t.replace(n,(function(e,t,n,r,i){var a=r===`float`?`vec2`:`vec4`,o=i.match(/color/)?`color`:a;return s[i]?t===`define`?`
#ifndef HAS_UNIFORM_u_`+i+`
uniform lowp float u_`+i+`_t;
attribute `+n+` `+a+` a_`+i+`;
varying `+n+` `+r+` `+i+`;
#else
uniform `+n+` `+r+` u_`+i+`;
#endif
`:o===`vec4`?`
#ifndef HAS_UNIFORM_u_`+i+`
    `+i+` = a_`+i+`;
#else
    `+n+` `+r+` `+i+` = u_`+i+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+i+`
    `+i+` = unpack_mix_`+o+`(a_`+i+`, u_`+i+`_t);
#else
    `+n+` `+r+` `+i+` = u_`+i+`;
#endif
`:t===`define`?`
#ifndef HAS_UNIFORM_u_`+i+`
uniform lowp float u_`+i+`_t;
attribute `+n+` `+a+` a_`+i+`;
#else
uniform `+n+` `+r+` u_`+i+`;
#endif
`:o===`vec4`?`
#ifndef HAS_UNIFORM_u_`+i+`
    `+n+` `+r+` `+i+` = a_`+i+`;
#else
    `+n+` `+r+` `+i+` = u_`+i+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+i+`
    `+n+` `+r+` `+i+` = unpack_mix_`+o+`(a_`+i+`, u_`+i+`_t);
#else
    `+n+` `+r+` `+i+` = u_`+i+`;
#endif
`})),staticAttributes:r,staticUniforms:o}}var Dn=Object.freeze({__proto__:null,prelude:$t,background:en,backgroundPattern:tn,circle:nn,clippingMask:rn,heatmap:an,heatmapTexture:on,collisionBox:sn,collisionCircle:cn,debug:ln,fill:un,fillOutline:dn,fillOutlinePattern:fn,fillPattern:pn,fillExtrusion:mn,fillExtrusionPattern:hn,hillshadePrepare:gn,hillshade:_n,line:vn,lineGradient:yn,linePattern:bn,lineSDF:xn,raster:Sn,symbolIcon:Cn,symbolSDF:wn,symbolTextAndIcon:Tn}),On=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function kn(e){for(var t=[],n=0;n<e.length;n++)if(e[n]!==null){var r=e[n].split(` `);t.push(r.pop())}return t}On.prototype.bind=function(e,t,n,r,i,a,o,s){this.context=e;for(var c=this.boundPaintVertexBuffers.length!==r.length,l=0;!c&&l<r.length;l++)this.boundPaintVertexBuffers[l]!==r[l]&&(c=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===n&&!c&&this.boundIndexBuffer===i&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===s?(e.bindVertexArrayOES.set(this.vao),o&&o.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(t,n,r,i,a,o,s)},On.prototype.freshBind=function(e,t,n,r,i,a,o){var s,c=e.numAttributes,l=this.context,u=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=l.currentNumAttributes||0;for(var d=c;d<s;d++)u.disableVertexAttribArray(d)}t.enableAttributes(u,e);for(var f=0,p=n;f<p.length;f+=1)p[f].enableAttributes(u,e);a&&a.enableAttributes(u,e),o&&o.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i);for(var m=0,h=n;m<h.length;m+=1){var g=h[m];g.bind(),g.setVertexAttribPointers(u,e,i)}a&&(a.bind(),a.setVertexAttribPointers(u,e,i)),r&&r.bind(),o&&(o.bind(),o.setVertexAttribPointers(u,e,i)),l.currentNumAttributes=c},On.prototype.destroy=function(){this.vao&&=(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),null)};var An=function(e,t,n,r,i,a){var o=e.gl;this.program=o.createProgram();for(var s=kn(n.staticAttributes),c=r?r.getBinderAttributes():[],l=s.concat(c),u=n.staticUniforms?kn(n.staticUniforms):[],d=r?r.getBinderUniforms():[],f=[],p=0,m=u.concat(d);p<m.length;p+=1){var h=m[p];f.indexOf(h)<0&&f.push(h)}var g=r?r.defines():[];a&&g.push(`#define OVERDRAW_INSPECTOR;`);var _=g.concat($t.fragmentSource,n.fragmentSource).join(`
`),v=g.concat($t.vertexSource,n.vertexSource).join(`
`),y=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(y,_),o.compileShader(y),o.attachShader(this.program,y);var b=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(b,v),o.compileShader(b),o.attachShader(this.program,b),this.attributes={};var x={};this.numAttributes=l.length;for(var S=0;S<this.numAttributes;S++)l[S]&&(o.bindAttribLocation(this.program,S,l[S]),this.attributes[l[S]]=S);o.linkProgram(this.program),o.deleteShader(b),o.deleteShader(y);for(var C=0;C<f.length;C++){var w=f[C];if(w&&!x[w]){var E=o.getUniformLocation(this.program,w);E&&(x[w]=E)}}this.fixedUniforms=i(e,x),this.binderUniforms=r?r.getUniforms(e,x):[]}}};function jn(e,t,n){var r=1/bt(n,1,t.transform.tileZoom),i=2**n.tileID.overscaledZ,a=n.tileSize*2**t.transform.tileZoom/i,o=a*(n.tileID.canonical.x+n.tileID.wrap*i),s=a*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}An.prototype.draw=function(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){var g,_=e.gl;if(!this.failedToCreate){for(var v in e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(r),e.setColorMode(i),e.setCullFace(a),this.fixedUniforms)this.fixedUniforms[v].set(o[v]);p&&p.setUniforms(e,this.binderUniforms,d,{zoom:f});for(var y=(g={},g[_.LINES]=2,g[_.TRIANGLES]=3,g[_.LINE_STRIP]=1,g)[t],b=0,x=u.get();b<x.length;b+=1){var S=x[b],C=S.vaos||={};(C[s]||(C[s]=new On)).bind(e,this,c,p?p.getPaintVertexBuffers():[],l,S.vertexOffset,m,h),_.drawElements(t,S.primitiveLength*y,_.UNSIGNED_SHORT,S.primitiveOffset*y*2)}}};var Mn=function(t,n,r,i){var a=n.style.light,o=a.properties.get(`position`),s=[o.x,o.y,o.z],c=e.create$1();a.properties.get(`anchor`)===`viewport`&&e.fromRotation(c,-n.transform.angle),e.transformMat3(s,s,c);var l=a.properties.get(`color`);return{u_matrix:t,u_lightpos:s,u_lightintensity:a.properties.get(`intensity`),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+r,u_opacity:i}},Nn=function(t,n,r,i,a,o,s){return e.extend(Mn(t,n,r,i),jn(o,n,s),{u_height_factor:-(2**a.overscaledZ)/s.tileSize/8})},Pn=function(e){return{u_matrix:e}},Fn=function(t,n,r,i){return e.extend(Pn(t),jn(r,n,i))},In=function(e,t){return{u_matrix:e,u_world:t}},Ln=function(t,n,r,i,a){return e.extend(Fn(t,n,r,i),{u_world:a})},Rn=function(t,n,r,i){var a,o,s=t.transform;if(i.paint.get(`circle-pitch-alignment`)===`map`){var c=bt(r,1,s.zoom);a=!0,o=[c,c]}else a=!1,o=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+(i.paint.get(`circle-pitch-scale`)===`map`),u_matrix:t.translatePosMatrix(n.posMatrix,r,i.paint.get(`circle-translate`),i.paint.get(`circle-translate-anchor`)),u_pitch_with_map:+a,u_device_pixel_ratio:e.browser.devicePixelRatio,u_extrude_scale:o}},zn=function(e,t,n){var r=bt(n,1,t.zoom),i=2**(t.zoom-n.tileID.overscaledZ),a=n.tileID.overscaleFactor();return{u_matrix:e,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[t.pixelsToGLUnits[0]/(r*i),t.pixelsToGLUnits[1]/(r*i)],u_overscale_factor:a}},Bn=function(e,t,n){return{u_matrix:e,u_inv_matrix:t,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}},Vn=function(e,t,n){return n===void 0&&(n=1),{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}},Hn=function(e){return{u_matrix:e}},Un=function(e,t,n,r){return{u_matrix:e,u_extrude_scale:bt(t,1,n),u_intensity:r}},Wn=function(t,n,r){var i=t.transform;return{u_matrix:Yn(t,n,r),u_ratio:1/bt(n,1,i.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Gn=function(t,n,r,i){return e.extend(Wn(t,n,r),{u_image:0,u_image_height:i})},Kn=function(t,n,r,i){var a=t.transform,o=Jn(n,a);return{u_matrix:Yn(t,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:1/bt(n,1,a.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_image:0,u_scale:[o,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},qn=function(t,n,r,i,a){var o=t.lineAtlas,s=Jn(n,t.transform),c=r.layout.get(`line-cap`)===`round`,l=o.getDash(i.from,c),u=o.getDash(i.to,c),d=l.width*a.fromScale,f=u.width*a.toScale;return e.extend(Wn(t,n,r),{u_patternscale_a:[s/d,-l.height/2],u_patternscale_b:[s/f,-u.height/2],u_sdfgamma:o.width/(256*Math.min(d,f)*e.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:u.y,u_mix:a.t})};function Jn(e,t){return 1/bt(e,1,t.tileZoom)}function Yn(e,t,n){return e.translatePosMatrix(t.tileID.posMatrix,t,n.paint.get(`line-translate`),n.paint.get(`line-translate-anchor`))}var Xn=function(e,t,n,r,i){return{u_matrix:e,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get(`raster-opacity`),u_image0:0,u_image1:1,u_brightness_low:i.paint.get(`raster-brightness-min`),u_brightness_high:i.paint.get(`raster-brightness-max`),u_saturation_factor:(o=i.paint.get(`raster-saturation`),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=i.paint.get(`raster-contrast`),a>0?1/(1-a):1+a),u_spin_weights:Zn(i.paint.get(`raster-hue-rotate`))};var a,o};function Zn(e){e*=Math.PI/180;var t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}var Qn,$n=function(e,t,n,r,i,a,o,s,c,l){var u=i.transform;return{u_is_size_zoom_constant:+(e===`constant`||e===`source`),u_is_size_feature_constant:+(e===`constant`||e===`camera`),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:u.width/u.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+c,u_pitch_with_map:+r,u_texsize:l,u_texture:0}},er=function(t,n,r,i,a,o,s,c,l,u,d){var f=a.transform;return e.extend($n(t,n,r,i,a,o,s,c,l,u),{u_gamma_scale:i?Math.cos(f._pitch)*f.cameraToCenterDistance:1,u_device_pixel_ratio:e.browser.devicePixelRatio,u_is_halo:+d})},tr=function(t,n,r,i,a,o,s,c,l,u){return e.extend(er(t,n,r,i,a,o,s,c,!0,l,!0),{u_texsize_icon:u,u_texture_icon:1})},nr=function(e,t,n){return{u_matrix:e,u_opacity:t,u_color:n}},rr=function(t,n,r,i,a,o){return e.extend(function(e,t,n,r){var i=n.imageManager.getPattern(e.from.toString()),a=n.imageManager.getPattern(e.to.toString()),o=n.imageManager.getPixelSize(),s=o.width,c=o.height,l=2**r.tileID.overscaledZ,u=r.tileSize*2**n.transform.tileZoom/l,d=u*(r.tileID.canonical.x+r.tileID.wrap*l),f=u*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,c],u_mix:t.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/bt(r,1,n.transform.tileZoom),u_pixel_coord_upper:[d>>16,f>>16],u_pixel_coord_lower:[65535&d,65535&f]}}(i,o,r,a),{u_matrix:t,u_opacity:n})},ir={fillExtrusion:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_opacity:new e.Uniform1f(t,n.u_opacity)}},fillExtrusionPattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,n.u_height_factor),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade),u_opacity:new e.Uniform1f(t,n.u_opacity)}},fill:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},fillPattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}},fillOutline:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world)}},fillOutlinePattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}},circle:function(t,n){return{u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_scale_with_map:new e.Uniform1i(t,n.u_scale_with_map),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},collisionBox:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pixels_to_tile_units:new e.Uniform1f(t,n.u_pixels_to_tile_units),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale),u_overscale_factor:new e.Uniform1f(t,n.u_overscale_factor)}},collisionCircle:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,n.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,n.u_viewport_size)}},debug:function(t,n){return{u_color:new e.UniformColor(t,n.u_color),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_overlay:new e.Uniform1i(t,n.u_overlay),u_overlay_scale:new e.Uniform1f(t,n.u_overlay_scale)}},clippingMask:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},heatmap:function(t,n){return{u_extrude_scale:new e.Uniform1f(t,n.u_extrude_scale),u_intensity:new e.Uniform1f(t,n.u_intensity),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},heatmapTexture:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world),u_image:new e.Uniform1i(t,n.u_image),u_color_ramp:new e.Uniform1i(t,n.u_color_ramp),u_opacity:new e.Uniform1f(t,n.u_opacity)}},hillshade:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_latrange:new e.Uniform2f(t,n.u_latrange),u_light:new e.Uniform2f(t,n.u_light),u_shadow:new e.UniformColor(t,n.u_shadow),u_highlight:new e.UniformColor(t,n.u_highlight),u_accent:new e.UniformColor(t,n.u_accent)}},hillshadePrepare:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_dimension:new e.Uniform2f(t,n.u_dimension),u_zoom:new e.Uniform1f(t,n.u_zoom),u_unpack:new e.Uniform4f(t,n.u_unpack)}},line:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels)}},lineGradient:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_image:new e.Uniform1i(t,n.u_image),u_image_height:new e.Uniform1f(t,n.u_image_height)}},linePattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_texsize:new e.Uniform2f(t,n.u_texsize),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_image:new e.Uniform1i(t,n.u_image),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}},lineSDF:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_patternscale_a:new e.Uniform2f(t,n.u_patternscale_a),u_patternscale_b:new e.Uniform2f(t,n.u_patternscale_b),u_sdfgamma:new e.Uniform1f(t,n.u_sdfgamma),u_image:new e.Uniform1i(t,n.u_image),u_tex_y_a:new e.Uniform1f(t,n.u_tex_y_a),u_tex_y_b:new e.Uniform1f(t,n.u_tex_y_b),u_mix:new e.Uniform1f(t,n.u_mix)}},raster:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_tl_parent:new e.Uniform2f(t,n.u_tl_parent),u_scale_parent:new e.Uniform1f(t,n.u_scale_parent),u_buffer_scale:new e.Uniform1f(t,n.u_buffer_scale),u_fade_t:new e.Uniform1f(t,n.u_fade_t),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image0:new e.Uniform1i(t,n.u_image0),u_image1:new e.Uniform1i(t,n.u_image1),u_brightness_low:new e.Uniform1f(t,n.u_brightness_low),u_brightness_high:new e.Uniform1f(t,n.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,n.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,n.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,n.u_spin_weights)}},symbolIcon:function(t,n){return{u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture)}},symbolSDF:function(t,n){return{u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}},symbolTextAndIcon:function(t,n){return{u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texsize_icon:new e.Uniform2f(t,n.u_texsize_icon),u_texture:new e.Uniform1i(t,n.u_texture),u_texture_icon:new e.Uniform1i(t,n.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}},background:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_color:new e.UniformColor(t,n.u_color)}},backgroundPattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image:new e.Uniform1i(t,n.u_image),u_pattern_tl_a:new e.Uniform2f(t,n.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,n.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,n.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,n.u_pattern_br_b),u_texsize:new e.Uniform2f(t,n.u_texsize),u_mix:new e.Uniform1f(t,n.u_mix),u_pattern_size_a:new e.Uniform2f(t,n.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,n.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,n.u_scale_a),u_scale_b:new e.Uniform1f(t,n.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,n.u_tile_units_to_pixels)}}};function ar(t,n,r,i,a,o,s){for(var c=t.context,l=c.gl,u=t.useProgram(`collisionBox`),d=[],f=0,p=0,m=0;m<i.length;m++){var h=i[m],g=n.getTile(h),_=g.getBucket(r);if(_){var v=h.posMatrix;a[0]===0&&a[1]===0||(v=t.translatePosMatrix(h.posMatrix,g,a,o));var y=s?_.textCollisionBox:_.iconCollisionBox,b=_.collisionCircleArray;if(b.length>0){var x=e.create(),S=v;e.mul(x,_.placementInvProjMatrix,t.transform.glCoordMatrix),e.mul(x,x,_.placementViewportMatrix),d.push({circleArray:b,circleOffset:p,transform:S,invTransform:x}),p=f+=b.length/4}y&&u.draw(c,l.LINES,Pe.disabled,Fe.disabled,t.colorModeForRenderPass(),Le.disabled,zn(v,t.transform,g),r.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,null,t.transform.zoom,null,null,y.collisionVertexBuffer)}}if(s&&d.length){var C=t.useProgram(`collisionCircle`),w=new e.StructArrayLayout2f1f2i16;w.resize(4*f),w._trim();for(var E=0,D=0,O=d;D<O.length;D+=1)for(var k=O[D],A=0;A<k.circleArray.length/4;A++){var j=4*A,M=k.circleArray[j+0],N=k.circleArray[j+1],P=k.circleArray[j+2],F=k.circleArray[j+3];w.emplace(E++,M,N,P,F,0),w.emplace(E++,M,N,P,F,1),w.emplace(E++,M,N,P,F,2),w.emplace(E++,M,N,P,F,3)}(!Qn||Qn.length<2*f)&&(Qn=function(t){var n=2*t,r=new e.StructArrayLayout3ui6;r.resize(n),r._trim();for(var i=0;i<n;i++){var a=6*i;r.uint16[a+0]=4*i+0,r.uint16[a+1]=4*i+1,r.uint16[a+2]=4*i+2,r.uint16[a+3]=4*i+2,r.uint16[a+4]=4*i+3,r.uint16[a+5]=4*i+0}return r}(f));for(var I=c.createIndexBuffer(Qn,!0),ee=c.createVertexBuffer(w,e.collisionCircleLayout.members,!0),R=0,z=d;R<z.length;R+=1){var B=z[R],te=Bn(B.transform,B.invTransform,t.transform);C.draw(c,l.TRIANGLES,Pe.disabled,Fe.disabled,t.colorModeForRenderPass(),Le.disabled,te,r.id,ee,I,e.SegmentVector.simpleSegment(0,2*B.circleOffset,B.circleArray.length,B.circleArray.length/2),null,t.transform.zoom,null,null,null)}ee.destroy(),I.destroy()}}var or=e.identity(new Float32Array(16));function sr(t,n,r,i,a,o){var s=e.getAnchorAlignment(t),c=-(s.horizontalAlign-.5)*n,l=-(s.verticalAlign-.5)*r,u=e.evaluateVariableOffset(t,i);return new e.Point((c/a+u[0])*o,(l/a+u[1])*o)}function cr(t,n,r,i,a,o,s,c,l,u,d){var f=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,h={};p.clear();for(var g=0;g<f.length;g++){var _=f.get(g),v=_.hidden||!_.crossTileID||t.allowVerticalPlacement&&!_.placedOrientation?null:i[_.crossTileID];if(v){var y=new e.Point(_.anchorX,_.anchorY),b=st(y,r?c:s),x=ct(o.cameraToCenterDistance,b.signedDistanceFromCamera),S=a.evaluateSizeForFeature(t.textSizeData,u,_)*x/e.ONE_EM;r&&(S*=t.tilePixelRatio/l);for(var C=sr(v.anchor,v.width,v.height,v.textOffset,v.textBoxScale,S),w=r?st(y.add(C),s).point:b.point.add(n?C.rotate(-o.angle):C),E=t.allowVerticalPlacement&&_.placedOrientation===e.WritingMode.vertical?Math.PI/2:0,D=0;D<_.numGlyphs;D++)e.addDynamicAttributes(p,w,E);d&&_.associatedIconIndex>=0&&(h[_.associatedIconIndex]={shiftedAnchor:w,angle:E})}else _t(_.numGlyphs,p)}if(d){m.clear();for(var O=t.icon.placedSymbolArray,k=0;k<O.length;k++){var A=O.get(k);if(A.hidden)_t(A.numGlyphs,m);else{var j=h[k];if(j)for(var M=0;M<A.numGlyphs;M++)e.addDynamicAttributes(m,j.shiftedAnchor,j.angle);else _t(A.numGlyphs,m)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function lr(e,t,n){return n.iconsInText&&t?`symbolTextAndIcon`:e?`symbolSDF`:`symbolIcon`}function ur(t,n,r,i,a,o,s,c,l,u,d,f){for(var p=t.context,m=p.gl,h=t.transform,g=c===`map`,_=l===`map`,v=g&&r.layout.get(`symbol-placement`)!==`point`,y=g&&!_&&!v,b=r.layout.get(`symbol-sort-key`).constantOr(1)!==void 0,x=!1,S=t.depthModeForSublayer(0,Pe.ReadOnly),C=r.layout.get(`text-variable-anchor`),w=[],E=0,D=i;E<D.length;E+=1){var O=D[E],k=n.getTile(O),A=k.getBucket(r);if(A){var j=a?A.text:A.icon;if(j&&j.segments.get().length){var M=j.programConfigurations.get(r.id),N=a||A.sdfIcons,P=a?A.textSizeData:A.iconSizeData,F=_||h.pitch!==0,I=t.useProgram(lr(N,a,A),M),ee=e.evaluateSizeForZoom(P,h.zoom),R=void 0,z=[0,0],B=void 0,te=void 0,ne=null,re=void 0;if(a)B=k.glyphAtlasTexture,te=m.LINEAR,R=k.glyphAtlasTexture.size,A.iconsInText&&(z=k.imageAtlasTexture.size,ne=k.imageAtlasTexture,re=F||t.options.rotating||t.options.zooming||P.kind===`composite`||P.kind===`camera`?m.LINEAR:m.NEAREST);else{var V=r.layout.get(`icon-size`).constantOr(0)!==1||A.iconsNeedLinear;B=k.imageAtlasTexture,te=N||t.options.rotating||t.options.zooming||V||F?m.LINEAR:m.NEAREST,R=k.imageAtlasTexture.size}var ie=bt(k,1,t.transform.zoom),ae=at(O.posMatrix,_,g,t.transform,ie),oe=ot(O.posMatrix,_,g,t.transform,ie),se=C&&A.hasTextData(),ce=r.layout.get(`icon-text-fit`)!==`none`&&se&&A.hasIconData();v&&ut(A,O.posMatrix,t,a,ae,oe,_,u);var H=t.translatePosMatrix(O.posMatrix,k,o,s),le=v||a&&C||ce?or:ae,ue=t.translatePosMatrix(oe,k,o,s,!0),de=N&&r.paint.get(a?`text-halo-width`:`icon-halo-width`).constantOr(1)!==0,U={program:I,buffers:j,uniformValues:N?A.iconsInText?tr(P.kind,ee,y,_,t,H,le,ue,R,z):er(P.kind,ee,y,_,t,H,le,ue,a,R,!0):$n(P.kind,ee,y,_,t,H,le,ue,a,R),atlasTexture:B,atlasTextureIcon:ne,atlasInterpolation:te,atlasInterpolationIcon:re,isSDF:N,hasHalo:de};if(b&&A.canOverlap){x=!0;for(var fe=0,pe=j.segments.get();fe<pe.length;fe+=1){var me=pe[fe];w.push({segments:new e.SegmentVector([me]),sortKey:me.sortKey,state:U})}}else w.push({segments:j.segments,sortKey:0,state:U})}}}x&&w.sort((function(e,t){return e.sortKey-t.sortKey}));for(var W=0,he=w;W<he.length;W+=1){var ge=he[W],_e=ge.state;if(p.activeTexture.set(m.TEXTURE0),_e.atlasTexture.bind(_e.atlasInterpolation,m.CLAMP_TO_EDGE),_e.atlasTextureIcon&&(p.activeTexture.set(m.TEXTURE1),_e.atlasTextureIcon&&_e.atlasTextureIcon.bind(_e.atlasInterpolationIcon,m.CLAMP_TO_EDGE)),_e.isSDF){var G=_e.uniformValues;_e.hasHalo&&(G.u_is_halo=1,dr(_e.buffers,ge.segments,r,t,_e.program,S,d,f,G)),G.u_is_halo=0}dr(_e.buffers,ge.segments,r,t,_e.program,S,d,f,_e.uniformValues)}}function dr(e,t,n,r,i,a,o,s,c){var l=r.context;i.draw(l,l.gl.TRIANGLES,a,o,s,Le.disabled,c,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function fr(e,t,n,r,i,a,o){var s,c,l,u,d,f=e.context.gl,p=n.paint.get(`fill-pattern`),m=p&&p.constantOr(1),h=n.getCrossfadeParameters();o?(c=m&&!n.getPaintProperty(`fill-outline-color`)?`fillOutlinePattern`:`fillOutline`,s=f.LINES):(c=m?`fillPattern`:`fill`,s=f.TRIANGLES);for(var g=0,_=r;g<_.length;g+=1){var v=_[g],y=t.getTile(v);if(!m||y.patternsLoaded()){var b=y.getBucket(n);if(b){var x=b.programConfigurations.get(n.id),S=e.useProgram(c,x);m&&(e.context.activeTexture.set(f.TEXTURE0),y.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),x.updatePaintBuffers(h));var C=p.constantOr(null);if(C&&y.imageAtlas){var w=y.imageAtlas,E=w.patternPositions[C.to.toString()],D=w.patternPositions[C.from.toString()];E&&D&&x.setConstantPatternPositions(E,D)}var O=e.translatePosMatrix(v.posMatrix,y,n.paint.get(`fill-translate`),n.paint.get(`fill-translate-anchor`));if(o){u=b.indexBuffer2,d=b.segments2;var k=[f.drawingBufferWidth,f.drawingBufferHeight];l=c===`fillOutlinePattern`&&m?Ln(O,e,h,y,k):In(O,k)}else u=b.indexBuffer,d=b.segments,l=m?Fn(O,e,h,y):Pn(O);S.draw(e.context,s,i,e.stencilModeForClipping(v),a,Le.disabled,l,n.id,b.layoutVertexBuffer,u,d,n.paint,e.transform.zoom,x)}}}}function pr(e,t,n,r,i,a,o){for(var s=e.context,c=s.gl,l=n.paint.get(`fill-extrusion-pattern`),u=l.constantOr(1),d=n.getCrossfadeParameters(),f=n.paint.get(`fill-extrusion-opacity`),p=0,m=r;p<m.length;p+=1){var h=m[p],g=t.getTile(h),_=g.getBucket(n);if(_){var v=_.programConfigurations.get(n.id),y=e.useProgram(u?`fillExtrusionPattern`:`fillExtrusion`,v);u&&(e.context.activeTexture.set(c.TEXTURE0),g.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),v.updatePaintBuffers(d));var b=l.constantOr(null);if(b&&g.imageAtlas){var x=g.imageAtlas,S=x.patternPositions[b.to.toString()],C=x.patternPositions[b.from.toString()];S&&C&&v.setConstantPatternPositions(S,C)}var w=e.translatePosMatrix(h.posMatrix,g,n.paint.get(`fill-extrusion-translate`),n.paint.get(`fill-extrusion-translate-anchor`)),E=n.paint.get(`fill-extrusion-vertical-gradient`),D=u?Nn(w,e,E,f,h,d,g):Mn(w,e,E,f);y.draw(s,s.gl.TRIANGLES,i,a,o,Le.backCCW,D,n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,n.paint,e.transform.zoom,v)}}}function mr(t,n,r,i,a,o){var s=t.context,c=s.gl,l=n.fbo;if(l){var u=t.useProgram(`hillshade`);s.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,l.colorAttachment.get());var d=function(t,n,r){var i=r.paint.get(`hillshade-shadow-color`),a=r.paint.get(`hillshade-highlight-color`),o=r.paint.get(`hillshade-accent-color`),s=r.paint.get(`hillshade-illumination-direction`)*(Math.PI/180);r.paint.get(`hillshade-illumination-anchor`)===`viewport`&&(s-=t.transform.angle);var c,l,u,d=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(n.tileID.toUnwrapped(),d),u_image:0,u_latrange:(c=n.tileID,l=2**c.canonical.z,u=c.canonical.y,[new e.MercatorCoordinate(0,u/l).toLngLat().lat,new e.MercatorCoordinate(0,(u+1)/l).toLngLat().lat]),u_light:[r.paint.get(`hillshade-exaggeration`),s],u_shadow:i,u_highlight:a,u_accent:o}}(t,n,r);u.draw(s,c.TRIANGLES,i,a,o,Le.disabled,d,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function hr(t,n,r,i,a,o){var s=t.context,c=s.gl,l=n.dem;if(l&&l.data){var u=l.dim,d=l.stride,f=l.getPixels();if(s.activeTexture.set(c.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(d),n.demTexture){var p=n.demTexture;p.update(f,{premultiply:!1}),p.bind(c.NEAREST,c.CLAMP_TO_EDGE)}else n.demTexture=new e.Texture(s,f,c.RGBA,{premultiply:!1}),n.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);s.activeTexture.set(c.TEXTURE0);var m=n.fbo;if(!m){var h=new e.Texture(s,{width:u,height:u,data:null},c.RGBA);h.bind(c.LINEAR,c.CLAMP_TO_EDGE),(m=n.fbo=s.createFramebuffer(u,u,!0)).colorAttachment.set(h.texture)}s.bindFramebuffer.set(m.framebuffer),s.viewport.set([0,0,u,u]),t.useProgram(`hillshadePrepare`).draw(s,c.TRIANGLES,i,a,o,Le.disabled,function(t,n){var r=n.stride,i=e.create();return e.ortho(i,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(i,i,[0,-e.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ,u_unpack:n.getUnpackVector()}}(n.tileID,l),r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function gr(t,n,r,i,a){var o=i.paint.get(`raster-fade-duration`);if(o>0){var s=e.browser.now(),c=(s-t.timeAdded)/o,l=n?(s-n.timeAdded)/o:-1,u=r.getSource(),d=a.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),f=!n||Math.abs(n.tileID.overscaledZ-d)>Math.abs(t.tileID.overscaledZ-d),p=f&&t.refreshedUponExpiration?1:e.clamp(f?c:1-l,0,1);return t.refreshedUponExpiration&&c>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}var _r=new e.Color(1,0,0,1),vr=new e.Color(0,1,0,1),yr=new e.Color(0,0,1,1),br=new e.Color(1,0,1,1),xr=new e.Color(0,1,1,1);function Sr(e,t,n,r){wr(e,0,t+n/2,e.transform.width,n,r)}function Cr(e,t,n,r){wr(e,t-n/2,0,n,e.transform.height,r)}function wr(t,n,r,i,a,o){var s=t.context,c=s.gl;c.enable(c.SCISSOR_TEST),c.scissor(n*e.browser.devicePixelRatio,r*e.browser.devicePixelRatio,i*e.browser.devicePixelRatio,a*e.browser.devicePixelRatio),s.clear({color:o}),c.disable(c.SCISSOR_TEST)}function Tr(t,n,r){var i=t.context,a=i.gl,o=r.posMatrix,s=t.useProgram(`debug`),c=Pe.disabled,l=Fe.disabled,u=t.colorModeForRenderPass();i.activeTexture.set(a.TEXTURE0),t.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.draw(i,a.LINE_STRIP,c,l,u,Le.disabled,Vn(o,e.Color.red),`$debug`,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments);var d=n.getTileByID(r.key).latestRawTileData,f=Math.floor((d&&d.byteLength||0)/1024),p=n.getTile(r).tileSize,m=512/Math.min(p,512)*(r.overscaledZ/t.transform.zoom)*.5,h=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(h+=` => `+r.overscaledZ),function(e,t){e.initDebugOverlayCanvas();var n=e.debugOverlayCanvas,r=e.context.gl,i=e.debugOverlayCanvas.getContext(`2d`);i.clearRect(0,0,n.width,n.height),i.shadowColor=`white`,i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle=`white`,i.textBaseline=`top`,i.font=`bold 36px Open Sans, sans-serif`,i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,h+` `+f+`kb`),s.draw(i,a.TRIANGLES,c,l,Ie.alphaBlended,Le.disabled,Vn(o,e.Color.transparent,m),`$debug`,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments)}var Er={symbol:function(t,n,r,i,a){if(t.renderPass===`translucent`){var o=Fe.disabled,s=t.colorModeForRenderPass();r.layout.get(`text-variable-anchor`)&&function(t,n,r,i,a,o,s){for(var c=n.transform,l=a===`map`,u=o===`map`,d=0,f=t;d<f.length;d+=1){var p=f[d],m=i.getTile(p),h=m.getBucket(r);if(h&&h.text&&h.text.segments.get().length){var g=e.evaluateSizeForZoom(h.textSizeData,c.zoom),_=bt(m,1,n.transform.zoom),v=at(p.posMatrix,u,l,n.transform,_),y=r.layout.get(`icon-text-fit`)!==`none`&&h.hasIconData();if(g){var b=2**(c.zoom-m.tileID.overscaledZ);cr(h,l,u,s,e.symbolSize,c,v,p.posMatrix,b,g,y)}}}}(i,t,r,n,r.layout.get(`text-rotation-alignment`),r.layout.get(`text-pitch-alignment`),a),r.paint.get(`icon-opacity`).constantOr(1)!==0&&ur(t,n,r,i,!1,r.paint.get(`icon-translate`),r.paint.get(`icon-translate-anchor`),r.layout.get(`icon-rotation-alignment`),r.layout.get(`icon-pitch-alignment`),r.layout.get(`icon-keep-upright`),o,s),r.paint.get(`text-opacity`).constantOr(1)!==0&&ur(t,n,r,i,!0,r.paint.get(`text-translate`),r.paint.get(`text-translate-anchor`),r.layout.get(`text-rotation-alignment`),r.layout.get(`text-pitch-alignment`),r.layout.get(`text-keep-upright`),o,s),n.map.showCollisionBoxes&&(ar(t,n,r,i,r.paint.get(`text-translate`),r.paint.get(`text-translate-anchor`),!0),ar(t,n,r,i,r.paint.get(`icon-translate`),r.paint.get(`icon-translate-anchor`),!1))}},circle:function(t,n,r,i){if(t.renderPass===`translucent`){var a=r.paint.get(`circle-opacity`),o=r.paint.get(`circle-stroke-width`),s=r.paint.get(`circle-stroke-opacity`),c=r.layout.get(`circle-sort-key`).constantOr(1)!==void 0;if(a.constantOr(1)!==0||o.constantOr(1)!==0&&s.constantOr(1)!==0){for(var l=t.context,u=l.gl,d=t.depthModeForSublayer(0,Pe.ReadOnly),f=Fe.disabled,p=t.colorModeForRenderPass(),m=[],h=0;h<i.length;h++){var g=i[h],_=n.getTile(g),v=_.getBucket(r);if(v){var y=v.programConfigurations.get(r.id),b={programConfiguration:y,program:t.useProgram(`circle`,y),layoutVertexBuffer:v.layoutVertexBuffer,indexBuffer:v.indexBuffer,uniformValues:Rn(t,g,_,r)};if(c)for(var x=0,S=v.segments.get();x<S.length;x+=1){var C=S[x];m.push({segments:new e.SegmentVector([C]),sortKey:C.sortKey,state:b})}else m.push({segments:v.segments,sortKey:0,state:b})}}c&&m.sort((function(e,t){return e.sortKey-t.sortKey}));for(var w=0,E=m;w<E.length;w+=1){var D=E[w],O=D.state;O.program.draw(l,u.TRIANGLES,d,f,p,Le.disabled,O.uniformValues,r.id,O.layoutVertexBuffer,O.indexBuffer,D.segments,r.paint,t.transform.zoom,O.programConfiguration)}}}},heatmap:function(t,n,r,i){if(r.paint.get(`heatmap-opacity`)!==0)if(t.renderPass===`offscreen`){var a=t.context,o=a.gl,s=Fe.disabled,c=new Ie([o.ONE,o.ONE],e.Color.transparent,[!0,!0,!0,!0]);(function(e,t,n){var r=e.gl;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);var i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),e.bindFramebuffer.set(i.framebuffer);else{var a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1),function(e,t,n,r){var i=e.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width/4,t.height/4,0,i.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(e,t,a,i)}})(a,t,r),a.clear({color:e.Color.transparent});for(var l=0;l<i.length;l++){var u=i[l];if(!n.hasRenderableParent(u)){var d=n.getTile(u),f=d.getBucket(r);if(f){var p=f.programConfigurations.get(r.id);t.useProgram(`heatmap`,p).draw(a,o.TRIANGLES,Pe.disabled,s,c,Le.disabled,Un(u.posMatrix,d,t.transform.zoom,r.paint.get(`heatmap-intensity`)),r.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,r.paint,t.transform.zoom,p)}}}a.viewport.set([0,0,t.width,t.height])}else t.renderPass===`translucent`&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){var r=t.context,i=r.gl,a=n.heatmapFbo;if(a){r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);var o=n.colorRampTexture;o||=n.colorRampTexture=new e.Texture(r,n.colorRamp,i.RGBA),o.bind(i.LINEAR,i.CLAMP_TO_EDGE),t.useProgram(`heatmapTexture`).draw(r,i.TRIANGLES,Pe.disabled,Fe.disabled,t.colorModeForRenderPass(),Le.disabled,function(t,n,r,i){var a=e.create();e.ortho(a,0,t.width,t.height,0,0,1);var o=t.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get(`heatmap-opacity`)}}(t,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}}(t,r))},line:function(t,n,r,i){if(t.renderPass===`translucent`){var a=r.paint.get(`line-opacity`),o=r.paint.get(`line-width`);if(a.constantOr(1)!==0&&o.constantOr(1)!==0)for(var s=t.depthModeForSublayer(0,Pe.ReadOnly),c=t.colorModeForRenderPass(),l=r.paint.get(`line-dasharray`),u=r.paint.get(`line-pattern`),d=u.constantOr(1),f=r.paint.get(`line-gradient`),p=r.getCrossfadeParameters(),m=d?`linePattern`:l?`lineSDF`:f?`lineGradient`:`line`,h=t.context,g=h.gl,_=!0,v=0,y=i;v<y.length;v+=1){var b=y[v],x=n.getTile(b);if(!d||x.patternsLoaded()){var S=x.getBucket(r);if(S){var C=S.programConfigurations.get(r.id),w=t.context.program.get(),E=t.useProgram(m,C),D=_||E.program!==w,O=u.constantOr(null);if(O&&x.imageAtlas){var k=x.imageAtlas,A=k.patternPositions[O.to.toString()],j=k.patternPositions[O.from.toString()];A&&j&&C.setConstantPatternPositions(A,j)}var M=d?Kn(t,x,r,p):l?qn(t,x,r,l,p):f?Gn(t,x,r,S.lineClipsArray.length):Wn(t,x,r);if(d)h.activeTexture.set(g.TEXTURE0),x.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),C.updatePaintBuffers(p);else if(l&&(D||t.lineAtlas.dirty))h.activeTexture.set(g.TEXTURE0),t.lineAtlas.bind(h);else if(f){var N=S.gradients[r.id],P=N.texture;if(r.gradientVersion!==N.version){var F=256;if(r.stepInterpolant){var I=n.getSource().maxzoom,ee=b.canonical.z===I?Math.ceil(1<<t.transform.maxZoom-b.canonical.z):1;F=e.clamp(e.nextPowerOfTwo(S.maxLineLength/e.EXTENT*1024*ee),256,h.maxTextureSize)}N.gradient=e.renderColorRamp({expression:r.gradientExpression(),evaluationKey:`lineProgress`,resolution:F,image:N.gradient||void 0,clips:S.lineClipsArray}),N.texture?N.texture.update(N.gradient):N.texture=new e.Texture(h,N.gradient,g.RGBA),N.version=r.gradientVersion,P=N.texture}h.activeTexture.set(g.TEXTURE0),P.bind(r.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}E.draw(h,g.TRIANGLES,s,t.stencilModeForClipping(b),c,Le.disabled,M,r.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,r.paint,t.transform.zoom,C,S.layoutVertexBuffer2),_=!1}}}}},fill:function(t,n,r,i){var a=r.paint.get(`fill-color`),o=r.paint.get(`fill-opacity`);if(o.constantOr(1)!==0){var s=t.colorModeForRenderPass(),c=r.paint.get(`fill-pattern`),l=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&a.constantOr(e.Color.transparent).a===1&&o.constantOr(0)===1?`opaque`:`translucent`;t.renderPass===l&&fr(t,n,r,i,t.depthModeForSublayer(1,t.renderPass===`opaque`?Pe.ReadWrite:Pe.ReadOnly),s,!1),t.renderPass===`translucent`&&r.paint.get(`fill-antialias`)&&fr(t,n,r,i,t.depthModeForSublayer(r.getPaintProperty(`fill-outline-color`)?2:0,Pe.ReadOnly),s,!0)}},"fill-extrusion":function(e,t,n,r){var i=n.paint.get(`fill-extrusion-opacity`);if(i!==0&&e.renderPass===`translucent`){var a=new Pe(e.context.gl.LEQUAL,Pe.ReadWrite,e.depthRangeFor3D);if(i!==1||n.paint.get(`fill-extrusion-pattern`).constantOr(1))pr(e,t,n,r,a,Fe.disabled,Ie.disabled),pr(e,t,n,r,a,e.stencilModeFor3D(),e.colorModeForRenderPass());else{var o=e.colorModeForRenderPass();pr(e,t,n,r,a,Fe.disabled,o)}}},hillshade:function(e,t,n,r){if(e.renderPass===`offscreen`||e.renderPass===`translucent`){for(var i=e.context,a=e.depthModeForSublayer(0,Pe.ReadOnly),o=e.colorModeForRenderPass(),s=e.renderPass===`translucent`?e.stencilConfigForOverlap(r):[{},r],c=s[0],l=0,u=s[1];l<u.length;l+=1){var d=u[l],f=t.getTile(d);f.needsHillshadePrepare&&e.renderPass===`offscreen`?hr(e,f,n,a,Fe.disabled,o):e.renderPass===`translucent`&&mr(e,f,n,a,c[d.overscaledZ],o)}i.viewport.set([0,0,e.width,e.height])}},raster:function(e,t,n,r){if(e.renderPass===`translucent`&&n.paint.get(`raster-opacity`)!==0&&r.length)for(var i=e.context,a=i.gl,o=t.getSource(),s=e.useProgram(`raster`),c=e.colorModeForRenderPass(),l=o instanceof N?[{},r]:e.stencilConfigForOverlap(r),u=l[0],d=l[1],f=d[d.length-1].overscaledZ,p=!e.options.moving,m=0,h=d;m<h.length;m+=1){var g=h[m],_=e.depthModeForSublayer(g.overscaledZ-f,n.paint.get(`raster-opacity`)===1?Pe.ReadWrite:Pe.ReadOnly,a.LESS),v=t.getTile(g),y=e.transform.calculatePosMatrix(g.toUnwrapped(),p);v.registerFadeDuration(n.paint.get(`raster-fade-duration`));var b=t.findLoadedParent(g,0),x=gr(v,b,t,n,e.transform),S=void 0,C=void 0,w=n.paint.get(`raster-resampling`)===`nearest`?a.NEAREST:a.LINEAR;i.activeTexture.set(a.TEXTURE0),v.texture.bind(w,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(a.TEXTURE1),b?(b.texture.bind(w,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),S=2**(b.tileID.overscaledZ-v.tileID.overscaledZ),C=[v.tileID.canonical.x*S%1,v.tileID.canonical.y*S%1]):v.texture.bind(w,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);var E=Xn(y,C||[0,0],S||1,x,n);o instanceof N?s.draw(i,a.TRIANGLES,_,Fe.disabled,c,Le.disabled,E,n.id,o.boundsBuffer,e.quadTriangleIndexBuffer,o.boundsSegments):s.draw(i,a.TRIANGLES,_,u[g.overscaledZ],c,Le.disabled,E,n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}},background:function(e,t,n){var r=n.paint.get(`background-color`),i=n.paint.get(`background-opacity`);if(i!==0){var a=e.context,o=a.gl,s=e.transform,c=s.tileSize,l=n.paint.get(`background-pattern`);if(!e.isPatternMissing(l)){var u=!l&&r.a===1&&i===1&&e.opaquePassEnabledForLayer()?`opaque`:`translucent`;if(e.renderPass===u){var d=Fe.disabled,f=e.depthModeForSublayer(0,u===`opaque`?Pe.ReadWrite:Pe.ReadOnly),p=e.colorModeForRenderPass(),m=e.useProgram(l?`backgroundPattern`:`background`),h=s.coveringTiles({tileSize:c});l&&(a.activeTexture.set(o.TEXTURE0),e.imageManager.bind(e.context));for(var g=n.getCrossfadeParameters(),_=0,v=h;_<v.length;_+=1){var y=v[_],b=e.transform.calculatePosMatrix(y.toUnwrapped()),x=l?rr(b,i,e,l,{tileID:y,tileSize:c},g):nr(b,i,r);m.draw(a,o.TRIANGLES,f,d,p,Le.disabled,x,n.id,e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments)}}}}},debug:function(e,t,n){for(var r=0;r<n.length;r++)Tr(e,t,n[r])},custom:function(e,t,n){var r=e.context,i=n.implementation;if(e.renderPass===`offscreen`){var a=i.prerender;a&&(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),a.call(i,r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState())}else if(e.renderPass===`translucent`){e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(Fe.disabled);var o=i.renderingMode===`3d`?new Pe(e.context.gl.LEQUAL,Pe.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Pe.ReadOnly);r.setDepthMode(o),i.render(r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}},Dr=function(e,t){this.context=new q(e),this.transform=t,this._tileTextures={},this.setup(),this.numSublayers=Re.maxUnderzooming+Re.maxOverzooming+1,this.depthEpsilon=1/2**16,this.crossTileSymbolIndex=new Kt,this.gpuTimers={}};Dr.prototype.resize=function(t,n){if(this.width=t*e.browser.devicePixelRatio,this.height=n*e.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,i=this.style._order;r<i.length;r+=1)this.style._layers[i[r]].resize()},Dr.prototype.setup=function(){var t=this.context,n=new e.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(e.EXTENT,0),n.emplaceBack(0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,Qt.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);var r=new e.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(e.EXTENT,0),r.emplaceBack(0,e.EXTENT),r.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(r,Qt.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);var i=new e.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(e.EXTENT,0,e.EXTENT,0),i.emplaceBack(0,e.EXTENT,0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(i,M.members),this.rasterBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);var a=new e.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,Qt.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);var o=new e.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(o);var s=new e.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);var c=this.context.gl;this.stencilClearMode=new Fe({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO)},Dr.prototype.clearStencil=function(){var t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=e.create();e.ortho(r,0,this.width,this.height,0,0,1),e.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram(`clippingMask`).draw(t,n.TRIANGLES,Pe.disabled,this.stencilClearMode,Ie.disabled,Le.disabled,Hn(r),`$clipping`,this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Dr.prototype._renderTileClippingMasks=function(e,t){if(this.currentStencilSource!==e.source&&e.isTileClipped()&&t&&t.length){this.currentStencilSource=e.source;var n=this.context,r=n.gl;this.nextStencilID+t.length>256&&this.clearStencil(),n.setColorMode(Ie.disabled),n.setDepthMode(Pe.disabled);var i=this.useProgram(`clippingMask`);this._tileClippingMaskIDs={};for(var a=0,o=t;a<o.length;a+=1){var s=o[a],c=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(n,r.TRIANGLES,Pe.disabled,new Fe({func:r.ALWAYS,mask:0},c,255,r.KEEP,r.KEEP,r.REPLACE),Ie.disabled,Le.disabled,Hn(s.posMatrix),`$clipping`,this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Dr.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var e=this.nextStencilID++,t=this.context.gl;return new Fe({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)},Dr.prototype.stencilModeForClipping=function(e){var t=this.context.gl;return new Fe({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)},Dr.prototype.stencilConfigForOverlap=function(e){var t,n=this.context.gl,r=e.sort((function(e,t){return t.overscaledZ-e.overscaledZ})),i=r[r.length-1].overscaledZ,a=r[0].overscaledZ-i+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();for(var o={},s=0;s<a;s++)o[s+i]=new Fe({func:n.GEQUAL,mask:255},s+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=a,[o,r]}return[(t={},t[i]=Fe.disabled,t),r]},Dr.prototype.colorModeForRenderPass=function(){var t=this.context.gl;return this._showOverdrawInspector?new Ie([t.CONSTANT_COLOR,t.ONE],new e.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass===`opaque`?Ie.unblended:Ie.alphaBlended},Dr.prototype.depthModeForSublayer=function(e,t,n){if(!this.opaquePassEnabledForLayer())return Pe.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Pe(n||this.context.gl.LEQUAL,t,[r,r])},Dr.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Dr.prototype.render=function(t,n){var r=this;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.browser.now()),this.imageManager.beginFrame();var i=this.style._order,a=this.style.sourceCaches;for(var o in a){var s=a[o];s.used&&s.prepare(this.context)}var c,l,u={},d={},f={};for(var p in a){var m=a[p];u[p]=m.getVisibleCoordinates(),d[p]=u[p].slice().reverse(),f[p]=m.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var h=0;h<i.length;h++)if(this.style._layers[i[h]].is3D()){this.opaquePassCutoff=h;break}this.renderPass=`offscreen`;for(var g=0,_=i;g<_.length;g+=1){var v=this.style._layers[_[g]];if(v.hasOffscreenPass()&&!v.isHidden(this.transform.zoom)){var y=d[v.source];(v.type===`custom`||y.length)&&this.renderLayer(this,a[v.source],v,y)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass=`opaque`,this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var b=this.style._layers[i[this.currentLayer]],x=a[b.source],S=u[b.source];this._renderTileClippingMasks(b,S),this.renderLayer(this,x,b,S)}for(this.renderPass=`translucent`,this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var C=this.style._layers[i[this.currentLayer]],w=a[C.source],E=(C.type===`symbol`?f:d)[C.source];this._renderTileClippingMasks(C,u[C.source]),this.renderLayer(this,w,C,E)}this.options.showTileBoundaries&&(e.values(this.style._layers).forEach((function(e){e.source&&!e.isHidden(r.transform.zoom)&&(e.source!==(l&&l.id)&&(l=r.style.sourceCaches[e.source]),(!c||c.getSource().maxzoom<l.getSource().maxzoom)&&(c=l))})),c&&Er.debug(this,c,c.getVisibleCoordinates())),this.options.showPadding&&function(e){var t=e.transform.padding;Sr(e,e.transform.height-(t.top||0),3,_r),Sr(e,t.bottom||0,3,vr),Cr(e,t.left||0,3,yr),Cr(e,e.transform.width-(t.right||0),3,br);var n=e.transform.centerPoint;(function(e,t,n,r){wr(e,t-1,n-10,2,20,r),wr(e,t-10,n-1,20,2,r)})(e,n.x,e.transform.height-n.y,xr)}(this),this.context.setDefault()},Dr.prototype.renderLayer=function(e,t,n,r){n.isHidden(this.transform.zoom)||(n.type===`background`||n.type===`custom`||r.length)&&(this.id=n.id,this.gpuTimingStart(n),Er[n.type](e,t,n,r,this.style.placement.variableOffsets),this.gpuTimingEnd())},Dr.prototype.gpuTimingStart=function(e){if(this.options.gpuTiming){var t=this.context.extTimerQuery,n=this.gpuTimers[e.id];n||=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()},n.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,n.query)}},Dr.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}},Dr.prototype.collectGpuTimers=function(){var e=this.gpuTimers;return this.gpuTimers={},e},Dr.prototype.queryGpuTimers=function(e){var t={};for(var n in e){var r=e[n],i=this.context.extTimerQuery,a=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),t[n]=a}return t},Dr.prototype.translatePosMatrix=function(t,n,r,i,a){if(!r[0]&&!r[1])return t;var o=a?i===`map`?this.transform.angle:0:i===`viewport`?-this.transform.angle:0;if(o){var s=Math.sin(o),c=Math.cos(o);r=[r[0]*c-r[1]*s,r[0]*s+r[1]*c]}var l=[a?r[0]:bt(n,r[0],this.transform.zoom),a?r[1]:bt(n,r[1],this.transform.zoom),0],u=new Float32Array(16);return e.translate(u,t,l),u},Dr.prototype.saveTileTexture=function(e){var t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]},Dr.prototype.getTileTexture=function(e){var t=this._tileTextures[e];return t&&t.length>0?t.pop():null},Dr.prototype.isPatternMissing=function(e){if(!e)return!1;if(!e.from||!e.to)return!0;var t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n},Dr.prototype.useProgram=function(e,t){this.cache=this.cache||{};var n=``+e+(t?t.cacheKey:``)+(this._showOverdrawInspector?`/overdraw`:``);return this.cache[n]||(this.cache[n]=new An(this.context,e,Dn[e],t,ir[e],this._showOverdrawInspector)),this.cache[n]},Dr.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Dr.prototype.setBaseState=function(){var e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)},Dr.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas??(this.debugOverlayCanvas=e.window.document.createElement(`canvas`),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Dr.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Or=function(e,t){this.points=e,this.planes=t};Or.fromInvProjectionMatrix=function(t,n,r){var i=2**r,a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(n){return e.transformMat4([],n,t)})).map((function(t){return e.scale$1([],t,1/t[3]/n*i)}));return new Or(a,[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(t){var n=e.sub([],a[t[0]],a[t[1]]),r=e.sub([],a[t[2]],a[t[1]]),i=e.normalize([],e.cross([],n,r)),o=-e.dot(i,a[t[1]]);return i.concat(o)})))};var kr=function(t,n){this.min=t,this.max=n,this.center=e.scale$2([],e.add([],this.min,this.max),.5)};kr.prototype.quadrant=function(t){for(var n=[t%2==0,t<2],r=e.clone$2(this.min),i=e.clone$2(this.max),a=0;a<n.length;a++)r[a]=n[a]?this.min[a]:this.center[a],i[a]=n[a]?this.center[a]:this.max[a];return i[2]=this.max[2],new kr(r,i)},kr.prototype.distanceX=function(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]},kr.prototype.distanceY=function(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]},kr.prototype.intersects=function(t){for(var n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,i=0;i<t.planes.length;i++){for(var a=t.planes[i],o=0,s=0;s<n.length;s++)o+=e.dot$1(a,n[s])>=0;if(o===0)return 0;o!==n.length&&(r=!1)}if(r)return 2;for(var c=0;c<3;c++){for(var l=Number.MAX_VALUE,u=-Number.MAX_VALUE,d=0;d<t.points.length;d++){var f=t.points[d][c]-this.min[c];l=Math.min(l,f),u=Math.max(u,f)}if(u<0||l>this.max[c]-this.min[c])return 0}return 1};var Ar=function(e,t,n,r){if(e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),r===void 0&&(r=0),isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0)throw Error(`Invalid value for edge-insets, top, bottom, left and right must all be numbers`);this.top=e,this.bottom=t,this.left=n,this.right=r};Ar.prototype.interpolate=function(t,n,r){return n.top!=null&&t.top!=null&&(this.top=e.number(t.top,n.top,r)),n.bottom!=null&&t.bottom!=null&&(this.bottom=e.number(t.bottom,n.bottom,r)),n.left!=null&&t.left!=null&&(this.left=e.number(t.left,n.left,r)),n.right!=null&&t.right!=null&&(this.right=e.number(t.right,n.right,r)),this},Ar.prototype.getCenter=function(t,n){var r=e.clamp((this.left+t-this.right)/2,0,t),i=e.clamp((this.top+n-this.bottom)/2,0,n);return new e.Point(r,i)},Ar.prototype.equals=function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right},Ar.prototype.clone=function(){return new Ar(this.top,this.bottom,this.left,this.right)},Ar.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var jr=function(t,n,r,i,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=a===void 0||a,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=r??0,this._maxPitch=i??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ar,this._posMatrixCache={},this._alignedPosMatrixCache={}},Mr={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};jr.prototype.clone=function(){var e=new jr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e._center=this._center,e.zoom=this.zoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._calcMatrices(),e},Mr.minZoom.get=function(){return this._minZoom},Mr.minZoom.set=function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))},Mr.maxZoom.get=function(){return this._maxZoom},Mr.maxZoom.set=function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))},Mr.minPitch.get=function(){return this._minPitch},Mr.minPitch.set=function(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))},Mr.maxPitch.get=function(){return this._maxPitch},Mr.maxPitch.set=function(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))},Mr.renderWorldCopies.get=function(){return this._renderWorldCopies},Mr.renderWorldCopies.set=function(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e},Mr.worldSize.get=function(){return this.tileSize*this.scale},Mr.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Mr.size.get=function(){return new e.Point(this.width,this.height)},Mr.bearing.get=function(){return-this.angle/Math.PI*180},Mr.bearing.set=function(t){var n=-e.wrap(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=e.create$2(),e.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Mr.pitch.get=function(){return this._pitch/Math.PI*180},Mr.pitch.set=function(t){var n=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},Mr.fov.get=function(){return this._fov/Math.PI*180},Mr.fov.set=function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())},Mr.zoom.get=function(){return this._zoom},Mr.zoom.set=function(e){var t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this._constrain(),this._calcMatrices())},Mr.center.get=function(){return this._center},Mr.center.set=function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())},Mr.padding.get=function(){return this._edgeInsets.toJSON()},Mr.padding.set=function(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())},Mr.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},jr.prototype.isPaddingEqual=function(e){return this._edgeInsets.equals(e)},jr.prototype.interpolatePadding=function(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()},jr.prototype.coveringZoomLevel=function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)},jr.prototype.getVisibleUnwrappedCoordinates=function(t){var n=[new e.UnwrappedTileID(0,t)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new e.Point(0,0)),i=this.pointCoordinate(new e.Point(this.width,0)),a=this.pointCoordinate(new e.Point(this.width,this.height)),o=this.pointCoordinate(new e.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,a.x,o.x)),c=Math.floor(Math.max(r.x,i.x,a.x,o.x)),l=s-1;l<=c+1;l++)l!==0&&n.push(new e.UnwrappedTileID(l,t));return n},jr.prototype.coveringTiles=function(t){var n=this.coveringZoomLevel(t),r=n;if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);var i=e.MercatorCoordinate.fromLngLat(this.center),a=2**n,o=[a*i.x,a*i.y,0],s=Or.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),c=t.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(c=n);var l=function(e){return{aabb:new kr([e*a,0,0],[(e+1)*a,a,0]),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}},u=[],d=[],f=n,p=t.reparseOverscaled?r:n;if(this._renderWorldCopies)for(var m=1;m<=3;m++)u.push(l(-m)),u.push(l(m));for(u.push(l(0));u.length>0;){var h=u.pop(),g=h.x,_=h.y,v=h.fullyVisible;if(!v){var y=h.aabb.intersects(s);if(y===0)continue;v=y===2}var b=h.aabb.distanceX(o),x=h.aabb.distanceY(o),S=Math.max(Math.abs(b),Math.abs(x));if(h.zoom===f||S>3+(1<<f-h.zoom)-2&&h.zoom>=c)d.push({tileID:new e.OverscaledTileID(h.zoom===f?p:h.zoom,h.wrap,h.zoom,g,_),distanceSq:e.sqrLen([o[0]-.5-g,o[1]-.5-_])});else for(var C=0;C<4;C++){var w=(g<<1)+C%2,E=(_<<1)+(C>>1);u.push({aabb:h.aabb.quadrant(C),zoom:h.zoom+1,x:w,y:E,wrap:h.wrap,fullyVisible:v})}}return d.sort((function(e,t){return e.distanceSq-t.distanceSq})).map((function(e){return e.tileID}))},jr.prototype.resize=function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()},Mr.unmodified.get=function(){return this._unmodified},jr.prototype.zoomScale=function(e){return 2**e},jr.prototype.scaleZoom=function(e){return Math.log(e)/Math.LN2},jr.prototype.project=function(t){var n=e.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new e.Point(e.mercatorXfromLng(t.lng)*this.worldSize,e.mercatorYfromLat(n)*this.worldSize)},jr.prototype.unproject=function(t){return new e.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()},Mr.point.get=function(){return this.project(this.center)},jr.prototype.setLocationAtPoint=function(t,n){var r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(t),o=new e.MercatorCoordinate(a.x-(r.x-i.x),a.y-(r.y-i.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())},jr.prototype.locationPoint=function(e){return this.coordinatePoint(this.locationCoordinate(e))},jr.prototype.pointLocation=function(e){return this.coordinateLocation(this.pointCoordinate(e))},jr.prototype.locationCoordinate=function(t){return e.MercatorCoordinate.fromLngLat(t)},jr.prototype.coordinateLocation=function(e){return e.toLngLat()},jr.prototype.pointCoordinate=function(t){var n=[t.x,t.y,0,1],r=[t.x,t.y,1,1];e.transformMat4(n,n,this.pixelMatrixInverse),e.transformMat4(r,r,this.pixelMatrixInverse);var i=n[3],a=r[3],o=n[1]/i,s=r[1]/a,c=n[2]/i,l=r[2]/a,u=c===l?0:(0-c)/(l-c);return new e.MercatorCoordinate(e.number(n[0]/i,r[0]/a,u)/this.worldSize,e.number(o,s,u)/this.worldSize)},jr.prototype.coordinatePoint=function(t){var n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.transformMat4(n,n,this.pixelMatrix),new e.Point(n[0]/n[3],n[1]/n[3])},jr.prototype.getBounds=function(){return new e.LngLatBounds().extend(this.pointLocation(new e.Point(0,0))).extend(this.pointLocation(new e.Point(this.width,0))).extend(this.pointLocation(new e.Point(this.width,this.height))).extend(this.pointLocation(new e.Point(0,this.height)))},jr.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new e.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},jr.prototype.setMaxBounds=function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},jr.prototype.calculatePosMatrix=function(t,n){n===void 0&&(n=!1);var r=t.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];var a=t.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+2**a.z*t.wrap,c=e.identity(new Float64Array(16));return e.translate(c,c,[s*o,a.y*o,0]),e.scale(c,c,[o/e.EXTENT,o/e.EXTENT,1]),e.multiply(c,n?this.alignedProjMatrix:this.projMatrix,c),i[r]=new Float32Array(c),i[r]},jr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},jr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,n,r,i,a=-90,o=90,s=-180,c=180,l=this.size,u=this._unmodified;if(this.latRange){var d=this.latRange;a=e.mercatorYfromLat(d[1])*this.worldSize,t=(o=e.mercatorYfromLat(d[0])*this.worldSize)-a<l.y?l.y/(o-a):0}if(this.lngRange){var f=this.lngRange;s=e.mercatorXfromLng(f[0])*this.worldSize,n=(c=e.mercatorXfromLng(f[1])*this.worldSize)-s<l.x?l.x/(c-s):0}var p=this.point,m=Math.max(n||0,t||0);if(m)return this.center=this.unproject(new e.Point(n?(c+s)/2:p.x,t?(o+a)/2:p.y)),this.zoom+=this.scaleZoom(m),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var h=p.y,g=l.y/2;h-g<a&&(i=a+g),h+g>o&&(i=o-g)}if(this.lngRange){var _=p.x,v=l.x/2;_-v<s&&(r=s+v),_+v>c&&(r=c-v)}r===void 0&&i===void 0||(this.center=this.unproject(new e.Point(r===void 0?p.x:r,i===void 0?p.y:i))),this._unmodified=u,this._constraining=!1}},jr.prototype._calcMatrices=function(){if(this.height){var t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(e.clamp(Math.PI-n-r,.01,Math.PI-.01)),a=this.point,o=a.x,s=a.y,c=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,u=new Float64Array(16);e.perspective(u,this._fov,this.width/this.height,l,c),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,e.scale(u,u,[1,-1,1]),e.translate(u,u,[0,0,-this.cameraToCenterDistance]),e.rotateX(u,u,this._pitch),e.rotateZ(u,u,this.angle),e.translate(u,u,[-o,-s,0]),this.mercatorMatrix=e.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),e.scale(u,u,[1,1,e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=u,this.invProjMatrix=e.invert([],this.projMatrix);var d=this.width%2/2,f=this.height%2/2,p=Math.cos(this.angle),m=Math.sin(this.angle),h=o-Math.round(o)+p*d+m*f,g=s-Math.round(s)+p*f+m*d,_=new Float64Array(u);if(e.translate(_,_,[h>.5?h-1:h,g>.5?g-1:g,0]),this.alignedProjMatrix=_,u=e.create(),e.scale(u,u,[this.width/2,-this.height/2,1]),e.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.create(),e.scale(u,u,[1,-1,1]),e.translate(u,u,[-1,-1,0]),e.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(u=e.invert(new Float64Array(16),this.pixelMatrix)))throw Error(`failed to invert matrix`);this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}},jr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new e.Point(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},jr.prototype.getCameraPoint=function(){var t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.Point(0,t))},jr.prototype.getCameraQueryGeometry=function(t){var n=this.getCameraPoint();if(t.length===1)return[t[0],n];for(var r=n.x,i=n.y,a=n.x,o=n.y,s=0,c=t;s<c.length;s+=1){var l=c[s];r=Math.min(r,l.x),i=Math.min(i,l.y),a=Math.max(a,l.x),o=Math.max(o,l.y)}return[new e.Point(r,i),new e.Point(a,i),new e.Point(a,o),new e.Point(r,o),new e.Point(r,i)]},Object.defineProperties(jr.prototype,Mr);var Nr=function(t){var n,r,i,a;this._hashName=t&&encodeURIComponent(t),e.bindAll([`_getCurrentHash`,`_onHashChange`,`_updateHash`],this),this._updateHash=(n=this._updateHashUnthrottled.bind(this),r=!1,i=null,a=function(){i=null,r&&=(n(),i=setTimeout(a,300),!1)},function(){return r=!0,i||a(),i})};Nr.prototype.addTo=function(t){return this._map=t,e.window.addEventListener(`hashchange`,this._onHashChange,!1),this._map.on(`moveend`,this._updateHash),this},Nr.prototype.remove=function(){return e.window.removeEventListener(`hashchange`,this._onHashChange,!1),this._map.off(`moveend`,this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Nr.prototype.getHashString=function(t){var n=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=10**Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.round(n.lng*i)/i,o=Math.round(n.lat*i)/i,s=this._map.getBearing(),c=this._map.getPitch(),l=``;if(l+=t?`/`+a+`/`+o+`/`+r:r+`/`+o+`/`+a,(s||c)&&(l+=`/`+Math.round(10*s)/10),c&&(l+=`/`+Math.round(c)),this._hashName){var u=this._hashName,d=!1,f=e.window.location.hash.slice(1).split(`&`).map((function(e){var t=e.split(`=`)[0];return t===u?(d=!0,t+`=`+l):e})).filter((function(e){return e}));return d||f.push(u+`=`+l),`#`+f.join(`&`)}return`#`+l},Nr.prototype._getCurrentHash=function(){var t,n=this,r=e.window.location.hash.replace(`#`,``);return this._hashName?(r.split(`&`).map((function(e){return e.split(`=`)})).forEach((function(e){e[0]===n._hashName&&(t=e)})),(t&&t[1]||``).split(`/`)):r.split(`/`)},Nr.prototype._onHashChange=function(){var e=this._getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(e)}))){var t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1},Nr.prototype._updateHashUnthrottled=function(){var t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());try{e.window.history.replaceState(e.window.history.state,null,t)}catch{}};var Pr={linearity:.3,easing:e.bezier(0,0,.3,1)},Fr=e.extend({deceleration:2500,maxSpeed:1400},Pr),Ir=e.extend({deceleration:20,maxSpeed:1400},Pr),Lr=e.extend({deceleration:1e3,maxSpeed:360},Pr),Rr=e.extend({deceleration:1e3,maxSpeed:90},Pr),zr=function(e){this._map=e,this.clear()};function Br(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Vr(t,n,r){var i=r.maxSpeed,a=r.linearity,o=r.deceleration,s=e.clamp(t*a/(n/1e3),-i,i),c=Math.abs(s)/(o*a);return{easing:r.easing,duration:1e3*c,amount:c/2*s}}zr.prototype.clear=function(){this._inertiaBuffer=[]},zr.prototype.record=function(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.browser.now(),settings:t})},zr.prototype._drainInertiaBuffer=function(){for(var t=this._inertiaBuffer,n=e.browser.now();t.length>0&&n-t[0].time>160;)t.shift()},zr.prototype._onMoveEnd=function(t){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var n={zoom:0,bearing:0,pitch:0,pan:new e.Point(0,0),pinchAround:void 0,around:void 0},r=0,i=this._inertiaBuffer;r<i.length;r+=1){var a=i[r].settings;n.zoom+=a.zoomDelta||0,n.bearing+=a.bearingDelta||0,n.pitch+=a.pitchDelta||0,a.panDelta&&n.pan._add(a.panDelta),a.around&&(n.around=a.around),a.pinchAround&&(n.pinchAround=a.pinchAround)}var o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){var c=Vr(n.pan.mag(),o,e.extend({},Fr,t||{}));s.offset=n.pan.mult(c.amount/n.pan.mag()),s.center=this._map.transform.center,Br(s,c)}if(n.zoom){var l=Vr(n.zoom,o,Ir);s.zoom=this._map.transform.zoom+l.amount,Br(s,l)}if(n.bearing){var u=Vr(n.bearing,o,Lr);s.bearing=this._map.transform.bearing+e.clamp(u.amount,-179,179),Br(s,u)}if(n.pitch){var d=Vr(n.pitch,o,Rr);s.pitch=this._map.transform.pitch+d.amount,Br(s,d)}if(s.zoom||s.bearing){var f=n.pinchAround===void 0?n.around:n.pinchAround;s.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),e.extend(s,{noMoveStart:!0})}};var Hr=function(t){function r(r,i,a,o){o===void 0&&(o={});var s=n.mousePos(i.getCanvasContainer(),a),c=i.unproject(s);t.call(this,r,e.extend({point:s,lngLat:c,originalEvent:a},o)),this._defaultPrevented=!1,this.target=i}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(e.Event),Ur=function(t){function r(r,i,a){var o=r===`touchend`?a.changedTouches:a.touches,s=n.touchPos(i.getCanvasContainer(),o),c=s.map((function(e){return i.unproject(e)})),l=s.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new e.Point(0,0)),u=i.unproject(l);t.call(this,r,{points:s,point:l,lngLats:c,lngLat:u,originalEvent:a}),this._defaultPrevented=!1}t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(e.Event),Wr=function(e){function t(t,n,r){e.call(this,t,{originalEvent:r}),this._defaultPrevented=!1}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={defaultPrevented:{configurable:!0}};return t.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,n),t}(e.Event),Gr=function(e,t){this._map=e,this._clickTolerance=t.clickTolerance};Gr.prototype.reset=function(){delete this._mousedownPos},Gr.prototype.wheel=function(e){return this._firePreventable(new Wr(e.type,this._map,e))},Gr.prototype.mousedown=function(e,t){return this._mousedownPos=t,this._firePreventable(new Hr(e.type,this._map,e))},Gr.prototype.mouseup=function(e){this._map.fire(new Hr(e.type,this._map,e))},Gr.prototype.click=function(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new Hr(e.type,this._map,e))},Gr.prototype.dblclick=function(e){return this._firePreventable(new Hr(e.type,this._map,e))},Gr.prototype.mouseover=function(e){this._map.fire(new Hr(e.type,this._map,e))},Gr.prototype.mouseout=function(e){this._map.fire(new Hr(e.type,this._map,e))},Gr.prototype.touchstart=function(e){return this._firePreventable(new Ur(e.type,this._map,e))},Gr.prototype.touchmove=function(e){this._map.fire(new Ur(e.type,this._map,e))},Gr.prototype.touchend=function(e){this._map.fire(new Ur(e.type,this._map,e))},Gr.prototype.touchcancel=function(e){this._map.fire(new Ur(e.type,this._map,e))},Gr.prototype._firePreventable=function(e){if(this._map.fire(e),e.defaultPrevented)return{}},Gr.prototype.isEnabled=function(){return!0},Gr.prototype.isActive=function(){return!1},Gr.prototype.enable=function(){},Gr.prototype.disable=function(){};var Kr=function(e){this._map=e};Kr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Kr.prototype.mousemove=function(e){this._map.fire(new Hr(e.type,this._map,e))},Kr.prototype.mousedown=function(){this._delayContextMenu=!0},Kr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hr(`contextmenu`,this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Kr.prototype.contextmenu=function(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Hr(e.type,this._map,e)),this._map.listens(`contextmenu`)&&e.preventDefault()},Kr.prototype.isEnabled=function(){return!0},Kr.prototype.isActive=function(){return!1},Kr.prototype.enable=function(){},Kr.prototype.disable=function(){};var qr=function(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1};function Jr(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}qr.prototype.isEnabled=function(){return!!this._enabled},qr.prototype.isActive=function(){return!!this._active},qr.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},qr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},qr.prototype.mousedown=function(e,t){this.isEnabled()&&e.shiftKey&&e.button===0&&(n.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)},qr.prototype.mousemoveWindow=function(e,t){if(this._active){var r=t;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=r,this._box||(this._box=n.create(`div`,`mapboxgl-boxzoom`,this._container),this._container.classList.add(`mapboxgl-crosshair`),this._fireEvent(`boxzoomstart`,e));var a=Math.min(i.x,r.x),o=Math.max(i.x,r.x),s=Math.min(i.y,r.y),c=Math.max(i.y,r.y);n.setTransform(this._box,`translate(`+a+`px,`+s+`px)`),this._box.style.width=o-a+`px`,this._box.style.height=c-s+`px`}}},qr.prototype.mouseupWindow=function(t,r){var i=this;if(this._active&&t.button===0){var a=this._startPos,o=r;if(this.reset(),n.suppressClick(),a.x!==o.x||a.y!==o.y)return this._map.fire(new e.Event(`boxzoomend`,{originalEvent:t})),{cameraAnimation:function(e){return e.fitScreenCoordinates(a,o,i._map.getBearing(),{linear:!0})}};this._fireEvent(`boxzoomcancel`,t)}},qr.prototype.keydown=function(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent(`boxzoomcancel`,e))},qr.prototype.blur=function(){this.reset()},qr.prototype.reset=function(){this._active=!1,this._container.classList.remove(`mapboxgl-crosshair`),this._box&&=(n.remove(this._box),null),n.enableDrag(),delete this._startPos,delete this._lastPos},qr.prototype._fireEvent=function(t,n){return this._map.fire(new e.Event(t,{originalEvent:n}))};var Yr=function(e){this.reset(),this.numTouches=e.numTouches};Yr.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Yr.prototype.touchstart=function(t,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){for(var n=new e.Point(0,0),r=0,i=t;r<i.length;r+=1)n._add(i[r]);return n.div(t.length)}(n),this.touches=Jr(r,n)))},Yr.prototype.touchmove=function(e,t,n){if(!this.aborted&&this.centroid){var r=Jr(n,t);for(var i in this.touches){var a=r[i];(!a||a.dist(this.touches[i])>30)&&(this.aborted=!0)}}},Yr.prototype.touchend=function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),n.length===0){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}};var Xr=function(e){this.singleTap=new Yr(e),this.numTaps=e.numTaps,this.reset()};Xr.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Xr.prototype.touchstart=function(e,t,n){this.singleTap.touchstart(e,t,n)},Xr.prototype.touchmove=function(e,t,n){this.singleTap.touchmove(e,t,n)},Xr.prototype.touchend=function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(r)<30;if(i&&a||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}};var Zr=function(){this._zoomIn=new Xr({numTouches:1,numTaps:2}),this._zoomOut=new Xr({numTouches:2,numTaps:1}),this.reset()};Zr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Zr.prototype.touchstart=function(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)},Zr.prototype.touchmove=function(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)},Zr.prototype.touchend=function(e,t,n){var r=this,i=this._zoomIn.touchend(e,t,n),a=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):a?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(a)},{originalEvent:e})}}):void 0},Zr.prototype.touchcancel=function(){this.reset()},Zr.prototype.enable=function(){this._enabled=!0},Zr.prototype.disable=function(){this._enabled=!1,this.reset()},Zr.prototype.isEnabled=function(){return this._enabled},Zr.prototype.isActive=function(){return this._active};var Qr={0:1,2:2},$r=function(e){this.reset(),this._clickTolerance=e.clickTolerance||1};$r.prototype.blur=function(){this.reset()},$r.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},$r.prototype._correctButton=function(e,t){return!1},$r.prototype._move=function(e,t){return{}},$r.prototype.mousedown=function(e,t){if(!this._lastPoint){var r=n.mouseButton(e);this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r)}},$r.prototype.mousemoveWindow=function(e,t){var n=this._lastPoint;if(n){if(e.preventDefault(),function(e,t){var n=Qr[t];return e.buttons===void 0||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}},$r.prototype.mouseupWindow=function(e){this._lastPoint&&n.mouseButton(e)===this._eventButton&&(this._moved&&n.suppressClick(),this.reset())},$r.prototype.enable=function(){this._enabled=!0},$r.prototype.disable=function(){this._enabled=!1,this.reset()},$r.prototype.isEnabled=function(){return this._enabled},$r.prototype.isActive=function(){return this._active};var ei=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.mousedown=function(t,n){e.prototype.mousedown.call(this,t,n),this._lastPoint&&(this._active=!0)},t.prototype._correctButton=function(e,t){return t===0&&!e.ctrlKey},t.prototype._move=function(e,t){return{around:t,panDelta:t.sub(e)}},t}($r),ti=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._correctButton=function(e,t){return t===0&&e.ctrlKey||t===2},t.prototype._move=function(e,t){var n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}},t.prototype.contextmenu=function(e){e.preventDefault()},t}($r),ni=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._correctButton=function(e,t){return t===0&&e.ctrlKey||t===2},t.prototype._move=function(e,t){var n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}},t.prototype.contextmenu=function(e){e.preventDefault()},t}($r),ri=function(e){this._minTouches=1,this._clickTolerance=e.clickTolerance||1,this.reset()};ri.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new e.Point(0,0)},ri.prototype.touchstart=function(e,t,n){return this._calculateTransform(e,t,n)},ri.prototype.touchmove=function(e,t,n){if(this._active&&!(n.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,t,n)},ri.prototype.touchend=function(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()},ri.prototype.touchcancel=function(){this.reset()},ri.prototype._calculateTransform=function(t,n,r){r.length>0&&(this._active=!0);var i=Jr(r,n),a=new e.Point(0,0),o=new e.Point(0,0),s=0;for(var c in i){var l=i[c],u=this._touches[c];u&&(a._add(l),o._add(l.sub(u)),s++,i[c]=l)}if(this._touches=i,!(s<this._minTouches)&&o.mag()){var d=o.div(s);if(this._sum._add(d),!(this._sum.mag()<this._clickTolerance))return{around:a.div(s),panDelta:d}}},ri.prototype.enable=function(){this._enabled=!0},ri.prototype.disable=function(){this._enabled=!1,this.reset()},ri.prototype.isEnabled=function(){return this._enabled},ri.prototype.isActive=function(){return this._active};var ii=function(){this.reset()};function ai(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function oi(e,t){return Math.log(e/t)/Math.LN2}ii.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},ii.prototype._start=function(e){},ii.prototype._move=function(e,t,n){return{}},ii.prototype.touchstart=function(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))},ii.prototype.touchmove=function(e,t,n){if(this._firstTwoTouches){e.preventDefault();var r=this._firstTwoTouches,i=r[1],a=ai(n,t,r[0]),o=ai(n,t,i);if(a&&o){var s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,e)}}},ii.prototype.touchend=function(e,t,r){if(this._firstTwoTouches){var i=this._firstTwoTouches,a=i[1],o=ai(r,t,i[0]),s=ai(r,t,a);o&&s||(this._active&&n.suppressClick(),this.reset())}},ii.prototype.touchcancel=function(){this.reset()},ii.prototype.enable=function(e){this._enabled=!0,this._aroundCenter=!!e&&e.around===`center`},ii.prototype.disable=function(){this._enabled=!1,this.reset()},ii.prototype.isEnabled=function(){return this._enabled},ii.prototype.isActive=function(){return this._active};var si=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.reset=function(){e.prototype.reset.call(this),delete this._distance,delete this._startDistance},t.prototype._start=function(e){this._startDistance=this._distance=e[0].dist(e[1])},t.prototype._move=function(e,t){var n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(oi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:oi(this._distance,n),pinchAround:t}},t}(ii);function ci(e,t){return 180*e.angleWith(t)/Math.PI}var li=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.reset=function(){e.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},t.prototype._start=function(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])},t.prototype._move=function(e,t){var n=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ci(this._vector,n),pinchAround:t}},t.prototype._isBelowThreshold=function(e){this._minDiameter=Math.min(this._minDiameter,e.mag());var t=25/(Math.PI*this._minDiameter)*360,n=ci(e,this._startVector);return Math.abs(n)<t},t}(ii);function ui(e){return Math.abs(e.y)>Math.abs(e.x)}var di=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.reset=function(){e.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},t.prototype._start=function(e){this._lastPoints=e,ui(e[0].sub(e[1]))&&(this._valid=!1)},t.prototype._move=function(e,t,n){var r=e[0].sub(this._lastPoints[0]),i=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}},t.prototype.gestureBeginsVertically=function(e,t,n){if(this._valid!==void 0)return this._valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return this._firstMove===void 0&&(this._firstMove=n),n-this._firstMove<100&&void 0;var a=e.y>0==t.y>0;return ui(e)&&ui(t)&&a}},t}(ii),fi={panStep:100,bearingStep:15,pitchStep:10},pi=function(){var e=fi;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1};function mi(e){return e*(2-e)}pi.prototype.blur=function(){this.reset()},pi.prototype.reset=function(){this._active=!1},pi.prototype.keydown=function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,a=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),a=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),a=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:function(s){var c=s.getZoom();s.easeTo({duration:300,easeId:`keyboardHandler`,easing:mi,zoom:n?Math.round(c)+n*(e.shiftKey?2:1):c,bearing:s.getBearing()+r*t._bearingStep,pitch:s.getPitch()+i*t._pitchStep,offset:[-a*t._panStep,-o*t._panStep],center:s.getCenter()},{originalEvent:e})}}}},pi.prototype.enable=function(){this._enabled=!0},pi.prototype.disable=function(){this._enabled=!1,this.reset()},pi.prototype.isEnabled=function(){return this._enabled},pi.prototype.isActive=function(){return this._active},pi.prototype.disableRotation=function(){this._rotationDisabled=!0},pi.prototype.enableRotation=function(){this._rotationDisabled=!1};var hi=function(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,e.bindAll([`_onTimeout`],this)};hi.prototype.setZoomRate=function(e){this._defaultZoomRate=e},hi.prototype.setWheelZoomRate=function(e){this._wheelZoomRate=e},hi.prototype.isEnabled=function(){return!!this._enabled},hi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},hi.prototype.isZooming=function(){return!!this._zooming},hi.prototype.enable=function(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&e.around===`center`)},hi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},hi.prototype.wheel=function(t){if(this.isEnabled()){var n=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,r=e.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,n!==0&&n%4.000244140625==0?this._type=`wheel`:n!==0&&Math.abs(n)<4?this._type=`trackpad`:i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*n)<200?`trackpad`:`wheel`,this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}},hi.prototype._onTimeout=function(e){this._type=`wheel`,this._delta-=this._lastValue,this._active||this._start(e)},hi.prototype._start=function(t){if(this._delta){this._frameId&&=null,this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var r=n.mousePos(this._el,t);this._around=e.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},hi.prototype.renderFrame=function(){var t=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform;if(this._delta!==0){var r=this._type===`wheel`&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&i!==0&&(i=1/i);var a=typeof this._targetZoom==`number`?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(a*i))),this._type===`wheel`&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o,s=typeof this._targetZoom==`number`?this._targetZoom:n.zoom,c=this._startZoom,l=this._easing,u=!1;if(this._type===`wheel`&&c&&l){var d=Math.min((e.browser.now()-this._lastWheelEventTime)/200,1),f=l(d);o=e.number(c,s,f),d<1?this._frameId||=!0:u=!0}else o=s,u=!0;return this._active=!0,u&&(this._active=!1,this._finishTimeout=setTimeout((function(){t._zooming=!1,t._handler._triggerRenderFrame(),delete t._targetZoom,delete t._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!u,zoomDelta:o-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},hi.prototype._smoothOutEasing=function(t){var n=e.ease;if(this._prevEase){var r=this._prevEase,i=(e.browser.now()-r.start)/r.duration,a=r.easing(i+.01)-r.easing(i),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=e.bezier(o,s,.25,1)}return this._prevEase={start:e.browser.now(),duration:t,easing:n},n},hi.prototype.blur=function(){this.reset()},hi.prototype.reset=function(){this._active=!1};var gi=function(e,t){this._clickZoom=e,this._tapZoom=t};gi.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},gi.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},gi.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},gi.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var _i=function(){this.reset()};_i.prototype.reset=function(){this._active=!1},_i.prototype.blur=function(){this.reset()},_i.prototype.dblclick=function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}},_i.prototype.enable=function(){this._enabled=!0},_i.prototype.disable=function(){this._enabled=!1,this.reset()},_i.prototype.isEnabled=function(){return this._enabled},_i.prototype.isActive=function(){return this._active};var vi=function(){this._tap=new Xr({numTouches:1,numTaps:1}),this.reset()};vi.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},vi.prototype.touchstart=function(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))},vi.prototype.touchmove=function(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,n)},vi.prototype.touchend=function(e,t,n){this._tapTime?this._swipePoint&&n.length===0&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)},vi.prototype.touchcancel=function(){this.reset()},vi.prototype.enable=function(){this._enabled=!0},vi.prototype.disable=function(){this._enabled=!1,this.reset()},vi.prototype.isEnabled=function(){return this._enabled},vi.prototype.isActive=function(){return this._active};var yi=function(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n};yi.prototype.enable=function(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add(`mapboxgl-touch-drag-pan`)},yi.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove(`mapboxgl-touch-drag-pan`)},yi.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},yi.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var bi=function(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n};bi.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},bi.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},bi.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},bi.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var xi=function(e,t,n,r){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0};xi.prototype.enable=function(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add(`mapboxgl-touch-zoom-rotate`)},xi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove(`mapboxgl-touch-zoom-rotate`)},xi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},xi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},xi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},xi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Si=function(e){return e.zoom||e.drag||e.pitch||e.rotate},Ci=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(e.Event);function wi(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var Ti=function(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zr(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),e.bindAll([`handleEvent`,`handleWindowEvent`],this);var i=this._el;this._listeners=[[i,`touchstart`,{passive:!0}],[i,`touchmove`,{passive:!1}],[i,`touchend`,void 0],[i,`touchcancel`,void 0],[i,`mousedown`,void 0],[i,`mousemove`,void 0],[i,`mouseup`,void 0],[e.window.document,`mousemove`,{capture:!0}],[e.window.document,`mouseup`,void 0],[i,`mouseover`,void 0],[i,`mouseout`,void 0],[i,`dblclick`,void 0],[i,`click`,void 0],[i,`keydown`,{capture:!1}],[i,`keyup`,void 0],[i,`wheel`,{passive:!1}],[i,`contextmenu`,void 0],[e.window,`blur`,void 0]];for(var a=0,o=this._listeners;a<o.length;a+=1){var s=o[a],c=s[0];n.addEventListener(c,s[1],c===e.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};Ti.prototype.destroy=function(){for(var t=0,r=this._listeners;t<r.length;t+=1){var i=r[t],a=i[0];n.removeEventListener(a,i[1],a===e.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},Ti.prototype._addDefaultHandlers=function(e){var t=this._map,n=t.getCanvasContainer();this._add(`mapEvent`,new Gr(t,e));var r=t.boxZoom=new qr(t,e);this._add(`boxZoom`,r);var i=new Zr,a=new _i;t.doubleClickZoom=new gi(a,i),this._add(`tapZoom`,i),this._add(`clickZoom`,a);var o=new vi;this._add(`tapDragZoom`,o);var s=t.touchPitch=new di;this._add(`touchPitch`,s);var c=new ti(e),l=new ni(e);t.dragRotate=new bi(e,c,l),this._add(`mouseRotate`,c,[`mousePitch`]),this._add(`mousePitch`,l,[`mouseRotate`]);var u=new ei(e),d=new ri(e);t.dragPan=new yi(n,u,d),this._add(`mousePan`,u),this._add(`touchPan`,d,[`touchZoom`,`touchRotate`]);var f=new li,p=new si;t.touchZoomRotate=new xi(n,p,f,o),this._add(`touchRotate`,f,[`touchPan`,`touchZoom`]),this._add(`touchZoom`,p,[`touchPan`,`touchRotate`]);var m=t.scrollZoom=new hi(t,this);this._add(`scrollZoom`,m,[`mousePan`]);var h=t.keyboard=new pi;this._add(`keyboard`,h),this._add(`blockableMapEvent`,new Kr(t));for(var g=0,_=[`boxZoom`,`doubleClickZoom`,`tapDragZoom`,`touchPitch`,`dragRotate`,`dragPan`,`touchZoomRotate`,`scrollZoom`,`keyboard`];g<_.length;g+=1){var v=_[g];e.interactive&&e[v]&&t[v].enable(e[v])}},Ti.prototype._add=function(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t},Ti.prototype.stop=function(e){if(!this._updatingCamera){for(var t=0,n=this._handlers;t<n.length;t+=1)n[t].handler.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}},Ti.prototype.isActive=function(){for(var e=0,t=this._handlers;e<t.length;e+=1)if(t[e].handler.isActive())return!0;return!1},Ti.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Ti.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Ti.prototype.isMoving=function(){return!!Si(this._eventsInProgress)||this.isZooming()},Ti.prototype._blockedByActive=function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1},Ti.prototype.handleWindowEvent=function(e){this.handleEvent(e,e.type+`Window`)},Ti.prototype._getMapTouches=function(e){for(var t=[],n=0,r=e;n<r.length;n+=1){var i=r[n];this._el.contains(i.target)&&t.push(i)}return t},Ti.prototype.handleEvent=function(e,t){this._updatingCamera=!0;for(var r=e.type===`renderFrame`?void 0:e,i={needsRenderFrame:!1},a={},o={},s=e.touches?this._getMapTouches(e.touches):void 0,c=s?n.touchPos(this._el,s):n.mousePos(this._el,e),l=0,u=this._handlers;l<u.length;l+=1){var d=u[l],f=d.handlerName,p=d.handler,m=d.allowed;if(p.isEnabled()){var h=void 0;this._blockedByActive(o,m,f)?p.reset():p[t||e.type]&&(h=p[t||e.type](e,c,s),this.mergeHandlerResult(i,a,h,f,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||p.isActive())&&(o[f]=p)}}var g={};for(var _ in this._previousActiveHandlers)o[_]||(g[_]=r);this._previousActiveHandlers=o,(Object.keys(g).length||wi(i))&&(this._changes.push([i,a,g]),this._triggerRenderFrame()),(Object.keys(o).length||wi(i))&&this._map._stop(!0),this._updatingCamera=!1;var v=i.cameraAnimation;v&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],v(this._map))},Ti.prototype.mergeHandlerResult=function(t,n,r,i,a){if(r){e.extend(t,r);var o={handlerName:i,originalEvent:r.originalEvent||a};r.zoomDelta!==void 0&&(n.zoom=o),r.panDelta!==void 0&&(n.drag=o),r.pitchDelta!==void 0&&(n.pitch=o),r.bearingDelta!==void 0&&(n.rotate=o)}},Ti.prototype._applyChanges=function(){for(var t={},n={},r={},i=0,a=this._changes;i<a.length;i+=1){var o=a[i],s=o[0],c=o[1],l=o[2];s.panDelta&&(t.panDelta=(t.panDelta||new e.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+s.pitchDelta),s.around!==void 0&&(t.around=s.around),s.pinchAround!==void 0&&(t.pinchAround=s.pinchAround),s.noInertia&&(t.noInertia=s.noInertia),e.extend(n,c),e.extend(r,l)}this._updateMapTransform(t,n,r),this._changes=[]},Ti.prototype._updateMapTransform=function(e,t,n){var r=this._map,i=r.transform;if(!wi(e))return this._fireEvents(t,n,!0);var a=e.panDelta,o=e.zoomDelta,s=e.bearingDelta,c=e.pitchDelta,l=e.around,u=e.pinchAround;u!==void 0&&(l=u),r._stop(!0),l||=r.transform.centerPoint;var d=i.pointLocation(a?l.sub(a):l);s&&(i.bearing+=s),c&&(i.pitch+=c),o&&(i.zoom+=o),i.setLocationAtPoint(d,l),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)},Ti.prototype._fireEvents=function(t,n,r){var i=this,a=Si(this._eventsInProgress),o=Si(t),s={};for(var c in t)this._eventsInProgress[c]||(s[c+`start`]=t[c].originalEvent),this._eventsInProgress[c]=t[c];for(var l in!a&&o&&this._fireEvent(`movestart`,o.originalEvent),s)this._fireEvent(l,s[l]);for(var u in o&&this._fireEvent(`move`,o.originalEvent),t)this._fireEvent(u,t[u].originalEvent);var d,f={};for(var p in this._eventsInProgress){var m=this._eventsInProgress[p],h=m.handlerName,g=m.originalEvent;this._handlersById[h].isActive()||(delete this._eventsInProgress[p],f[p+`end`]=d=n[h]||g)}for(var _ in f)this._fireEvent(_,f[_]);var v=Si(this._eventsInProgress);if(r&&(a||o)&&!v){this._updatingCamera=!0;var y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),b=function(e){return e!==0&&-i._bearingSnap<e&&e<i._bearingSnap};y?(b(y.bearing||this._map.getBearing())&&(y.bearing=0),this._map.easeTo(y,{originalEvent:d})):(this._map.fire(new e.Event(`moveend`,{originalEvent:d})),b(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Ti.prototype._fireEvent=function(t,n){this._map.fire(new e.Event(t,n?{originalEvent:n}:{}))},Ti.prototype._requestFrame=function(){var e=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(t){delete e._frameId,e.handleEvent(new Ci(`renderFrame`,{timeStamp:t})),e._applyChanges()}))},Ti.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ei=function(t){function n(n,r){t.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=r.bearingSnap,e.bindAll([`_renderFrameCallback`],this)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.getCenter=function(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(e,t){return this.jumpTo({center:e},t)},n.prototype.panBy=function(t,n,r){return t=e.Point.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},n),r)},n.prototype.panTo=function(t,n,r){return this.easeTo(e.extend({center:t},n),r)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(e,t){return this.jumpTo({zoom:e},t),this},n.prototype.zoomTo=function(t,n,r){return this.easeTo(e.extend({zoom:t},n),r)},n.prototype.zoomIn=function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this},n.prototype.zoomOut=function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(e,t){return this.jumpTo({bearing:e},t),this},n.prototype.getPadding=function(){return this.transform.padding},n.prototype.setPadding=function(e,t){return this.jumpTo({padding:e},t),this},n.prototype.rotateTo=function(t,n,r){return this.easeTo(e.extend({bearing:t},n),r)},n.prototype.resetNorth=function(t,n){return this.rotateTo(0,e.extend({duration:1e3},t),n),this},n.prototype.resetNorthPitch=function(t,n){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),n),this},n.prototype.snapToNorth=function(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(e,t){return this.jumpTo({pitch:e},t),this},n.prototype.cameraForBounds=function(t,n){t=e.LngLatBounds.convert(t);var r=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),r,n)},n.prototype._cameraForBoxAndBearing=function(t,n,r,i){var a={top:0,bottom:0,right:0,left:0};if(typeof(i=e.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding==`number`){var o=i.padding;i.padding={top:o,bottom:o,right:o,left:o}}i.padding=e.extend(a,i.padding);var s=this.transform,c=s.padding,l=s.project(e.LngLat.convert(t)),u=s.project(e.LngLat.convert(n)),d=l.rotate(-r*Math.PI/180),f=u.rotate(-r*Math.PI/180),p=new e.Point(Math.max(d.x,f.x),Math.max(d.y,f.y)),m=new e.Point(Math.min(d.x,f.x),Math.min(d.y,f.y)),h=p.sub(m),g=(s.width-(c.left+c.right+i.padding.left+i.padding.right))/h.x,_=(s.height-(c.top+c.bottom+i.padding.top+i.padding.bottom))/h.y;if(!(_<0||g<0)){var v=Math.min(s.scaleZoom(s.scale*Math.min(g,_)),i.maxZoom),y=typeof i.offset.x==`number`?new e.Point(i.offset.x,i.offset.y):e.Point.convert(i.offset),b=new e.Point((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(r*Math.PI/180),x=y.add(b).mult(s.scale/s.zoomScale(v));return{center:s.unproject(l.add(u).div(2).sub(x)),zoom:v,bearing:r}}e.warnOnce(`Map cannot fit within canvas with the given bounds, padding, and/or offset.`)},n.prototype.fitBounds=function(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)},n.prototype.fitScreenCoordinates=function(t,n,r,i,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.Point.convert(t)),this.transform.pointLocation(e.Point.convert(n)),r,i),i,a)},n.prototype._fitInternal=function(t,n,r){return t?(delete(n=e.extend(t,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this},n.prototype.jumpTo=function(t,n){this.stop();var r=this.transform,i=!1,a=!1,o=!1;return`zoom`in t&&r.zoom!==+t.zoom&&(i=!0,r.zoom=+t.zoom),t.center!==void 0&&(r.center=e.LngLat.convert(t.center)),`bearing`in t&&r.bearing!==+t.bearing&&(a=!0,r.bearing=+t.bearing),`pitch`in t&&r.pitch!==+t.pitch&&(o=!0,r.pitch=+t.pitch),t.padding==null||r.isPaddingEqual(t.padding)||(r.padding=t.padding),this.fire(new e.Event(`movestart`,n)).fire(new e.Event(`move`,n)),i&&this.fire(new e.Event(`zoomstart`,n)).fire(new e.Event(`zoom`,n)).fire(new e.Event(`zoomend`,n)),a&&this.fire(new e.Event(`rotatestart`,n)).fire(new e.Event(`rotate`,n)).fire(new e.Event(`rotateend`,n)),o&&this.fire(new e.Event(`pitchstart`,n)).fire(new e.Event(`pitch`,n)).fire(new e.Event(`pitchend`,n)),this.fire(new e.Event(`moveend`,n))},n.prototype.easeTo=function(t,n){var r=this;this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.browser.prefersReducedMotion)&&(t.duration=0);var i=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),c=this.getPadding(),l=`zoom`in t?+t.zoom:a,u=`bearing`in t?this._normalizeBearing(t.bearing,o):o,d=`pitch`in t?+t.pitch:s,f=`padding`in t?t.padding:i.padding,p=e.Point.convert(t.offset),m=i.centerPoint.add(p),h=i.pointLocation(m),g=e.LngLat.convert(t.center||h);this._normalizeCenter(g);var _,v,y=i.project(h),b=i.project(g).sub(y),x=i.zoomScale(l-a);t.around&&(_=e.LngLat.convert(t.around),v=i.locationPoint(_));var S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==a,this._rotating=this._rotating||o!==u,this._pitching=this._pitching||d!==s,this._padding=!i.isPaddingEqual(f),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,S),this._ease((function(t){if(r._zooming&&(i.zoom=e.number(a,l,t)),r._rotating&&(i.bearing=e.number(o,u,t)),r._pitching&&(i.pitch=e.number(s,d,t)),r._padding&&(i.interpolatePadding(c,f,t),m=i.centerPoint.add(p)),_)i.setLocationAtPoint(_,v);else{var h=i.zoomScale(i.zoom-a),g=(l>a?Math.min(2,x):Math.max(.5,x))**(1-t),S=i.unproject(y.add(b.mult(t*g)).mult(h));i.setLocationAtPoint(i.renderWorldCopies?S.wrap():S,m)}r._fireMoveEvents(n)}),(function(e){r._afterEase(n,e)}),t),this},n.prototype._prepareEase=function(t,n,r){r===void 0&&(r={}),this._moving=!0,n||r.moving||this.fire(new e.Event(`movestart`,t)),this._zooming&&!r.zooming&&this.fire(new e.Event(`zoomstart`,t)),this._rotating&&!r.rotating&&this.fire(new e.Event(`rotatestart`,t)),this._pitching&&!r.pitching&&this.fire(new e.Event(`pitchstart`,t))},n.prototype._fireMoveEvents=function(t){this.fire(new e.Event(`move`,t)),this._zooming&&this.fire(new e.Event(`zoom`,t)),this._rotating&&this.fire(new e.Event(`rotate`,t)),this._pitching&&this.fire(new e.Event(`pitch`,t))},n.prototype._afterEase=function(t,n){if(!this._easeId||!n||this._easeId!==n){delete this._easeId;var r=this._zooming,i=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.Event(`zoomend`,t)),i&&this.fire(new e.Event(`rotateend`,t)),a&&this.fire(new e.Event(`pitchend`,t)),this.fire(new e.Event(`moveend`,t))}},n.prototype.flyTo=function(t,n){var r=this;if(!t.essential&&e.browser.prefersReducedMotion){var i=e.pick(t,[`center`,`zoom`,`bearing`,`pitch`,`around`]);return this.jumpTo(i,n)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);var a=this.transform,o=this.getZoom(),s=this.getBearing(),c=this.getPitch(),l=this.getPadding(),u=`zoom`in t?e.clamp(+t.zoom,a.minZoom,a.maxZoom):o,d=`bearing`in t?this._normalizeBearing(t.bearing,s):s,f=`pitch`in t?+t.pitch:c,p=`padding`in t?t.padding:a.padding,m=a.zoomScale(u-o),h=e.Point.convert(t.offset),g=a.centerPoint.add(h),_=a.pointLocation(g),v=e.LngLat.convert(t.center||_);this._normalizeCenter(v);var y=a.project(_),b=a.project(v).sub(y),x=t.curve,S=Math.max(a.width,a.height),C=S/m,w=b.mag();if(`minZoom`in t){var E=e.clamp(Math.min(t.minZoom,o,u),a.minZoom,a.maxZoom),D=S/a.zoomScale(E-o);x=Math.sqrt(D/w*2)}var O=x*x;function k(e){var t=(C*C-S*S+(e?-1:1)*O*O*w*w)/(2*(e?C:S)*O*w);return Math.log(Math.sqrt(t*t+1)-t)}function A(e){return(Math.exp(e)-Math.exp(-e))/2}function j(e){return(Math.exp(e)+Math.exp(-e))/2}var M=k(0),N=function(e){return j(M)/j(M+x*e)},P=function(e){return S*((j(M)*(A(t=M+x*e)/j(t))-A(M))/O)/w;var t},F=(k(1)-M)/x;if(Math.abs(w)<1e-6||!isFinite(F)){if(Math.abs(S-C)<1e-6)return this.easeTo(t,n);var I=C<S?-1:1;F=Math.abs(Math.log(C/S))/x,P=function(){return 0},N=function(e){return Math.exp(I*x*e)}}return t.duration=`duration`in t?+t.duration:1e3*F/(`screenSpeed`in t?+t.screenSpeed/x:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=s!==d,this._pitching=f!==c,this._padding=!a.isPaddingEqual(p),this._prepareEase(n,!1),this._ease((function(t){var i=t*F,m=1/N(i);a.zoom=t===1?u:o+a.scaleZoom(m),r._rotating&&(a.bearing=e.number(s,d,t)),r._pitching&&(a.pitch=e.number(c,f,t)),r._padding&&(a.interpolatePadding(l,p,t),g=a.centerPoint.add(h));var _=t===1?v:a.unproject(y.add(b.mult(P(i))).mult(m));a.setLocationAtPoint(a.renderWorldCopies?_.wrap():_,g),r._fireMoveEvents(n)}),(function(){return r._afterEase(n)}),t),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){return this._stop()},n.prototype._stop=function(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,t)}if(!e){var r=this.handlers;r&&r.stop(!1)}return this},n.prototype._ease=function(t,n,r){!1===r.animate||r.duration===0?(t(1),n()):(this._easeStart=e.browser.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var t=Math.min((e.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(t,n){t=e.wrap(t,-180,180);var r=Math.abs(t-n);return Math.abs(t-360-n)<r&&(t-=360),Math.abs(t+360-n)<r&&(t+=360),t},n.prototype._normalizeCenter=function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}},n}(e.Evented),Di=function(t){t===void 0&&(t={}),this.options=t,e.bindAll([`_toggleAttribution`,`_updateEditLink`,`_updateData`,`_updateCompact`],this)};Di.prototype.getDefaultPosition=function(){return`bottom-right`},Di.prototype.onAdd=function(e){var t=this.options&&this.options.compact;return this._map=e,this._container=n.create(`div`,`mapboxgl-ctrl mapboxgl-ctrl-attrib`),this._compactButton=n.create(`button`,`mapboxgl-ctrl-attrib-button`,this._container),this._compactButton.addEventListener(`click`,this._toggleAttribution),this._setElementTitle(this._compactButton,`ToggleAttribution`),this._innerContainer=n.create(`div`,`mapboxgl-ctrl-attrib-inner`,this._container),this._innerContainer.setAttribute(`role`,`list`),t&&this._container.classList.add(`mapboxgl-compact`),this._updateAttributions(),this._updateEditLink(),this._map.on(`styledata`,this._updateData),this._map.on(`sourcedata`,this._updateData),this._map.on(`moveend`,this._updateEditLink),t===void 0&&(this._map.on(`resize`,this._updateCompact),this._updateCompact()),this._container},Di.prototype.onRemove=function(){n.remove(this._container),this._map.off(`styledata`,this._updateData),this._map.off(`sourcedata`,this._updateData),this._map.off(`moveend`,this._updateEditLink),this._map.off(`resize`,this._updateCompact),this._map=void 0,this._attribHTML=void 0},Di.prototype._setElementTitle=function(e,t){var n=this._map._getUIString(`AttributionControl.`+t);e.title=n,e.setAttribute(`aria-label`,n)},Di.prototype._toggleAttribution=function(){this._container.classList.contains(`mapboxgl-compact-show`)?(this._container.classList.remove(`mapboxgl-compact-show`),this._compactButton.setAttribute(`aria-pressed`,`false`)):(this._container.classList.add(`mapboxgl-compact-show`),this._compactButton.setAttribute(`aria-pressed`,`true`))},Di.prototype._updateEditLink=function(){var t=this._editLink;t||=this._editLink=this._container.querySelector(`.mapbox-improve-map`);var n=[{key:`owner`,value:this.styleOwner},{key:`id`,value:this.styleId},{key:`access_token`,value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){var r=n.reduce((function(e,t,r){return t.value&&(e+=t.key+`=`+t.value+(r<n.length-1?`&`:``)),e}),`?`);t.href=e.config.FEEDBACK_URL+`/`+r+(this._map._hash?this._map._hash.getHashString(!0):``),t.rel=`noopener nofollow`,this._setElementTitle(t,`MapFeedback`)}},Di.prototype._updateData=function(e){!e||e.sourceDataType!==`metadata`&&e.sourceDataType!==`visibility`&&e.dataType!==`style`||(this._updateAttributions(),this._updateEditLink())},Di.prototype._updateAttributions=function(){if(this._map.style){var e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((function(e){return typeof e==`string`?e:``}))):typeof this.options.customAttribution==`string`&&e.push(this.options.customAttribution)),this._map.style.stylesheet){var t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}var n=this._map.style.sourceCaches;for(var r in n){var i=n[r];if(i.used){var a=i.getSource();a.attribution&&e.indexOf(a.attribution)<0&&e.push(a.attribution)}}e.sort((function(e,t){return e.length-t.length}));var o=(e=e.filter((function(t,n){for(var r=n+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0}))).join(` | `);o!==this._attribHTML&&(this._attribHTML=o,e.length?(this._innerContainer.innerHTML=o,this._container.classList.remove(`mapboxgl-attrib-empty`)):this._container.classList.add(`mapboxgl-attrib-empty`),this._editLink=null)}},Di.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add(`mapboxgl-compact`):this._container.classList.remove(`mapboxgl-compact`,`mapboxgl-compact-show`)};var Oi=function(){e.bindAll([`_updateLogo`],this),e.bindAll([`_updateCompact`],this)};Oi.prototype.onAdd=function(e){this._map=e,this._container=n.create(`div`,`mapboxgl-ctrl`);var t=n.create(`a`,`mapboxgl-ctrl-logo`);return t.target=`_blank`,t.rel=`noopener nofollow`,t.href=`https://www.mapbox.com/`,t.setAttribute(`aria-label`,this._map._getUIString(`LogoControl.Title`)),t.setAttribute(`rel`,`noopener nofollow`),this._container.appendChild(t),this._container.style.display=`none`,this._map.on(`sourcedata`,this._updateLogo),this._updateLogo(),this._map.on(`resize`,this._updateCompact),this._updateCompact(),this._container},Oi.prototype.onRemove=function(){n.remove(this._container),this._map.off(`sourcedata`,this._updateLogo),this._map.off(`resize`,this._updateCompact)},Oi.prototype.getDefaultPosition=function(){return`bottom-left`},Oi.prototype._updateLogo=function(e){e&&e.sourceDataType!==`metadata`||(this._container.style.display=this._logoRequired()?`block`:`none`)},Oi.prototype._logoRequired=function(){if(this._map.style){var e=this._map.style.sourceCaches;for(var t in e)if(e[t].getSource().mapbox_logo)return!0;return!1}},Oi.prototype._updateCompact=function(){var e=this._container.children;if(e.length){var t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add(`mapboxgl-compact`):t.classList.remove(`mapboxgl-compact`)}};var ki=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ki.prototype.add=function(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t},ki.prototype.remove=function(e){for(var t=this._currentlyRunning,n=0,r=t?this._queue.concat(t):this._queue;n<r.length;n+=1){var i=r[n];if(i.id===e)return void(i.cancelled=!0)}},ki.prototype.run=function(e){e===void 0&&(e=0);var t=this._currentlyRunning=this._queue;this._queue=[];for(var n=0,r=t;n<r.length;n+=1){var i=r[n];if(!i.cancelled&&(i.callback(e),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ki.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ai={"AttributionControl.ToggleAttribution":`Toggle attribution`,"AttributionControl.MapFeedback":`Map feedback`,"FullscreenControl.Enter":`Enter fullscreen`,"FullscreenControl.Exit":`Exit fullscreen`,"GeolocateControl.FindMyLocation":`Find my location`,"GeolocateControl.LocationNotAvailable":`Location not available`,"LogoControl.Title":`Mapbox logo`,"NavigationControl.ResetBearing":`Reset bearing to north`,"NavigationControl.ZoomIn":`Zoom in`,"NavigationControl.ZoomOut":`Zoom out`,"ScaleControl.Feet":`ft`,"ScaleControl.Meters":`m`,"ScaleControl.Kilometers":`km`,"ScaleControl.Miles":`mi`,"ScaleControl.NauticalMiles":`nm`},ji=e.window.HTMLImageElement,Mi=e.window.HTMLElement,Ni=e.window.ImageBitmap,Pi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:`sans-serif`,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Fi=function(r){function i(t){var n=this;if((t=e.extend({},Pi,t)).minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw Error(`maxZoom must be greater than or equal to minZoom`);if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw Error(`maxPitch must be greater than or equal to minPitch`);if(t.minPitch!=null&&t.minPitch<0)throw Error(`minPitch must be greater than or equal to 0`);if(t.maxPitch!=null&&t.maxPitch>60)throw Error(`maxPitch must be less than or equal to 60`);var i=new jr(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies);if(r.call(this,i,t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new ki,this._controls=[],this._mapId=e.uniqueId(),this._locale=e.extend({},Ai,t.locale),this._clickTolerance=t.clickTolerance,this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken),typeof t.container==`string`){if(this._container=e.window.document.getElementById(t.container),!this._container)throw Error(`Container '`+t.container+`' not found.`)}else{if(!(t.container instanceof Mi))throw Error(`Invalid type: 'container' must be a String or HTMLElement.`);this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll([`_onWindowOnline`,`_onWindowResize`,`_onMapScroll`,`_contextLost`,`_contextRestored`],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw Error(`Failed to initialize WebGL.`);this.on(`move`,(function(){return n._update(!1)})),this.on(`moveend`,(function(){return n._update(!1)})),this.on(`zoom`,(function(){return n._update(!0)})),e.window!==void 0&&(e.window.addEventListener(`online`,this._onWindowOnline,!1),e.window.addEventListener(`resize`,this._onWindowResize,!1),e.window.addEventListener(`orientationchange`,this._onWindowResize,!1)),this.handlers=new Ti(this,t),this._hash=t.hash&&new Nr(typeof t.hash==`string`&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new Di({customAttribution:t.customAttribution})),this.addControl(new Oi,t.logoPosition),this.on(`style.load`,(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),this.on(`data`,(function(t){n._update(t.dataType===`style`),n.fire(new e.Event(t.dataType+`data`,t))})),this.on(`dataloading`,(function(t){n.fire(new e.Event(t.dataType+`dataloading`,t))}))}r&&(i.__proto__=r),(i.prototype=Object.create(r&&r.prototype)).constructor=i;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(t,n){if(n===void 0&&(n=t.getDefaultPosition?t.getDefaultPosition():`top-right`),!t||!t.onAdd)return this.fire(new e.ErrorEvent(Error(`Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.`)));var r=t.onAdd(this);this._controls.push(t);var i=this._controlPositions[n];return n.indexOf(`bottom`)===-1?i.appendChild(r):i.insertBefore(r,i.firstChild),this},i.prototype.removeControl=function(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(Error(`Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.`)));var n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this},i.prototype.hasControl=function(e){return this._controls.indexOf(e)>-1},i.prototype.resize=function(t){var n=this._containerDimensions(),r=n[0],i=n[1];if(r===this.transform.width&&i===this.transform.height)return this;this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i);var a=!this._moving;return a&&this.fire(new e.Event(`movestart`,t)).fire(new e.Event(`move`,t)),this.fire(new e.Event(`resize`,t)),a&&this.fire(new e.Event(`moveend`,t)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()},i.prototype.setMinZoom=function(e){if((e??=-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw Error(`minZoom must be between -2 and the current maxZoom, inclusive`)},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(e){if((e??=22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw Error(`maxZoom must be greater than the current minZoom`)},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.setMinPitch=function(e){if((e??=0)<0)throw Error(`minPitch must be greater than or equal to 0`);if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw Error(`minPitch must be between 0 and the current maxPitch, inclusive`)},i.prototype.getMinPitch=function(){return this.transform.minPitch},i.prototype.setMaxPitch=function(e){if((e??=60)>60)throw Error(`maxPitch must be less than or equal to 60`);if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw Error(`maxPitch must be greater than the current minPitch`)},i.prototype.getMaxPitch=function(){return this.transform.maxPitch},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(e){return this.transform.renderWorldCopies=e,this._update()},i.prototype.project=function(t){return this.transform.locationPoint(e.LngLat.convert(t))},i.prototype.unproject=function(t){return this.transform.pointLocation(e.Point.convert(t))},i.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},i.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},i.prototype._createDelegatedListener=function(e,t,n){var r,i=this;if(e===`mouseenter`||e===`mouseover`){var a=!1;return{layer:t,listener:n,delegates:{mousemove:function(r){var o=i.getLayer(t)?i.queryRenderedFeatures(r.point,{layers:[t]}):[];o.length?a||(a=!0,n.call(i,new Hr(e,i,r.originalEvent,{features:o}))):a=!1},mouseout:function(){a=!1}}}}if(e===`mouseleave`||e===`mouseout`){var o=!1;return{layer:t,listener:n,delegates:{mousemove:function(r){(i.getLayer(t)?i.queryRenderedFeatures(r.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,n.call(i,new Hr(e,i,r.originalEvent)))},mouseout:function(t){o&&(o=!1,n.call(i,new Hr(e,i,t.originalEvent)))}}}}return{layer:t,listener:n,delegates:(r={},r[e]=function(e){var r=i.getLayer(t)?i.queryRenderedFeatures(e.point,{layers:[t]}):[];r.length&&(e.features=r,n.call(i,e),delete e.features)},r)}},i.prototype.on=function(e,t,n){if(n===void 0)return r.prototype.on.call(this,e,t);var i=this._createDelegatedListener(e,t,n);for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i),i.delegates)this.on(a,i.delegates[a]);return this},i.prototype.once=function(e,t,n){if(n===void 0)return r.prototype.once.call(this,e,t);var i=this._createDelegatedListener(e,t,n);for(var a in i.delegates)this.once(a,i.delegates[a]);return this},i.prototype.off=function(e,t,n){var i=this;return n===void 0?r.prototype.off.call(this,e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&function(r){for(var a=r[e],o=0;o<a.length;o++){var s=a[o];if(s.layer===t&&s.listener===n){for(var c in s.delegates)i.off(c,s.delegates[c]);return a.splice(o,1),i}}}(this._delegatedListeners),this)},i.prototype.queryRenderedFeatures=function(t,n){if(!this.style)return[];var r;if(n!==void 0||t===void 0||t instanceof e.Point||Array.isArray(t)||(n=t,t=void 0),n||={},(t||=[[0,0],[this.transform.width,this.transform.height]])instanceof e.Point||typeof t[0]==`number`)r=[e.Point.convert(t)];else{var i=e.Point.convert(t[0]),a=e.Point.convert(t[1]);r=[i,new e.Point(a.x,i.y),a,new e.Point(i.x,a.y),i]}return this.style.queryRenderedFeatures(r,n,this.transform)},i.prototype.querySourceFeatures=function(e,t){return this.style.querySourceFeatures(e,t)},i.prototype.setStyle=function(t,n){return!1!==(n=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(t,n))},i.prototype._getUIString=function(e){var t=this._locale[e];if(t==null)throw Error(`Missing UI string '`+e+`'`);return t},i.prototype._updateStyle=function(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),e?(this.style=new Zt(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof e==`string`?this.style.loadURL(e):this.style.loadJSON(e),this):(delete this.style,this)},i.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Zt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},i.prototype._diffStyle=function(t,n){var r=this;if(typeof t==`string`){var i=this._requestManager.normalizeStyleURL(t),a=this._requestManager.transformRequest(i,e.ResourceType.Style);e.getJSON(a,(function(t,i){t?r.fire(new e.ErrorEvent(t)):i&&r._updateDiff(i,n)}))}else typeof t==`object`&&this._updateDiff(t,n)},i.prototype._updateDiff=function(t,n){try{this.style.setState(t)&&this._update(!0)}catch(r){e.warnOnce(`Unable to perform style diff: `+(r.message||r.error||r)+`.  Rebuilding the style from scratch.`),this._updateStyle(t,n)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():e.warnOnce(`There is no style added to the map.`)},i.prototype.addSource=function(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)},i.prototype.isSourceLoaded=function(t){var n=this.style&&this.style.sourceCaches[t];if(n!==void 0)return n.loaded();this.fire(new e.ErrorEvent(Error(`There is no source with ID '`+t+`'`)))},i.prototype.areTilesLoaded=function(){var e=this.style&&this.style.sourceCaches;for(var t in e){var n=e[t]._tiles;for(var r in n){var i=n[r];if(i.state!==`loaded`&&i.state!==`errored`)return!1}}return!0},i.prototype.addSourceType=function(e,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)},i.prototype.removeSource=function(e){return this.style.removeSource(e),this._update(!0)},i.prototype.getSource=function(e){return this.style.getSource(e)},i.prototype.addImage=function(t,n,r){r===void 0&&(r={});var i=r.pixelRatio;i===void 0&&(i=1);var a=r.sdf;a===void 0&&(a=!1);var o=r.stretchX,s=r.stretchY,c=r.content;if(this._lazyInitEmptyStyle(),n instanceof ji||Ni&&n instanceof Ni){var l=e.browser.getImageData(n);this.style.addImage(t,{data:new e.RGBAImage({width:l.width,height:l.height},l.data),pixelRatio:i,stretchX:o,stretchY:s,content:c,sdf:a,version:0})}else{if(n.width===void 0||n.height===void 0)return this.fire(new e.ErrorEvent(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var u=n;this.style.addImage(t,{data:new e.RGBAImage({width:n.width,height:n.height},new Uint8Array(n.data)),pixelRatio:i,stretchX:o,stretchY:s,content:c,sdf:a,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}},i.prototype.updateImage=function(t,n){var r=this.style.getImage(t);if(!r)return this.fire(new e.ErrorEvent(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=n instanceof ji||Ni&&n instanceof Ni?e.browser.getImageData(n):n,a=i.width,o=i.height,s=i.data;return a===void 0||o===void 0?this.fire(new e.ErrorEvent(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):a!==r.data.width||o!==r.data.height?this.fire(new e.ErrorEvent(Error(`The width and height of the updated image must be that same as the previous version of the image`))):(r.data.replace(s,!(n instanceof ji||Ni&&n instanceof Ni)),void this.style.updateImage(t,r))},i.prototype.hasImage=function(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(Error(`Missing required image id`))),!1)},i.prototype.removeImage=function(e){this.style.removeImage(e)},i.prototype.loadImage=function(t,n){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),n)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)},i.prototype.moveLayer=function(e,t){return this.style.moveLayer(e,t),this._update(!0)},i.prototype.removeLayer=function(e){return this.style.removeLayer(e),this._update(!0)},i.prototype.getLayer=function(e){return this.style.getLayer(e)},i.prototype.setLayerZoomRange=function(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)},i.prototype.setFilter=function(e,t,n){return n===void 0&&(n={}),this.style.setFilter(e,t,n),this._update(!0)},i.prototype.getFilter=function(e){return this.style.getFilter(e)},i.prototype.setPaintProperty=function(e,t,n,r){return r===void 0&&(r={}),this.style.setPaintProperty(e,t,n,r),this._update(!0)},i.prototype.getPaintProperty=function(e,t){return this.style.getPaintProperty(e,t)},i.prototype.setLayoutProperty=function(e,t,n,r){return r===void 0&&(r={}),this.style.setLayoutProperty(e,t,n,r),this._update(!0)},i.prototype.getLayoutProperty=function(e,t){return this.style.getLayoutProperty(e,t)},i.prototype.setLight=function(e,t){return t===void 0&&(t={}),this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(e,t){return this.style.setFeatureState(e,t),this._update()},i.prototype.removeFeatureState=function(e,t){return this.style.removeFeatureState(e,t),this._update()},i.prototype.getFeatureState=function(e){return this.style.getFeatureState(e)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]},i.prototype._detectMissingCSS=function(){e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue(`background-color`)!==`rgb(250, 128, 114)`&&e.warnOnce(`This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.`)},i.prototype._setupContainer=function(){var e=this._container;e.classList.add(`mapboxgl-map`),(this._missingCSSCanary=n.create(`div`,`mapboxgl-canary`,e)).style.visibility=`hidden`,this._detectMissingCSS();var t=this._canvasContainer=n.create(`div`,`mapboxgl-canvas-container`,e);this._interactive&&t.classList.add(`mapboxgl-interactive`),this._canvas=n.create(`canvas`,`mapboxgl-canvas`,t),this._canvas.addEventListener(`webglcontextlost`,this._contextLost,!1),this._canvas.addEventListener(`webglcontextrestored`,this._contextRestored,!1),this._canvas.setAttribute(`tabindex`,`0`),this._canvas.setAttribute(`aria-label`,`Map`),this._canvas.setAttribute(`role`,`region`);var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var i=this._controlContainer=n.create(`div`,`mapboxgl-control-container`,e),a=this._controlPositions={};[`top-left`,`top-right`,`bottom-left`,`bottom-right`].forEach((function(e){a[e]=n.create(`div`,`mapboxgl-ctrl-`+e,i)})),this._container.addEventListener(`scroll`,this._onMapScroll,!1)},i.prototype._resizeCanvas=function(t,n){var r=e.browser.devicePixelRatio||1;this._canvas.width=r*t,this._canvas.height=r*n,this._canvas.style.width=t+`px`,this._canvas.style.height=n+`px`},i.prototype._setupPainter=function(){var n=e.extend({},t.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext(`webgl`,n)||this._canvas.getContext(`experimental-webgl`,n);r?(this.painter=new Dr(r,this.transform),e.webpSupported.testSupport(r)):this.fire(new e.ErrorEvent(Error(`Failed to initialize WebGL`)))},i.prototype._contextLost=function(t){t.preventDefault(),this._frame&&=(this._frame.cancel(),null),this.fire(new e.Event(`webglcontextlost`,{originalEvent:t}))},i.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event(`webglcontextrestored`,{originalEvent:t}))},i.prototype._onMapScroll=function(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(e){return this._update(),this._renderTaskQueue.add(e)},i.prototype._cancelRenderFrame=function(e){this._renderTaskQueue.remove(e)},i.prototype._render=function(t){var n,r=this,i=0,a=this.painter.context.extTimerQuery;if(this.listens(`gpu-timing-frame`)&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n),i=e.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),!this._removed){var o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,c=e.browser.now();this.style.zoomHistory.update(s,c);var l=new e.EvaluationParameters(s,{now:c,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),u=l.crossFadingFactor();u===1&&u===this._crossFadingFactor||(o=!0,this._crossFadingFactor=u),this.style.update(l)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens(`gpu-timing-layer`)}),this.fire(new e.Event(`render`)),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event(`load`))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens(`gpu-timing-frame`)){var d=e.browser.now()-i;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout((function(){var t=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),r.fire(new e.Event(`gpu-timing-frame`,{cpuTime:d,gpuTime:t}))}),50)}if(this.listens(`gpu-timing-layer`)){var f=this.painter.collectGpuTimers();setTimeout((function(){var t=r.painter.queryGpuTimers(f);r.fire(new e.Event(`gpu-timing-layer`,{layerTimes:t}))}),50)}var p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.Event(`idle`)),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0),this}},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var t=0,n=this._controls;t<n.length;t+=1)n[t].onRemove(this);this._controls=[],this._frame&&=(this._frame.cancel(),null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),e.window!==void 0&&(e.window.removeEventListener(`resize`,this._onWindowResize,!1),e.window.removeEventListener(`orientationchange`,this._onWindowResize,!1),e.window.removeEventListener(`online`,this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension(`WEBGL_lose_context`);r&&r.loseContext(),Ii(this._canvasContainer),Ii(this._controlContainer),Ii(this._missingCSSCanary),this._container.classList.remove(`mapboxgl-map`),this._removed=!0,this.fire(new e.Event(`remove`))},i.prototype.triggerRepaint=function(){var t=this;this.style&&!this._frame&&(this._frame=e.browser.frame((function(e){t._frame=null,t._render(e)})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(e){this._trackResize&&this.resize({originalEvent:e})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(e){this._showPadding!==e&&(this._showPadding=e,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(e){this._vertices=e,this._update()},i.prototype._setCacheLimits=function(t,n){e.setCacheLimits(t,n)},a.version.get=function(){return e.version},Object.defineProperties(i.prototype,a),i}(Ei);function Ii(e){e.parentNode&&e.parentNode.removeChild(e)}var Li={showCompass:!0,showZoom:!0,visualizePitch:!1},Ri=function(t){var r=this;this.options=e.extend({},Li,t),this._container=n.create(`div`,`mapboxgl-ctrl mapboxgl-ctrl-group`),this._container.addEventListener(`contextmenu`,(function(e){return e.preventDefault()})),this.options.showZoom&&(e.bindAll([`_setButtonTitle`,`_updateZoomButtons`],this),this._zoomInButton=this._createButton(`mapboxgl-ctrl-zoom-in`,(function(e){return r._map.zoomIn({},{originalEvent:e})})),n.create(`span`,`mapboxgl-ctrl-icon`,this._zoomInButton).setAttribute(`aria-hidden`,!0),this._zoomOutButton=this._createButton(`mapboxgl-ctrl-zoom-out`,(function(e){return r._map.zoomOut({},{originalEvent:e})})),n.create(`span`,`mapboxgl-ctrl-icon`,this._zoomOutButton).setAttribute(`aria-hidden`,!0)),this.options.showCompass&&(e.bindAll([`_rotateCompassArrow`],this),this._compass=this._createButton(`mapboxgl-ctrl-compass`,(function(e){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:e}):r._map.resetNorth({},{originalEvent:e})})),this._compassIcon=n.create(`span`,`mapboxgl-ctrl-icon`,this._compass),this._compassIcon.setAttribute(`aria-hidden`,!0))};Ri.prototype._updateZoomButtons=function(){var e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute(`aria-disabled`,t.toString()),this._zoomOutButton.setAttribute(`aria-disabled`,n.toString())},Ri.prototype._rotateCompassArrow=function(){var e=this.options.visualizePitch?`scale(`+1/Math.cos(this._map.transform.pitch*(Math.PI/180))**.5+`) rotateX(`+this._map.transform.pitch+`deg) rotateZ(`+this._map.transform.angle*(180/Math.PI)+`deg)`:`rotate(`+this._map.transform.angle*(180/Math.PI)+`deg)`;this._compassIcon.style.transform=e},Ri.prototype.onAdd=function(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,`ZoomIn`),this._setButtonTitle(this._zoomOutButton,`ZoomOut`),this._map.on(`zoom`,this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,`ResetBearing`),this.options.visualizePitch&&this._map.on(`pitch`,this._rotateCompassArrow),this._map.on(`rotate`,this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zi(this._map,this._compass,this.options.visualizePitch)),this._container},Ri.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off(`zoom`,this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off(`pitch`,this._rotateCompassArrow),this._map.off(`rotate`,this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ri.prototype._createButton=function(e,t){var r=n.create(`button`,e,this._container);return r.type=`button`,r.addEventListener(`click`,t),r},Ri.prototype._setButtonTitle=function(e,t){var n=this._map._getUIString(`NavigationControl.`+t);e.title=n,e.setAttribute(`aria-label`,n)};var zi=function(t,r,i){i===void 0&&(i=!1),this._clickTolerance=10,this.element=r,this.mouseRotate=new ti({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new ni({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll([`mousedown`,`mousemove`,`mouseup`,`touchstart`,`touchmove`,`touchend`,`reset`],this),n.addEventListener(r,`mousedown`,this.mousedown),n.addEventListener(r,`touchstart`,this.touchstart,{passive:!1}),n.addEventListener(r,`touchmove`,this.touchmove),n.addEventListener(r,`touchend`,this.touchend),n.addEventListener(r,`touchcancel`,this.reset)};function Bi(t,n,r){if(t=new e.LngLat(t.lng,t.lat),n){var i=new e.LngLat(t.lng-360,t.lat),a=new e.LngLat(t.lng+360,t.lat),o=r.locationPoint(t).distSqr(n);r.locationPoint(i).distSqr(n)<o?t=i:r.locationPoint(a).distSqr(n)<o&&(t=a)}for(;Math.abs(t.lng-r.center.lng)>180;){var s=r.locationPoint(t);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}zi.prototype.down=function(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),n.disableDrag()},zi.prototype.move=function(e,t){var n=this.map,r=this.mouseRotate.mousemoveWindow(e,t);if(r&&r.bearingDelta&&n.setBearing(n.getBearing()+r.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(e,t);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}},zi.prototype.off=function(){var e=this.element;n.removeEventListener(e,`mousedown`,this.mousedown),n.removeEventListener(e,`touchstart`,this.touchstart,{passive:!1}),n.removeEventListener(e,`touchmove`,this.touchmove),n.removeEventListener(e,`touchend`,this.touchend),n.removeEventListener(e,`touchcancel`,this.reset),this.offTemp()},zi.prototype.offTemp=function(){n.enableDrag(),n.removeEventListener(e.window,`mousemove`,this.mousemove),n.removeEventListener(e.window,`mouseup`,this.mouseup)},zi.prototype.mousedown=function(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:function(){return t.preventDefault()}}),n.mousePos(this.element,t)),n.addEventListener(e.window,`mousemove`,this.mousemove),n.addEventListener(e.window,`mouseup`,this.mouseup)},zi.prototype.mousemove=function(e){this.move(e,n.mousePos(this.element,e))},zi.prototype.mouseup=function(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()},zi.prototype.touchstart=function(e){e.targetTouches.length===1?(this._startPos=this._lastPos=n.touchPos(this.element,e.targetTouches)[0],this.down({type:`mousedown`,button:0,ctrlKey:!0,preventDefault:function(){return e.preventDefault()}},this._startPos)):this.reset()},zi.prototype.touchmove=function(e){e.targetTouches.length===1?(this._lastPos=n.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:function(){return e.preventDefault()}},this._lastPos)):this.reset()},zi.prototype.touchend=function(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},zi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Vi={center:`translate(-50%,-50%)`,top:`translate(-50%,0)`,"top-left":`translate(0,0)`,"top-right":`translate(-100%,0)`,bottom:`translate(-50%,-100%)`,"bottom-left":`translate(0,-100%)`,"bottom-right":`translate(-100%,-100%)`,left:`translate(0,-50%)`,right:`translate(-100%,-50%)`};function Hi(e,t,n){var r=e.classList;for(var i in Vi)r.remove(`mapboxgl-`+n+`-anchor-`+i);r.add(`mapboxgl-`+n+`-anchor-`+t)}var Ui,Wi=function(t){function r(r,i){if(t.call(this),(r instanceof e.window.HTMLElement||i)&&(r=e.extend({element:r},i)),e.bindAll([`_update`,`_onMove`,`_onUp`,`_addDragHandler`,`_onMapClick`,`_onKeyPress`],this),this._anchor=r&&r.anchor||`center`,this._color=r&&r.color||`#3FB1CE`,this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state=`inactive`,this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||`auto`,this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!==`auto`?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=e.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create(`div`),this._element.setAttribute(`aria-label`,`Map marker`);var a=n.createNS(`http://www.w3.org/2000/svg`,`svg`);a.setAttributeNS(null,`display`,`block`),a.setAttributeNS(null,`height`,`41px`),a.setAttributeNS(null,`width`,`27px`),a.setAttributeNS(null,`viewBox`,`0 0 27 41`);var o=n.createNS(`http://www.w3.org/2000/svg`,`g`);o.setAttributeNS(null,`stroke`,`none`),o.setAttributeNS(null,`stroke-width`,`1`),o.setAttributeNS(null,`fill`,`none`),o.setAttributeNS(null,`fill-rule`,`evenodd`);var s=n.createNS(`http://www.w3.org/2000/svg`,`g`);s.setAttributeNS(null,`fill-rule`,`nonzero`);var c=n.createNS(`http://www.w3.org/2000/svg`,`g`);c.setAttributeNS(null,`transform`,`translate(3.0, 29.0)`),c.setAttributeNS(null,`fill`,`#000000`);for(var l=0,u=[{rx:`10.5`,ry:`5.25002273`},{rx:`10.5`,ry:`5.25002273`},{rx:`9.5`,ry:`4.77275007`},{rx:`8.5`,ry:`4.29549936`},{rx:`7.5`,ry:`3.81822308`},{rx:`6.5`,ry:`3.34094679`},{rx:`5.5`,ry:`2.86367051`},{rx:`4.5`,ry:`2.38636864`}];l<u.length;l+=1){var d=u[l],f=n.createNS(`http://www.w3.org/2000/svg`,`ellipse`);f.setAttributeNS(null,`opacity`,`0.04`),f.setAttributeNS(null,`cx`,`10.5`),f.setAttributeNS(null,`cy`,`5.80029008`),f.setAttributeNS(null,`rx`,d.rx),f.setAttributeNS(null,`ry`,d.ry),c.appendChild(f)}var p=n.createNS(`http://www.w3.org/2000/svg`,`g`);p.setAttributeNS(null,`fill`,this._color);var m=n.createNS(`http://www.w3.org/2000/svg`,`path`);m.setAttributeNS(null,`d`,`M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z`),p.appendChild(m);var h=n.createNS(`http://www.w3.org/2000/svg`,`g`);h.setAttributeNS(null,`opacity`,`0.25`),h.setAttributeNS(null,`fill`,`#000000`);var g=n.createNS(`http://www.w3.org/2000/svg`,`path`);g.setAttributeNS(null,`d`,`M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z`),h.appendChild(g);var _=n.createNS(`http://www.w3.org/2000/svg`,`g`);_.setAttributeNS(null,`transform`,`translate(6.0, 7.0)`),_.setAttributeNS(null,`fill`,`#FFFFFF`);var v=n.createNS(`http://www.w3.org/2000/svg`,`g`);v.setAttributeNS(null,`transform`,`translate(8.0, 8.0)`);var y=n.createNS(`http://www.w3.org/2000/svg`,`circle`);y.setAttributeNS(null,`fill`,`#000000`),y.setAttributeNS(null,`opacity`,`0.25`),y.setAttributeNS(null,`cx`,`5.5`),y.setAttributeNS(null,`cy`,`5.5`),y.setAttributeNS(null,`r`,`5.4999962`);var b=n.createNS(`http://www.w3.org/2000/svg`,`circle`);b.setAttributeNS(null,`fill`,`#FFFFFF`),b.setAttributeNS(null,`cx`,`5.5`),b.setAttributeNS(null,`cy`,`5.5`),b.setAttributeNS(null,`r`,`5.4999962`),v.appendChild(y),v.appendChild(b),s.appendChild(c),s.appendChild(p),s.appendChild(h),s.appendChild(_),s.appendChild(v),a.appendChild(s),a.setAttributeNS(null,`height`,41*this._scale+`px`),a.setAttributeNS(null,`width`,27*this._scale+`px`),this._element.appendChild(a),this._offset=e.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add(`mapboxgl-marker`),this._element.addEventListener(`dragstart`,(function(e){e.preventDefault()})),this._element.addEventListener(`mousedown`,(function(e){e.preventDefault()})),Hi(this._element,this._anchor,`marker`),this._popup=null}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.addTo=function(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on(`move`,this._update),e.on(`moveend`,this._update),this.setDraggable(this._draggable),this._update(),this._map.on(`click`,this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off(`click`,this._onMapClick),this._map.off(`move`,this._update),this._map.off(`moveend`,this._update),this._map.off(`mousedown`,this._addDragHandler),this._map.off(`touchstart`,this._addDragHandler),this._map.off(`mouseup`,this._onUp),this._map.off(`touchend`,this._onUp),this._map.off(`mousemove`,this._onMove),this._map.off(`touchmove`,this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener(`keypress`,this._onKeyPress),this._originalTabIndex||this._element.removeAttribute(`tabindex`)),e){if(!(`offset`in e.options)){var t=Math.sqrt(13.5**2/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[t,-1*(24.6+t)],"bottom-right":[-t,-1*(24.6+t)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute(`tabindex`),this._originalTabIndex||this._element.setAttribute(`tabindex`,`0`),this._element.addEventListener(`keypress`,this._onKeyPress)}return this},r.prototype._onKeyPress=function(e){var t=e.code,n=e.charCode||e.keyCode;t!==`Space`&&t!==`Enter`&&n!==32&&n!==13||this.togglePopup()},r.prototype._onMapClick=function(e){var t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var e=this._popup;return e&&(e.isOpen()?e.remove():e.addTo(this._map)),this},r.prototype._update=function(e){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Bi(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var t=``;this._rotationAlignment===`viewport`||this._rotationAlignment===`auto`?t=`rotateZ(`+this._rotation+`deg)`:this._rotationAlignment===`map`&&(t=`rotateZ(`+(this._rotation-this._map.getBearing())+`deg)`);var r=``;this._pitchAlignment===`viewport`||this._pitchAlignment===`auto`?r=`rotateX(0deg)`:this._pitchAlignment===`map`&&(r=`rotateX(`+this._map.getPitch()+`deg)`),e&&e.type!==`moveend`||(this._pos=this._pos.round()),n.setTransform(this._element,Vi[this._anchor]+` translate(`+this._pos.x+`px, `+this._pos.y+`px) `+r+` `+t)}},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(t){return this._offset=e.Point.convert(t),this._update(),this},r.prototype._onMove=function(t){if(!this._isDragging){var n=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents=`none`,this._state===`pending`&&(this._state=`active`,this.fire(new e.Event(`dragstart`))),this.fire(new e.Event(`drag`)))},r.prototype._onUp=function(){this._element.style.pointerEvents=`auto`,this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off(`mousemove`,this._onMove),this._map.off(`touchmove`,this._onMove),this._state===`active`&&this.fire(new e.Event(`dragend`)),this._state=`inactive`},r.prototype._addDragHandler=function(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state=`pending`,this._map.on(`mousemove`,this._onMove),this._map.on(`touchmove`,this._onMove),this._map.once(`mouseup`,this._onUp),this._map.once(`touchend`,this._onUp))},r.prototype.setDraggable=function(e){return this._draggable=!!e,this._map&&(e?(this._map.on(`mousedown`,this._addDragHandler),this._map.on(`touchstart`,this._addDragHandler)):(this._map.off(`mousedown`,this._addDragHandler),this._map.off(`touchstart`,this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r.prototype.setRotation=function(e){return this._rotation=e||0,this._update(),this},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotationAlignment=function(e){return this._rotationAlignment=e||`auto`,this._update(),this},r.prototype.getRotationAlignment=function(){return this._rotationAlignment},r.prototype.setPitchAlignment=function(e){return this._pitchAlignment=e&&e!==`auto`?e:this._rotationAlignment,this._update(),this},r.prototype.getPitchAlignment=function(){return this._pitchAlignment},r}(e.Evented),Gi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ki=0,qi=!1,Ji=function(t){function r(n){t.call(this),this.options=e.extend({},Gi,n),e.bindAll([`_onSuccess`,`_onError`,`_onZoom`,`_finish`,`_setupUI`,`_updateCamera`,`_updateMarker`],this)}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.onAdd=function(t){var r;return this._map=t,this._container=n.create(`div`,`mapboxgl-ctrl mapboxgl-ctrl-group`),r=this._setupUI,Ui===void 0?e.window.navigator.permissions===void 0?r(Ui=!!e.window.navigator.geolocation):e.window.navigator.permissions.query({name:`geolocation`}).then((function(e){r(Ui=e.state!==`denied`)})):r(Ui),this._container},r.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off(`zoom`,this._onZoom),this._map=void 0,Ki=0,qi=!1},r.prototype._isOutOfMapMaxBounds=function(e){var t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())},r.prototype._setErrorState=function(){switch(this._watchState){case`WAITING_ACTIVE`:this._watchState=`ACTIVE_ERROR`,this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-active`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-active-error`);break;case`ACTIVE_LOCK`:this._watchState=`ACTIVE_ERROR`,this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-active`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-active-error`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-waiting`);break;case`BACKGROUND`:this._watchState=`BACKGROUND_ERROR`,this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-background`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-background-error`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-waiting`)}},r.prototype._onSuccess=function(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event(`outofmaxbounds`,t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case`WAITING_ACTIVE`:case`ACTIVE_LOCK`:case`ACTIVE_ERROR`:this._watchState=`ACTIVE_LOCK`,this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-waiting`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-active-error`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-active`);break;case`BACKGROUND`:case`BACKGROUND_ERROR`:this._watchState=`BACKGROUND`,this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-waiting`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-background-error`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-background`)}this.options.showUserLocation&&this._watchState!==`OFF`&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!==`ACTIVE_LOCK`||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove(`mapboxgl-user-location-dot-stale`),this.fire(new e.Event(`geolocate`,t)),this._finish()}},r.prototype._updateCamera=function(t){var n=new e.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,i=this._map.getBearing(),a=e.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),a,{geolocateSource:!0})},r.prototype._updateMarker=function(t){if(t){var n=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},r.prototype._updateCircleRadius=function(){var e=this._map._container.clientHeight/2,t=this._map.unproject([0,e]),n=this._map.unproject([1,e]),r=t.distanceTo(n),i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=i+`px`,this._circleElement.style.height=i+`px`},r.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},r.prototype._onError=function(t){if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState=`OFF`,this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-waiting`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-active`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-active-error`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-background`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-background-error`),this._geolocateButton.disabled=!0;var n=this._map._getUIString(`GeolocateControl.LocationNotAvailable`);this._geolocateButton.title=n,this._geolocateButton.setAttribute(`aria-label`,n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&qi)return;this._setErrorState()}this._watchState!==`OFF`&&this.options.showUserLocation&&this._dotElement.classList.add(`mapboxgl-user-location-dot-stale`),this.fire(new e.Event(`error`,t)),this._finish()}},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(t){var r=this;if(this._container.addEventListener(`contextmenu`,(function(e){return e.preventDefault()})),this._geolocateButton=n.create(`button`,`mapboxgl-ctrl-geolocate`,this._container),n.create(`span`,`mapboxgl-ctrl-icon`,this._geolocateButton).setAttribute(`aria-hidden`,!0),this._geolocateButton.type=`button`,!1===t){e.warnOnce(`Geolocation support is not available so the GeolocateControl will be disabled.`);var i=this._map._getUIString(`GeolocateControl.LocationNotAvailable`);this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute(`aria-label`,i)}else{var a=this._map._getUIString(`GeolocateControl.FindMyLocation`);this._geolocateButton.title=a,this._geolocateButton.setAttribute(`aria-label`,a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute(`aria-pressed`,`false`),this._watchState=`OFF`),this.options.showUserLocation&&(this._dotElement=n.create(`div`,`mapboxgl-user-location-dot`),this._userLocationDotMarker=new Wi(this._dotElement),this._circleElement=n.create(`div`,`mapboxgl-user-location-accuracy-circle`),this._accuracyCircleMarker=new Wi({element:this._circleElement,pitchAlignment:`map`}),this.options.trackUserLocation&&(this._watchState=`OFF`),this._map.on(`zoom`,this._onZoom)),this._geolocateButton.addEventListener(`click`,this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on(`movestart`,(function(t){t.geolocateSource||r._watchState!==`ACTIVE_LOCK`||t.originalEvent&&t.originalEvent.type===`resize`||(r._watchState=`BACKGROUND`,r._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-background`),r._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-active`),r.fire(new e.Event(`trackuserlocationend`)))}))},r.prototype.trigger=function(){if(!this._setup)return e.warnOnce(`Geolocate control triggered before added to a map`),!1;if(this.options.trackUserLocation){switch(this._watchState){case`OFF`:this._watchState=`WAITING_ACTIVE`,this.fire(new e.Event(`trackuserlocationstart`));break;case`WAITING_ACTIVE`:case`ACTIVE_LOCK`:case`ACTIVE_ERROR`:case`BACKGROUND_ERROR`:Ki--,qi=!1,this._watchState=`OFF`,this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-waiting`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-active`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-active-error`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-background`),this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-background-error`),this.fire(new e.Event(`trackuserlocationend`));break;case`BACKGROUND`:this._watchState=`ACTIVE_LOCK`,this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-background`),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event(`trackuserlocationstart`))}switch(this._watchState){case`WAITING_ACTIVE`:this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-waiting`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-active`);break;case`ACTIVE_LOCK`:this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-active`);break;case`ACTIVE_ERROR`:this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-waiting`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-active-error`);break;case`BACKGROUND`:this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-background`);break;case`BACKGROUND_ERROR`:this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-waiting`),this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-background-error`)}if(this._watchState===`OFF`&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var t;this._geolocateButton.classList.add(`mapboxgl-ctrl-geolocate-waiting`),this._geolocateButton.setAttribute(`aria-pressed`,`true`),++Ki>1?(t={maximumAge:6e5,timeout:0},qi=!0):(t=this.options.positionOptions,qi=!1),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove(`mapboxgl-ctrl-geolocate-waiting`),this._geolocateButton.setAttribute(`aria-pressed`,`false`),this.options.showUserLocation&&this._updateMarker(null)},r}(e.Evented),Yi={maxWidth:100,unit:`metric`},Xi=function(t){this.options=e.extend({},Yi,t),e.bindAll([`_onMove`,`setUnit`],this)};function Zi(e,t,n){var r=n&&n.maxWidth||100,i=e._container.clientHeight/2,a=e.unproject([0,i]),o=e.unproject([r,i]),s=a.distanceTo(o);if(n&&n.unit===`imperial`){var c=3.2808*s;c>5280?Qi(t,r,c/5280,e._getUIString(`ScaleControl.Miles`)):Qi(t,r,c,e._getUIString(`ScaleControl.Feet`))}else n&&n.unit===`nautical`?Qi(t,r,s/1852,e._getUIString(`ScaleControl.NauticalMiles`)):s>=1e3?Qi(t,r,s/1e3,e._getUIString(`ScaleControl.Kilometers`)):Qi(t,r,s,e._getUIString(`ScaleControl.Meters`))}function Qi(e,t,n,r){var i,a,o,s=(i=n,(a=10**((``+Math.floor(i)).length-1))*(o=(o=i/a)>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(e){var t=10**Math.ceil(-Math.log(e)/Math.LN10);return Math.round(e*t)/t}(o)));e.style.width=s/n*t+`px`,e.innerHTML=s+`&nbsp;`+r}Xi.prototype.getDefaultPosition=function(){return`bottom-left`},Xi.prototype._onMove=function(){Zi(this._map,this._container,this.options)},Xi.prototype.onAdd=function(e){return this._map=e,this._container=n.create(`div`,`mapboxgl-ctrl mapboxgl-ctrl-scale`,e.getContainer()),this._map.on(`move`,this._onMove),this._onMove(),this._container},Xi.prototype.onRemove=function(){n.remove(this._container),this._map.off(`move`,this._onMove),this._map=void 0},Xi.prototype.setUnit=function(e){this.options.unit=e,Zi(this._map,this._container,this.options)};var $i=function(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce(`Full screen control 'container' must be a DOM element.`)),e.bindAll([`_onClickFullscreen`,`_changeIcon`],this),`onfullscreenchange`in e.window.document?this._fullscreenchange=`fullscreenchange`:`onmozfullscreenchange`in e.window.document?this._fullscreenchange=`mozfullscreenchange`:`onwebkitfullscreenchange`in e.window.document?this._fullscreenchange=`webkitfullscreenchange`:`onmsfullscreenchange`in e.window.document&&(this._fullscreenchange=`MSFullscreenChange`)};$i.prototype.onAdd=function(t){return this._map=t,this._container||=this._map.getContainer(),this._controlContainer=n.create(`div`,`mapboxgl-ctrl mapboxgl-ctrl-group`),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display=`none`,e.warnOnce(`This device does not support fullscreen mode.`)),this._controlContainer},$i.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},$i.prototype._checkFullscreenSupport=function(){return!!(e.window.document.fullscreenEnabled||e.window.document.mozFullScreenEnabled||e.window.document.msFullscreenEnabled||e.window.document.webkitFullscreenEnabled)},$i.prototype._setupUI=function(){var t=this._fullscreenButton=n.create(`button`,`mapboxgl-ctrl-fullscreen`,this._controlContainer);n.create(`span`,`mapboxgl-ctrl-icon`,t).setAttribute(`aria-hidden`,!0),t.type=`button`,this._updateTitle(),this._fullscreenButton.addEventListener(`click`,this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},$i.prototype._updateTitle=function(){var e=this._getTitle();this._fullscreenButton.setAttribute(`aria-label`,e),this._fullscreenButton.title=e},$i.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?`FullscreenControl.Exit`:`FullscreenControl.Enter`)},$i.prototype._isFullscreen=function(){return this._fullscreen},$i.prototype._changeIcon=function(){(e.window.document.fullscreenElement||e.window.document.mozFullScreenElement||e.window.document.webkitFullscreenElement||e.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(`mapboxgl-ctrl-shrink`),this._fullscreenButton.classList.toggle(`mapboxgl-ctrl-fullscreen`),this._updateTitle())},$i.prototype._onClickFullscreen=function(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.mozCancelFullScreen?e.window.document.mozCancelFullScreen():e.window.document.msExitFullscreen?e.window.document.msExitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ea={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:``,maxWidth:`240px`},ta=[`a[href]`,`[tabindex]:not([tabindex='-1'])`,`[contenteditable]:not([contenteditable='false'])`,`button:not([disabled])`,`input:not([disabled])`,`select:not([disabled])`,`textarea:not([disabled])`].join(`, `),na=function(t){function r(n){t.call(this),this.options=e.extend(Object.create(ea),n),e.bindAll([`_update`,`_onClose`,`remove`,`_onMouseMove`,`_onMouseUp`,`_onDrag`],this)}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.addTo=function(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on(`click`,this._onClose),this.options.closeOnMove&&this._map.on(`move`,this._onClose),this._map.on(`remove`,this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on(`mousemove`,this._onMouseMove),this._map.on(`mouseup`,this._onMouseUp),this._container&&this._container.classList.add(`mapboxgl-popup-track-pointer`),this._map._canvasContainer.classList.add(`mapboxgl-track-pointer`)):this._map.on(`move`,this._update),this.fire(new e.Event(`open`)),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off(`move`,this._update),this._map.off(`move`,this._onClose),this._map.off(`click`,this._onClose),this._map.off(`remove`,this.remove),this._map.off(`mousemove`,this._onMouseMove),this._map.off(`mouseup`,this._onMouseUp),this._map.off(`drag`,this._onDrag),delete this._map),this.fire(new e.Event(`close`)),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on(`move`,this._update),this._map.off(`mousemove`,this._onMouseMove),this._container&&this._container.classList.remove(`mapboxgl-popup-track-pointer`),this._map._canvasContainer.classList.remove(`mapboxgl-track-pointer`)),this},r.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off(`move`,this._update),this._map.on(`mousemove`,this._onMouseMove),this._map.on(`drag`,this._onDrag),this._container&&this._container.classList.add(`mapboxgl-popup-track-pointer`),this._map._canvasContainer.classList.add(`mapboxgl-track-pointer`)),this},r.prototype.getElement=function(){return this._container},r.prototype.setText=function(t){return this.setDOMContent(e.window.document.createTextNode(t))},r.prototype.setHTML=function(t){var n,r=e.window.document.createDocumentFragment(),i=e.window.document.createElement(`body`);for(i.innerHTML=t;n=i.firstChild;)r.appendChild(n);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},r.prototype.setMaxWidth=function(e){return this.options.maxWidth=e,this._update(),this},r.prototype.setDOMContent=function(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create(`div`,`mapboxgl-popup-content`,this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this},r.prototype.addClassName=function(e){this._container&&this._container.classList.add(e)},r.prototype.removeClassName=function(e){this._container&&this._container.classList.remove(e)},r.prototype.setOffset=function(e){return this.options.offset=e,this._update(),this},r.prototype.toggleClassName=function(e){if(this._container)return this._container.classList.toggle(e)},r.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=n.create(`button`,`mapboxgl-popup-close-button`,this._content),this._closeButton.type=`button`,this._closeButton.setAttribute(`aria-label`,`Close popup`),this._closeButton.innerHTML=`&#215;`,this._closeButton.addEventListener(`click`,this._onClose))},r.prototype._onMouseUp=function(e){this._update(e.point)},r.prototype._onMouseMove=function(e){this._update(e.point)},r.prototype._onDrag=function(e){this._update(e.point)},r.prototype._update=function(t){var r=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=n.create(`div`,`mapboxgl-popup`,this._map.getContainer()),this._tip=n.create(`div`,`mapboxgl-popup-tip`,this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(` `).forEach((function(e){return r._container.classList.add(e)})),this._trackPointer&&this._container.classList.add(`mapboxgl-popup-track-pointer`)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bi(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||t)){var i=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat),a=this.options.anchor,o=function t(n){if(n){if(typeof n==`number`){var r=Math.round(Math.sqrt(.5*n**2));return{center:new e.Point(0,0),top:new e.Point(0,n),"top-left":new e.Point(r,r),"top-right":new e.Point(-r,r),bottom:new e.Point(0,-n),"bottom-left":new e.Point(r,-r),"bottom-right":new e.Point(-r,-r),left:new e.Point(n,0),right:new e.Point(-n,0)}}if(n instanceof e.Point||Array.isArray(n)){var i=e.Point.convert(n);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:e.Point.convert(n.center||[0,0]),top:e.Point.convert(n.top||[0,0]),"top-left":e.Point.convert(n[`top-left`]||[0,0]),"top-right":e.Point.convert(n[`top-right`]||[0,0]),bottom:e.Point.convert(n.bottom||[0,0]),"bottom-left":e.Point.convert(n[`bottom-left`]||[0,0]),"bottom-right":e.Point.convert(n[`bottom-right`]||[0,0]),left:e.Point.convert(n.left||[0,0]),right:e.Point.convert(n.right||[0,0])}}return t(new e.Point(0,0))}(this.options.offset);if(!a){var s,c=this._container.offsetWidth,l=this._container.offsetHeight;s=i.y+o.bottom.y<l?[`top`]:i.y>this._map.transform.height-l?[`bottom`]:[],i.x<c/2?s.push(`left`):i.x>this._map.transform.width-c/2&&s.push(`right`),a=s.length===0?`bottom`:s.join(`-`)}var u=i.add(o[a]).round();n.setTransform(this._container,Vi[a]+` translate(`+u.x+`px,`+u.y+`px)`),Hi(this._container,a,`popup`)}},r.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var e=this._container.querySelector(ta);e&&e.focus()}},r.prototype._onClose=function(){this.remove()},r}(e.Evented),ra={version:e.version,supported:t,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:Fi,NavigationControl:Ri,GeolocateControl:Ji,AttributionControl:Di,ScaleControl:Xi,FullscreenControl:$i,Popup:na,Marker:Wi,Style:Zt,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.Point,MercatorCoordinate:e.MercatorCoordinate,Evented:e.Evented,config:e.config,prewarm:function(){Ke().acquire(He)},clearPrewarmedResources:function(){var e=We;e&&(e.isPreloaded()&&e.numActive()===1?(e.release(He),We=null):console.warn(`Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()`))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return Ue.workerCount},set workerCount(e){Ue.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage:function(t){e.clearTileCache(t)},workerUrl:``};return ra})),n}))}));function SJ(e,t){var n=typeof my<`u`&&!!my&&typeof my.showToast==`function`&&my.isFRM!==!0,r=typeof wx<`u`&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0);if(!(n||r)&&(t||=document,t)){var i=t.head||t.getElementsByTagName(`head`)[0];if(!i){i=t.createElement(`head`);var a=t.body||t.getElementsByTagName(`body`)[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement(`style`);return o.type=`text/css`,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}var CJ,wJ,TJ,EJ,DJ,OJ=o((()=>{cv(),Ix(),Py(),ov(),Rb(),CJ=u(xJ()),eq(),Tq(),wJ=[`id`,`attributionControl`,`style`,`token`,`rotation`,`mapInstance`],SJ(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=CJ.default,TJ=0,EJ=`101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg`,DJ=class extends wq{constructor(...e){super(...e),J(this,`version`,`MAPBOX`),J(this,`viewport`,void 0)}getType(){return`mapbox`}lngLatToCoord(e,t={x:0,y:0,z:0}){let{x:n,y:r}=this.lngLatToMercator(e,0);return[n-t.x,r-t.y]}lngLatToMercator(e,t){let{x:n=0,y:r=0,z:i=0}=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t);return{x:n,y:r,z:i}}getModelMatrix(e,t,n,r=[1,1,1],i={x:0,y:0,z:0}){let a=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),o=a.meterInMercatorCoordinateUnits(),s=Ky();return Qy(s,s,lb(a.x-i.x,a.y-i.y,a.z||0-i.z)),$y(s,s,lb(o*r[0],-o*r[1],o*r[2])),eb(s,s,n[0]),tb(s,s,n[1]),nb(s,s,n[2]),s}init(){var e=this;return Z(function*(){let t=e.config,{id:n=`map`,attributionControl:r=!1,style:i=`light`,token:a=EJ,rotation:o=0,mapInstance:s}=t,c=Fx(t,wJ);e.viewport=new $K,!s&&!window.mapboxgl&&console.error(e.configService.getSceneWarninfo(`SDK`)),a===EJ&&i!==`blank`&&!window.mapboxgl.accessToken&&!s&&console.warn(e.configService.getSceneWarninfo(`MapToken`)),!s&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=a),s?(e.map=s,e.$mapContainer=e.map.getContainer()):(e.$mapContainer=e.creatMapContainer(n),e.map=new window.mapboxgl.Map(Y({container:e.$mapContainer,style:e.getMapStyleValue(i),attributionControl:r,bearing:o},c))),e.map.on(`load`,()=>{e.handleCameraChanged()}),e.map.on(`move`,e.handleCameraChanged),e.handleCameraChanged()})()}destroy(){var e;(e=this.$mapContainer)==null||(e=e.parentNode)==null||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(e,...t){this.eventEmitter.emit(e,...t)}once(e,...t){this.eventEmitter.once(e,...t)}getMapContainer(){return this.$mapContainer}getCanvasOverlays(){return this.getMapContainer()?.querySelector(`.mapboxgl-canvas-container`)}meterToCoord(e,t){let n=new CJ.default.LngLat(e[0],e[1]),r=new CJ.default.LngLat(t[0],t[1]),i=n.distanceTo(r),a=CJ.default.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),o=CJ.default.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),{x:s,y:c}=a,{x:l,y:u}=o;return Math.sqrt((s-l)**2+(c-u)**2)*4194304*2/i}exportMap(e){let t=this.map.getCanvas();return e===`jpg`?t?.toDataURL(`image/jpeg`):t?.toDataURL(`image/png`)}creatMapContainer(e){let t=e;typeof e==`string`&&(t=document.getElementById(e));let n=document.createElement(`div`);return n.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,n.id=`l7_mapbox_div`+ TJ++,t.appendChild(n),n}}}));function kJ(e,t){var n=typeof my<`u`&&!!my&&typeof my.showToast==`function`&&my.isFRM!==!0,r=typeof wx<`u`&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0);if(!(n||r)&&(t||=document,t)){var i=t.head||t.getElementsByTagName(`head`)[0];if(!i){i=t.createElement(`head`);var a=t.body||t.getElementsByTagName(`body`)[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement(`style`);return o.type=`text/css`,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}var AJ,jJ=o((()=>{BH(),OJ(),kJ(`.mapboxgl-ctrl-logo {
  display: none !important;
}
`),AJ=class extends zH{getServiceConstructor(){return DJ}}})),MJ=s(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n=typeof globalThis<`u`?globalThis:n||self,n.maplibregl=r())})(e,(function(){var e,t,n;function r(r,i){if(!e)e=i;else if(!t)t=i;else{var a=`var sharedChunk = {}; (`+e+`)(sharedChunk); (`+t+`)(sharedChunk);`,o={};e(o),n=i(o),typeof window<`u`&&(n.workerUrl=window.URL.createObjectURL(new Blob([a],{type:`text/javascript`})))}}return r([`exports`],(function(e){function t(e,t,n,r){return new(n||=Promise)((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,`default`)?e.default:e}var r=i;function i(e,t){this.x=e,this.y=t}i.prototype={clone:function(){return new i(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=r,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-r*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(e){return e instanceof i?e:Array.isArray(e)?new i(e[0],e[1]):e};var a=n(r),o=s;function s(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=i/a}var o=0,s=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?o=n:s=n,n=.5*(s-o)+o;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var c=n(o);let l,u;function d(){return l??=typeof OffscreenCanvas<`u`&&new OffscreenCanvas(1,1).getContext(`2d`)&&typeof createImageBitmap==`function`,l}function f(){if(u==null&&(u=!1,d())){let e=new OffscreenCanvas(5,5).getContext(`2d`,{willReadFrequently:!0});if(e){for(let t=0;t<25;t++){let n=4*t;e.fillStyle=`rgb(${n},${n+1},${n+2})`,e.fillRect(t%5,Math.floor(t/5),1,1)}let t=e.getImageData(0,0,5,5).data;for(let e=0;e<100;e++)if(e%4!=3&&t[e]!==e){u=!0;break}}}return u||!1}function p(e,t,n,r){let i=new c(e,t,n,r);return function(e){return i.solve(e)}}let m=p(.25,.1,.25,1);function h(e,t,n){return Math.min(n,Math.max(t,e))}function g(e,t,n){let r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function _(e,...t){for(let n of t)for(let t in n)e[t]=n[t];return e}let v=1;function y(e,t,n){let r={};for(let i in e)r[i]=t.call(n||this,e[i],i,e);return r}function b(e,t,n){let r={};for(let i in e)t.call(n||this,e[i],i,e)&&(r[i]=e[i]);return r}function x(e){return Array.isArray(e)?e.map(x):typeof e==`object`&&e?y(e,x):e}let S={};function C(e){S[e]||(typeof console<`u`&&console.warn(e),S[e]=!0)}function w(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function E(e){let t=0;for(let n,r,i=0,a=e.length,o=a-1;i<a;o=i++)n=e[i],r=e[o],t+=(r.x-n.x)*(n.y+r.y);return t}function D(){return typeof WorkerGlobalScope<`u`&&typeof self<`u`&&self instanceof WorkerGlobalScope}let O=null;function k(e){return typeof ImageBitmap<`u`&&e instanceof ImageBitmap}let A=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=`;function j(e,n,r,i,a){return t(this,void 0,void 0,(function*(){if(typeof VideoFrame>`u`)throw Error(`VideoFrame not supported`);let t=new VideoFrame(e,{timestamp:0});try{let o=t?.format;if(!o||!o.startsWith(`BGR`)&&!o.startsWith(`RGB`))throw Error(`Unrecognized format ${o}`);let s=o.startsWith(`BGR`),c=new Uint8ClampedArray(i*a*4);if(yield t.copyTo(c,function(e,t,n,r,i){let a=4*Math.max(-t,0),o=(Math.max(0,n)-n)*r*4+a,s=4*r,c=Math.max(0,t),l=Math.max(0,n);return{rect:{x:c,y:l,width:Math.min(e.width,t+r)-c,height:Math.min(e.height,n+i)-l},layout:[{offset:o,stride:s}]}}(e,n,r,i,a)),s)for(let e=0;e<c.length;e+=4){let t=c[e];c[e]=c[e+2],c[e+2]=t}return c}finally{t.close()}}))}let M,N,P,F,I={now:typeof performance<`u`&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(e){let t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e,t=0){return this.getImageCanvasContext(e).getImageData(-t,-t,e.width+2*t,e.height+2*t)},getImageCanvasContext(e){let t=window.document.createElement(`canvas`),n=t.getContext(`2d`,{willReadFrequently:!0});if(!n)throw Error(`failed to create canvas 2d context`);return t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height),n},resolveURL:e=>(P||=document.createElement(`a`),P.href=e,P.href),hardwareConcurrency:typeof navigator<`u`&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(F??=matchMedia(`(prefers-reduced-motion: reduce)`),F.matches)}},ee={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:``};class R extends Error{constructor(e,t,n,r){super(`AJAXError: ${t} (${e}): ${n}`),this.status=e,this.statusText=t,this.url=n,this.body=r}}let z=D()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol===`blob:`?window.parent:window).location.href,B=e=>ee.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf(`://`))];function te(e,t){let n=new AbortController,r=new Request(e.url,{method:e.method||`GET`,body:e.body,credentials:e.credentials,headers:e.headers,cache:e.cache,referrer:z(),signal:n.signal}),i=!1,a=!1;return e.type===`json`&&r.headers.set(`Accept`,`application/json`),a||fetch(r).then((n=>n.ok?(n=>{(e.type===`arrayBuffer`||e.type===`image`?n.arrayBuffer():e.type===`json`?n.json():n.text()).then((e=>{a||(i=!0,t(null,e,n.headers.get(`Cache-Control`),n.headers.get(`Expires`)))})).catch((e=>{a||t(Error(e.message))}))})(n):n.blob().then((r=>t(new R(n.status,n.statusText,e.url,r)))))).catch((e=>{e.code!==20&&t(Error(e.message))})),{cancel:()=>{a=!0,i||n.abort()}}}let ne=function(e,t){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){if(D()&&self.worker&&self.worker.actor)return self.worker.actor.send(`getResource`,e,t);if(!D())return(B(e.url)||te)(e,t)}if(!(/^file:/.test(n=e.url)||/^file:/.test(z())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,`signal`))return te(e,t);if(D()&&self.worker&&self.worker.actor)return self.worker.actor.send(`getResource`,e,t,void 0,!0)}var n;return function(e,t){let n=new XMLHttpRequest;n.open(e.method||`GET`,e.url,!0),e.type!==`arrayBuffer`&&e.type!==`image`||(n.responseType=`arraybuffer`);for(let t in e.headers)n.setRequestHeader(t,e.headers[t]);return e.type===`json`&&(n.responseType=`text`,n.setRequestHeader(`Accept`,`application/json`)),n.withCredentials=e.credentials===`include`,n.onerror=()=>{t(Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||n.status===0)&&n.response!==null){let r=n.response;if(e.type===`json`)try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r,n.getResponseHeader(`Cache-Control`),n.getResponseHeader(`Expires`))}else{let r=new Blob([n.response],{type:n.getResponseHeader(`Content-Type`)});t(new R(n.status,n.statusText,e.url,r))}},n.send(e.body),{cancel:()=>n.abort()}}(e,t)},re=function(e,t){return ne(_(e,{type:`arrayBuffer`}),t)};function V(e){if(!e||e.indexOf(`://`)<=0||e.indexOf(`data:image/`)===0||e.indexOf(`blob:`)===0)return!0;let t=new URL(e),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function ie(e,t,n){n[e]&&n[e].indexOf(t)!==-1||(n[e]=n[e]||[],n[e].push(t))}function ae(e,t,n){if(n&&n[e]){let r=n[e].indexOf(t);r!==-1&&n[e].splice(r,1)}}class oe{constructor(e,t={}){_(this,t),this.type=e}}class se extends oe{constructor(e,t={}){super(`error`,_({error:e},t))}}class ce{on(e,t){return this._listeners=this._listeners||{},ie(e,t,this._listeners),this}off(e,t){return ae(e,t,this._listeners),ae(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},ie(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){typeof e==`string`&&(e=new oe(e,t||{}));let n=e.type;if(this.listens(n)){e.target=this;let t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(let n of t)n.call(this,e);let r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(let t of r)ae(n,t,this._oneTimeListeners),t.call(this,e);let i=this._eventedParent;i&&(_(e,typeof this._eventedParentData==`function`?this._eventedParentData():this._eventedParentData),i.fire(e))}else e instanceof se&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var H={$version:8,$root:{version:{required:!0,type:`enum`,values:[8]},name:{type:`string`},metadata:{type:`*`},center:{type:`array`,value:`number`},zoom:{type:`number`},bearing:{type:`number`,default:0,period:360,units:`degrees`},pitch:{type:`number`,default:0,units:`degrees`},light:{type:`light`},terrain:{type:`terrain`},sources:{required:!0,type:`sources`},sprite:{type:`sprite`},glyphs:{type:`string`},transition:{type:`transition`},layers:{required:!0,type:`array`,value:`layer`}},sources:{"*":{type:`source`}},source:[`source_vector`,`source_raster`,`source_raster_dem`,`source_geojson`,`source_video`,`source_image`],source_vector:{type:{required:!0,type:`enum`,values:{vector:{}}},url:{type:`string`},tiles:{type:`array`,value:`string`},bounds:{type:`array`,value:`number`,length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:`enum`,values:{xyz:{},tms:{}},default:`xyz`},minzoom:{type:`number`,default:0},maxzoom:{type:`number`,default:22},attribution:{type:`string`},promoteId:{type:`promoteId`},volatile:{type:`boolean`,default:!1},"*":{type:`*`}},source_raster:{type:{required:!0,type:`enum`,values:{raster:{}}},url:{type:`string`},tiles:{type:`array`,value:`string`},bounds:{type:`array`,value:`number`,length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:`number`,default:0},maxzoom:{type:`number`,default:22},tileSize:{type:`number`,default:512,units:`pixels`},scheme:{type:`enum`,values:{xyz:{},tms:{}},default:`xyz`},attribution:{type:`string`},volatile:{type:`boolean`,default:!1},"*":{type:`*`}},source_raster_dem:{type:{required:!0,type:`enum`,values:{"raster-dem":{}}},url:{type:`string`},tiles:{type:`array`,value:`string`},bounds:{type:`array`,value:`number`,length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:`number`,default:0},maxzoom:{type:`number`,default:22},tileSize:{type:`number`,default:512,units:`pixels`},attribution:{type:`string`},encoding:{type:`enum`,values:{terrarium:{},mapbox:{},custom:{}},default:`mapbox`},redFactor:{type:`number`,default:1},blueFactor:{type:`number`,default:1},greenFactor:{type:`number`,default:1},baseShift:{type:`number`,default:0},volatile:{type:`boolean`,default:!1},"*":{type:`*`}},source_geojson:{type:{required:!0,type:`enum`,values:{geojson:{}}},data:{required:!0,type:`*`},maxzoom:{type:`number`,default:18},attribution:{type:`string`},buffer:{type:`number`,default:128,maximum:512,minimum:0},filter:{type:`*`},tolerance:{type:`number`,default:.375},cluster:{type:`boolean`,default:!1},clusterRadius:{type:`number`,default:50,minimum:0},clusterMaxZoom:{type:`number`},clusterMinPoints:{type:`number`},clusterProperties:{type:`*`},lineMetrics:{type:`boolean`,default:!1},generateId:{type:`boolean`,default:!1},promoteId:{type:`promoteId`}},source_video:{type:{required:!0,type:`enum`,values:{video:{}}},urls:{required:!0,type:`array`,value:`string`},coordinates:{required:!0,type:`array`,length:4,value:{type:`array`,length:2,value:`number`}}},source_image:{type:{required:!0,type:`enum`,values:{image:{}}},url:{required:!0,type:`string`},coordinates:{required:!0,type:`array`,length:4,value:{type:`array`,length:2,value:`number`}}},layer:{id:{type:`string`,required:!0},type:{type:`enum`,values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:`*`},source:{type:`string`},"source-layer":{type:`string`},minzoom:{type:`number`,minimum:0,maximum:24},maxzoom:{type:`number`,minimum:0,maximum:24},filter:{type:`filter`},layout:{type:`layout`},paint:{type:`paint`}},layout:[`layout_fill`,`layout_line`,`layout_circle`,`layout_heatmap`,`layout_fill-extrusion`,`layout_symbol`,`layout_raster`,`layout_hillshade`,`layout_background`],layout_background:{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_fill:{"fill-sort-key":{type:`number`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_circle:{"circle-sort-key":{type:`number`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_heatmap:{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},"layout_fill-extrusion":{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_line:{"line-cap":{type:`enum`,values:{butt:{},round:{},square:{}},default:`butt`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"line-join":{type:`enum`,values:{bevel:{},round:{},miter:{}},default:`miter`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"line-miter-limit":{type:`number`,default:2,requires:[{"line-join":`miter`}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"line-round-limit":{type:`number`,default:1.05,requires:[{"line-join":`round`}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"line-sort-key":{type:`number`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_symbol:{"symbol-placement":{type:`enum`,values:{point:{},line:{},"line-center":{}},default:`point`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"symbol-spacing":{type:`number`,default:250,minimum:1,units:`pixels`,requires:[{"symbol-placement":`line`}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"symbol-avoid-edges":{type:`boolean`,default:!1,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"symbol-sort-key":{type:`number`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"symbol-z-order":{type:`enum`,values:{auto:{},"viewport-y":{},source:{}},default:`auto`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-allow-overlap":{type:`boolean`,default:!1,requires:[`icon-image`,{"!":`icon-overlap`}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-overlap":{type:`enum`,values:{never:{},always:{},cooperative:{}},requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-ignore-placement":{type:`boolean`,default:!1,requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-optional":{type:`boolean`,default:!1,requires:[`icon-image`,`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-rotation-alignment":{type:`enum`,values:{map:{},viewport:{},auto:{}},default:`auto`,requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-size":{type:`number`,default:1,minimum:0,units:`factor of the original icon size`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-text-fit":{type:`enum`,values:{none:{},width:{},height:{},both:{}},default:`none`,requires:[`icon-image`,`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-text-fit-padding":{type:`array`,value:`number`,length:4,default:[0,0,0,0],units:`pixels`,requires:[`icon-image`,`text-field`,{"icon-text-fit":[`both`,`width`,`height`]}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"icon-image":{type:`resolvedImage`,tokens:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-rotate":{type:`number`,default:0,period:360,units:`degrees`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-padding":{type:`padding`,default:[2],units:`pixels`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-keep-upright":{type:`boolean`,default:!1,requires:[`icon-image`,{"icon-rotation-alignment":`map`},{"symbol-placement":[`line`,`line-center`]}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"icon-offset":{type:`array`,value:`number`,length:2,default:[0,0],requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-anchor":{type:`enum`,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:`center`,requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"icon-pitch-alignment":{type:`enum`,values:{map:{},viewport:{},auto:{}},default:`auto`,requires:[`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-pitch-alignment":{type:`enum`,values:{map:{},viewport:{},auto:{}},default:`auto`,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-rotation-alignment":{type:`enum`,values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:`auto`,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-field":{type:`formatted`,default:``,tokens:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-font":{type:`array`,value:`string`,default:[`Open Sans Regular`,`Arial Unicode MS Regular`],requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-size":{type:`number`,default:16,minimum:0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-max-width":{type:`number`,default:10,minimum:0,units:`ems`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-line-height":{type:`number`,default:1.2,units:`ems`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"text-letter-spacing":{type:`number`,default:0,units:`ems`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-justify":{type:`enum`,values:{auto:{},left:{},center:{},right:{}},default:`center`,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-radial-offset":{type:`number`,units:`ems`,default:0,requires:[`text-field`],"property-type":`data-driven`,expression:{interpolated:!0,parameters:[`zoom`,`feature`]}},"text-variable-anchor":{type:`array`,value:`enum`,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:[`text-field`,{"symbol-placement":[`point`]}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-variable-anchor-offset":{type:`variableAnchorOffsetCollection`,requires:[`text-field`,{"symbol-placement":[`point`]}],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-anchor":{type:`enum`,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:`center`,requires:[`text-field`,{"!":`text-variable-anchor`}],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-max-angle":{type:`number`,default:45,units:`degrees`,requires:[`text-field`,{"symbol-placement":[`line`,`line-center`]}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"text-writing-mode":{type:`array`,value:`enum`,values:{horizontal:{},vertical:{}},requires:[`text-field`,{"symbol-placement":[`point`]}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-rotate":{type:`number`,default:0,period:360,units:`degrees`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-padding":{type:`number`,default:2,minimum:0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"text-keep-upright":{type:`boolean`,default:!0,requires:[`text-field`,{"text-rotation-alignment":`map`},{"symbol-placement":[`line`,`line-center`]}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-transform":{type:`enum`,values:{none:{},uppercase:{},lowercase:{}},default:`none`,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-offset":{type:`array`,value:`number`,units:`ems`,length:2,default:[0,0],requires:[`text-field`,{"!":`text-radial-offset`}],expression:{interpolated:!0,parameters:[`zoom`,`feature`]},"property-type":`data-driven`},"text-allow-overlap":{type:`boolean`,default:!1,requires:[`text-field`,{"!":`text-overlap`}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-overlap":{type:`enum`,values:{never:{},always:{},cooperative:{}},requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-ignore-placement":{type:`boolean`,default:!1,requires:[`text-field`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-optional":{type:`boolean`,default:!1,requires:[`text-field`,`icon-image`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_raster:{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},layout_hillshade:{visibility:{type:`enum`,values:{visible:{},none:{}},default:`visible`,"property-type":`constant`}},filter:{type:`array`,value:`*`},filter_operator:{type:`enum`,values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:`enum`,values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:`expression`},stops:{type:`array`,value:`function_stop`},base:{type:`number`,default:1,minimum:0},property:{type:`string`,default:`$zoom`},type:{type:`enum`,values:{identity:{},exponential:{},interval:{},categorical:{}},default:`exponential`},colorSpace:{type:`enum`,values:{rgb:{},lab:{},hcl:{}},default:`rgb`},default:{type:`*`,required:!1}},function_stop:{type:`array`,minimum:0,maximum:24,value:[`number`,`color`],length:2},expression:{type:`array`,value:`*`,minimum:1},light:{anchor:{type:`enum`,default:`viewport`,values:{map:{},viewport:{}},"property-type":`data-constant`,transition:!1,expression:{interpolated:!1,parameters:[`zoom`]}},position:{type:`array`,default:[1.15,210,30],length:3,value:`number`,"property-type":`data-constant`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]}},color:{type:`color`,"property-type":`data-constant`,default:`#ffffff`,expression:{interpolated:!0,parameters:[`zoom`]},transition:!0},intensity:{type:`number`,"property-type":`data-constant`,default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:[`zoom`]},transition:!0}},terrain:{source:{type:`string`,required:!0},exaggeration:{type:`number`,minimum:0,default:1}},paint:[`paint_fill`,`paint_line`,`paint_circle`,`paint_heatmap`,`paint_fill-extrusion`,`paint_symbol`,`paint_raster`,`paint_hillshade`,`paint_background`],paint_fill:{"fill-antialias":{type:`boolean`,default:!0,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"fill-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-color":{type:`color`,default:`#000000`,transition:!0,requires:[{"!":`fill-pattern`}],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-outline-color":{type:`color`,transition:!0,requires:[{"!":`fill-pattern`},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"fill-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`fill-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"fill-pattern":{type:`resolvedImage`,transition:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`cross-faded-data-driven`}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"fill-extrusion-color":{type:`color`,default:`#000000`,transition:!0,requires:[{"!":`fill-extrusion-pattern`}],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-extrusion-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"fill-extrusion-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`fill-extrusion-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"fill-extrusion-pattern":{type:`resolvedImage`,transition:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`cross-faded-data-driven`},"fill-extrusion-height":{type:`number`,default:0,minimum:0,units:`meters`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-extrusion-base":{type:`number`,default:0,minimum:0,units:`meters`,transition:!0,requires:[`fill-extrusion-height`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"fill-extrusion-vertical-gradient":{type:`boolean`,default:!0,transition:!1,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`}},paint_line:{"line-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-color":{type:`color`,default:`#000000`,transition:!0,requires:[{"!":`line-pattern`}],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"line-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`line-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"line-width":{type:`number`,default:1,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-gap-width":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-offset":{type:`number`,default:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-blur":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"line-dasharray":{type:`array`,value:`number`,minimum:0,transition:!0,units:`line widths`,requires:[{"!":`line-pattern`}],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`cross-faded`},"line-pattern":{type:`resolvedImage`,transition:!0,expression:{interpolated:!1,parameters:[`zoom`,`feature`]},"property-type":`cross-faded-data-driven`},"line-gradient":{type:`color`,transition:!1,requires:[{"!":`line-dasharray`},{"!":`line-pattern`},{source:`geojson`,has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:[`line-progress`]},"property-type":`color-ramp`}},paint_circle:{"circle-radius":{type:`number`,default:5,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-color":{type:`color`,default:`#000000`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-blur":{type:`number`,default:0,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"circle-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`circle-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"circle-pitch-scale":{type:`enum`,values:{map:{},viewport:{}},default:`map`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"circle-pitch-alignment":{type:`enum`,values:{map:{},viewport:{}},default:`viewport`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"circle-stroke-width":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-stroke-color":{type:`color`,default:`#000000`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"circle-stroke-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`}},paint_heatmap:{"heatmap-radius":{type:`number`,default:30,minimum:1,transition:!0,units:`pixels`,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"heatmap-weight":{type:`number`,default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"heatmap-intensity":{type:`number`,default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"heatmap-color":{type:`color`,default:[`interpolate`,[`linear`],[`heatmap-density`],0,`rgba(0, 0, 255, 0)`,.1,`royalblue`,.3,`cyan`,.5,`lime`,.7,`yellow`,1,`red`],transition:!1,expression:{interpolated:!0,parameters:[`heatmap-density`]},"property-type":`color-ramp`},"heatmap-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`}},paint_symbol:{"icon-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-color":{type:`color`,default:`#000000`,transition:!0,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-halo-color":{type:`color`,default:`rgba(0, 0, 0, 0)`,transition:!0,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-halo-width":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-halo-blur":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"icon-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,requires:[`icon-image`],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"icon-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`icon-image`,`icon-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"text-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-color":{type:`color`,default:`#000000`,transition:!0,overridable:!0,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-halo-color":{type:`color`,default:`rgba(0, 0, 0, 0)`,transition:!0,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-halo-width":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-halo-blur":{type:`number`,default:0,minimum:0,transition:!0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`,`feature`,`feature-state`]},"property-type":`data-driven`},"text-translate":{type:`array`,value:`number`,length:2,default:[0,0],transition:!0,units:`pixels`,requires:[`text-field`],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"text-translate-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`map`,requires:[`text-field`,`text-translate`],expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`}},paint_raster:{"raster-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-hue-rotate":{type:`number`,default:0,period:360,transition:!0,units:`degrees`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-brightness-min":{type:`number`,default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-brightness-max":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-saturation":{type:`number`,default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-contrast":{type:`number`,default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"raster-resampling":{type:`enum`,values:{linear:{},nearest:{}},default:`linear`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"raster-fade-duration":{type:`number`,default:300,minimum:0,transition:!1,units:`milliseconds`,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`}},paint_hillshade:{"hillshade-illumination-direction":{type:`number`,default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-illumination-anchor":{type:`enum`,values:{map:{},viewport:{}},default:`viewport`,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-exaggeration":{type:`number`,default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-shadow-color":{type:`color`,default:`#000000`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-highlight-color":{type:`color`,default:`#FFFFFF`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"hillshade-accent-color":{type:`color`,default:`#000000`,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`}},paint_background:{"background-color":{type:`color`,default:`#000000`,transition:!0,requires:[{"!":`background-pattern`}],expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`},"background-pattern":{type:`resolvedImage`,transition:!0,expression:{interpolated:!1,parameters:[`zoom`]},"property-type":`cross-faded`},"background-opacity":{type:`number`,default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:[`zoom`]},"property-type":`data-constant`}},transition:{duration:{type:`number`,default:300,minimum:0,units:`milliseconds`},delay:{type:`number`,default:0,minimum:0,units:`milliseconds`}},"property-type":{"data-driven":{type:`property-type`},"cross-faded":{type:`property-type`},"cross-faded-data-driven":{type:`property-type`},"color-ramp":{type:`property-type`},"data-constant":{type:`property-type`},constant:{type:`property-type`}},promoteId:{"*":{type:`string`}}};let le=[`type`,`source`,`source-layer`,`minzoom`,`maxzoom`,`filter`,`layout`];function ue(e,t){let n={};for(let t in e)t!==`ref`&&(n[t]=e[t]);return le.forEach((e=>{e in t&&(n[e]=t[e])})),n}function de(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!de(e[n],t[n]))return!1;return!0}if(typeof e==`object`&&e&&t!==null){if(typeof t!=`object`||Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(!de(e[n],t[n]))return!1;return!0}return e===t}let U={setStyle:`setStyle`,addLayer:`addLayer`,removeLayer:`removeLayer`,setPaintProperty:`setPaintProperty`,setLayoutProperty:`setLayoutProperty`,setFilter:`setFilter`,addSource:`addSource`,removeSource:`removeSource`,setGeoJSONSourceData:`setGeoJSONSourceData`,setLayerZoomRange:`setLayerZoomRange`,setLayerProperty:`setLayerProperty`,setCenter:`setCenter`,setZoom:`setZoom`,setBearing:`setBearing`,setPitch:`setPitch`,setSprite:`setSprite`,setGlyphs:`setGlyphs`,setTransition:`setTransition`,setLight:`setLight`};function fe(e,t,n){n.push({command:U.addSource,args:[e,t[e]]})}function pe(e,t,n){t.push({command:U.removeSource,args:[e]}),n[e]=!0}function me(e,t,n,r){pe(e,n,r),fe(e,t,n)}function W(e,t,n){let r;for(r in e[n])if(Object.prototype.hasOwnProperty.call(e[n],r)&&r!==`data`&&!de(e[n][r],t[n][r]))return!1;for(r in t[n])if(Object.prototype.hasOwnProperty.call(t[n],r)&&r!==`data`&&!de(e[n][r],t[n][r]))return!1;return!0}function he(e,t,n,r,i,a){let o;for(o in t||={},e||={})Object.prototype.hasOwnProperty.call(e,o)&&(de(e[o],t[o])||n.push({command:a,args:[r,o,t[o],i]}));for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&!Object.prototype.hasOwnProperty.call(e,o)&&(de(e[o],t[o])||n.push({command:a,args:[r,o,t[o],i]}))}function ge(e){return e.id}function _e(e,t){return e[t.id]=t,e}class G{constructor(e,t,n,r){this.message=(e?`${e}: `:``)+n,r&&(this.identifier=r),t!=null&&t.__line__&&(this.line=t.__line__)}}function K(e,...t){for(let n of t)for(let t in n)e[t]=n[t];return e}class ve extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class ye{constructor(e,t=[]){this.parent=e,this.bindings={};for(let[e,n]of t)this.bindings[e]=n}concat(e){return new ye(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let be={kind:`null`},xe={kind:`number`},Se={kind:`string`},Ce={kind:`boolean`},we={kind:`color`},Te={kind:`object`},Ee={kind:`value`},De={kind:`collator`},Oe={kind:`formatted`},ke={kind:`padding`},Ae={kind:`resolvedImage`},je={kind:`variableAnchorOffsetCollection`};function Me(e,t){return{kind:`array`,itemType:e,N:t}}function Ne(e){if(e.kind===`array`){let t=Ne(e.itemType);return typeof e.N==`number`?`array<${t}, ${e.N}>`:e.itemType.kind===`value`?`array`:`array<${t}>`}return e.kind}let Pe=[be,xe,Se,Ce,we,Oe,Te,Me(Ee),ke,Ae,je];function Fe(e,t){if(t.kind===`error`)return null;if(e.kind===`array`){if(t.kind===`array`&&(t.N===0&&t.itemType.kind===`value`||!Fe(e.itemType,t.itemType))&&(typeof e.N!=`number`||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind===`value`){for(let e of Pe)if(!Fe(e,t))return null}}return`Expected ${Ne(e)} but found ${Ne(t)} instead.`}function Ie(e,t){return t.some((t=>t.kind===e.kind))}function Le(e,t){return t.some((t=>t===`null`?e===null:t===`array`?Array.isArray(e):t===`object`?e&&!Array.isArray(e)&&typeof e==`object`:t===typeof e))}function q(e,t){return e.kind===`array`&&t.kind===`array`?e.itemType.kind===t.itemType.kind&&typeof e.N==`number`:e.kind===t.kind}let Re=.96422,ze=.82521,Be=4/29,Ve=6/29,He=3*Ve*Ve;Ve*Ve*Ve;let Ue=Math.PI/180,We=180/Math.PI;function Ge(e){return(e%=360)<0&&(e+=360),e}function Ke([e,t,n,r]){let i,a,o=Je((.2225045*(e=qe(e))+.7168786*(t=qe(t))+.0606169*(n=qe(n)))/1);e===t&&t===n?i=a=o:(i=Je((.4360747*e+.3850649*t+.1430804*n)/Re),a=Je((.0139322*e+.0971045*t+.7141733*n)/ze));let s=116*o-16;return[s<0?0:s,500*(i-o),200*(o-a),r]}function qe(e){return e<=.04045?e/12.92:((e+.055)/1.055)**2.4}function Je(e){return e>.008856451679035631?e**(1/3):e/He+Be}function Ye([e,t,n,r]){let i=(e+16)/116,a=isNaN(t)?i:i+t/500,o=isNaN(n)?i:i-n/200;return i=1*Ze(i),a=Re*Ze(a),o=ze*Ze(o),[Xe(3.1338561*a-1.6168667*i-.4906146*o),Xe(-.9787684*a+1.9161415*i+.033454*o),Xe(.0719453*a-.2289914*i+1.4052427*o),r]}function Xe(e){return(e=e<=.00304?12.92*e:1.055*e**(1/2.4)-.055)<0?0:e>1?1:e}function Ze(e){return e>Ve?e*e*e:He*(e-Be)}function Qe(e){return parseInt(e.padEnd(2,e),16)/255}function $e(e,t){return et(t?e/100:e,0,1)}function et(e,t,n){return Math.min(Math.max(t,e),n)}function tt(e){return!e.some(Number.isNaN)}let nt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class rt{constructor(e,t,n,r=1,i=!0){this.r=e,this.g=t,this.b=n,this.a=r,i||(this.r*=r,this.g*=r,this.b*=r,r||this.overwriteGetter(`rgb`,[e,t,n,r]))}static parse(e){if(e instanceof rt)return e;if(typeof e!=`string`)return;let t=function(e){if((e=e.toLowerCase().trim())===`transparent`)return[0,0,0,0];let t=nt[e];if(t){let[e,n,r]=t;return[e/255,n/255,r/255,1]}if(e.startsWith(`#`)&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){let t=e.length<6?1:2,n=1;return[Qe(e.slice(n,n+=t)),Qe(e.slice(n,n+=t)),Qe(e.slice(n,n+=t)),Qe(e.slice(n,n+t)||`ff`)]}if(e.startsWith(`rgb`)){let t=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){let[e,n,r,i,a,o,s,c,l,u,d,f]=t,p=[i||` `,s||` `,u].join(``);if(p===`  `||p===`  /`||p===`,,`||p===`,,,`){let e=[r,o,l].join(``),t=e===`%%%`?100:e===``?255:0;if(t){let e=[et(+n/t,0,1),et(+a/t,0,1),et(+c/t,0,1),d?$e(+d,f):1];if(tt(e))return e}}return}}let n=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){let[e,t,r,i,a,o,s,c,l]=n,u=[r||` `,a||` `,s].join(``);if(u===`  `||u===`  /`||u===`,,`||u===`,,,`){let e=[+t,et(+i,0,100),et(+o,0,100),c?$e(+c,l):1];if(tt(e))return function([e,t,n,r]){function i(r){let i=(r+e/30)%12,a=t*Math.min(n,1-n);return n-a*Math.max(-1,Math.min(i-3,9-i,1))}return e=Ge(e),t/=100,n/=100,[i(0),i(8),i(4),r]}(e)}}}(e);return t?new rt(...t,!1):void 0}get rgb(){let{r:e,g:t,b:n,a:r}=this,i=r||1/0;return this.overwriteGetter(`rgb`,[e/i,t/i,n/i,r])}get hcl(){return this.overwriteGetter(`hcl`,function(e){let[t,n,r,i]=Ke(e),a=Math.sqrt(n*n+r*r);return[Math.round(1e4*a)?Ge(Math.atan2(r,n)*We):NaN,a,t,i]}(this.rgb))}get lab(){return this.overwriteGetter(`lab`,Ke(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){let[e,t,n,r]=this.rgb;return`rgba(${[e,t,n].map((e=>Math.round(255*e))).join(`,`)},${r})`}}rt.black=new rt(0,0,0,1),rt.white=new rt(1,1,1,1),rt.transparent=new rt(0,0,0,0),rt.red=new rt(1,0,0,1);class it{constructor(e,t,n){this.sensitivity=e?t?`variant`:`case`:t?`accent`:`base`,this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:`search`})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class at{constructor(e,t,n,r,i){this.text=e,this.image=t,this.scale=n,this.fontStack=r,this.textColor=i}}class ot{constructor(e){this.sections=e}static fromString(e){return new ot([new at(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof ot?e:ot.fromString(e)}toString(){return this.sections.length===0?``:this.sections.map((e=>e.text)).join(``)}}class st{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof st)return e;if(typeof e==`number`)return new st([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(let t of e)if(typeof t!=`number`)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new st(e)}}toString(){return JSON.stringify(this.values)}}let ct=new Set([`center`,`left`,`right`,`top`,`bottom`,`top-left`,`top-right`,`bottom-left`,`bottom-right`]);class lt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof lt)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){let n=e[t],r=e[t+1];if(typeof n!=`string`||!ct.has(n)||!Array.isArray(r)||r.length!==2||typeof r[0]!=`number`||typeof r[1]!=`number`)return}return new lt(e)}}toString(){return JSON.stringify(this.values)}}class ut{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ut({name:e,available:!1}):null}}function dt(e,t,n,r){return typeof e==`number`&&e>=0&&e<=255&&typeof t==`number`&&t>=0&&t<=255&&typeof n==`number`&&n>=0&&n<=255?r===void 0||typeof r==`number`&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,n,r].join(`, `)}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r==`number`?[e,t,n,r]:[e,t,n]).join(`, `)}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ft(e){if(e===null||typeof e==`string`||typeof e==`boolean`||typeof e==`number`||e instanceof rt||e instanceof it||e instanceof ot||e instanceof st||e instanceof lt||e instanceof ut)return!0;if(Array.isArray(e)){for(let t of e)if(!ft(t))return!1;return!0}if(typeof e==`object`){for(let t in e)if(!ft(e[t]))return!1;return!0}return!1}function pt(e){if(e===null)return be;if(typeof e==`string`)return Se;if(typeof e==`boolean`)return Ce;if(typeof e==`number`)return xe;if(e instanceof rt)return we;if(e instanceof it)return De;if(e instanceof ot)return Oe;if(e instanceof st)return ke;if(e instanceof lt)return je;if(e instanceof ut)return Ae;if(Array.isArray(e)){let t=e.length,n;for(let t of e){let e=pt(t);if(n){if(n===e)continue;n=Ee;break}n=e}return Me(n||Ee,t)}return Te}function mt(e){let t=typeof e;return e===null?``:t===`string`||t===`number`||t===`boolean`?String(e):e instanceof rt||e instanceof ot||e instanceof st||e instanceof lt||e instanceof ut?e.toString():JSON.stringify(e)}class ht{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ft(e[1]))return t.error(`invalid value`);let n=e[1],r=pt(n),i=t.expectedType;return r.kind!==`array`||r.N!==0||!i||i.kind!==`array`||typeof i.N==`number`&&i.N!==0||(r=i),new ht(r,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class gt{constructor(e){this.name=`ExpressionEvaluationError`,this.message=e}toJSON(){return this.message}}let _t={string:Se,number:xe,boolean:Ce,object:Te};class vt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error(`Expected at least one argument.`);let n,r=1,i=e[0];if(i===`array`){let i,a;if(e.length>2){let n=e[1];if(typeof n!=`string`||!(n in _t)||n===`object`)return t.error(`The item type argument of "array" must be one of string, number, boolean`,1);i=_t[n],r++}else i=Ee;if(e.length>3){if(e[2]!==null&&(typeof e[2]!=`number`||e[2]<0||e[2]!==Math.floor(e[2])))return t.error(`The length argument to "array" must be a positive integer literal`,2);a=e[2],r++}n=Me(i,a)}else{if(!_t[i])throw Error(`Types doesn't contain name = ${i}`);n=_t[i]}let a=[];for(;r<e.length;r++){let n=t.parse(e[r],r,Ee);if(!n)return null;a.push(n)}return new vt(n,a)}evaluate(e){for(let t=0;t<this.args.length;t++){let n=this.args[t].evaluate(e);if(!Fe(this.type,pt(n)))return n;if(t===this.args.length-1)throw new gt(`Expected value to be of type ${Ne(this.type)}, but found ${Ne(pt(n))} instead.`)}throw Error()}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}let yt={"to-boolean":Ce,"to-color":we,"to-number":xe,"to-string":Se};class bt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error(`Expected at least one argument.`);let n=e[0];if(!yt[n])throw Error(`Can't parse ${n} as it is not part of the known types`);if((n===`to-boolean`||n===`to-string`)&&e.length!==2)return t.error(`Expected one argument.`);let r=yt[n],i=[];for(let n=1;n<e.length;n++){let r=t.parse(e[n],n,Ee);if(!r)return null;i.push(r)}return new bt(r,i)}evaluate(e){switch(this.type.kind){case`boolean`:return!!this.args[0].evaluate(e);case`color`:{let t,n;for(let r of this.args){if(t=r.evaluate(e),n=null,t instanceof rt)return t;if(typeof t==`string`){let n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:dt(t[0],t[1],t[2],t[3]),!n))return new rt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new gt(n||`Could not parse color from value '${typeof t==`string`?t:JSON.stringify(t)}'`)}case`padding`:{let t;for(let n of this.args){t=n.evaluate(e);let r=st.parse(t);if(r)return r}throw new gt(`Could not parse padding from value '${typeof t==`string`?t:JSON.stringify(t)}'`)}case`variableAnchorOffsetCollection`:{let t;for(let n of this.args){t=n.evaluate(e);let r=lt.parse(t);if(r)return r}throw new gt(`Could not parse variableAnchorOffsetCollection from value '${typeof t==`string`?t:JSON.stringify(t)}'`)}case`number`:{let t=null;for(let n of this.args){if(t=n.evaluate(e),t===null)return 0;let r=Number(t);if(!isNaN(r))return r}throw new gt(`Could not convert ${JSON.stringify(t)} to number.`)}case`formatted`:return ot.fromString(mt(this.args[0].evaluate(e)));case`resolvedImage`:return ut.fromString(mt(this.args[0].evaluate(e)));default:return mt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}let xt=[`Unknown`,`Point`,`LineString`,`Polygon`];class St{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&`id`in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type==`number`?xt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&`geometry`in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||=this._parseColorCache[e]=rt.parse(e),t}}class Ct{constructor(e,t,n=[],r,i=new ye,a=[]){this.registry=e,this.path=n,this.key=n.map((e=>`[${e}]`)).join(``),this.scope=i,this.errors=a,this.expectedType=r,this._isConstant=t}parse(e,t,n,r,i={}){return t?this.concat(t,n,r)._parse(e,i):this._parse(e,i)}_parse(e,t){function n(e,t,n){return n===`assert`?new vt(t,[e]):n===`coerce`?new bt(t,[e]):e}if(e!==null&&typeof e!=`string`&&typeof e!=`boolean`&&typeof e!=`number`||(e=[`literal`,e]),Array.isArray(e)){if(e.length===0)return this.error(`Expected an array with at least one element. If you wanted a literal array, use ["literal", []].`);let r=e[0];if(typeof r!=`string`)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let i=this.registry[r];if(i){let r=i.parse(e,this);if(!r)return null;if(this.expectedType){let e=this.expectedType,i=r.type;if(e.kind!==`string`&&e.kind!==`number`&&e.kind!==`boolean`&&e.kind!==`object`&&e.kind!==`array`||i.kind!==`value`)if(e.kind!==`color`&&e.kind!==`formatted`&&e.kind!==`resolvedImage`||i.kind!==`value`&&i.kind!==`string`)if(e.kind!==`padding`||i.kind!==`value`&&i.kind!==`number`&&i.kind!==`array`)if(e.kind!==`variableAnchorOffsetCollection`||i.kind!==`value`&&i.kind!==`array`){if(this.checkSubtype(e,i))return null}else r=n(r,e,t.typeAnnotation||`coerce`);else r=n(r,e,t.typeAnnotation||`coerce`);else r=n(r,e,t.typeAnnotation||`coerce`);else r=n(r,e,t.typeAnnotation||`assert`)}if(!(r instanceof ht)&&r.type.kind!==`resolvedImage`&&this._isConstant(r)){let e=new St;try{r=new ht(r.type,r.evaluate(e))}catch(e){return this.error(e.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?`'undefined' value invalid. Use null instead.`:typeof e==`object`?`Bare objects invalid. Use ["literal", {...}] instead.`:`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){let r=typeof e==`number`?this.path.concat(e):this.path,i=n?this.scope.concat(n):this.scope;return new Ct(this.registry,this._isConstant,r,t||null,i,this.errors)}error(e,...t){let n=`${this.key}${t.map((e=>`[${e}]`)).join(``)}`;this.errors.push(new ve(n,e))}checkSubtype(e,t){let n=Fe(e,t);return n&&this.error(n),n}}class wt{constructor(e,t,n){this.type=De,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error(`Expected one argument.`);let n=e[1];if(typeof n!=`object`||Array.isArray(n))return t.error(`Collator options argument must be an object.`);let r=t.parse(n[`case-sensitive`]!==void 0&&n[`case-sensitive`],1,Ce);if(!r)return null;let i=t.parse(n[`diacritic-sensitive`]!==void 0&&n[`diacritic-sensitive`],1,Ce);if(!i)return null;let a=null;return n.locale&&(a=t.parse(n.locale,1,Se),!a)?null:new wt(r,i,a)}evaluate(e){return new it(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}let Tt=8192;function Et(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Dt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ot(e,t){let n=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=2**t.z;return[Math.round(n*i*Tt),Math.round(r*i*Tt)]}function kt(e,t,n){let r=e[0]-t[0],i=e[1]-t[1],a=e[0]-n[0],o=e[1]-n[1];return r*o-a*i==0&&r*a<=0&&i*o<=0}function At(e,t){let n=!1;for(let o=0,s=t.length;o<s;o++){let s=t[o];for(let t=0,o=s.length;t<o-1;t++){if(kt(e,s[t],s[t+1]))return!1;(i=s[t])[1]>(r=e)[1]!=(a=s[t+1])[1]>r[1]&&r[0]<(a[0]-i[0])*(r[1]-i[1])/(a[1]-i[1])+i[0]&&(n=!n)}}var r,i,a;return n}function jt(e,t){for(let n=0;n<t.length;n++)if(At(e,t[n]))return!0;return!1}function Mt(e,t,n,r){let i=r[0]-n[0],a=r[1]-n[1],o=(e[0]-n[0])*a-i*(e[1]-n[1]),s=(t[0]-n[0])*a-i*(t[1]-n[1]);return o>0&&s<0||o<0&&s>0}function Nt(e,t,n){for(let l of n)for(let n=0;n<l.length-1;++n)if((s=[(o=l[n+1])[0]-(a=l[n])[0],o[1]-a[1]])[0]*(c=[(i=t)[0]-(r=e)[0],i[1]-r[1]])[1]-s[1]*c[0]!=0&&Mt(r,i,a,o)&&Mt(a,o,r,i))return!0;var r,i,a,o,s,c;return!1}function Pt(e,t){for(let n=0;n<e.length;++n)if(!At(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(Nt(e[n],e[n+1],t))return!1;return!0}function Ft(e,t){for(let n=0;n<t.length;n++)if(Pt(e,t[n]))return!0;return!1}function It(e,t,n){let r=[];for(let i=0;i<e.length;i++){let a=[];for(let r=0;r<e[i].length;r++){let o=Ot(e[i][r],n);Et(t,o),a.push(o)}r.push(a)}return r}function Lt(e,t,n){let r=[];for(let i=0;i<e.length;i++){let a=It(e[i],t,n);r.push(a)}return r}function Rt(e,t,n,r){if(e[0]<n[0]||e[0]>n[2]){let t=.5*r,i=e[0]-n[0]>t?-r:n[0]-e[0]>t?r:0;i===0&&(i=e[0]-n[2]>t?-r:n[2]-e[0]>t?r:0),e[0]+=i}Et(t,e)}function zt(e,t,n,r){let i=2**r.z*Tt,a=[r.x*Tt,r.y*Tt],o=[];for(let r of e)for(let e of r){let r=[e.x+a[0],e.y+a[1]];Rt(r,t,n,i),o.push(r)}return o}function Bt(e,t,n,r){let i=2**r.z*Tt,a=[r.x*Tt,r.y*Tt],o=[];for(let n of e){let e=[];for(let r of n){let n=[r.x+a[0],r.y+a[1]];Et(t,n),e.push(n)}o.push(e)}if(t[2]-t[0]<=i/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(let e of o)for(let r of e)Rt(r,t,n,i)}var s;return o}class Vt{constructor(e,t){this.type=Ce,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ft(e[1])){let t=e[1];if(t.type===`FeatureCollection`)for(let e=0;e<t.features.length;++e){let n=t.features[e].geometry.type;if(n===`Polygon`||n===`MultiPolygon`)return new Vt(t,t.features[e].geometry)}else if(t.type===`Feature`){let e=t.geometry.type;if(e===`Polygon`||e===`MultiPolygon`)return new Vt(t,t.geometry)}else if(t.type===`Polygon`||t.type===`MultiPolygon`)return new Vt(t,t)}return t.error(`'within' expression requires valid geojson object that contains polygon geometry type.`)}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()===`Point`)return function(e,t){let n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(t.type===`Polygon`){let a=It(t.coordinates,r,i),o=zt(e.geometry(),n,r,i);if(!Dt(n,r))return!1;for(let e of o)if(!At(e,a))return!1}if(t.type===`MultiPolygon`){let a=Lt(t.coordinates,r,i),o=zt(e.geometry(),n,r,i);if(!Dt(n,r))return!1;for(let e of o)if(!jt(e,a))return!1}return!0}(e,this.geometries);if(e.geometryType()===`LineString`)return function(e,t){let n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(t.type===`Polygon`){let a=It(t.coordinates,r,i),o=Bt(e.geometry(),n,r,i);if(!Dt(n,r))return!1;for(let e of o)if(!Pt(e,a))return!1}if(t.type===`MultiPolygon`){let a=Lt(t.coordinates,r,i),o=Bt(e.geometry(),n,r,i);if(!Dt(n,r))return!1;for(let e of o)if(!Ft(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ht{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!=`string`)return t.error(`'var' expression requires exactly one string literal argument.`);let n=e[1];return t.scope.has(n)?new Ht(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Ut{constructor(e,t,n,r){this.name=e,this.type=t,this._evaluate=n,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){let n=e[0],r=Ut.definitions[n];if(!r)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);let i=Array.isArray(r)?r[0]:r.type,a=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,o=a.filter((([t])=>!Array.isArray(t)||t.length===e.length-1)),s=null;for(let[r,a]of o){s=new Ct(t.registry,Wt,t.path,null,t.scope);let o=[],c=!1;for(let t=1;t<e.length;t++){let n=e[t],i=Array.isArray(r)?r[t-1]:r.type,a=s.parse(n,1+o.length,i);if(!a){c=!0;break}o.push(a)}if(!c)if(Array.isArray(r)&&r.length!==o.length)s.error(`Expected ${r.length} arguments, but found ${o.length} instead.`);else{for(let e=0;e<o.length;e++){let t=Array.isArray(r)?r[e]:r.type,n=o[e];s.concat(e+1).checkSubtype(t,n.type)}if(s.errors.length===0)return new Ut(n,i,a,o)}}if(o.length===1)t.errors.push(...s.errors);else{let n=(o.length?o:a).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Ne).join(`, `)})`:`(${Ne(t.type)}...)`;var t})).join(` | `),r=[];for(let n=1;n<e.length;n++){let i=t.parse(e[n],1+r.length);if(!i)return null;r.push(Ne(i.type))}t.error(`Expected arguments of type ${n}, but found (${r.join(`, `)}) instead.`)}return null}static register(e,t){Ut.definitions=t;for(let n in t)e[n]=Ut}}function Wt(e){if(e instanceof Ht)return Wt(e.boundExpression);if(e instanceof Ut&&e.name===`error`||e instanceof wt||e instanceof Vt)return!1;let t=e instanceof bt||e instanceof vt,n=!0;return e.eachChild((e=>{n=t?n&&Wt(e):n&&e instanceof ht})),!!n&&Gt(e)&&qt(e,[`zoom`,`heatmap-density`,`line-progress`,`accumulated`,`is-supported-script`])}function Gt(e){if(e instanceof Ut&&(e.name===`get`&&e.args.length===1||e.name===`feature-state`||e.name===`has`&&e.args.length===1||e.name===`properties`||e.name===`geometry-type`||e.name===`id`||/^filter-/.test(e.name))||e instanceof Vt)return!1;let t=!0;return e.eachChild((e=>{t&&!Gt(e)&&(t=!1)})),t}function Kt(e){if(e instanceof Ut&&e.name===`feature-state`)return!1;let t=!0;return e.eachChild((e=>{t&&!Kt(e)&&(t=!1)})),t}function qt(e,t){if(e instanceof Ut&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild((e=>{n&&!qt(e,t)&&(n=!1)})),n}function Jt(e,t){let n=e.length-1,r,i,a=0,o=n,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),r=e[s],i=e[s+1],r<=t){if(s===n||t<i)return s;a=s+1}else{if(!(r>t))throw new gt(`Input is not a number.`);o=s-1}return 0}class Yt{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(let[e,t]of n)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error(`Expected an even number of arguments.`);let n=t.parse(e[1],1,xe);if(!n)return null;let r=[],i=null;t.expectedType&&t.expectedType.kind!==`value`&&(i=t.expectedType);for(let n=1;n<e.length;n+=2){let a=n===1?-1/0:e[n],o=e[n+1],s=n,c=n+1;if(typeof a!=`number`)return t.error(`Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.`,s);if(r.length&&r[r.length-1][0]>=a)return t.error(`Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.`,s);let l=t.parse(o,c,i);if(!l)return null;i||=l.type,r.push([a,l])}return new Yt(i,n,r)}evaluate(e){let t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);let r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);let i=t.length;return r>=t[i-1]?n[i-1].evaluate(e):n[Jt(t,r)].evaluate(e)}eachChild(e){e(this.input);for(let t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Xt(e,t,n){return e+n*(t-e)}function Zt(e,t,n){return e.map(((e,r)=>Xt(e,t[r],n)))}let Qt={number:Xt,color:function(e,t,n,r=`rgb`){switch(r){case`rgb`:{let[r,i,a,o]=Zt(e.rgb,t.rgb,n);return new rt(r,i,a,o,!1)}case`hcl`:{let[r,i,a,o]=e.hcl,[s,c,l,u]=t.hcl,d,f;if(isNaN(r)||isNaN(s))isNaN(r)?isNaN(s)?d=NaN:(d=s,a!==1&&a!==0||(f=c)):(d=r,l!==1&&l!==0||(f=i));else{let e=s-r;s>r&&e>180?e-=360:s<r&&r-s>180&&(e+=360),d=r+n*e}let[p,m,h,g]=function([e,t,n,r]){return e=isNaN(e)?0:e*Ue,Ye([n,Math.cos(e)*t,Math.sin(e)*t,r])}([d,f??Xt(i,c,n),Xt(a,l,n),Xt(o,u,n)]);return new rt(p,m,h,g,!1)}case`lab`:{let[r,i,a,o]=Ye(Zt(e.lab,t.lab,n));return new rt(r,i,a,o,!1)}}},array:Zt,padding:function(e,t,n){return new st(Zt(e.values,t.values,n))},variableAnchorOffsetCollection:function(e,t,n){let r=e.values,i=t.values;if(r.length!==i.length)throw new gt(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);let a=[];for(let e=0;e<r.length;e+=2){if(r[e]!==i[e])throw new gt(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${r[e]}, to[${e}]: ${i[e]}`);a.push(r[e]);let[t,o]=r[e+1],[s,c]=i[e+1];a.push([Xt(t,s,n),Xt(o,c,n)])}return new lt(a)}};class $t{constructor(e,t,n,r,i){this.type=e,this.operator=t,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(let[e,t]of i)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,n,r){let i=0;if(e.name===`exponential`)i=en(t,e.base,n,r);else if(e.name===`linear`)i=en(t,1,n,r);else if(e.name===`cubic-bezier`){let a=e.controlPoints;i=new c(a[0],a[1],a[2],a[3]).solve(en(t,1,n,r))}return i}static parse(e,t){let[n,r,i,...a]=e;if(!Array.isArray(r)||r.length===0)return t.error(`Expected an interpolation type expression.`,1);if(r[0]===`linear`)r={name:`linear`};else if(r[0]===`exponential`){let e=r[1];if(typeof e!=`number`)return t.error(`Exponential interpolation requires a numeric base.`,1,1);r={name:`exponential`,base:e}}else{if(r[0]!==`cubic-bezier`)return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{let e=r.slice(1);if(e.length!==4||e.some((e=>typeof e!=`number`||e<0||e>1)))return t.error(`Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.`,1);r={name:`cubic-bezier`,controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error(`Expected an even number of arguments.`);if(i=t.parse(i,2,xe),!i)return null;let o=[],s=null;n===`interpolate-hcl`||n===`interpolate-lab`?s=we:t.expectedType&&t.expectedType.kind!==`value`&&(s=t.expectedType);for(let e=0;e<a.length;e+=2){let n=a[e],r=a[e+1],i=e+3,c=e+4;if(typeof n!=`number`)return t.error(`Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.`,i);if(o.length&&o[o.length-1][0]>=n)return t.error(`Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.`,i);let l=t.parse(r,c,s);if(!l)return null;s||=l.type,o.push([n,l])}return q(s,xe)||q(s,we)||q(s,ke)||q(s,je)||q(s,Me(xe))?new $t(s,n,r,i,o):t.error(`Type ${Ne(s)} is not interpolatable.`)}evaluate(e){let t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);let r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);let i=t.length;if(r>=t[i-1])return n[i-1].evaluate(e);let a=Jt(t,r),o=$t.interpolationFactor(this.interpolation,r,t[a],t[a+1]),s=n[a].evaluate(e),c=n[a+1].evaluate(e);switch(this.operator){case`interpolate`:return Qt[this.type.kind](s,c,o);case`interpolate-hcl`:return Qt.color(s,c,o,`hcl`);case`interpolate-lab`:return Qt.color(s,c,o,`lab`)}}eachChild(e){e(this.input);for(let t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function en(e,t,n,r){let i=r-n,a=e-n;return i===0?0:t===1?a/i:(t**+a-1)/(t**+i-1)}class tn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error(`Expectected at least one argument.`);let n=null,r=t.expectedType;r&&r.kind!==`value`&&(n=r);let i=[];for(let r of e.slice(1)){let e=t.parse(r,1+i.length,n,void 0,{typeAnnotation:`omit`});if(!e)return null;n||=e.type,i.push(e)}if(!n)throw Error(`No output type`);return new tn(r&&i.some((e=>Fe(r,e.type)))?Ee:n,i)}evaluate(e){let t,n=null,r=0;for(let i of this.args)if(r++,n=i.evaluate(e),n&&n instanceof ut&&!n.available&&(t||=n.name,n=null,r===this.args.length&&(n=t)),n!==null)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}class nn{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let n=[];for(let r=1;r<e.length-1;r+=2){let i=e[r];if(typeof i!=`string`)return t.error(`Expected string, but found ${typeof i} instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return t.error(`Variable names must contain only alphanumeric characters or '_'.`,r);let a=t.parse(e[r+1],r+1);if(!a)return null;n.push([i,a])}let r=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return r?new nn(n,r):null}outputDefined(){return this.result.outputDefined()}}class rn{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let n=t.parse(e[1],1,xe),r=t.parse(e[2],2,Me(t.expectedType||Ee));return n&&r?new rn(r.type.itemType,n,r):null}evaluate(e){let t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new gt(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new gt(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new gt(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class an{constructor(e,t){this.type=Ce,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let n=t.parse(e[1],1,Ee),r=t.parse(e[2],2,Ee);return n&&r?Ie(n.type,[Ce,Se,xe,be,Ee])?new an(n,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ne(n.type)} instead`):null}evaluate(e){let t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!Le(t,[`boolean`,`string`,`number`,`null`]))throw new gt(`Expected first argument to be of type boolean, string, number or null, but found ${Ne(pt(t))} instead.`);if(!Le(n,[`string`,`array`]))throw new gt(`Expected second argument to be of type array or string, but found ${Ne(pt(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class on{constructor(e,t,n){this.type=xe,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let n=t.parse(e[1],1,Ee),r=t.parse(e[2],2,Ee);if(!n||!r)return null;if(!Ie(n.type,[Ce,Se,xe,be,Ee]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ne(n.type)} instead`);if(e.length===4){let i=t.parse(e[3],3,xe);return i?new on(n,r,i):null}return new on(n,r)}evaluate(e){let t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Le(t,[`boolean`,`string`,`number`,`null`]))throw new gt(`Expected first argument to be of type boolean, string, number or null, but found ${Ne(pt(t))} instead.`);if(!Le(n,[`string`,`array`]))throw new gt(`Expected second argument to be of type array or string, but found ${Ne(pt(n))} instead.`);if(this.fromIndex){let r=this.fromIndex.evaluate(e);return n.indexOf(t,r)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class sn{constructor(e,t,n,r,i,a){this.inputType=e,this.type=t,this.input=n,this.cases=r,this.outputs=i,this.otherwise=a}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error(`Expected an even number of arguments.`);let n,r;t.expectedType&&t.expectedType.kind!==`value`&&(r=t.expectedType);let i={},a=[];for(let o=2;o<e.length-1;o+=2){let s=e[o],c=e[o+1];Array.isArray(s)||(s=[s]);let l=t.concat(o);if(s.length===0)return l.error(`Expected at least one branch label.`);for(let e of s){if(typeof e!=`number`&&typeof e!=`string`)return l.error(`Branch labels must be numbers or strings.`);if(typeof e==`number`&&Math.abs(e)>2**53-1)return l.error(`Branch labels must be integers no larger than ${2**53-1}.`);if(typeof e==`number`&&Math.floor(e)!==e)return l.error(`Numeric branch labels must be integer values.`);if(n){if(l.checkSubtype(n,pt(e)))return null}else n=pt(e);if(i[String(e)]!==void 0)return l.error(`Branch labels must be unique.`);i[String(e)]=a.length}let u=t.parse(c,o,r);if(!u)return null;r||=u.type,a.push(u)}let o=t.parse(e[1],1,Ee);if(!o)return null;let s=t.parse(e[e.length-1],e.length-1,r);return s?o.type.kind!==`value`&&t.concat(1).checkSubtype(n,o.type)?null:new sn(n,r,o,i,a,s):null}evaluate(e){let t=this.input.evaluate(e);return(pt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class cn{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error(`Expected an odd number of arguments.`);let n;t.expectedType&&t.expectedType.kind!==`value`&&(n=t.expectedType);let r=[];for(let i=1;i<e.length-1;i+=2){let a=t.parse(e[i],i,Ce);if(!a)return null;let o=t.parse(e[i+1],i+1,n);if(!o)return null;r.push([a,o]),n||=o.type}let i=t.parse(e[e.length-1],e.length-1,n);if(!i)return null;if(!n)throw Error(`Can't infer output type`);return new cn(n,r,i)}evaluate(e){for(let[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ln{constructor(e,t,n,r){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let n=t.parse(e[1],1,Ee),r=t.parse(e[2],2,xe);if(!n||!r)return null;if(!Ie(n.type,[Me(Ee),Se,Ee]))return t.error(`Expected first argument to be of type array or string, but found ${Ne(n.type)} instead`);if(e.length===4){let i=t.parse(e[3],3,xe);return i?new ln(n.type,n,r,i):null}return new ln(n.type,n,r)}evaluate(e){let t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Le(t,[`string`,`array`]))throw new gt(`Expected first argument to be of type array or string, but found ${Ne(pt(t))} instead.`);if(this.endIndex){let r=this.endIndex.evaluate(e);return t.slice(n,r)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function un(e,t){return e===`==`||e===`!=`?t.kind===`boolean`||t.kind===`string`||t.kind===`number`||t.kind===`null`||t.kind===`value`:t.kind===`string`||t.kind===`number`||t.kind===`value`}function dn(e,t,n,r){return r.compare(t,n)===0}function fn(e,t,n){let r=e!==`==`&&e!==`!=`;return class i{constructor(e,t,n){this.type=Ce,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument=e.type.kind===`value`||t.type.kind===`value`}static parse(e,t){if(e.length!==3&&e.length!==4)return t.error(`Expected two or three arguments.`);let n=e[0],a=t.parse(e[1],1,Ee);if(!a)return null;if(!un(n,a.type))return t.concat(1).error(`"${n}" comparisons are not supported for type '${Ne(a.type)}'.`);let o=t.parse(e[2],2,Ee);if(!o)return null;if(!un(n,o.type))return t.concat(2).error(`"${n}" comparisons are not supported for type '${Ne(o.type)}'.`);if(a.type.kind!==o.type.kind&&a.type.kind!==`value`&&o.type.kind!==`value`)return t.error(`Cannot compare types '${Ne(a.type)}' and '${Ne(o.type)}'.`);r&&(a.type.kind===`value`&&o.type.kind!==`value`?a=new vt(o.type,[a]):a.type.kind!==`value`&&o.type.kind===`value`&&(o=new vt(a.type,[o])));let s=null;if(e.length===4){if(a.type.kind!==`string`&&o.type.kind!==`string`&&a.type.kind!==`value`&&o.type.kind!==`value`)return t.error(`Cannot use collator to compare non-string types.`);if(s=t.parse(e[3],3,De),!s)return null}return new i(a,o,s)}evaluate(i){let a=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){let t=pt(a),n=pt(o);if(t.kind!==n.kind||t.kind!==`string`&&t.kind!==`number`)throw new gt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${n.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){let e=pt(a),n=pt(o);if(e.kind!==`string`||n.kind!==`string`)return t(i,a,o)}return this.collator?n(i,a,o,this.collator.evaluate(i)):t(i,a,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}let pn=fn(`==`,(function(e,t,n){return t===n}),dn),mn=fn(`!=`,(function(e,t,n){return t!==n}),(function(e,t,n,r){return!dn(0,t,n,r)})),hn=fn(`<`,(function(e,t,n){return t<n}),(function(e,t,n,r){return r.compare(t,n)<0})),gn=fn(`>`,(function(e,t,n){return t>n}),(function(e,t,n,r){return r.compare(t,n)>0})),_n=fn(`<=`,(function(e,t,n){return t<=n}),(function(e,t,n,r){return r.compare(t,n)<=0})),vn=fn(`>=`,(function(e,t,n){return t>=n}),(function(e,t,n,r){return r.compare(t,n)>=0}));class yn{constructor(e,t,n,r,i){this.type=Se,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i}static parse(e,t){if(e.length!==3)return t.error(`Expected two arguments.`);let n=t.parse(e[1],1,xe);if(!n)return null;let r=e[2];if(typeof r!=`object`||Array.isArray(r))return t.error(`NumberFormat options argument must be an object.`);let i=null;if(r.locale&&(i=t.parse(r.locale,1,Se),!i))return null;let a=null;if(r.currency&&(a=t.parse(r.currency,1,Se),!a))return null;let o=null;if(r[`min-fraction-digits`]&&(o=t.parse(r[`min-fraction-digits`],1,xe),!o))return null;let s=null;return r[`max-fraction-digits`]&&(s=t.parse(r[`max-fraction-digits`],1,xe),!s)?null:new yn(n,i,a,o,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?`currency`:`decimal`,currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class bn{constructor(e){this.type=Oe,this.sections=e}static parse(e,t){if(e.length<2)return t.error(`Expected at least one argument.`);let n=e[1];if(!Array.isArray(n)&&typeof n==`object`)return t.error(`First argument must be an image or text section.`);let r=[],i=!1;for(let n=1;n<=e.length-1;++n){let a=e[n];if(i&&typeof a==`object`&&!Array.isArray(a)){i=!1;let e=null;if(a[`font-scale`]&&(e=t.parse(a[`font-scale`],1,xe),!e))return null;let n=null;if(a[`text-font`]&&(n=t.parse(a[`text-font`],1,Me(Se)),!n))return null;let o=null;if(a[`text-color`]&&(o=t.parse(a[`text-color`],1,we),!o))return null;let s=r[r.length-1];s.scale=e,s.font=n,s.textColor=o}else{let a=t.parse(e[n],1,Ee);if(!a)return null;let o=a.type.kind;if(o!==`string`&&o!==`value`&&o!==`null`&&o!==`resolvedImage`)return t.error(`Formatted text type must be 'string', 'value', 'image' or 'null'.`);i=!0,r.push({content:a,scale:null,font:null,textColor:null})}}return new bn(r)}evaluate(e){return new ot(this.sections.map((t=>{let n=t.content.evaluate(e);return pt(n)===Ae?new at(``,n,null,null,null):new at(mt(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(`,`):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(let t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}}class xn{constructor(e){this.type=Ae,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected two arguments.`);let n=t.parse(e[1],1,Se);return n?new xn(n):t.error(`No image name provided.`)}evaluate(e){let t=this.input.evaluate(e),n=ut.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class Sn{constructor(e){this.type=xe,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);let n=t.parse(e[1],1);return n?n.type.kind!==`array`&&n.type.kind!==`string`&&n.type.kind!==`value`?t.error(`Expected argument of type string or array, but found ${Ne(n.type)} instead.`):new Sn(n):null}evaluate(e){let t=this.input.evaluate(e);if(typeof t==`string`||Array.isArray(t))return t.length;throw new gt(`Expected value to be of type string or array, but found ${Ne(pt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}let Cn={"==":pn,"!=":mn,">":gn,"<":hn,">=":vn,"<=":_n,array:vt,at:rn,boolean:vt,case:cn,coalesce:tn,collator:wt,format:bn,image:xn,in:an,"index-of":on,interpolate:$t,"interpolate-hcl":$t,"interpolate-lab":$t,length:Sn,let:nn,literal:ht,match:sn,number:vt,"number-format":yn,object:vt,slice:ln,step:Yt,string:vt,"to-boolean":bt,"to-color":bt,"to-number":bt,"to-string":bt,var:Ht,within:Vt};function wn(e,[t,n,r,i]){t=t.evaluate(e),n=n.evaluate(e),r=r.evaluate(e);let a=i?i.evaluate(e):1,o=dt(t,n,r,a);if(o)throw new gt(o);return new rt(t/255,n/255,r/255,a,!1)}function Tn(e,t){return e in t}function En(e,t){let n=t[e];return n===void 0?null:n}function Dn(e){return{type:e}}function On(e){return{result:`success`,value:e}}function kn(e){return{result:`error`,value:e}}function An(e){return e[`property-type`]===`data-driven`||e[`property-type`]===`cross-faded-data-driven`}function jn(e){return!!e.expression&&e.expression.parameters.indexOf(`zoom`)>-1}function Mn(e){return!!e.expression&&e.expression.interpolated}function Nn(e){return e instanceof Number?`number`:e instanceof String?`string`:e instanceof Boolean?`boolean`:Array.isArray(e)?`array`:e===null?`null`:typeof e}function Pn(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}function Fn(e){return e}function In(e,t){let n=t.type===`color`,r=e.stops&&typeof e.stops[0][0]==`object`,i=r||!(r||e.property!==void 0),a=e.type||(Mn(t)?`exponential`:`interval`);if(n||t.type===`padding`){let r=n?rt.parse:st.parse;(e=K({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],r(e[1])]))),e.default=r(e.default?e.default:t.default)}if(e.colorSpace&&(o=e.colorSpace)!==`rgb`&&o!==`hcl`&&o!==`lab`)throw Error(`Unknown color space: "${e.colorSpace}"`);var o;let s,c,l;if(a===`exponential`)s=Bn;else if(a===`interval`)s=zn;else if(a===`categorical`){s=Rn,c=Object.create(null);for(let t of e.stops)c[t[0]]=t[1];l=typeof e.stops[0][0]}else{if(a!==`identity`)throw Error(`Unknown function type "${a}"`);s=Vn}if(r){let n={},r=[];for(let t=0;t<e.stops.length;t++){let i=e.stops[t],a=i[0].zoom;n[a]===void 0&&(n[a]={zoom:a,type:e.type,property:e.property,default:e.default,stops:[]},r.push(a)),n[a].stops.push([i[0].value,i[1]])}let i=[];for(let e of r)i.push([n[e].zoom,In(n[e],t)]);let a={name:`linear`};return{kind:`composite`,interpolationType:a,interpolationFactor:$t.interpolationFactor.bind(void 0,a),zoomStops:i.map((e=>e[0])),evaluate:({zoom:n},r)=>Bn({stops:i,base:e.base},t,n).evaluate(n,r)}}if(i){let n=a===`exponential`?{name:`exponential`,base:e.base===void 0?1:e.base}:null;return{kind:`camera`,interpolationType:n,interpolationFactor:$t.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:n})=>s(e,t,n,c,l)}}return{kind:`source`,evaluate(n,r){let i=r&&r.properties?r.properties[e.property]:void 0;return i===void 0?Ln(e.default,t.default):s(e,t,i,c,l)}}}function Ln(e,t,n){return e===void 0?t===void 0?n===void 0?void 0:n:t:e}function Rn(e,t,n,r,i){return Ln(typeof n===i?r[n]:void 0,e.default,t.default)}function zn(e,t,n){if(Nn(n)!==`number`)return Ln(e.default,t.default);let r=e.stops.length;if(r===1||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];let i=Jt(e.stops.map((e=>e[0])),n);return e.stops[i][1]}function Bn(e,t,n){let r=e.base===void 0?1:e.base;if(Nn(n)!==`number`)return Ln(e.default,t.default);let i=e.stops.length;if(i===1||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];let a=Jt(e.stops.map((e=>e[0])),n),o=function(e,t,n,r){let i=r-n,a=e-n;return i===0?0:t===1?a/i:(t**+a-1)/(t**+i-1)}(n,r,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],c=e.stops[a+1][1],l=Qt[t.type]||Fn;return typeof s.evaluate==`function`?{evaluate(...t){let n=s.evaluate.apply(void 0,t),r=c.evaluate.apply(void 0,t);if(n!==void 0&&r!==void 0)return l(n,r,o,e.colorSpace)}}:l(s,c,o,e.colorSpace)}function Vn(e,t,n){switch(t.type){case`color`:n=rt.parse(n);break;case`formatted`:n=ot.fromString(n.toString());break;case`resolvedImage`:n=ut.fromString(n.toString());break;case`padding`:n=st.parse(n);break;default:Nn(n)===t.type||t.type===`enum`&&t.values[n]||(n=void 0)}return Ln(n,e.default,t.default)}Ut.register(Cn,{error:[{kind:`error`},[Se],(e,[t])=>{throw new gt(t.evaluate(e))}],typeof:[Se,[Ee],(e,[t])=>Ne(pt(t.evaluate(e)))],"to-rgba":[Me(xe,4),[we],(e,[t])=>{let[n,r,i,a]=t.evaluate(e).rgb;return[255*n,255*r,255*i,a]}],rgb:[we,[xe,xe,xe],wn],rgba:[we,[xe,xe,xe,xe],wn],has:{type:Ce,overloads:[[[Se],(e,[t])=>Tn(t.evaluate(e),e.properties())],[[Se,Te],(e,[t,n])=>Tn(t.evaluate(e),n.evaluate(e))]]},get:{type:Ee,overloads:[[[Se],(e,[t])=>En(t.evaluate(e),e.properties())],[[Se,Te],(e,[t,n])=>En(t.evaluate(e),n.evaluate(e))]]},"feature-state":[Ee,[Se],(e,[t])=>En(t.evaluate(e),e.featureState||{})],properties:[Te,[],e=>e.properties()],"geometry-type":[Se,[],e=>e.geometryType()],id:[Ee,[],e=>e.id()],zoom:[xe,[],e=>e.globals.zoom],"heatmap-density":[xe,[],e=>e.globals.heatmapDensity||0],"line-progress":[xe,[],e=>e.globals.lineProgress||0],accumulated:[Ee,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[xe,Dn(xe),(e,t)=>{let n=0;for(let r of t)n+=r.evaluate(e);return n}],"*":[xe,Dn(xe),(e,t)=>{let n=1;for(let r of t)n*=r.evaluate(e);return n}],"-":{type:xe,overloads:[[[xe,xe],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[xe],(e,[t])=>-t.evaluate(e)]]},"/":[xe,[xe,xe],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[xe,[xe,xe],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[xe,[],()=>Math.LN2],pi:[xe,[],()=>Math.PI],e:[xe,[],()=>Math.E],"^":[xe,[xe,xe],(e,[t,n])=>t.evaluate(e)**+n.evaluate(e)],sqrt:[xe,[xe],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[xe,[xe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[xe,[xe],(e,[t])=>Math.log(t.evaluate(e))],log2:[xe,[xe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[xe,[xe],(e,[t])=>Math.sin(t.evaluate(e))],cos:[xe,[xe],(e,[t])=>Math.cos(t.evaluate(e))],tan:[xe,[xe],(e,[t])=>Math.tan(t.evaluate(e))],asin:[xe,[xe],(e,[t])=>Math.asin(t.evaluate(e))],acos:[xe,[xe],(e,[t])=>Math.acos(t.evaluate(e))],atan:[xe,[xe],(e,[t])=>Math.atan(t.evaluate(e))],min:[xe,Dn(xe),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[xe,Dn(xe),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[xe,[xe],(e,[t])=>Math.abs(t.evaluate(e))],round:[xe,[xe],(e,[t])=>{let n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[xe,[xe],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[xe,[xe],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Ce,[Se,Ee],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[Ce,[Ee],(e,[t])=>e.id()===t.value],"filter-type-==":[Ce,[Se],(e,[t])=>e.geometryType()===t.value],"filter-<":[Ce,[Se,Ee],(e,[t,n])=>{let r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r<i}],"filter-id-<":[Ce,[Ee],(e,[t])=>{let n=e.id(),r=t.value;return typeof n==typeof r&&n<r}],"filter->":[Ce,[Se,Ee],(e,[t,n])=>{let r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r>i}],"filter-id->":[Ce,[Ee],(e,[t])=>{let n=e.id(),r=t.value;return typeof n==typeof r&&n>r}],"filter-<=":[Ce,[Se,Ee],(e,[t,n])=>{let r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[Ce,[Ee],(e,[t])=>{let n=e.id(),r=t.value;return typeof n==typeof r&&n<=r}],"filter->=":[Ce,[Se,Ee],(e,[t,n])=>{let r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[Ce,[Ee],(e,[t])=>{let n=e.id(),r=t.value;return typeof n==typeof r&&n>=r}],"filter-has":[Ce,[Ee],(e,[t])=>t.value in e.properties()],"filter-has-id":[Ce,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[Ce,[Me(Se)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Ce,[Me(Ee)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Ce,[Se,Me(Ee)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Ce,[Se,Me(Ee)],(e,[t,n])=>function(e,t,n,r){for(;n<=r;){let i=n+r>>1;if(t[i]===e)return!0;t[i]>e?r=i-1:n=i+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Ce,overloads:[[[Ce,Ce],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[Dn(Ce),(e,t)=>{for(let n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Ce,overloads:[[[Ce,Ce],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[Dn(Ce),(e,t)=>{for(let n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Ce,[Ce],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Ce,[Se],(e,[t])=>{let n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[Se,[Se],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Se,[Se],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Se,Dn(Ee),(e,t)=>t.map((t=>mt(t.evaluate(e)))).join(``)],"resolved-locale":[Se,[De],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Hn{constructor(e,t){var n;this.expression=e,this._warningHistory={},this._evaluator=new St,this._defaultValue=t?(n=t).type===`color`&&Pn(n.default)?new rt(0,0,0,0):n.type===`color`?rt.parse(n.default)||null:n.type===`padding`?st.parse(n.default)||null:n.type===`variableAnchorOffsetCollection`?lt.parse(n.default)||null:n.default===void 0?null:n.default:null,this._enumValues=t&&t.type===`enum`?t.values:null}evaluateWithoutErrorHandling(e,t,n,r,i,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,r,i,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a||null;try{let e=this.expression.evaluate(this._evaluator);if(e==null||typeof e==`number`&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new gt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(`, `)}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,typeof console<`u`&&console.warn(e.message)),this._defaultValue}}}function Un(e){return Array.isArray(e)&&e.length>0&&typeof e[0]==`string`&&e[0]in Cn}function Wn(e,t){let n=new Ct(Cn,Wt,[],t?function(e){let t={color:we,string:Se,number:xe,enum:Se,boolean:Ce,formatted:Oe,padding:ke,resolvedImage:Ae,variableAnchorOffsetCollection:je};return e.type===`array`?Me(t[e.value]||Ee,e.length):t[e.type]}(t):void 0),r=n.parse(e,void 0,void 0,void 0,t&&t.type===`string`?{typeAnnotation:`coerce`}:void 0);return r?On(new Hn(r,t)):kn(n.errors)}class Gn{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!==`constant`&&!Kt(t.expression)}evaluateWithoutErrorHandling(e,t,n,r,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,a)}evaluate(e,t,n,r,i,a){return this._styleExpression.evaluate(e,t,n,r,i,a)}}class Kn{constructor(e,t,n,r){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!==`camera`&&!Kt(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,n,r,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,a)}evaluate(e,t,n,r,i,a){return this._styleExpression.evaluate(e,t,n,r,i,a)}interpolationFactor(e,t,n){return this.interpolationType?$t.interpolationFactor(this.interpolationType,e,t,n):0}}function qn(e,t){let n=Wn(e,t);if(n.result===`error`)return n;let r=n.value.expression,i=Gt(r);if(!i&&!An(t))return kn([new ve(``,`data expressions not supported`)]);let a=qt(r,[`zoom`]);if(!a&&!jn(t))return kn([new ve(``,`zoom expressions not supported`)]);let o=Yn(r);return o||a?o instanceof ve?kn([o]):o instanceof $t&&!Mn(t)?kn([new ve(``,`"interpolate" expressions cannot be used with this property`)]):On(o?new Kn(i?`camera`:`composite`,n.value,o.labels,o instanceof $t?o.interpolation:void 0):new Gn(i?`constant`:`source`,n.value)):kn([new ve(``,`"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.`)])}class Jn{constructor(e,t){this._parameters=e,this._specification=t,K(this,In(this._parameters,this._specification))}static deserialize(e){return new Jn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yn(e){let t=null;if(e instanceof nn)t=Yn(e.result);else if(e instanceof tn){for(let n of e.args)if(t=Yn(n),t)break}else (e instanceof Yt||e instanceof $t)&&e.input instanceof Ut&&e.input.name===`zoom`&&(t=e);return t instanceof ve||e.eachChild((e=>{let n=Yn(e);n instanceof ve?t=n:!t&&n?t=new ve(``,`"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.`):t&&n&&t!==n&&(t=new ve(``,`Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.`))})),t}function Xn(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case`has`:return e.length>=2&&e[1]!==`$id`&&e[1]!==`$type`;case`in`:return e.length>=3&&(typeof e[1]!=`string`||Array.isArray(e[2]));case`!in`:case`!has`:case`none`:return!1;case`==`:case`!=`:case`>`:case`>=`:case`<`:case`<=`:return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case`any`:case`all`:for(let t of e.slice(1))if(!Xn(t)&&typeof t!=`boolean`)return!1;return!0;default:return!0}}let Zn={type:`boolean`,default:!1,transition:!1,"property-type":`data-driven`,expression:{interpolated:!1,parameters:[`zoom`,`feature`]}};function Qn(e){if(e==null)return{filter:()=>!0,needGeometry:!1};Xn(e)||(e=tr(e));let t=Wn(e,Zn);if(t.result===`error`)throw Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(`, `));return{filter:(e,n,r)=>t.value.evaluate(e,n,{},r),needGeometry:er(e)}}function $n(e,t){return e<t?-1:e>t?1:0}function er(e){if(!Array.isArray(e))return!1;if(e[0]===`within`)return!0;for(let t=1;t<e.length;t++)if(er(e[t]))return!0;return!1}function tr(e){if(!e)return!0;let t=e[0];return e.length<=1?t!==`any`:t===`==`?nr(e[1],e[2],`==`):t===`!=`?ar(nr(e[1],e[2],`==`)):t===`<`||t===`>`||t===`<=`||t===`>=`?nr(e[1],e[2],t):t===`any`?(n=e.slice(1),[`any`].concat(n.map(tr))):t===`all`?[`all`].concat(e.slice(1).map(tr)):t===`none`?[`all`].concat(e.slice(1).map(tr).map(ar)):t===`in`?rr(e[1],e.slice(2)):t===`!in`?ar(rr(e[1],e.slice(2))):t===`has`?ir(e[1]):t===`!has`?ar(ir(e[1])):t!==`within`||e;var n}function nr(e,t,n){switch(e){case`$type`:return[`filter-type-${n}`,t];case`$id`:return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function rr(e,t){if(t.length===0)return!1;switch(e){case`$type`:return[`filter-type-in`,[`literal`,t]];case`$id`:return[`filter-id-in`,[`literal`,t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?[`filter-in-large`,e,[`literal`,t.sort($n)]]:[`filter-in-small`,e,[`literal`,t]]}}function ir(e){switch(e){case`$type`:return!0;case`$id`:return[`filter-has-id`];default:return[`filter-has`,e]}}function ar(e){return[`!`,e]}function or(e){let t=typeof e;if(t===`number`||t===`boolean`||t===`string`||e==null)return JSON.stringify(e);if(Array.isArray(e)){let t=`[`;for(let n of e)t+=`${or(n)},`;return`${t}]`}let n=Object.keys(e).sort(),r=`{`;for(let t=0;t<n.length;t++)r+=`${JSON.stringify(n[t])}:${or(e[n[t]])},`;return`${r}}`}function sr(e){let t=``;for(let n of le)t+=`/${or(e[n])}`;return t}function cr(e){let t=e.value;return t?[new G(e.key,t,`constants have been deprecated as of v8`)]:[]}function lr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function ur(e){if(Array.isArray(e))return e.map(ur);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){let t={};for(let n in e)t[n]=ur(e[n]);return t}return lr(e)}function dr(e){let t=e.key,n=e.value,r=e.valueSpec||{},i=e.objectElementValidators||{},a=e.style,o=e.styleSpec,s=e.validateSpec,c=[],l=Nn(n);if(l!==`object`)return[new G(t,n,`object expected, ${l} found`)];for(let e in n){let l=e.split(`.`)[0],u=r[l]||r[`*`],d;if(i[l])d=i[l];else if(r[l])d=s;else if(i[`*`])d=i[`*`];else{if(!r[`*`]){c.push(new G(t,n[e],`unknown property "${e}"`));continue}d=s}c=c.concat(d({key:(t&&`${t}.`)+e,value:n[e],valueSpec:u,style:a,styleSpec:o,object:n,objectKey:e,validateSpec:s},n))}for(let e in r)i[e]||r[e].required&&r[e].default===void 0&&n[e]===void 0&&c.push(new G(t,n,`missing required property "${e}"`));return c}function fr(e){let t=e.value,n=e.valueSpec,r=e.style,i=e.styleSpec,a=e.key,o=e.arrayElementValidator||e.validateSpec;if(Nn(t)!==`array`)return[new G(a,t,`array expected, ${Nn(t)} found`)];if(n.length&&t.length!==n.length)return[new G(a,t,`array length ${n.length} expected, length ${t.length} found`)];if(n[`min-length`]&&t.length<n[`min-length`])return[new G(a,t,`array length at least ${n[`min-length`]} expected, length ${t.length} found`)];let s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),Nn(n.value)===`object`&&(s=n.value);let c=[];for(let n=0;n<t.length;n++)c=c.concat(o({array:t,arrayIndex:n,value:t[n],valueSpec:s,validateSpec:e.validateSpec,style:r,styleSpec:i,key:`${a}[${n}]`}));return c}function pr(e){let t=e.key,n=e.value,r=e.valueSpec,i=Nn(n);return i===`number`&&n!=n&&(i=`NaN`),i===`number`?`minimum`in r&&n<r.minimum?[new G(t,n,`${n} is less than the minimum value ${r.minimum}`)]:`maximum`in r&&n>r.maximum?[new G(t,n,`${n} is greater than the maximum value ${r.maximum}`)]:[]:[new G(t,n,`number expected, ${i} found`)]}function mr(e){let t=e.valueSpec,n=lr(e.value.type),r,i,a,o={},s=n!==`categorical`&&e.value.property===void 0,c=!s,l=Nn(e.value.stops)===`array`&&Nn(e.value.stops[0])===`array`&&Nn(e.value.stops[0][0])===`object`,u=dr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if(n===`identity`)return[new G(e.key,e.value,`identity function may not have a "stops" property`)];let t=[],r=e.value;return t=t.concat(fr({key:e.key,value:r,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:d})),Nn(r)===`array`&&r.length===0&&t.push(new G(e.key,r,`array must have at least one stop`)),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return n===`identity`&&s&&u.push(new G(e.key,e.value,`missing required property "property"`)),n===`identity`||e.value.stops||u.push(new G(e.key,e.value,`missing required property "stops"`)),n===`exponential`&&e.valueSpec.expression&&!Mn(e.valueSpec)&&u.push(new G(e.key,e.value,`exponential functions not supported`)),e.styleSpec.$version>=8&&(c&&!An(e.valueSpec)?u.push(new G(e.key,e.value,`property functions not supported`)):s&&!jn(e.valueSpec)&&u.push(new G(e.key,e.value,`zoom functions not supported`))),n!==`categorical`&&!l||e.value.property!==void 0||u.push(new G(e.key,e.value,`"property" property is required`)),u;function d(e){let n=[],r=e.value,s=e.key;if(Nn(r)!==`array`)return[new G(s,r,`array expected, ${Nn(r)} found`)];if(r.length!==2)return[new G(s,r,`array length 2 expected, length ${r.length} found`)];if(l){if(Nn(r[0])!==`object`)return[new G(s,r,`object expected, ${Nn(r[0])} found`)];if(r[0].zoom===void 0)return[new G(s,r,`object stop key must have zoom`)];if(r[0].value===void 0)return[new G(s,r,`object stop key must have value`)];if(a&&a>lr(r[0].zoom))return[new G(s,r[0].zoom,`stop zoom values must appear in ascending order`)];lr(r[0].zoom)!==a&&(a=lr(r[0].zoom),i=void 0,o={}),n=n.concat(dr({key:`${s}[0]`,value:r[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:pr,value:f}}))}else n=n.concat(f({key:`${s}[0]`,value:r[0],valueSpec:{},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},r));return Un(ur(r[1]))?n.concat([new G(`${s}[1]`,r[1],`expressions are not allowed in function stops.`)]):n.concat(e.validateSpec({key:`${s}[1]`,value:r[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function f(e,a){let s=Nn(e.value),c=lr(e.value),l=e.value===null?a:e.value;if(r){if(s!==r)return[new G(e.key,l,`${s} stop domain type must match previous stop domain type ${r}`)]}else r=s;if(s!==`number`&&s!==`string`&&s!==`boolean`)return[new G(e.key,l,`stop domain value must be a number, string, or boolean`)];if(s!==`number`&&n!==`categorical`){let r=`number expected, ${s} found`;return An(t)&&n===void 0&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new G(e.key,l,r)]}return n!==`categorical`||s!==`number`||isFinite(c)&&Math.floor(c)===c?n!==`categorical`&&s===`number`&&i!==void 0&&c<i?[new G(e.key,l,`stop domain values must appear in ascending order`)]:(i=c,n===`categorical`&&c in o?[new G(e.key,l,`stop domain values must be unique`)]:(o[c]=!0,[])):[new G(e.key,l,`integer expected, found ${c}`)]}}function hr(e){let t=(e.expressionContext===`property`?qn:Wn)(ur(e.value),e.valueSpec);if(t.result===`error`)return t.value.map((t=>new G(`${e.key}${t.key}`,e.value,t.message)));let n=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext===`property`&&e.propertyKey===`text-font`&&!n.outputDefined())return[new G(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if(e.expressionContext===`property`&&e.propertyType===`layout`&&!Kt(n))return[new G(e.key,e.value,`"feature-state" data expressions are not supported with layout properties.`)];if(e.expressionContext===`filter`&&!Kt(n))return[new G(e.key,e.value,`"feature-state" data expressions are not supported with filters.`)];if(e.expressionContext&&e.expressionContext.indexOf(`cluster`)===0){if(!qt(n,[`zoom`,`feature-state`]))return[new G(e.key,e.value,`"zoom" and "feature-state" expressions are not supported with cluster properties.`)];if(e.expressionContext===`cluster-initial`&&!Gt(n))return[new G(e.key,e.value,`Feature data expressions are not supported with initial expression part of cluster properties.`)]}return[]}function gr(e){let t=e.key,n=e.value,r=e.valueSpec,i=[];return Array.isArray(r.values)?r.values.indexOf(lr(n))===-1&&i.push(new G(t,n,`expected one of [${r.values.join(`, `)}], ${JSON.stringify(n)} found`)):Object.keys(r.values).indexOf(lr(n))===-1&&i.push(new G(t,n,`expected one of [${Object.keys(r.values).join(`, `)}], ${JSON.stringify(n)} found`)),i}function _r(e){return Xn(ur(e.value))?hr(K({},e,{expressionContext:`filter`,valueSpec:{value:`boolean`}})):vr(e)}function vr(e){let t=e.value,n=e.key;if(Nn(t)!==`array`)return[new G(n,t,`array expected, ${Nn(t)} found`)];let r=e.styleSpec,i,a=[];if(t.length<1)return[new G(n,t,`filter array must have at least 1 element`)];switch(a=a.concat(gr({key:`${n}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),lr(t[0])){case`<`:case`<=`:case`>`:case`>=`:t.length>=2&&lr(t[1])===`$type`&&a.push(new G(n,t,`"$type" cannot be use with operator "${t[0]}"`));case`==`:case`!=`:t.length!==3&&a.push(new G(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case`in`:case`!in`:t.length>=2&&(i=Nn(t[1]),i!==`string`&&a.push(new G(`${n}[1]`,t[1],`string expected, ${i} found`)));for(let o=2;o<t.length;o++)i=Nn(t[o]),lr(t[1])===`$type`?a=a.concat(gr({key:`${n}[${o}]`,value:t[o],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):i!==`string`&&i!==`number`&&i!==`boolean`&&a.push(new G(`${n}[${o}]`,t[o],`string, number, or boolean expected, ${i} found`));break;case`any`:case`all`:case`none`:for(let r=1;r<t.length;r++)a=a.concat(vr({key:`${n}[${r}]`,value:t[r],style:e.style,styleSpec:e.styleSpec}));break;case`has`:case`!has`:i=Nn(t[1]),t.length===2?i!==`string`&&a.push(new G(`${n}[1]`,t[1],`string expected, ${i} found`)):a.push(new G(n,t,`filter array for "${t[0]}" operator must have 2 elements`));break;case`within`:i=Nn(t[1]),t.length===2?i!==`object`&&a.push(new G(`${n}[1]`,t[1],`object expected, ${i} found`)):a.push(new G(n,t,`filter array for "${t[0]}" operator must have 2 elements`))}return a}function yr(e,t){let n=e.key,r=e.validateSpec,i=e.style,a=e.styleSpec,o=e.value,s=e.objectKey,c=a[`${t}_${e.layerType}`];if(!c)return[];let l=s.match(/^(.*)-transition$/);if(t===`paint`&&l&&c[l[1]]&&c[l[1]].transition)return r({key:n,value:o,valueSpec:a.transition,style:i,styleSpec:a});let u=e.valueSpec||c[s];if(!u)return[new G(n,o,`unknown property "${s}"`)];let d;if(Nn(o)===`string`&&An(u)&&!u.tokens&&(d=/^{([^}]+)}$/.exec(o)))return[new G(n,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(d[1])} }\`.`)];let f=[];return e.layerType===`symbol`&&(s===`text-field`&&i&&!i.glyphs&&f.push(new G(n,o,`use of "text-field" requires a style "glyphs" property`)),s===`text-font`&&Pn(ur(o))&&lr(o.type)===`identity`&&f.push(new G(n,o,`"text-font" does not support identity functions`))),f.concat(r({key:e.key,value:o,valueSpec:u,style:i,styleSpec:a,expressionContext:`property`,propertyType:t,propertyKey:s}))}function br(e){return yr(e,`paint`)}function xr(e){return yr(e,`layout`)}function Sr(e){let t=[],n=e.value,r=e.key,i=e.style,a=e.styleSpec;n.type||n.ref||t.push(new G(r,n,`either "type" or "ref" is required`));let o=lr(n.type),s=lr(n.ref);if(n.id){let a=lr(n.id);for(let o=0;o<e.arrayIndex;o++){let e=i.layers[o];lr(e.id)===a&&t.push(new G(r,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if(`ref`in n){let e;[`type`,`source`,`source-layer`,`filter`,`layout`].forEach((e=>{e in n&&t.push(new G(r,n[e],`"${e}" is prohibited for ref layers`))})),i.layers.forEach((t=>{lr(t.id)===s&&(e=t)})),e?e.ref?t.push(new G(r,n.ref,`ref cannot reference another ref layer`)):o=lr(e.type):t.push(new G(r,n.ref,`ref layer "${s}" not found`))}else if(o!==`background`)if(n.source){let e=i.sources&&i.sources[n.source],a=e&&lr(e.type);e?a===`vector`&&o===`raster`?t.push(new G(r,n.source,`layer "${n.id}" requires a raster source`)):a!==`raster-dem`&&o===`hillshade`?t.push(new G(r,n.source,`layer "${n.id}" requires a raster-dem source`)):a===`raster`&&o!==`raster`?t.push(new G(r,n.source,`layer "${n.id}" requires a vector source`)):a!==`vector`||n[`source-layer`]?a===`raster-dem`&&o!==`hillshade`?t.push(new G(r,n.source,`raster-dem source can only be used with layer type 'hillshade'.`)):o!==`line`||!n.paint||!n.paint[`line-gradient`]||a===`geojson`&&e.lineMetrics||t.push(new G(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new G(r,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new G(r,n.source,`source "${n.source}" not found`))}else t.push(new G(r,n,`missing required property "source"`));return t=t.concat(dr({key:r,value:n,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${r}.type`,value:n.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:n,objectKey:`type`}),filter:_r,layout:e=>dr({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>xr(K({layerType:o},e))}}),paint:e=>dr({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>br(K({layerType:o},e))}})}})),t}function Cr(e){let t=e.value,n=e.key,r=Nn(t);return r===`string`?[]:[new G(n,t,`string expected, ${r} found`)]}let wr={promoteId:function({key:e,value:t}){if(Nn(t)===`string`)return Cr({key:e,value:t});{let n=[];for(let r in t)n.push(...Cr({key:`${e}.${r}`,value:t[r]}));return n}}};function Tr(e){let t=e.value,n=e.key,r=e.styleSpec,i=e.style,a=e.validateSpec;if(!t.type)return[new G(n,t,`"type" is required`)];let o=lr(t.type),s;switch(o){case`vector`:case`raster`:return s=dr({key:n,value:t,valueSpec:r[`source_${o.replace(`-`,`_`)}`],style:e.style,styleSpec:r,objectElementValidators:wr,validateSpec:a}),s;case`raster-dem`:return s=function(e){let t=e.sourceName??``,n=e.value,r=e.styleSpec,i=r.source_raster_dem,a=e.style,o=[],s=Nn(n);if(n===void 0)return o;if(s!==`object`)return o.push(new G(`source_raster_dem`,n,`object expected, ${s} found`)),o;let c=lr(n.encoding)===`custom`,l=[`redFactor`,`greenFactor`,`blueFactor`,`baseShift`],u=e.value.encoding?`"${e.value.encoding}"`:`Default`;for(let s in n)!c&&l.includes(s)?o.push(new G(s,n[s],`In "${t}": "${s}" is only valid when "encoding" is set to "custom". ${u} encoding found`)):i[s]?o=o.concat(e.validateSpec({key:s,value:n[s],valueSpec:i[s],validateSpec:e.validateSpec,style:a,styleSpec:r})):o.push(new G(s,n[s],`unknown property "${s}"`));return o}({sourceName:n,value:t,style:e.style,styleSpec:r,validateSpec:a}),s;case`geojson`:if(s=dr({key:n,value:t,valueSpec:r.source_geojson,style:i,styleSpec:r,validateSpec:a,objectElementValidators:wr}),t.cluster)for(let e in t.clusterProperties){let[r,i]=t.clusterProperties[e],o=typeof r==`string`?[r,[`accumulated`],[`get`,e]]:r;s.push(...hr({key:`${n}.${e}.map`,value:i,validateSpec:a,expressionContext:`cluster-map`})),s.push(...hr({key:`${n}.${e}.reduce`,value:o,validateSpec:a,expressionContext:`cluster-reduce`}))}return s;case`video`:return dr({key:n,value:t,valueSpec:r.source_video,style:i,validateSpec:a,styleSpec:r});case`image`:return dr({key:n,value:t,valueSpec:r.source_image,style:i,validateSpec:a,styleSpec:r});case`canvas`:return[new G(n,null,`Please use runtime APIs to add canvas sources, rather than including them in stylesheets.`,`source.canvas`)];default:return gr({key:`${n}.type`,value:t.type,valueSpec:{values:[`vector`,`raster`,`raster-dem`,`geojson`,`video`,`image`]},style:i,validateSpec:a,styleSpec:r})}}function Er(e){let t=e.value,n=e.styleSpec,r=n.light,i=e.style,a=[],o=Nn(t);if(t===void 0)return a;if(o!==`object`)return a=a.concat([new G(`light`,t,`object expected, ${o} found`)]),a;for(let o in t){let s=o.match(/^(.*)-transition$/);a=a.concat(s&&r[s[1]]&&r[s[1]].transition?e.validateSpec({key:o,value:t[o],valueSpec:n.transition,validateSpec:e.validateSpec,style:i,styleSpec:n}):r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],validateSpec:e.validateSpec,style:i,styleSpec:n}):[new G(o,t[o],`unknown property "${o}"`)])}return a}function Dr(e){let t=e.value,n=e.styleSpec,r=n.terrain,i=e.style,a=[],o=Nn(t);if(t===void 0)return a;if(o!==`object`)return a=a.concat([new G(`terrain`,t,`object expected, ${o} found`)]),a;for(let o in t)a=a.concat(r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],validateSpec:e.validateSpec,style:i,styleSpec:n}):[new G(o,t[o],`unknown property "${o}"`)]);return a}function Or(e){let t=[],n=e.value,r=e.key;if(Array.isArray(n)){let i=[],a=[];for(let o in n)n[o].id&&i.includes(n[o].id)&&t.push(new G(r,n,`all the sprites' ids must be unique, but ${n[o].id} is duplicated`)),i.push(n[o].id),n[o].url&&a.includes(n[o].url)&&t.push(new G(r,n,`all the sprites' URLs must be unique, but ${n[o].url} is duplicated`)),a.push(n[o].url),t=t.concat(dr({key:`${r}[${o}]`,value:n[o],valueSpec:{id:{type:`string`,required:!0},url:{type:`string`,required:!0}},validateSpec:e.validateSpec}));return t}return Cr({key:r,value:n})}let kr={"*":()=>[],array:fr,boolean:function(e){let t=e.value,n=e.key,r=Nn(t);return r===`boolean`?[]:[new G(n,t,`boolean expected, ${r} found`)]},number:pr,color:function(e){let t=e.key,n=e.value,r=Nn(n);return r===`string`?rt.parse(String(n))?[]:[new G(t,n,`color expected, "${n}" found`)]:[new G(t,n,`color expected, ${r} found`)]},constants:cr,enum:gr,filter:_r,function:mr,layer:Sr,object:dr,source:Tr,light:Er,terrain:Dr,string:Cr,formatted:function(e){return Cr(e).length===0?[]:hr(e)},resolvedImage:function(e){return Cr(e).length===0?[]:hr(e)},padding:function(e){let t=e.key,n=e.value;if(Nn(n)===`array`){if(n.length<1||n.length>4)return[new G(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];let r={type:`number`},i=[];for(let a=0;a<n.length;a++)i=i.concat(e.validateSpec({key:`${t}[${a}]`,value:n[a],validateSpec:e.validateSpec,valueSpec:r}));return i}return pr({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(e){let t=e.key,n=e.value,r=Nn(n),i=e.styleSpec;if(r!==`array`||n.length<1||n.length%2!=0)return[new G(t,n,`variableAnchorOffsetCollection requires a non-empty array of even length`)];let a=[];for(let r=0;r<n.length;r+=2)a=a.concat(gr({key:`${t}[${r}]`,value:n[r],valueSpec:i.layout_symbol[`text-anchor`]})),a=a.concat(fr({key:`${t}[${r+1}]`,value:n[r+1],valueSpec:{length:2,value:`number`},validateSpec:e.validateSpec,style:e.style,styleSpec:i}));return a},sprite:Or};function Ar(e){let t=e.value,n=e.valueSpec,r=e.styleSpec;return e.validateSpec=Ar,n.expression&&Pn(lr(t))?mr(e):n.expression&&Un(ur(t))?hr(e):n.type&&kr[n.type]?kr[n.type](e):dr(K({},e,{valueSpec:n.type?r[n.type]:n}))}function jr(e){let t=e.value,n=e.key,r=Cr(e);return r.length||(t.indexOf(`{fontstack}`)===-1&&r.push(new G(n,t,`"glyphs" url must include a "{fontstack}" token`)),t.indexOf(`{range}`)===-1&&r.push(new G(n,t,`"glyphs" url must include a "{range}" token`))),r}function Mr(e,t=H){let n=[];return n=n.concat(Ar({key:``,value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:Ar,objectElementValidators:{glyphs:jr,"*":()=>[]}})),e.constants&&(n=n.concat(cr({key:`constants`,value:e.constants,style:e,styleSpec:t,validateSpec:Ar}))),Pr(n)}function Nr(e){return function(t){return e({...t,validateSpec:Ar})}}function Pr(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function Fr(e){return function(...t){return Pr(e.apply(this,t))}}Mr.source=Fr(Nr(Tr)),Mr.sprite=Fr(Nr(Or)),Mr.glyphs=Fr(Nr(jr)),Mr.light=Fr(Nr(Er)),Mr.terrain=Fr(Nr(Dr)),Mr.layer=Fr(Nr(Sr)),Mr.filter=Fr(Nr(_r)),Mr.paintProperty=Fr(Nr(br)),Mr.layoutProperty=Fr(Nr(xr));let Ir=Mr,Lr=Ir.light,Rr=Ir.paintProperty,zr=Ir.layoutProperty;function Br(e,t){let n=!1;if(t&&t.length)for(let r of t)e.fire(new se(Error(r.message))),n=!0;return n}class Vr{constructor(e,t,n){let r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;let i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(n=i[2]);for(let e=0;e<this.d*this.d;e++){let t=i[3+e],n=i[3+e+1];r.push(t===n?null:i.subarray(t,n))}let a=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],a),this.bboxes=i.subarray(a),this.insert=this._insertReadonly}else{this.d=t+2*n;for(let e=0;e<this.d*this.d;e++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;let i=n/t*e;this.min=-i,this.max=e+i}insert(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}_insertReadonly(){throw Error(`Cannot insert into a GridIndex created from an ArrayBuffer.`)}_insertCell(e,t,n,r,i,a){this.cells[i].push(a)}query(e,t,n,r,i){let a=this.min,o=this.max;if(e<=a&&t<=a&&o<=n&&o<=r&&!i)return Array.prototype.slice.call(this.keys);{let a=[];return this._forEachCell(e,t,n,r,this._queryCell,a,{},i),a}}_queryCell(e,t,n,r,i,a,o,s){let c=this.cells[i];if(c!==null){let i=this.keys,l=this.bboxes;for(let u=0;u<c.length;u++){let d=c[u];if(o[d]===void 0){let c=4*d;(s?s(l[c+0],l[c+1],l[c+2],l[c+3]):e<=l[c+2]&&t<=l[c+3]&&n>=l[c+0]&&r>=l[c+1])?(o[d]=!0,a.push(i[d])):o[d]=!1}}}}_forEachCell(e,t,n,r,i,a,o,s){let c=this._convertToCellCoord(e),l=this._convertToCellCoord(t),u=this._convertToCellCoord(n),d=this._convertToCellCoord(r);for(let f=c;f<=u;f++)for(let c=l;c<=d;c++){let l=this.d*c+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(c),this._convertFromCellCoord(f+1),this._convertFromCellCoord(c+1)))&&i.call(this,e,t,n,r,l,a,o,s))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let e=this.cells,t=3+this.cells.length+1+1,n=0;for(let e=0;e<this.cells.length;e++)n+=this.cells[e].length;let r=new Int32Array(t+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;let i=t;for(let t=0;t<e.length;t++){let n=e[t];r[3+t]=i,r.set(n,i),i+=n.length}return r[3+e.length]=i,r.set(this.keys,i),i+=this.keys.length,r[3+e.length+1]=i,r.set(this.bboxes,i),i+=this.bboxes.length,r.buffer}static serialize(e,t){let n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}}static deserialize(e){return new Vr(e.buffer)}}let Hr={};function Ur(e,t,n={}){if(Hr[e])throw Error(`${e} is already registered.`);Object.defineProperty(t,`_classRegistryKey`,{value:e,writeable:!1}),Hr[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Ur(`Object`,Object),Ur(`TransferableGridIndex`,Vr),Ur(`Color`,rt),Ur(`Error`,Error),Ur(`AJAXError`,R),Ur(`ResolvedImage`,ut),Ur(`StylePropertyFunction`,Jn),Ur(`StyleExpression`,Hn,{omit:[`_evaluator`]}),Ur(`ZoomDependentExpression`,Kn),Ur(`ZoomConstantExpression`,Gn),Ur(`CompoundExpression`,Ut,{omit:[`_evaluate`]});for(let e in Cn)Cn[e]._classRegistryKey||Ur(`Expression_${e}`,Cn[e]);function Wr(e){return e&&typeof ArrayBuffer<`u`&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name===`ArrayBuffer`)}function Gr(e,t){if(e==null||typeof e==`boolean`||typeof e==`number`||typeof e==`string`||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob)return e;if(Wr(e)||k(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){let n=e;return t&&t.push(n.buffer),n}if(e instanceof ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){let n=[];for(let r of e)n.push(Gr(r,t));return n}if(typeof e==`object`){let n=e.constructor,r=n._classRegistryKey;if(!r)throw Error(`can't serialize object of unregistered class`);if(!Hr[r])throw Error(`${r} is not registered.`);let i=n.serialize?n.serialize(e,t):{};if(n.serialize){if(t&&i===t[t.length-1])throw Error(`statically serialized object won't survive transfer of $name property`)}else{for(let n in e){if(!e.hasOwnProperty(n)||Hr[r].omit.indexOf(n)>=0)continue;let a=e[n];i[n]=Hr[r].shallow.indexOf(n)>=0?a:Gr(a,t)}e instanceof Error&&(i.message=e.message)}if(i.$name)throw Error(`$name property is reserved for worker serialization logic.`);return r!==`Object`&&(i.$name=r),i}throw Error(`can't serialize object of type `+typeof e)}function Kr(e){if(e==null||typeof e==`boolean`||typeof e==`number`||typeof e==`string`||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||Wr(e)||k(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(Kr);if(typeof e==`object`){let t=e.$name||`Object`;if(!Hr[t])throw Error(`can't deserialize unregistered class ${t}`);let{klass:n}=Hr[t];if(!n)throw Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);let r=Object.create(n.prototype);for(let n of Object.keys(e)){if(n===`$name`)continue;let i=e[n];r[n]=Hr[t].shallow.indexOf(n)>=0?i:Kr(i)}return r}throw Error(`can't deserialize object of type `+typeof e)}class qr{constructor(){this.first=!0}update(e,t){let n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}let Jr={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function Yr(e){for(let t of e)if(Qr(t.charCodeAt(0)))return!0;return!1}function Xr(e){for(let t of e)if(!Zr(t.charCodeAt(0)))return!1;return!0}function Zr(e){return!(Jr.Arabic(e)||Jr[`Arabic Supplement`](e)||Jr[`Arabic Extended-A`](e)||Jr[`Arabic Presentation Forms-A`](e)||Jr[`Arabic Presentation Forms-B`](e))}function Qr(e){return!(e!==746&&e!==747&&(e<4352||!(Jr[`Bopomofo Extended`](e)||Jr.Bopomofo(e)||Jr[`CJK Compatibility Forms`](e)&&!(e>=65097&&e<=65103)||Jr[`CJK Compatibility Ideographs`](e)||Jr[`CJK Compatibility`](e)||Jr[`CJK Radicals Supplement`](e)||Jr[`CJK Strokes`](e)||!(!Jr[`CJK Symbols and Punctuation`](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Jr[`CJK Unified Ideographs Extension A`](e)||Jr[`CJK Unified Ideographs`](e)||Jr[`Enclosed CJK Letters and Months`](e)||Jr[`Hangul Compatibility Jamo`](e)||Jr[`Hangul Jamo Extended-A`](e)||Jr[`Hangul Jamo Extended-B`](e)||Jr[`Hangul Jamo`](e)||Jr[`Hangul Syllables`](e)||Jr.Hiragana(e)||Jr[`Ideographic Description Characters`](e)||Jr.Kanbun(e)||Jr[`Kangxi Radicals`](e)||Jr[`Katakana Phonetic Extensions`](e)||Jr.Katakana(e)&&e!==12540||!(!Jr[`Halfwidth and Fullwidth Forms`](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Jr[`Small Form Variants`](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Jr[`Unified Canadian Aboriginal Syllabics`](e)||Jr[`Unified Canadian Aboriginal Syllabics Extended`](e)||Jr[`Vertical Forms`](e)||Jr[`Yijing Hexagram Symbols`](e)||Jr[`Yi Syllables`](e)||Jr[`Yi Radicals`](e))))}function $r(e){return!(Qr(e)||function(e){return!!(Jr[`Latin-1 Supplement`](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Jr[`General Punctuation`](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Jr[`Letterlike Symbols`](e)||Jr[`Number Forms`](e)||Jr[`Miscellaneous Technical`](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Jr[`Control Pictures`](e)&&e!==9251||Jr[`Optical Character Recognition`](e)||Jr[`Enclosed Alphanumerics`](e)||Jr[`Geometric Shapes`](e)||Jr[`Miscellaneous Symbols`](e)&&!(e>=9754&&e<=9759)||Jr[`Miscellaneous Symbols and Arrows`](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Jr[`CJK Symbols and Punctuation`](e)||Jr.Katakana(e)||Jr[`Private Use Area`](e)||Jr[`CJK Compatibility Forms`](e)||Jr[`Small Form Variants`](e)||Jr[`Halfwidth and Fullwidth Forms`](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(e))}function ei(e){return e>=1424&&e<=2303||Jr[`Arabic Presentation Forms-A`](e)||Jr[`Arabic Presentation Forms-B`](e)}function ti(e,t){return!(!t&&ei(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Jr.Khmer(e))}function ni(e){for(let t of e)if(ei(t.charCodeAt(0)))return!0;return!1}let ri=`deferred`,ii=`loading`,ai=`loaded`,oi=null,si=`unavailable`,ci=null,li=function(e){e&&typeof e==`string`&&e.indexOf(`NetworkError`)>-1&&(si=`error`),oi&&oi(e)};function ui(){di.fire(new oe(`pluginStateChange`,{pluginStatus:si,pluginURL:ci}))}let di=new ce,fi=function(){return si},pi=function(){if(si!==ri||!ci)throw Error(`rtl-text-plugin cannot be downloaded unless a pluginURL is specified`);si=ii,ui(),ci&&re({url:ci},(e=>{e?li(e):(si=ai,ui())}))},mi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>si===ai||mi.applyArabicShaping!=null,isLoading:()=>si===ii,setState(e){if(!D())throw Error(`Cannot set the state of the rtl-text-plugin when not in the web-worker context`);si=e.pluginStatus,ci=e.pluginURL},isParsed(){if(!D())throw Error(`rtl-text-plugin is only parsed on the worker-threads`);return mi.applyArabicShaping!=null&&mi.processBidirectionalText!=null&&mi.processStyledBidirectionalText!=null},getPluginURL(){if(!D())throw Error(`rtl-text-plugin url can only be queried from the worker threads`);return ci}};class hi{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qr,this.transition={})}isSupportedScript(e){return function(e,t){for(let n of e)if(!ti(n.charCodeAt(0),t))return!1;return!0}(e,mi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}class gi{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Pn(e))return new Jn(e,t);if(Un(e)){let n=qn(e,t);if(n.result===`error`)throw Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(`, `));return n.value}{let n=e;return t.type===`color`&&typeof e==`string`?n=rt.parse(e):t.type!==`padding`||typeof e!=`number`&&!Array.isArray(e)?t.type===`variableAnchorOffsetCollection`&&Array.isArray(e)&&(n=lt.parse(e)):n=st.parse(e),{kind:`constant`,evaluate:()=>n}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind===`source`||this.expression.kind===`composite`}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class _i{constructor(e){this.property=e,this.value=new gi(e,void 0)}transitioned(e,t){return new yi(this.property,this.value,t,_({},e.transition,this.transition),e.now)}untransitioned(){return new yi(this.property,this.value,null,{},0)}}class vi{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return x(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new _i(this._values[e].property)),this._values[e].value=new gi(this._values[e].property,t===null?void 0:x(t))}getTransition(e){return x(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new _i(this._values[e].property)),this._values[e].transition=x(t)||void 0}serialize(){let e={};for(let t of Object.keys(this._values)){let n=this.getValue(t);n!==void 0&&(e[t]=n);let r=this.getTransition(t);r!==void 0&&(e[`${t}-transition`]=r)}return e}transitioned(e,t){let n=new bi(this._properties);for(let r of Object.keys(this._values))n._values[r]=this._values[r].transitioned(e,t._values[r]);return n}untransitioned(){let e=new bi(this._properties);for(let t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class yi{constructor(e,t,n,r,i){this.property=e,this.value=t,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,e.specification.transition&&(r.delay||r.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){let r=e.now||0,i=this.value.possiblyEvaluate(e,t,n),a=this.prior;if(a){if(r>this.end||this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return a.possiblyEvaluate(e,t,n);{let o=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,n),i,function(e){if(e<=0)return 0;if(e>=1)return 1;let t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}(o))}}return i}}class bi{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){let r=new Ci(this._properties);for(let i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class xi{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return x(this._values[e].value)}setValue(e,t){this._values[e]=new gi(this._values[e].property,t===null?void 0:x(t))}serialize(){let e={};for(let t of Object.keys(this._values)){let n=this.getValue(t);n!==void 0&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){let r=new Ci(this._properties);for(let i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}}class Si{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return this.value.kind===`constant`}constantOr(e){return this.value.kind===`constant`?this.value.value:e}evaluate(e,t,n,r){return this.property.evaluate(this.value,this.parameters,e,t,n,r)}}class Ci{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class wi{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw Error(`Value should not be data driven`);return e.expression.evaluate(t)}interpolate(e,t,n){let r=Qt[this.specification.type];return r?r(e,t,n):e}}class Ti{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,r){return new Si(this,e.expression.kind===`constant`||e.expression.kind===`camera`?{kind:`constant`,value:e.expression.evaluate(t,null,{},n,r)}:e.expression,t)}interpolate(e,t,n){if(e.value.kind!==`constant`||t.value.kind!==`constant`)return e;if(e.value.value===void 0||t.value.value===void 0)return new Si(this,{kind:`constant`,value:void 0},e.parameters);let r=Qt[this.specification.type];if(r){let i=r(e.value.value,t.value.value,n);return new Si(this,{kind:`constant`,value:i},e.parameters)}return e}evaluate(e,t,n,r,i,a){return e.kind===`constant`?e.value:e.evaluate(t,n,r,i,a)}}class Ei extends Ti{possiblyEvaluate(e,t,n,r){if(e.value===void 0)return new Si(this,{kind:`constant`,value:void 0},t);if(e.expression.kind===`constant`){let i=e.expression.evaluate(t,null,{},n,r),a=e.property.specification.type===`resolvedImage`&&typeof i!=`string`?i.name:i,o=this._calculate(a,a,a,t);return new Si(this,{kind:`constant`,value:o},t)}if(e.expression.kind===`camera`){let n=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Si(this,{kind:`constant`,value:n},t)}return new Si(this,e.expression,t)}evaluate(e,t,n,r,i,a){if(e.kind===`source`){let o=e.evaluate(t,n,r,i,a);return this._calculate(o,o,o,t)}return e.kind===`composite`?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,r),e.evaluate({zoom:Math.floor(t.zoom)},n,r),e.evaluate({zoom:Math.floor(t.zoom)+1},n,r),t):e.value}_calculate(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class Di{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,r){if(e.value!==void 0){if(e.expression.kind===`constant`){let i=e.expression.evaluate(t,null,{},n,r);return this._calculate(i,i,i,t)}return this._calculate(e.expression.evaluate(new hi(Math.floor(t.zoom-1),t)),e.expression.evaluate(new hi(Math.floor(t.zoom),t)),e.expression.evaluate(new hi(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class Oi{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,r){return!!e.expression.evaluate(t,null,{},n,r)}interpolate(){return!1}}class ki{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let t in e){let n=e[t];n.specification.overridable&&this.overridableProperties.push(t);let r=this.defaultPropertyValues[t]=new gi(n,void 0),i=this.defaultTransitionablePropertyValues[t]=new _i(n);this.defaultTransitioningPropertyValues[t]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=r.possiblyEvaluate({})}}}Ur(`DataDrivenProperty`,Ti),Ur(`DataConstantProperty`,wi),Ur(`CrossFadedDataDrivenProperty`,Ei),Ur(`CrossFadedProperty`,Di),Ur(`ColorRampProperty`,Oi);let Ai=`-transition`;class ji extends ce{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!==`custom`&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!==`background`&&(this.source=e.source,this.sourceLayer=e[`source-layer`],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new xi(t.layout)),t.paint)){this._transitionablePaint=new vi(t.paint);for(let t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(let t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ci(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e===`visibility`?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){t!=null&&this._validate(zr,`layers.${this.id}.layout.${e}`,e,t,n)||(e===`visibility`?this.visibility=t:this._unevaluatedLayout.setValue(e,t))}getPaintProperty(e){return e.endsWith(Ai)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(t!=null&&this._validate(Rr,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(e.endsWith(Ai))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{let n=this._transitionablePaint._values[e],r=n.property.specification[`property-type`]===`cross-faded-data-driven`,i=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);let o=this._transitionablePaint._values[e].value;return o.isDataDriven()||i||r||this._handleOverridablePaintPropertyUpdate(e,a,o)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility===`none`}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){let e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),b(e,((e,t)=>!(e===void 0||t===`layout`&&!Object.keys(e).length||t===`paint`&&!Object.keys(e).length)))}_validate(e,t,n,r,i={}){return(!i||!1!==i.validate)&&Br(this,e.call(Ir,{key:t,layerType:this.type,objectKey:n,value:r,styleSpec:H,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let e in this.paint._values){let t=this.paint.get(e);if(t instanceof Si&&An(t.property.specification)&&(t.value.kind===`source`||t.value.kind===`composite`)&&t.value.isStateDependent)return!0}return!1}}let Mi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ni{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw Error(`_refreshViews() must be implemented by each concrete StructArray layout`)}}function Fi(e,t=1){let n=0,r=0;return{members:e.map((e=>{let i=Mi[e.type].BYTES_PER_ELEMENT,a=n=Ii(n,Math.max(t,i)),o=e.components||1;return r=Math.max(r,i),n+=i*o,{name:e.name,type:e.type,components:o,offset:a}})),size:Ii(n,Math.max(r,t)),alignment:t}}function Ii(e,t){return Math.ceil(e/t)*t}class Li extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){let n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){let r=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,e}}Li.prototype.bytesPerElement=4,Ur(`StructArrayLayout2i4`,Li);class Ri extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){let r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){let i=3*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.int16[i+2]=r,e}}Ri.prototype.bytesPerElement=6,Ur(`StructArrayLayout3i6`,Ri);class zi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r){let i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){let a=4*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=r,this.int16[a+3]=i,e}}zi.prototype.bytesPerElement=8,Ur(`StructArrayLayout4i8`,zi);class Bi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a){let o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i,a)}emplace(e,t,n,r,i,a,o){let s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,e}}Bi.prototype.bytesPerElement=12,Ur(`StructArrayLayout2i4i12`,Bi);class Vi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a){let o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i,a)}emplace(e,t,n,r,i,a,o){let s=4*e,c=8*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.uint8[c+4]=r,this.uint8[c+5]=i,this.uint8[c+6]=a,this.uint8[c+7]=o,e}}Vi.prototype.bytesPerElement=8,Ur(`StructArrayLayout2i4ub8`,Vi);class Hi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){let n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){let r=2*e;return this.float32[r+0]=t,this.float32[r+1]=n,e}}Hi.prototype.bytesPerElement=8,Ur(`StructArrayLayout2f8`,Hi);class Ui extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,o,s,c,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,r,i,a,o,s,c,l)}emplace(e,t,n,r,i,a,o,s,c,l,u){let d=10*e;return this.uint16[d+0]=t,this.uint16[d+1]=n,this.uint16[d+2]=r,this.uint16[d+3]=i,this.uint16[d+4]=a,this.uint16[d+5]=o,this.uint16[d+6]=s,this.uint16[d+7]=c,this.uint16[d+8]=l,this.uint16[d+9]=u,e}}Ui.prototype.bytesPerElement=20,Ur(`StructArrayLayout10ui20`,Ui);class Wi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,o,s,c,l,u,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,r,i,a,o,s,c,l,u,d)}emplace(e,t,n,r,i,a,o,s,c,l,u,d,f){let p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=r,this.int16[p+3]=i,this.uint16[p+4]=a,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=c,this.int16[p+8]=l,this.int16[p+9]=u,this.int16[p+10]=d,this.int16[p+11]=f,e}}Wi.prototype.bytesPerElement=24,Ur(`StructArrayLayout4i4ui4i24`,Wi);class Gi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){let r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){let i=3*e;return this.float32[i+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e}}Gi.prototype.bytesPerElement=12,Ur(`StructArrayLayout3f12`,Gi);class Ki extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Ki.prototype.bytesPerElement=4,Ur(`StructArrayLayout1ul4`,Ki);class qi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,o,s,c){let l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,r,i,a,o,s,c)}emplace(e,t,n,r,i,a,o,s,c,l){let u=10*e,d=5*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=r,this.int16[u+3]=i,this.int16[u+4]=a,this.int16[u+5]=o,this.uint32[d+3]=s,this.uint16[u+8]=c,this.uint16[u+9]=l,e}}qi.prototype.bytesPerElement=20,Ur(`StructArrayLayout6i1ul2ui20`,qi);class Ji extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a){let o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i,a)}emplace(e,t,n,r,i,a,o){let s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,e}}Ji.prototype.bytesPerElement=12,Ur(`StructArrayLayout2i2i2i12`,Ji);class Yi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){let a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i)}emplace(e,t,n,r,i,a){let o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=r,this.int16[s+6]=i,this.int16[s+7]=a,e}}Yi.prototype.bytesPerElement=16,Ur(`StructArrayLayout2f1f2i16`,Yi);class Xi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r){let i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){let a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[o+1]=r,this.float32[o+2]=i,e}}Xi.prototype.bytesPerElement=12,Ur(`StructArrayLayout2ub2f12`,Xi);class Zi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){let r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){let i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,this.uint16[i+2]=r,e}}Zi.prototype.bytesPerElement=6,Ur(`StructArrayLayout3ui6`,Zi);class Qi extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g){let _=this.length;return this.resize(_+1),this.emplace(_,e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g)}emplace(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_){let v=24*e,y=12*e,b=48*e;return this.int16[v+0]=t,this.int16[v+1]=n,this.uint16[v+2]=r,this.uint16[v+3]=i,this.uint32[y+2]=a,this.uint32[y+3]=o,this.uint32[y+4]=s,this.uint16[v+10]=c,this.uint16[v+11]=l,this.uint16[v+12]=u,this.float32[y+7]=d,this.float32[y+8]=f,this.uint8[b+36]=p,this.uint8[b+37]=m,this.uint8[b+38]=h,this.uint32[y+10]=g,this.int16[v+22]=_,e}}Qi.prototype.bytesPerElement=48,Ur(`StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48`,Qi);class $i extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,E,D,O){let k=this.length;return this.resize(k+1),this.emplace(k,e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,E,D,O)}emplace(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,E,D,O,k){let A=32*e,j=16*e;return this.int16[A+0]=t,this.int16[A+1]=n,this.int16[A+2]=r,this.int16[A+3]=i,this.int16[A+4]=a,this.int16[A+5]=o,this.int16[A+6]=s,this.int16[A+7]=c,this.uint16[A+8]=l,this.uint16[A+9]=u,this.uint16[A+10]=d,this.uint16[A+11]=f,this.uint16[A+12]=p,this.uint16[A+13]=m,this.uint16[A+14]=h,this.uint16[A+15]=g,this.uint16[A+16]=_,this.uint16[A+17]=v,this.uint16[A+18]=y,this.uint16[A+19]=b,this.uint16[A+20]=x,this.uint16[A+21]=S,this.uint16[A+22]=C,this.uint32[j+12]=w,this.float32[j+13]=E,this.float32[j+14]=D,this.uint16[A+30]=O,this.uint16[A+31]=k,e}}$i.prototype.bytesPerElement=64,Ur(`StructArrayLayout8i15ui1ul2f2ui64`,$i);class ea extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ea.prototype.bytesPerElement=4,Ur(`StructArrayLayout1f4`,ea);class ta extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){let r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){let i=3*e;return this.uint16[6*e+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e}}ta.prototype.bytesPerElement=12,Ur(`StructArrayLayout1ui2f12`,ta);class na extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){let r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){let i=4*e;return this.uint32[2*e+0]=t,this.uint16[i+2]=n,this.uint16[i+3]=r,e}}na.prototype.bytesPerElement=8,Ur(`StructArrayLayout1ul2ui8`,na);class ra extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){let n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){let r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,e}}ra.prototype.bytesPerElement=4,Ur(`StructArrayLayout2ui4`,ra);class ia extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ia.prototype.bytesPerElement=2,Ur(`StructArrayLayout1ui2`,ia);class aa extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r){let i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){let a=4*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=r,this.float32[a+3]=i,e}}aa.prototype.bytesPerElement=16,Ur(`StructArrayLayout4f16`,aa);class oa extends Ni{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new a(this.anchorPointX,this.anchorPointY)}}oa.prototype.size=20;class sa extends qi{get(e){return new oa(this,e)}}Ur(`CollisionBoxArray`,sa);class ca extends Ni{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ca.prototype.size=48;class la extends Qi{get(e){return new ca(this,e)}}Ur(`PlacedSymbolArray`,la);class ua extends Ni{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ua.prototype.size=64;class da extends $i{get(e){return new ua(this,e)}}Ur(`SymbolInstanceArray`,da);class fa extends ea{getoffsetX(e){return this.float32[1*e+0]}}Ur(`GlyphOffsetArray`,fa);class pa extends Ri{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ur(`SymbolLineVertexArray`,pa);class ma extends Ni{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ma.prototype.size=12;class ha extends ta{get(e){return new ma(this,e)}}Ur(`TextAnchorOffsetArray`,ha);class ga extends Ni{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ga.prototype.size=8;class _a extends na{get(e){return new ga(this,e)}}Ur(`FeatureIndexArray`,_a);class va extends Li{}class ya extends Li{}class ba extends Li{}class xa extends Bi{}class Sa extends Vi{}class Ca extends Hi{}class wa extends Ui{}class Ta extends Wi{}class Ea extends Gi{}class Da extends Ki{}class Oa extends Ji{}class ka extends Xi{}class Aa extends Zi{}class ja extends ra{}let{members:Ma}=Fi([{name:`a_pos`,components:2,type:`Int16`}],4);class Na{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,r){let i=this.segments[this.segments.length-1];return e>Na.MAX_VERTEX_ARRAY_LENGTH&&C(`Max vertices per segment is ${Na.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!i||i.vertexLength+e>Na.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},r!==void 0&&(i.sortKey=r),this.segments.push(i)),i}get(){return this.segments}destroy(){for(let e of this.segments)for(let t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,r){return new Na([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])}}function Pa(e,t){return 256*(e=h(Math.floor(e),0,255))+h(Math.floor(t),0,255)}Na.MAX_VERTEX_ARRAY_LENGTH=2**16-1,Ur(`SegmentVector`,Na);let Fa=Fi([{name:`a_pattern_from`,components:4,type:`Uint16`},{name:`a_pattern_to`,components:4,type:`Uint16`},{name:`a_pixel_ratio_from`,components:1,type:`Uint16`},{name:`a_pixel_ratio_to`,components:1,type:`Uint16`}]);var Ia={exports:{}},La={exports:{}};La.exports=function(e,t){var n,r,i,a,o,s,c,l;for(r=e.length-(n=3&e.length),i=t,o=3432918353,s=461845907,l=0;l<r;)c=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,i=27492+(65535&(a=5*(65535&(i=(i^=c=(65535&(c=(c=(65535&c)*o+(((c>>>16)*o&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(c=0,n){case 3:c^=(255&e.charCodeAt(l+2))<<16;case 2:c^=(255&e.charCodeAt(l+1))<<8;case 1:i^=c=(65535&(c=(c=(65535&(c^=255&e.charCodeAt(l)))*o+(((c>>>16)*o&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0};var Ra=La.exports,za={exports:{}};za.exports=function(e,t){for(var n,r=e.length,i=t^r,a=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:i^=(255&e.charCodeAt(a+2))<<16;case 2:i^=(255&e.charCodeAt(a+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(a)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0};var Ba=Ra,Va=za.exports;Ia.exports=Ba,Ia.exports.murmur3=Ba,Ia.exports.murmur2=Va;var Ha=n(Ia.exports);class Ua{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,r){this.ids.push(Wa(e)),this.positions.push(t,n,r)}getPositions(e){if(!this.indexed)throw Error(`Trying to get index, but feature positions are not indexed`);let t=Wa(e),n=0,r=this.ids.length-1;for(;n<r;){let e=n+r>>1;this.ids[e]>=t?r=e:n=e+1}let i=[];for(;this.ids[n]===t;)i.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return i}static serialize(e,t){let n=new Float64Array(e.ids),r=new Uint32Array(e.positions);return Ga(n,r,0,n.length-1),t&&t.push(n.buffer,r.buffer),{ids:n,positions:r}}static deserialize(e){let t=new Ua;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Wa(e){let t=+e;return!isNaN(t)&&t<=2**53-1?t:Ha(String(e))}function Ga(e,t,n,r){for(;n<r;){let i=e[n+r>>1],a=n-1,o=r+1;for(;;){do a++;while(e[a]<i);do o--;while(e[o]>i);if(a>=o)break;Ka(e,a,o),Ka(t,3*a,3*o),Ka(t,3*a+1,3*o+1),Ka(t,3*a+2,3*o+2)}o-n<r-o?(Ga(e,t,n,o),n=o+1):(Ga(e,t,o+1,r),r=o)}}function Ka(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}Ur(`FeaturePositionMap`,Ua);class qa{constructor(e,t){this.gl=e.gl,this.location=t}}class Ja extends qa{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ya extends qa{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Xa extends qa{constructor(e,t){super(e,t),this.current=rt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}let Za=new Float32Array(16);function Qa(e){return[Pa(255*e.r,255*e.g),Pa(255*e.b,255*e.a)]}class $a{constructor(e,t,n){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=n}setUniform(e,t,n){e.set(n.constantOr(this.value))}getBinding(e,t,n){return this.type===`color`?new Xa(e,t):new Ja(e,t)}}class eo{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,n,r){let i=r===`u_pattern_to`?this.patternTo:r===`u_pattern_from`?this.patternFrom:r===`u_pixel_ratio_to`?this.pixelRatioTo:r===`u_pixel_ratio_from`?this.pixelRatioFrom:null;i&&e.set(i)}getBinding(e,t,n){return n.substr(0,9)===`u_pattern`?new Ya(e,t):new Ja(e,t)}}class to{constructor(e,t,n,r){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:`Float32`,components:n===`color`?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(e,t,n,r,i){let a=this.paintVertexArray.length,o=this.expression.evaluate(new hi(0),t,{},r,[],i);this.paintVertexArray.resize(e),this._setPaintValue(a,e,o)}updatePaintArray(e,t,n,r){let i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(e,t,i)}_setPaintValue(e,t,n){if(this.type===`color`){let r=Qa(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class no{constructor(e,t,n,r,i,a){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:`Float32`,components:n===`color`?4:2,offset:0}))),this.paintVertexArray=new a}populatePaintArray(e,t,n,r,i){let a=this.expression.evaluate(new hi(this.zoom),t,{},r,[],i),o=this.expression.evaluate(new hi(this.zoom+1),t,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(s,e,a,o)}updatePaintArray(e,t,n,r){let i=this.expression.evaluate({zoom:this.zoom},n,r),a=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(e,t,i,a)}_setPaintValue(e,t,n,r){if(this.type===`color`){let i=Qa(n),a=Qa(r);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1],a[0],a[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){let n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=h(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(r)}getBinding(e,t,n){return new Ja(e,t)}}class ro{constructor(e,t,n,r,i,a){this.expression=e,this.type=t,this.useIntegerZoom=n,this.zoom=r,this.layerId=a,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i}populatePaintArray(e,t,n){let r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,r,i){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],i)}_setPaintValues(e,t,n,r){if(!r||!n)return;let{min:i,mid:a,max:o}=n,s=r[i],c=r[a],l=r[o];if(s&&c&&l)for(let n=e;n<t;n++)this.zoomInPaintVertexArray.emplace(n,c.tl[0],c.tl[1],c.br[0],c.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],c.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArray.emplace(n,c.tl[0],c.tl[1],c.br[0],c.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],c.pixelRatio,l.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Fa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Fa.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class io{constructor(e,t,n){this.binders={},this._buffers=[];let r=[];for(let i in e.paint._values){if(!n(i))continue;let a=e.paint.get(i);if(!(a instanceof Si&&An(a.property.specification)))continue;let o=oo(i,e.type),s=a.value,c=a.property.specification.type,l=a.property.useIntegerZoom,u=a.property.specification[`property-type`],d=u===`cross-faded`||u===`cross-faded-data-driven`;if(s.kind===`constant`)this.binders[i]=d?new eo(s.value,o):new $a(s.value,o,c),r.push(`/u_${i}`);else if(s.kind===`source`||d){let n=so(i,c,`source`);this.binders[i]=d?new ro(s,c,l,t,n,e.id):new to(s,o,c,n),r.push(`/a_${i}`)}else{let e=so(i,c,`composite`);this.binders[i]=new no(s,o,c,l,t,e),r.push(`/z_${i}`)}}this.cacheKey=r.sort().join(``)}getMaxValue(e){let t=this.binders[e];return t instanceof to||t instanceof no?t.maxValue:0}populatePaintArrays(e,t,n,r,i){for(let a in this.binders){let o=this.binders[a];(o instanceof to||o instanceof no||o instanceof ro)&&o.populatePaintArray(e,t,n,r,i)}}setConstantPatternPositions(e,t){for(let n in this.binders){let r=this.binders[n];r instanceof eo&&r.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,n,r,i){let a=!1;for(let o in e){let s=t.getPositions(o);for(let t of s){let s=n.feature(t.index);for(let n in this.binders){let c=this.binders[n];(c instanceof to||c instanceof no||c instanceof ro)&&!0===c.expression.isStateDependent&&(c.expression=r.paint.get(n).value,c.updatePaintArray(t.start,t.end,s,e[o],i),a=!0)}}}return a}defines(){let e=[];for(let t in this.binders){let n=this.binders[t];(n instanceof $a||n instanceof eo)&&e.push(...n.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){let e=[];for(let t in this.binders){let n=this.binders[t];if(n instanceof to||n instanceof no)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name);else if(n instanceof ro)for(let t=0;t<Fa.members.length;t++)e.push(Fa.members[t].name)}return e}getBinderUniforms(){let e=[];for(let t in this.binders){let n=this.binders[t];if(n instanceof $a||n instanceof eo||n instanceof no)for(let t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){let n=[];for(let r in this.binders){let i=this.binders[r];if(i instanceof $a||i instanceof eo||i instanceof no){for(let a of i.uniformNames)if(t[a]){let o=i.getBinding(e,t[a],a);n.push({name:a,property:r,binding:o})}}}return n}setUniforms(e,t,n,r){for(let{name:e,property:i,binding:a}of t)this.binders[i].setUniform(a,r,n.get(i),e)}updatePaintBuffers(e){this._buffers=[];for(let t in this.binders){let n=this.binders[t];if(e&&n instanceof ro){let t=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else (n instanceof to||n instanceof no)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let t in this.binders){let n=this.binders[t];(n instanceof to||n instanceof no||n instanceof ro)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let t=this.binders[e];(t instanceof to||t instanceof no||t instanceof ro)&&t.destroy()}}}class ao{constructor(e,t,n=(()=>!0)){this.programConfigurations={};for(let r of e)this.programConfigurations[r.id]=new io(r,t,n);this.needsUpload=!1,this._featureMap=new Ua,this._bufferOffset=0}populatePaintArrays(e,t,n,r,i,a){for(let n in this.programConfigurations)this.programConfigurations[n].populatePaintArrays(e,t,r,i,a);t.id!==void 0&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,r){for(let i of n)this.needsUpload=this.programConfigurations[i.id].updatePaintArrays(e,this._featureMap,t,i,r)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}function oo(e,t){return{"text-opacity":[`opacity`],"icon-opacity":[`opacity`],"text-color":[`fill_color`],"icon-color":[`fill_color`],"text-halo-color":[`halo_color`],"icon-halo-color":[`halo_color`],"text-halo-blur":[`halo_blur`],"icon-halo-blur":[`halo_blur`],"text-halo-width":[`halo_width`],"icon-halo-width":[`halo_width`],"line-gap-width":[`gapwidth`],"line-pattern":[`pattern_to`,`pattern_from`,`pixel_ratio_to`,`pixel_ratio_from`],"fill-pattern":[`pattern_to`,`pattern_from`,`pixel_ratio_to`,`pixel_ratio_from`],"fill-extrusion-pattern":[`pattern_to`,`pattern_from`,`pixel_ratio_to`,`pixel_ratio_from`]}[e]||[e.replace(`${t}-`,``).replace(/-/g,`_`)]}function so(e,t,n){let r={color:{source:Hi,composite:aa},number:{source:ea,composite:Hi}},i=function(e){return{"line-pattern":{source:wa,composite:wa},"fill-pattern":{source:wa,composite:wa},"fill-extrusion-pattern":{source:wa,composite:wa}}[e]}(e);return i&&i[n]||r[t][n]}Ur(`ConstantBinder`,$a),Ur(`CrossFadedConstantBinder`,eo),Ur(`SourceExpressionBinder`,to),Ur(`CrossFadedCompositeBinder`,ro),Ur(`CompositeExpressionBinder`,no),Ur(`ProgramConfiguration`,io,{omit:[`_buffers`]}),Ur(`ProgramConfigurationSet`,ao);let co=8192,lo=2**14-1,uo=-lo-1;function fo(e){let t=co/e.extent,n=e.loadGeometry();for(let e=0;e<n.length;e++){let r=n[e];for(let e=0;e<r.length;e++){let n=r[e],i=Math.round(n.x*t),a=Math.round(n.y*t);n.x=h(i,uo,lo),n.y=h(a,uo,lo),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&C(`Geometry exceeds allowed extent, reduce your vector tile buffer size`)}}return n}function po(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?fo(e):[]}}function mo(e,t,n,r,i){e.emplaceBack(2*t+(r+1)/2,2*n+(i+1)/2)}class ho{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ya,this.indexArray=new Aa,this.segments=new Na,this.programConfigurations=new ao(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){let r=this.layers[0],i=[],a=null,o=!1;r.type===`circle`&&(a=r.layout.get(`circle-sort-key`),o=!a.isConstant());for(let{feature:t,id:r,index:s,sourceLayerIndex:c}of e){let e=this.layers[0]._featureFilter.needGeometry,l=po(t,e);if(!this.layers[0]._featureFilter.filter(new hi(this.zoom),l,n))continue;let u=o?a.evaluate(l,{},n):void 0,d={id:r,properties:t.properties,type:t.type,sourceLayerIndex:c,index:s,geometry:e?l.geometry:fo(t),patterns:{},sortKey:u};i.push(d)}o&&i.sort(((e,t)=>e.sortKey-t.sortKey));for(let r of i){let{geometry:i,index:a,sourceLayerIndex:o}=r,s=e[a].feature;this.addFeature(r,i,a,n),t.featureIndex.insert(s,i,a,o,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ma),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,r){for(let n of t)for(let t of n){let n=t.x,r=t.y;if(n<0||n>=co||r<0||r>=co)continue;let i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=i.vertexLength;mo(this.layoutVertexArray,n,r,-1,-1),mo(this.layoutVertexArray,n,r,1,-1),mo(this.layoutVertexArray,n,r,1,1),mo(this.layoutVertexArray,n,r,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+3,a+2),i.vertexLength+=4,i.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},r)}}function go(e,t){for(let n=0;n<e.length;n++)if(To(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(To(e,t[n]))return!0;return!!bo(e,t)}function _o(e,t,n){return!!To(e,t)||!!So(t,e,n)}function vo(e,t){if(e.length===1)return wo(t,e[0]);for(let n=0;n<t.length;n++){let r=t[n];for(let t=0;t<r.length;t++)if(To(e,r[t]))return!0}for(let n=0;n<e.length;n++)if(wo(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(bo(e,t[n]))return!0;return!1}function yo(e,t,n){if(e.length>1){if(bo(e,t))return!0;for(let r=0;r<t.length;r++)if(So(t[r],e,n))return!0}for(let r=0;r<e.length;r++)if(So(e[r],t,n))return!0;return!1}function bo(e,t){if(e.length===0||t.length===0)return!1;for(let n=0;n<e.length-1;n++){let r=e[n],i=e[n+1];for(let e=0;e<t.length-1;e++)if(xo(r,i,t[e],t[e+1]))return!0}return!1}function xo(e,t,n,r){return w(e,n,r)!==w(t,n,r)&&w(e,t,n)!==w(e,t,r)}function So(e,t,n){let r=n*n;if(t.length===1)return e.distSqr(t[0])<r;for(let n=1;n<t.length;n++)if(Co(e,t[n-1],t[n])<r)return!0;return!1}function Co(e,t,n){let r=t.distSqr(n);if(r===0)return e.distSqr(t);let i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;return e.distSqr(i<0?t:i>1?n:n.sub(t)._mult(i)._add(t))}function wo(e,t){let n,r,i,a=!1;for(let o=0;o<e.length;o++){n=e[o];for(let e=0,o=n.length-1;e<n.length;o=e++)r=n[e],i=n[o],r.y>t.y!=i.y>t.y&&t.x<(i.x-r.x)*(t.y-r.y)/(i.y-r.y)+r.x&&(a=!a)}return a}function To(e,t){let n=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){let a=e[r],o=e[i];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(n=!n)}return n}function Eo(e,t,n){let r=n[0],i=n[2];if(e.x<r.x&&t.x<r.x||e.x>i.x&&t.x>i.x||e.y<r.y&&t.y<r.y||e.y>i.y&&t.y>i.y)return!1;let a=w(e,t,n[0]);return a!==w(e,t,n[1])||a!==w(e,t,n[2])||a!==w(e,t,n[3])}function Do(e,t,n){let r=t.paint.get(e).value;return r.kind===`constant`?r.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Oo(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ko(e,t,n,r,i){if(!t[0]&&!t[1])return e;let o=a.convert(t)._mult(i);n===`viewport`&&o._rotate(-r);let s=[];for(let t=0;t<e.length;t++)s.push(e[t].sub(o));return s}let Ao,jo;Ur(`CircleBucket`,ho,{omit:[`layers`]});var Mo={get paint(){return jo||=new ki({"circle-radius":new Ti(H.paint_circle[`circle-radius`]),"circle-color":new Ti(H.paint_circle[`circle-color`]),"circle-blur":new Ti(H.paint_circle[`circle-blur`]),"circle-opacity":new Ti(H.paint_circle[`circle-opacity`]),"circle-translate":new wi(H.paint_circle[`circle-translate`]),"circle-translate-anchor":new wi(H.paint_circle[`circle-translate-anchor`]),"circle-pitch-scale":new wi(H.paint_circle[`circle-pitch-scale`]),"circle-pitch-alignment":new wi(H.paint_circle[`circle-pitch-alignment`]),"circle-stroke-width":new Ti(H.paint_circle[`circle-stroke-width`]),"circle-stroke-color":new Ti(H.paint_circle[`circle-stroke-color`]),"circle-stroke-opacity":new Ti(H.paint_circle[`circle-stroke-opacity`])})},get layout(){return Ao||=new ki({"circle-sort-key":new Ti(H.layout_circle[`circle-sort-key`])})}},No=1e-6,Po=typeof Float32Array<`u`?Float32Array:Array;function Fo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Io(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=t[9],p=t[10],m=t[11],h=t[12],g=t[13],_=t[14],v=t[15],y=n[0],b=n[1],x=n[2],S=n[3];return e[0]=y*r+b*s+x*d+S*h,e[1]=y*i+b*c+x*f+S*g,e[2]=y*a+b*l+x*p+S*_,e[3]=y*o+b*u+x*m+S*v,e[4]=(y=n[4])*r+(b=n[5])*s+(x=n[6])*d+(S=n[7])*h,e[5]=y*i+b*c+x*f+S*g,e[6]=y*a+b*l+x*p+S*_,e[7]=y*o+b*u+x*m+S*v,e[8]=(y=n[8])*r+(b=n[9])*s+(x=n[10])*d+(S=n[11])*h,e[9]=y*i+b*c+x*f+S*g,e[10]=y*a+b*l+x*p+S*_,e[11]=y*o+b*u+x*m+S*v,e[12]=(y=n[12])*r+(b=n[13])*s+(x=n[14])*d+(S=n[15])*h,e[13]=y*i+b*c+x*f+S*g,e[14]=y*a+b*l+x*p+S*_,e[15]=y*o+b*u+x*m+S*v,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Lo,Ro=Io;function zo(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e}Lo=new Po(4),Po!=Float32Array&&(Lo[0]=0,Lo[1]=0,Lo[2]=0,Lo[3]=0);class Bo extends ji{constructor(e){super(e,Mo)}createBucket(e){return new ho(e)}queryRadius(e){let t=e;return Do(`circle-radius`,this,t)+Do(`circle-stroke-width`,this,t)+Oo(this.paint.get(`circle-translate`))}queryIntersectsFeature(e,t,n,r,i,a,o,s){let c=ko(e,this.paint.get(`circle-translate`),this.paint.get(`circle-translate-anchor`),a.angle,o),l=this.paint.get(`circle-radius`).evaluate(t,n)+this.paint.get(`circle-stroke-width`).evaluate(t,n),u=this.paint.get(`circle-pitch-alignment`)===`map`,d=u?c:function(e,t){return e.map((e=>Vo(e,t)))}(c,s),f=u?l*o:l;for(let e of r)for(let t of e){let e=u?t:Vo(t,s),n=f,r=zo([],[t.x,t.y,0,1],s);if(this.paint.get(`circle-pitch-scale`)===`viewport`&&this.paint.get(`circle-pitch-alignment`)===`map`?n*=r[3]/a.cameraToCenterDistance:this.paint.get(`circle-pitch-scale`)===`map`&&this.paint.get(`circle-pitch-alignment`)===`viewport`&&(n*=a.cameraToCenterDistance/r[3]),_o(d,e,n))return!0}return!1}}function Vo(e,t){let n=zo([],[e.x,e.y,0,1],t);return new a(n[0]/n[3],n[1]/n[3])}class Ho extends ho{}let Uo;Ur(`HeatmapBucket`,Ho,{omit:[`layers`]});var Wo={get paint(){return Uo||=new ki({"heatmap-radius":new Ti(H.paint_heatmap[`heatmap-radius`]),"heatmap-weight":new Ti(H.paint_heatmap[`heatmap-weight`]),"heatmap-intensity":new wi(H.paint_heatmap[`heatmap-intensity`]),"heatmap-color":new Oi(H.paint_heatmap[`heatmap-color`]),"heatmap-opacity":new wi(H.paint_heatmap[`heatmap-opacity`])})}};function Go(e,{width:t,height:n},r,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*n*r)throw RangeError(`mismatched image size. expected: ${i.length} but got: ${t*n*r}`)}else i=new Uint8Array(t*n*r);return e.width=t,e.height=n,e.data=i,e}function Ko(e,{width:t,height:n},r){if(t===e.width&&n===e.height)return;let i=Go({},{width:t,height:n},r);qo(e,i,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,n)},r),e.width=t,e.height=n,e.data=i.data}function qo(e,t,n,r,i,a){if(i.width===0||i.height===0)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw RangeError(`out of range source coordinates for image copy`);if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw RangeError(`out of range destination coordinates for image copy`);let o=e.data,s=t.data;if(o===s)throw Error(`srcData equals dstData, so image is already copied`);for(let c=0;c<i.height;c++){let l=((n.y+c)*e.width+n.x)*a,u=((r.y+c)*t.width+r.x)*a;for(let e=0;e<i.width*a;e++)s[u+e]=o[l+e]}return t}class Jo{constructor(e,t){Go(this,e,1,t)}resize(e){Ko(this,e,1)}clone(){return new Jo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i){qo(e,t,n,r,i,1)}}class Yo{constructor(e,t){Go(this,e,4,t)}resize(e){Ko(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Yo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i){qo(e,t,n,r,i,4)}}function Xo(e){let t={},n=e.resolution||256,r=e.clips?e.clips.length:1,i=e.image||new Yo({width:n,height:r});if(Math.log(n)/Math.LN2%1!=0)throw Error(`width is not a power of 2 - ${n}`);let a=(n,r,a)=>{t[e.evaluationKey]=a;let o=e.expression.evaluate(t);i.data[n+r+0]=Math.floor(255*o.r/o.a),i.data[n+r+1]=Math.floor(255*o.g/o.a),i.data[n+r+2]=Math.floor(255*o.b/o.a),i.data[n+r+3]=Math.floor(255*o.a)};if(e.clips)for(let t=0,i=0;t<r;++t,i+=4*n)for(let r=0,o=0;r<n;r++,o+=4){let s=r/(n-1),{start:c,end:l}=e.clips[t];a(i,o,c*(1-s)+l*s)}else for(let e=0,t=0;e<n;e++,t+=4)a(0,t,e/(n-1));return i}Ur(`AlphaImage`,Jo),Ur(`RGBAImage`,Yo);class Zo extends ji{createBucket(e){return new Ho(e)}constructor(e){super(e,Wo),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e===`heatmap-color`&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xo({expression:this._transitionablePaint._values[`heatmap-color`].value.expression,evaluationKey:`heatmapDensity`,image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&=(this.heatmapFbo.destroy(),null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get(`heatmap-opacity`)!==0&&this.visibility!==`none`}}let Qo;var $o={get paint(){return Qo||=new ki({"hillshade-illumination-direction":new wi(H.paint_hillshade[`hillshade-illumination-direction`]),"hillshade-illumination-anchor":new wi(H.paint_hillshade[`hillshade-illumination-anchor`]),"hillshade-exaggeration":new wi(H.paint_hillshade[`hillshade-exaggeration`]),"hillshade-shadow-color":new wi(H.paint_hillshade[`hillshade-shadow-color`]),"hillshade-highlight-color":new wi(H.paint_hillshade[`hillshade-highlight-color`]),"hillshade-accent-color":new wi(H.paint_hillshade[`hillshade-accent-color`])})}};class es extends ji{constructor(e){super(e,$o)}hasOffscreenPass(){return this.paint.get(`hillshade-exaggeration`)!==0&&this.visibility!==`none`}}let{members:ts}=Fi([{name:`a_pos`,components:2,type:`Int16`}],4);var ns={exports:{}};function rs(e,t,n){n||=2;var r,i,a,o,s,c,l,u=t&&t.length,d=u?t[0]*n:e.length,f=is(e,0,d,n,!0),p=[];if(!f||f.next===f.prev)return p;if(u&&(f=function(e,t,n,r){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=is(e,t[i]*r,i<a-1?t[i+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(hs(o));for(s.sort(ds),i=0;i<s.length;i++)n=fs(s[i],n);return n}(e,t,f,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var m=n;m<d;m+=n)(s=e[m])<r&&(r=s),(c=e[m+1])<i&&(i=c),s>a&&(a=s),c>o&&(o=c);l=(l=Math.max(a-r,o-i))===0?0:32767/l}return os(f,p,n,r,i,l,0),p}function is(e,t,n,r,i){var a,o;if(i===Os(e,t,n,r)>0)for(a=t;a<n;a+=r)o=Ts(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=Ts(a,e[a],e[a+1],o);return o&&ys(o,o.next)&&(Es(o),o=o.next),o}function as(e,t){if(!e)return e;t||=e;var n,r=e;do if(n=!1,r.steiner||!ys(r,r.next)&&vs(r.prev,r,r.next)!==0)r=r.next;else{if(Es(r),(r=t=r.prev)===r.next)break;n=!0}while(n||r!==t);return t}function os(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do i.z===0&&(i.z=ms(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,c,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(c=l;s>0||c>0&&r;)s!==0&&(c===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,l*=2}while(o>1)}(i)}(e,r,i,a);for(var s,c,l=e;e.prev!==e.next;)if(s=e.prev,c=e.next,a?cs(e,r,i,a):ss(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(c.i/n|0),Es(e),e=c.next,l=c.next;else if((e=c)===l){o?o===1?os(e=ls(as(e),t,n),t,n,r,i,a,2):o===2&&us(e,t,n,r,i,a):os(as(e),t,n,r,i,a,1);break}}}function ss(e){var t=e.prev,n=e,r=e.next;if(vs(t,n,r)>=0)return!1;for(var i=t.x,a=n.x,o=r.x,s=t.y,c=n.y,l=r.y,u=i<a?i<o?i:o:a<o?a:o,d=s<c?s<l?s:l:c<l?c:l,f=i>a?i>o?i:o:a>o?a:o,p=s>c?s>l?s:l:c>l?c:l,m=r.next;m!==t;){if(m.x>=u&&m.x<=f&&m.y>=d&&m.y<=p&&gs(i,s,a,c,o,l,m.x,m.y)&&vs(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function cs(e,t,n,r){var i=e.prev,a=e,o=e.next;if(vs(i,a,o)>=0)return!1;for(var s=i.x,c=a.x,l=o.x,u=i.y,d=a.y,f=o.y,p=s<c?s<l?s:l:c<l?c:l,m=u<d?u<f?u:f:d<f?d:f,h=s>c?s>l?s:l:c>l?c:l,g=u>d?u>f?u:f:d>f?d:f,_=ms(p,m,t,n,r),v=ms(h,g,t,n,r),y=e.prevZ,b=e.nextZ;y&&y.z>=_&&b&&b.z<=v;){if(y.x>=p&&y.x<=h&&y.y>=m&&y.y<=g&&y!==i&&y!==o&&gs(s,u,c,d,l,f,y.x,y.y)&&vs(y.prev,y,y.next)>=0||(y=y.prevZ,b.x>=p&&b.x<=h&&b.y>=m&&b.y<=g&&b!==i&&b!==o&&gs(s,u,c,d,l,f,b.x,b.y)&&vs(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;y&&y.z>=_;){if(y.x>=p&&y.x<=h&&y.y>=m&&y.y<=g&&y!==i&&y!==o&&gs(s,u,c,d,l,f,y.x,y.y)&&vs(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=v;){if(b.x>=p&&b.x<=h&&b.y>=m&&b.y<=g&&b!==i&&b!==o&&gs(s,u,c,d,l,f,b.x,b.y)&&vs(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function ls(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!ys(i,a)&&bs(i,r,r.next,a)&&Cs(i,a)&&Cs(a,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(a.i/n|0),Es(r),Es(r.next),r=e=a),r=r.next}while(r!==e);return as(r)}function us(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&_s(o,s)){var c=ws(o,s);o=as(o,o.next),c=as(c,c.next),os(o,t,n,r,i,a,0),os(c,t,n,r,i,a,0);return}s=s.next}o=o.next}while(o!==e)}function ds(e,t){return e.x-t.x}function fs(e,t){var n=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o&&(o=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var c,l=n,u=n.x,d=n.y,f=1/0;r=n;do i>=r.x&&r.x>=u&&i!==r.x&&gs(a<d?i:o,a,u,d,a<d?o:i,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(i-r.x),Cs(r,e)&&(c<f||c===f&&(r.x>n.x||r.x===n.x&&ps(n,r)))&&(n=r,f=c)),r=r.next;while(r!==l);return n}(e,t);if(!n)return t;var r=ws(n,e);return as(r,r.next),as(n,n.next)}function ps(e,t){return vs(e.prev,e,t.prev)<0&&vs(t.next,e,e.next)<0}function ms(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function hs(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function gs(e,t,n,r,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(i-o)*(r-s)}function _s(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&bs(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Cs(e,t)&&Cs(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}(e,t)&&(vs(e.prev,e,t.prev)||vs(e,t.prev,t))||ys(e,t)&&vs(e.prev,e,e.next)>0&&vs(t.prev,t,t.next)>0)}function vs(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ys(e,t){return e.x===t.x&&e.y===t.y}function bs(e,t,n,r){var i=Ss(vs(e,t,n)),a=Ss(vs(e,t,r)),o=Ss(vs(n,r,e)),s=Ss(vs(n,r,t));return i!==a&&o!==s||!(i!==0||!xs(e,n,t))||!(a!==0||!xs(e,r,t))||!(o!==0||!xs(n,e,r))||!(s!==0||!xs(n,t,r))}function xs(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Ss(e){return e>0?1:e<0?-1:0}function Cs(e,t){return vs(e.prev,e,e.next)<0?vs(e,t,e.next)>=0&&vs(e,e.prev,t)>=0:vs(e,t,e.prev)<0||vs(e,e.next,t)<0}function ws(e,t){var n=new Ds(e.i,e.x,e.y),r=new Ds(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Ts(e,t,n,r){var i=new Ds(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Es(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ds(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Os(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}ns.exports=rs,ns.exports.default=rs,rs.deviation=function(e,t,n,r){var i=t&&t.length,a=Math.abs(Os(e,0,i?t[0]*n:e.length,n));if(i)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(Os(e,t[o]*n,o<s-1?t[o+1]*n:e.length,n));var c=0;for(o=0;o<r.length;o+=3){var l=r[o]*n,u=r[o+1]*n,d=r[o+2]*n;c+=Math.abs((e[l]-e[d])*(e[u+1]-e[l+1])-(e[l]-e[u])*(e[d+1]-e[l+1]))}return a===0&&c===0?0:Math.abs((c-a)/a)},rs.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&n.holes.push(r+=e[i-1].length)}return n};var ks=n(ns.exports);function As(e,t,n,r,i){js(e,t,n||0,r||e.length-1,i||Ns)}function js(e,t,n,r,i){for(;r>n;){if(r-n>600){var a=r-n+1,o=t-n+1,s=Math.log(a),c=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*c*(a-c)/a)*(o-a/2<0?-1:1);js(e,t,Math.max(n,Math.floor(t-o*c/a+l)),Math.min(r,Math.floor(t+(a-o)*c/a+l)),i)}var u=e[t],d=n,f=r;for(Ms(e,n,t),i(e[r],u)>0&&Ms(e,n,r);d<f;){for(Ms(e,d,f),d++,f--;i(e[d],u)<0;)d++;for(;i(e[f],u)>0;)f--}i(e[n],u)===0?Ms(e,n,f):Ms(e,++f,r),f<=t&&(n=f+1),t<=f&&(r=f-1)}}function Ms(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function Ns(e,t){return e<t?-1:e>t?1:0}function Ps(e,t){let n=e.length;if(n<=1)return[e];let r=[],i,a;for(let t=0;t<n;t++){let n=E(e[t]);n!==0&&(e[t].area=Math.abs(n),a===void 0&&(a=n<0),a===n<0?(i&&r.push(i),i=[e[t]]):i.push(e[t]))}if(i&&r.push(i),t>1)for(let e=0;e<r.length;e++)r[e].length<=t||(As(r[e],t,1,r[e].length-1,Fs),r[e]=r[e].slice(0,t));return r}function Fs(e,t){return t.area-e.area}function Is(e,t,n){let r=n.patternDependencies,i=!1;for(let n of t){let t=n.paint.get(`${e}-pattern`);t.isConstant()||(i=!0);let a=t.constantOr(null);a&&(i=!0,r[a.to]=!0,r[a.from]=!0)}return i}function Ls(e,t,n,r,i){let a=i.patternDependencies;for(let o of t){let t=o.paint.get(`${e}-pattern`).value;if(t.kind!==`constant`){let e=t.evaluate({zoom:r-1},n,{},i.availableImages),s=t.evaluate({zoom:r},n,{},i.availableImages),c=t.evaluate({zoom:r+1},n,{},i.availableImages);e=e&&e.name?e.name:e,s=s&&s.name?s.name:s,c=c&&c.name?c.name:c,a[e]=!0,a[s]=!0,a[c]=!0,n.patterns[o.id]={min:e,mid:s,max:c}}}return n}class Rs{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ba,this.indexArray=new Aa,this.indexArray2=new ja,this.programConfigurations=new ao(e.layers,e.zoom),this.segments=new Na,this.segments2=new Na,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=Is(`fill`,this.layers,t);let r=this.layers[0].layout.get(`fill-sort-key`),i=!r.isConstant(),a=[];for(let{feature:o,id:s,index:c,sourceLayerIndex:l}of e){let e=this.layers[0]._featureFilter.needGeometry,u=po(o,e);if(!this.layers[0]._featureFilter.filter(new hi(this.zoom),u,n))continue;let d=i?r.evaluate(u,{},n,t.availableImages):void 0,f={id:s,properties:o.properties,type:o.type,sourceLayerIndex:l,index:c,geometry:e?u.geometry:fo(o),patterns:{},sortKey:d};a.push(f)}i&&a.sort(((e,t)=>e.sortKey-t.sortKey));for(let r of a){let{geometry:i,index:a,sourceLayerIndex:o}=r;if(this.hasPattern){let e=Ls(`fill`,this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,i,a,n,{});t.featureIndex.insert(e[a].feature,i,a,o,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(let e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ts),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,r,i){for(let e of Ps(t,500)){let t=0;for(let n of e)t+=n.length;let n=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),r=n.vertexLength,i=[],a=[];for(let t of e){if(t.length===0)continue;t!==e[0]&&a.push(i.length/2);let n=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),r=n.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(r+t.length-1,r),i.push(t[0].x),i.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(r+e-1,r+e),i.push(t[e].x),i.push(t[e].y);n.vertexLength+=t.length,n.primitiveLength+=t.length}let o=ks(i,a);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(r+o[e],r+o[e+1],r+o[e+2]);n.vertexLength+=t,n.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)}}let zs,Bs;Ur(`FillBucket`,Rs,{omit:[`layers`,`patternFeatures`]});var Vs={get paint(){return Bs||=new ki({"fill-antialias":new wi(H.paint_fill[`fill-antialias`]),"fill-opacity":new Ti(H.paint_fill[`fill-opacity`]),"fill-color":new Ti(H.paint_fill[`fill-color`]),"fill-outline-color":new Ti(H.paint_fill[`fill-outline-color`]),"fill-translate":new wi(H.paint_fill[`fill-translate`]),"fill-translate-anchor":new wi(H.paint_fill[`fill-translate-anchor`]),"fill-pattern":new Ei(H.paint_fill[`fill-pattern`])})},get layout(){return zs||=new ki({"fill-sort-key":new Ti(H.layout_fill[`fill-sort-key`])})}};class Hs extends ji{constructor(e){super(e,Vs)}recalculate(e,t){super.recalculate(e,t);let n=this.paint._values[`fill-outline-color`];n.value.kind===`constant`&&n.value.value===void 0&&(this.paint._values[`fill-outline-color`]=this.paint._values[`fill-color`])}createBucket(e){return new Rs(e)}queryRadius(){return Oo(this.paint.get(`fill-translate`))}queryIntersectsFeature(e,t,n,r,i,a,o){return vo(ko(e,this.paint.get(`fill-translate`),this.paint.get(`fill-translate-anchor`),a.angle,o),r)}isTileClipped(){return!0}}let Us=Fi([{name:`a_pos`,components:2,type:`Int16`},{name:`a_normal_ed`,components:4,type:`Int16`}],4),Ws=Fi([{name:`a_centroid`,components:2,type:`Int16`}],4),{members:Gs}=Us;var Ks={},qs=r,Js=Ys;function Ys(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(Xs,this,t)}function Xs(e,t,n){e==1?t.id=n.readVarint():e==2?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):e==3?t.type=n.readVarint():e==4&&(t._geometry=n.pos)}function Zs(e){for(var t,n,r=0,i=0,a=e.length,o=a-1;i<a;o=i++)r+=((n=e[o]).x-(t=e[i]).x)*(t.y+n.y);return r}Ys.types=[`Unknown`,`Point`,`LineString`,`Polygon`],Ys.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,r=1,i=0,a=0,o=0,s=[];e.pos<n;){if(i<=0){var c=e.readVarint();r=7&c,i=c>>3}if(i--,r===1||r===2)a+=e.readSVarint(),o+=e.readSVarint(),r===1&&(t&&s.push(t),t=[]),t.push(new qs(a,o));else{if(r!==7)throw Error(`unknown command `+r);t&&t.push(t[0].clone())}}return t&&s.push(t),s},Ys.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,a=0,o=1/0,s=-1/0,c=1/0,l=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();n=7&u,r=u>>3}if(r--,n===1||n===2)(i+=e.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=e.readSVarint())<c&&(c=a),a>l&&(l=a);else if(n!==7)throw Error(`unknown command `+n)}return[o,c,s,l]},Ys.prototype.toGeoJSON=function(e,t,n){var r,i,a=this.extent*2**n,o=this.extent*e,s=this.extent*t,c=this.loadGeometry(),l=Ys.types[this.type];function u(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(r=0;r<c.length;r++)d[r]=c[r][0];u(c=d);break;case 2:for(r=0;r<c.length;r++)u(c[r]);break;case 3:for(c=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],a=0;a<t;a++){var o=Zs(e[a]);o!==0&&(r===void 0&&(r=o<0),r===o<0?(n&&i.push(n),n=[e[a]]):n.push(e[a]))}return n&&i.push(n),i}(c),r=0;r<c.length;r++)for(i=0;i<c[r].length;i++)u(c[r][i])}c.length===1?c=c[0]:l=`Multi`+l;var f={type:`Feature`,geometry:{type:l,coordinates:c},properties:this.properties};return`id`in this&&(f.id=this.id),f};var Qs=Js,$s=ec;function ec(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(tc,this,t),this.length=this._features.length}function tc(e,t,n){e===15?t.version=n.readVarint():e===1?t.name=n.readString():e===5?t.extent=n.readVarint():e===2?t._features.push(n.pos):e===3?t._keys.push(n.readString()):e===4&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var r=e.readVarint()>>3;t=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null}return t}(n))}ec.prototype.feature=function(e){if(e<0||e>=this._features.length)throw Error(`feature index out of bounds`);this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Qs(this._pbf,t,this.extent,this._keys,this._values)};var nc=$s;function rc(e,t,n){if(e===3){var r=new nc(n,n.readVarint()+n.pos);r.length&&(t[r.name]=r)}}Ks.VectorTile=function(e,t){this.layers=e.readFields(rc,{},t)},Ks.VectorTileFeature=Js,Ks.VectorTileLayer=$s;let ic=Ks.VectorTileFeature.types,ac=2**13;function oc(e,t,n,r,i,a,o,s){e.emplaceBack(t,n,2*Math.floor(r*ac)+o,i*ac*2,a*ac*2,Math.round(s))}class sc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new xa,this.centroidVertexArray=new va,this.indexArray=new Aa,this.programConfigurations=new ao(e.layers,e.zoom),this.segments=new Na,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.features=[],this.hasPattern=Is(`fill-extrusion`,this.layers,t);for(let{feature:r,id:i,index:a,sourceLayerIndex:o}of e){let e=this.layers[0]._featureFilter.needGeometry,s=po(r,e);if(!this.layers[0]._featureFilter.filter(new hi(this.zoom),s,n))continue;let c={id:i,sourceLayerIndex:o,index:a,geometry:e?s.geometry:fo(r),properties:r.properties,type:r.type,patterns:{}};this.hasPattern?this.features.push(Ls(`fill-extrusion`,this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,a,n,{}),t.featureIndex.insert(r,c.geometry,a,o,this.index,!0)}}addFeatures(e,t,n){for(let e of this.features){let{geometry:r}=e;this.addFeature(e,r,e.index,t,n)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gs),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ws.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,t,n,r,i){let a={x:0,y:0,vertexCount:0};for(let n of Ps(t,500)){let t=0;for(let e of n)t+=e.length;let r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let e of n){if(e.length===0||lc(e))continue;let t=0;for(let n=0;n<e.length;n++){let i=e[n];if(n>=1){let o=e[n-1];if(!cc(i,o)){r.vertexLength+4>Na.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let e=i.sub(o)._perp()._unit(),n=o.dist(i);t+n>32768&&(t=0),oc(this.layoutVertexArray,i.x,i.y,e.x,e.y,0,0,t),oc(this.layoutVertexArray,i.x,i.y,e.x,e.y,0,1,t),a.x+=2*i.x,a.y+=2*i.y,a.vertexCount+=2,t+=n,oc(this.layoutVertexArray,o.x,o.y,e.x,e.y,0,0,t),oc(this.layoutVertexArray,o.x,o.y,e.x,e.y,0,1,t),a.x+=2*o.x,a.y+=2*o.y,a.vertexCount+=2;let s=r.vertexLength;this.indexArray.emplaceBack(s,s+2,s+1),this.indexArray.emplaceBack(s+1,s+2,s+3),r.vertexLength+=4,r.primitiveLength+=2}}}}if(r.vertexLength+t>Na.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),ic[e.type]!==`Polygon`)continue;let i=[],o=[],s=r.vertexLength;for(let e of n)if(e.length!==0){e!==n[0]&&o.push(i.length/2);for(let t=0;t<e.length;t++){let n=e[t];oc(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),a.x+=n.x,a.y+=n.y,a.vertexCount+=1,i.push(n.x),i.push(n.y)}}let c=ks(i,o);for(let e=0;e<c.length;e+=3)this.indexArray.emplaceBack(s+c[e],s+c[e+2],s+c[e+1]);r.primitiveLength+=c.length/3,r.vertexLength+=t}for(let e=0;e<a.vertexCount;e++)this.centroidVertexArray.emplaceBack(Math.floor(a.x/a.vertexCount),Math.floor(a.y/a.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)}}function cc(e,t){return e.x===t.x&&(e.x<0||e.x>co)||e.y===t.y&&(e.y<0||e.y>co)}function lc(e){return e.every((e=>e.x<0))||e.every((e=>e.x>co))||e.every((e=>e.y<0))||e.every((e=>e.y>co))}let uc;Ur(`FillExtrusionBucket`,sc,{omit:[`layers`,`features`]});var dc={get paint(){return uc||=new ki({"fill-extrusion-opacity":new wi(H[`paint_fill-extrusion`][`fill-extrusion-opacity`]),"fill-extrusion-color":new Ti(H[`paint_fill-extrusion`][`fill-extrusion-color`]),"fill-extrusion-translate":new wi(H[`paint_fill-extrusion`][`fill-extrusion-translate`]),"fill-extrusion-translate-anchor":new wi(H[`paint_fill-extrusion`][`fill-extrusion-translate-anchor`]),"fill-extrusion-pattern":new Ei(H[`paint_fill-extrusion`][`fill-extrusion-pattern`]),"fill-extrusion-height":new Ti(H[`paint_fill-extrusion`][`fill-extrusion-height`]),"fill-extrusion-base":new Ti(H[`paint_fill-extrusion`][`fill-extrusion-base`]),"fill-extrusion-vertical-gradient":new wi(H[`paint_fill-extrusion`][`fill-extrusion-vertical-gradient`])})}};class fc extends ji{constructor(e){super(e,dc)}createBucket(e){return new sc(e)}queryRadius(){return Oo(this.paint.get(`fill-extrusion-translate`))}is3D(){return!0}queryIntersectsFeature(e,t,n,r,i,o,s,c){let l=ko(e,this.paint.get(`fill-extrusion-translate`),this.paint.get(`fill-extrusion-translate-anchor`),o.angle,s),u=this.paint.get(`fill-extrusion-height`).evaluate(t,n),d=this.paint.get(`fill-extrusion-base`).evaluate(t,n),f=function(e,t,n,r){let i=[];for(let n of e){let e=[n.x,n.y,0,1];zo(e,e,t),i.push(new a(e[0]/e[3],e[1]/e[3]))}return i}(l,c),p=function(e,t,n,r){let i=[],o=[],s=r[8]*t,c=r[9]*t,l=r[10]*t,u=r[11]*t,d=r[8]*n,f=r[9]*n,p=r[10]*n,m=r[11]*n;for(let t of e){let e=[],n=[];for(let i of t){let t=i.x,o=i.y,h=r[0]*t+r[4]*o+r[12],g=r[1]*t+r[5]*o+r[13],_=r[2]*t+r[6]*o+r[14],v=r[3]*t+r[7]*o+r[15],y=_+l,b=v+u,x=h+d,S=g+f,C=_+p,w=v+m,E=new a((h+s)/b,(g+c)/b);E.z=y/b,e.push(E);let D=new a(x/w,S/w);D.z=C/w,n.push(D)}i.push(e),o.push(n)}return[i,o]}(r,d,u,c);return function(e,t,n){let r=1/0;vo(n,t)&&(r=mc(n,t[0]));for(let i=0;i<t.length;i++){let a=t[i],o=e[i];for(let e=0;e<a.length-1;e++){let t=a[e],i=[t,a[e+1],o[e+1],o[e],t];go(n,i)&&(r=Math.min(r,mc(n,i)))}}return r!==1/0&&r}(p[0],p[1],f)}}function pc(e,t){return e.x*t.x+e.y*t.y}function mc(e,t){if(e.length===1){let n=0,r=t[n++],i;for(;!i||r.equals(i);)if(i=t[n++],!i)return 1/0;for(;n<t.length;n++){let a=t[n],o=e[0],s=i.sub(r),c=a.sub(r),l=o.sub(r),u=pc(s,s),d=pc(s,c),f=pc(c,c),p=pc(l,s),m=pc(l,c),h=u*f-d*d,g=(f*p-d*m)/h,_=(u*m-d*p)/h,v=r.z*(1-g-_)+i.z*g+a.z*_;if(isFinite(v))return v}return 1/0}{let e=1/0;for(let n of t)e=Math.min(e,n.z);return e}}let{members:hc}=Fi([{name:`a_pos_normal`,components:2,type:`Int16`},{name:`a_data`,components:4,type:`Uint8`}],4),{members:gc}=Fi([{name:`a_uv_x`,components:1,type:`Float32`},{name:`a_split_index`,components:1,type:`Float32`}]),_c=Ks.VectorTileFeature.types,vc=Math.cos(Math.PI/180*37.5),yc=2**14/.5;class bc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Sa,this.layoutVertexArray2=new Ca,this.indexArray=new Aa,this.programConfigurations=new ao(e.layers,e.zoom),this.segments=new Na,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=Is(`line`,this.layers,t);let r=this.layers[0].layout.get(`line-sort-key`),i=!r.isConstant(),a=[];for(let{feature:t,id:o,index:s,sourceLayerIndex:c}of e){let e=this.layers[0]._featureFilter.needGeometry,l=po(t,e);if(!this.layers[0]._featureFilter.filter(new hi(this.zoom),l,n))continue;let u=i?r.evaluate(l,{},n):void 0,d={id:o,properties:t.properties,type:t.type,sourceLayerIndex:c,index:s,geometry:e?l.geometry:fo(t),patterns:{},sortKey:u};a.push(d)}i&&a.sort(((e,t)=>e.sortKey-t.sortKey));for(let r of a){let{geometry:i,index:a,sourceLayerIndex:o}=r;if(this.hasPattern){let e=Ls(`line`,this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,i,a,n,{});t.featureIndex.insert(e[a].feature,i,a,o,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(let e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,`mapbox_clip_start`)&&Object.prototype.hasOwnProperty.call(e.properties,`mapbox_clip_end`))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,r,i){let a=this.layers[0].layout,o=a.get(`line-join`).evaluate(e,{}),s=a.get(`line-cap`),c=a.get(`line-miter-limit`),l=a.get(`line-round-limit`);this.lineClips=this.lineFeatureClips(e);for(let n of t)this.addLine(n,e,o,s,c,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)}addLine(e,t,n,r,i,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let o=_c[t.type]===`Polygon`,s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let c=0;for(;c<s-1&&e[c].equals(e[c+1]);)c++;if(s<(o?3:2))return;n===`bevel`&&(i=1.05);let l=this.overscaling<=16?15*co/(512*this.overscaling):0,u=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray),d,f,p,m,h;this.e1=this.e2=-1,o&&(d=e[s-2],h=e[c].sub(d)._unit()._perp());for(let t=c;t<s;t++){if(p=t===s-1?o?e[c+1]:void 0:e[t+1],p&&e[t].equals(p))continue;h&&(m=h),d&&(f=d),d=e[t],h=p?p.sub(d)._unit()._perp():m,m||=h;let g=m.add(h);g.x===0&&g.y===0||g._unit();let _=m.x*h.x+m.y*h.y,v=g.x*h.x+g.y*h.y,y=v===0?1/0:1/v,b=2*Math.sqrt(2-2*v),x=v<vc&&f&&p,S=m.x*h.y-m.y*h.x>0;if(x&&t>c){let e=d.dist(f);if(e>2*l){let t=d.sub(d.sub(f)._mult(l/e)._round());this.updateDistance(f,t),this.addCurrentVertex(t,m,0,0,u),f=t}}let C=f&&p,w=C?n:o?`butt`:r;if(C&&w===`round`&&(y<a?w=`miter`:y<=2&&(w=`fakeround`)),w===`miter`&&y>i&&(w=`bevel`),w===`bevel`&&(y>2&&(w=`flipbevel`),y<i&&(w=`miter`)),f&&this.updateDistance(f,d),w===`miter`)g._mult(y),this.addCurrentVertex(d,g,0,0,u);else if(w===`flipbevel`){if(y>100)g=h.mult(-1);else{let e=y*m.add(h).mag()/m.sub(h).mag();g._perp()._mult(e*(S?-1:1))}this.addCurrentVertex(d,g,0,0,u),this.addCurrentVertex(d,g.mult(-1),0,0,u)}else if(w===`bevel`||w===`fakeround`){let e=-Math.sqrt(y*y-1),t=S?e:0,n=S?0:e;if(f&&this.addCurrentVertex(d,m,t,n,u),w===`fakeround`){let e=Math.round(180*b/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(n!==.5){let e=n-.5;n+=n*e*(n-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*e*e+(.848013+_*(.215638*_-1.06021)))}let r=h.sub(m)._mult(n)._add(m)._unit()._mult(S?-1:1);this.addHalfVertex(d,r.x,r.y,!1,S,0,u)}}p&&this.addCurrentVertex(d,h,-t,-n,u)}else if(w===`butt`)this.addCurrentVertex(d,g,0,0,u);else if(w===`square`){let e=f?1:-1;this.addCurrentVertex(d,g,e,e,u)}else w===`round`&&(f&&(this.addCurrentVertex(d,m,0,0,u),this.addCurrentVertex(d,m,1,1,u,!0)),p&&(this.addCurrentVertex(d,h,-1,-1,u,!0),this.addCurrentVertex(d,h,0,0,u)));if(x&&t<s-1){let e=d.dist(p);if(e>2*l){let t=d.add(p.sub(d)._mult(l/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,h,0,0,u),d=t}}}}addCurrentVertex(e,t,n,r,i,a=!1){let o=t.y*r-t.x,s=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,a,!1,n,i),this.addHalfVertex(e,o,s,a,!0,-r,i),this.distance>yc/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,n,r,i,a))}addHalfVertex({x:e,y:t},n,r,i,a,o,s){let c=.5*(this.lineClips?this.scaledDistance*(yc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(i?1:0),(t<<1)+(a?1:0),Math.round(63*n)+128,Math.round(63*r)+128,1+(o===0?0:o<0?-1:1)|(63&c)<<2,c>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let l=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),s.primitiveLength++),a?this.e2=l:this.e1=l}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}let xc,Sc;Ur(`LineBucket`,bc,{omit:[`layers`,`patternFeatures`]});var Cc={get paint(){return Sc||=new ki({"line-opacity":new Ti(H.paint_line[`line-opacity`]),"line-color":new Ti(H.paint_line[`line-color`]),"line-translate":new wi(H.paint_line[`line-translate`]),"line-translate-anchor":new wi(H.paint_line[`line-translate-anchor`]),"line-width":new Ti(H.paint_line[`line-width`]),"line-gap-width":new Ti(H.paint_line[`line-gap-width`]),"line-offset":new Ti(H.paint_line[`line-offset`]),"line-blur":new Ti(H.paint_line[`line-blur`]),"line-dasharray":new Di(H.paint_line[`line-dasharray`]),"line-pattern":new Ei(H.paint_line[`line-pattern`]),"line-gradient":new Oi(H.paint_line[`line-gradient`])})},get layout(){return xc||=new ki({"line-cap":new wi(H.layout_line[`line-cap`]),"line-join":new Ti(H.layout_line[`line-join`]),"line-miter-limit":new wi(H.layout_line[`line-miter-limit`]),"line-round-limit":new wi(H.layout_line[`line-round-limit`]),"line-sort-key":new Ti(H.layout_line[`line-sort-key`])})}};class wc extends Ti{possiblyEvaluate(e,t){return t=new hi(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,r){return t=_({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,r)}}let Tc;class Ec extends ji{constructor(e){super(e,Cc),this.gradientVersion=0,Tc||(Tc=new wc(Cc.paint.properties[`line-width`].specification),Tc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e===`line-gradient`){let e=this.gradientExpression();this.stepInterpolant=!!function(e){return e._styleExpression!==void 0}(e)&&e._styleExpression.expression instanceof Yt,this.gradientVersion=(this.gradientVersion+1)%(2**53-1)}}gradientExpression(){return this._transitionablePaint._values[`line-gradient`].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values[`line-floorwidth`]=Tc.possiblyEvaluate(this._transitioningPaint._values[`line-width`].value,e)}createBucket(e){return new bc(e)}queryRadius(e){let t=e,n=Dc(Do(`line-width`,this,t),Do(`line-gap-width`,this,t)),r=Do(`line-offset`,this,t);return n/2+Math.abs(r)+Oo(this.paint.get(`line-translate`))}queryIntersectsFeature(e,t,n,r,i,o,s){let c=ko(e,this.paint.get(`line-translate`),this.paint.get(`line-translate-anchor`),o.angle,s),l=s/2*Dc(this.paint.get(`line-width`).evaluate(t,n),this.paint.get(`line-gap-width`).evaluate(t,n)),u=this.paint.get(`line-offset`).evaluate(t,n);return u&&(r=function(e,t){let n=[];for(let r=0;r<e.length;r++){let i=e[r],o=[];for(let e=0;e<i.length;e++){let n=i[e-1],r=i[e],s=i[e+1],c=e===0?new a(0,0):r.sub(n)._unit()._perp(),l=e===i.length-1?new a(0,0):s.sub(r)._unit()._perp(),u=c._add(l)._unit(),d=u.x*l.x+u.y*l.y;d!==0&&u._mult(1/d),o.push(u._mult(t)._add(r))}n.push(o)}return n}(r,u*s)),function(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];if(e.length>=3){for(let t=0;t<i.length;t++)if(To(e,i[t]))return!0}if(yo(e,i,n))return!0}return!1}(c,r,l)}isTileClipped(){return!0}}function Dc(e,t){return t>0?t+2*e:e}let Oc=Fi([{name:`a_pos_offset`,components:4,type:`Int16`},{name:`a_data`,components:4,type:`Uint16`},{name:`a_pixeloffset`,components:4,type:`Int16`}],4),kc=Fi([{name:`a_projected_pos`,components:3,type:`Float32`}],4);Fi([{name:`a_fade_opacity`,components:1,type:`Uint32`}],4);let Ac=Fi([{name:`a_placed`,components:2,type:`Uint8`},{name:`a_shift`,components:2,type:`Float32`}]);Fi([{type:`Int16`,name:`anchorPointX`},{type:`Int16`,name:`anchorPointY`},{type:`Int16`,name:`x1`},{type:`Int16`,name:`y1`},{type:`Int16`,name:`x2`},{type:`Int16`,name:`y2`},{type:`Uint32`,name:`featureIndex`},{type:`Uint16`,name:`sourceLayerIndex`},{type:`Uint16`,name:`bucketIndex`}]);let jc=Fi([{name:`a_pos`,components:2,type:`Int16`},{name:`a_anchor_pos`,components:2,type:`Int16`},{name:`a_extrude`,components:2,type:`Int16`}],4),Mc=Fi([{name:`a_pos`,components:2,type:`Float32`},{name:`a_radius`,components:1,type:`Float32`},{name:`a_flags`,components:2,type:`Int16`}],4);function Nc(e,t,n){return e.sections.forEach((e=>{e.text=function(e,t,n){let r=t.layout.get(`text-transform`).evaluate(n,{});return r===`uppercase`?e=e.toLocaleUpperCase():r===`lowercase`&&(e=e.toLocaleLowerCase()),mi.applyArabicShaping&&(e=mi.applyArabicShaping(e)),e}(e.text,t,n)})),e}Fi([{name:`triangle`,components:3,type:`Uint16`}]),Fi([{type:`Int16`,name:`anchorX`},{type:`Int16`,name:`anchorY`},{type:`Uint16`,name:`glyphStartIndex`},{type:`Uint16`,name:`numGlyphs`},{type:`Uint32`,name:`vertexStartIndex`},{type:`Uint32`,name:`lineStartIndex`},{type:`Uint32`,name:`lineLength`},{type:`Uint16`,name:`segment`},{type:`Uint16`,name:`lowerSize`},{type:`Uint16`,name:`upperSize`},{type:`Float32`,name:`lineOffsetX`},{type:`Float32`,name:`lineOffsetY`},{type:`Uint8`,name:`writingMode`},{type:`Uint8`,name:`placedOrientation`},{type:`Uint8`,name:`hidden`},{type:`Uint32`,name:`crossTileID`},{type:`Int16`,name:`associatedIconIndex`}]),Fi([{type:`Int16`,name:`anchorX`},{type:`Int16`,name:`anchorY`},{type:`Int16`,name:`rightJustifiedTextSymbolIndex`},{type:`Int16`,name:`centerJustifiedTextSymbolIndex`},{type:`Int16`,name:`leftJustifiedTextSymbolIndex`},{type:`Int16`,name:`verticalPlacedTextSymbolIndex`},{type:`Int16`,name:`placedIconSymbolIndex`},{type:`Int16`,name:`verticalPlacedIconSymbolIndex`},{type:`Uint16`,name:`key`},{type:`Uint16`,name:`textBoxStartIndex`},{type:`Uint16`,name:`textBoxEndIndex`},{type:`Uint16`,name:`verticalTextBoxStartIndex`},{type:`Uint16`,name:`verticalTextBoxEndIndex`},{type:`Uint16`,name:`iconBoxStartIndex`},{type:`Uint16`,name:`iconBoxEndIndex`},{type:`Uint16`,name:`verticalIconBoxStartIndex`},{type:`Uint16`,name:`verticalIconBoxEndIndex`},{type:`Uint16`,name:`featureIndex`},{type:`Uint16`,name:`numHorizontalGlyphVertices`},{type:`Uint16`,name:`numVerticalGlyphVertices`},{type:`Uint16`,name:`numIconVertices`},{type:`Uint16`,name:`numVerticalIconVertices`},{type:`Uint16`,name:`useRuntimeCollisionCircles`},{type:`Uint32`,name:`crossTileID`},{type:`Float32`,name:`textBoxScale`},{type:`Float32`,name:`collisionCircleDiameter`},{type:`Uint16`,name:`textAnchorOffsetStartIndex`},{type:`Uint16`,name:`textAnchorOffsetEndIndex`}]),Fi([{type:`Float32`,name:`offsetX`}]),Fi([{type:`Int16`,name:`x`},{type:`Int16`,name:`y`},{type:`Int16`,name:`tileUnitDistanceFromAnchor`}]),Fi([{type:`Uint16`,name:`textAnchor`},{type:`Float32`,components:2,name:`textOffset`}]);let Pc={"!":`︕`,"#":`＃`,$:`＄`,"%":`％`,"&":`＆`,"(":`︵`,")":`︶`,"*":`＊`,"+":`＋`,",":`︐`,"-":`︲`,".":`・`,"/":`／`,":":`︓`,";":`︔`,"<":`︿`,"=":`＝`,">":`﹀`,"?":`︖`,"@":`＠`,"[":`﹇`,"\\":`＼`,"]":`﹈`,"^":`＾`,_:`︳`,"`":`｀`,"{":`︷`,"|":`―`,"}":`︸`,"~":`～`,"¢":`￠`,"£":`￡`,"¥":`￥`,"¦":`￤`,"¬":`￢`,"¯":`￣`,"–":`︲`,"—":`︱`,"‘":`﹃`,"’":`﹄`,"“":`﹁`,"”":`﹂`,"…":`︙`,"‧":`・`,"₩":`￦`,"、":`︑`,"。":`︒`,"〈":`︿`,"〉":`﹀`,"《":`︽`,"》":`︾`,"「":`﹁`,"」":`﹂`,"『":`﹃`,"』":`﹄`,"【":`︻`,"】":`︼`,"〔":`︹`,"〕":`︺`,"〖":`︗`,"〗":`︘`,"！":`︕`,"（":`︵`,"）":`︶`,"，":`︐`,"－":`︲`,"．":`・`,"：":`︓`,"；":`︔`,"＜":`︿`,"＞":`﹀`,"？":`︖`,"［":`﹇`,"］":`﹈`,"＿":`︳`,"｛":`︷`,"｜":`―`,"｝":`︸`,"｟":`︵`,"｠":`︶`,"｡":`︒`,"｢":`﹁`,"｣":`﹂`};var Fc=24,Ic=zc,Lc=function(e,t,n,r,i){var a,o,s=8*i-r-1,c=(1<<s)-1,l=c>>1,u=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,a=p&(1<<-u)-1,p>>=-u,u+=s;u>0;a=256*a+e[t+d],d+=f,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+d],d+=f,u-=8);if(a===0)a=1-l;else{if(a===c)return o?NaN:1/0*(p?-1:1);o+=2**r,a-=l}return(p?-1:1)*o*2**(a-r)},Rc=function(e,t,n,r,i,a){var o,s,c,l=8*a-i-1,u=(1<<l)-1,d=u>>1,f=i===23?2**-24-2**-77:0,p=r?0:a-1,m=r?1:-1,h=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=2**-o)<1&&(o--,c*=2),(t+=o+d>=1?f/c:f*2**(1-d))*c>=2&&(o++,c/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*c-1)*2**i,o+=d):(s=t*2**(d-1)*2**i,o=0));i>=8;e[n+p]=255&s,p+=m,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[n+p]=255&o,p+=m,o/=256,l-=8);e[n+p-m]|=128*h};function zc(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}zc.Varint=0,zc.Fixed64=1,zc.Bytes=2,zc.Fixed32=5;var Bc=4294967296,Vc=1/Bc,Hc=typeof TextDecoder>`u`?null:new TextDecoder(`utf8`);function Uc(e){return e.type===zc.Bytes?e.readVarint()+e.pos:e.pos+1}function Wc(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Gc(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function Kc(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function qc(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function Jc(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function Yc(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function Xc(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function Zc(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function Qc(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function $c(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function el(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function tl(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function nl(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function rl(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}zc.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n||=this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,a=this.pos;this.type=7&r,e(i,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=tl(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=rl(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=tl(this.buf,this.pos)+tl(this.buf,this.pos+4)*Bc;return this.pos+=8,e},readSFixed64:function(){var e=tl(this.buf,this.pos)+rl(this.buf,this.pos+4)*Bc;return this.pos+=8,e},readFloat:function(){var e=Lc(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Lc(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,a=n.buf;if(r=(112&(i=a[n.pos++]))>>4,i<128||(r|=(127&(i=a[n.pos++]))<<3,i<128)||(r|=(127&(i=a[n.pos++]))<<10,i<128)||(r|=(127&(i=a[n.pos++]))<<17,i<128)||(r|=(127&(i=a[n.pos++]))<<24,i<128)||(r|=(1&(i=a[n.pos++]))<<31,i<128))return Wc(e,r,t);throw Error(`Expected varint not more than 10 bytes`)}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Hc?function(e,t,n){return Hc.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var r=``,i=t;i<n;){var a,o,s,c=e[i],l=null,u=c>239?4:c>223?3:c>191?2:1;if(i+u>n)break;u===1?c<128&&(l=c):u===2?(192&(a=e[i+1]))==128&&(l=(31&c)<<6|63&a)<=127&&(l=null):u===3?(o=e[i+2],(192&(a=e[i+1]))==128&&(192&o)==128&&((l=(15&c)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):u===4&&(o=e[i+2],s=e[i+3],(192&(a=e[i+1]))==128&&(192&o)==128&&(192&s)==128&&((l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),l===null?(l=65533,u=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==zc.Bytes)return e.push(this.readVarint(t));var n=Uc(this);for(e||=[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==zc.Bytes)return e.push(this.readSVarint());var t=Uc(this);for(e||=[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==zc.Bytes)return e.push(this.readBoolean());var t=Uc(this);for(e||=[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==zc.Bytes)return e.push(this.readFloat());var t=Uc(this);for(e||=[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==zc.Bytes)return e.push(this.readDouble());var t=Uc(this);for(e||=[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==zc.Bytes)return e.push(this.readFixed32());var t=Uc(this);for(e||=[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==zc.Bytes)return e.push(this.readSFixed32());var t=Uc(this);for(e||=[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==zc.Bytes)return e.push(this.readFixed64());var t=Uc(this);for(e||=[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==zc.Bytes)return e.push(this.readSFixed64());var t=Uc(this);for(e||=[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===zc.Varint)for(;this.buf[this.pos++]>127;);else if(t===zc.Bytes)this.pos=this.readVarint()+this.pos;else if(t===zc.Fixed32)this.pos+=4;else{if(t!==zc.Fixed64)throw Error(`Unimplemented type: `+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),nl(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),nl(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),nl(this.buf,-1&e,this.pos),nl(this.buf,Math.floor(e*Vc),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),nl(this.buf,-1&e,this.pos),nl(this.buf,Math.floor(e*Vc),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw Error(`Given varint doesn't fit into 10 bytes`);t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,a=0;a<t.length;a++){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){r>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&=(e[n++]=239,e[n++]=191,e[n++]=189,null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&Gc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),Rc(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Rc(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&Gc(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,zc.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Kc,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,qc,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Xc,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Jc,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Yc,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Zc,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Qc,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,$c,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,el,t)},writeBytesField:function(e,t){this.writeTag(e,zc.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,zc.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,zc.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,zc.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,zc.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,zc.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,zc.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,zc.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,zc.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,zc.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var il=n(Ic);function al(e,t,n){e===1&&n.readMessage(ol,t)}function ol(e,t,n){if(e===3){let{id:e,bitmap:r,width:i,height:a,left:o,top:s,advance:c}=n.readMessage(sl,{});t.push({id:e,bitmap:new Jo({width:i+6,height:a+6},r),metrics:{width:i,height:a,left:o,top:s,advance:c}})}}function sl(e,t,n){e===1?t.id=n.readVarint():e===2?t.bitmap=n.readBytes():e===3?t.width=n.readVarint():e===4?t.height=n.readVarint():e===5?t.left=n.readSVarint():e===6?t.top=n.readSVarint():e===7&&(t.advance=n.readVarint())}function cl(e){let t=0,n=0;for(let r of e)t+=r.w*r.h,n=Math.max(n,r.w);e.sort(((e,t)=>t.h-e.h));let r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}],i=0,a=0;for(let t of e)for(let e=r.length-1;e>=0;e--){let n=r[e];if(!(t.w>n.w||t.h>n.h)){if(t.x=n.x,t.y=n.y,a=Math.max(a,t.y+t.h),i=Math.max(i,t.x+t.w),t.w===n.w&&t.h===n.h){let t=r.pop();e<r.length&&(r[e]=t)}else t.h===n.h?(n.x+=t.w,n.w-=t.w):t.w===n.w?(n.y+=t.h,n.h-=t.h):(r.push({x:n.x+t.w,y:n.y,w:n.w-t.w,h:t.h}),n.y+=t.h,n.h-=t.h);break}}return{w:i,h:a,fill:t/(i*a)||0}}class ll{constructor(e,{pixelRatio:t,version:n,stretchX:r,stretchY:i,content:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=r,this.stretchY=i,this.content=a,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ul{constructor(e,t){let n={},r={};this.haveRenderCallbacks=[];let i=[];this.addImages(e,n,i),this.addImages(t,r,i);let{w:a,h:o}=cl(i),s=new Yo({width:a||1,height:o||1});for(let t in e){let r=e[t],i=n[t].paddedRect;Yo.copy(r.data,s,{x:0,y:0},{x:i.x+1,y:i.y+1},r.data)}for(let e in t){let n=t[e],i=r[e].paddedRect,a=i.x+1,o=i.y+1,c=n.data.width,l=n.data.height;Yo.copy(n.data,s,{x:0,y:0},{x:a,y:o},n.data),Yo.copy(n.data,s,{x:0,y:l-1},{x:a,y:o-1},{width:c,height:1}),Yo.copy(n.data,s,{x:0,y:0},{x:a,y:o+l},{width:c,height:1}),Yo.copy(n.data,s,{x:c-1,y:0},{x:a-1,y:o},{width:1,height:l}),Yo.copy(n.data,s,{x:0,y:0},{x:a+c,y:o},{width:1,height:l})}this.image=s,this.iconPositions=n,this.patternPositions=r}addImages(e,t,n){for(let r in e){let i=e[r],a={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(a),t[r]=new ll(a,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t||e.version===t.version)return;e.version=t.version;let[r,i]=e.tl;n.update(t.data,void 0,{x:r,y:i})}}var dl;Ur(`ImagePosition`,ll),Ur(`ImageAtlas`,ul),e.ai=void 0,(dl=e.ai||={})[dl.none=0]=`none`,dl[dl.horizontal=1]=`horizontal`,dl[dl.vertical=2]=`vertical`,dl[dl.horizontalOnly=3]=`horizontalOnly`;class fl{constructor(){this.scale=1,this.fontStack=``,this.imageName=null}static forText(e,t){let n=new fl;return n.scale=e||1,n.fontStack=t,n}static forImage(e){let t=new fl;return t.imageName=e,t}}class pl{constructor(){this.text=``,this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){let n=new pl;for(let r=0;r<e.sections.length;r++){let i=e.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t=``;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n+1)||null,i=e.charCodeAt(n-1)||null;t+=r&&$r(r)&&!Pc[e[n+1]]||i&&$r(i)&&!Pc[e[n-1]]||!Pc[e[n]]?e[n]:Pc[e[n]]}return t}(this.text)}trim(){let e=0;for(let t=0;t<this.text.length&&hl[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&hl[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){let n=new pl;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(fl.forText(e.scale,e.fontStack||t));let n=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(n)}addImageSection(e){let t=e.image?e.image.name:``;if(t.length===0)return void C(`Can't add FormattedSection with an empty image.`);let n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(fl.forImage(t)),this.sectionIndex.push(this.sections.length-1)):C(`Reached maximum number of images 6401`)}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ml(t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g){let _=pl.fromFeature(t,a),v;f===e.ai.vertical&&_.verticalizePunctuation();let{processBidirectionalText:y,processStyledBidirectionalText:b}=mi;if(y&&_.sections.length===1){v=[];let e=y(_.toString(),Sl(_,u,o,n,i,m,h));for(let t of e){let e=new pl;e.text=t,e.sections=_.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);v.push(e)}}else if(b){v=[];let e=b(_.text,_.sectionIndex,Sl(_,u,o,n,i,m,h));for(let t of e){let e=new pl;e.text=t[0],e.sectionIndex=t[1],e.sections=_.sections,v.push(e)}}else v=function(e,t){let n=[],r=e.text,i=0;for(let r of t)n.push(e.substring(i,r)),i=r;return i<r.length&&n.push(e.substring(i,r.length)),n}(_,Sl(_,u,o,n,i,m,h));let x=[],S={positionedLines:x,text:_.toString(),top:d[1],bottom:d[1],left:d[0],right:d[0],writingMode:f,iconsInText:!1,verticalizable:!1};return function(t,n,r,i,a,o,s,c,l,u,d,f){let p=0,m=-17,h=0,g=0,_=c===`right`?1:c===`left`?0:.5,v=0;for(let s of a){s.trim();let a=s.getMaxScale(),c=(a-1)*Fc,b={positionedGlyphs:[],lineOffset:0};t.positionedLines[v]=b;let x=b.positionedGlyphs,S=0;if(!s.length()){m+=o,++v;continue}for(let o=0;o<s.length();o++){let h=s.getSection(o),g=s.getSectionIndex(o),_=s.getCharCode(o),v=0,b=null,C=null,w=null,E=Fc,D=!(l===e.ai.horizontal||!d&&!Qr(_)||d&&(hl[_]||(y=_,Jr.Arabic(y)||Jr[`Arabic Supplement`](y)||Jr[`Arabic Extended-A`](y)||Jr[`Arabic Presentation Forms-A`](y)||Jr[`Arabic Presentation Forms-B`](y))));if(h.imageName){let e=i[h.imageName];if(!e)continue;w=h.imageName,t.iconsInText=t.iconsInText||!0,C=e.paddedRect;let n=e.displaySize;h.scale=h.scale*Fc/f,b={width:n[0],height:n[1],left:1,top:-3,advance:D?n[1]:n[0]},v=c+(Fc-n[1]*h.scale),E=b.advance;let r=D?n[0]*h.scale-Fc*a:n[1]*h.scale-Fc*a;r>0&&r>S&&(S=r)}else{let e=r[h.fontStack],t=e&&e[_];if(t&&t.rect)C=t.rect,b=t.metrics;else{let e=n[h.fontStack],t=e&&e[_];if(!t)continue;b=t.metrics}v=(a-h.scale)*Fc}D?(t.verticalizable=!0,x.push({glyph:_,imageName:w,x:p,y:m+v,vertical:D,scale:h.scale,fontStack:h.fontStack,sectionIndex:g,metrics:b,rect:C}),p+=E*h.scale+u):(x.push({glyph:_,imageName:w,x:p,y:m+v,vertical:D,scale:h.scale,fontStack:h.fontStack,sectionIndex:g,metrics:b,rect:C}),p+=b.advance*h.scale+u)}x.length!==0&&(h=Math.max(p-u,h),wl(x,0,x.length-1,_,S)),p=0;let C=o*a+S;b.lineOffset=Math.max(S,c),m+=C,g=Math.max(C,g),++v}var y;let b=m- -17,{horizontalAlign:x,verticalAlign:S}=Cl(s);(function(e,t,n,r,i,a,o,s,c){let l=(t-n)*i,u=0;u=a===o?(-r*c+.5)*o:-s*r- -17;for(let t of e)for(let e of t.positionedGlyphs)e.x+=l,e.y+=u})(t.positionedLines,_,x,S,h,g,o,b,a.length),t.top+=-S*b,t.bottom=t.top+b,t.left+=-x*h,t.right=t.left+h}(S,n,r,i,v,s,c,l,f,u,p,g),!function(e){for(let t of e)if(t.positionedGlyphs.length!==0)return!1;return!0}(x)&&S}let hl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gl={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function _l(e,t,n,r,i,a){if(t.imageName){let e=r[t.imageName];return e?e.displaySize[0]*t.scale*Fc/a+i:0}{let r=n[t.fontStack],a=r&&r[e];return a?a.metrics.advance*t.scale+i:0}}function vl(e,t,n,r){let i=(e-t)**2;return r?e<t?i/2:2*i:i+Math.abs(n)*n}function yl(e,t,n){let r=0;return e===10&&(r-=1e4),n&&(r+=150),e!==40&&e!==65288||(r+=50),t!==41&&t!==65289||(r+=50),r}function bl(e,t,n,r,i,a){let o=null,s=vl(t,n,i,a);for(let e of r){let r=vl(t-e.x,n,i,a)+e.badness;r<=s&&(o=e,s=r)}return{index:e,x:t,priorBreak:o,badness:s}}function xl(e){return e?xl(e.priorBreak).concat(e.index):[]}function Sl(e,t,n,r,i,a,o){if(a!==`point`||!e)return[];let s=[],c=function(e,t,n,r,i,a){let o=0;for(let n=0;n<e.length();n++){let s=e.getSection(n);o+=_l(e.getCharCode(n),s,r,i,t,a)}return o/Math.max(1,Math.ceil(o/n))}(e,t,n,r,i,o),l=e.text.indexOf(`​`)>=0,u=0;for(let n=0;n<e.length();n++){let a=e.getSection(n),f=e.getCharCode(n);if(hl[f]||(u+=_l(f,a,r,i,t,o)),n<e.length()-1){let t=!((d=f)<11904||!(Jr[`Bopomofo Extended`](d)||Jr.Bopomofo(d)||Jr[`CJK Compatibility Forms`](d)||Jr[`CJK Compatibility Ideographs`](d)||Jr[`CJK Compatibility`](d)||Jr[`CJK Radicals Supplement`](d)||Jr[`CJK Strokes`](d)||Jr[`CJK Symbols and Punctuation`](d)||Jr[`CJK Unified Ideographs Extension A`](d)||Jr[`CJK Unified Ideographs`](d)||Jr[`Enclosed CJK Letters and Months`](d)||Jr[`Halfwidth and Fullwidth Forms`](d)||Jr.Hiragana(d)||Jr[`Ideographic Description Characters`](d)||Jr[`Kangxi Radicals`](d)||Jr[`Katakana Phonetic Extensions`](d)||Jr.Katakana(d)||Jr[`Vertical Forms`](d)||Jr[`Yi Radicals`](d)||Jr[`Yi Syllables`](d)));(gl[f]||t||a.imageName)&&s.push(bl(n+1,u,c,s,yl(f,e.getCharCode(n+1),t&&l),!1))}}var d;return xl(bl(e.length(),u,c,s,0,!0))}function Cl(e){let t=.5,n=.5;switch(e){case`right`:case`top-right`:case`bottom-right`:t=1;break;case`left`:case`top-left`:case`bottom-left`:t=0}switch(e){case`bottom`:case`bottom-right`:case`bottom-left`:n=1;break;case`top`:case`top-right`:case`top-left`:n=0}return{horizontalAlign:t,verticalAlign:n}}function wl(e,t,n,r,i){if(!r&&!i)return;let a=e[n],o=(e[n].x+a.metrics.advance*a.scale)*r;for(let r=t;r<=n;r++)e[r].x-=o,e[r].y+=i}function Tl(e,t,n){let{horizontalAlign:r,verticalAlign:i}=Cl(n),a=t[0]-e.displaySize[0]*r,o=t[1]-e.displaySize[1]*i;return{image:e,top:o,bottom:o+e.displaySize[1],left:a,right:a+e.displaySize[0]}}function El(e,t,n,r,i,a){let o=e.image,s;if(o.content){let e=o.content,t=o.pixelRatio||1;s=[e[0]/t,e[1]/t,o.displaySize[0]-e[2]/t,o.displaySize[1]-e[3]/t]}let c=t.left*a,l=t.right*a,u,d,f,p;n===`width`||n===`both`?(p=i[0]+c-r[3],d=i[0]+l+r[1]):(p=i[0]+(c+l-o.displaySize[0])/2,d=p+o.displaySize[0]);let m=t.top*a,h=t.bottom*a;return n===`height`||n===`both`?(u=i[1]+m-r[0],f=i[1]+h+r[2]):(u=i[1]+(m+h-o.displaySize[1])/2,f=u+o.displaySize[1]),{image:o,top:u,right:d,bottom:f,left:p,collisionPadding:s}}let Dl=32640;function Ol(e,t){let{expression:n}=t;if(n.kind===`constant`)return{kind:`constant`,layoutSize:n.evaluate(new hi(e+1))};if(n.kind===`source`)return{kind:`source`};{let{zoomStops:t,interpolationType:r}=n,i=0;for(;i<t.length&&t[i]<=e;)i++;i=Math.max(0,i-1);let a=i;for(;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);let o=t[i],s=t[a];return n.kind===`composite`?{kind:`composite`,minZoom:o,maxZoom:s,interpolationType:r}:{kind:`camera`,minZoom:o,maxZoom:s,minSize:n.evaluate(new hi(o)),maxSize:n.evaluate(new hi(s)),interpolationType:r}}}function kl(e,t,n){let r=`never`,i=e.get(t);return i?r=i:e.get(n)&&(r=`always`),r}let Al=Ks.VectorTileFeature.types,jl=[{name:`a_fade_opacity`,components:1,type:`Uint8`,offset:0}];function Ml(e,t,n,r,i,a,o,s,c,l,u,d,f){let p=s?Math.min(Dl,Math.round(s[0])):0,m=s?Math.min(Dl,Math.round(s[1])):0;e.emplaceBack(t,n,Math.round(32*r),Math.round(32*i),a,o,(p<<1)+(c?1:0),m,16*l,16*u,256*d,256*f)}function Nl(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function Pl(e){for(let t of e.sections)if(ni(t.text))return!0;return!1}class Fl{constructor(e){this.layoutVertexArray=new Ta,this.indexArray=new Aa,this.programConfigurations=e,this.segments=new Na,this.dynamicLayoutVertexArray=new Ea,this.opacityVertexArray=new Da,this.hasVisibleVertices=!1,this.placedSymbolArray=new la}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Oc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kc.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,jl,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ur(`SymbolBuffers`,Fl);class Il{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new Na,this.collisionVertexArray=new ka}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ac.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ur(`CollisionBuffers`,Il);class Ll{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Fo([]),this.placementViewportMatrix=Fo([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ol(this.zoom,n[`text-size`]),this.iconSizeData=Ol(this.zoom,n[`icon-size`]);let r=this.layers[0].layout,i=r.get(`symbol-sort-key`),a=r.get(`symbol-z-order`);this.canOverlap=kl(r,`text-overlap`,`text-allow-overlap`)!==`never`||kl(r,`icon-overlap`,`icon-allow-overlap`)!==`never`||r.get(`text-ignore-placement`)||r.get(`icon-ignore-placement`),this.sortFeaturesByKey=a!==`viewport-y`&&!i.isConstant(),this.sortFeaturesByY=(a===`viewport-y`||a===`auto`&&!this.sortFeaturesByKey)&&this.canOverlap,r.get(`symbol-placement`)===`point`&&(this.writingModes=r.get(`text-writing-mode`).map((t=>e.ai[t]))),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Fl(new ao(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Fl(new ao(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new fa,this.lineVertexArray=new pa,this.symbolInstances=new da,this.textAnchorOffsets=new ha}calculateGlyphDependencies(e,t,n,r,i){for(let a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,(n||r)&&i){let n=Pc[e.charAt(a)];n&&(t[n.charCodeAt(0)]=!0)}}populate(t,n,r){let i=this.layers[0],a=i.layout,o=a.get(`text-font`),s=a.get(`text-field`),c=a.get(`icon-image`),l=(s.value.kind!==`constant`||s.value.value instanceof ot&&!s.value.value.isEmpty()||s.value.value.toString().length>0)&&(o.value.kind!==`constant`||o.value.value.length>0),u=c.value.kind!==`constant`||!!c.value.value||Object.keys(c.parameters).length>0,d=a.get(`symbol-sort-key`);if(this.features=[],!l&&!u)return;let f=n.iconDependencies,p=n.glyphDependencies,m=n.availableImages,h=new hi(this.zoom);for(let{feature:n,id:s,index:c,sourceLayerIndex:g}of t){let t=i._featureFilter.needGeometry,_=po(n,t);if(!i._featureFilter.filter(h,_,r))continue;let v,y;if(t||(_.geometry=fo(n)),l){let e=i.getValueAndResolveTokens(`text-field`,_,r,m),t=ot.factory(e);Pl(t)&&(this.hasRTLText=!0),(!this.hasRTLText||fi()===`unavailable`||this.hasRTLText&&mi.isParsed())&&(v=Nc(t,i,_))}if(u){let e=i.getValueAndResolveTokens(`icon-image`,_,r,m);y=e instanceof ut?e:ut.fromString(e)}if(!v&&!y)continue;let b=this.sortFeaturesByKey?d.evaluate(_,{},r):void 0;if(this.features.push({id:s,text:v,icon:y,index:c,sourceLayerIndex:g,geometry:_.geometry,properties:n.properties,type:Al[n.type],sortKey:b}),y&&(f[y.name]=!0),v){let t=o.evaluate(_,{},r).join(`,`),n=a.get(`text-rotation-alignment`)!==`viewport`&&a.get(`symbol-placement`)!==`point`;this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(e.ai.vertical)>=0;for(let e of v.sections)if(e.image)f[e.image.name]=!0;else{let r=Yr(v.toString()),i=e.fontStack||t,a=p[i]=p[i]||{};this.calculateGlyphDependencies(e.text,a,n,this.allowVerticalPlacement,r)}}}a.get(`symbol-placement`)===`line`&&(this.features=function(e){let t={},n={},r=[],i=0;function a(t){r.push(e[t]),i++}function o(e,t,i){let a=n[e];return delete n[e],n[t]=a,r[a].geometry[0].pop(),r[a].geometry[0]=r[a].geometry[0].concat(i[0]),a}function s(e,n,i){let a=t[n];return delete t[n],t[e]=a,r[a].geometry[0].shift(),r[a].geometry[0]=i[0].concat(r[a].geometry[0]),a}function c(e,t,n){let r=n?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let l=0;l<e.length;l++){let u=e[l],d=u.geometry,f=u.text?u.text.toString():null;if(!f){a(l);continue}let p=c(f,d),m=c(f,d,!0);if(p in n&&m in t&&n[p]!==t[m]){let e=s(p,m,d),i=o(p,m,r[e].geometry);delete t[p],delete n[m],n[c(f,r[i].geometry,!0)]=i,r[e].geometry=null}else p in n?o(p,m,d):m in t?s(p,m,d):(a(l),t[p]=i-1,n[m]=i-1)}return r.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){let n=this.lineVertexArray.length;if(e.segment!==void 0){let n=e.dist(t[e.segment+1]),r=e.dist(t[e.segment]),i={};for(let r=e.segment+1;r<t.length;r++)i[r]={x:t[r].x,y:t[r].y,tileUnitDistanceFromAnchor:n},r<t.length-1&&(n+=t[r+1].dist(t[r]));for(let n=e.segment||0;n>=0;n--)i[n]={x:t[n].x,y:t[n].y,tileUnitDistanceFromAnchor:r},n>0&&(r+=t[n-1].dist(t[n]));for(let e=0;e<t.length;e++){let t=i[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,n,r,i,a,o,s,c,l,u,d,f){let p=t.indexArray,m=t.layoutVertexArray,h=t.segments.prepareSegment(4*n.length,m,p,this.canOverlap?o.sortKey:void 0),g=this.glyphOffsetArray.length,_=h.vertexLength,v=this.allowVerticalPlacement&&s===e.ai.vertical?Math.PI/2:0,y=o.text&&o.text.sections;for(let e=0;e<n.length;e++){let{tl:i,tr:a,bl:s,br:l,tex:u,pixelOffsetTL:d,pixelOffsetBR:g,minFontScaleX:_,minFontScaleY:b,glyphOffset:x,isSDF:S,sectionIndex:C}=n[e],w=h.vertexLength,E=x[1];Ml(m,c.x,c.y,i.x,E+i.y,u.x,u.y,r,S,d.x,d.y,_,b),Ml(m,c.x,c.y,a.x,E+a.y,u.x+u.w,u.y,r,S,g.x,d.y,_,b),Ml(m,c.x,c.y,s.x,E+s.y,u.x,u.y+u.h,r,S,d.x,g.y,_,b),Ml(m,c.x,c.y,l.x,E+l.y,u.x+u.w,u.y+u.h,r,S,g.x,g.y,_,b),Nl(t.dynamicLayoutVertexArray,c,v),p.emplaceBack(w,w+1,w+2),p.emplaceBack(w+1,w+2,w+3),h.vertexLength+=4,h.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),e!==n.length-1&&C===n[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(m.length,o,o.index,{},f,y&&y[C])}t.placedSymbolArray.emplaceBack(c.x,c.y,g,this.glyphOffsetArray.length-g,_,l,u,c.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],s,0,!1,0,d)}_addCollisionDebugVertex(e,t,n,r,i,a){return t.emplaceBack(0,0),e.emplaceBack(n.x,n.y,r,i,Math.round(a.x),Math.round(a.y))}addCollisionDebugVertices(e,t,n,r,i,o,s){let c=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=c.vertexLength,u=i.layoutVertexArray,d=i.collisionVertexArray,f=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(u,d,o,f,p,new a(e,t)),this._addCollisionDebugVertex(u,d,o,f,p,new a(n,t)),this._addCollisionDebugVertex(u,d,o,f,p,new a(n,r)),this._addCollisionDebugVertex(u,d,o,f,p,new a(e,r)),c.vertexLength+=4;let m=i.indexArray;m.emplaceBack(l,l+1),m.emplaceBack(l+1,l+2),m.emplaceBack(l+2,l+3),m.emplaceBack(l+3,l),c.primitiveLength+=4}addDebugCollisionBoxes(e,t,n,r){for(let i=e;i<t;i++){let e=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,r?this.textCollisionBox:this.iconCollisionBox,e.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Il(Oa,jc.members,ja),this.iconCollisionBox=new Il(Oa,jc.members,ja);for(let e=0;e<this.symbolInstances.length;e++){let t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(e,t,n,r,i,a,o,s,c){let l={};for(let r=t;r<n;r++){let t=e.get(r);l.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},l.textFeatureIndex=t.featureIndex;break}for(let t=r;t<i;t++){let n=e.get(t);l.verticalTextBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},l.verticalTextFeatureIndex=n.featureIndex;break}for(let t=a;t<o;t++){let n=e.get(t);l.iconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},l.iconFeatureIndex=n.featureIndex;break}for(let t=s;t<c;t++){let n=e.get(t);l.verticalIconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},l.verticalIconFeatureIndex=n.featureIndex;break}return l}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){let n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){let n=e.placedSymbolArray.get(t),r=n.vertexStartIndex+4*n.numGlyphs;for(let t=n.vertexStartIndex;t<r;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let t=Math.sin(e),n=Math.cos(e),r=[],i=[],a=[];for(let e=0;e<this.symbolInstances.length;++e){a.push(e);let o=this.symbolInstances.get(e);r.push(0|Math.round(t*o.anchorX+n*o.anchorY)),i.push(o.featureIndex)}return a.sort(((e,t)=>r[e]-r[t]||i[t]-i[e])),a}addToSortKeyRanges(e,t){let n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let e of this.symbolInstanceIndexes){let t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,n)=>{e>=0&&n.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Rl,zl;Ur(`SymbolBucket`,Ll,{omit:[`layers`,`collisionBoxArray`,`features`,`compareText`]}),Ll.MAX_GLYPHS=65535,Ll.addDynamicAttributes=Nl;var Bl={get paint(){return zl||=new ki({"icon-opacity":new Ti(H.paint_symbol[`icon-opacity`]),"icon-color":new Ti(H.paint_symbol[`icon-color`]),"icon-halo-color":new Ti(H.paint_symbol[`icon-halo-color`]),"icon-halo-width":new Ti(H.paint_symbol[`icon-halo-width`]),"icon-halo-blur":new Ti(H.paint_symbol[`icon-halo-blur`]),"icon-translate":new wi(H.paint_symbol[`icon-translate`]),"icon-translate-anchor":new wi(H.paint_symbol[`icon-translate-anchor`]),"text-opacity":new Ti(H.paint_symbol[`text-opacity`]),"text-color":new Ti(H.paint_symbol[`text-color`],{runtimeType:we,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Ti(H.paint_symbol[`text-halo-color`]),"text-halo-width":new Ti(H.paint_symbol[`text-halo-width`]),"text-halo-blur":new Ti(H.paint_symbol[`text-halo-blur`]),"text-translate":new wi(H.paint_symbol[`text-translate`]),"text-translate-anchor":new wi(H.paint_symbol[`text-translate-anchor`])})},get layout(){return Rl||=new ki({"symbol-placement":new wi(H.layout_symbol[`symbol-placement`]),"symbol-spacing":new wi(H.layout_symbol[`symbol-spacing`]),"symbol-avoid-edges":new wi(H.layout_symbol[`symbol-avoid-edges`]),"symbol-sort-key":new Ti(H.layout_symbol[`symbol-sort-key`]),"symbol-z-order":new wi(H.layout_symbol[`symbol-z-order`]),"icon-allow-overlap":new wi(H.layout_symbol[`icon-allow-overlap`]),"icon-overlap":new wi(H.layout_symbol[`icon-overlap`]),"icon-ignore-placement":new wi(H.layout_symbol[`icon-ignore-placement`]),"icon-optional":new wi(H.layout_symbol[`icon-optional`]),"icon-rotation-alignment":new wi(H.layout_symbol[`icon-rotation-alignment`]),"icon-size":new Ti(H.layout_symbol[`icon-size`]),"icon-text-fit":new wi(H.layout_symbol[`icon-text-fit`]),"icon-text-fit-padding":new wi(H.layout_symbol[`icon-text-fit-padding`]),"icon-image":new Ti(H.layout_symbol[`icon-image`]),"icon-rotate":new Ti(H.layout_symbol[`icon-rotate`]),"icon-padding":new Ti(H.layout_symbol[`icon-padding`]),"icon-keep-upright":new wi(H.layout_symbol[`icon-keep-upright`]),"icon-offset":new Ti(H.layout_symbol[`icon-offset`]),"icon-anchor":new Ti(H.layout_symbol[`icon-anchor`]),"icon-pitch-alignment":new wi(H.layout_symbol[`icon-pitch-alignment`]),"text-pitch-alignment":new wi(H.layout_symbol[`text-pitch-alignment`]),"text-rotation-alignment":new wi(H.layout_symbol[`text-rotation-alignment`]),"text-field":new Ti(H.layout_symbol[`text-field`]),"text-font":new Ti(H.layout_symbol[`text-font`]),"text-size":new Ti(H.layout_symbol[`text-size`]),"text-max-width":new Ti(H.layout_symbol[`text-max-width`]),"text-line-height":new wi(H.layout_symbol[`text-line-height`]),"text-letter-spacing":new Ti(H.layout_symbol[`text-letter-spacing`]),"text-justify":new Ti(H.layout_symbol[`text-justify`]),"text-radial-offset":new Ti(H.layout_symbol[`text-radial-offset`]),"text-variable-anchor":new wi(H.layout_symbol[`text-variable-anchor`]),"text-variable-anchor-offset":new Ti(H.layout_symbol[`text-variable-anchor-offset`]),"text-anchor":new Ti(H.layout_symbol[`text-anchor`]),"text-max-angle":new wi(H.layout_symbol[`text-max-angle`]),"text-writing-mode":new wi(H.layout_symbol[`text-writing-mode`]),"text-rotate":new Ti(H.layout_symbol[`text-rotate`]),"text-padding":new wi(H.layout_symbol[`text-padding`]),"text-keep-upright":new wi(H.layout_symbol[`text-keep-upright`]),"text-transform":new Ti(H.layout_symbol[`text-transform`]),"text-offset":new Ti(H.layout_symbol[`text-offset`]),"text-allow-overlap":new wi(H.layout_symbol[`text-allow-overlap`]),"text-overlap":new wi(H.layout_symbol[`text-overlap`]),"text-ignore-placement":new wi(H.layout_symbol[`text-ignore-placement`]),"text-optional":new wi(H.layout_symbol[`text-optional`])})}};class Vl{constructor(e){if(e.property.overrides===void 0)throw Error(`overrides must be provided to instantiate FormatSectionOverride class`);this.type=e.property.overrides?e.property.overrides.runtimeType:be,this.defaultValue=e}evaluate(e){if(e.formattedSection){let t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ur(`FormatSectionOverride`,Vl,{omit:[`defaultValue`]});class Hl extends ji{constructor(e){super(e,Bl)}recalculate(e,t){if(super.recalculate(e,t),this.layout.get(`icon-rotation-alignment`)===`auto`&&(this.layout._values[`icon-rotation-alignment`]=this.layout.get(`symbol-placement`)===`point`?`viewport`:`map`),this.layout.get(`text-rotation-alignment`)===`auto`&&(this.layout._values[`text-rotation-alignment`]=this.layout.get(`symbol-placement`)===`point`?`viewport`:`map`),this.layout.get(`text-pitch-alignment`)===`auto`&&(this.layout._values[`text-pitch-alignment`]=this.layout.get(`text-rotation-alignment`)===`map`?`map`:`viewport`),this.layout.get(`icon-pitch-alignment`)===`auto`&&(this.layout._values[`icon-pitch-alignment`]=this.layout.get(`icon-rotation-alignment`)),this.layout.get(`symbol-placement`)===`point`){let e=this.layout.get(`text-writing-mode`);if(e){let t=[];for(let n of e)t.indexOf(n)<0&&t.push(n);this.layout._values[`text-writing-mode`]=t}else this.layout._values[`text-writing-mode`]=[`horizontal`]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,r){let i=this.layout.get(e).evaluate(t,{},n,r),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||Un(a.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,((t,n)=>e&&n in e?String(e[n]):``))}(t.properties,i)}createBucket(e){return new Ll(e)}queryRadius(){return 0}queryIntersectsFeature(){throw Error(`Should take a different path in FeatureIndex`)}_setPaintOverrides(){for(let e of Bl.paint.overridableProperties){if(!Hl.hasPaintOverride(this.layout,e))continue;let t=this.paint.get(e),n=new Hn(new Vl(t),t.property.specification),r=null;r=t.value.kind===`constant`||t.value.kind===`source`?new Gn(`source`,n):new Kn(`composite`,n,t.value.zoomStops),this.paint._values[e]=new Si(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&Hl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){let n=e.get(`text-field`),r=Bl.paint.properties[t],i=!1,a=e=>{for(let t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(i=!0)};if(n.value.kind===`constant`&&n.value.value instanceof ot)a(n.value.value.sections);else if(n.value.kind===`source`){let e=t=>{i||(t instanceof ht&&pt(t.value)===Oe?a(t.value.sections):t instanceof bn?a(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return i}}let Ul;var Wl={get paint(){return Ul||=new ki({"background-color":new wi(H.paint_background[`background-color`]),"background-pattern":new Di(H.paint_background[`background-pattern`]),"background-opacity":new wi(H.paint_background[`background-opacity`])})}};class Gl extends ji{constructor(e){super(e,Wl)}}let Kl;var ql={get paint(){return Kl||=new ki({"raster-opacity":new wi(H.paint_raster[`raster-opacity`]),"raster-hue-rotate":new wi(H.paint_raster[`raster-hue-rotate`]),"raster-brightness-min":new wi(H.paint_raster[`raster-brightness-min`]),"raster-brightness-max":new wi(H.paint_raster[`raster-brightness-max`]),"raster-saturation":new wi(H.paint_raster[`raster-saturation`]),"raster-contrast":new wi(H.paint_raster[`raster-contrast`]),"raster-resampling":new wi(H.paint_raster[`raster-resampling`]),"raster-fade-duration":new wi(H.paint_raster[`raster-fade-duration`])})}};class Jl extends ji{constructor(e){super(e,ql)}}class Yl extends ji{constructor(e){super(e,{}),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode===`3d`}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw Error(`Custom layers cannot be serialized`)}}class Xl{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<`u`&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){delete this._channel,this._callback=()=>{}}}let Zl=6371008.8;class Ql{constructor(e,t){if(isNaN(e)||isNaN(t))throw Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw Error(`Invalid LngLat latitude value: must be between -90 and 90`)}wrap(){return new Ql(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return Zl*Math.acos(Math.min(i,1))}static convert(e){if(e instanceof Ql)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ql(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e==`object`&&e)return new Ql(Number(`lng`in e?e.lng:e.lon),Number(e.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let $l=2*Math.PI*Zl;function eu(e){return $l*Math.cos(e*Math.PI/180)}function tu(e){return(180+e)/360}function nu(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ru(e,t){return e/eu(t)}function iu(e){return 360*e-180}function au(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}class ou{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){let n=Ql.convert(e);return new ou(tu(n.lng),nu(n.lat),ru(t,n.lat))}toLngLat(){return new Ql(iu(this.x),au(this.y))}toAltitude(){return this.z*eu(au(this.y))}meterInMercatorCoordinateUnits(){return 1/$l*(e=au(this.y),1/Math.cos(e*Math.PI/180));var e}}function su(e,t,n){var r=2*Math.PI*6378137/256/2**n;return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}class cu{constructor(e,t,n){if(e<0||e>25||n<0||n>=2**e||t<0||t>=2**e)throw Error(`x=${t}, y=${n}, z=${e} outside of bounds. 0<=x<${2**e}, 0<=y<${2**e} 0<=z<=25 `);this.z=e,this.x=t,this.y=n,this.key=du(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,n){let r=(a=this.y,o=this.z,s=su(256*(i=this.x),256*(a=2**o-a-1),o),c=su(256*(i+1),256*(a+1),o),s[0]+`,`+s[1]+`,`+c[0]+`,`+c[1]);var i,a,o,s,c;let l=function(e,t,n){let r,i=``;for(let a=e;a>0;a--)r=1<<a-1,i+=(t&r?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n===`tms`?2**this.z-this.y-1:this.y)).replace(/{ratio}/g,t>1?`@2x`:``).replace(/{quadkey}/g,l).replace(/{bbox-epsg-3857}/g,r)}isChildOf(e){let t=this.z-e.z;return t>0&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){let t=2**this.z;return new a((e.x*t-this.x)*co,(e.y*t-this.y)*co)}toString(){return`${this.z}/${this.x}/${this.y}`}}class lu{constructor(e,t){this.wrap=e,this.canonical=t,this.key=du(e,t.z,t.z,t.x,t.y)}}class uu{constructor(e,t,n,r,i){if(e<n)throw Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${n}`);this.overscaledZ=e,this.wrap=t,this.canonical=new cu(n,+r,+i),this.key=du(t,e,n,r,i)}clone(){return new uu(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);let t=this.canonical.z-e;return e>this.canonical.z?new uu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new uu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t){if(e>this.overscaledZ)throw Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);let n=this.canonical.z-e;return e>this.canonical.z?du(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):du(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(e){if(e.wrap!==this.wrap)return!1;let t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new uu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let t=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new uu(t,this.wrap,t,n,r),new uu(t,this.wrap,t,n+1,r),new uu(t,this.wrap,t,n,r+1),new uu(t,this.wrap,t,n+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new uu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new uu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return 2**(this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new ou(e.x-this.wrap,e.y))}}function du(e,t,n,r,i){(e*=2)<0&&(e=-1*e-1);let a=1<<n;return(a*a*e+a*i+r).toString(36)+n.toString(36)+t.toString(36)}Ur(`CanonicalTileID`,cu),Ur(`OverscaledTileID`,uu,{omit:[`posMatrix`]});class fu{constructor(e,t,n,r=1,i=1,a=1,o=0){if(this.uid=e,t.height!==t.width)throw RangeError(`DEM tiles must be square`);if(n&&![`mapbox`,`terrarium`,`custom`].includes(n))return void C(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=t.height;let s=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),n){case`terrarium`:this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case`custom`:this.redFactor=r,this.greenFactor=i,this.blueFactor=a,this.baseShift=o;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let e=0;e<s;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(s,e)]=this.data[this._idx(s-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,s)]=this.data[this._idx(e,s-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(s,-1)]=this.data[this._idx(s-1,0)],this.data[this._idx(-1,s)]=this.data[this._idx(0,s-1)],this.data[this._idx(s,s)]=this.data[this._idx(s-1,s-1)],this.min=2**53-1,this.max=-(2**53-1);for(let e=0;e<s;e++)for(let t=0;t<s;t++){let n=this.get(e,t);n>this.max&&(this.max=n),n<this.min&&(this.min=n)}}get(e,t){let n=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return this.unpack(n[r],n[r+1],n[r+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw RangeError(`out of range source coordinates for DEM data`);return(t+1)*this.stride+(e+1)}unpack(e,t,n){return e*this.redFactor+t*this.greenFactor+n*this.blueFactor-this.baseShift}getPixels(){return new Yo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,n){if(this.dim!==e.dim)throw Error(`dem dimension mismatch`);let r=t*this.dim,i=t*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(t){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}let s=-t*this.dim,c=-n*this.dim;for(let t=a;t<o;t++)for(let n=r;n<i;n++)this.data[this._idx(n,t)]=e.data[this._idx(n+s,t+c)]}}Ur(`DEMData`,fu);class pu{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){let n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class mu{constructor(e,t,n,r,i){this.type=`Feature`,this._vectorTileFeature=e,e._z=t,e._x=n,e._y=r,this.properties=e.properties,this.id=i}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={geometry:this.geometry};for(let t in this)t!==`_geometry`&&t!==`_vectorTileFeature`&&(e[t]=this[t]);return e}}class hu{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Vr(co,16,0),this.grid3D=new Vr(co,16,0),this.featureIndexArray=new _a,this.promoteId=t}insert(e,t,n,r,i,a){let o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);let s=a?this.grid3D:this.grid;for(let e=0;e<t.length;e++){let n=t[e],r=[1/0,1/0,-1/0,-1/0];for(let e=0;e<n.length;e++){let t=n[e];r[0]=Math.min(r[0],t.x),r[1]=Math.min(r[1],t.y),r[2]=Math.max(r[2],t.x),r[3]=Math.max(r[3],t.y)}r[0]<co&&r[1]<co&&r[2]>=0&&r[3]>=0&&s.insert(o,r[0],r[1],r[2],r[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ks.VectorTile(new il(this.rawTileData)).layers,this.sourceLayerCoder=new pu(this.vtLayers?Object.keys(this.vtLayers).sort():[`_geojsonTileLayer`])),this.vtLayers}query(e,t,n,r){this.loadVTLayers();let i=e.params||{},o=co/e.tileSize/e.scale,s=Qn(i.filter),c=e.queryGeometry,l=e.queryPadding*o,u=_u(c),d=this.grid.query(u.minX-l,u.minY-l,u.maxX+l,u.maxY+l),f=_u(e.cameraQueryGeometry),p=this.grid3D.query(f.minX-l,f.minY-l,f.maxX+l,f.maxY+l,((t,n,r,i)=>function(e,t,n,r,i){for(let a of e)if(t<=a.x&&n<=a.y&&r>=a.x&&i>=a.y)return!0;let o=[new a(t,n),new a(t,i),new a(r,i),new a(r,n)];if(e.length>2){for(let t of o)if(To(e,t))return!0}for(let t=0;t<e.length-1;t++)if(Eo(e[t],e[t+1],o))return!0;return!1}(e.cameraQueryGeometry,t-l,n-l,r+l,i+l)));for(let e of p)d.push(e);d.sort(vu);let m={},h;for(let a=0;a<d.length;a++){let l=d[a];if(l===h)continue;h=l;let u=this.featureIndexArray.get(l),f=null;this.loadMatchingFeature(m,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,s,i.layers,i.availableImages,t,n,r,((t,n,r)=>(f||=fo(t),n.queryIntersectsFeature(c,t,r,f,this.z,e.transform,o,e.pixelPosMatrix))))}return m}loadMatchingFeature(e,t,n,r,i,a,o,s,c,l,u){let d=this.bucketLayerIDs[t];if(a&&!function(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(a,d))return;let f=this.sourceLayerCoder.decode(n),p=this.vtLayers[f].feature(r);if(i.needGeometry){let e=po(p,!0);if(!i.filter(new hi(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new hi(this.tileID.overscaledZ),p))return;let m=this.getId(p,f);for(let t=0;t<d.length;t++){let n=d[t];if(a&&a.indexOf(n)<0)continue;let i=s[n];if(!i)continue;let f={};m&&l&&(f=l.getState(i.sourceLayer||`_geojsonTileLayer`,m));let h=_({},c[n]);h.paint=gu(h.paint,i.paint,p,f,o),h.layout=gu(h.layout,i.layout,p,f,o);let g=!u||u(p,i,f);if(!g)continue;let v=new mu(p,this.z,this.x,this.y,m);v.layer=h;let y=e[n];y===void 0&&(y=e[n]=[]),y.push({featureIndex:r,feature:v,intersectionZ:g})}}lookupSymbolFeatures(e,t,n,r,i,a,o,s){let c={};this.loadVTLayers();let l=Qn(i);for(let i of e)this.loadMatchingFeature(c,n,r,i,l,a,o,s,t);return c}hasLayer(e){for(let t of this.bucketLayerIDs)for(let n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId==`string`?this.promoteId:this.promoteId[t]],typeof n==`boolean`&&(n=Number(n))),n}}function gu(e,t,n,r,i){return y(e,((e,a)=>{let o=t instanceof Ci?t.get(a):null;return o&&o.evaluate?o.evaluate(n,r,i):o}))}function _u(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let a of e)t=Math.min(t,a.x),n=Math.min(n,a.y),r=Math.max(r,a.x),i=Math.max(i,a.y);return{minX:t,minY:n,maxX:r,maxY:i}}function vu(e,t){return t-e}function yu(e,t,n,r,i){let o=[];for(let s=0;s<e.length;s++){let c=e[s],l;for(let e=0;e<c.length-1;e++){let s=c[e],u=c[e+1];s.x<t&&u.x<t||(s.x<t?s=new a(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<t&&(u=new a(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<n&&u.y<n||(s.y<n?s=new a(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round():u.y<n&&(u=new a(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round()),s.x>=r&&u.x>=r||(s.x>=r?s=new a(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=r&&(u=new a(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=i&&u.y>=i||(s.y>=i?s=new a(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round():u.y>=i&&(u=new a(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(u)))))}}return o}Ur(`FeatureIndex`,hu,{omit:[`rawTileData`,`sourceLayerCoder`]});class bu extends a{constructor(e,t,n,r){super(e,t),this.angle=n,r!==void 0&&(this.segment=r)}clone(){return new bu(this.x,this.y,this.angle,this.segment)}}function xu(e,t,n,r,i){if(t.segment===void 0||n===0)return!0;let a=t,o=t.segment+1,s=0;for(;s>-n/2;){if(o--,o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;let c=[],l=0;for(;s<n/2;){let t=e[o],n=e[o+1];if(!n)return!1;let a=e[o-1].angleTo(t)-t.angleTo(n);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),c.push({distance:s,angleDelta:a}),l+=a;s-c[0].distance>r;)l-=c.shift().angleDelta;if(l>i)return!1;o++,s+=t.dist(n)}return!0}function Su(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Cu(e,t,n){return e?.6*t*n:0}function wu(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Tu(e,t,n,r,i,a){let o=Cu(n,i,a),s=wu(n,r)*a,c=0,l=Su(e)/2;for(let n=0;n<e.length-1;n++){let r=e[n],i=e[n+1],a=r.dist(i);if(c+a>l){let u=(l-c)/a,d=new bu(Qt.number(r.x,i.x,u),Qt.number(r.y,i.y,u),i.angleTo(r),n);return d._round(),!o||xu(e,d,s,o,t)?d:void 0}c+=a}}function Eu(e,t,n,r,i,a,o,s,c){let l=Cu(r,a,o),u=wu(r,i),d=u*o,f=e[0].x===0||e[0].x===c||e[0].y===0||e[0].y===c;return t-d<t/4&&(t=d+t/4),Du(e,f?t/2*s%t:(u/2+2*a)*o*s%t,t,l,n,d,f,!1,c)}function Du(e,t,n,r,i,a,o,s,c){let l=a/2,u=Su(e),d=0,f=t-n,p=[];for(let t=0;t<e.length-1;t++){let o=e[t],s=e[t+1],m=o.dist(s),h=s.angleTo(o);for(;f+n<d+m;){f+=n;let g=(f-d)/m,_=Qt.number(o.x,s.x,g),v=Qt.number(o.y,s.y,g);if(_>=0&&_<c&&v>=0&&v<c&&f-l>=0&&f+l<=u){let n=new bu(_,v,h,t);n._round(),r&&!xu(e,n,a,r,i)||p.push(n)}}d+=m}return s||p.length||o||(p=Du(e,d/2,n,r,i,a,o,!0,c)),p}Ur(`Anchor`,bu);function Ou(e,t,n,r){let i=[],o=e.image,s=o.pixelRatio,c=o.paddedRect.w-2,l=o.paddedRect.h-2,u=e.right-e.left,d=e.bottom-e.top,f=o.stretchX||[[0,c]],p=o.stretchY||[[0,l]],m=(e,t)=>e+t[1]-t[0],h=f.reduce(m,0),g=p.reduce(m,0),_=c-h,v=l-g,y=0,b=h,x=0,S=g,C=0,w=_,E=0,D=v;if(o.content&&r){let e=o.content;y=ku(f,0,e[0]),x=ku(p,0,e[1]),b=ku(f,e[0],e[2]),S=ku(p,e[1],e[3]),C=e[0]-y,E=e[1]-x,w=e[2]-e[0]-b,D=e[3]-e[1]-S}let O=(r,i,c,l)=>{let f=ju(r.stretch-y,b,u,e.left),p=Mu(r.fixed-C,w,r.stretch,h),m=ju(i.stretch-x,S,d,e.top),_=Mu(i.fixed-E,D,i.stretch,g),v=ju(c.stretch-y,b,u,e.left),O=Mu(c.fixed-C,w,c.stretch,h),k=ju(l.stretch-x,S,d,e.top),A=Mu(l.fixed-E,D,l.stretch,g),j=new a(f,m),M=new a(v,m),N=new a(v,k),P=new a(f,k),F=new a(p/s,_/s),I=new a(O/s,A/s),ee=t*Math.PI/180;if(ee){let e=Math.sin(ee),t=Math.cos(ee),n=[t,-e,e,t];j._matMult(n),M._matMult(n),P._matMult(n),N._matMult(n)}let R=r.stretch+r.fixed,z=i.stretch+i.fixed;return{tl:j,tr:M,bl:P,br:N,tex:{x:o.paddedRect.x+1+R,y:o.paddedRect.y+1+z,w:c.stretch+c.fixed-R,h:l.stretch+l.fixed-z},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:F,pixelOffsetBR:I,minFontScaleX:w/s/u,minFontScaleY:D/s/d,isSDF:n}};if(r&&(o.stretchX||o.stretchY)){let e=Au(f,_,h),t=Au(p,v,g);for(let n=0;n<e.length-1;n++){let r=e[n],a=e[n+1];for(let e=0;e<t.length-1;e++)i.push(O(r,t[e],a,t[e+1]))}}else i.push(O({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:c+1},{fixed:0,stretch:l+1}));return i}function ku(e,t,n){let r=0;for(let i of e)r+=Math.max(t,Math.min(n,i[1]))-Math.max(t,Math.min(n,i[0]));return r}function Au(e,t,n){let r=[{fixed:-1,stretch:0}];for(let[t,n]of e){let e=r[r.length-1];r.push({fixed:t-e.stretch,stretch:e.stretch}),r.push({fixed:t-e.stretch,stretch:e.stretch+(n-t)})}return r.push({fixed:t+1,stretch:n}),r}function ju(e,t,n,r){return e/t*n+r}function Mu(e,t,n,r){return e-t*n/r}class Nu{constructor(e,t,n,r,i,o,s,c,l,u){if(this.boxStartIndex=e.length,l){let e=o.top,t=o.bottom,n=o.collisionPadding;n&&(e-=n[1],t+=n[3]);let r=t-e;r>0&&(r=Math.max(10,r),this.circleDiameter=r)}else{let l=o.top*s-c[0],d=o.bottom*s+c[2],f=o.left*s-c[3],p=o.right*s+c[1],m=o.collisionPadding;if(m&&(f-=m[0]*s,l-=m[1]*s,p+=m[2]*s,d+=m[3]*s),u){let e=new a(f,l),t=new a(p,l),n=new a(f,d),r=new a(p,d),i=u*Math.PI/180;e._rotate(i),t._rotate(i),n._rotate(i),r._rotate(i),f=Math.min(e.x,t.x,n.x,r.x),p=Math.max(e.x,t.x,n.x,r.x),l=Math.min(e.y,t.y,n.y,r.y),d=Math.max(e.y,t.y,n.y,r.y)}e.emplaceBack(t.x,t.y,f,l,p,d,n,r,i)}this.boxEndIndex=e.length}}class Pu{constructor(e=[],t=Fu){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:n}=this,r=t[e];for(;e>0;){let i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r}_down(e){let{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;e<r;){let r=1+(e<<1),a=t[r],o=r+1;if(o<this.length&&n(t[o],a)<0&&(r=o,a=t[o]),n(a,i)>=0)break;t[e]=a,e=r}t[e]=i}}function Fu(e,t){return e<t?-1:e>t?1:0}function Iu(e,t=1,n=!1){let r=1/0,i=1/0,o=-1/0,s=-1/0,c=e[0];for(let e=0;e<c.length;e++){let t=c[e];(!e||t.x<r)&&(r=t.x),(!e||t.y<i)&&(i=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>s)&&(s=t.y)}let l=Math.min(o-r,s-i),u=l/2,d=new Pu([],Lu);if(l===0)return new a(r,i);for(let t=r;t<o;t+=l)for(let n=i;n<s;n+=l)d.push(new Ru(t+u,n+u,u,e));let f=function(e){let t=0,n=0,r=0,i=e[0];for(let e=0,a=i.length,o=a-1;e<a;o=e++){let a=i[e],s=i[o],c=a.x*s.y-s.x*a.y;n+=(a.x+s.x)*c,r+=(a.y+s.y)*c,t+=3*c}return new Ru(n/t,r/t,0,e)}(e),p=d.length;for(;d.length;){let r=d.pop();(r.d>f.d||!f.d)&&(f=r,n&&console.log(`found best %d after %d probes`,Math.round(1e4*r.d)/1e4,p)),r.max-f.d<=t||(u=r.h/2,d.push(new Ru(r.p.x-u,r.p.y-u,u,e)),d.push(new Ru(r.p.x+u,r.p.y-u,u,e)),d.push(new Ru(r.p.x-u,r.p.y+u,u,e)),d.push(new Ru(r.p.x+u,r.p.y+u,u,e)),p+=4)}return n&&(console.log(`num probes: ${p}`),console.log(`best distance: ${f.d}`)),f.p}function Lu(e,t){return t.max-e.max}function Ru(e,t,n,r){this.p=new a(e,t),this.h=n,this.d=function(e,t){let n=!1,r=1/0;for(let i=0;i<t.length;i++){let a=t[i];for(let t=0,i=a.length,o=i-1;t<i;o=t++){let i=a[t],s=a[o];i.y>e.y!=s.y>e.y&&e.x<(s.x-i.x)*(e.y-i.y)/(s.y-i.y)+i.x&&(n=!n),r=Math.min(r,Co(e,i,s))}}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}var zu;e.aq=void 0,(zu=e.aq||={})[zu.center=1]=`center`,zu[zu.left=2]=`left`,zu[zu.right=3]=`right`,zu[zu.top=4]=`top`,zu[zu.bottom=5]=`bottom`,zu[zu[`top-left`]=6]=`top-left`,zu[zu[`top-right`]=7]=`top-right`,zu[zu[`bottom-left`]=8]=`bottom-left`,zu[zu[`bottom-right`]=9]=`bottom-right`;let Bu=1/0;function Vu(e,t){return t[1]===Bu?function(e,t){let n=0,r=0;t<0&&(t=0);let i=t/Math.SQRT2;switch(e){case`top-right`:case`top-left`:r=i-7;break;case`bottom-right`:case`bottom-left`:r=-i+7;break;case`bottom`:r=-t+7;break;case`top`:r=t-7}switch(e){case`top-right`:case`bottom-right`:n=-i;break;case`top-left`:case`bottom-left`:n=i;break;case`left`:n=t;break;case`right`:n=-t}return[n,r]}(e,t[0]):function(e,t,n){let r=0,i=0;switch(t=Math.abs(t),n=Math.abs(n),e){case`top-right`:case`top-left`:case`top`:i=n-7;break;case`bottom-right`:case`bottom-left`:case`bottom`:i=-n+7}switch(e){case`top-right`:case`bottom-right`:case`right`:r=-t;break;case`top-left`:case`bottom-left`:case`left`:r=t}return[r,i]}(e,t[0],t[1])}function Hu(e,t,n){let r=e.layout,i=r.get(`text-variable-anchor-offset`)?.evaluate(t,{},n);if(i){let e=i.values,t=[];for(let n=0;n<e.length;n+=2){let r=t[n]=e[n],i=e[n+1].map((e=>e*Fc));r.startsWith(`top`)?i[1]-=7:r.startsWith(`bottom`)&&(i[1]+=7),t[n+1]=i}return new lt(t)}let a=r.get(`text-variable-anchor`);if(a){let i;i=e._unevaluatedLayout.getValue(`text-radial-offset`)===void 0?r.get(`text-offset`).evaluate(t,{},n).map((e=>e*Fc)):[r.get(`text-radial-offset`).evaluate(t,{},n)*Fc,Bu];let o=[];for(let e of a)o.push(e,Vu(e,i));return new lt(o)}return null}function Uu(e){switch(e){case`right`:case`top-right`:case`bottom-right`:return`right`;case`left`:case`top-left`:case`bottom-left`:return`left`}return`center`}function Wu(t,n,r,i,a,o,s,c,l,u,d){let f=o.textMaxSize.evaluate(n,{});f===void 0&&(f=s);let p=t.layers[0].layout,m=p.get(`icon-offset`).evaluate(n,{},d),h=Ku(r.horizontal),g=s/24,_=t.tilePixelRatio*g,v=t.tilePixelRatio*f/24,y=t.tilePixelRatio*c,b=t.tilePixelRatio*p.get(`symbol-spacing`),x=p.get(`text-padding`)*t.tilePixelRatio,S=function(e,t,n,r=1){let i=e.get(`icon-padding`).evaluate(t,{},n),a=i&&i.values;return[a[0]*r,a[1]*r,a[2]*r,a[3]*r]}(p,n,d,t.tilePixelRatio),w=p.get(`text-max-angle`)/180*Math.PI,E=p.get(`text-rotation-alignment`)!==`viewport`&&p.get(`symbol-placement`)!==`point`,D=p.get(`icon-rotation-alignment`)===`map`&&p.get(`symbol-placement`)!==`point`,O=p.get(`symbol-placement`),k=b/2,A=p.get(`icon-text-fit`),j;i&&A!==`none`&&(t.allowVerticalPlacement&&r.vertical&&(j=El(i,r.vertical,A,p.get(`icon-text-fit-padding`),m,g)),h&&(i=El(i,h,A,p.get(`icon-text-fit-padding`),m,g)));let M=(c,f)=>{f.x<0||f.x>=co||f.y<0||f.y>=co||function(t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,w,E,D){let O=t.addToLineVertexArray(n,r),k,A,j,M,N=0,P=0,F=0,I=0,ee=-1,R=-1,z={},B=Ha(``);if(t.allowVerticalPlacement&&i.vertical){let e=c.layout.get(`text-rotate`).evaluate(x,{},E)+90;j=new Nu(l,n,u,d,f,i.vertical,p,m,h,e),s&&(M=new Nu(l,n,u,d,f,s,_,v,h,e))}if(a){let r=c.layout.get(`icon-rotate`).evaluate(x,{}),i=c.layout.get(`icon-text-fit`)!==`none`,o=Ou(a,r,w,i),p=s?Ou(s,r,w,i):void 0;A=new Nu(l,n,u,d,f,a,_,v,!1,r),N=4*o.length;let m=t.iconSizeData,h=null;m.kind===`source`?(h=[128*c.layout.get(`icon-size`).evaluate(x,{})],h[0]>Dl&&C(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):m.kind===`composite`&&(h=[128*S.compositeIconSizes[0].evaluate(x,{},E),128*S.compositeIconSizes[1].evaluate(x,{},E)],(h[0]>Dl||h[1]>Dl)&&C(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,o,h,b,y,x,e.ai.none,n,O.lineStartIndex,O.lineLength,-1,E),ee=t.icon.placedSymbolArray.length-1,p&&(P=4*p.length,t.addSymbols(t.icon,p,h,b,y,x,e.ai.vertical,n,O.lineStartIndex,O.lineLength,-1,E),R=t.icon.placedSymbolArray.length-1)}let te=Object.keys(i.horizontal);for(let r of te){let a=i.horizontal[r];k||=(B=Ha(a.text),new Nu(l,n,u,d,f,a,p,m,h,c.layout.get(`text-rotate`).evaluate(x,{},E)));let s=a.positionedLines.length===1;if(F+=Gu(t,n,a,o,c,h,x,g,O,i.vertical?e.ai.horizontal:e.ai.horizontalOnly,s?te:[r],z,ee,S,E),s)break}i.vertical&&(I+=Gu(t,n,i.vertical,o,c,h,x,g,O,e.ai.vertical,[`vertical`],z,R,S,E));let ne=k?k.boxStartIndex:t.collisionBoxArray.length,re=k?k.boxEndIndex:t.collisionBoxArray.length,V=j?j.boxStartIndex:t.collisionBoxArray.length,ie=j?j.boxEndIndex:t.collisionBoxArray.length,ae=A?A.boxStartIndex:t.collisionBoxArray.length,oe=A?A.boxEndIndex:t.collisionBoxArray.length,se=M?M.boxStartIndex:t.collisionBoxArray.length,ce=M?M.boxEndIndex:t.collisionBoxArray.length,H=-1,le=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t;H=le(k,H),H=le(j,H),H=le(A,H),H=le(M,H);let ue=H>-1?1:0;ue&&(H*=D/Fc),t.glyphOffsetArray.length>=Ll.MAX_GLYPHS&&C(`Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907`),x.sortKey!==void 0&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey);let de=Hu(c,x,E),[U,fe]=function(t,n){let r=t.length,i=n?.values;if(i?.length>0)for(let n=0;n<i.length;n+=2){let r=i[n+1];t.emplaceBack(e.aq[i[n]],r[0],r[1])}return[r,t.length]}(t.textAnchorOffsets,de);t.symbolInstances.emplaceBack(n.x,n.y,z.right>=0?z.right:-1,z.center>=0?z.center:-1,z.left>=0?z.left:-1,z.vertical||-1,ee,R,B,ne,re,V,ie,ae,oe,se,ce,u,F,I,N,P,ue,0,p,H,U,fe)}(t,f,c,r,i,a,j,t.layers[0],t.collisionBoxArray,n.index,n.sourceLayerIndex,t.index,_,[x,x,x,x],E,l,y,S,D,m,n,o,u,d,s)};if(O===`line`)for(let e of yu(n.geometry,0,0,co,co)){let n=Eu(e,b,w,r.vertical||h,i,24,v,t.overscaling,co);for(let r of n)h&&qu(t,h.text,k,r)||M(e,r)}else if(O===`line-center`){for(let e of n.geometry)if(e.length>1){let t=Tu(e,w,r.vertical||h,i,24,v);t&&M(e,t)}}else if(n.type===`Polygon`)for(let e of Ps(n.geometry,0)){let t=Iu(e,16);M(e[0],new bu(t.x,t.y,0))}else if(n.type===`LineString`)for(let e of n.geometry)M(e,new bu(e[0].x,e[0].y,0));else if(n.type===`Point`)for(let e of n.geometry)for(let t of e)M([t],new bu(t.x,t.y,0))}function Gu(e,t,n,r,i,o,s,c,l,u,d,f,p,m,h){let g=function(e,t,n,r,i,o,s,c){let l=r.layout.get(`text-rotate`).evaluate(o,{})*Math.PI/180,u=[];for(let e of t.positionedLines)for(let r of e.positionedGlyphs){if(!r.rect)continue;let o=r.rect||{},d=4,f=!0,p=1,m=0,h=(i||c)&&r.vertical,g=r.metrics.advance*r.scale/2;if(c&&t.verticalizable&&(m=e.lineOffset/2-(r.imageName?-(Fc-r.metrics.width*r.scale)/2:(r.scale-1)*Fc)),r.imageName){let e=s[r.imageName];f=e.sdf,p=e.pixelRatio,d=1/p}let _=i?[r.x+g,r.y]:[0,0],v=i?[0,0]:[r.x+g+n[0],r.y+n[1]-m],y=[0,0];h&&(y=v,v=[0,0]);let b=r.metrics.isDoubleResolution?2:1,x=(r.metrics.left-d)*r.scale-g+v[0],S=(-r.metrics.top-d)*r.scale+v[1],C=x+o.w/b*r.scale/p,w=S+o.h/b*r.scale/p,E=new a(x,S),D=new a(C,S),O=new a(x,w),k=new a(C,w);if(h){let e=new a(-g,g- -17),t=-Math.PI/2,n=Fc/2-g,i=new a(22-n,-(r.imageName?n:0)),o=new a(...y);E._rotateAround(t,e)._add(i)._add(o),D._rotateAround(t,e)._add(i)._add(o),O._rotateAround(t,e)._add(i)._add(o),k._rotateAround(t,e)._add(i)._add(o)}if(l){let e=Math.sin(l),t=Math.cos(l),n=[t,-e,e,t];E._matMult(n),D._matMult(n),O._matMult(n),k._matMult(n)}let A=new a(0,0),j=new a(0,0);u.push({tl:E,tr:D,bl:O,br:k,tex:o,writingMode:t.writingMode,glyphOffset:_,sectionIndex:r.sectionIndex,isSDF:f,pixelOffsetTL:A,pixelOffsetBR:j,minFontScaleX:0,minFontScaleY:0})}return u}(0,n,c,i,o,s,r,e.allowVerticalPlacement),_=e.textSizeData,v=null;_.kind===`source`?(v=[128*i.layout.get(`text-size`).evaluate(s,{})],v[0]>Dl&&C(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):_.kind===`composite`&&(v=[128*m.compositeTextSizes[0].evaluate(s,{},h),128*m.compositeTextSizes[1].evaluate(s,{},h)],(v[0]>Dl||v[1]>Dl)&&C(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,g,v,c,o,s,u,t,l.lineStartIndex,l.lineLength,p,h);for(let t of d)f[t]=e.text.placedSymbolArray.length-1;return 4*g.length}function Ku(e){for(let t in e)return e[t];return null}function qu(e,t,n,r){let i=e.compareText;if(t in i){let e=i[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<n)return!0}else i[t]=[];return i[t].push(r),!1}let Ju=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yu{static from(e){if(!(e instanceof ArrayBuffer))throw Error(`Data must be an instance of ArrayBuffer.`);let[t,n]=new Uint8Array(e,0,2);if(t!==219)throw Error(`Data does not appear to be in a KDBush format.`);let r=n>>4;if(r!==1)throw Error(`Got v${r} data when expected v1.`);let i=Ju[15&n];if(!i)throw Error(`Unrecognized array type.`);let[a]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new Yu(o,a,i,e)}constructor(e,t=64,n=Float64Array,r){if(isNaN(e)||e<0)throw Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let i=Ju.indexOf(this.ArrayType),a=2*e*this.ArrayType.BYTES_PER_ELEMENT,o=e*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-o%8)%8;if(i<0)throw Error(`Unexpected typed array class: ${n}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+s,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+a+o+s),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+s,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){let n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){let e=this._pos>>1;if(e!==this.numItems)throw Error(`Added ${e} items when expected ${this.numItems}.`);return Xu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,r){if(!this._finished)throw Error(`Data not yet indexed - call index.finish().`);let{ids:i,coords:a,nodeSize:o}=this,s=[0,i.length-1,0],c=[];for(;s.length;){let l=s.pop()||0,u=s.pop()||0,d=s.pop()||0;if(u-d<=o){for(let o=d;o<=u;o++){let s=a[2*o],l=a[2*o+1];s>=e&&s<=n&&l>=t&&l<=r&&c.push(i[o])}continue}let f=d+u>>1,p=a[2*f],m=a[2*f+1];p>=e&&p<=n&&m>=t&&m<=r&&c.push(i[f]),(l===0?e<=p:t<=m)&&(s.push(d),s.push(f-1),s.push(1-l)),(l===0?n>=p:r>=m)&&(s.push(f+1),s.push(u),s.push(1-l))}return c}within(e,t,n){if(!this._finished)throw Error(`Data not yet indexed - call index.finish().`);let{ids:r,coords:i,nodeSize:a}=this,o=[0,r.length-1,0],s=[],c=n*n;for(;o.length;){let l=o.pop()||0,u=o.pop()||0,d=o.pop()||0;if(u-d<=a){for(let n=d;n<=u;n++)ed(i[2*n],i[2*n+1],e,t)<=c&&s.push(r[n]);continue}let f=d+u>>1,p=i[2*f],m=i[2*f+1];ed(p,m,e,t)<=c&&s.push(r[f]),(l===0?e-n<=p:t-n<=m)&&(o.push(d),o.push(f-1),o.push(1-l)),(l===0?e+n>=p:t+n>=m)&&(o.push(f+1),o.push(u),o.push(1-l))}return s}}function Xu(e,t,n,r,i,a){if(i-r<=n)return;let o=r+i>>1;Zu(e,t,o,r,i,a),Xu(e,t,n,r,o-1,1-a),Xu(e,t,n,o+1,i,1-a)}function Zu(e,t,n,r,i,a){for(;i>r;){if(i-r>600){let o=i-r+1,s=n-r+1,c=Math.log(o),l=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*l*(o-l)/o)*(s-o/2<0?-1:1);Zu(e,t,n,Math.max(r,Math.floor(n-s*l/o+u)),Math.min(i,Math.floor(n+(o-s)*l/o+u)),a)}let o=t[2*n+a],s=r,c=i;for(Qu(e,t,r,n),t[2*i+a]>o&&Qu(e,t,r,i);s<c;){for(Qu(e,t,s,c),s++,c--;t[2*s+a]<o;)s++;for(;t[2*c+a]>o;)c--}t[2*r+a]===o?Qu(e,t,r,c):(c++,Qu(e,t,c,i)),c<=n&&(r=c+1),n<=c&&(i=c-1)}}function Qu(e,t,n,r){$u(e,n,r),$u(t,2*n,2*r),$u(t,2*n+1,2*r+1)}function $u(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function ed(e,t,n,r){let i=e-n,a=t-r;return i*i+a*a}var td;e.bh=void 0,(td=e.bh||={}).create=`create`,td.load=`load`,td.fullLoad=`fullLoad`;let nd=null,rd=[],id=1e3/60,ad=`loadTime`,od=`fullLoadTime`;e.$=function(e,t,n){var r,i,a,o,s,c,l,u,d,f,p,m,h=n[0],g=n[1],_=n[2];return t===e?(e[12]=t[0]*h+t[4]*g+t[8]*_+t[12],e[13]=t[1]*h+t[5]*g+t[9]*_+t[13],e[14]=t[2]*h+t[6]*g+t[10]*_+t[14],e[15]=t[3]*h+t[7]*g+t[11]*_+t[15]):(i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=t[9],p=t[10],m=t[11],e[0]=r=t[0],e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=c,e[6]=l,e[7]=u,e[8]=d,e[9]=f,e[10]=p,e[11]=m,e[12]=r*h+s*g+d*_+t[12],e[13]=i*h+c*g+f*_+t[13],e[14]=a*h+l*g+p*_+t[14],e[15]=o*h+u*g+m*_+t[15]),e},e.A=Po,e.B=Qt,e.C=class{constructor(e,t,n){this.receive=e=>{let t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type===`<cancel>`){delete this.tasks[n];let e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e()}else D()||t.mustQueue?(this.tasks[n]=t,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,t)},this.process=()=>{if(!this.taskQueue.length)return;let e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)},this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Xl(this.process),this.target.addEventListener(`message`,this.receive,!1),this.globalScope=D()?e:window}send(e,t,n,r,i=!1){let a=Math.round(0xde0b6b3a7640000*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[a]=n);let o=[],s={id:a,type:e,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Gr(t,o)};return this.target.postMessage(s,{transfer:o}),{cancel:()=>{n&&delete this.callbacks[a],this.target.postMessage({id:a,type:`<cancel>`,targetMapId:r,sourceMapId:this.mapId})}}}processTask(e,t){if(t.type===`<response>`){let n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(Kr(t.error)):n(null,Kr(t.data)))}else{let n=!1,r=[],i=t.hasCallback?(t,i)=>{n=!0,delete this.cancelCallbacks[e];let a={id:e,type:`<response>`,sourceMapId:this.mapId,error:t?Gr(t):null,data:Gr(i,r)};this.target.postMessage(a,{transfer:r})}:e=>{n=!0},a=null,o=Kr(t.data);if(this.parent[t.type])a=this.parent[t.type](t.sourceMapId,o,i);else if(`getWorkerSource`in this.parent){let e=t.type.split(`.`);a=this.parent.getWorkerSource(t.sourceMapId,e[0],o.source)[e[1]](o,i)}else i(Error(`Could not find function ${t.type}`));!n&&a&&a.cancel&&(this.cancelCallbacks[e]=a.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener(`message`,this.receive,!1)}},e.D=wi,e.E=ce,e.F=function(e,t){let n={};for(let r=0;r<t.length;r++){let i=t[r];i in e&&(n[i]=e[i])}return n},e.G=tu,e.H=nu,e.I=ll,e.J=d,e.K=f,e.L=Ql,e.M=j,e.N=co,e.O=uu,e.P=a,e.Q=Fi,e.R=Yo,e.S=Na,e.T=vi,e.U=ou,e.V=class extends zi{},e.W=cu,e.X=function(e,t){let n=window.document.createElement(`video`);n.muted=!0,n.onloadstart=function(){t(null,n)};for(let t=0;t<e.length;t++){let r=window.document.createElement(`source`);V(e[t])||(n.crossOrigin=`Anonymous`),r.src=e[t],n.appendChild(r)}return{cancel:()=>{}}},e.Y=G,e.Z=function(){var e=new Po(16);return Po!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e._=t,e.a=k,e.a$=class extends ia{},e.a0=function(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.a1=Io,e.a2=function(){return v++},e.a3=sa,e.a4=Ll,e.a5=function(){mi.isLoading()||mi.isLoaded()||fi()!==`deferred`||pi()},e.a6=Qn,e.a7=po,e.a8=hi,e.a9=mu,e.aA=li,e.aB=function(e){e=e.slice();let t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)`ref`in e[n]&&(e[n]=ue(e[n],t[e[n].ref]));return e},e.aC=function(e){if(e.type===`custom`)return new Yl(e);switch(e.type){case`background`:return new Gl(e);case`circle`:return new Bo(e);case`fill`:return new Hs(e);case`fill-extrusion`:return new fc(e);case`heatmap`:return new Zo(e);case`hillshade`:return new es(e);case`line`:return new Ec(e);case`raster`:return new Jl(e);case`symbol`:return new Hl(e)}},e.aD=x,e.aE=function(e,t){if(!e)return[{command:U.setStyle,args:[t]}];let n=[];try{if(!de(e.version,t.version))return[{command:U.setStyle,args:[t]}];de(e.center,t.center)||n.push({command:U.setCenter,args:[t.center]}),de(e.zoom,t.zoom)||n.push({command:U.setZoom,args:[t.zoom]}),de(e.bearing,t.bearing)||n.push({command:U.setBearing,args:[t.bearing]}),de(e.pitch,t.pitch)||n.push({command:U.setPitch,args:[t.pitch]}),de(e.sprite,t.sprite)||n.push({command:U.setSprite,args:[t.sprite]}),de(e.glyphs,t.glyphs)||n.push({command:U.setGlyphs,args:[t.glyphs]}),de(e.transition,t.transition)||n.push({command:U.setTransition,args:[t.transition]}),de(e.light,t.light)||n.push({command:U.setLight,args:[t.light]});let r={},i=[];(function(e,t,n,r){let i;for(i in t||={},e||={})Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)||pe(i,n,r));for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?de(e[i],t[i])||(e[i].type===`geojson`&&t[i].type===`geojson`&&W(e,t,i)?n.push({command:U.setGeoJSONSourceData,args:[i,t[i].data]}):me(i,t,n,r)):fe(i,t,n))})(e.sources,t.sources,i,r);let a=[];e.layers&&e.layers.forEach((e=>{r[e.source]?n.push({command:U.removeLayer,args:[e.id]}):a.push(e)})),n=n.concat(i),function(e,t,n){t||=[];let r=(e||=[]).map(ge),i=t.map(ge),a=e.reduce(_e,{}),o=t.reduce(_e,{}),s=r.slice(),c=Object.create(null),l,u,d,f,p,m,h;for(l=0,u=0;l<r.length;l++)d=r[l],Object.prototype.hasOwnProperty.call(o,d)?u++:(n.push({command:U.removeLayer,args:[d]}),s.splice(s.indexOf(d,u),1));for(l=0,u=0;l<i.length;l++)d=i[i.length-1-l],s[s.length-1-l]!==d&&(Object.prototype.hasOwnProperty.call(a,d)?(n.push({command:U.removeLayer,args:[d]}),s.splice(s.lastIndexOf(d,s.length-u),1)):u++,m=s[s.length-l],n.push({command:U.addLayer,args:[o[d],m]}),s.splice(s.length-l,0,d),c[d]=!0);for(l=0;l<i.length;l++)if(d=i[l],f=a[d],p=o[d],!c[d]&&!de(f,p))if(de(f.source,p.source)&&de(f[`source-layer`],p[`source-layer`])&&de(f.type,p.type)){for(h in he(f.layout,p.layout,n,d,null,U.setLayoutProperty),he(f.paint,p.paint,n,d,null,U.setPaintProperty),de(f.filter,p.filter)||n.push({command:U.setFilter,args:[d,p.filter]}),de(f.minzoom,p.minzoom)&&de(f.maxzoom,p.maxzoom)||n.push({command:U.setLayerZoomRange,args:[d,p.minzoom,p.maxzoom]}),f)Object.prototype.hasOwnProperty.call(f,h)&&h!==`layout`&&h!==`paint`&&h!==`filter`&&h!==`metadata`&&h!==`minzoom`&&h!==`maxzoom`&&(h.indexOf(`paint.`)===0?he(f[h],p[h],n,d,h.slice(6),U.setPaintProperty):de(f[h],p[h])||n.push({command:U.setLayerProperty,args:[d,h,p[h]]}));for(h in p)Object.prototype.hasOwnProperty.call(p,h)&&!Object.prototype.hasOwnProperty.call(f,h)&&h!==`layout`&&h!==`paint`&&h!==`filter`&&h!==`metadata`&&h!==`minzoom`&&h!==`maxzoom`&&(h.indexOf(`paint.`)===0?he(f[h],p[h],n,d,h.slice(6),U.setPaintProperty):de(f[h],p[h])||n.push({command:U.setLayerProperty,args:[d,h,p[h]]}))}else n.push({command:U.removeLayer,args:[d]}),m=s[s.lastIndexOf(d)+1],n.push({command:U.addLayer,args:[p,m]})}(a,t.layers,n)}catch(e){console.warn(`Unable to compute style diff:`,e),n=[{command:U.setStyle,args:[t]}]}return n},e.aF=function(e){let t=[],n=e.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),e.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&e.renderingMode!==`2d`&&e.renderingMode!==`3d`&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},e.aG=function e(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}if(typeof t==`object`&&t&&n!==null){if(typeof n!=`object`||Object.keys(t).length!==Object.keys(n).length)return!1;for(let r in t)if(!e(t[r],n[r]))return!1;return!0}return t===n},e.aH=y,e.aI=b,e.aJ=di,e.aK=function(e){return e({pluginStatus:si,pluginURL:ci}),di.on(`pluginStateChange`,e),e},e.aL=class extends qa{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.aM=Ja,e.aN=class extends qa{constructor(e,t){super(e,t),this.current=Za}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.aO=Ya,e.aP=class extends qa{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.aQ=class extends qa{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.aR=Xa,e.aS=function(e,t,n,r,i,a,o){var s=1/(t-n),c=1/(r-i),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*c,e[14]=(o+a)*l,e[15]=1,e},e.aT=rt,e.aU=Ro,e.aV=class extends Yi{},e.aW=Mc,e.aX=class extends Zi{},e.aY=function(e){return e<=1?1:2**Math.ceil(Math.log(e)/Math.LN2)},e.aZ=Xo,e.a_=va,e.aa=function(e){let t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,n,r,i)=>{let a=r||i;return t[n]=!a||a.toLowerCase(),``})),t[`max-age`]){let e=parseInt(t[`max-age`],10);isNaN(e)?delete t[`max-age`]:t[`max-age`]=e}return t},e.ab=function(e,t){let n=[];for(let r in e)r in t||n.push(r);return n},e.ac=function(e){if(O==null){let t=e.navigator?e.navigator.userAgent:null;O=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match(`Safari`)&&!t.match(`Chrome`)))}return O},e.ad=h,e.ae=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],l=t[4],u=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+l*r,e[1]=o*i+u*r,e[2]=s*i+d*r,e[3]=c*i+f*r,e[4]=l*i-a*r,e[5]=u*i-o*r,e[6]=d*i-s*r,e[7]=f*i-c*r,e},e.af=function(e){var t=new Po(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.ag=zo,e.ah=function(e,t){let n=0,r=0;if(e.kind===`constant`)r=e.layoutSize;else if(e.kind!==`source`){let{interpolationType:i,minZoom:a,maxZoom:o}=e,s=i?h($t.interpolationFactor(i,t,a,o),0,1):0;e.kind===`camera`?r=Qt.number(e.minSize,e.maxSize,s):n=s}return{uSizeT:n,uSize:r}},e.aj=function(e,{uSize:t,uSizeT:n},{lowerSize:r,upperSize:i}){return e.kind===`source`?r/128:e.kind===`composite`?Qt.number(r/128,i/128,n):t},e.ak=Nl,e.al=function(e,t,n,r){let i=t.y-e.y,o=t.x-e.x,s=r.y-n.y,c=r.x-n.x,l=s*o-c*i;if(l===0)return null;let u=(c*(e.y-n.y)-s*(e.x-n.x))/l;return new a(e.x+u*o,e.y+u*i)},e.am=yu,e.an=go,e.ao=Fo,e.ap=Fc,e.ar=kl,e.as=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],h=t[13],g=t[14],_=t[15],v=n*s-r*o,y=n*c-i*o,b=n*l-a*o,x=r*c-i*s,S=r*l-a*s,C=i*l-a*c,w=u*h-d*m,E=u*g-f*m,D=u*_-p*m,O=d*g-f*h,k=d*_-p*h,A=f*_-p*g,j=v*A-y*k+b*O+x*D-S*E+C*w;return j?(e[0]=(s*A-c*k+l*O)*(j=1/j),e[1]=(i*k-r*A-a*O)*j,e[2]=(h*C-g*S+_*x)*j,e[3]=(f*S-d*C-p*x)*j,e[4]=(c*D-o*A-l*E)*j,e[5]=(n*A-i*D+a*E)*j,e[6]=(g*b-m*C-_*y)*j,e[7]=(u*C-f*b+p*y)*j,e[8]=(o*k-s*D+l*w)*j,e[9]=(r*D-n*k-a*w)*j,e[10]=(m*S-h*b+_*v)*j,e[11]=(d*b-u*S-p*v)*j,e[12]=(s*E-o*O-c*w)*j,e[13]=(n*O-r*E+i*w)*j,e[14]=(h*y-m*x-g*v)*j,e[15]=(u*x-d*y+f*v)*j,e):null},e.at=Uu,e.au=Cl,e.av=Yu,e.aw=function(){let e={},t=H.$version;for(let n in H.$root){let r=H.$root[n];if(r.required){let i=null;i=n===`version`?t:r.type===`array`?[]:{},i!=null&&(e[n]=i)}}return e},e.ax=U,e.ay=qr,e.az=z,e.b=function(e,t){let n=new Blob([new Uint8Array(e)],{type:`image/png`});createImageBitmap(n).then((e=>{t(null,e)})).catch((e=>{t(Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))},e.b0=Aa,e.b1=function(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],d=e[9],f=e[10],p=e[11],m=e[12],h=e[13],g=e[14],_=e[15],v=t[0],y=t[1],b=t[2],x=t[3],S=t[4],C=t[5],w=t[6],E=t[7],D=t[8],O=t[9],k=t[10],A=t[11],j=t[12],M=t[13],N=t[14],P=t[15];return Math.abs(n-v)<=No*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-y)<=No*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-b)<=No*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-x)<=No*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-S)<=No*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-C)<=No*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(c-w)<=No*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-E)<=No*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(u-D)<=No*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(d-O)<=No*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(f-k)<=No*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(p-A)<=No*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(m-j)<=No*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(h-M)<=No*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(g-N)<=No*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(_-P)<=No*Math.max(1,Math.abs(_),Math.abs(P))},e.b2=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.b3=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},e.b4=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.b5=g,e.b6=lu,e.b7=ru,e.b8=function(e,t,n,r,i){var a,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(e[10]=(i+r)*(a=1/(r-i)),e[14]=2*i*r*a):(e[10]=-1,e[14]=-2*r),e},e.b9=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*r,e[5]=o*i+u*r,e[6]=s*i+d*r,e[7]=c*i+f*r,e[8]=l*i-a*r,e[9]=u*i-o*r,e[10]=d*i-s*r,e[11]=f*i-c*r,e},e.bA=r,e.bB=Ic,e.bC=Wn,e.bD=mi,e.ba=p,e.bb=m,e.bc=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.bd=class extends Ri{},e.be=Zl,e.bf=iu,e.bg={mark(e){performance.mark(e)},frame(e){let t=e;nd!=null&&rd.push(t-nd),nd=t},clearMetrics(){nd=null,rd=[],performance.clearMeasures(ad),performance.clearMeasures(od);for(let t in e.bh)performance.clearMarks(e.bh[t])},getPerformanceMetrics(){performance.measure(ad,e.bh.create,e.bh.load),performance.measure(od,e.bh.create,e.bh.fullLoad);let t=performance.getEntriesByName(ad)[0].duration,n=performance.getEntriesByName(od)[0].duration,r=rd.length,i=1/(rd.reduce(((e,t)=>e+t),0)/r/1e3),a=rd.filter((e=>e>id)).reduce(((e,t)=>e+(t-id)/id),0);return{loadTime:t,fullLoadTime:n,fps:i,percentDroppedFrames:a/(r+a)*100,totalFrames:r}}},e.bi=R,e.bj=function(e,t,n=!1){if(si===ri||si===ii||si===ai)throw Error(`setRTLTextPlugin cannot be called multiple times.`);ci=I.resolveURL(e),si=ri,oi=t,ui(),n||pi()},e.bk=fi,e.bl=function(e,t){let n={};for(let r=0;r<e.length;r++){let i=t&&t[e[r].id]||sr(e[r]);t&&(t[e[r].id]=i);let a=n[i];a||=n[i]=[],a.push(e[r])}let r=[];for(let e in n)r.push(n[e]);return r},e.bm=Ur,e.bn=pu,e.bo=hu,e.bp=ul,e.bq=function(t){t.bucket.createArrays(),t.bucket.tilePixelRatio=co/(512*t.bucket.overscaling),t.bucket.compareText={},t.bucket.iconsNeedLinear=!1;let n=t.bucket.layers[0],r=n.layout,i=n._unevaluatedLayout._values,a={layoutIconSize:i[`icon-size`].possiblyEvaluate(new hi(t.bucket.zoom+1),t.canonical),layoutTextSize:i[`text-size`].possiblyEvaluate(new hi(t.bucket.zoom+1),t.canonical),textMaxSize:i[`text-size`].possiblyEvaluate(new hi(18))};if(t.bucket.textSizeData.kind===`composite`){let{minZoom:e,maxZoom:n}=t.bucket.textSizeData;a.compositeTextSizes=[i[`text-size`].possiblyEvaluate(new hi(e),t.canonical),i[`text-size`].possiblyEvaluate(new hi(n),t.canonical)]}if(t.bucket.iconSizeData.kind===`composite`){let{minZoom:e,maxZoom:n}=t.bucket.iconSizeData;a.compositeIconSizes=[i[`icon-size`].possiblyEvaluate(new hi(e),t.canonical),i[`icon-size`].possiblyEvaluate(new hi(n),t.canonical)]}let o=r.get(`text-line-height`)*Fc,s=r.get(`text-rotation-alignment`)!==`viewport`&&r.get(`symbol-placement`)!==`point`,c=r.get(`text-keep-upright`),l=r.get(`text-size`);for(let i of t.bucket.features){let u=r.get(`text-font`).evaluate(i,{},t.canonical).join(`,`),d=l.evaluate(i,{},t.canonical),f=a.layoutTextSize.evaluate(i,{},t.canonical),p=a.layoutIconSize.evaluate(i,{},t.canonical),m={horizontal:{},vertical:void 0},h=i.text,g,_=[0,0];if(h){let a=h.toString(),l=r.get(`text-letter-spacing`).evaluate(i,{},t.canonical)*Fc,p=Xr(a)?l:0,g=r.get(`text-anchor`).evaluate(i,{},t.canonical),v=Hu(n,i,t.canonical);if(!v){let e=r.get(`text-radial-offset`).evaluate(i,{},t.canonical);_=e?Vu(g,[e*Fc,Bu]):r.get(`text-offset`).evaluate(i,{},t.canonical).map((e=>e*Fc))}let y=s?`center`:r.get(`text-justify`).evaluate(i,{},t.canonical),b=r.get(`symbol-placement`),x=b===`point`?r.get(`text-max-width`).evaluate(i,{},t.canonical)*Fc:0,S=()=>{t.bucket.allowVerticalPlacement&&Yr(a)&&(m.vertical=ml(h,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,o,g,`left`,p,_,e.ai.vertical,!0,b,f,d))};if(!s&&v){let n=new Set;if(y===`auto`)for(let e=0;e<v.values.length;e+=2)n.add(Uu(v.values[e]));else n.add(y);let r=!1;for(let i of n)if(!m.horizontal[i])if(r)m.horizontal[i]=m.horizontal[0];else{let n=ml(h,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,o,`center`,i,p,_,e.ai.horizontal,!1,b,f,d);n&&(m.horizontal[i]=n,r=n.positionedLines.length===1)}S()}else{y===`auto`&&(y=Uu(g));let n=ml(h,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,o,g,y,p,_,e.ai.horizontal,!1,b,f,d);n&&(m.horizontal[y]=n),S(),Yr(a)&&s&&c&&(m.vertical=ml(h,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,o,g,y,p,_,e.ai.vertical,!1,b,f,d))}}let v=!1;if(i.icon&&i.icon.name){let e=t.imageMap[i.icon.name];e&&(g=Tl(t.imagePositions[i.icon.name],r.get(`icon-offset`).evaluate(i,{},t.canonical),r.get(`icon-anchor`).evaluate(i,{},t.canonical)),v=!!e.sdf,t.bucket.sdfIcons===void 0?t.bucket.sdfIcons=v:t.bucket.sdfIcons!==v&&C(`Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer`),(e.pixelRatio!==t.bucket.pixelRatio||r.get(`icon-rotate`).constantOr(1)!==0)&&(t.bucket.iconsNeedLinear=!0))}let y=Ku(m.horizontal)||m.vertical;t.bucket.iconsInText=!!y&&y.iconsInText,(y||g)&&Wu(t.bucket,i,m,g,t.imageMap,a,f,p,_,v,t.canonical)}t.showCollisionBoxes&&t.bucket.generateCollisionDebugBuffers()},e.br=bc,e.bs=Rs,e.bt=sc,e.bu=class{constructor(e){this._marks={start:[e.url,`start`].join(`#`),end:[e.url,`end`].join(`#`),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return e.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}},e.bv=il,e.bw=Ks,e.bx=function(e,n,r,i,a){return t(this,void 0,void 0,(function*(){if(f())try{return yield j(e,n,r,i,a)}catch{}return function(e,t,n,r,i){let a=e.width,o=e.height;M&&N||(M=new OffscreenCanvas(a,o),N=M.getContext(`2d`,{willReadFrequently:!0})),M.width=a,M.height=o,N.drawImage(e,0,0,a,o);let s=N.getImageData(t,n,r,i);return N.clearRect(0,0,a,o),s.data}(e,n,r,i,a)}))},e.by=fu,e.bz=n,e.c=ee,e.d=function(e,t){let n=new Image;n.onload=()=>{t(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((()=>{n.src=A}))},n.onerror=()=>t(Error(`Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`));let r=new Blob([new Uint8Array(e)],{type:`image/png`});n.src=e.byteLength?URL.createObjectURL(r):A},e.e=_,e.f=function(e,t){return ne(_(e,{type:`json`}),t)},e.g=B,e.h=I,e.i=D,e.j=se,e.k=oe,e.l=re,e.m=ne,e.n=function(e){return new il(e).readFields(al,[])},e.o=function(e,t,n){if(!e.length)return n(null,[]);let r=e.length,i=Array(e.length),a=null;e.forEach(((e,o)=>{t(e,((e,t)=>{e&&(a=e),i[o]=t,--r==0&&n(a,i)}))}))},e.p=cl,e.q=Jo,e.r=ki,e.s=V,e.t=Lr,e.u=Jr,e.v=H,e.w=C,e.x=Br,e.y=Ir,e.z=function([e,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(t)*Math.sin(n),y:e*Math.sin(t)*Math.sin(n),z:e*Math.cos(n)}}})),r([`./shared`],(function(e){class t{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,n){for(let n of t){this._layerConfigs[n.id]=n;let t=this._layers[n.id]=e.aC(n);t._featureFilter=e.a6(t.filter),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(let e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};let r=e.bl(Object.values(this._layerConfigs),this.keyCache);for(let e of r){let t=e.map((e=>this._layers[e.id])),n=t[0];if(n.visibility===`none`)continue;let r=n.source||``,i=this.familiesBySource[r];i||=this.familiesBySource[r]={};let a=n.sourceLayer||`_geojsonTileLayer`,o=i[a];o||=i[a]=[],o.push(t)}}}class n{constructor(t){let n={},r=[];for(let e in t){let i=t[e],a=n[e]={};for(let e in i){let t=i[+e];if(!t||t.bitmap.width===0||t.bitmap.height===0)continue;let n={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};r.push(n),a[e]={rect:n,metrics:t.metrics}}}let{w:i,h:a}=e.p(r),o=new e.q({width:i||1,height:a||1});for(let r in t){let i=t[r];for(let t in i){let a=i[+t];if(!a||a.bitmap.width===0||a.bitmap.height===0)continue;let s=n[r][t].rect;e.q.copy(a.bitmap,o,{x:0,y:0},{x:s.x+1,y:s.y+1},a.bitmap)}}this.image=o,this.positions=n}}e.bm(`GlyphAtlas`,n);class r{constructor(t){this.tileID=new e.O(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(t,r,a,o,s){this.status=`parsing`,this.data=t,this.collisionBoxArray=new e.a3;let c=new e.bn(Object.keys(t.layers).sort()),l=new e.bo(this.tileID,this.promoteId);l.bucketLayerIDs=[];let u={},d={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:a},f=r.familiesBySource[this.source];for(let n in f){let r=t.layers[n];if(!r)continue;r.version===1&&e.w(`Vector tile source "${this.source}" layer "${n}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let o=c.encode(n),s=[];for(let e=0;e<r.length;e++){let t=r.feature(e),i=l.getId(t,n);s.push({feature:t,id:i,index:e,sourceLayerIndex:o})}for(let t of f[n]){let n=t[0];n.source!==this.source&&e.w(`layer.source = ${n.source} does not equal this.source = ${this.source}`),n.minzoom&&this.zoom<Math.floor(n.minzoom)||n.maxzoom&&this.zoom>=n.maxzoom||n.visibility!==`none`&&(i(t,this.zoom,a),(u[n.id]=n.createBucket({index:l.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:o,sourceID:this.source})).populate(s,d,this.tileID.canonical),l.bucketLayerIDs.push(t.map((e=>e.id))))}}let p,m,h,g,_=e.aH(d.glyphDependencies,(e=>Object.keys(e).map(Number)));this.inFlightDependencies.forEach((e=>e?.cancel())),this.inFlightDependencies=[];let v=++this.dependencySentinel;Object.keys(_).length?this.inFlightDependencies.push(o.send(`getGlyphs`,{uid:this.uid,stacks:_,source:this.source,tileID:this.tileID,type:`glyphs`},((e,t)=>{v===this.dependencySentinel&&(p||(p=e,m=t,x.call(this)))}))):m={};let y=Object.keys(d.iconDependencies);y.length?this.inFlightDependencies.push(o.send(`getImages`,{icons:y,source:this.source,tileID:this.tileID,type:`icons`},((e,t)=>{v===this.dependencySentinel&&(p||(p=e,h=t,x.call(this)))}))):h={};let b=Object.keys(d.patternDependencies);function x(){if(p)return s(p);if(m&&h&&g){let t=new n(m),r=new e.bp(h,g);for(let n in u){let o=u[n];o instanceof e.a4?(i(o.layers,this.zoom,a),e.bq({bucket:o,glyphMap:m,glyphPositions:t.positions,imageMap:h,imagePositions:r.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):o.hasPattern&&(o instanceof e.br||o instanceof e.bs||o instanceof e.bt)&&(i(o.layers,this.zoom,a),o.addFeatures(d,this.tileID.canonical,r.patternPositions))}this.status=`done`,s(null,{buckets:Object.values(u).filter((e=>!e.isEmpty())),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,imageAtlas:r,glyphMap:this.returnDependencies?m:null,iconMap:this.returnDependencies?h:null,glyphPositions:this.returnDependencies?t.positions:null})}}b.length?this.inFlightDependencies.push(o.send(`getImages`,{icons:b,source:this.source,tileID:this.tileID,type:`patterns`},((e,t)=>{v===this.dependencySentinel&&(p||(p=e,g=t,x.call(this)))}))):g={},x.call(this)}}function i(t,n,r){let i=new e.a8(n);for(let e of t)e.recalculate(i,r)}function a(t,n){let r=e.l(t.request,((r,i,a,o)=>{if(r)n(r);else if(i)try{n(null,{vectorTile:new e.bw.VectorTile(new e.bv(i)),rawData:i,cacheControl:a,expires:o})}catch(e){let r=new Uint8Array(i),a=`Unable to parse the tile at ${t.request.url}, `;a+=r[0]===31&&r[1]===139?`please make sure the data is not gzipped and that you have configured the relevant header in the server`:`got error: ${e.messge}`,n(Error(a))}}));return()=>{r.cancel(),n()}}class o{constructor(e,t,n,r){this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=r||a,this.fetching={},this.loading={},this.loaded={}}loadTile(t,n){let i=t.uid;this.loading||={};let a=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.bu(t.request),o=this.loading[i]=new r(t);o.abort=this.loadVectorData(t,((t,r)=>{if(delete this.loading[i],t||!r)return o.status=`done`,this.loaded[i]=o,n(t);let s=r.rawData,c={};r.expires&&(c.expires=r.expires),r.cacheControl&&(c.cacheControl=r.cacheControl);let l={};if(a){let e=a.finish();e&&(l.resourceTiming=JSON.parse(JSON.stringify(e)))}o.vectorTile=r.vectorTile,o.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,((t,r)=>{if(delete this.fetching[i],t||!r)return n(t);n(null,e.e({rawTileData:s.slice(0)},r,c,l))})),this.loaded=this.loaded||{},this.loaded[i]=o,this.fetching[i]={rawTileData:s,cacheControl:c,resourceTiming:l}}))}reloadTile(t,n){let r=this.loaded,i=t.uid;if(r&&r[i]){let a=r[i];a.showCollisionBoxes=t.showCollisionBoxes,a.status===`parsing`?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,((t,r)=>{if(t||!r)return n(t,r);let a;if(this.fetching[i]){let{rawTileData:t,cacheControl:n,resourceTiming:o}=this.fetching[i];delete this.fetching[i],a=e.e({rawTileData:t.slice(0)},r,n,o)}else a=r;n(null,a)})):a.status===`done`&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,n):n())}}abortTile(e,t){let n=this.loading,r=e.uid;n&&n[r]&&n[r].abort&&(n[r].abort(),delete n[r]),t()}removeTile(e,t){let n=this.loaded,r=e.uid;n&&n[r]&&delete n[r],t()}}class s{constructor(){this.loaded={}}loadTile(t,n){return e._(this,void 0,void 0,(function*(){let{uid:r,encoding:i,rawImageData:a,redFactor:o,greenFactor:s,blueFactor:c,baseShift:l}=t,u=a.width+2,d=a.height+2,f=e.a(a)?new e.R({width:u,height:d},yield e.bx(a,-1,-1,u,d)):a,p=new e.by(r,f,i,o,s,c,l);this.loaded=this.loaded||{},this.loaded[r]=p,n(null,p)}))}removeTile(e){let t=this.loaded,n=e.uid;t&&t[n]&&delete t[n]}}function c(e,t){if(e.length!==0){l(e[0],t);for(var n=1;n<e.length;n++)l(e[n],!t)}}function l(e,t){for(var n=0,r=0,i=0,a=e.length,o=a-1;i<a;o=i++){var s=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]),c=n+s;r+=Math.abs(n)>=Math.abs(s)?n-c+s:s-c+n,n=c}n+r>=0!=!!t&&e.reverse()}var u=e.bz((function e(t,n){var r,i=t&&t.type;if(i===`FeatureCollection`)for(r=0;r<t.features.length;r++)e(t.features[r],n);else if(i===`GeometryCollection`)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],n);else if(i===`Feature`)e(t.geometry,n);else if(i===`Polygon`)c(t.coordinates,n);else if(i===`MultiPolygon`)for(r=0;r<t.coordinates.length;r++)c(t.coordinates[r],n);return t}));let d=e.bw.VectorTileFeature.prototype.toGeoJSON;var f={exports:{}},p=e.bA,m=e.bw.VectorTileFeature,h=g;function g(e,t){this.options=t||{},this.features=e,this.length=e.length}function _(e,t){this.id=typeof e.id==`number`?e.id:void 0,this.type=e.type,this.rawGeometry=e.type===1?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}g.prototype.feature=function(e){return new _(this.features[e],this.options.extent)},_.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var n=e[t],r=[],i=0;i<n.length;i++)r.push(new p(n[i][0],n[i][1]));this.geometry.push(r)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,r=1/0,i=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var c=o[s];t=Math.min(t,c.x),n=Math.max(n,c.x),r=Math.min(r,c.y),i=Math.max(i,c.y)}return[t,r,n,i]},_.prototype.toGeoJSON=m.prototype.toGeoJSON;var v=e.bB,y=h;function b(e){var t=new v;return function(e,t){for(var n in e.layers)t.writeMessage(3,x,e.layers[n])}(e,t),t.finish()}function x(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||``),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)r.feature=e.feature(n),t.writeMessage(2,S,r);var i=r.keys;for(n=0;n<i.length;n++)t.writeStringField(3,i[n]);var a=r.values;for(n=0;n<a.length;n++)t.writeMessage(4,O,a[n])}function S(e,t){var n=e.feature;n.id!==void 0&&t.writeVarintField(1,n.id),t.writeMessage(2,C,e),t.writeVarintField(3,n.type),t.writeMessage(4,D,n)}function C(e,t){var n=e.feature,r=e.keys,i=e.values,a=e.keycache,o=e.valuecache;for(var s in n.properties){var c=n.properties[s],l=a[s];if(c!==null){l===void 0&&(r.push(s),a[s]=l=r.length-1),t.writeVarint(l);var u=typeof c;u!==`string`&&u!==`boolean`&&u!==`number`&&(c=JSON.stringify(c));var d=u+`:`+c,f=o[d];f===void 0&&(i.push(c),o[d]=f=i.length-1),t.writeVarint(f)}}}function w(e,t){return(t<<3)+(7&e)}function E(e){return e<<1^e>>31}function D(e,t){for(var n=e.loadGeometry(),r=e.type,i=0,a=0,o=n.length,s=0;s<o;s++){var c=n[s],l=1;r===1&&(l=c.length),t.writeVarint(w(1,l));for(var u=r===3?c.length-1:c.length,d=0;d<u;d++){d===1&&r!==1&&t.writeVarint(w(2,u-1));var f=c[d].x-i,p=c[d].y-a;t.writeVarint(E(f)),t.writeVarint(E(p)),i+=f,a+=p}r===3&&t.writeVarint(w(7,1))}}function O(e,t){var n=typeof e;n===`string`?t.writeStringField(1,e):n===`boolean`?t.writeBooleanField(7,e):n===`number`&&(e%1==0?e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e):t.writeDoubleField(3,e))}f.exports=b,f.exports.fromVectorTileJs=b,f.exports.fromGeojsonVt=function(e,t){t||={};var n={};for(var r in e)n[r]=new y(e[r].features,t),n[r].name=r,n[r].version=t.version,n[r].extent=t.extent;return b({layers:n})},f.exports.GeoJSONWrapper=y;var k=e.bz(f.exports);let A={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},j=Math.fround||(M=new Float32Array(1),e=>(M[0]=+e,M[0]));var M;class N{constructor(e){this.options=Object.assign(Object.create(A),e),this.trees=Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){let{log:t,minZoom:n,maxZoom:r}=this.options;t&&console.time(`total time`);let i=`prepare ${e.length} points`;t&&console.time(i),this.points=e;let a=[];for(let t=0;t<e.length;t++){let n=e[t];if(!n.geometry)continue;let[r,i]=n.geometry.coordinates,o=j(I(r)),s=j(ee(i));a.push(o,s,1/0,t,-1,1),this.options.reduce&&a.push(0)}let o=this.trees[r+1]=this._createTree(a);t&&console.timeEnd(i);for(let e=r;e>=n;e--){let n=+Date.now();o=this.trees[e]=this._createTree(this._cluster(o,e)),t&&console.log(`z%d: %d clusters in %dms`,e,o.numItems,+Date.now()-n)}return t&&console.timeEnd(`total time`),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=e[2]===180?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){let e=this.getClusters([n,r,180,a],t),o=this.getClusters([-180,r,i,a],t);return e.concat(o)}let o=this.trees[this._limitZoom(t)],s=o.range(I(n),ee(a),I(i),ee(r)),c=o.data,l=[];for(let e of s){let t=this.stride*e;l.push(c[t+5]>1?P(c,t,this.clusterProps):this.points[c[t+3]])}return l}getChildren(e){let t=this._getOriginId(e),n=this._getOriginZoom(e),r=`No cluster with the specified id.`,i=this.trees[n];if(!i)throw Error(r);let a=i.data;if(t*this.stride>=a.length)throw Error(r);let o=this.options.radius/(this.options.extent*2**(n-1)),s=i.within(a[t*this.stride],a[t*this.stride+1],o),c=[];for(let t of s){let n=t*this.stride;a[n+4]===e&&c.push(a[n+5]>1?P(a,n,this.clusterProps):this.points[a[n+3]])}if(c.length===0)throw Error(r);return c}getLeaves(e,t,n){let r=[];return this._appendLeaves(r,e,t||=10,n||=0,0),r}getTile(e,t,n){let r=this.trees[this._limitZoom(e)],i=2**e,{extent:a,radius:o}=this.options,s=o/a,c=(n-s)/i,l=(n+1+s)/i,u={features:[]};return this._addTileFeatures(r.range((t-s)/i,c,(t+1+s)/i,l),r.data,t,n,i,u),t===0&&this._addTileFeatures(r.range(1-s/i,c,1,l),r.data,i,n,i,u),t===i-1&&this._addTileFeatures(r.range(0,c,s/i,l),r.data,-1,n,i,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){let n=this.getChildren(e);if(t++,n.length!==1)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,r,i){let a=this.getChildren(t);for(let t of a){let a=t.properties;if(a&&a.cluster?i+a.point_count<=r?i+=a.point_count:i=this._appendLeaves(e,a.cluster_id,n,r,i):i<r?i++:e.push(t),e.length===n)break}return i}_createTree(t){let n=new e.av(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,r,i,a){for(let o of e){let e=o*this.stride,s=t[e+5]>1,c,l,u;if(s)c=F(t,e,this.clusterProps),l=t[e],u=t[e+1];else{let n=this.points[t[e+3]];c=n.properties;let[r,i]=n.geometry.coordinates;l=I(r),u=ee(i)}let d={type:1,geometry:[[Math.round(this.options.extent*(l*i-n)),Math.round(this.options.extent*(u*i-r))]],tags:c},f;f=s||this.options.generateId?t[e+3]:this.points[t[e+3]].id,f!==void 0&&(d.id=f),a.features.push(d)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){let{radius:n,extent:r,reduce:i,minPoints:a}=this.options,o=n/(r*2**t),s=e.data,c=[],l=this.stride;for(let n=0;n<s.length;n+=l){if(s[n+2]<=t)continue;s[n+2]=t;let r=s[n],u=s[n+1],d=e.within(s[n],s[n+1],o),f=s[n+5],p=f;for(let e of d){let n=e*l;s[n+2]>t&&(p+=s[n+5])}if(p>f&&p>=a){let e,a=r*f,o=u*f,m=-1,h=((n/l|0)<<5)+(t+1)+this.points.length;for(let r of d){let c=r*l;if(s[c+2]<=t)continue;s[c+2]=t;let u=s[c+5];a+=s[c]*u,o+=s[c+1]*u,s[c+4]=h,i&&(e||(e=this._map(s,n,!0),m=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(s,c)))}s[n+4]=h,c.push(a/p,o/p,1/0,h,-1,p),i&&c.push(m)}else{for(let e=0;e<l;e++)c.push(s[n+e]);if(p>1)for(let e of d){let n=e*l;if(!(s[n+2]<=t)){s[n+2]=t;for(let e=0;e<l;e++)c.push(s[n+e])}}}}return c}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+5]>1){let r=this.clusterProps[e[t+6]];return n?Object.assign({},r):r}let r=this.points[e[t+3]].properties,i=this.options.map(r);return n&&i===r?Object.assign({},i):i}}function P(e,t,n){return{type:`Feature`,id:e[t+3],properties:F(e,t,n),geometry:{type:`Point`,coordinates:[(r=e[t],360*(r-.5)),R(e[t+1])]}};var r}function F(e,t,n){let r=e[t+5],i=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+`k`:r,a=e[t+6],o=a===-1?{}:Object.assign({},n[a]);return Object.assign(o,{cluster:!0,cluster_id:e[t+3],point_count:r,point_count_abbreviated:i})}function I(e){return e/360+.5}function ee(e){let t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function R(e){let t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function z(e,t,n,r){for(var i,a=r,o=n-t>>1,s=n-t,c=e[t],l=e[t+1],u=e[n],d=e[n+1],f=t+3;f<n;f+=3){var p=B(e[f],e[f+1],c,l,u,d);if(p>a)i=f,a=p;else if(p===a){var m=Math.abs(f-o);m<s&&(i=f,s=m)}}a>r&&(i-t>3&&z(e,t,i,r),e[i+2]=a,n-i>3&&z(e,i,n,r))}function B(e,t,n,r,i,a){var o=i-n,s=a-r;if(o!==0||s!==0){var c=((e-n)*o+(t-r)*s)/(o*o+s*s);c>1?(n=i,r=a):c>0&&(n+=o*c,r+=s*c)}return(o=e-n)*o+(s=t-r)*s}function te(e,t,n,r){var i={id:e===void 0?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if(n===`Point`||n===`MultiPoint`||n===`LineString`)ne(e,t);else if(n===`Polygon`||n===`MultiLineString`)for(var r=0;r<t.length;r++)ne(e,t[r]);else if(n===`MultiPolygon`)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)ne(e,t[r][i])}(i),i}function ne(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function re(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,a=t.geometry.type,o=(n.tolerance/((1<<n.maxZoom)*n.extent))**2,s=[],c=t.id;if(n.promoteId?c=t.properties[n.promoteId]:n.generateId&&(c=r||0),a===`Point`)V(i,s);else if(a===`MultiPoint`)for(var l=0;l<i.length;l++)V(i[l],s);else if(a===`LineString`)ie(i,s,o,!1);else if(a===`MultiLineString`){if(n.lineMetrics){for(l=0;l<i.length;l++)ie(i[l],s=[],o,!1),e.push(te(c,`LineString`,s,t.properties));return}ae(i,s,o,!1)}else if(a===`Polygon`)ae(i,s,o,!0);else{if(a!==`MultiPolygon`){if(a===`GeometryCollection`){for(l=0;l<t.geometry.geometries.length;l++)re(e,{id:c,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw Error(`Input data is not a valid GeoJSON object.`)}for(l=0;l<i.length;l++){var u=[];ae(i[l],u,o,!0),s.push(u)}}e.push(te(c,a,s,t.properties))}}function V(e,t){t.push(oe(e[0])),t.push(se(e[1])),t.push(0)}function ie(e,t,n,r){for(var i,a,o=0,s=0;s<e.length;s++){var c=oe(e[s][0]),l=se(e[s][1]);t.push(c),t.push(l),t.push(0),s>0&&(o+=r?(i*l-c*a)/2:Math.sqrt((c-i)**2+(l-a)**2)),i=c,a=l}var u=t.length-3;t[2]=1,z(t,0,u,n),t[u+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function ae(e,t,n,r){for(var i=0;i<e.length;i++){var a=[];ie(e[i],a,n,r),t.push(a)}}function oe(e){return e/360+.5}function se(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function ce(e,t,n,r,i,a,o,s){if(r/=t,a>=(n/=t)&&o<r)return e;if(o<n||a>=r)return null;for(var c=[],l=0;l<e.length;l++){var u=e[l],d=u.geometry,f=u.type,p=i===0?u.minX:u.minY,m=i===0?u.maxX:u.maxY;if(p>=n&&m<r)c.push(u);else if(!(m<n||p>=r)){var h=[];if(f===`Point`||f===`MultiPoint`)H(d,h,n,r,i);else if(f===`LineString`)le(d,h,n,r,i,!1,s.lineMetrics);else if(f===`MultiLineString`)de(d,h,n,r,i,!1);else if(f===`Polygon`)de(d,h,n,r,i,!0);else if(f===`MultiPolygon`)for(var g=0;g<d.length;g++){var _=[];de(d[g],_,n,r,i,!0),_.length&&h.push(_)}if(h.length){if(s.lineMetrics&&f===`LineString`){for(g=0;g<h.length;g++)c.push(te(u.id,f,h[g],u.tags));continue}f!==`LineString`&&f!==`MultiLineString`||(h.length===1?(f=`LineString`,h=h[0]):f=`MultiLineString`),f!==`Point`&&f!==`MultiPoint`||(f=h.length===3?`Point`:`MultiPoint`),c.push(te(u.id,f,h,u.tags))}}}return c.length?c:null}function H(e,t,n,r,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=n&&o<=r&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function le(e,t,n,r,i,a,o){for(var s,c,l=ue(e),u=i===0?fe:pe,d=e.start,f=0;f<e.length-3;f+=3){var p=e[f],m=e[f+1],h=e[f+2],g=e[f+3],_=e[f+4],v=i===0?p:m,y=i===0?g:_,b=!1;o&&(s=Math.sqrt((p-g)**2+(m-_)**2)),v<n?y>n&&(c=u(l,p,m,g,_,n),o&&(l.start=d+s*c)):v>r?y<r&&(c=u(l,p,m,g,_,r),o&&(l.start=d+s*c)):U(l,p,m,h),y<n&&v>=n&&(c=u(l,p,m,g,_,n),b=!0),y>r&&v<=r&&(c=u(l,p,m,g,_,r),b=!0),!a&&b&&(o&&(l.end=d+s*c),t.push(l),l=ue(e)),o&&(d+=s)}var x=e.length-3;p=e[x],m=e[x+1],h=e[x+2],(v=i===0?p:m)>=n&&v<=r&&U(l,p,m,h),x=l.length-3,a&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&U(l,l[0],l[1],l[2]),l.length&&t.push(l)}function ue(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function de(e,t,n,r,i,a){for(var o=0;o<e.length;o++)le(e[o],t,n,r,i,a,!1)}function U(e,t,n,r){e.push(t),e.push(n),e.push(r)}function fe(e,t,n,r,i,a){var o=(a-t)/(r-t);return e.push(a),e.push(n+(i-n)*o),e.push(1),o}function pe(e,t,n,r,i,a){var o=(a-n)/(i-n);return e.push(t+(r-t)*o),e.push(a),e.push(1),o}function me(e,t){for(var n=[],r=0;r<e.length;r++){var i,a=e[r],o=a.type;if(o===`Point`||o===`MultiPoint`||o===`LineString`)i=W(a.geometry,t);else if(o===`MultiLineString`||o===`Polygon`){i=[];for(var s=0;s<a.geometry.length;s++)i.push(W(a.geometry[s],t))}else if(o===`MultiPolygon`)for(i=[],s=0;s<a.geometry.length;s++){for(var c=[],l=0;l<a.geometry[s].length;l++)c.push(W(a.geometry[s][l],t));i.push(c)}n.push(te(a.id,o,i,a.tags))}return n}function W(e,t){var n=[];n.size=e.size,e.start!==void 0&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function he(e,t){if(e.transformed)return e;var n,r,i,a=1<<e.z,o=e.x,s=e.y;for(n=0;n<e.features.length;n++){var c=e.features[n],l=c.geometry,u=c.type;if(c.geometry=[],u===1)for(r=0;r<l.length;r+=2)c.geometry.push(ge(l[r],l[r+1],t,a,o,s));else for(r=0;r<l.length;r++){var d=[];for(i=0;i<l[r].length;i+=2)d.push(ge(l[r][i],l[r][i+1],t,a,o,s));c.geometry.push(d)}}return e.transformed=!0,e}function ge(e,t,n,r,i,a){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-a))]}function _e(e,t,n,r,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,G(o,e[s],a,i);var c=e[s].minX,l=e[s].minY,u=e[s].maxX,d=e[s].maxY;c<o.minX&&(o.minX=c),l<o.minY&&(o.minY=l),u>o.maxX&&(o.maxX=u),d>o.maxY&&(o.maxY=d)}return o}function G(e,t,n,r){var i=t.geometry,a=t.type,o=[];if(a===`Point`||a===`MultiPoint`)for(var s=0;s<i.length;s+=3)o.push(i[s]),o.push(i[s+1]),e.numPoints++,e.numSimplified++;else if(a===`LineString`)K(o,i,e,n,!1,!1);else if(a===`MultiLineString`||a===`Polygon`)for(s=0;s<i.length;s++)K(o,i[s],e,n,a===`Polygon`,s===0);else if(a===`MultiPolygon`)for(var c=0;c<i.length;c++){var l=i[c];for(s=0;s<l.length;s++)K(o,l[s],e,n,!0,s===0)}if(o.length){var u=t.tags||null;if(a===`LineString`&&r.lineMetrics){for(var d in u={},t.tags)u[d]=t.tags[d];u.mapbox_clip_start=i.start/i.size,u.mapbox_clip_end=i.end/i.size}var f={geometry:o,type:a===`Polygon`||a===`MultiPolygon`?3:a===`LineString`||a===`MultiLineString`?2:1,tags:u};t.id!==null&&(f.id=t.id),e.features.push(f)}}function K(e,t,n,r,i,a){var o=r*r;if(r>0&&t.size<(i?o:r))n.numPoints+=t.length/3;else{for(var s=[],c=0;c<t.length;c+=3)(r===0||t[c+2]>o)&&(n.numSimplified++,s.push(t[c]),s.push(t[c+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,a=i-2;r<i;a=r,r+=2)n+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var o=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=o,e[i-1-r]=s}}(s,a),e.push(s)}}function ve(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time(`preprocess data`),t.maxZoom<0||t.maxZoom>24)throw Error(`maxZoom should be in the 0-24 range`);if(t.promoteId&&t.generateId)throw Error(`promoteId and generateId cannot be used together.`);var r=function(e,t){var n=[];if(e.type===`FeatureCollection`)for(var r=0;r<e.features.length;r++)re(n,e.features[r],t,r);else re(n,e.type===`Feature`?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd(`preprocess data`),console.log(`index: maxZoom: %d, maxPoints: %d`,t.indexMaxZoom,t.indexMaxPoints),console.time(`generate tiles`),this.stats={},this.total=0),r=function(e,t){var n=t.buffer/t.extent,r=e,i=ce(e,1,-1-n,n,0,-1,2,t),a=ce(e,1,1-n,2+n,0,-1,2,t);return(i||a)&&(r=ce(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=me(i,1).concat(r)),a&&(r=r.concat(me(a,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log(`features: %d, points: %d`,this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd(`generate tiles`),console.log(`tiles generated:`,this.total,JSON.stringify(this.stats)))}function ye(e,t,n){return 32*((1<<e)*n+t)+e}function be(e,t){return t?e.properties[t]:e.id}function xe(e,t){if(e==null)return!0;if(e.type===`Feature`)return be(e,t)!=null;if(e.type===`FeatureCollection`){let n=new Set;for(let r of e.features){let e=be(r,t);if(e==null||n.has(e))return!1;n.add(e)}return!0}return!1}function Se(e,t){let n=new Map;if(e!=null)if(e.type===`Feature`)n.set(be(e,t),e);else for(let r of e.features)n.set(be(r,t),r);return n}ve.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ve.prototype.splitTile=function(e,t,n,r,i,a,o){for(var s=[e,t,n,r],c=this.options,l=c.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var u=1<<t,d=ye(t,n,r),f=this.tiles[d];if(!f&&(l>1&&console.time(`creation`),f=this.tiles[d]=_e(e,t,n,r,c),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log(`tile z%d-%d-%d (features: %d, points: %d, simplified: %d)`,t,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd(`creation`));var p=`z`+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,i){if(t===c.maxZoom||t===i)continue;var m=1<<i-t;if(n!==Math.floor(a/m)||r!==Math.floor(o/m))continue}else if(t===c.indexMaxZoom||f.numPoints<=c.indexMaxPoints)continue;if(f.source=null,e.length!==0){l>1&&console.time(`clipping`);var h,g,_,v,y,b,x=.5*c.buffer/c.extent,S=.5-x,C=.5+x,w=1+x;h=g=_=v=null,y=ce(e,u,n-x,n+C,0,f.minX,f.maxX,c),b=ce(e,u,n+S,n+w,0,f.minX,f.maxX,c),e=null,y&&=(h=ce(y,u,r-x,r+C,1,f.minY,f.maxY,c),g=ce(y,u,r+S,r+w,1,f.minY,f.maxY,c),null),b&&=(_=ce(b,u,r-x,r+C,1,f.minY,f.maxY,c),v=ce(b,u,r+S,r+w,1,f.minY,f.maxY,c),null),l>1&&console.timeEnd(`clipping`),s.push(h||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(_||[],t+1,2*n+1,2*r),s.push(v||[],t+1,2*n+1,2*r+1)}}},ve.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,a=r.debug;if(e<0||e>24)return null;var o=1<<e,s=ye(e,t=(t%o+o)%o,n);if(this.tiles[s])return he(this.tiles[s],i);a>1&&console.log(`drilling down to z%d-%d-%d`,e,t,n);for(var c,l=e,u=t,d=n;!c&&l>0;)l--,u=Math.floor(u/2),d=Math.floor(d/2),c=this.tiles[ye(l,u,d)];return c&&c.source?(a>1&&console.log(`found parent tile z%d-%d-%d`,l,u,d),a>1&&console.time(`drilling down`),this.splitTile(c.source,l,u,d,e,t,n),a>1&&console.timeEnd(`drilling down`),this.tiles[s]?he(this.tiles[s],i):null):null};class Ce extends o{constructor(t,n,r,i){super(t,n,r),this._dataUpdateable=new Map,this.loadGeoJSON=(t,n)=>{let{promoteId:r}=t;if(t.request)return e.f(t.request,((e,t,i,a)=>{this._dataUpdateable=xe(t,r)?Se(t,r):void 0,n(e,t,i,a)}));if(typeof t.data==`string`)try{let e=JSON.parse(t.data);this._dataUpdateable=xe(e,r)?Se(e,r):void 0,n(null,e)}catch{n(Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}else t.dataDiff?this._dataUpdateable?(function(e,t,n){if(t.removeAll&&e.clear(),t.remove)for(let n of t.remove)e.delete(n);if(t.add)for(let r of t.add){let t=be(r,n);t!=null&&e.set(t,r)}if(t.update)for(let n of t.update){let t=e.get(n.id);if(t==null)continue;let r=!n.removeAllProperties&&(n.removeProperties?.length>0||n.addOrUpdateProperties?.length>0);if((n.newGeometry||n.removeAllProperties||r)&&(t=Object.assign({},t),e.set(n.id,t),r&&(t.properties=Object.assign({},t.properties))),n.newGeometry&&(t.geometry=n.newGeometry),n.removeAllProperties)t.properties={};else if(n.removeProperties?.length>0)for(let e of n.removeProperties)Object.prototype.hasOwnProperty.call(t.properties,e)&&delete t.properties[e];if(n.addOrUpdateProperties?.length>0)for(let{key:e,value:r}of n.addOrUpdateProperties)t.properties[e]=r}}(this._dataUpdateable,t.dataDiff,r),n(null,{type:`FeatureCollection`,features:Array.from(this._dataUpdateable.values())})):n(Error(`Cannot update existing geojson data in ${t.source}`)):n(Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,i&&(this.loadGeoJSON=i)}loadGeoJSONTile(t,n){let r=t.tileID.canonical;if(!this._geoJSONIndex)return n(null,null);let i=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!i)return n(null,null);let a=new class{constructor(t){this.layers={_geojsonTileLayer:this},this.name=`_geojsonTileLayer`,this.extent=e.N,this.length=t.length,this._features=t}feature(t){return new class{constructor(t){this._feature=t,this.extent=e.N,this.type=t.type,this.properties=t.tags,`id`in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(this._feature.type===1){let t=[];for(let n of this._feature.geometry)t.push([new e.P(n[0],n[1])]);return t}{let t=[];for(let n of this._feature.geometry){let r=[];for(let t of n)r.push(new e.P(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,n){return d.call(this,e,t,n)}}(this._features[t])}}(i.features),o=k(a);o.byteOffset===0&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),n(null,{vectorTile:a,rawData:o.buffer})}loadData(t,n){var r;(r=this._pendingRequest)==null||r.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});let i=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.bu(t.request);this._pendingCallback=n,this._pendingRequest=this.loadGeoJSON(t,((r,a)=>{if(delete this._pendingCallback,delete this._pendingRequest,r||!a)return n(r);if(typeof a!=`object`)return n(Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{u(a,!0);try{if(t.filter){let n=e.bC(t.filter,{type:`boolean`,"property-type":`data-driven`,overridable:!1,transition:!1});if(n.result===`error`)throw Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(`, `));a={type:`FeatureCollection`,features:a.features.filter((e=>n.value.evaluate({zoom:0},e)))}}this._geoJSONIndex=t.cluster?new N(function({superclusterOptions:t,clusterProperties:n}){if(!n||!t)return t;let r={},i={},a={accumulated:null,zoom:0},o={properties:null},s=Object.keys(n);for(let t of s){let[a,o]=n[t],s=e.bC(o),c=e.bC(typeof a==`string`?[a,[`accumulated`],[`get`,t]]:a);r[t]=s.value,i[t]=c.value}return t.map=e=>{o.properties=e;let t={};for(let e of s)t[e]=r[e].evaluate(a,o);return t},t.reduce=(e,t)=>{o.properties=t;for(let t of s)a.accumulated=e[t],e[t]=i[t].evaluate(a,o)},t}(t)).load(a.features):function(e,t){return new ve(e,t)}(a,t.geojsonVtOptions)}catch(e){return n(e)}this.loaded={};let r={};if(i){let e=i.finish();e&&(r.resourceTiming={},r.resourceTiming[t.source]=JSON.parse(JSON.stringify(e)))}n(null,r)}}))}reloadTile(e,t){let n=this.loaded;return n&&n[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}removeSource(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t()}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class we{constructor(t){this.self=t,this.actor=new e.C(t,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:o,geojson:Ce},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.bD.isParsed())throw Error(`RTL text plugin already registered.`);e.bD.applyArabicShaping=t.applyArabicShaping,e.bD.processBidirectionalText=t.processBidirectionalText,e.bD.processStyledBidirectionalText=t.processStyledBidirectionalText}}setReferrer(e,t){this.referrer=t}setImages(e,t,n){this.availableImages[e]=t;for(let n in this.workerSources[e]){let r=this.workerSources[e][n];for(let e in r)r[e].availableImages=t}n()}setLayers(e,t,n){this.getLayerIndex(e).replace(t),n()}updateLayers(e,t,n){this.getLayerIndex(e).update(t.layers,t.removedIds),n()}loadTile(e,t,n){this.getWorkerSource(e,t.type,t.source).loadTile(t,n)}loadDEMTile(e,t,n){this.getDEMWorkerSource(e,t.source).loadTile(t,n)}reloadTile(e,t,n){this.getWorkerSource(e,t.type,t.source).reloadTile(t,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source).removeTile(t,n)}removeDEMTile(e,t){this.getDEMWorkerSource(e,t.source).removeTile(t)}removeSource(e,t,n){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;let r=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],r.removeSource===void 0?n():r.removeSource(t,n)}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,r){try{e.bD.setState(n);let t=e.bD.getPluginURL();if(e.bD.isLoaded()&&!e.bD.isParsed()&&t!=null){this.self.importScripts(t);let n=e.bD.isParsed();r(n?void 0:Error(`RTL Text Plugin failed to import scripts from ${t}`),n)}}catch(e){r(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||=[],t}getLayerIndex(e){let n=this.layerIndexes[e];return n||=this.layerIndexes[e]=new t,n}getWorkerSource(e,t,n){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][n]||(this.workerSources[e][t][n]=new this.workerSourceTypes[t]({send:(t,n,r)=>{this.actor.send(t,n,r,e)}},this.getLayerIndex(e),this.getAvailableImages(e))),this.workerSources[e][t][n]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new s),this.demWorkerSources[e][t]}}return e.i()&&(self.worker=new we(self)),we})),r([`./shared`],(function(e){var t=`3.6.2`;class n{static testProp(e){if(!n.docStyle)return e[0];for(let t=0;t<e.length;t++)if(e[t]in n.docStyle)return e[t];return e[0]}static create(e,t,n){let r=window.document.createElement(e);return t!==void 0&&(r.className=t),n&&n.appendChild(r),r}static createNS(e,t){return window.document.createElementNS(e,t)}static disableDrag(){n.docStyle&&n.selectProp&&(n.userSelect=n.docStyle[n.selectProp],n.docStyle[n.selectProp]=`none`)}static enableDrag(){n.docStyle&&n.selectProp&&(n.docStyle[n.selectProp]=n.userSelect)}static setTransform(e,t){e.style[n.transformProp]=t}static addEventListener(e,t,n,r={}){e.addEventListener(t,n,`passive`in r?r:r.capture)}static removeEventListener(e,t,n,r={}){e.removeEventListener(t,n,`passive`in r?r:r.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener(`click`,n.suppressClickInternal,!0)}static suppressClick(){window.addEventListener(`click`,n.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener(`click`,n.suppressClickInternal,!0)}),0)}static mousePos(t,n){let r=t.getBoundingClientRect();return new e.P(n.clientX-r.left-t.clientLeft,n.clientY-r.top-t.clientTop)}static touchPos(t,n){let r=t.getBoundingClientRect(),i=[];for(let a=0;a<n.length;a++)i.push(new e.P(n[a].clientX-r.left-t.clientLeft,n[a].clientY-r.top-t.clientTop));return i}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}n.docStyle=typeof window<`u`&&window.document&&window.document.documentElement.style,n.selectProp=n.testProp([`userSelect`,`MozUserSelect`,`WebkitUserSelect`,`msUserSelect`]),n.transformProp=n.testProp([`transform`,`WebkitTransform`]);let r={supported:!1,testSupport:function(e){!o&&a&&(s?c(e):i=e)}},i,a,o=!1,s=!1;function c(e){let t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.isContextLost())return;r.supported=!0}catch{}e.deleteTexture(t),o=!0}var l,u;typeof document<`u`&&(a=document.createElement(`img`),a.onload=function(){i&&c(i),i=null,s=!0},a.onerror=function(){o=!0,i=null},a.src=`data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=`),function(t){let n,i,a,o;t.resetRequestQueue=()=>{n=[],i=0,a=0,o={}},t.addThrottleControl=e=>{let t=a++;return o[t]=e,t},t.removeThrottleControl=e=>{delete o[e],l()},t.getImage=(e,t,a=!0)=>{r.supported&&(e.headers||={},e.headers.accept=`image/webp,*/*`);let o={requestParameters:e,supportImageRefresh:a,callback:t,cancelled:!1,completed:!1,cancel:()=>{o.completed||o.cancelled||(o.cancelled=!0,o.innerRequest&&(o.innerRequest.cancel(),i--),l())}};return n.push(o),l(),o};let s=t=>{let{requestParameters:n,supportImageRefresh:r,callback:i}=t;return e.e(n,{type:`image`}),(!1!==r||e.i()||e.g(n.url)||n.headers&&!Object.keys(n.headers).reduce(((e,t)=>e&&t===`accept`),!0)?e.m:u)(n,((e,n,r,a)=>{c(t,i,e,n,r,a)}))},c=(t,n,r,a,o,s)=>{r?n(r):a instanceof HTMLImageElement||e.a(a)?n(null,a):a&&((t,n)=>{typeof createImageBitmap==`function`?e.b(t,n):e.d(t,n)})(a,((e,t)=>{e==null?t!=null&&n(null,t,{cacheControl:o,expires:s}):n(e)})),t.cancelled||(t.completed=!0,i--,l())},l=()=>{let t=(()=>{let e=Object.keys(o),t=!1;if(e.length>0){for(let n of e)if(t=o[n](),t)break}return t})()?e.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:e.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let e=i;e<t&&n.length>0;e++){let t=n.shift();if(t.cancelled){e--;continue}let r=s(t);i++,t.innerRequest=r}},u=(t,n)=>{let r=new Image,i=t.url,a=!1,o=t.credentials;return o&&o===`include`?r.crossOrigin=`use-credentials`:(o&&o===`same-origin`||!e.s(i))&&(r.crossOrigin=`anonymous`),r.fetchPriority=`high`,r.onload=()=>{n(null,r),r.onerror=r.onload=null},r.onerror=()=>{a||n(Error(`Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)),r.onerror=r.onload=null},r.src=i,{cancel:()=>{a=!0,r.src=``}}}}(l||={}),l.resetRequestQueue(),function(e){e.Glyphs=`Glyphs`,e.Image=`Image`,e.Source=`Source`,e.SpriteImage=`SpriteImage`,e.SpriteJSON=`SpriteJSON`,e.Style=`Style`,e.Tile=`Tile`,e.Unknown=`Unknown`}(u||={});class d{constructor(e){this._transformRequestFn=e}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeSpriteURL(e,t,n){let r=function(e){let t=e.match(f);if(!t)throw Error(`Unable to parse URL "${e}"`);return{protocol:t[1],authority:t[2],path:t[3]||`/`,params:t[4]?t[4].split(`&`):[]}}(e);return r.path+=`${t}${n}`,function(e){let t=e.params.length?`?${e.params.join(`&`)}`:``;return`${e.protocol}://${e.authority}${e.path}${t}`}(r)}setTransformRequest(e){this._transformRequestFn=e}}let f=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function p(t){var n=new e.A(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}var m,h=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e};m=new e.A(3),e.A!=Float32Array&&(m[0]=0,m[1]=0,m[2]=0);var g=function(e){var t=e[0],n=e[1];return t*t+n*n};function _(e){let t=[];if(typeof e==`string`)t.push({id:`default`,url:e});else if(e&&e.length>0){let n=[];for(let{id:r,url:i}of e){let e=`${r}${i}`;n.indexOf(e)===-1&&(n.push(e),t.push({id:r,url:i}))}}return t}function v(t,n,r,i,a){if(i)return void t(i);if(a!==Object.values(n).length||a!==Object.values(r).length)return;let o={};for(let t in n){o[t]={};let i=e.h.getImageCanvasContext(r[t]),a=n[t];for(let e in a){let{width:n,height:r,x:s,y:c,sdf:l,pixelRatio:u,stretchX:d,stretchY:f,content:p}=a[e];o[t][e]={data:null,pixelRatio:u,sdf:l,stretchX:d,stretchY:f,content:p,spriteData:{width:n,height:r,x:s,y:c,context:i}}}}t(null,o)}(function(){var t=new e.A(2);e.A!=Float32Array&&(t[0]=0,t[1]=0)})();class y{constructor(e,t,n,r){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,r)}update(t,n,r){let{width:i,height:a}=t,o=!(this.size&&this.size[0]===i&&this.size[1]===a||r),{context:s}=this,{gl:c}=s;if(this.useMipmap=!!(n&&n.useMipmap),c.bindTexture(c.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===c.RGBA&&(!n||!1!==n.premultiply)),o)this.size=[i,a],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.a(t)?c.texImage2D(c.TEXTURE_2D,0,this.format,this.format,c.UNSIGNED_BYTE,t):c.texImage2D(c.TEXTURE_2D,0,this.format,i,a,0,this.format,c.UNSIGNED_BYTE,t.data);else{let{x:n,y:o}=r||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.a(t)?c.texSubImage2D(c.TEXTURE_2D,0,n,o,c.RGBA,c.UNSIGNED_BYTE,t):c.texSubImage2D(c.TEXTURE_2D,0,n,o,i,a,c.RGBA,c.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&c.generateMipmap(c.TEXTURE_2D)}bind(e,t,n){let{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_2D,this.texture),n!==i.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=i.LINEAR),e!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function b(e){let{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class x extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}getImage(t){let n=this.images[t];if(n&&!n.data&&n.spriteData){let t=n.spriteData;n.data=new e.R({width:t.width,height:t.height},t.context.getImageData(t.x,t.y,t.width,t.height).data),n.spriteData=null}return n}addImage(e,t){if(this.images[e])throw Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,t)&&(this.images[e]=t)}_validate(t,n){let r=!0,i=n.data||n.spriteData;return this._validateStretch(n.stretchX,i&&i.width)||(this.fire(new e.j(Error(`Image "${t}" has invalid "stretchX" value`))),r=!1),this._validateStretch(n.stretchY,i&&i.height)||(this.fire(new e.j(Error(`Image "${t}" has invalid "stretchY" value`))),r=!1),this._validateContent(n.content,n)||(this.fire(new e.j(Error(`Image "${t}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let n=0;for(let r of e){if(r[0]<n||r[1]<r[0]||t<r[1])return!1;n=r[1]}return!0}_validateContent(e,t){if(!e)return!0;if(e.length!==4)return!1;let n=t.spriteData,r=n&&n.width||t.data.width,i=n&&n.height||t.data.height;return!(e[0]<0||r<e[0]||e[1]<0||i<e[1]||e[2]<0||r<e[2]||e[3]<0||i<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,t,n=!0){let r=this.getImage(e);if(n&&(r.data.width!==t.data.width||r.data.height!==t.data.height))throw Error(`size mismatch between old image (${r.data.width}x${r.data.height}) and new image (${t.data.width}x${t.data.height}).`);t.version=r.version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){let t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let n=!0;if(!this.isLoaded())for(let t of e)this.images[t]||(n=!1);this.isLoaded()||n?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,n){let r={};for(let n of t){let t=this.getImage(n);t||=(this.fire(new e.k(`styleimagemissing`,{id:n})),this.getImage(n)),t?r[n]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:!!(t.userImage&&t.userImage.render)}:e.w(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,r)}getPixelSize(){let{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){let n=this.patterns[t],r=this.getImage(t);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{let n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},i=new e.I(n,r);this.patterns[t]={bin:n,position:i}}return this._updatePatternAtlas(),this.patterns[t].position}bind(e){let t=e.gl;this.atlasTexture?this.dirty&&=(this.atlasTexture.update(this.atlasImage),!1):this.atlasTexture=new y(e,this.atlasImage,t.RGBA),this.atlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE)}_updatePatternAtlas(){let t=[];for(let e in this.patterns)t.push(this.patterns[e].bin);let{w:n,h:r}=e.p(t),i=this.atlasImage;i.resize({width:n||1,height:r||1});for(let t in this.patterns){let{bin:n}=this.patterns[t],r=n.x+1,a=n.y+1,o=this.getImage(t).data,s=o.width,c=o.height;e.R.copy(o,i,{x:0,y:0},{x:r,y:a},{width:s,height:c}),e.R.copy(o,i,{x:0,y:c-1},{x:r,y:a-1},{width:s,height:1}),e.R.copy(o,i,{x:0,y:0},{x:r,y:a+c},{width:s,height:1}),e.R.copy(o,i,{x:s-1,y:0},{x:r-1,y:a},{width:1,height:c}),e.R.copy(o,i,{x:0,y:0},{x:r+s,y:a},{width:1,height:c})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(let n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;let t=this.getImage(n);t||e.w(`Image with ID: "${n}" was not found`),b(t)&&this.updateImage(n,t)}}}let S=0x56bc75e2d63100000;function C(e,t,n,r,i,a,o,s,c){for(let l=t;l<t+r;l++)w(e,n*a+l,a,i,o,s,c);for(let l=n;l<n+i;l++)w(e,l*a+t,1,r,o,s,c)}function w(e,t,n,r,i,a,o){a[0]=0,o[0]=-S,o[1]=S,i[0]=e[t];for(let s=1,c=0,l=0;s<r;s++){i[s]=e[t+s*n];let r=s*s;do{let e=a[c];l=(i[s]-i[e]+r-e*e)/(s-e)/2}while(l<=o[c]&&--c>-1);c++,a[c]=s,o[c]=l,o[c+1]=S}for(let s=0,c=0;s<r;s++){for(;o[c+1]<s;)c++;let r=a[c],l=s-r;e[t+s*n]=i[r]+l*l}}class E{constructor(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}}setURL(e){this.url=e}getGlyphs(t,n){let r=[];for(let e in t)for(let n of t[e])r.push({stack:e,id:n});e.o(r,(({stack:e,id:t},n)=>{let r=this.entries[e];r||=this.entries[e]={glyphs:{},requests:{},ranges:{}};let i=r.glyphs[t];if(i!==void 0)return void n(null,{stack:e,id:t,glyph:i});if(i=this._tinySDF(r,e,t),i)return r.glyphs[t]=i,void n(null,{stack:e,id:t,glyph:i});let a=Math.floor(t/256);if(256*a>65535)return void n(Error(`glyphs > 65535 not supported`));if(r.ranges[a])return void n(null,{stack:e,id:t,glyph:i});if(!this.url)return void n(Error(`glyphsUrl is not set`));let o=r.requests[a];o||(o=r.requests[a]=[],E.loadGlyphRange(e,a,this.url,this.requestManager,((e,t)=>{if(t){for(let e in t)this._doesCharSupportLocalGlyph(+e)||(r.glyphs[+e]=t[+e]);r.ranges[a]=!0}for(let n of o)n(e,t);delete r.requests[a]}))),o.push(((r,i)=>{r?n(r):i&&n(null,{stack:e,id:t,glyph:i[t]||null})}))}),((e,t)=>{if(e)n(e);else if(t){let e={};for(let{stack:n,id:r,glyph:i}of t)(e[n]||(e[n]={}))[r]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics};n(null,e)}}))}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(e.u[`CJK Unified Ideographs`](t)||e.u[`Hangul Syllables`](t)||e.u.Hiragana(t)||e.u.Katakana(t))}_tinySDF(t,n,r){let i=this.localIdeographFontFamily;if(!i||!this._doesCharSupportLocalGlyph(r))return;let a=t.tinySDF;if(!a){let e=`400`;/bold/i.test(n)?e=`900`:/medium/i.test(n)?e=`500`:/light/i.test(n)&&(e=`200`),a=t.tinySDF=new E.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:i,fontWeight:e})}let o=a.draw(String.fromCharCode(r));return{id:r,bitmap:new e.q({width:o.width||60,height:o.height||60},o.data),metrics:{width:o.glyphWidth/2||24,height:o.glyphHeight/2||24,left:o.glyphLeft/2+.5||0,top:o.glyphTop/2-27.5||-8,advance:o.glyphAdvance/2||24,isDoubleResolution:!0}}}}E.loadGlyphRange=function(t,n,r,i,a){let o=256*n,s=o+255,c=i.transformRequest(r.replace(`{fontstack}`,t).replace(`{range}`,`${o}-${s}`),u.Glyphs);e.l(c,((t,n)=>{if(t)a(t);else if(n){let t={};for(let r of e.n(n))t[r.id]=r;a(null,t)}}))},E.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:r=.25,fontFamily:i=`sans-serif`,fontWeight:a=`normal`,fontStyle:o=`normal`}={}){this.buffer=t,this.cutoff=r,this.radius=n;let s=this.size=e+4*t,c=this.ctx=this._createCanvas(s).getContext(`2d`,{willReadFrequently:!0});c.font=`${o} ${a} ${e}px ${i}`,c.textBaseline=`alphabetic`,c.textAlign=`left`,c.fillStyle=`black`,this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s)}_createCanvas(e){let t=document.createElement(`canvas`);return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:i,actualBoundingBoxRight:a}=this.ctx.measureText(e),o=Math.ceil(n),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-i))),c=Math.min(this.size-this.buffer,o+Math.ceil(r)),l=s+2*this.buffer,u=c+2*this.buffer,d=Math.max(l*u,0),f=new Uint8ClampedArray(d),p={data:f,width:l,height:u,glyphWidth:s,glyphHeight:c,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(s===0||c===0)return p;let{ctx:m,buffer:h,gridInner:g,gridOuter:_}=this;m.clearRect(h,h,s,c),m.fillText(e,h,h+o);let v=m.getImageData(h,h,s,c);_.fill(S,0,d),g.fill(0,0,d);for(let e=0;e<c;e++)for(let t=0;t<s;t++){let n=v.data[4*(e*s+t)+3]/255;if(n===0)continue;let r=(e+h)*l+t+h;if(n===1)_[r]=0,g[r]=S;else{let e=.5-n;_[r]=e>0?e*e:0,g[r]=e<0?e*e:0}}C(_,0,0,l,u,l,this.f,this.v,this.z),C(g,h,h,s,c,l,this.f,this.v,this.z);for(let e=0;e<d;e++){let t=Math.sqrt(_[e])-Math.sqrt(g[e]);f[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class D{constructor(){this.specification=e.v.light.position}possiblyEvaluate(t,n){return e.z(t.expression.evaluate(n))}interpolate(t,n,r){return{x:e.B.number(t.x,n.x,r),y:e.B.number(t.y,n.y,r),z:e.B.number(t.z,n.z,r)}}}let O;class k extends e.E{constructor(t){super(),O||=new e.r({anchor:new e.D(e.v.light.anchor),position:new D,color:new e.D(e.v.light.color),intensity:new e.D(e.v.light.intensity)}),this._transitionable=new e.T(O),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(e.t,t,n))for(let e in t){let n=t[e];e.endsWith(`-transition`)?this._transitionable.setTransition(e.slice(0,-11),n):this._transitionable.setValue(e,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,r){return(!r||!1!==r.validate)&&e.x(this,t.call(e.y,e.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.v})))}}class A{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,t){let n=e.join(`,`)+String(t);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,t)),this.dashEntry[n]}getDashRanges(e,t,n){let r=[],i=e.length%2==1?-e[e.length-1]*n:0,a=e[0]*n,o=!0;r.push({left:i,right:a,isDash:o,zeroLength:e[0]===0});let s=e[0];for(let t=1;t<e.length;t++){o=!o;let c=e[t];i=s*n,s+=c,a=s*n,r.push({left:i,right:a,isDash:o,zeroLength:c===0})}return r}addRoundDash(e,t,n){let r=t/2;for(let t=-n;t<=n;t++){let i=this.width*(this.nextRow+n+t),a=0,o=e[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=e[++a]);let c=Math.abs(s-o.left),l=Math.abs(s-o.right),u=Math.min(c,l),d,f=t/n*(r+1);if(o.isDash){let e=r-Math.abs(f);d=Math.sqrt(u*u+e*e)}else d=r-Math.sqrt(u*u+f*f);this.data[i+s]=Math.max(0,Math.min(255,d+128))}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){let n=e[t],r=e[t+1];n.zeroLength?e.splice(t,1):r&&r.isDash===n.isDash&&(r.left=n.left,e.splice(t,1))}let t=e[0],n=e[e.length-1];t.isDash===n.isDash&&(t.left=n.left-this.width,n.right=t.right+this.width);let r=this.width*this.nextRow,i=0,a=e[i];for(let t=0;t<this.width;t++){t/a.right>1&&(a=e[++i]);let n=Math.abs(t-a.left),o=Math.abs(t-a.right),s=Math.min(n,o);this.data[r+t]=Math.max(0,Math.min(255,(a.isDash?s:-s)+128))}}addDash(t,n){let r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return e.w(`LineAtlas out of space`),null;let a=0;for(let e=0;e<t.length;e++)a+=t[e];if(a!==0){let e=this.width/a,i=this.getDashRanges(t,this.width,e);n?this.addRoundDash(i,e,r):this.addRegularDash(i)}let o={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:a};return this.nextRow+=i,this.dirty=!0,o}bind(e){let t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}class j{constructor(t,n,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=r;let i=this.workerPool.acquire(r);for(let t=0;t<i.length;t++){let a=new e.C(i[t],n,r);a.name=`Worker ${t}`,this.actors.push(a)}if(!this.actors.length)throw Error(`No actors found`)}broadcast(t,n,r){e.o(this.actors,((e,r)=>{e.send(t,n,r)}),r||=function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((e=>{e.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}}function M(t,n,r){let i=function(n,i){if(n)return r(n);if(i){let n=e.F(e.e(i,t),[`tiles`,`minzoom`,`maxzoom`,`attribution`,`bounds`,`scheme`,`tileSize`,`encoding`]);i.vector_layers&&(n.vectorLayers=i.vector_layers,n.vectorLayerIds=n.vectorLayers.map((e=>e.id))),r(null,n)}};return t.url?e.f(n.transformRequest(t.url,u.Source),i):e.h.frame((()=>i(null,t)))}class N{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(t){return this._ne=t instanceof e.L?new e.L(t.lng,t.lat):e.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof e.L?new e.L(t.lng,t.lat):e.L.convert(t),this}extend(t){let n=this._sw,r=this._ne,i,a;if(t instanceof e.L)i=t,a=t;else{if(!(t instanceof N))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(N.convert(t)):this.extend(e.L.convert(t)):t&&(`lng`in t||`lon`in t)&&`lat`in t?this.extend(e.L.convert(t)):this;if(i=t._sw,a=t._ne,!i||!a)return this}return n||r?(n.lng=Math.min(i.lng,n.lng),n.lat=Math.min(i.lat,n.lat),r.lng=Math.max(a.lng,r.lng),r.lat=Math.max(a.lat,r.lat)):(this._sw=new e.L(i.lng,i.lat),this._ne=new e.L(a.lng,a.lat)),this}getCenter(){return new e.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new e.L(this.getWest(),this.getNorth())}getSouthEast(){return new e.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:n,lat:r}=e.L.convert(t),i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i}static convert(e){return e instanceof N?e:e&&new N(e)}static fromLngLat(t,n=0){let r=360*n/40075017,i=r/Math.cos(Math.PI/180*t.lat);return new N(new e.L(t.lng-i,t.lat-r),new e.L(t.lng+i,t.lat+r))}}class P{constructor(e,t,n){this.bounds=N.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){let n=2**t.z,r=Math.floor(e.G(this.bounds.getWest())*n),i=Math.floor(e.H(this.bounds.getNorth())*n),a=Math.ceil(e.G(this.bounds.getEast())*n),o=Math.ceil(e.H(this.bounds.getSouth())*n);return t.x>=r&&t.x<a&&t.y>=i&&t.y<o}}class F extends e.E{constructor(t,n,r,i){if(super(),this.load=()=>{this._loaded=!1,this.fire(new e.k(`dataloading`,{dataType:`source`})),this._tileJSONRequest=M(this._options,this.map._requestManager,((t,n)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new e.j(t)):n&&(e.e(this,n),n.bounds&&(this.tileBounds=new P(n.bounds,this.minzoom,this.maxzoom)),this.fire(new e.k(`data`,{dataType:`source`,sourceDataType:`metadata`})),this.fire(new e.k(`data`,{dataType:`source`,sourceDataType:`content`})))}))},this.serialize=()=>e.e({},this._options),this.id=t,this.dispatcher=r,this.type=`vector`,this.minzoom=0,this.maxzoom=22,this.scheme=`xyz`,this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.F(n,[`url`,`scheme`,`tileSize`,`promoteId`])),this._options=e.e({type:`vector`},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw Error(`vector tile sources must have a tileSize of 512`);this.setEventedParent(i)}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&=(this._tileJSONRequest.cancel(),null)}loadTile(e,t){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),r={request:this.map._requestManager.transformRequest(n,u.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function i(n,r){return delete e.request,e.aborted?t(null):n&&n.status!==404?t(n):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t(null),void(e.reloadCallback&&=(this.loadTile(e,e.reloadCallback),null)))}r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!==`expired`?e.state===`loading`?e.reloadCallback=t:e.request=e.actor.send(`reloadTile`,r,i.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send(`loadTile`,r,i.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send(`abortTile`,{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send(`removeTile`,{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class I extends e.E{constructor(t,n,r,i){super(),this.id=t,this.dispatcher=r,this.setEventedParent(i),this.type=`raster`,this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme=`xyz`,this.tileSize=512,this._loaded=!1,this._options=e.e({type:`raster`},n),e.e(this,e.F(n,[`url`,`scheme`,`tileSize`]))}load(){this._loaded=!1,this.fire(new e.k(`dataloading`,{dataType:`source`})),this._tileJSONRequest=M(this._options,this.map._requestManager,((t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.j(t)):n&&(e.e(this,n),n.bounds&&(this.tileBounds=new P(n.bounds,this.minzoom,this.maxzoom)),this.fire(new e.k(`data`,{dataType:`source`,sourceDataType:`metadata`})),this.fire(new e.k(`data`,{dataType:`source`,sourceDataType:`content`})))}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&=(this._tileJSONRequest.cancel(),null)}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}serialize(){return e.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=l.getImage(this.map._requestManager.transformRequest(n,u.Tile),((n,r,i)=>{if(delete e.request,e.aborted)e.state=`unloaded`,t(null);else if(n)e.state=`errored`,t(n);else if(r){this.map._refreshExpiredTiles&&i&&e.setExpiryData(i);let n=this.map.painter.context,a=n.gl;e.texture=this.map.painter.getTileTexture(r.width),e.texture?e.texture.update(r,{useMipmap:!0}):(e.texture=new y(n,r,a.RGBA,{useMipmap:!0}),e.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax)),e.state=`loaded`,t(null)}}),this.map._refreshExpiredTiles)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}}class ee extends I{constructor(t,n,r,i){super(t,n,r,i),this.type=`raster-dem`,this.maxzoom=22,this._options=e.e({type:`raster-dem`},n),this.encoding=n.encoding||`mapbox`,this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t,n){let r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i=this.map._requestManager.transformRequest(r,u.Tile);function a(e,r){e&&(t.state=`errored`,n(e)),r&&(t.dem=r,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state=`loaded`,n(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=l.getImage(i,((r,i,o)=>e._(this,void 0,void 0,(function*(){if(delete t.request,t.aborted)t.state=`unloaded`,n(null);else if(r)t.state=`errored`,n(r);else if(i){this.map._refreshExpiredTiles&&t.setExpiryData(o);let n=e.a(i)&&e.J()?i:yield function(t){return e._(this,void 0,void 0,(function*(){if(typeof VideoFrame<`u`&&e.K()){let n=t.width+2,r=t.height+2;try{return new e.R({width:n,height:r},yield e.M(t,-1,-1,n,r))}catch{}}return e.h.getImageData(t,1)}))}(i),r={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:n,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!==`expired`||(t.actor=this.dispatcher.getActor(),t.actor.send(`loadDEMTile`,r,a))}}))),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){let n=t.canonical,r=2**n.z,i=(n.x-1+r)%r,a=n.x===0?t.wrap-1:t.wrap,o=(n.x+1+r)%r,s=n.x+1===r?t.wrap+1:t.wrap,c={};return c[new e.O(t.overscaledZ,a,n.z,i,n.y).key]={backfilled:!1},c[new e.O(t.overscaledZ,s,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(c[new e.O(t.overscaledZ,a,n.z,i,n.y-1).key]={backfilled:!1},c[new e.O(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},c[new e.O(t.overscaledZ,s,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<r&&(c[new e.O(t.overscaledZ,a,n.z,i,n.y+1).key]={backfilled:!1},c[new e.O(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},c[new e.O(t.overscaledZ,s,n.z,o,n.y+1).key]={backfilled:!1}),c}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state=`unloaded`,e.actor&&e.actor.send(`removeDEMTile`,{uid:e.uid,source:this.id})}}class R extends e.E{constructor(t,n,r,i){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>e.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type=`geojson`,this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=r.getActor(),this.setEventedParent(i),this._data=n.data,this._options=e.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;let a=e.N/this.tileSize;this.workerOptions=e.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer===void 0?128:n.buffer)*a,tolerance:(n.tolerance===void 0?.375:n.tolerance)*a,extent:e.N,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom===void 0?this.maxzoom-1:n.clusterMaxZoom,minPoints:Math.max(2,n.clusterMinPoints||2),extent:e.N,radius:(n.clusterRadius||50)*a,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId==`string`&&(this.workerOptions.promoteId=this.promoteId)}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send(`geojson.getClusterExpansionZoom`,{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send(`geojson.getClusterChildren`,{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,n,r){return this.actor.send(`geojson.getClusterLeaves`,{source:this.id,clusterId:e,limit:t,offset:n},r),this}_updateWorkerData(t){let n=e.e({},this.workerOptions);t?n.dataDiff=t:typeof this._data==`string`?(n.request=this.map._requestManager.transformRequest(e.h.resolveURL(this._data),u.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new e.k(`dataloading`,{dataType:`source`})),this.actor.send(`${this.type}.loadData`,n,((t,n)=>{if(this._pendingLoads--,this._removed||n&&n.abandoned)return void this.fire(new e.k(`dataabort`,{dataType:`source`}));let r=null;if(n&&n.resourceTiming&&n.resourceTiming[this.id]&&(r=n.resourceTiming[this.id].slice(0)),t)return void this.fire(new e.j(t));let i={dataType:`source`};this._collectResourceTiming&&r&&r.length>0&&e.e(i,{resourceTiming:r}),this.fire(new e.k(`data`,Object.assign(Object.assign({},i),{sourceDataType:`metadata`}))),this.fire(new e.k(`data`,Object.assign(Object.assign({},i),{sourceDataType:`content`})))}))}loaded(){return this._pendingLoads===0}loadTile(e,t){let n=e.actor?`reloadTile`:`loadTile`;e.actor=this.actor;let r={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(n,r,((r,i)=>(delete e.request,e.unloadVectorData(),e.aborted?t(null):r?t(r):(e.loadVectorData(i,this.map.painter,n===`reloadTile`),t(null)))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send(`removeTile`,{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send(`removeSource`,{type:this.type,source:this.id})}hasTransition(){return!1}}var z=e.Q([{name:`a_pos`,type:`Int16`,components:2},{name:`a_texture_pos`,type:`Int16`,components:2}]);class B extends e.E{constructor(t,n,r,i){super(),this.load=(t,n)=>{this._loaded=!1,this.fire(new e.k(`dataloading`,{dataType:`source`})),this.url=this.options.url,this._request=l.getImage(this.map._requestManager.transformRequest(this.url,u.Image),((r,i)=>{this._request=null,this._loaded=!0,r?this.fire(new e.j(r)):i&&(this.image=i,t&&(this.coordinates=t),n&&n(),this._finishLoading())}))},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;let t=this.map.painter.context,n=t.gl;this.boundsBuffer||=t.createVertexBuffer(this._boundsArray,z.members),this.boundsSegments||=e.S.simpleSegment(0,0,4,2),this.texture||(this.texture=new y(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let r=!1;for(let e in this.tiles){let t=this.tiles[e];t.state!==`loaded`&&(t.state=`loaded`,t.texture=this.texture,r=!0)}r&&this.fire(new e.k(`data`,{dataType:`source`,sourceDataType:`idle`,sourceId:this.id}))},this.serialize=()=>({type:`image`,url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=r,this.coordinates=n.coordinates,this.type=`image`,this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=n}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&=(this._request.cancel(),null),this.options.url=e.url,this.load(e.coordinates,(()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.k(`data`,{dataType:`source`,sourceDataType:`metadata`})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&=(this._request.cancel(),null)}setCoordinates(t){this.coordinates=t;let n=t.map(e.U.fromLngLat);this.tileID=function(t){let n=1/0,r=1/0,i=-1/0,a=-1/0;for(let e of t)n=Math.min(n,e.x),r=Math.min(r,e.y),i=Math.max(i,e.x),a=Math.max(a,e.y);let o=Math.max(i-n,a-r),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),c=2**s;return new e.W(s,Math.floor((n+i)/2*c),Math.floor((r+a)/2*c))}(n),this.minzoom=this.maxzoom=this.tileID.z;let r=n.map((e=>this.tileID.getTilePoint(e)._round()));return this._boundsArray=new e.V,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,e.N,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,e.N),this._boundsArray.emplaceBack(r[2].x,r[2].y,e.N,e.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.k(`data`,{dataType:`source`,sourceDataType:`content`})),this}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state=`errored`,t(null))}hasTransition(){return!1}}class te extends B{constructor(t,n,r,i){super(t,n,r,i),this.load=()=>{this._loaded=!1;let t=this.options;this.urls=[];for(let e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,u.Source).url);e.X(this.urls,((t,n)=>{this._loaded=!0,t?this.fire(new e.j(t)):n&&(this.video=n,this.video.loop=!0,this.video.addEventListener(`playing`,(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let t=this.map.painter.context,n=t.gl;this.boundsBuffer||=t.createVertexBuffer(this._boundsArray,z.members),this.boundsSegments||=e.S.simpleSegment(0,0,4,2),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new y(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let r=!1;for(let e in this.tiles){let t=this.tiles[e];t.state!==`loaded`&&(t.state=`loaded`,t.texture=this.texture,r=!0)}r&&this.fire(new e.k(`data`,{dataType:`source`,sourceDataType:`idle`,sourceId:this.id}))},this.serialize=()=>({type:`video`,urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type=`video`,this.options=n}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){let n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.j(new e.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class ne extends B{constructor(t,n,r,i){super(t,n,r,i),this.load=()=>{this._loaded=!0,this.canvas||=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.j(Error(`Canvas dimensions cannot be less than or equal to zero.`))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&=(this.prepare(),!1)},this._finishLoading())},this.prepare=()=>{let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let n=this.map.painter.context,r=n.gl;this.boundsBuffer||=n.createVertexBuffer(this._boundsArray,z.members),this.boundsSegments||=e.S.simpleSegment(0,0,4,2),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y(n,this.canvas,r.RGBA,{premultiply:!0});let i=!1;for(let e in this.tiles){let t=this.tiles[e];t.state!==`loaded`&&(t.state=`loaded`,t.texture=this.texture,i=!0)}i&&this.fire(new e.k(`data`,{dataType:`source`,sourceDataType:`idle`,sourceId:this.id}))},this.serialize=()=>({type:`canvas`,coordinates:this.coordinates}),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((e=>!Array.isArray(e)||e.length!==2||e.some((e=>typeof e!=`number`))))||this.fire(new e.j(new e.Y(`sources.${t}`,null,`"coordinates" property must be an array of 4 longitude/latitude array pairs`))):this.fire(new e.j(new e.Y(`sources.${t}`,null,`missing required property "coordinates"`))),n.animate&&typeof n.animate!=`boolean`&&this.fire(new e.j(new e.Y(`sources.${t}`,null,`optional "animate" property must be a boolean value`))),n.canvas?typeof n.canvas==`string`||n.canvas instanceof HTMLCanvasElement||this.fire(new e.j(new e.Y(`sources.${t}`,null,`"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance`))):this.fire(new e.j(new e.Y(`sources.${t}`,null,`missing required property "canvas"`))),this.options=n,this.animate=n.animate===void 0||n.animate}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let re={},V=e=>{switch(e){case`geojson`:return R;case`image`:return B;case`raster`:return I;case`raster-dem`:return ee;case`vector`:return F;case`video`:return te;case`canvas`:return ne}return re[e]};function ie(t,n){let r=e.Z();return e.$(r,r,[1,1,0]),e.a0(r,r,[.5*t.width,.5*t.height,1]),e.a1(r,r,t.calculatePosMatrix(n.toUnwrapped()))}function ae(e,t,n,r,i,a){let o=function(e,t,n){if(e)for(let r of e){let e=t[r];if(e&&e.source===n&&e.type===`fill-extrusion`)return!0}else for(let e in t){let r=t[e];if(r.source===n&&r.type===`fill-extrusion`)return!0}return!1}(i&&i.layers,t,e.id),s=a.maxPitchScaleFactor(),c=e.tilesIn(r,s,o);c.sort(oe);let l=[];for(let r of c)l.push({wrappedTileID:r.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(t,n,e._state,r.queryGeometry,r.cameraQueryGeometry,r.scale,i,a,s,ie(e.transform,r.tileID))});let u=function(e){let t={},n={};for(let r of e){let e=r.queryResults,i=r.wrappedTileID,a=n[i]=n[i]||{};for(let n in e){let r=e[n],i=a[n]=a[n]||{},o=t[n]=t[n]||[];for(let e of r)i[e.featureIndex]||(i[e.featureIndex]=!0,o.push(e))}}return t}(l);for(let t in u)u[t].forEach((t=>{let n=t.feature,r=e.getFeatureState(n.layer[`source-layer`],n.id);n.source=n.layer.source,n.layer[`source-layer`]&&(n.sourceLayer=n.layer[`source-layer`]),n.state=r}));return u}function oe(e,t){let n=e.tileID,r=t.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}class se{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=e.a2(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state=`loading`}registerFadeDuration(e){let t=e+this.timeAdded;t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state===`errored`||this.state===`loaded`||this.state===`reloading`}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,r){if(this.hasData()&&this.unloadVectorData(),this.state=`loaded`,t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(e,t){let n={};if(!t)return n;for(let r of e){let e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(e.length!==0){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(let t of e)n[t.id]=r}}return n}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(let t in this.buckets){let n=this.buckets[t];if(n instanceof e.a4){if(this.hasSymbolBuckets=!0,!r)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let t in this.buckets){let n=this.buckets[t];if(n instanceof e.a4&&n.hasRTLText){this.hasRTLText=!0,e.a5();break}}this.queryPadding=0;for(let e in this.buckets){let t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(e).queryRadius(t))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new e.a3}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&=null,this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state=`unloaded`}getBucket(e){return this.buckets[e.id]}upload(e){for(let t in this.buckets){let n=this.buckets[t];n.uploadPending()&&n.upload(e)}let t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new y(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&=(this.glyphAtlasTexture=new y(e,this.glyphAtlasImage,t.ALPHA),null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,r,i,a,o,s,c,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:a,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:o,queryPadding:this.queryPadding*c},e,t,n):{}}querySourceFeatures(t,n){let r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;let i=r.loadVTLayers(),a=n&&n.sourceLayer?n.sourceLayer:``,o=i._geojsonTileLayer||i[a];if(!o)return;let s=e.a6(n&&n.filter),{z:c,x:l,y:u}=this.tileID.canonical,d={z:c,x:l,y:u};for(let n=0;n<o.length;n++){let i=o.feature(n);if(s.needGeometry){let t=e.a7(i,!0);if(!s.filter(new e.a8(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new e.a8(this.tileID.overscaledZ),i))continue;let f=r.getId(i,a),p=new e.a9(i,c,l,u,f);p.tile=d,t.push(p)}}hasData(){return this.state===`loaded`||this.state===`reloading`||this.state===`expired`}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let n=this.expirationTime;if(t.cacheControl){let n=e.aa(t.cacheControl);n[`max-age`]&&(this.expirationTime=Date.now()+1e3*n[`max-age`])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let e=Date.now(),t=!1;if(this.expirationTime>e)t=!1;else if(n)if(this.expirationTime<n)t=!0;else{let r=this.expirationTime-n;r?this.expirationTime=e+Math.max(r,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state=`expired`):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),2**31-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let n=this.latestFeatureIndex.loadVTLayers();for(let r in this.buckets){if(!t.style.hasLayer(r))continue;let i=this.buckets[r],a=i.layers[0].sourceLayer||`_geojsonTileLayer`,o=n[a],s=e[a];if(!o||!s||Object.keys(s).length===0)continue;i.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});let c=t&&t.style&&t.style.getLayer(r);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(i)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.h.now()+t}setDependencies(e,t){let n={};for(let e of t)n[e]=!0;this.dependencies[e]=n}hasDependency(e,t){for(let n of e){let e=this.dependencies[n];if(e){for(let n of t)if(e[n])return!0}}return!1}}class ce{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(let e in this.data)for(let t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){let r=e.wrapped().key;this.data[r]===void 0&&(this.data[r]=[]);let i={value:t,timeout:void 0};if(n!==void 0&&(i.timeout=setTimeout((()=>{this.remove(e,i)}),n)),this.data[r].push(i),this.order.push(r),this.order.length>this.max){let e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){let t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;let n=e.wrapped().key,r=t===void 0?0:this.data[n].indexOf(t),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){let t=[];for(let n in this.data)for(let r of this.data[n])e(r.value)||t.push(r);for(let e of t)this.remove(e.value.tileID,e)}}class H{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,r){let i=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},e.e(this.stateChanges[t][i],r),this.deletedStates[t]===null){this.deletedStates[t]={};for(let e in this.state[t])e!==i&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][i]===null){this.deletedStates[t][i]={};for(let e in this.state[t][i])r[e]||(this.deletedStates[t][i][e]=null)}else for(let e in r)this.deletedStates[t]&&this.deletedStates[t][i]&&this.deletedStates[t][i][e]===null&&delete this.deletedStates[t][i][e]}removeFeatureState(e,t,n){if(this.deletedStates[e]===null)return;let r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&t!==void 0)this.deletedStates[e][r]!==null&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][n]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][r])for(n in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][n]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(t,n){let r=String(n),i=e.e({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){let e=this.deletedStates[t][n];if(e===null)return{};for(let t in e)delete i[t]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(t,n){let r={};for(let t in this.stateChanges){this.state[t]=this.state[t]||{};let n={};for(let r in this.stateChanges[t])this.state[t][r]||(this.state[t][r]={}),e.e(this.state[t][r],this.stateChanges[t][r]),n[r]=this.state[t][r];r[t]=n}for(let t in this.deletedStates){this.state[t]=this.state[t]||{};let n={};if(this.deletedStates[t]===null)for(let e in this.state[t])n[e]={},this.state[t][e]={};else for(let e in this.deletedStates[t]){if(this.deletedStates[t][e]===null)this.state[t][e]={};else for(let n of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][n];n[e]=this.state[t][e]}r[t]=r[t]||{},e.e(r[t],n)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(let e in t)t[e].setFeatureState(r,n)}}class le extends e.E{constructor(e,t,n){super(),this.id=e,this.dispatcher=n,this.on(`data`,(e=>{e.dataType===`source`&&e.sourceDataType===`metadata`&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType===`source`&&e.sourceDataType===`content`&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)})),this.on(`dataloading`,(()=>{this._sourceErrored=!1})),this.on(`error`,(()=>{this._sourceErrored=this._source.loaded()})),this._source=((e,t,n,r)=>{let i=new(V(t.type))(e,t,n,r);if(i.id!==e)throw Error(`Expected Source id to be ${e} instead of ${i.id}`);return i})(e,t,n,this),this._tiles={},this._cache=new ce(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new H,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let t=this._tiles[e];if(t.state!==`loaded`&&t.state!==`errored`)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,t){return this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,(()=>{})),this._source.fire(new e.k(`dataabort`,{tile:t,coord:t.tileID,dataType:`source`}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let t in this._tiles){let n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(ue).map((e=>e.key))}getRenderableIds(t){let n=[];for(let e in this._tiles)this._isIdRenderable(e,t)&&n.push(this._tiles[e]);return t?n.sort(((t,n)=>{let r=t.tileID,i=n.tileID,a=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),o=new e.P(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-i.overscaledZ||o.y-a.y||o.x-a.x})).map((e=>e.tileID.key)):n.map((e=>e.tileID)).sort(ue).map((e=>e.key))}hasRenderableParent(e){let t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!==`errored`&&this._reloadTile(e,`reloading`)}}_reloadTile(e,t){let n=this._tiles[e];n&&(n.state!==`loading`&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(t,n,r,i){if(i)return t.state=`errored`,void(i.status===404?this.update(this.transform,this.terrain):this._source.fire(new e.j(i,{tile:t})));t.timeAdded=e.h.now(),r===`expired`&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type===`raster-dem`&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new e.k(`data`,{dataType:`source`,tile:t,coord:t.tileID}))}_backfillDEM(e){let t=this.getRenderableIds();for(let r=0;r<t.length;r++){let i=t[r];if(e.neighboringTiles&&e.neighboringTiles[i]){let t=this.getTileByID(i);n(e,t),n(t,e)}}function n(e,t){e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x,r=t.tileID.canonical.y-e.tileID.canonical.y,i=2**e.tileID.canonical.z,a=t.tileID.key;n===0&&r===0||Math.abs(r)>1||(Math.abs(n)>1&&(Math.abs(n+i)===1?n+=i:Math.abs(n-i)===1&&(n-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,r),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,r){for(let i in this._tiles){let a=this._tiles[i];if(r[i]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>n)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>t+1;){let e=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[e.key],a&&a.hasData()&&(o=e)}let s=o;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){r[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){let n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){let t=e.scaledTo(n),r=this._getLoadedTile(t);if(r)return r}}_getLoadedTile(e){let t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(e.wrapped().key)}updateCacheSize(t){let n=Math.ceil(t.width/this._source.tileSize)+1,r=Math.ceil(t.height/this._source.tileSize)+1,i=Math.floor(n*r*(this._maxTileCacheZoomLevels===null?e.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),a=typeof this._maxTileCacheSize==`number`?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(a)}handleWrapJump(e){let t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){let e={};for(let n in this._tiles){let r=this._tiles[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(let e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(let e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let r;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.O(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y))):(r=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(r=r.filter((e=>this._source.hasTile(e))))):r=[];let i=t.coveringZoomLevel(this._source),a=Math.max(i-le.maxOverzooming,this._source.minzoom),o=Math.max(i+le.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let e={};for(let t of r)if(t.canonical.z>this._source.minzoom){let n=t.scaledTo(t.canonical.z-1);e[n.key]=n;let r=t.scaledTo(Math.max(this._source.minzoom,Math.min(t.canonical.z,5)));e[r.key]=r}r=r.concat(Object.values(e))}let s=r.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,s&&this.fire(new e.k(`data`,{sourceDataType:`idle`,dataType:`source`,sourceId:this.id}));let c=this._updateRetainedTiles(r,i);if(de(this._source.type)){let t={},s={},l=Object.keys(c),u=e.h.now();for(let e of l){let n=c[e],r=this._tiles[e];if(!r||r.fadeEndTime!==0&&r.fadeEndTime<=u)continue;let i=this.findLoadedParent(n,a);i&&(this._addTile(i.tileID),t[i.tileID.key]=i.tileID),s[e]=n}this._retainLoadedChildren(s,i,o,c);for(let e in t)c[e]||(this._coveredTiles[e]=!0,c[e]=t[e]);if(n){let e={},t={};for(let n of r)this._tiles[n.key].hasData()?e[n.key]=n:t[n.key]=n;for(let n in t){let r=t[n].children(this._source.maxzoom);this._tiles[r[0].key]&&this._tiles[r[1].key]&&this._tiles[r[2].key]&&this._tiles[r[3].key]&&(e[r[0].key]=c[r[0].key]=r[0],e[r[1].key]=c[r[1].key]=r[1],e[r[2].key]=c[r[2].key]=r[2],e[r[3].key]=c[r[3].key]=r[3],delete t[n])}for(let n in t){let r=this.findLoadedParent(t[n],this._source.minzoom);if(r){e[r.tileID.key]=c[r.tileID.key]=r.tileID;for(let t in e)e[t].isChildOf(r.tileID)&&delete e[t]}}for(let t in this._tiles)e[t]||(this._coveredTiles[t]=!0)}}for(let e in c)this._tiles[e].clearFadeHold();let l=e.ab(this._tiles,c);for(let e of l){let t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(e)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,t){let n={},r={},i=Math.max(t-le.maxOverzooming,this._source.minzoom),a=Math.max(t+le.maxUnderzooming,this._source.minzoom),o={};for(let r of e){let e=this._addTile(r);n[r.key]=r,e.hasData()||t<this._source.maxzoom&&(o[r.key]=r)}this._retainLoadedChildren(o,t,a,n);for(let a of e){let e=this._tiles[a.key];if(e.hasData())continue;if(t+1>this._source.maxzoom){let e=a.children(this._source.maxzoom)[0],t=this.getTile(e);if(t&&t.hasData()){n[e.key]=e;continue}}else{let e=a.children(this._source.maxzoom);if(n[e[0].key]&&n[e[1].key]&&n[e[2].key]&&n[e[3].key])continue}let o=e.wasRequested();for(let t=a.overscaledZ-1;t>=i;--t){let i=a.scaledTo(t);if(r[i.key])break;if(r[i.key]=!0,e=this.getTile(i),!e&&o&&(e=this._addTile(i)),e){let t=e.hasData();if((o||t)&&(n[i.key]=i),o=e.wasRequested(),t)break}}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let t=[],n,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}t.push(r.key);let e=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;r=e}for(let e of t)this._loadedParentTiles[e]=n}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));let r=n;return n||(n=new se(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,r||this._source.fire(new e.k(`dataloading`,{tile:n,coord:n.tileID,dataType:`source`})),n}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,`expired`),delete this._timers[e]}),n))}_removeTile(e){let t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!==`reloading`?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(t,n,r){let i=[],a=this.transform;if(!a)return i;let o=r?a.getCameraQueryGeometry(t):t,s=t.map((e=>a.pointCoordinate(e,this.terrain))),c=o.map((e=>a.pointCoordinate(e,this.terrain))),l=this.getIds(),u=1/0,d=1/0,f=-1/0,p=-1/0;for(let e of c)u=Math.min(u,e.x),d=Math.min(d,e.y),f=Math.max(f,e.x),p=Math.max(p,e.y);for(let t=0;t<l.length;t++){let r=this._tiles[l[t]];if(r.holdingForFade())continue;let o=r.tileID,m=2**(a.zoom-r.tileID.overscaledZ),h=n*r.queryPadding*e.N/r.tileSize/m,g=[o.getTilePoint(new e.U(u,d)),o.getTilePoint(new e.U(f,p))];if(g[0].x-h<e.N&&g[0].y-h<e.N&&g[1].x+h>=0&&g[1].y+h>=0){let e=s.map((e=>o.getTilePoint(e))),t=c.map((e=>o.getTilePoint(e)));i.push({tile:r,tileID:o,queryGeometry:e,cameraQueryGeometry:t,scale:m})}}return i}getVisibleCoordinates(e){let t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(let e of t)e.posMatrix=this.transform.calculatePosMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(de(this._source.type)){let t=e.h.now();for(let e in this._tiles)if(this._tiles[e].fadeEndTime>=t)return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e||=`_geojsonTileLayer`,t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e||=`_geojsonTileLayer`,t,n)}getFeatureState(e,t){return this._state.getState(e||=`_geojsonTileLayer`,t)}setDependencies(e,t,n){let r=this._tiles[e];r&&r.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(let n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(n,`reloading`);this._cache.filter((n=>!n.hasDependency(e,t)))}}function ue(e,t){let n=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function de(e){return e===`raster`||e===`image`||e===`video`}le.maxOverzooming=10,le.maxUnderzooming=3;let U=`mapboxgl_preloaded_worker_pool`;class fe{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<fe.workerCount;)this.workers.push(new Worker(e.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[U]}numActive(){return Object.keys(this.active).length}}let pe=Math.floor(e.h.hardwareConcurrency/2),me;function W(){return me||=new fe,me}fe.workerCount=e.ac(globalThis)?Math.max(Math.min(pe,3),1):1;class he{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=e.ad(t,0,1);let n=1,r=this._distances[n],i=t*this.paddedLength+this.padding;for(;r<i&&n<this._distances.length;)r=this._distances[++n];let a=n-1,o=this._distances[a],s=r-o,c=s>0?(i-o)/s:0;return this.points[a].mult(1-c).add(this.points[n].mult(c))}}function ge(e,t){let n=!0;return e===`always`||e!==`never`&&t!==`never`||(n=!1),n}class _e{constructor(e,t,n){let r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}insertCircle(e,t,n,r){this._forEachCell(t-r,n-r,t+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(r)}_insertBoxCell(e,t,n,r,i,a){this.boxCells[i].push(a)}_insertCircleCell(e,t,n,r,i,a){this.circleCells[i].push(a)}_query(e,t,n,r,i,a,o){if(n<0||e>this.width||r<0||t>this.height)return[];let s=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return[{key:null,x1:e,y1:t,x2:n,y2:r}];for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){let t=this.circles[3*e],n=this.circles[3*e+1],r=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-r,y1:n-r,x2:t+r,y2:n+r})}}else this._forEachCell(e,t,n,r,this._queryCell,s,{hitTest:i,overlapMode:a,seenUids:{box:{},circle:{}}},o);return s}query(e,t,n,r){return this._query(e,t,n,r,!1,null)}hitTest(e,t,n,r,i,a){return this._query(e,t,n,r,!0,i,a).length>0}hitTestCircle(e,t,n,r,i){let a=e-n,o=e+n,s=t-n,c=t+n;if(o<0||a>this.width||c<0||s>this.height)return!1;let l=[];return this._forEachCell(a,s,o,c,this._queryCellCircle,l,{hitTest:!0,overlapMode:r,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},i),l.length>0}_queryCell(e,t,n,r,i,a,o,s){let{seenUids:c,hitTest:l,overlapMode:u}=o,d=this.boxCells[i];if(d!==null){let i=this.bboxes;for(let o of d)if(!c.box[o]){c.box[o]=!0;let d=4*o,f=this.boxKeys[o];if(e<=i[d+2]&&t<=i[d+3]&&n>=i[d+0]&&r>=i[d+1]&&(!s||s(f))&&(!l||!ge(u,f.overlapMode))&&(a.push({key:f,x1:i[d],y1:i[d+1],x2:i[d+2],y2:i[d+3]}),l))return!0}}let f=this.circleCells[i];if(f!==null){let i=this.circles;for(let o of f)if(!c.circle[o]){c.circle[o]=!0;let d=3*o,f=this.circleKeys[o];if(this._circleAndRectCollide(i[d],i[d+1],i[d+2],e,t,n,r)&&(!s||s(f))&&(!l||!ge(u,f.overlapMode))){let e=i[d],t=i[d+1],n=i[d+2];if(a.push({key:f,x1:e-n,y1:t-n,x2:e+n,y2:t+n}),l)return!0}}}return!1}_queryCellCircle(e,t,n,r,i,a,o,s){let{circle:c,seenUids:l,overlapMode:u}=o,d=this.boxCells[i];if(d!==null){let e=this.bboxes;for(let t of d)if(!l.box[t]){l.box[t]=!0;let n=4*t,r=this.boxKeys[t];if(this._circleAndRectCollide(c.x,c.y,c.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!s||s(r))&&!ge(u,r.overlapMode))return a.push(!0),!0}}let f=this.circleCells[i];if(f!==null){let e=this.circles;for(let t of f)if(!l.circle[t]){l.circle[t]=!0;let n=3*t,r=this.circleKeys[t];if(this._circlesCollide(e[n],e[n+1],e[n+2],c.x,c.y,c.radius)&&(!s||s(r))&&!ge(u,r.overlapMode))return a.push(!0),!0}}}_forEachCell(e,t,n,r,i,a,o,s){let c=this._convertToXCellCoord(e),l=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),d=this._convertToYCellCoord(r);for(let f=c;f<=u;f++)for(let c=l;c<=d;c++)if(i.call(this,e,t,n,r,this.xCellCount*c+f,a,o,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,r,i,a){let o=r-e,s=i-t,c=n+a;return c*c>o*o+s*s}_circleAndRectCollide(e,t,n,r,i,a,o){let s=(a-r)/2,c=Math.abs(e-(r+s));if(c>s+n)return!1;let l=(o-i)/2,u=Math.abs(t-(i+l));if(u>l+n)return!1;if(c<=s||u<=l)return!0;let d=c-s,f=u-l;return d*d+f*f<=n*n}}function G(t,n,r,i,a){let o=e.Z();return n?(e.a0(o,o,[1/a,1/a,1]),r||e.ae(o,o,i.angle)):e.a1(o,i.labelPlaneMatrix,t),o}function K(t,n,r,i,a){if(n){let n=e.af(t);return e.a0(n,n,[a,a,1]),r||e.ae(n,n,-i.angle),n}return i.glCoordMatrix}function ve(t,n,r){let i;r?(i=[t.x,t.y,r(t.x,t.y),1],e.ag(i,i,n)):(i=[t.x,t.y,0,1],Me(i,i,n));let a=i[3];return{point:new e.P(i[0]/a,i[1]/a),signedDistanceFromCamera:a}}function ye(e,t){return .5+e/t*.5}function be(e,t){let n=e[0]/e[3],r=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&r>=-t[1]&&r<=t[1]}function xe(t,n,r,i,a,o,s,c,l,u){let d=i?t.textSizeData:t.iconSizeData,f=e.ah(d,r.transform.zoom),p=[256/r.width*2+1,256/r.height*2+1],m=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;m.clear();let h=t.lineVertexArray,g=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,_=r.transform.width/r.transform.height,v=!1;for(let i=0;i<g.length;i++){let y=g.get(i);if(y.hidden||y.writingMode===e.ai.vertical&&!v){je(y.numGlyphs,m);continue}let b;if(v=!1,u?(b=[y.anchorX,y.anchorY,u(y.anchorX,y.anchorY),1],e.ag(b,b,n)):(b=[y.anchorX,y.anchorY,0,1],Me(b,b,n)),!be(b,p)){je(y.numGlyphs,m);continue}let x=ye(r.transform.cameraToCenterDistance,b[3]),S=e.aj(d,f,y),C=s?S/x:S*x,w=new e.P(y.anchorX,y.anchorY),E=ve(w,a,u).point,D={projections:{},offsets:{}},O=we(y,C,!1,c,n,a,o,t.glyphOffsetArray,h,m,E,w,D,_,l,u);v=O.useVertical,(O.notEnoughRoom||v||O.needsFlipping&&we(y,C,!0,c,n,a,o,t.glyphOffsetArray,h,m,E,w,D,_,l,u).notEnoughRoom)&&je(y.numGlyphs,m)}i?t.text.dynamicLayoutVertexBuffer.updateData(m):t.icon.dynamicLayoutVertexBuffer.updateData(m)}function Se(e,t,n,r,i,a,o,s,c,l,u,d,f){let p=s.glyphStartIndex+s.numGlyphs,m=s.lineStartIndex,h=s.lineStartIndex+s.lineLength,g=t.getoffsetX(s.glyphStartIndex),_=t.getoffsetX(p-1),v=ke(e*g,n,r,i,a,o,s.segment,m,h,c,l,u,d,f);if(!v)return null;let y=ke(e*_,n,r,i,a,o,s.segment,m,h,c,l,u,d,f);return y?{first:v,last:y}:null}function Ce(t,n,r,i){return t===e.ai.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(t===e.ai.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function we(t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g){let _=n/24,v=t.lineOffsetX*_,y=t.lineOffsetY*_,b;if(t.numGlyphs>1){let e=t.glyphStartIndex+t.numGlyphs,n=t.lineStartIndex,a=t.lineStartIndex+t.lineLength,u=Se(_,c,v,y,r,d,f,t,l,o,p,h,g);if(!u)return{notEnoughRoom:!0};let x=ve(u.first.point,s,g).point,S=ve(u.last.point,s,g).point;if(i&&!r){let e=Ce(t.writingMode,x,S,m);if(e)return e}b=[u.first];for(let i=t.glyphStartIndex+1;i<e-1;i++)b.push(ke(_*c.getoffsetX(i),v,y,r,d,f,t.segment,n,a,l,o,p,h,g));b.push(u.last)}else{if(i&&!r){let n=ve(f,a,g).point,r=t.lineStartIndex+t.segment+1,i=new e.P(l.getx(r),l.gety(r)),o=ve(i,a,g),s=o.signedDistanceFromCamera>0?o.point:Te(f,i,n,1,a,g),c=Ce(t.writingMode,n,s,m);if(c)return c}let n=ke(_*c.getoffsetX(t.glyphStartIndex),v,y,r,d,f,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,l,o,p,h,g);if(!n)return{notEnoughRoom:!0};b=[n]}for(let t of b)e.ak(u,t.point,t.angle);return{}}function Te(e,t,n,r,i,a){let o=ve(e.add(e.sub(t)._unit()),i,a).point,s=n.sub(o);return n.add(s._mult(r/s.mag()))}function Ee(t,n){let{projectionCache:r,lineVertexArray:i,labelPlaneMatrix:a,tileAnchorPoint:o,distanceFromAnchor:s,getElevation:c,previousVertex:l,direction:u,absOffsetX:d}=n;if(r.projections[t])return r.projections[t];let f=new e.P(i.getx(t),i.gety(t)),p=ve(f,a,c);if(p.signedDistanceFromCamera>0)return r.projections[t]=p.point,p.point;let m=t-u;return Te(s===0?o:new e.P(i.getx(m),i.gety(m)),f,l,d-s+1,a,c)}function De(e,t,n){return e._unit()._perp()._mult(t*n)}function Oe(t,n,r,i,a,o,s,c){let{projectionCache:l,direction:u}=c;if(l.offsets[t])return l.offsets[t];let d=r.add(n);if(t+u<i||t+u>=a)return l.offsets[t]=d,d;let f=Ee(t+u,c),p=De(f.sub(r),s,u),m=r.add(p),h=f.add(p);return l.offsets[t]=e.al(o,d,m,h)||d,l.offsets[t]}function ke(e,t,n,r,i,a,o,s,c,l,u,d,f,p){let m=r?e-t:e+t,h=m>0?1:-1,g=0;r&&(h*=-1,g=Math.PI),h<0&&(g+=Math.PI);let _,v,y=h>0?s+o:s+o+1,b=i,x=i,S=0,C=0,w=Math.abs(m),E=[],D;for(;S+C<=w;){if(y+=h,y<s||y>=c)return null;S+=C,x=b,v=_;let e={projectionCache:d,lineVertexArray:l,labelPlaneMatrix:u,tileAnchorPoint:a,distanceFromAnchor:S,getElevation:p,previousVertex:x,direction:h,absOffsetX:w};if(b=Ee(y,e),n===0)E.push(x),D=b.sub(x);else{let t,r=b.sub(x);t=r.mag()===0?De(Ee(y+h,e).sub(b),n,h):De(r,n,h),v||=x.add(t),_=Oe(y,t,b,s,c,v,n,e),E.push(v),D=_.sub(v)}C=D.mag()}let O=D._mult((w-S)/C)._add(v||x),k=g+Math.atan2(b.y-x.y,b.x-x.x);return E.push(O),{point:O,angle:f?k:0,path:E}}let Ae=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function je(e,t){for(let n=0;n<e;n++){let e=t.length;t.resize(e+4),t.float32.set(Ae,3*e)}}function Me(e,t,n){let r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e[3]=n[3]*r+n[7]*i+n[15],e}class Ne{constructor(e,t=new _e(e.width+200,e.height+200,25),n=new _e(e.width+200,e.height+200,25)){this.transform=e,this.grid=t,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,t,n,r,i,a){let o=this.projectAndGetPerspectiveRatio(r,e.anchorPointX,e.anchorPointY,a),s=n*o.perspectiveRatio,c=e.x1*s+o.point.x,l=e.y1*s+o.point.y,u=e.x2*s+o.point.x,d=e.y2*s+o.point.y;return!this.isInsideGrid(c,l,u,d)||t!==`always`&&this.grid.hitTest(c,l,u,d,t,i)||o.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[c,l,u,d],offscreen:this.isOffscreen(c,l,u,d)}}placeCollisionCircles(t,n,r,i,a,o,s,c,l,u,d,f,p,m){let h=[],g=new e.P(n.anchorX,n.anchorY),_=ve(g,o,m),v=ye(this.transform.cameraToCenterDistance,_.signedDistanceFromCamera),y=(u?a/v:a*v)/e.ap,b=ve(g,s,m).point,x=Se(y,i,n.lineOffsetX*y,n.lineOffsetY*y,!1,b,g,n,r,s,{projections:{},offsets:{}},!1,m),S=!1,C=!1,w=!0;if(x){let n=.5*f*v+p,r=new e.P(-100,-100),i=new e.P(this.screenRightBoundary,this.screenBottomBoundary),a=new he,o=x.first,s=x.last,u=[];for(let e=o.path.length-1;e>=1;e--)u.push(o.path[e]);for(let e=1;e<s.path.length;e++)u.push(s.path[e]);let g=2.5*n;if(c){let e=u.map((e=>ve(e,c,m)));u=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let _=[];if(u.length>0){let t=u[0].clone(),n=u[0].clone();for(let e=1;e<u.length;e++)t.x=Math.min(t.x,u[e].x),t.y=Math.min(t.y,u[e].y),n.x=Math.max(n.x,u[e].x),n.y=Math.max(n.y,u[e].y);_=t.x>=r.x&&n.x<=i.x&&t.y>=r.y&&n.y<=i.y?[u]:n.x<r.x||t.x>i.x||n.y<r.y||t.y>i.y?[]:e.am([u],r.x,r.y,i.x,i.y)}for(let e of _){a.reset(e,.25*n);let r=0;r=a.length<=.5*n?1:Math.ceil(a.paddedLength/g)+1;for(let e=0;e<r;e++){let i=e/Math.max(r-1,1),o=a.lerp(i),s=o.x+100,c=o.y+100;h.push(s,c,n,0);let u=s-n,f=c-n,p=s+n,m=c+n;if(w&&=this.isOffscreen(u,f,p,m),C||=this.isInsideGrid(u,f,p,m),t!==`always`&&this.grid.hitTestCircle(s,c,n,t,d)&&(S=!0,!l))return{circles:[],offscreen:!1,collisionDetected:S}}}}return{circles:!l&&S||!C||v<this.perspectiveRatioCutoff?[]:h,offscreen:w,collisionDetected:S}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let n=[],r=1/0,i=1/0,a=-1/0,o=-1/0;for(let s of t){let t=new e.P(s.x+100,s.y+100);r=Math.min(r,t.x),i=Math.min(i,t.y),a=Math.max(a,t.x),o=Math.max(o,t.y),n.push(t)}let s=this.grid.query(r,i,a,o).concat(this.ignoredGrid.query(r,i,a,o)),c={},l={};for(let t of s){let r=t.key;if(c[r.bucketInstanceId]===void 0&&(c[r.bucketInstanceId]={}),c[r.bucketInstanceId][r.featureIndex])continue;let i=[new e.P(t.x1,t.y1),new e.P(t.x2,t.y1),new e.P(t.x2,t.y2),new e.P(t.x1,t.y2)];e.an(n,i)&&(c[r.bucketInstanceId][r.featureIndex]=!0,l[r.bucketInstanceId]===void 0&&(l[r.bucketInstanceId]=[]),l[r.bucketInstanceId].push(r.featureIndex))}return l}insertCollisionBox(e,t,n,r,i,a){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:i,collisionGroupID:a,overlapMode:t},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,r,i,a){let o=n?this.ignoredGrid:this.grid,s={bucketInstanceId:r,featureIndex:i,collisionGroupID:a,overlapMode:t};for(let t=0;t<e.length;t+=4)o.insertCircle(s,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,n,r,i){let a;return i?(a=[n,r,i(n,r),1],e.ag(a,a,t)):(a=[n,r,0,1],Me(a,a,t)),{point:new e.P((a[0]/a[3]+1)/2*this.transform.width+100,(-a[1]/a[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/a[3]*.5}}isOffscreen(e,t,n,r){return n<100||e>=this.screenRightBoundary||r<100||t>this.screenBottomBoundary}isInsideGrid(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){let t=e.ao([]);return e.$(t,t,[-100,-100,0]),t}}function Pe(t,n,r){return n*(e.N/(t.tileSize*2**(r-t.tileID.overscaledZ)))}class Fe{constructor(e,t,n,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&n?1:0,this.placed=n}isHidden(){return this.opacity===0&&!this.placed}}class Ie{constructor(e,t,n,r,i){this.text=new Fe(e?e.text:null,t,n,i),this.icon=new Fe(e?e.icon:null,t,r,i)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Le{constructor(e,t,n){this.text=e,this.icon=t,this.skipFade=n}}class q{constructor(){this.invProjMatrix=e.Z(),this.viewportMatrix=e.Z(),this.circles=[]}}class Re{constructor(e,t,n,r,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i}}class ze{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Be(t,n,r,i,a){let{horizontalAlign:o,verticalAlign:s}=e.au(t);return new e.P(-(o-.5)*n+i[0]*a,-(s-.5)*r+i[1]*a)}function Ve(t,n,r,i,a,o){let{x1:s,x2:c,y1:l,y2:u,anchorPointX:d,anchorPointY:f}=t,p=new e.P(n,r);return i&&p._rotate(a?o:-o),{x1:s+p.x,y1:l+p.y,x2:c+p.x,y2:u+p.y,anchorPointX:d,anchorPointY:f}}class He{constructor(e,t,n,r,i){this.transform=e.clone(),this.terrain=t,this.collisionIndex=new Ne(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new ze(r),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,r,i){let a=r.getBucket(n),o=r.latestFeatureIndex;if(!a||!o||n.id!==a.layerIds[0])return;let s=r.collisionBoxArray,c=a.layers[0].layout,l=2**(this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/e.N,d=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),f=c.get(`text-pitch-alignment`)===`map`,p=c.get(`text-rotation-alignment`)===`map`,m=Pe(r,1,this.transform.zoom),h=G(d,f,p,this.transform,m),g=null;if(f){let t=K(d,f,p,this.transform,m);g=e.a1([],this.transform.labelPlaneMatrix,t)}this.retainedQueryData[a.bucketInstanceId]=new Re(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,r.tileID);let _={bucket:a,layout:c,posMatrix:d,textLabelPlaneMatrix:h,labelToScreenMatrix:g,scale:l,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:e.ah(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(i)for(let e of a.sortKeyRanges){let{sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i}=e;t.push({sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i,parameters:_})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:_})}attemptAnchorPlacement(t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g){let _=e.aq[t.textAnchor],v=[t.textOffset0,t.textOffset1],y=Be(_,r,i,v,a),b=this.collisionIndex.placeCollisionBox(Ve(n,y.x,y.y,o,s,this.transform.angle),d,c,l,u.predicate,g);if((!h||this.collisionIndex.placeCollisionBox(Ve(h,y.x,y.y,o,s,this.transform.angle),d,c,l,u.predicate,g).box.length!==0)&&b.box.length>0){let e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID].text&&(e=this.prevPlacement.variableOffsets[f.crossTileID].anchor),f.crossTileID===0)throw Error(`symbolInstance.crossTileID can't be 0`);return this.variableOffsets[f.crossTileID]={textOffset:v,width:r,height:i,anchor:_,textBoxScale:a,prevAnchor:e},this.markUsedJustification(p,_,f,m),p.allowVerticalPlacement&&(this.markUsedOrientation(p,m,f),this.placedOrientations[f.crossTileID]=m),{shift:y,placedGlyphBoxes:b}}}placeLayerBucketPart(t,n,r){let{bucket:i,layout:a,posMatrix:o,textLabelPlaneMatrix:s,labelToScreenMatrix:c,textPixelRatio:l,holdingForFade:u,collisionBoxArray:d,partiallyEvaluatedTextSize:f,collisionGroup:p}=t.parameters,m=a.get(`text-optional`),h=a.get(`icon-optional`),g=e.ar(a,`text-overlap`,`text-allow-overlap`),_=g===`always`,v=e.ar(a,`icon-overlap`,`icon-allow-overlap`),y=v===`always`,b=a.get(`text-rotation-alignment`)===`map`,x=a.get(`text-pitch-alignment`)===`map`,S=a.get(`icon-text-fit`)!==`none`,C=a.get(`symbol-z-order`)===`viewport-y`,w=_&&(y||!i.hasIconData()||h),E=y&&(_||!i.hasTextData()||m);!i.collisionArrays&&d&&i.deserializeCollisionBoxes(d);let D=this.retainedQueryData[i.bucketInstanceId].tileID,O=this.terrain?(e,t)=>this.terrain.getElevation(D,e,t):null,k=(t,d)=>{if(n[t.crossTileID])return;if(u)return void(this.placements[t.crossTileID]=new Le(!1,!1,!1));let y=!1,C=!1,D=!0,k=null,A={box:null,offscreen:null},j={box:null,offscreen:null},M=null,N=null,P=null,F=0,I=0,ee=0;d.textFeatureIndex?F=d.textFeatureIndex:t.useRuntimeCollisionCircles&&(F=t.featureIndex),d.verticalTextFeatureIndex&&(I=d.verticalTextFeatureIndex);let R=d.textBox;if(R){let n=n=>{let r=e.ai.horizontal;if(i.allowVerticalPlacement&&!n&&this.prevPlacement){let e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,r=e,this.markUsedOrientation(i,r,t))}return r},r=(n,r)=>{if(i.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&d.verticalTextBox){for(let t of i.writingModes)if(t===e.ai.vertical?(A=r(),j=A):A=n(),A&&A.box&&A.box.length)break}else A=n()},a=t.textAnchorOffsetStartIndex,s=t.textAnchorOffsetEndIndex;if(s===a){let a=(e,n)=>{let r=this.collisionIndex.placeCollisionBox(e,g,l,o,p.predicate,O);return r&&r.box&&r.box.length&&(this.markUsedOrientation(i,n,t),this.placedOrientations[t.crossTileID]=n),r};r((()=>a(R,e.ai.horizontal)),(()=>{let n=d.verticalTextBox;return i.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&n?a(n,e.ai.vertical):{box:null,offscreen:null}})),n(A&&A.box&&A.box.length)}else{let c=e.aq[this.prevPlacement?.variableOffsets[t.crossTileID]?.anchor],u=(e,n,r)=>{let u=e.x2-e.x1,d=e.y2-e.y1,f=t.textBoxScale,m=S&&v===`never`?n:null,h={box:[],offscreen:!1},_=g===`never`?1:2,C=`never`;c&&_++;for(let n=0;n<_;n++){for(let n=a;n<s;n++){let a=i.textAnchorOffsets.get(n);if(c&&a.textAnchor!==c)continue;let s=this.attemptAnchorPlacement(a,e,u,d,f,b,x,l,o,p,C,t,i,r,m,O);if(s&&(h=s.placedGlyphBoxes,h&&h.box&&h.box.length))return y=!0,k=s.shift,h}c?c=null:C=g}return h};r((()=>u(R,d.iconBox,e.ai.horizontal)),(()=>{let n=d.verticalTextBox;return i.allowVerticalPlacement&&!(A&&A.box&&A.box.length)&&t.numVerticalGlyphVertices>0&&n?u(n,d.verticalIconBox,e.ai.vertical):{box:null,offscreen:null}})),A&&(y=A.box,D=A.offscreen);let f=n(A&&A.box);if(!y&&this.prevPlacement){let e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(i,e.anchor,t,f))}}}if(M=A,y=M&&M.box&&M.box.length>0,D=M&&M.offscreen,t.useRuntimeCollisionCircles){let n=i.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),l=e.aj(i.textSizeData,f,n),u=a.get(`text-padding`);N=this.collisionIndex.placeCollisionCircles(g,n,i.lineVertexArray,i.glyphOffsetArray,l,o,s,c,r,x,p.predicate,t.collisionCircleDiameter,u,O),N.circles.length&&N.collisionDetected&&!r&&e.w(`Collisions detected, but collision boxes are not shown`),y=_||N.circles.length>0&&!N.collisionDetected,D&&=N.offscreen}if(d.iconFeatureIndex&&(ee=d.iconFeatureIndex),d.iconBox){let e=e=>{let t=S&&k?Ve(e,k.x,k.y,b,x,this.transform.angle):e;return this.collisionIndex.placeCollisionBox(t,v,l,o,p.predicate,O)};j&&j.box&&j.box.length&&d.verticalIconBox?(P=e(d.verticalIconBox),C=P.box.length>0):(P=e(d.iconBox),C=P.box.length>0),D&&=P.offscreen}let z=m||t.numHorizontalGlyphVertices===0&&t.numVerticalGlyphVertices===0,B=h||t.numIconVertices===0;if(z||B?B?z||(C&&=y):y=C&&y:C=y=C&&y,y&&M&&M.box&&this.collisionIndex.insertCollisionBox(M.box,g,a.get(`text-ignore-placement`),i.bucketInstanceId,j&&j.box&&I?I:F,p.ID),C&&P&&this.collisionIndex.insertCollisionBox(P.box,v,a.get(`icon-ignore-placement`),i.bucketInstanceId,ee,p.ID),N&&(y&&this.collisionIndex.insertCollisionCircles(N.circles,g,a.get(`text-ignore-placement`),i.bucketInstanceId,F,p.ID),r)){let e=i.bucketInstanceId,t=this.collisionCircleArrays[e];t===void 0&&(t=this.collisionCircleArrays[e]=new q);for(let e=0;e<N.circles.length;e+=4)t.circles.push(N.circles[e+0]),t.circles.push(N.circles[e+1]),t.circles.push(N.circles[e+2]),t.circles.push(N.collisionDetected?1:0)}if(t.crossTileID===0)throw Error(`symbolInstance.crossTileID can't be 0`);if(i.bucketInstanceId===0)throw Error(`bucket.bucketInstanceId can't be 0`);this.placements[t.crossTileID]=new Le(y||w,C||E,D||i.justReloaded),n[t.crossTileID]=!0};if(C){if(t.symbolInstanceStart!==0)throw Error(`bucket.bucketInstanceId should be 0`);let e=i.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){let n=e[t];k(i.symbolInstances.get(n),i.collisionArrays[n])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)k(i.symbolInstances.get(e),i.collisionArrays[e]);if(r&&i.bucketInstanceId in this.collisionCircleArrays){let t=this.collisionCircleArrays[i.bucketInstanceId];e.as(t.invProjMatrix,o),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}i.justReloaded=!1}markUsedJustification(t,n,r,i){let a;a=i===e.ai.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[e.at(n)];let o=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(let e of o)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=a>=0&&e!==a?0:r.crossTileID)}markUsedOrientation(t,n,r){let i=n===e.ai.horizontal||n===e.ai.horizontalOnly?n:0,a=n===e.ai.vertical?n:0,o=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(let e of o)t.text.placedSymbolArray.get(e).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=a)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let t=this.prevPlacement,n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;let r=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(let e in this.placements){let t=this.placements[e],a=i[e];a?(this.opacities[e]=new Ie(a,r,t.text,t.icon),n=n||t.text!==a.text.placed||t.icon!==a.icon.placed):(this.opacities[e]=new Ie(null,r,t.text,t.icon,t.skipFade),n=n||t.text||t.icon)}for(let e in i){let t=i[e];if(!this.opacities[e]){let i=new Ie(t,r,!1,!1);i.isHidden()||(this.opacities[e]=i,n=n||t.text.placed||t.icon.placed)}}for(let e in a)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=a[e]);for(let e in o)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=o[e]);if(t&&t.lastPlacementChangeTime===void 0)throw Error(`Last placement time for previous placement is not defined`);n?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!=`number`&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){let n={};for(let r of t){let t=r.getBucket(e);t&&r.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,n,r.collisionBoxArray)}}updateBucketOpacities(t,n,r){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let i=t.layers[0],a=i.layout,o=new Ie(null,0,!1,!1,!0),s=a.get(`text-allow-overlap`),c=a.get(`icon-allow-overlap`),l=i._unevaluatedLayout.hasValue(`text-variable-anchor`)||i._unevaluatedLayout.hasValue(`text-variable-anchor-offset`),u=a.get(`text-rotation-alignment`)===`map`,d=a.get(`text-pitch-alignment`)===`map`,f=a.get(`icon-text-fit`)!==`none`,p=new Ie(null,0,s&&(c||!t.hasIconData()||a.get(`icon-optional`)),c&&(s||!t.hasTextData()||a.get(`text-optional`)),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);let m=(e,t,n)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(n);e.hasVisibleVertices=e.hasVisibleVertices||n!==Ye};for(let r=0;r<t.symbolInstances.length;r++){let i=t.symbolInstances.get(r),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:s,crossTileID:c}=i,h=this.opacities[c];n[c]?h=o:h||(h=p,this.opacities[c]=h),n[c]=!0;let g=i.numIconVertices>0,_=this.placedOrientations[i.crossTileID],v=_===e.ai.vertical,y=_===e.ai.horizontal||_===e.ai.horizontalOnly;if(a>0||s>0){let e=Je(h.text);m(t.text,a,v?Ye:e),m(t.text,s,y?Ye:e);let n=h.text.isHidden();[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=n||v?1:0)})),i.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).hidden=n||y?1:0);let r=this.variableOffsets[i.crossTileID];r&&this.markUsedJustification(t,r.anchor,i,_);let o=this.placedOrientations[i.crossTileID];o&&(this.markUsedJustification(t,`left`,i,o),this.markUsedOrientation(t,o,i))}if(g){let e=Je(h.icon),n=!(f&&i.verticalPlacedIconSymbolIndex&&v);i.placedIconSymbolIndex>=0&&(m(t.icon,i.numIconVertices,n?e:Ye),t.icon.placedSymbolArray.get(i.placedIconSymbolIndex).hidden=h.icon.isHidden()),i.verticalPlacedIconSymbolIndex>=0&&(m(t.icon,i.numVerticalIconVertices,n?Ye:e),t.icon.placedSymbolArray.get(i.verticalPlacedIconSymbolIndex).hidden=h.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let n=t.collisionArrays[r];if(n){let r=new e.P(0,0);if(n.textBox||n.verticalTextBox){let e=!0;if(l){let t=this.variableOffsets[c];t?(r=Be(t.anchor,t.width,t.height,t.textOffset,t.textBoxScale),u&&r._rotate(d?this.transform.angle:-this.transform.angle)):e=!1}n.textBox&&Ue(t.textCollisionBox.collisionVertexArray,h.text.placed,!e||v,r.x,r.y),n.verticalTextBox&&Ue(t.textCollisionBox.collisionVertexArray,h.text.placed,!e||y,r.x,r.y)}let i=!!(!y&&n.verticalIconBox);n.iconBox&&Ue(t.iconCollisionBox.collisionVertexArray,h.icon.placed,i,f?r.x:0,f?r.y:0),n.verticalIconBox&&Ue(t.iconCollisionBox.collisionVertexArray,h.icon.placed,!i,f?r.x:0,f?r.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){let e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){let n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function Ue(e,t,n,r,i){e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0)}let We=2**25,Ge=2**24,Ke=2**17,qe=2**16;function Je(e){if(e.opacity===0&&!e.placed)return 0;if(e.opacity===1&&e.placed)return 4294967295;let t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*We+t*Ge+n*Ke+t*qe+n*512+t*256+n*2+t}let Ye=0;class Xe{constructor(e){this._sortAcrossTiles=e.layout.get(`symbol-z-order`)!==`viewport-y`&&!e.layout.get(`symbol-sort-key`).isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,n,r,i){let a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<a.length;)if(t.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1}}class Ze{constructor(e,t,n,r,i,a,o,s){this.placement=new He(e,t,a,o,s),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(t,n,r){let i=e.h.now(),a=()=>!this._forceFullPlacement&&e.h.now()-i>2;for(;this._currentPlacementIndex>=0;){let e=n[t[this._currentPlacementIndex]],i=this.placement.collisionIndex.transform.zoom;if(e.type===`symbol`&&(!e.minzoom||e.minzoom<=i)&&(!e.maxzoom||e.maxzoom>i)){if(this._inProgressLayer||=new Xe(e),this._inProgressLayer.continuePlacement(r[e.source],this.placement,this._showCollisionBoxes,e,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let Qe=512/e.N/2;class $e{constructor(t,n,r){this.tileID=t,this.bucketInstanceId=r,this._symbolsByKey={};let i=new Map;for(let e=0;e<n.length;e++){let t=n.get(e),r=t.key,a=i.get(r);a?a.push(t):i.set(r,[t])}for(let[t,n]of i){let r={positions:n.map((e=>({x:Math.floor(e.anchorX*Qe),y:Math.floor(e.anchorY*Qe)}))),crossTileIDs:n.map((e=>e.crossTileID))};if(r.positions.length>128){let t=new e.av(r.positions.length,16,Uint16Array);for(let{x:e,y:n}of r.positions)t.add(e,n);t.finish(),delete r.positions,r.index=t}this._symbolsByKey[t]=r}}getScaledCoordinates(t,n){let{x:r,y:i,z:a}=this.tileID.canonical,{x:o,y:s,z:c}=n.canonical,l=Qe/2**(c-a),u=(s*e.N+t.anchorY)*l,d=i*e.N*Qe;return{x:Math.floor((o*e.N+t.anchorX)*l-r*e.N*Qe),y:Math.floor(u-d)}}findMatches(e,t,n){let r=this.tileID.canonical.z<t.canonical.z?1:2**(this.tileID.canonical.z-t.canonical.z);for(let i=0;i<e.length;i++){let a=e.get(i);if(a.crossTileID)continue;let o=this._symbolsByKey[a.key];if(!o)continue;let s=this.getScaledCoordinates(a,t);if(o.index){let e=o.index.range(s.x-r,s.y-r,s.x+r,s.y+r).sort();for(let t of e){let e=o.crossTileIDs[t];if(!n[e]){n[e]=!0,a.crossTileID=e;break}}}else if(o.positions)for(let e=0;e<o.positions.length;e++){let t=o.positions[e],i=o.crossTileIDs[e];if(Math.abs(t.x-s.x)<=r&&Math.abs(t.y-s.y)<=r&&!n[i]){n[i]=!0,a.crossTileID=i;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class et{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class tt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let t=Math.round((e-this.lng)/360);if(t!==0)for(let e in this.indexes){let n=this.indexes[e],r={};for(let e in n){let i=n[e];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),r[i.tileID.key]=i}this.indexes[e]=r}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let r=this.usedCrossTileIDs[e.overscaledZ];for(let n in this.indexes){let i=this.indexes[n];if(Number(n)>e.overscaledZ)for(let n in i){let a=i[n];a.tileID.isChildOf(e)&&a.findMatches(t.symbolInstances,e,r)}else{let a=i[e.scaledTo(Number(n)).key];a&&a.findMatches(t.symbolInstances,e,r)}}for(let e=0;e<t.symbolInstances.length;e++){let i=t.symbolInstances.get(e);i.crossTileID||(i.crossTileID=n.generate(),r[i.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new $e(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(let n of t.getCrossTileIDsLists())for(let t of n)delete this.usedCrossTileIDs[e][t]}removeStaleBuckets(e){let t=!1;for(let n in this.indexes){let r=this.indexes[n];for(let i in r)e[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],t=!0)}return t}}class nt{constructor(){this.layerIndexes={},this.crossTileIDs=new et,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n){let r=this.layerIndexes[e.id];r===void 0&&(r=this.layerIndexes[e.id]=new tt);let i=!1,a={};r.handleWrapJump(n);for(let n of t){let t=n.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||=++this.maxBucketInstanceId,r.addBucket(n.tileID,t,this.crossTileIDs)&&(i=!0),a[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(a)&&(i=!0),i}pruneUnusedLayers(e){let t={};e.forEach((e=>{t[e]=!0}));for(let e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}let rt=(t,n)=>e.x(t,n&&n.filter((e=>e.identifier!==`source.canvas`))),it=e.F(e.ax,[`addLayer`,`removeLayer`,`setPaintProperty`,`setLayoutProperty`,`setFilter`,`addSource`,`removeSource`,`setLayerZoomRange`,`setLight`,`setTransition`,`setGeoJSONSourceData`,`setGlyphs`,`setSprite`]),at=e.F(e.ax,[`setCenter`,`setZoom`,`setBearing`,`setPitch`]),ot=e.aw();class st extends e.E{constructor(t,n={}){super(),this.map=t,this.dispatcher=new j(W(),this,t._getMapId()),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new E(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new A(256,512),this.crossTileSymbolIndex=new nt,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast(`setReferrer`,e.az());let r=this;this._rtlTextPluginCallback=st.registerForPluginStateChange((t=>{r.dispatcher.broadcast(`syncRTLPluginState`,{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,n)=>{if(e.aA(t),n&&n.every((e=>e)))for(let e in r.sourceCaches){let t=r.sourceCaches[e].getSource().type;t!==`vector`&&t!==`geojson`||r.sourceCaches[e].reload()}}))})),this.on(`data`,(e=>{if(e.dataType!==`source`||e.sourceDataType!==`metadata`)return;let t=this.sourceCaches[e.sourceId];if(!t)return;let n=t.getSource();if(n&&n.vectorLayerIds)for(let e in this._layers){let t=this._layers[e];t.source===n.id&&this._validateLayer(t)}}))}loadURL(t,n={},r){this.fire(new e.k(`dataloading`,{dataType:`style`})),n.validate=typeof n.validate!=`boolean`||n.validate;let i=this.map._requestManager.transformRequest(t,u.Style);this._request=e.f(i,((t,i)=>{this._request=null,t?this.fire(new e.j(t)):i&&this._load(i,n,r)}))}loadJSON(t,n={},r){this.fire(new e.k(`dataloading`,{dataType:`style`})),this._request=e.h.frame((()=>{this._request=null,n.validate=!1!==n.validate,this._load(t,n,r)}))}loadEmpty(){this.fire(new e.k(`dataloading`,{dataType:`style`})),this._load(ot,{validate:!1})}_load(t,n,r){let i=n.transformStyle?n.transformStyle(r,t):t;if(!n.validate||!rt(this,e.y(i))){this._loaded=!0,this.stylesheet=i;for(let e in i.sources)this.addSource(e,i.sources[e],{validate:!1});i.sprite?this._loadSprite(i.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(i.glyphs),this._createLayers(),this.light=new k(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain??null),this.fire(new e.k(`data`,{dataType:`style`})),this.fire(new e.k(`style.load`))}}_createLayers(){let t=e.aB(this.stylesheet.layers);this.dispatcher.broadcast(`setLayers`,t),this._order=t.map((e=>e.id)),this._layers={},this._serializedLayers=null;for(let n of t){let t=e.aC(n);t.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=t}}_loadSprite(t,n=!1,r=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(t,n,r,i){let a=_(t),o=a.length,s=r>1?`@2x`:``,c={},d={},f={};for(let{id:t,url:r}of a){let a=n.transformRequest(n.normalizeSpriteURL(r,s,`.json`),u.SpriteJSON),p=`${t}_${a.url}`;c[p]=e.f(a,((e,n)=>{delete c[p],d[t]=n,v(i,d,f,e,o)}));let m=n.transformRequest(n.normalizeSpriteURL(r,s,`.png`),u.SpriteImage),h=`${t}_${m.url}`;c[h]=l.getImage(m,((e,n)=>{delete c[h],f[t]=n,v(i,d,f,e,o)}))}return{cancel(){for(let e of Object.values(c))e.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.j(t));else if(i)for(let e in i){this._spritesImagesIds[e]=[];let t=this._spritesImagesIds[e]?this._spritesImagesIds[e].filter((e=>!(e in i))):[];for(let e of t)this.imageManager.removeImage(e),this._changedImages[e]=!0;for(let t in i[e]){let r=e===`default`?t:`${e}:${t}`;this._spritesImagesIds[e].push(r),r in this.imageManager.images?this.imageManager.updateImage(r,i[e][t],!1):this.imageManager.addImage(r,i[e][t]),n&&(this._changedImages[r]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast(`setImages`,this._availableImages),this.fire(new e.k(`data`,{dataType:`style`})),r&&r(t)}))}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast(`setImages`,this._availableImages),this.fire(new e.k(`data`,{dataType:`style`}))}_validateLayer(t){let n=this.sourceCaches[t.source];if(!n)return;let r=t.sourceLayer;if(!r)return;let i=n.getSource();(i.type===`geojson`||i.vectorLayerIds&&i.vectorLayerIds.indexOf(r)===-1)&&this.fire(new e.j(Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e){let t=this._serializedAllLayers();if(!e||e.length===0)return Object.values(t);let n=[];for(let r of e)t[r]&&n.push(t[r]);return n}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let t=Object.keys(this._layers);for(let n of t){let t=this._layers[n];t.type!==`custom`&&(e[n]=t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw Error(`Style is not done loading.`)}update(t){if(!this._loaded)return;let n=this._changed;if(this._changed){let e=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(e.length||n.length)&&this._updateWorkerLayers(e,n);for(let e in this._updatedSources){let t=this._updatedSources[e];if(t===`reload`)this._reloadSource(e);else{if(t!==`clear`)throw Error(`Invalid action ${t}`);this._clearSource(e)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}let r={};for(let e in this.sourceCaches){let t=this.sourceCaches[e];r[e]=t.used,t.used=!1}for(let e of this._order){let n=this._layers[e];n.recalculate(t,this._availableImages),!n.isHidden(t.zoom)&&n.source&&(this.sourceCaches[n.source].used=!0)}for(let t in r){let n=this.sourceCaches[t];r[t]!==n.used&&n.fire(new e.k(`data`,{sourceDataType:`visibility`,dataType:`source`,sourceId:t}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new e.k(`data`,{dataType:`style`}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies([`icons`,`patterns`],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies([`glyphs`],[``]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,t){this.dispatcher.broadcast(`updateLayers`,{layers:this._serializeByIds(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();let r=this.serialize();if(t=n.transformStyle?n.transformStyle(r,t):t,rt(this,e.y(t)))return!1;(t=e.aD(t)).layers=e.aB(t.layers);let i=e.aE(r,t).filter((e=>!(e.command in at)));if(i.length===0)return!1;let a=i.filter((e=>!(e.command in it)));if(a.length>0)throw Error(`Unimplemented: ${a.map((e=>e.command)).join(`, `)}.`);for(let e of i)e.command!==`setTransition`&&this[e.command].apply(this,e.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,n){if(this.getImage(t))return this.fire(new e.j(Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){if(!this.getImage(t))return this.fire(new e.j(Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast(`setImages`,this._availableImages),this.fire(new e.k(`data`,{dataType:`style`}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,r={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw Error(`Source "${t}" already exists.`);if(!n.type)throw Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(`, `)}.`);if([`vector`,`raster`,`geojson`,`video`,`image`].indexOf(n.type)>=0&&this._validate(e.y.source,`sources.${t}`,n,null,r))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);let i=this.sourceCaches[t]=new le(t,n,this.dispatcher);i.style=this,i.setEventedParent(this,(()=>({isSourceLoaded:i.loaded(),source:i.serialize(),sourceId:t}))),i.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw Error(`There is no source with this ID`);for(let n in this._layers)if(this._layers[n].source===t)return this.fire(new e.j(Error(`Source "${t}" cannot be removed while layer "${n}" is using it.`)));let n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new e.k(`data`,{sourceDataType:`metadata`,dataType:`source`,sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw Error(`There is no source with this ID=${e}`);let n=this.sourceCaches[e].getSource();if(n.type!==`geojson`)throw Error(`geojsonSource.type is ${n.type}, which is !== 'geojson`);n.setData(t),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(t,n,r={}){this._checkLoaded();let i=t.id;if(this.getLayer(i))return void this.fire(new e.j(Error(`Layer "${i}" already exists on this map.`)));let a;if(t.type===`custom`){if(rt(this,e.aF(t)))return;a=e.aC(t)}else{if(`source`in t&&typeof t.source==`object`&&(this.addSource(i,t.source),t=e.aD(t),t=e.e(t,{source:i})),this._validate(e.y.layer,`layers.${i}`,t,{arrayIndex:-1},r))return;a=e.aC(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:i}})}let o=n?this._order.indexOf(n):this._order.length;if(n&&o===-1)this.fire(new e.j(Error(`Cannot add layer "${i}" before non-existing layer "${n}".`)));else{if(this._order.splice(o,0,i),this._layerOrderChanged=!0,this._layers[i]=a,this._removedLayers[i]&&a.source&&a.type!==`custom`){let e=this._removedLayers[i];delete this._removedLayers[i],e.type===a.type?(this._updatedSources[a.source]=`reload`,this.sourceCaches[a.source].pause()):this._updatedSources[a.source]=`clear`}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.j(Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;let r=this._order.indexOf(t);this._order.splice(r,1);let i=n?this._order.indexOf(n):this._order.length;n&&i===-1?this.fire(new e.j(Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(i,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();let n=this._layers[t];if(!n)return void this.fire(new e.j(Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);let r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(t,n,r){this._checkLoaded();let i=this.getLayer(t);i?i.minzoom===n&&i.maxzoom===r||(n!=null&&(i.minzoom=n),r!=null&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new e.j(Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,r={}){this._checkLoaded();let i=this.getLayer(t);if(i){if(!e.aG(i.filter,n))return n==null?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(e.y.filter,`layers.${i.id}.filter`,n,null,r)||(i.filter=e.aD(n),this._updateLayer(i)))}else this.fire(new e.j(Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return e.aD(this.getLayer(t).filter)}setLayoutProperty(t,n,r,i={}){this._checkLoaded();let a=this.getLayer(t);a?e.aG(a.getLayoutProperty(n),r)||(a.setLayoutProperty(n,r,i),this._updateLayer(a)):this.fire(new e.j(Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){let r=this.getLayer(t);if(r)return r.getLayoutProperty(n);this.fire(new e.j(Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,r,i={}){this._checkLoaded();let a=this.getLayer(t);a?e.aG(a.getPaintProperty(n),r)||(a.setPaintProperty(n,r,i)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.j(Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(t,n){this._checkLoaded();let r=t.source,i=t.sourceLayer,a=this.sourceCaches[r];if(a===void 0)return void this.fire(new e.j(Error(`The source '${r}' does not exist in the map's style.`)));let o=a.getSource().type;o===`geojson`&&i?this.fire(new e.j(Error(`GeoJSON sources cannot have a sourceLayer parameter.`))):o!==`vector`||i?(t.id===void 0&&this.fire(new e.j(Error(`The feature id parameter must be provided.`))),a.setFeatureState(i,t.id,n)):this.fire(new e.j(Error(`The sourceLayer parameter must be provided for vector source types.`)))}removeFeatureState(t,n){this._checkLoaded();let r=t.source,i=this.sourceCaches[r];if(i===void 0)return void this.fire(new e.j(Error(`The source '${r}' does not exist in the map's style.`)));let a=i.getSource().type,o=a===`vector`?t.sourceLayer:void 0;a!==`vector`||o?n&&typeof t.id!=`string`&&typeof t.id!=`number`?this.fire(new e.j(Error(`A feature id is required to remove its specific state property.`))):i.removeFeatureState(o,t.id,n):this.fire(new e.j(Error(`The sourceLayer parameter must be provided for vector source types.`)))}getFeatureState(t){this._checkLoaded();let n=t.source,r=t.sourceLayer,i=this.sourceCaches[n];if(i!==void 0)return i.getSource().type!==`vector`||r?(t.id===void 0&&this.fire(new e.j(Error(`The feature id parameter must be provided.`))),i.getFeatureState(r,t.id)):void this.fire(new e.j(Error(`The sourceLayer parameter must be provided for vector source types.`)));this.fire(new e.j(Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return e.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let t=e.aH(this.sourceCaches,(e=>e.serialize())),n=this._serializeByIds(this._order),r=this.map.getTerrain()||void 0,i=this.stylesheet;return e.aI({version:i.version,name:i.name,metadata:i.metadata,light:i.light,center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch,sprite:i.sprite,glyphs:i.glyphs,transition:i.transition,sources:t,layers:n,terrain:r},(e=>e!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!==`raster`&&(this._updatedSources[e.source]=`reload`,this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let t=e=>this._layers[e].type===`fill-extrusion`,n={},r=[];for(let i=this._order.length-1;i>=0;i--){let a=this._order[i];if(t(a)){n[a]=i;for(let t of e){let e=t[a];if(e)for(let t of e)r.push(t)}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));let i=[];for(let a=this._order.length-1;a>=0;a--){let o=this._order[a];if(t(o))for(let e=r.length-1;e>=0;e--){let t=r[e].feature;if(n[t.layer.id]<a)break;i.push(t),r.pop()}else for(let t of e){let e=t[o];if(e)for(let t of e)i.push(t.feature)}}return i}queryRenderedFeatures(t,n,r){n&&n.filter&&this._validate(e.y.filter,`queryRenderedFeatures.filter`,n.filter,null,n);let i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.j(Error(`parameters.layers must be an Array.`))),[];for(let t of n.layers){let n=this._layers[t];if(!n)return this.fire(new e.j(Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];i[n.source]=!0}}let a=[];n.availableImages=this._availableImages;let o=this._serializedAllLayers();for(let e in this.sourceCaches)n.layers&&!i[e]||a.push(ae(this.sourceCaches[e],this._layers,o,t,n,r));return this.placement&&a.push(function(e,t,n,r,i,a,o){let s={},c=a.queryRenderedSymbols(r),l=[];for(let e of Object.keys(c).map(Number))l.push(o[e]);l.sort(oe);for(let n of l){let r=n.featureIndex.lookupSymbolFeatures(c[n.bucketInstanceId],t,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,e);for(let e in r){let t=s[e]=s[e]||[],i=r[e];i.sort(((e,t)=>{let r=n.featureSortOrder;if(r){let n=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-n}return t.featureIndex-e.featureIndex}));for(let e of i)t.push(e)}}for(let t in s)s[t].forEach((r=>{let i=r.feature,a=n[e[t].source].getFeatureState(i.layer[`source-layer`],i.id);i.source=i.layer.source,i.layer[`source-layer`]&&(i.sourceLayer=i.layer[`source-layer`]),i.state=a}));return s}(this._layers,o,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(a)}querySourceFeatures(t,n){n&&n.filter&&this._validate(e.y.filter,`querySourceFeatures.filter`,n.filter,null,n);let r=this.sourceCaches[t];return r?function(e,t){let n=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],i={};for(let e=0;e<n.length;e++){let a=n[e],o=a.tileID.canonical.key;i[o]||(i[o]=!0,a.querySourceFeatures(r,t))}return r}(r,n):[]}addSourceType(e,t,n){return V(e)?n(Error(`A source type called "${e}" already exists.`)):(((e,t)=>{re[e]=t})(e,t),t.workerSourceURL?void this.dispatcher.broadcast(`loadWorkerSource`,{name:e,url:t.workerSourceURL},n):n(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();let r=this.light.getLight(),i=!1;for(let n in t)if(!e.aG(t[n],r[n])){i=!0;break}if(!i)return;let a={now:e.h.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(a)}_validate(t,n,r,i,a={}){return(!a||!1!==a.validate)&&rt(this,t.call(e.y,e.e({key:n,style:this.serialize(),value:r,styleSpec:e.v},i)))}_remove(t=!0){this._request&&=(this._request.cancel(),null),this._spriteRequest&&=(this._spriteRequest.cancel(),null),e.aJ.off(`pluginStateChange`,this._rtlTextPluginCallback);for(let e in this._layers)this._layers[e].setEventedParent(null);for(let e in this.sourceCaches){let t=this.sourceCaches[e];t.setEventedParent(null),t.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let t in this.sourceCaches)this.sourceCaches[t].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(t,n,r,i,a=!1){let o=!1,s=!1,c={};for(let e of this._order){let n=this._layers[e];if(n.type!==`symbol`)continue;if(!c[n.source]){let e=this.sourceCaches[n.source];c[n.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}let r=this.crossTileSymbolIndex.addLayer(n,c[n.source],t.center.lng);o||=r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((a=a||this._layerOrderChanged||r===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.h.now(),t.zoom))&&(this.pauseablePlacement=new Ze(t,this.map.terrain,this._order,a,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.h.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(let e of this._order){let t=this._layers[e];t.type===`symbol`&&this.placement.updateLayerOpacities(t,c[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.h.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,n){this.imageManager.getImages(t.icons,n),this._updateTilesForChangedImages();let r=this.sourceCaches[t.source];r&&r.setDependencies(t.tileID.key,t.type,t.icons)}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,n);let r=this.sourceCaches[t.source];r&&r.setDependencies(t.tileID.key,t.type,[``])}getResource(t,n,r){return e.m(n,r)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(e.y.glyphs,`glyphs`,t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,r={},i){this._checkLoaded();let a=[{id:t,url:n}],o=[..._(this.stylesheet.sprite),...a];this._validate(e.y.sprite,`sprite`,o,null,r)||(this.stylesheet.sprite=o,this._loadSprite(a,!0,i))}removeSprite(t){this._checkLoaded();let n=_(this.stylesheet.sprite);if(n.find((e=>e.id===t))){if(this._spritesImagesIds[t])for(let e of this._spritesImagesIds[t])this.imageManager.removeImage(e),this._changedImages[e]=!0;n.splice(n.findIndex((e=>e.id===t)),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast(`setImages`,this._availableImages),this.fire(new e.k(`data`,{dataType:`style`}))}else this.fire(new e.j(Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return _(this.stylesheet.sprite)}setSprite(t,n={},r){this._checkLoaded(),t&&this._validate(e.y.sprite,`sprite`,t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,r):(this._unloadSprite(),r&&r(null)))}}st.registerForPluginStateChange=e.aK;var ct=e.Q([{name:`a_pos`,type:`Int16`,components:2}]),lt=`attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}`;let ut={prelude:dt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:dt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}`),backgroundPattern:dt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}`),circle:dt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:dt(`void main() {gl_FragColor=vec4(1.0);}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}`),heatmap:dt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:dt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}`),collisionBox:dt(`varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}`,`attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:dt(`varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}`,`attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:dt(`uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}`,`attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}`),fill:dt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:dt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:dt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:dt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:dt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:dt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:dt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}`),hillshade:dt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}`),line:dt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:dt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:dt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:dt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:dt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:dt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:dt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:dt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:dt(`uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}`,lt),terrainDepth:dt(`varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}`,lt),terrainCoords:dt(`precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}`,lt)};function dt(e,t){let n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=t.match(/attribute ([\w]+) ([\w]+)/g),i=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=a?a.concat(i):i,s={};return{fragmentSource:e=e.replace(n,((e,t,n,r,i)=>(s[i]=!0,t===`define`?`\n#ifndef HAS_UNIFORM_u_${i}\nvarying ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = u_${i};\n#endif\n`))),vertexSource:t=t.replace(n,((e,t,n,r,i)=>{let a=r===`float`?`vec2`:`vec4`,o=i.match(/color/)?`color`:a;return s[i]?t===`define`?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${n} ${a} a_${i};\nvarying ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:o===`vec4`?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = unpack_mix_${o}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:t===`define`?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${n} ${a} a_${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:o===`vec4`?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = unpack_mix_${o}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`})),staticAttributes:r,staticUniforms:o}}class ft{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,n,r,i,a,o,s,c){this.context=e;let l=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!l&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(l=!0);!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||l||this.boundIndexBuffer!==i||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==o||this.boundDynamicVertexBuffer2!==s||this.boundDynamicVertexBuffer3!==c?this.freshBind(t,n,r,i,a,o,s,c):(e.bindVertexArray.set(this.vao),o&&o.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind(),c&&c.bind())}freshBind(e,t,n,r,i,a,o,s){let c=e.numAttributes,l=this.context,u=l.gl;this.vao&&this.destroy(),this.vao=l.createVertexArray(),l.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o,this.boundDynamicVertexBuffer3=s,t.enableAttributes(u,e);for(let t of n)t.enableAttributes(u,e);a&&a.enableAttributes(u,e),o&&o.enableAttributes(u,e),s&&s.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i);for(let t of n)t.bind(),t.setVertexAttribPointers(u,e,i);a&&(a.bind(),a.setVertexAttribPointers(u,e,i)),r&&r.bind(),o&&(o.bind(),o.setVertexAttribPointers(u,e,i)),s&&(s.bind(),s.setVertexAttribPointers(u,e,i)),l.currentNumAttributes=c}destroy(){this.vao&&=(this.context.deleteVertexArray(this.vao),null)}}function pt(e){let t=[];for(let n=0;n<e.length;n++){if(e[n]===null)continue;let r=e[n].split(` `);t.push(r.pop())}return t}class mt{constructor(t,n,r,i,a,o){let s=t.gl;this.program=s.createProgram();let c=pt(n.staticAttributes),l=r?r.getBinderAttributes():[],u=c.concat(l),d=ut.prelude.staticUniforms?pt(ut.prelude.staticUniforms):[],f=n.staticUniforms?pt(n.staticUniforms):[],p=r?r.getBinderUniforms():[],m=d.concat(f).concat(p),h=[];for(let e of m)h.indexOf(e)<0&&h.push(e);let g=r?r.defines():[];a&&g.push(`#define OVERDRAW_INSPECTOR;`),o&&g.push(`#define TERRAIN3D;`);let _=g.concat(ut.prelude.fragmentSource,n.fragmentSource).join(`
`),v=g.concat(ut.prelude.vertexSource,n.vertexSource).join(`
`),y=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);if(s.shaderSource(y,_),s.compileShader(y),!s.getShaderParameter(y,s.COMPILE_STATUS))throw Error(`Could not compile fragment shader: ${s.getShaderInfoLog(y)}`);s.attachShader(this.program,y);let b=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);if(s.shaderSource(b,v),s.compileShader(b),!s.getShaderParameter(b,s.COMPILE_STATUS))throw Error(`Could not compile vertex shader: ${s.getShaderInfoLog(b)}`);s.attachShader(this.program,b),this.attributes={};let x={};this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)u[e]&&(s.bindAttribLocation(this.program,e,u[e]),this.attributes[u[e]]=e);if(s.linkProgram(this.program),!s.getProgramParameter(this.program,s.LINK_STATUS))throw Error(`Program failed to link: ${s.getProgramInfoLog(this.program)}`);s.deleteShader(b),s.deleteShader(y);for(let e=0;e<h.length;e++){let t=h[e];if(t&&!x[t]){let e=s.getUniformLocation(this.program,t);e&&(x[t]=e)}}this.fixedUniforms=i(t,x),this.terrainUniforms=((t,n)=>({u_depth:new e.aL(t,n.u_depth),u_terrain:new e.aL(t,n.u_terrain),u_terrain_dim:new e.aM(t,n.u_terrain_dim),u_terrain_matrix:new e.aN(t,n.u_terrain_matrix),u_terrain_unpack:new e.aO(t,n.u_terrain_unpack),u_terrain_exaggeration:new e.aM(t,n.u_terrain_exaggeration)}))(t,x),this.binderUniforms=r?r.getUniforms(t,x):[]}draw(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_){let v=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(r),e.setColorMode(i),e.setCullFace(a),s){e.activeTexture.set(v.TEXTURE2),v.bindTexture(v.TEXTURE_2D,s.depthTexture),e.activeTexture.set(v.TEXTURE3),v.bindTexture(v.TEXTURE_2D,s.texture);for(let e in this.terrainUniforms)this.terrainUniforms[e].set(s[e])}for(let e in this.fixedUniforms)this.fixedUniforms[e].set(o[e]);m&&m.setUniforms(e,this.binderUniforms,f,{zoom:p});let y=0;switch(t){case v.LINES:y=2;break;case v.TRIANGLES:y=3;break;case v.LINE_STRIP:y=1}for(let n of d.get()){let r=n.vaos||={};(r[c]||(r[c]=new ft)).bind(e,this,l,m?m.getPaintVertexBuffers():[],u,n.vertexOffset,h,g,_),v.drawElements(t,n.primitiveLength*y,v.UNSIGNED_SHORT,n.primitiveOffset*y*2)}}}function ht(e,t,n){let r=1/Pe(n,1,t.transform.tileZoom),i=2**n.tileID.overscaledZ,a=n.tileSize*2**t.transform.tileZoom/i,o=a*(n.tileID.canonical.x+n.tileID.wrap*i),s=a*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}let gt=(t,n,r,i)=>{let a=n.style.light,o=a.properties.get(`position`),s=[o.x,o.y,o.z],c=function(){var t=new e.A(9);return e.A!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();a.properties.get(`anchor`)===`viewport`&&function(e,t){var n=Math.sin(t),r=Math.cos(t);e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1}(c,-n.transform.angle),function(e,t,n){var r=t[0],i=t[1],a=t[2];e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8]}(s,s,c);let l=a.properties.get(`color`);return{u_matrix:t,u_lightpos:s,u_lightintensity:a.properties.get(`intensity`),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+r,u_opacity:i}},_t=(t,n,r,i,a,o,s)=>e.e(gt(t,n,r,i),ht(o,n,s),{u_height_factor:-(2**a.overscaledZ)/s.tileSize/8}),vt=e=>({u_matrix:e}),yt=(t,n,r,i)=>e.e(vt(t),ht(r,n,i)),bt=(e,t)=>({u_matrix:e,u_world:t}),xt=(t,n,r,i,a)=>e.e(yt(t,n,r,i),{u_world:a}),St=(e,t,n,r)=>{let i=e.transform,a,o;if(r.paint.get(`circle-pitch-alignment`)===`map`){let e=Pe(n,1,i.zoom);a=!0,o=[e,e]}else a=!1,o=i.pixelsToGLUnits;return{u_camera_to_center_distance:i.cameraToCenterDistance,u_scale_with_map:+(r.paint.get(`circle-pitch-scale`)===`map`),u_matrix:e.translatePosMatrix(t.posMatrix,n,r.paint.get(`circle-translate`),r.paint.get(`circle-translate-anchor`)),u_pitch_with_map:+a,u_device_pixel_ratio:e.pixelRatio,u_extrude_scale:o}},Ct=(e,t,n)=>{let r=Pe(n,1,t.zoom),i=2**(t.zoom-n.tileID.overscaledZ),a=n.tileID.overscaleFactor();return{u_matrix:e,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[t.pixelsToGLUnits[0]/(r*i),t.pixelsToGLUnits[1]/(r*i)],u_overscale_factor:a}},wt=(e,t,n=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}),Tt=e=>({u_matrix:e}),Et=(e,t,n,r)=>({u_matrix:e,u_extrude_scale:Pe(t,1,n),u_intensity:r});function Dt(t,n){let r=2**n.canonical.z,i=n.canonical.y;return[new e.U(0,i/r).toLngLat().lat,new e.U(0,(i+1)/r).toLngLat().lat]}let Ot=(e,t,n,r)=>{let i=e.transform;return{u_matrix:Nt(e,t,n,r),u_ratio:1/Pe(t,1,i.zoom),u_device_pixel_ratio:e.pixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},kt=(t,n,r,i,a)=>e.e(Ot(t,n,r,a),{u_image:0,u_image_height:i}),At=(e,t,n,r,i)=>{let a=e.transform,o=Mt(t,a);return{u_matrix:Nt(e,t,n,i),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Pe(t,1,a.zoom),u_device_pixel_ratio:e.pixelRatio,u_image:0,u_scale:[o,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},jt=(t,n,r,i,a,o)=>{let s=t.lineAtlas,c=Mt(n,t.transform),l=r.layout.get(`line-cap`)===`round`,u=s.getDash(i.from,l),d=s.getDash(i.to,l),f=u.width*a.fromScale,p=d.width*a.toScale;return e.e(Ot(t,n,r,o),{u_patternscale_a:[c/f,-u.height/2],u_patternscale_b:[c/p,-d.height/2],u_sdfgamma:s.width/(256*Math.min(f,p)*t.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:d.y,u_mix:a.t})};function Mt(e,t){return 1/Pe(e,1,t.tileZoom)}function Nt(e,t,n,r){return e.translatePosMatrix(r?r.posMatrix:t.tileID.posMatrix,t,n.paint.get(`line-translate`),n.paint.get(`line-translate-anchor`))}let Pt=(e,t,n,r,i)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get(`raster-opacity`),u_image0:0,u_image1:1,u_brightness_low:i.paint.get(`raster-brightness-min`),u_brightness_high:i.paint.get(`raster-brightness-max`),u_saturation_factor:(o=i.paint.get(`raster-saturation`),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=i.paint.get(`raster-contrast`),a>0?1/(1-a):1+a),u_spin_weights:Ft(i.paint.get(`raster-hue-rotate`))};var a,o};function Ft(e){e*=Math.PI/180;let t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}let It=(e,t,n,r,i,a,o,s,c,l)=>{let u=i.transform;return{u_is_size_zoom_constant:+(e===`constant`||e===`source`),u_is_size_feature_constant:+(e===`constant`||e===`camera`),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:u.width/u.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+c,u_pitch_with_map:+r,u_texsize:l,u_texture:0}},Lt=(t,n,r,i,a,o,s,c,l,u,d)=>{let f=a.transform;return e.e(It(t,n,r,i,a,o,s,c,l,u),{u_gamma_scale:i?Math.cos(f._pitch)*f.cameraToCenterDistance:1,u_device_pixel_ratio:a.pixelRatio,u_is_halo:+d})},Rt=(t,n,r,i,a,o,s,c,l,u)=>e.e(Lt(t,n,r,i,a,o,s,c,!0,l,!0),{u_texsize_icon:u,u_texture_icon:1}),zt=(e,t,n)=>({u_matrix:e,u_opacity:t,u_color:n}),Bt=(t,n,r,i,a,o)=>e.e(function(e,t,n,r){let i=n.imageManager.getPattern(e.from.toString()),a=n.imageManager.getPattern(e.to.toString()),{width:o,height:s}=n.imageManager.getPixelSize(),c=2**r.tileID.overscaledZ,l=r.tileSize*2**n.transform.tileZoom/c,u=l*(r.tileID.canonical.x+r.tileID.wrap*c),d=l*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[o,s],u_mix:t.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/Pe(r,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,d>>16],u_pixel_coord_lower:[65535&u,65535&d]}}(i,o,r,a),{u_matrix:t,u_opacity:n}),Vt={fillExtrusion:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_lightpos:new e.aP(t,n.u_lightpos),u_lightintensity:new e.aM(t,n.u_lightintensity),u_lightcolor:new e.aP(t,n.u_lightcolor),u_vertical_gradient:new e.aM(t,n.u_vertical_gradient),u_opacity:new e.aM(t,n.u_opacity)}),fillExtrusionPattern:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_lightpos:new e.aP(t,n.u_lightpos),u_lightintensity:new e.aM(t,n.u_lightintensity),u_lightcolor:new e.aP(t,n.u_lightcolor),u_vertical_gradient:new e.aM(t,n.u_vertical_gradient),u_height_factor:new e.aM(t,n.u_height_factor),u_image:new e.aL(t,n.u_image),u_texsize:new e.aQ(t,n.u_texsize),u_pixel_coord_upper:new e.aQ(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.aQ(t,n.u_pixel_coord_lower),u_scale:new e.aP(t,n.u_scale),u_fade:new e.aM(t,n.u_fade),u_opacity:new e.aM(t,n.u_opacity)}),fill:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix)}),fillPattern:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_image:new e.aL(t,n.u_image),u_texsize:new e.aQ(t,n.u_texsize),u_pixel_coord_upper:new e.aQ(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.aQ(t,n.u_pixel_coord_lower),u_scale:new e.aP(t,n.u_scale),u_fade:new e.aM(t,n.u_fade)}),fillOutline:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_world:new e.aQ(t,n.u_world)}),fillOutlinePattern:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_world:new e.aQ(t,n.u_world),u_image:new e.aL(t,n.u_image),u_texsize:new e.aQ(t,n.u_texsize),u_pixel_coord_upper:new e.aQ(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.aQ(t,n.u_pixel_coord_lower),u_scale:new e.aP(t,n.u_scale),u_fade:new e.aM(t,n.u_fade)}),circle:(t,n)=>({u_camera_to_center_distance:new e.aM(t,n.u_camera_to_center_distance),u_scale_with_map:new e.aL(t,n.u_scale_with_map),u_pitch_with_map:new e.aL(t,n.u_pitch_with_map),u_extrude_scale:new e.aQ(t,n.u_extrude_scale),u_device_pixel_ratio:new e.aM(t,n.u_device_pixel_ratio),u_matrix:new e.aN(t,n.u_matrix)}),collisionBox:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_camera_to_center_distance:new e.aM(t,n.u_camera_to_center_distance),u_pixels_to_tile_units:new e.aM(t,n.u_pixels_to_tile_units),u_extrude_scale:new e.aQ(t,n.u_extrude_scale),u_overscale_factor:new e.aM(t,n.u_overscale_factor)}),collisionCircle:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_inv_matrix:new e.aN(t,n.u_inv_matrix),u_camera_to_center_distance:new e.aM(t,n.u_camera_to_center_distance),u_viewport_size:new e.aQ(t,n.u_viewport_size)}),debug:(t,n)=>({u_color:new e.aR(t,n.u_color),u_matrix:new e.aN(t,n.u_matrix),u_overlay:new e.aL(t,n.u_overlay),u_overlay_scale:new e.aM(t,n.u_overlay_scale)}),clippingMask:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix)}),heatmap:(t,n)=>({u_extrude_scale:new e.aM(t,n.u_extrude_scale),u_intensity:new e.aM(t,n.u_intensity),u_matrix:new e.aN(t,n.u_matrix)}),heatmapTexture:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_world:new e.aQ(t,n.u_world),u_image:new e.aL(t,n.u_image),u_color_ramp:new e.aL(t,n.u_color_ramp),u_opacity:new e.aM(t,n.u_opacity)}),hillshade:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_image:new e.aL(t,n.u_image),u_latrange:new e.aQ(t,n.u_latrange),u_light:new e.aQ(t,n.u_light),u_shadow:new e.aR(t,n.u_shadow),u_highlight:new e.aR(t,n.u_highlight),u_accent:new e.aR(t,n.u_accent)}),hillshadePrepare:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_image:new e.aL(t,n.u_image),u_dimension:new e.aQ(t,n.u_dimension),u_zoom:new e.aM(t,n.u_zoom),u_unpack:new e.aO(t,n.u_unpack)}),line:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_ratio:new e.aM(t,n.u_ratio),u_device_pixel_ratio:new e.aM(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.aQ(t,n.u_units_to_pixels)}),lineGradient:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_ratio:new e.aM(t,n.u_ratio),u_device_pixel_ratio:new e.aM(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.aQ(t,n.u_units_to_pixels),u_image:new e.aL(t,n.u_image),u_image_height:new e.aM(t,n.u_image_height)}),linePattern:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_texsize:new e.aQ(t,n.u_texsize),u_ratio:new e.aM(t,n.u_ratio),u_device_pixel_ratio:new e.aM(t,n.u_device_pixel_ratio),u_image:new e.aL(t,n.u_image),u_units_to_pixels:new e.aQ(t,n.u_units_to_pixels),u_scale:new e.aP(t,n.u_scale),u_fade:new e.aM(t,n.u_fade)}),lineSDF:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_ratio:new e.aM(t,n.u_ratio),u_device_pixel_ratio:new e.aM(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.aQ(t,n.u_units_to_pixels),u_patternscale_a:new e.aQ(t,n.u_patternscale_a),u_patternscale_b:new e.aQ(t,n.u_patternscale_b),u_sdfgamma:new e.aM(t,n.u_sdfgamma),u_image:new e.aL(t,n.u_image),u_tex_y_a:new e.aM(t,n.u_tex_y_a),u_tex_y_b:new e.aM(t,n.u_tex_y_b),u_mix:new e.aM(t,n.u_mix)}),raster:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_tl_parent:new e.aQ(t,n.u_tl_parent),u_scale_parent:new e.aM(t,n.u_scale_parent),u_buffer_scale:new e.aM(t,n.u_buffer_scale),u_fade_t:new e.aM(t,n.u_fade_t),u_opacity:new e.aM(t,n.u_opacity),u_image0:new e.aL(t,n.u_image0),u_image1:new e.aL(t,n.u_image1),u_brightness_low:new e.aM(t,n.u_brightness_low),u_brightness_high:new e.aM(t,n.u_brightness_high),u_saturation_factor:new e.aM(t,n.u_saturation_factor),u_contrast_factor:new e.aM(t,n.u_contrast_factor),u_spin_weights:new e.aP(t,n.u_spin_weights)}),symbolIcon:(t,n)=>({u_is_size_zoom_constant:new e.aL(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aL(t,n.u_is_size_feature_constant),u_size_t:new e.aM(t,n.u_size_t),u_size:new e.aM(t,n.u_size),u_camera_to_center_distance:new e.aM(t,n.u_camera_to_center_distance),u_pitch:new e.aM(t,n.u_pitch),u_rotate_symbol:new e.aL(t,n.u_rotate_symbol),u_aspect_ratio:new e.aM(t,n.u_aspect_ratio),u_fade_change:new e.aM(t,n.u_fade_change),u_matrix:new e.aN(t,n.u_matrix),u_label_plane_matrix:new e.aN(t,n.u_label_plane_matrix),u_coord_matrix:new e.aN(t,n.u_coord_matrix),u_is_text:new e.aL(t,n.u_is_text),u_pitch_with_map:new e.aL(t,n.u_pitch_with_map),u_texsize:new e.aQ(t,n.u_texsize),u_texture:new e.aL(t,n.u_texture)}),symbolSDF:(t,n)=>({u_is_size_zoom_constant:new e.aL(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aL(t,n.u_is_size_feature_constant),u_size_t:new e.aM(t,n.u_size_t),u_size:new e.aM(t,n.u_size),u_camera_to_center_distance:new e.aM(t,n.u_camera_to_center_distance),u_pitch:new e.aM(t,n.u_pitch),u_rotate_symbol:new e.aL(t,n.u_rotate_symbol),u_aspect_ratio:new e.aM(t,n.u_aspect_ratio),u_fade_change:new e.aM(t,n.u_fade_change),u_matrix:new e.aN(t,n.u_matrix),u_label_plane_matrix:new e.aN(t,n.u_label_plane_matrix),u_coord_matrix:new e.aN(t,n.u_coord_matrix),u_is_text:new e.aL(t,n.u_is_text),u_pitch_with_map:new e.aL(t,n.u_pitch_with_map),u_texsize:new e.aQ(t,n.u_texsize),u_texture:new e.aL(t,n.u_texture),u_gamma_scale:new e.aM(t,n.u_gamma_scale),u_device_pixel_ratio:new e.aM(t,n.u_device_pixel_ratio),u_is_halo:new e.aL(t,n.u_is_halo)}),symbolTextAndIcon:(t,n)=>({u_is_size_zoom_constant:new e.aL(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aL(t,n.u_is_size_feature_constant),u_size_t:new e.aM(t,n.u_size_t),u_size:new e.aM(t,n.u_size),u_camera_to_center_distance:new e.aM(t,n.u_camera_to_center_distance),u_pitch:new e.aM(t,n.u_pitch),u_rotate_symbol:new e.aL(t,n.u_rotate_symbol),u_aspect_ratio:new e.aM(t,n.u_aspect_ratio),u_fade_change:new e.aM(t,n.u_fade_change),u_matrix:new e.aN(t,n.u_matrix),u_label_plane_matrix:new e.aN(t,n.u_label_plane_matrix),u_coord_matrix:new e.aN(t,n.u_coord_matrix),u_is_text:new e.aL(t,n.u_is_text),u_pitch_with_map:new e.aL(t,n.u_pitch_with_map),u_texsize:new e.aQ(t,n.u_texsize),u_texsize_icon:new e.aQ(t,n.u_texsize_icon),u_texture:new e.aL(t,n.u_texture),u_texture_icon:new e.aL(t,n.u_texture_icon),u_gamma_scale:new e.aM(t,n.u_gamma_scale),u_device_pixel_ratio:new e.aM(t,n.u_device_pixel_ratio),u_is_halo:new e.aL(t,n.u_is_halo)}),background:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_opacity:new e.aM(t,n.u_opacity),u_color:new e.aR(t,n.u_color)}),backgroundPattern:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_opacity:new e.aM(t,n.u_opacity),u_image:new e.aL(t,n.u_image),u_pattern_tl_a:new e.aQ(t,n.u_pattern_tl_a),u_pattern_br_a:new e.aQ(t,n.u_pattern_br_a),u_pattern_tl_b:new e.aQ(t,n.u_pattern_tl_b),u_pattern_br_b:new e.aQ(t,n.u_pattern_br_b),u_texsize:new e.aQ(t,n.u_texsize),u_mix:new e.aM(t,n.u_mix),u_pattern_size_a:new e.aQ(t,n.u_pattern_size_a),u_pattern_size_b:new e.aQ(t,n.u_pattern_size_b),u_scale_a:new e.aM(t,n.u_scale_a),u_scale_b:new e.aM(t,n.u_scale_b),u_pixel_coord_upper:new e.aQ(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.aQ(t,n.u_pixel_coord_lower),u_tile_units_to_pixels:new e.aM(t,n.u_tile_units_to_pixels)}),terrain:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_texture:new e.aL(t,n.u_texture),u_ele_delta:new e.aM(t,n.u_ele_delta)}),terrainDepth:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_ele_delta:new e.aM(t,n.u_ele_delta)}),terrainCoords:(t,n)=>({u_matrix:new e.aN(t,n.u_matrix),u_texture:new e.aL(t,n.u_texture),u_terrain_coords_id:new e.aM(t,n.u_terrain_coords_id),u_ele_delta:new e.aM(t,n.u_ele_delta)})};class Ht{constructor(e,t,n){this.context=e;let r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=!!n,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let t=this.context.gl;if(!this.dynamicDraw)throw Error(`Attempted to update data while not in dynamic mode.`);this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Ut={Int8:`BYTE`,Uint8:`UNSIGNED_BYTE`,Int16:`SHORT`,Uint16:`UNSIGNED_SHORT`,Int32:`INT`,Uint32:`UNSIGNED_INT`,Float32:`FLOAT`};class Wt{constructor(e,t,n,r){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;let i=e.gl;this.buffer=i.createBuffer(),e.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){let r=t.attributes[this.attributes[n].name];r!==void 0&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,n){for(let r=0;r<this.attributes.length;r++){let i=this.attributes[r],a=t.attributes[i.name];a!==void 0&&e.vertexAttribPointer(a,i.components,e[Ut[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Gt=new WeakMap;function Kt(e){if(Gt.has(e))return Gt.get(e);{let t=e.getParameter(e.VERSION)?.startsWith(`WebGL 2.0`);return Gt.set(e,t),t}}class qt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jt extends qt{getDefault(){return e.aT.transparent}set(e){let t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Yt extends qt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Xt extends qt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Zt extends qt{getDefault(){return[!0,!0,!0,!0]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Qt extends qt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class $t extends qt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class en extends qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class tn extends qt{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class nn extends qt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class rn extends qt{getDefault(){return[0,1]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class an extends qt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class on extends qt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class sn extends qt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class cn extends qt{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ln extends qt{getDefault(){return e.aT.transparent}set(e){let t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class un extends qt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class dn extends qt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class fn extends qt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class pn extends qt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class mn extends qt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class hn extends qt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class gn extends qt{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class _n extends qt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class vn extends qt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class yn extends qt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class bn extends qt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class xn extends qt{getDefault(){return null}set(e){let t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Sn extends qt{getDefault(){return null}set(e){var t;if(e===this.current&&!this.dirty)return;let n=this.gl;Kt(n)?n.bindVertexArray(e):(t=n.getExtension(`OES_vertex_array_object`))==null||t.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Cn extends qt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class wn extends qt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Tn extends qt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class En extends qt{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Dn extends En{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class On extends En{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class kn extends En{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class An{constructor(e,t,n,r,i){this.context=e,this.width=t,this.height=n;let a=e.gl,o=this.framebuffer=a.createFramebuffer();if(this.colorAttachment=new Dn(e,o),r)this.depthAttachment=i?new kn(e,o):new On(e,o);else if(i)throw Error(`Stencil cannot be setted without depth`);if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw Error(`Framebuffer is not complete`)}destroy(){let e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){let t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class jn{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}jn.Replace=[1,0],jn.disabled=new jn(jn.Replace,e.aT.transparent,[!1,!1,!1,!1]),jn.unblended=new jn(jn.Replace,e.aT.transparent,[!0,!0,!0,!0]),jn.alphaBlended=new jn([1,771],e.aT.transparent,[!0,!0,!0,!0]);class Mn{constructor(e){if(this.gl=e,this.clearColor=new Jt(this),this.clearDepth=new Yt(this),this.clearStencil=new Xt(this),this.colorMask=new Zt(this),this.depthMask=new Qt(this),this.stencilMask=new $t(this),this.stencilFunc=new en(this),this.stencilOp=new tn(this),this.stencilTest=new nn(this),this.depthRange=new rn(this),this.depthTest=new an(this),this.depthFunc=new on(this),this.blend=new sn(this),this.blendFunc=new cn(this),this.blendColor=new ln(this),this.blendEquation=new un(this),this.cullFace=new dn(this),this.cullFaceSide=new fn(this),this.frontFace=new pn(this),this.program=new mn(this),this.activeTexture=new hn(this),this.viewport=new gn(this),this.bindFramebuffer=new _n(this),this.bindRenderbuffer=new vn(this),this.bindTexture=new yn(this),this.bindVertexBuffer=new bn(this),this.bindElementBuffer=new xn(this),this.bindVertexArray=new Sn(this),this.pixelStoreUnpack=new Cn(this),this.pixelStoreUnpackPremultiplyAlpha=new wn(this),this.pixelStoreUnpackFlipY=new Tn(this),this.extTextureFilterAnisotropic=e.getExtension(`EXT_texture_filter_anisotropic`)||e.getExtension(`MOZ_EXT_texture_filter_anisotropic`)||e.getExtension(`WEBKIT_EXT_texture_filter_anisotropic`),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Kt(e)){this.HALF_FLOAT=e.HALF_FLOAT;let t=e.getExtension(`EXT_color_buffer_half_float`);this.RGBA16F=e.RGBA16F??t?.RGBA16F_EXT,this.RGB16F=e.RGB16F??t?.RGB16F_EXT,e.getExtension(`EXT_color_buffer_float`)}else e.getExtension(`EXT_color_buffer_half_float`),e.getExtension(`OES_texture_half_float_linear`),this.HALF_FLOAT=e.getExtension(`OES_texture_half_float`)?.HALF_FLOAT_OES}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new Ht(this,e,t)}createVertexBuffer(e,t,n){return new Wt(this,e,t,n)}createRenderbuffer(e,t,n){let r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),i}createFramebuffer(e,t,n,r){return new An(this,e,t,n,r)}clear({color:e,depth:t,stencil:n}){let r=this.gl,i=0;e&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),t!==void 0&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),n!==void 0&&(i|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),r.clear(i)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.aG(t.blendFunction,jn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){return Kt(this.gl)?this.gl.createVertexArray():this.gl.getExtension(`OES_vertex_array_object`)?.createVertexArrayOES()}deleteVertexArray(e){return Kt(this.gl)?this.gl.deleteVertexArray(e):this.gl.getExtension(`OES_vertex_array_object`)?.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Nn{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}Nn.ReadOnly=!1,Nn.ReadWrite=!0,Nn.disabled=new Nn(519,Nn.ReadOnly,[0,1]);let Pn=7680;class Fn{constructor(e,t,n,r,i,a){this.test=e,this.ref=t,this.mask=n,this.fail=r,this.depthFail=i,this.pass=a}}Fn.disabled=new Fn({func:519,mask:0},0,0,Pn,Pn,Pn);class In{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}let Ln;function Rn(t,n,r,i,a,o,s){let c=t.context,l=c.gl,u=t.useProgram(`collisionBox`),d=[],f=0,p=0;for(let m=0;m<i.length;m++){let h=i[m],g=n.getTile(h),_=g.getBucket(r);if(!_)continue;let v=h.posMatrix;a[0]===0&&a[1]===0||(v=t.translatePosMatrix(h.posMatrix,g,a,o));let y=s?_.textCollisionBox:_.iconCollisionBox,b=_.collisionCircleArray;if(b.length>0){let n=e.Z(),r=v;e.aU(n,_.placementInvProjMatrix,t.transform.glCoordMatrix),e.aU(n,n,_.placementViewportMatrix),d.push({circleArray:b,circleOffset:p,transform:r,invTransform:n,coord:h}),f+=b.length/4,p=f}y&&u.draw(c,l.LINES,Nn.disabled,Fn.disabled,t.colorModeForRenderPass(),In.disabled,Ct(v,t.transform,g),t.style.map.terrain&&t.style.map.terrain.getTerrainData(h),r.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,null,t.transform.zoom,null,null,y.collisionVertexBuffer)}if(!s||!d.length)return;let m=t.useProgram(`collisionCircle`),h=new e.aV;h.resize(4*f),h._trim();let g=0;for(let e of d)for(let t=0;t<e.circleArray.length/4;t++){let n=4*t,r=e.circleArray[n+0],i=e.circleArray[n+1],a=e.circleArray[n+2],o=e.circleArray[n+3];h.emplace(g++,r,i,a,o,0),h.emplace(g++,r,i,a,o,1),h.emplace(g++,r,i,a,o,2),h.emplace(g++,r,i,a,o,3)}(!Ln||Ln.length<2*f)&&(Ln=function(t){let n=2*t,r=new e.aX;r.resize(n),r._trim();for(let e=0;e<n;e++){let t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(f));let _=c.createIndexBuffer(Ln,!0),v=c.createVertexBuffer(h,e.aW.members,!0);for(let n of d){let i={u_matrix:n.transform,u_inv_matrix:n.invTransform,u_camera_to_center_distance:(y=t.transform).cameraToCenterDistance,u_viewport_size:[y.width,y.height]};m.draw(c,l.TRIANGLES,Nn.disabled,Fn.disabled,t.colorModeForRenderPass(),In.disabled,i,t.style.map.terrain&&t.style.map.terrain.getTerrainData(n.coord),r.id,v,_,e.S.simpleSegment(0,2*n.circleOffset,n.circleArray.length,n.circleArray.length/2),null,t.transform.zoom,null,null,null)}var y;v.destroy(),_.destroy()}In.disabled=new In(!1,1029,2305),In.backCCW=new In(!0,1029,2305);let zn=e.ao(new Float32Array(16));function Bn(t,n,r,i,a,o){let{horizontalAlign:s,verticalAlign:c}=e.au(t);return new e.P((-(s-.5)*n/a+i[0])*o,(-(c-.5)*r/a+i[1])*o)}function Vn(t,n,r,i,a,o,s,c,l,u,d){let f=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,h={};p.clear();for(let m=0;m<f.length;m++){let g=f.get(m),_=g.hidden||!g.crossTileID||t.allowVerticalPlacement&&!g.placedOrientation?null:i[g.crossTileID];if(_){let i=new e.P(g.anchorX,g.anchorY),f=ve(i,r?s:o,d),m=ye(a.cameraToCenterDistance,f.signedDistanceFromCamera),v=e.aj(t.textSizeData,l,g)*m/e.ap;r&&(v*=t.tilePixelRatio/c);let{width:y,height:b,anchor:x,textOffset:S,textBoxScale:C}=_,w=Bn(x,y,b,S,C,v),E=r?ve(i.add(w),o,d).point:f.point.add(n?w.rotate(-a.angle):w),D=t.allowVerticalPlacement&&g.placedOrientation===e.ai.vertical?Math.PI/2:0;for(let t=0;t<g.numGlyphs;t++)e.ak(p,E,D);u&&g.associatedIconIndex>=0&&(h[g.associatedIconIndex]={shiftedAnchor:E,angle:D})}else je(g.numGlyphs,p)}if(u){m.clear();let n=t.icon.placedSymbolArray;for(let t=0;t<n.length;t++){let r=n.get(t);if(r.hidden)je(r.numGlyphs,m);else{let n=h[t];if(n)for(let t=0;t<r.numGlyphs;t++)e.ak(m,n.shiftedAnchor,n.angle);else je(r.numGlyphs,m)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function Hn(e,t,n){return n.iconsInText&&t?`symbolTextAndIcon`:e?`symbolSDF`:`symbolIcon`}function Un(t,n,r,i,a,o,s,c,l,u,d,f){let p=t.context,m=p.gl,h=t.transform,g=c===`map`,_=l===`map`,v=c!==`viewport`&&r.layout.get(`symbol-placement`)!==`point`,y=g&&!_&&!v,b=!r.layout.get(`symbol-sort-key`).isConstant(),x=!1,S=t.depthModeForSublayer(0,Nn.ReadOnly),C=r._unevaluatedLayout.hasValue(`text-variable-anchor`)||r._unevaluatedLayout.hasValue(`text-variable-anchor-offset`),w=[];for(let c of i){let i=n.getTile(c),l=i.getBucket(r);if(!l)continue;let d=a?l.text:l.icon;if(!d||!d.segments.get().length||!d.hasVisibleVertices)continue;let f=d.programConfigurations.get(r.id),p=a||l.sdfIcons,S=a?l.textSizeData:l.iconSizeData,E=_||h.pitch!==0,D=t.useProgram(Hn(p,a,l),f),O=e.ah(S,h.zoom),k=t.style.map.terrain&&t.style.map.terrain.getTerrainData(c),A,j,M,N,P=[0,0],F=null;if(a)j=i.glyphAtlasTexture,M=m.LINEAR,A=i.glyphAtlasTexture.size,l.iconsInText&&(P=i.imageAtlasTexture.size,F=i.imageAtlasTexture,N=E||t.options.rotating||t.options.zooming||S.kind===`composite`||S.kind===`camera`?m.LINEAR:m.NEAREST);else{let e=r.layout.get(`icon-size`).constantOr(0)!==1||l.iconsNeedLinear;j=i.imageAtlasTexture,M=p||t.options.rotating||t.options.zooming||e||E?m.LINEAR:m.NEAREST,A=i.imageAtlasTexture.size}let I=Pe(i,1,t.transform.zoom),ee=G(c.posMatrix,_,g,t.transform,I),R=K(c.posMatrix,_,g,t.transform,I),z=C&&l.hasTextData(),B=r.layout.get(`icon-text-fit`)!==`none`&&z&&l.hasIconData();if(v){let e=t.style.map.terrain?(e,n)=>t.style.map.terrain.getElevation(c,e,n):null,n=r.layout.get(`text-rotation-alignment`)===`map`;xe(l,c.posMatrix,t,a,ee,R,_,u,n,e)}let te=t.translatePosMatrix(c.posMatrix,i,o,s),ne=v||a&&C||B?zn:ee,re=t.translatePosMatrix(R,i,o,s,!0),V=p&&r.paint.get(a?`text-halo-width`:`icon-halo-width`).constantOr(1)!==0,ie;ie=p?l.iconsInText?Rt(S.kind,O,y,_,t,te,ne,re,A,P):Lt(S.kind,O,y,_,t,te,ne,re,a,A,!0):It(S.kind,O,y,_,t,te,ne,re,a,A);let ae={program:D,buffers:d,uniformValues:ie,atlasTexture:j,atlasTextureIcon:F,atlasInterpolation:M,atlasInterpolationIcon:N,isSDF:p,hasHalo:V};if(b&&l.canOverlap){x=!0;let t=d.segments.get();for(let n of t)w.push({segments:new e.S([n]),sortKey:n.sortKey,state:ae,terrainData:k})}else w.push({segments:d.segments,sortKey:0,state:ae,terrainData:k})}x&&w.sort(((e,t)=>e.sortKey-t.sortKey));for(let e of w){let n=e.state;if(p.activeTexture.set(m.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,m.CLAMP_TO_EDGE),n.atlasTextureIcon&&(p.activeTexture.set(m.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,m.CLAMP_TO_EDGE)),n.isSDF){let i=n.uniformValues;n.hasHalo&&(i.u_is_halo=1,Wn(n.buffers,e.segments,r,t,n.program,S,d,f,i,e.terrainData)),i.u_is_halo=0}Wn(n.buffers,e.segments,r,t,n.program,S,d,f,n.uniformValues,e.terrainData)}}function Wn(e,t,n,r,i,a,o,s,c,l){let u=r.context;i.draw(u,u.gl.TRIANGLES,a,o,s,In.disabled,c,l,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function Gn(e,t,n,r,i){if(!n||!r||!r.imageAtlas)return;let a=r.imageAtlas.patternPositions,o=a[n.to.toString()],s=a[n.from.toString()];if(!o&&s&&(o=s),!s&&o&&(s=o),!o||!s){let e=i.getPaintProperty(t);o=a[e],s=a[e]}o&&s&&e.setConstantPatternPositions(o,s)}function Kn(e,t,n,r,i,a,o){let s=e.context.gl,c=`fill-pattern`,l=n.paint.get(c),u=l&&l.constantOr(1),d=n.getCrossfadeParameters(),f,p,m,h,g;o?(p=u&&!n.getPaintProperty(`fill-outline-color`)?`fillOutlinePattern`:`fillOutline`,f=s.LINES):(p=u?`fillPattern`:`fill`,f=s.TRIANGLES);let _=l.constantOr(null);for(let l of r){let r=t.getTile(l);if(u&&!r.patternsLoaded())continue;let v=r.getBucket(n);if(!v)continue;let y=v.programConfigurations.get(n.id),b=e.useProgram(p,y),x=e.style.map.terrain&&e.style.map.terrain.getTerrainData(l);u&&(e.context.activeTexture.set(s.TEXTURE0),r.imageAtlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),y.updatePaintBuffers(d)),Gn(y,c,_,r,n);let S=x?l:null,C=e.translatePosMatrix(S?S.posMatrix:l.posMatrix,r,n.paint.get(`fill-translate`),n.paint.get(`fill-translate-anchor`));if(o){h=v.indexBuffer2,g=v.segments2;let t=[s.drawingBufferWidth,s.drawingBufferHeight];m=p===`fillOutlinePattern`&&u?xt(C,e,d,r,t):bt(C,t)}else h=v.indexBuffer,g=v.segments,m=u?yt(C,e,d,r):vt(C);b.draw(e.context,f,i,e.stencilModeForClipping(l),a,In.disabled,m,x,n.id,v.layoutVertexBuffer,h,g,n.paint,e.transform.zoom,y)}}function qn(e,t,n,r,i,a,o){let s=e.context,c=s.gl,l=`fill-extrusion-pattern`,u=n.paint.get(l),d=u.constantOr(1),f=n.getCrossfadeParameters(),p=n.paint.get(`fill-extrusion-opacity`),m=u.constantOr(null);for(let u of r){let r=t.getTile(u),h=r.getBucket(n);if(!h)continue;let g=e.style.map.terrain&&e.style.map.terrain.getTerrainData(u),_=h.programConfigurations.get(n.id),v=e.useProgram(d?`fillExtrusionPattern`:`fillExtrusion`,_);d&&(e.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),_.updatePaintBuffers(f)),Gn(_,l,m,r,n);let y=e.translatePosMatrix(u.posMatrix,r,n.paint.get(`fill-extrusion-translate`),n.paint.get(`fill-extrusion-translate-anchor`)),b=n.paint.get(`fill-extrusion-vertical-gradient`),x=d?_t(y,e,b,p,u,f,r):gt(y,e,b,p);v.draw(s,s.gl.TRIANGLES,i,a,o,In.backCCW,x,g,n.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,n.paint,e.transform.zoom,_,e.style.map.terrain&&h.centroidVertexBuffer)}}function Jn(e,t,n,r,i,a,o){let s=e.context,c=s.gl,l=n.fbo;if(!l)return;let u=e.useProgram(`hillshade`),d=e.style.map.terrain&&e.style.map.terrain.getTerrainData(t);s.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,l.colorAttachment.get()),u.draw(s,c.TRIANGLES,i,a,o,In.disabled,((e,t,n,r)=>{let i=n.paint.get(`hillshade-shadow-color`),a=n.paint.get(`hillshade-highlight-color`),o=n.paint.get(`hillshade-accent-color`),s=n.paint.get(`hillshade-illumination-direction`)*(Math.PI/180);n.paint.get(`hillshade-illumination-anchor`)===`viewport`&&(s-=e.transform.angle);let c=!e.options.moving;return{u_matrix:r?r.posMatrix:e.transform.calculatePosMatrix(t.tileID.toUnwrapped(),c),u_image:0,u_latrange:Dt(0,t.tileID),u_light:[n.paint.get(`hillshade-exaggeration`),s],u_shadow:i,u_highlight:a,u_accent:o}})(e,n,r,d?t:null),d,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}function Yn(t,n,r,i,a,o){let s=t.context,c=s.gl,l=n.dem;if(l&&l.data){let u=l.dim,d=l.stride,f=l.getPixels();if(s.activeTexture.set(c.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(d),n.demTexture){let e=n.demTexture;e.update(f,{premultiply:!1}),e.bind(c.NEAREST,c.CLAMP_TO_EDGE)}else n.demTexture=new y(s,f,c.RGBA,{premultiply:!1}),n.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);s.activeTexture.set(c.TEXTURE0);let p=n.fbo;if(!p){let e=new y(s,{width:u,height:u,data:null},c.RGBA);e.bind(c.LINEAR,c.CLAMP_TO_EDGE),p=n.fbo=s.createFramebuffer(u,u,!0,!1),p.colorAttachment.set(e.texture)}s.bindFramebuffer.set(p.framebuffer),s.viewport.set([0,0,u,u]),t.useProgram(`hillshadePrepare`).draw(s,c.TRIANGLES,i,a,o,In.disabled,((t,n)=>{let r=n.stride,i=e.Z();return e.aS(i,0,e.N,-e.N,0,0,1),e.$(i,i,[0,-e.N,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ,u_unpack:n.getUnpackVector()}})(n.tileID,l),null,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function Xn(t,n,r,i,a,o){let s=i.paint.get(`raster-fade-duration`);if(!o&&s>0){let i=e.h.now(),o=(i-t.timeAdded)/s,c=n?(i-n.timeAdded)/s:-1,l=r.getSource(),u=a.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),d=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),f=d&&t.refreshedUponExpiration?1:e.ad(d?o:1-c,0,1);return t.refreshedUponExpiration&&o>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}let Zn=new e.aT(1,0,0,1),Qn=new e.aT(0,1,0,1),$n=new e.aT(0,0,1,1),er=new e.aT(1,0,1,1),tr=new e.aT(0,1,1,1);function nr(e,t,n,r){ir(e,0,t+n/2,e.transform.width,n,r)}function rr(e,t,n,r){ir(e,t-n/2,0,n,e.transform.height,r)}function ir(e,t,n,r,i,a){let o=e.context,s=o.gl;s.enable(s.SCISSOR_TEST),s.scissor(t*e.pixelRatio,n*e.pixelRatio,r*e.pixelRatio,i*e.pixelRatio),o.clear({color:a}),s.disable(s.SCISSOR_TEST)}function ar(t,n,r){let i=t.context,a=i.gl,o=r.posMatrix,s=t.useProgram(`debug`),c=Nn.disabled,l=Fn.disabled,u=t.colorModeForRenderPass(),d=`$debug`,f=t.style.map.terrain&&t.style.map.terrain.getTerrainData(r);i.activeTexture.set(a.TEXTURE0);let p=n.getTileByID(r.key).latestRawTileData,m=Math.floor((p&&p.byteLength||0)/1024),h=n.getTile(r).tileSize,g=512/Math.min(h,512)*(r.overscaledZ/t.transform.zoom)*.5,_=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(_+=` => ${r.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();let n=e.debugOverlayCanvas,r=e.context.gl,i=e.debugOverlayCanvas.getContext(`2d`);i.clearRect(0,0,n.width,n.height),i.shadowColor=`white`,i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle=`white`,i.textBaseline=`top`,i.font=`bold 36px Open Sans, sans-serif`,i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,`${_} ${m}kB`),s.draw(i,a.TRIANGLES,c,l,jn.alphaBlended,In.disabled,wt(o,e.aT.transparent,g),null,d,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments),s.draw(i,a.LINE_STRIP,c,l,u,In.disabled,wt(o,e.aT.red),f,d,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments)}function or(e,t,n){let r=e.context,i=r.gl,a=e.colorModeForRenderPass(),o=new Nn(i.LEQUAL,Nn.ReadWrite,e.depthRangeFor3D),s=e.useProgram(`terrain`),c=t.getTerrainMesh();r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height]);for(let l of n){let n=e.renderToTexture.getTexture(l),u=t.getTerrainData(l.tileID);r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,n.texture);let d={u_matrix:e.transform.calculatePosMatrix(l.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(e.transform.zoom)};s.draw(r,i.TRIANGLES,o,Fn.disabled,a,In.backCCW,d,u,`terrain`,c.vertexBuffer,c.indexBuffer,c.segments)}}class sr{constructor(t,n){this.context=new Mn(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:e.Z(),renderTime:0},this.setup(),this.numSublayers=le.maxUnderzooming+le.maxOverzooming+1,this.depthEpsilon=1/2**16,this.crossTileSymbolIndex=new nt}resize(e,t,n){if(this.width=Math.floor(e*n),this.height=Math.floor(t*n),this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let e of this.style._order)this.style._layers[e].resize()}setup(){let t=this.context,n=new e.a_;n.emplaceBack(0,0),n.emplaceBack(e.N,0),n.emplaceBack(0,e.N),n.emplaceBack(e.N,e.N),this.tileExtentBuffer=t.createVertexBuffer(n,ct.members),this.tileExtentSegments=e.S.simpleSegment(0,0,4,2);let r=new e.a_;r.emplaceBack(0,0),r.emplaceBack(e.N,0),r.emplaceBack(0,e.N),r.emplaceBack(e.N,e.N),this.debugBuffer=t.createVertexBuffer(r,ct.members),this.debugSegments=e.S.simpleSegment(0,0,4,5);let i=new e.V;i.emplaceBack(0,0,0,0),i.emplaceBack(e.N,0,e.N,0),i.emplaceBack(0,e.N,0,e.N),i.emplaceBack(e.N,e.N,e.N,e.N),this.rasterBoundsBuffer=t.createVertexBuffer(i,z.members),this.rasterBoundsSegments=e.S.simpleSegment(0,0,4,2);let a=new e.a_;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,ct.members),this.viewportSegments=e.S.simpleSegment(0,0,4,2);let o=new e.a$;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(o);let s=new e.b0;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);let c=this.context.gl;this.stencilClearMode=new Fn({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO)}clearStencil(){let t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let r=e.Z();e.aS(r,0,this.width,this.height,0,0,1),e.a0(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram(`clippingMask`).draw(t,n.TRIANGLES,Nn.disabled,this.stencilClearMode,jn.disabled,In.disabled,Tt(r),null,`$clipping`,this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,t){if(this.currentStencilSource===e.source||!e.isTileClipped()||!t||!t.length)return;this.currentStencilSource=e.source;let n=this.context,r=n.gl;this.nextStencilID+t.length>256&&this.clearStencil(),n.setColorMode(jn.disabled),n.setDepthMode(Nn.disabled);let i=this.useProgram(`clippingMask`);this._tileClippingMaskIDs={};for(let e of t){let t=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,a=this.style.map.terrain&&this.style.map.terrain.getTerrainData(e);i.draw(n,r.TRIANGLES,Nn.disabled,new Fn({func:r.ALWAYS,mask:0},t,255,r.KEEP,r.KEEP,r.REPLACE),jn.disabled,In.disabled,Tt(e.posMatrix),a,`$clipping`,this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,t=this.context.gl;return new Fn({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){let t=this.context.gl;return new Fn({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){let t=this.context.gl,n=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=n[n.length-1].overscaledZ,i=n[0].overscaledZ-r+1;if(i>1){this.currentStencilSource=void 0,this.nextStencilID+i>256&&this.clearStencil();let e={};for(let n=0;n<i;n++)e[n+r]=new Fn({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=i,[e,n]}return[{[r]:Fn.disabled},n]}colorModeForRenderPass(){let t=this.context.gl;if(this._showOverdrawInspector){let n=1/8;return new jn([t.CONSTANT_COLOR,t.ONE],new e.aT(n,n,n,0),[!0,!0,!0,!0])}return this.renderPass===`opaque`?jn.unblended:jn.alphaBlended}depthModeForSublayer(e,t,n){if(!this.opaquePassEnabledForLayer())return Nn.disabled;let r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Nn(n||this.context.gl.LEQUAL,t,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.h.now()),this.imageManager.beginFrame();let r=this.style._order,i=this.style.sourceCaches,a={},o={},s={};for(let e in i){let t=i[e];t.used&&t.prepare(this.context),a[e]=t.getVisibleCoordinates(),o[e]=a[e].slice().reverse(),s[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<r.length;e++)if(this.style._layers[r[e]].is3D()){this.opaquePassCutoff=e;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;let t=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!e.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||t.length)&&(e.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(t,n){let r=t.context,i=r.gl,a=jn.unblended,o=new Nn(i.LEQUAL,Nn.ReadWrite,[0,1]),s=n.getTerrainMesh(),c=n.sourceCache.getRenderableTiles(),l=t.useProgram(`terrainDepth`);r.bindFramebuffer.set(n.getFramebuffer(`depth`).framebuffer),r.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),r.clear({color:e.aT.transparent,depth:1});for(let e of c){let c=n.getTerrainData(e.tileID),u={u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped()),u_ele_delta:n.getMeshFrameDelta(t.transform.zoom)};l.draw(r,i.TRIANGLES,o,Fn.disabled,a,In.backCCW,u,c,`terrain`,s.vertexBuffer,s.indexBuffer,s.segments)}r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain),function(t,n){let r=t.context,i=r.gl,a=jn.unblended,o=new Nn(i.LEQUAL,Nn.ReadWrite,[0,1]),s=n.getTerrainMesh(),c=n.getCoordsTexture(),l=n.sourceCache.getRenderableTiles(),u=t.useProgram(`terrainCoords`);r.bindFramebuffer.set(n.getFramebuffer(`coords`).framebuffer),r.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),r.clear({color:e.aT.transparent,depth:1}),n.coordsIndex=[];for(let e of l){let l=n.getTerrainData(e.tileID);r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,c.texture);let d={u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped()),u_terrain_coords_id:(255-n.coordsIndex.length)/255,u_texture:0,u_ele_delta:n.getMeshFrameDelta(t.transform.zoom)};u.draw(r,i.TRIANGLES,o,Fn.disabled,a,In.backCCW,d,l,`terrain`,s.vertexBuffer,s.indexBuffer,s.segments),n.coordsIndex.push(e.tileID.key)}r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain))}this.renderPass=`offscreen`;for(let e of r){let t=this.style._layers[e];if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;let n=o[t.source];(t.type===`custom`||n.length)&&this.renderLayer(this,i[t.source],t,n)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?e.aT.black:e.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass=`opaque`,this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){let e=this.style._layers[r[this.currentLayer]],t=i[e.source],n=a[e.source];this._renderTileClippingMasks(e,n),this.renderLayer(this,t,e,n)}for(this.renderPass=`translucent`,this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){let e=this.style._layers[r[this.currentLayer]],t=i[e.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(e))continue;let n=(e.type===`symbol`?s:o)[e.source];this._renderTileClippingMasks(e,a[e.source]),this.renderLayer(this,t,e,n)}if(this.options.showTileBoundaries){let e=function(e,t){let n=null,r=Object.values(e._layers).flatMap((n=>n.source&&!n.isHidden(t)?[e.sourceCaches[n.source]]:[])),i=r.filter((e=>e.getSource().type===`vector`)),a=r.filter((e=>e.getSource().type!==`vector`)),o=e=>{(!n||n.getSource().maxzoom<e.getSource().maxzoom)&&(n=e)};return i.forEach((e=>o(e))),n||a.forEach((e=>o(e))),n}(this.style,this.transform.zoom);e&&function(e,t,n){for(let r=0;r<n.length;r++)ar(e,t,n[r])}(this,e,e.getVisibleCoordinates())}this.options.showPadding&&function(e){let t=e.transform.padding;nr(e,e.transform.height-(t.top||0),3,Zn),nr(e,t.bottom||0,3,Qn),rr(e,t.left||0,3,$n),rr(e,e.transform.width-(t.right||0),3,er);let n=e.transform.centerPoint;(function(e,t,n,r){ir(e,t-1,n-10,2,20,r),ir(e,t-10,n-1,20,2,r)})(e,n.x,e.transform.height-n.y,tr)}(this),this.context.setDefault()}renderLayer(t,n,r,i){if(!r.isHidden(this.transform.zoom)&&(r.type===`background`||r.type===`custom`||(i||[]).length))switch(this.id=r.id,r.type){case`symbol`:(function(t,n,r,i,a){if(t.renderPass!==`translucent`)return;let o=Fn.disabled,s=t.colorModeForRenderPass();(r._unevaluatedLayout.hasValue(`text-variable-anchor`)||r._unevaluatedLayout.hasValue(`text-variable-anchor-offset`))&&function(t,n,r,i,a,o,s){let c=n.transform,l=a===`map`,u=o===`map`;for(let a of t){let t=i.getTile(a),o=t.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)continue;let d=e.ah(o.textSizeData,c.zoom),f=Pe(t,1,n.transform.zoom),p=G(a.posMatrix,u,l,n.transform,f),m=r.layout.get(`icon-text-fit`)!==`none`&&o.hasIconData();if(d){let e=2**(c.zoom-t.tileID.overscaledZ);Vn(o,l,u,s,c,p,a.posMatrix,e,d,m,n.style.map.terrain?(e,t)=>n.style.map.terrain.getElevation(a,e,t):null)}}}(i,t,r,n,r.layout.get(`text-rotation-alignment`),r.layout.get(`text-pitch-alignment`),a),r.paint.get(`icon-opacity`).constantOr(1)!==0&&Un(t,n,r,i,!1,r.paint.get(`icon-translate`),r.paint.get(`icon-translate-anchor`),r.layout.get(`icon-rotation-alignment`),r.layout.get(`icon-pitch-alignment`),r.layout.get(`icon-keep-upright`),o,s),r.paint.get(`text-opacity`).constantOr(1)!==0&&Un(t,n,r,i,!0,r.paint.get(`text-translate`),r.paint.get(`text-translate-anchor`),r.layout.get(`text-rotation-alignment`),r.layout.get(`text-pitch-alignment`),r.layout.get(`text-keep-upright`),o,s),n.map.showCollisionBoxes&&(Rn(t,n,r,i,r.paint.get(`text-translate`),r.paint.get(`text-translate-anchor`),!0),Rn(t,n,r,i,r.paint.get(`icon-translate`),r.paint.get(`icon-translate-anchor`),!1))})(t,n,r,i,this.style.placement.variableOffsets);break;case`circle`:(function(t,n,r,i){if(t.renderPass!==`translucent`)return;let a=r.paint.get(`circle-opacity`),o=r.paint.get(`circle-stroke-width`),s=r.paint.get(`circle-stroke-opacity`),c=!r.layout.get(`circle-sort-key`).isConstant();if(a.constantOr(1)===0&&(o.constantOr(1)===0||s.constantOr(1)===0))return;let l=t.context,u=l.gl,d=t.depthModeForSublayer(0,Nn.ReadOnly),f=Fn.disabled,p=t.colorModeForRenderPass(),m=[];for(let a=0;a<i.length;a++){let o=i[a],s=n.getTile(o),l=s.getBucket(r);if(!l)continue;let u=l.programConfigurations.get(r.id),d=t.useProgram(`circle`,u),f=l.layoutVertexBuffer,p=l.indexBuffer,h=t.style.map.terrain&&t.style.map.terrain.getTerrainData(o),g={programConfiguration:u,program:d,layoutVertexBuffer:f,indexBuffer:p,uniformValues:St(t,o,s,r),terrainData:h};if(c){let t=l.segments.get();for(let n of t)m.push({segments:new e.S([n]),sortKey:n.sortKey,state:g})}else m.push({segments:l.segments,sortKey:0,state:g})}c&&m.sort(((e,t)=>e.sortKey-t.sortKey));for(let e of m){let{programConfiguration:n,program:i,layoutVertexBuffer:a,indexBuffer:o,uniformValues:s,terrainData:c}=e.state;i.draw(l,u.TRIANGLES,d,f,p,In.disabled,s,c,r.id,a,o,e.segments,r.paint,t.transform.zoom,n)}})(t,n,r,i);break;case`heatmap`:(function(t,n,r,i){if(r.paint.get(`heatmap-opacity`)!==0)if(t.renderPass===`offscreen`){let a=t.context,o=a.gl,s=Fn.disabled,c=new jn([o.ONE,o.ONE],e.aT.transparent,[!0,!0,!0,!0]);(function(e,t,n){let r=e.gl;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);let i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),e.bindFramebuffer.set(i.framebuffer);else{let a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1,!1),function(e,t,n,r){let i=e.gl,a=e.HALF_FLOAT??i.UNSIGNED_BYTE,o=e.RGBA16F??i.RGBA;i.texImage2D(i.TEXTURE_2D,0,o,t.width/4,t.height/4,0,i.RGBA,a,null),r.colorAttachment.set(n)}(e,t,a,i)}})(a,t,r),a.clear({color:e.aT.transparent});for(let e=0;e<i.length;e++){let l=i[e];if(n.hasRenderableParent(l))continue;let u=n.getTile(l),d=u.getBucket(r);if(!d)continue;let f=d.programConfigurations.get(r.id),p=t.useProgram(`heatmap`,f),{zoom:m}=t.transform;p.draw(a,o.TRIANGLES,Nn.disabled,s,c,In.disabled,Et(l.posMatrix,u,m,r.paint.get(`heatmap-intensity`)),null,r.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,r.paint,t.transform.zoom,f)}a.viewport.set([0,0,t.width,t.height])}else t.renderPass===`translucent`&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){let r=t.context,i=r.gl,a=n.heatmapFbo;if(!a)return;r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);let o=n.colorRampTexture;o||=n.colorRampTexture=new y(r,n.colorRamp,i.RGBA),o.bind(i.LINEAR,i.CLAMP_TO_EDGE),t.useProgram(`heatmapTexture`).draw(r,i.TRIANGLES,Nn.disabled,Fn.disabled,t.colorModeForRenderPass(),In.disabled,((t,n,r,i)=>{let a=e.Z();e.aS(a,0,t.width,t.height,0,0,1);let o=t.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get(`heatmap-opacity`)}})(t,n),null,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}(t,r))})(t,n,r,i);break;case`line`:(function(t,n,r,i){if(t.renderPass!==`translucent`)return;let a=r.paint.get(`line-opacity`),o=r.paint.get(`line-width`);if(a.constantOr(1)===0||o.constantOr(1)===0)return;let s=t.depthModeForSublayer(0,Nn.ReadOnly),c=t.colorModeForRenderPass(),l=r.paint.get(`line-dasharray`),u=r.paint.get(`line-pattern`),d=u.constantOr(1),f=r.paint.get(`line-gradient`),p=r.getCrossfadeParameters(),m=d?`linePattern`:l?`lineSDF`:f?`lineGradient`:`line`,h=t.context,g=h.gl,_=!0;for(let a of i){let i=n.getTile(a);if(d&&!i.patternsLoaded())continue;let o=i.getBucket(r);if(!o)continue;let v=o.programConfigurations.get(r.id),b=t.context.program.get(),x=t.useProgram(m,v),S=_||x.program!==b,C=t.style.map.terrain&&t.style.map.terrain.getTerrainData(a),w=u.constantOr(null);if(w&&i.imageAtlas){let e=i.imageAtlas,t=e.patternPositions[w.to.toString()],n=e.patternPositions[w.from.toString()];t&&n&&v.setConstantPatternPositions(t,n)}let E=C?a:null,D=d?At(t,i,r,p,E):l?jt(t,i,r,l,p,E):f?kt(t,i,r,o.lineClipsArray.length,E):Ot(t,i,r,E);if(d)h.activeTexture.set(g.TEXTURE0),i.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),v.updatePaintBuffers(p);else if(l&&(S||t.lineAtlas.dirty))h.activeTexture.set(g.TEXTURE0),t.lineAtlas.bind(h);else if(f){let i=o.gradients[r.id],s=i.texture;if(r.gradientVersion!==i.version){let c=256;if(r.stepInterpolant){let r=n.getSource().maxzoom,i=a.canonical.z===r?Math.ceil(1<<t.transform.maxZoom-a.canonical.z):1;c=e.ad(e.aY(o.maxLineLength/e.N*1024*i),256,h.maxTextureSize)}i.gradient=e.aZ({expression:r.gradientExpression(),evaluationKey:`lineProgress`,resolution:c,image:i.gradient||void 0,clips:o.lineClipsArray}),i.texture?i.texture.update(i.gradient):i.texture=new y(h,i.gradient,g.RGBA),i.version=r.gradientVersion,s=i.texture}h.activeTexture.set(g.TEXTURE0),s.bind(r.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}x.draw(h,g.TRIANGLES,s,t.stencilModeForClipping(a),c,In.disabled,D,C,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,r.paint,t.transform.zoom,v,o.layoutVertexBuffer2),_=!1}})(t,n,r,i);break;case`fill`:(function(t,n,r,i){let a=r.paint.get(`fill-color`),o=r.paint.get(`fill-opacity`);if(o.constantOr(1)===0)return;let s=t.colorModeForRenderPass(),c=r.paint.get(`fill-pattern`),l=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&a.constantOr(e.aT.transparent).a===1&&o.constantOr(0)===1?`opaque`:`translucent`;t.renderPass===l&&Kn(t,n,r,i,t.depthModeForSublayer(1,t.renderPass===`opaque`?Nn.ReadWrite:Nn.ReadOnly),s,!1),t.renderPass===`translucent`&&r.paint.get(`fill-antialias`)&&Kn(t,n,r,i,t.depthModeForSublayer(r.getPaintProperty(`fill-outline-color`)?2:0,Nn.ReadOnly),s,!0)})(t,n,r,i);break;case`fill-extrusion`:(function(e,t,n,r){let i=n.paint.get(`fill-extrusion-opacity`);if(i!==0&&e.renderPass===`translucent`){let a=new Nn(e.context.gl.LEQUAL,Nn.ReadWrite,e.depthRangeFor3D);if(i!==1||n.paint.get(`fill-extrusion-pattern`).constantOr(1))qn(e,t,n,r,a,Fn.disabled,jn.disabled),qn(e,t,n,r,a,e.stencilModeFor3D(),e.colorModeForRenderPass());else{let i=e.colorModeForRenderPass();qn(e,t,n,r,a,Fn.disabled,i)}}})(t,n,r,i);break;case`hillshade`:(function(e,t,n,r){if(e.renderPass!==`offscreen`&&e.renderPass!==`translucent`)return;let i=e.context,a=e.depthModeForSublayer(0,Nn.ReadOnly),o=e.colorModeForRenderPass(),[s,c]=e.renderPass===`translucent`?e.stencilConfigForOverlap(r):[{},r];for(let r of c){let i=t.getTile(r);i.needsHillshadePrepare!==void 0&&i.needsHillshadePrepare&&e.renderPass===`offscreen`?Yn(e,i,n,a,Fn.disabled,o):e.renderPass===`translucent`&&Jn(e,r,i,n,a,s[r.overscaledZ],o)}i.viewport.set([0,0,e.width,e.height])})(t,n,r,i);break;case`raster`:(function(e,t,n,r){if(e.renderPass!==`translucent`||n.paint.get(`raster-opacity`)===0||!r.length)return;let i=e.context,a=i.gl,o=t.getSource(),s=e.useProgram(`raster`),c=e.colorModeForRenderPass(),[l,u]=o instanceof B?[{},r]:e.stencilConfigForOverlap(r),d=u[u.length-1].overscaledZ,f=!e.options.moving;for(let r of u){let u=e.depthModeForSublayer(r.overscaledZ-d,n.paint.get(`raster-opacity`)===1?Nn.ReadWrite:Nn.ReadOnly,a.LESS),p=t.getTile(r);p.registerFadeDuration(n.paint.get(`raster-fade-duration`));let m=t.findLoadedParent(r,0),h=Xn(p,m,t,n,e.transform,e.style.map.terrain),g,_,v=n.paint.get(`raster-resampling`)===`nearest`?a.NEAREST:a.LINEAR;i.activeTexture.set(a.TEXTURE0),p.texture.bind(v,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(a.TEXTURE1),m?(m.texture.bind(v,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),g=2**(m.tileID.overscaledZ-p.tileID.overscaledZ),_=[p.tileID.canonical.x*g%1,p.tileID.canonical.y*g%1]):p.texture.bind(v,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);let y=e.style.map.terrain&&e.style.map.terrain.getTerrainData(r),b=y?r:null,x=Pt(b?b.posMatrix:e.transform.calculatePosMatrix(r.toUnwrapped(),f),_||[0,0],g||1,h,n);o instanceof B?s.draw(i,a.TRIANGLES,u,Fn.disabled,c,In.disabled,x,y,n.id,o.boundsBuffer,e.quadTriangleIndexBuffer,o.boundsSegments):s.draw(i,a.TRIANGLES,u,l[r.overscaledZ],c,In.disabled,x,y,n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}})(t,n,r,i);break;case`background`:(function(e,t,n,r){let i=n.paint.get(`background-color`),a=n.paint.get(`background-opacity`);if(a===0)return;let o=e.context,s=o.gl,c=e.transform,l=c.tileSize,u=n.paint.get(`background-pattern`);if(e.isPatternMissing(u))return;let d=!u&&i.a===1&&a===1&&e.opaquePassEnabledForLayer()?`opaque`:`translucent`;if(e.renderPass!==d)return;let f=Fn.disabled,p=e.depthModeForSublayer(0,d===`opaque`?Nn.ReadWrite:Nn.ReadOnly),m=e.colorModeForRenderPass(),h=e.useProgram(u?`backgroundPattern`:`background`),g=r||c.coveringTiles({tileSize:l,terrain:e.style.map.terrain});u&&(o.activeTexture.set(s.TEXTURE0),e.imageManager.bind(e.context));let _=n.getCrossfadeParameters();for(let t of g){let c=r?t.posMatrix:e.transform.calculatePosMatrix(t.toUnwrapped()),d=u?Bt(c,a,e,u,{tileID:t,tileSize:l},_):zt(c,a,i),g=e.style.map.terrain&&e.style.map.terrain.getTerrainData(t);h.draw(o,s.TRIANGLES,p,f,m,In.disabled,d,g,n.id,e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments)}})(t,0,r,i);break;case`custom`:(function(e,t,n){let r=e.context,i=n.implementation;if(e.renderPass===`offscreen`){let t=i.prerender;t&&(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),t.call(i,r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState())}else if(e.renderPass===`translucent`){e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(Fn.disabled);let t=i.renderingMode===`3d`?new Nn(e.context.gl.LEQUAL,Nn.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Nn.ReadOnly);r.setDepthMode(t),i.render(r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}})(t,0,r)}}translatePosMatrix(t,n,r,i,a){if(!r[0]&&!r[1])return t;let o=a?i===`map`?this.transform.angle:0:i===`viewport`?-this.transform.angle:0;if(o){let e=Math.sin(o),t=Math.cos(o);r=[r[0]*t-r[1]*e,r[0]*e+r[1]*t]}let s=[a?r[0]:Pe(n,r[0],this.transform.zoom),a?r[1]:Pe(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return e.$(c,t,s),c}saveTileTexture(e){let t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n}useProgram(e,t){this.cache=this.cache||{};let n=e+(t?t.cacheKey:``)+(this._showOverdrawInspector?`/overdraw`:``)+(this.style.map.terrain?`/terrain`:``);return this.cache[n]||(this.cache[n]=new mt(this.context,ut[e],t,Vt[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[n]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas??(this.debugOverlayCanvas=document.createElement(`canvas`),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:t}=this.context.gl;return this.width!==e||this.height!==t}}class cr{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(t,n,r){let i=2**r,a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{let a=1/(r=e.ag([],r,t))[3]/n*i;return e.b3(r,r,[a,a,1/r[3],a])}));return new cr(a,[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{let t=function(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}([],function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],c=n[2];return e[0]=i*c-a*s,e[1]=a*o-r*c,e[2]=r*s-i*o,e}([],h([],a[e[0]],a[e[1]]),h([],a[e[2]],a[e[1]]))),n=-((r=t)[0]*(i=a[e[1]])[0]+r[1]*i[1]+r[2]*i[2]);var r,i;return t.concat(n)})))}}class lr{constructor(e,t){this.min=e,this.max=t,this.center=function(e,t,n){return e[0]=.5*t[0],e[1]=.5*t[1],e[2]=.5*t[2],e}([],function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}([],this.min,this.max))}quadrant(e){let t=[e%2==0,e<2],n=p(this.min),r=p(this.max);for(let e=0;e<t.length;e++)n[e]=t[e]?this.min[e]:this.center[e],r[e]=t[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new lr(n,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(t){let n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],r=!0;for(let i=0;i<t.planes.length;i++){let a=t.planes[i],o=0;for(let t=0;t<n.length;t++)e.b4(a,n[t])>=0&&o++;if(o===0)return 0;o!==n.length&&(r=!1)}if(r)return 2;for(let e=0;e<3;e++){let n=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<t.points.length;i++){let a=t.points[i][e]-this.min[e];n=Math.min(n,a),r=Math.max(r,a)}if(r<0||n>this.max[e]-this.min[e])return 0}return 1}}class ur{constructor(e=0,t=0,n=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0)throw Error(`Invalid value for edge-insets, top, bottom, left and right must all be numbers`);this.top=e,this.bottom=t,this.left=n,this.right=r}interpolate(t,n,r){return n.top!=null&&t.top!=null&&(this.top=e.B.number(t.top,n.top,r)),n.bottom!=null&&t.bottom!=null&&(this.bottom=e.B.number(t.bottom,n.bottom,r)),n.left!=null&&t.left!=null&&(this.left=e.B.number(t.left,n.left,r)),n.right!=null&&t.right!=null&&(this.right=e.B.number(t.right,n.right,r)),this}getCenter(t,n){let r=e.ad((this.left+t-this.right)/2,0,t),i=e.ad((this.top+n-this.bottom)/2,0,n);return new e.P(r,i)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ur(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class dr{constructor(t,n,r,i,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=a===void 0||!!a,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=r??0,this._maxPitch=i??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ur,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){let e=new dr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this._minEleveationForCurrentTile=e._minEleveationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){let n=-e.b5(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var t=new e.A(4);return e.A!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}(),function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);e[0]=r*c+a*s,e[1]=i*c+o*s,e[2]=r*-s+a*c,e[3]=i*-s+o*c}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let n=e.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){let t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._zoom=t,this.tileZoom=Math.max(0,Math.floor(t)),this.scale=this.zoomScale(t),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){let n=[new e.b6(0,t)];if(this._renderWorldCopies){let r=this.pointCoordinate(new e.P(0,0)),i=this.pointCoordinate(new e.P(this.width,0)),a=this.pointCoordinate(new e.P(this.width,this.height)),o=this.pointCoordinate(new e.P(0,this.height)),s=Math.floor(Math.min(r.x,i.x,a.x,o.x)),c=Math.floor(Math.max(r.x,i.x,a.x,o.x));for(let r=s-1;r<=c+1;r++)r!==0&&n.push(new e.b6(r,t))}return n}coveringTiles(t){let n=this.coveringZoomLevel(t),r=n;if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);let i=this.pointCoordinate(this.getCameraPoint()),a=e.U.fromLngLat(this.center),o=2**n,s=[o*i.x,o*i.y,0],c=[o*a.x,o*a.y,0],l=cr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),u=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(u=n);let d=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,f=e=>({aabb:new lr([e*o,0,0],[(e+1)*o,o,0]),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),p=[],m=[],h=n,_=t.reparseOverscaled?r:n;if(this._renderWorldCopies)for(let e=1;e<=3;e++)p.push(f(-e)),p.push(f(e));for(p.push(f(0));p.length>0;){let n=p.pop(),r=n.x,i=n.y,a=n.fullyVisible;if(!a){let e=n.aabb.intersects(l);if(e===0)continue;a=e===2}let o=t.terrain?s:c,f=n.aabb.distanceX(o),v=n.aabb.distanceY(o),y=Math.max(Math.abs(f),Math.abs(v));if(n.zoom===h||y>d+(1<<h-n.zoom)-2&&n.zoom>=u){let t=h-n.zoom,a=s[0]-.5-(r<<t),o=s[1]-.5-(i<<t);m.push({tileID:new e.O(n.zoom===h?_:n.zoom,n.wrap,n.zoom,r,i),distanceSq:g([c[0]-.5-r,c[1]-.5-i]),tileDistanceToCamera:Math.sqrt(a*a+o*o)})}else for(let o=0;o<4;o++){let s=(r<<1)+o%2,c=(i<<1)+(o>>1),l=n.zoom+1,u=n.aabb.quadrant(o);if(t.terrain){let r=new e.O(l,n.wrap,l,s,c),i=t.terrain.getMinMaxElevation(r),a=i.minElevation??this.elevation,o=i.maxElevation??this.elevation;u=new lr([u.min[0],u.min[1],a],[u.max[0],u.max[1],o])}p.push({aabb:u,zoom:l,x:s,y:c,wrap:n.wrap,fullyVisible:a})}}return m.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return 2**e}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){let n=e.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new e.P(e.G(t.lng)*this.worldSize,e.H(n)*this.worldSize)}unproject(t){return new e.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){let n=this.pointLocation(this.centerPoint,t),r=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-r))return;let i=this.getCameraPosition(),a=e.U.fromLngLat(i.lngLat,i.altitude),o=e.U.fromLngLat(n,r),s=a.x-o.x,c=a.y-o.y,l=a.z-o.z,u=Math.sqrt(s*s+c*c+l*l),d=this.scaleZoom(this.cameraToCenterDistance/u/this.tileSize);this._elevation=r,this._center=n,this.zoom=d}setLocationAtPoint(t,n){let r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(t),o=new e.U(a.x-(r.x-i.x),a.y-(r.y-i.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,t){return t?this.coordinatePoint(this.locationCoordinate(e),t.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,t){return this.coordinateLocation(this.pointCoordinate(e,t))}locationCoordinate(t){return e.U.fromLngLat(t)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(t,n){if(n){let e=n.pointCoordinate(t);if(e!=null)return e}let r=[t.x,t.y,0,1],i=[t.x,t.y,1,1];e.ag(r,r,this.pixelMatrixInverse),e.ag(i,i,this.pixelMatrixInverse);let a=r[3],o=i[3],s=r[1]/a,c=i[1]/o,l=r[2]/a,u=i[2]/o,d=l===u?0:(0-l)/(u-l);return new e.U(e.B.number(r[0]/a,i[0]/o,d)/this.worldSize,e.B.number(s,c,d)/this.worldSize)}coordinatePoint(t,n=0,r=this.pixelMatrix){let i=[t.x*this.worldSize,t.y*this.worldSize,n,1];return e.ag(i,i,r),new e.P(i[0]/i[3],i[1]/i[3])}getBounds(){let t=Math.max(0,this.height/2-this.getHorizon());return new N().extend(this.pointLocation(new e.P(0,t))).extend(this.pointLocation(new e.P(this.width,t))).extend(this.pointLocation(new e.P(this.width,this.height))).extend(this.pointLocation(new e.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new N([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){let r=t.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];let a=t.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+2**a.z*t.wrap,c=e.ao(new Float64Array(16));return e.$(c,c,[s*o,a.y*o,0]),e.a0(c,c,[o/e.N,o/e.N,1]),e.a1(c,n?this.alignedProjMatrix:this.projMatrix,c),i[r]=new Float32Array(c),i[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,r,i,a=-90,o=90,s=-180,c=180,l=this.size,u=this._unmodified;if(this.latRange){let n=this.latRange;a=e.H(n[1])*this.worldSize,o=e.H(n[0])*this.worldSize,t=o-a<l.y?l.y/(o-a):0}if(this.lngRange){let t=this.lngRange;s=e.b5(e.G(t[0])*this.worldSize,0,this.worldSize),c=e.b5(e.G(t[1])*this.worldSize,0,this.worldSize),c<s&&(c+=this.worldSize),n=c-s<l.x?l.x/(c-s):0}let d=this.point,f=Math.max(n||0,t||0);if(f)return this.center=this.unproject(new e.P(n?(c+s)/2:d.x,t?(o+a)/2:d.y)),this.zoom+=this.scaleZoom(f),this._unmodified=u,void(this._constraining=!1);if(this.latRange){let e=d.y,t=l.y/2;e-t<a&&(i=a+t),e+t>o&&(i=o-t)}if(this.lngRange){let t=(s+c)/2,n=e.b5(d.x,t-this.worldSize/2,t+this.worldSize/2),i=l.x/2;n-i<s&&(r=s+i),n+i>c&&(r=c-i)}r===void 0&&i===void 0||(this.center=this.unproject(new e.P(r===void 0?d.x:r,i===void 0?d.y:i)).wrap()),this._unmodified=u,this._constraining=!1}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,n=this.point.x,r=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=e.b7(1,this.center.lat)*this.worldSize;let i=e.ao(new Float64Array(16));e.a0(i,i,[this.width/2,-this.height/2,1]),e.$(i,i,[1,-1,0]),this.labelPlaneMatrix=i,i=e.ao(new Float64Array(16)),e.a0(i,i,[1,-1,1]),e.$(i,i,[-1,-1,0]),e.a0(i,i,[2/this.width,2/this.height,1]),this.glCoordMatrix=i;let a=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),o=Math.min(this.elevation,this._minEleveationForCurrentTile),s=a-o*this._pixelPerMeter/Math.cos(this._pitch),c=o<0?s:a,l=Math.PI/2+this._pitch,u=this._fov*(.5+t.y/this.height),d=Math.sin(u)*c/Math.sin(e.ad(Math.PI-l-u,.01,Math.PI-.01)),f=this.getHorizon(),p=2*Math.atan(f/this.cameraToCenterDistance)*(.5+t.y/(2*f)),m=Math.sin(p)*c/Math.sin(e.ad(Math.PI-l-p,.01,Math.PI-.01)),h=Math.min(d,m),g=1.01*(Math.cos(Math.PI/2-this._pitch)*h+c),_=this.height/50;i=new Float64Array(16),e.b8(i,this._fov,this.width/this.height,_,g),i[8]=2*-t.x/this.width,i[9]=2*t.y/this.height,e.a0(i,i,[1,-1,1]),e.$(i,i,[0,0,-this.cameraToCenterDistance]),e.b9(i,i,this._pitch),e.ae(i,i,this.angle),e.$(i,i,[-n,-r,0]),this.mercatorMatrix=e.a0([],i,[this.worldSize,this.worldSize,this.worldSize]),e.a0(i,i,[1,1,this._pixelPerMeter]),this.pixelMatrix=e.a1(new Float64Array(16),this.labelPlaneMatrix,i),e.$(i,i,[0,0,-this.elevation]),this.projMatrix=i,this.invProjMatrix=e.as([],i),this.pixelMatrix3D=e.a1(new Float64Array(16),this.labelPlaneMatrix,i);let v=this.width%2/2,y=this.height%2/2,b=Math.cos(this.angle),x=Math.sin(this.angle),S=n-Math.round(n)+b*v+x*y,C=r-Math.round(r)+b*y+x*v,w=new Float64Array(i);if(e.$(w,w,[S>.5?S-1:S,C>.5?C-1:C,0]),this.alignedProjMatrix=w,i=e.as(new Float64Array(16),this.pixelMatrix),!i)throw Error(`failed to invert matrix`);this.pixelMatrixInverse=i,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let t=this.pointCoordinate(new e.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.ag(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}getCameraQueryGeometry(t){let n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let r=n.x,i=n.y,a=n.x,o=n.y;for(let e of t)r=Math.min(r,e.x),i=Math.min(i,e.y),a=Math.max(a,e.x),o=Math.max(o,e.y);return[new e.P(r,i),new e.P(a,i),new e.P(a,o),new e.P(r,o),new e.P(r,i)]}}}function fr(e,t){let n,r=!1,i=null,a=null,o=()=>{i=null,r&&=(e.apply(a,n),i=setTimeout(o,t),!1)};return(...e)=>(r=!0,a=this,n=e,i||o(),i)}class pr{constructor(e){this._getCurrentHash=()=>{let e=window.location.hash.replace(`#`,``);if(this._hashName){let t;return e.split(`&`).map((e=>e.split(`=`))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||``).split(`/`)}return e.split(`/`)},this._onHashChange=()=>{let e=this._getCurrentHash();if(e.length>=3&&!e.some((e=>isNaN(e)))){let t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let e=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,e)}catch{}},this._updateHash=fr(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener(`hashchange`,this._onHashChange,!1),this._map.on(`moveend`,this._updateHash),this}remove(){return removeEventListener(`hashchange`,this._onHashChange,!1),this._map.off(`moveend`,this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){let t=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,r=10**Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.round(t.lng*r)/r,a=Math.round(t.lat*r)/r,o=this._map.getBearing(),s=this._map.getPitch(),c=``;if(c+=e?`/${i}/${a}/${n}`:`${n}/${a}/${i}`,(o||s)&&(c+=`/`+Math.round(10*o)/10),s&&(c+=`/${Math.round(s)}`),this._hashName){let e=this._hashName,t=!1,n=window.location.hash.slice(1).split(`&`).map((n=>{let r=n.split(`=`)[0];return r===e?(t=!0,`${r}=${c}`):n})).filter((e=>e));return t||n.push(`${e}=${c}`),`#${n.join(`&`)}`}return`#${c}`}}let mr={linearity:.3,easing:e.ba(0,0,.3,1)},hr=e.e({deceleration:2500,maxSpeed:1400},mr),gr=e.e({deceleration:20,maxSpeed:1400},mr),_r=e.e({deceleration:1e3,maxSpeed:360},mr),vr=e.e({deceleration:1e3,maxSpeed:90},mr);class yr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.h.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,n=e.h.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let n={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);let r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(n.pan.mag()){let a=xr(n.pan.mag(),r,e.e({},hr,t||{}));i.offset=n.pan.mult(a.amount/n.pan.mag()),i.center=this._map.transform.center,br(i,a)}if(n.zoom){let e=xr(n.zoom,r,gr);i.zoom=this._map.transform.zoom+e.amount,br(i,e)}if(n.bearing){let t=xr(n.bearing,r,_r);i.bearing=this._map.transform.bearing+e.ad(t.amount,-179,179),br(i,t)}if(n.pitch){let e=xr(n.pitch,r,vr);i.pitch=this._map.transform.pitch+e.amount,br(i,e)}if(i.zoom||i.bearing){let e=n.pinchAround===void 0?n.around:n.pinchAround;i.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),e.e(i,{noMoveStart:!0})}}function br(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function xr(t,n,r){let{maxSpeed:i,linearity:a,deceleration:o}=r,s=e.ad(t*a/(n/1e3),-i,i),c=Math.abs(s)/(o*a);return{easing:r.easing,duration:1e3*c,amount:c/2*s}}class Sr extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,i,a={}){let o=n.mousePos(r.getCanvasContainer(),i),s=r.unproject(o);super(t,e.e({point:o,lngLat:s,originalEvent:i},a)),this._defaultPrevented=!1,this.target=r}}class Cr extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,i){let a=t===`touchend`?i.changedTouches:i.touches,o=n.touchPos(r.getCanvasContainer(),a),s=o.map((e=>r.unproject(e))),c=o.reduce(((e,t,n,r)=>e.add(t.div(r.length))),new e.P(0,0));super(t,{points:o,point:c,lngLats:s,lngLat:r.unproject(c),originalEvent:i}),this._defaultPrevented=!1}}class wr extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class Tr{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new wr(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Sr(e.type,this._map,e))}mouseup(e){this._map.fire(new Sr(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new Sr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Sr(e.type,this._map,e))}mouseover(e){this._map.fire(new Sr(e.type,this._map,e))}mouseout(e){this._map.fire(new Sr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Cr(e.type,this._map,e))}touchmove(e){this._map.fire(new Cr(e.type,this._map,e))}touchend(e){this._map.fire(new Cr(e.type,this._map,e))}touchcancel(e){this._map.fire(new Cr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Er{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Sr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Sr(`contextmenu`,this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Sr(e.type,this._map,e)),this._map.listens(`contextmenu`)&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dr{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(e.P.convert(t),this._map.terrain)}}class Or{constructor(e,t){this._map=e,this._tr=new Dr(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&e.button===0&&(n.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;let r=t;if(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)return;let i=this._startPos;this._lastPos=r,this._box||(this._box=n.create(`div`,`maplibregl-boxzoom`,this._container),this._container.classList.add(`maplibregl-crosshair`),this._fireEvent(`boxzoomstart`,e));let a=Math.min(i.x,r.x),o=Math.max(i.x,r.x),s=Math.min(i.y,r.y),c=Math.max(i.y,r.y);n.setTransform(this._box,`translate(${a}px,${s}px)`),this._box.style.width=o-a+`px`,this._box.style.height=c-s+`px`}mouseupWindow(t,r){if(!this._active||t.button!==0)return;let i=this._startPos,a=r;if(this.reset(),n.suppressClick(),i.x!==a.x||i.y!==a.y)return this._map.fire(new e.k(`boxzoomend`,{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(i,a,this._tr.bearing,{linear:!0})};this._fireEvent(`boxzoomcancel`,t)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent(`boxzoomcancel`,e))}reset(){this._active=!1,this._container.classList.remove(`maplibregl-crosshair`),this._box&&=(n.remove(this._box),null),n.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new e.k(t,{originalEvent:n}))}}function kr(e,t){if(e.length!==t.length)throw Error(`The number of touches and points are not equal - touches ${e.length}, points ${t.length}`);let n={};for(let r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}class Ar{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){let n=new e.P(0,0);for(let e of t)n._add(e);return n.div(t.length)}(n),this.touches=kr(r,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;let r=kr(n,t);for(let e in this.touches){let t=r[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),n.length===0){let e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class jr{constructor(e){this.singleTap=new Ar(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){let r=this.singleTap.touchend(e,t,n);if(r){let t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(r)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Mr{constructor(e){this._tr=new Dr(e),this._zoomIn=new jr({numTouches:1,numTaps:2}),this._zoomOut=new jr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){let r=this._zoomIn.touchend(e,t,n),i=this._zoomOut.touchend(e,t,n),a=this._tr;return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:a.zoom+1,around:a.unproject(r)},{originalEvent:e})}):i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:a.zoom-1,around:a.unproject(i)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let t=this._moveFunction(...e);if(t.bearingDelta||t.pitchDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(e,t){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=t.length?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,t){if(!this.isEnabled())return;let n=this._lastPoint;if(!n)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let r=t.length?t[0]:t;return!this._moved&&r.dist(n)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=r,this._move(n,r))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&n.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Pr={0:1,2:2};class Fr{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){this._eventButton=n.mouseButton(e)}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(e,t){let n=Pr[t];return e.buttons===void 0||(e.buttons&n)!==n}(e,this._eventButton)}isValidEndEvent(e){return n.mouseButton(e)===this._eventButton}}class Ir{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}let Lr=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=function(e){e.preventDefault()}},Rr=({enable:e,clickTolerance:t,bearingDegreesPerPixelMoved:r=.8})=>new Nr({clickTolerance:t,move:(e,t)=>({bearingDelta:(t.x-e.x)*r}),moveStateManager:new Fr({checkCorrectEvent:e=>n.mouseButton(e)===0&&e.ctrlKey||n.mouseButton(e)===2}),enable:e,assignEvents:Lr}),zr=({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:r=-.5})=>new Nr({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*r}),moveStateManager:new Fr({checkCorrectEvent:e=>n.mouseButton(e)===0&&e.ctrlKey||n.mouseButton(e)===2}),enable:e,assignEvents:Lr});class Br{constructor(e,t){this._minTouches=e.cooperativeGestures?2:1,this._clickTolerance=e.clickTolerance||1,this._map=t,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0),setTimeout((()=>{this._cancelCooperativeMessage=!1}),200)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._map._cooperativeGestures&&(this._minTouches===2&&n.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(e,!1,n.length):this._cancelCooperativeMessage||=!0),this._active&&!(n.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,t,n)}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,r){r.length>0&&(this._active=!0);let i=kr(r,n),a=new e.P(0,0),o=new e.P(0,0),s=0;for(let e in i){let t=i[e],n=this._touches[e];n&&(a._add(t),o._add(t.sub(n)),s++,i[e]=t)}if(this._touches=i,s<this._minTouches||!o.mag())return;let c=o.div(s);return this._sum._add(c),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:c}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){if(!this._firstTwoTouches)return;e.preventDefault();let[r,i]=this._firstTwoTouches,a=Hr(n,t,r),o=Hr(n,t,i);if(!a||!o)return;let s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,e)}touchend(e,t,r){if(!this._firstTwoTouches)return;let[i,a]=this._firstTwoTouches,o=Hr(r,t,i),s=Hr(r,t,a);o&&s||(this._active&&n.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around===`center`}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Hr(e,t,n){for(let r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function Ur(e,t){return Math.log(e/t)/Math.LN2}class Wr extends Vr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){let n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ur(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ur(this._distance,n),pinchAround:t}}}function Gr(e,t){return 180*e.angleWith(t)/Math.PI}class Kr extends Vr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){let n=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gr(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let t=25/(Math.PI*this._minDiameter)*360,n=Gr(e,this._startVector);return Math.abs(n)<t}}function qr(e){return Math.abs(e.y)>Math.abs(e.x)}class Jr extends Vr{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,t,n){super.touchstart(e,t,n),this._currentTouchCount=n.length}_start(e){this._lastPoints=e,qr(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;let r=e[0].sub(this._lastPoints[0]),i=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}):void 0}gestureBeginsVertically(e,t,n){if(this._valid!==void 0)return this._valid;let r=e.mag()>=2,i=t.mag()>=2;if(!r&&!i)return;if(!r||!i)return this._firstMove===void 0&&(this._firstMove=n),n-this._firstMove<100&&void 0;let a=e.y>0==t.y>0;return qr(e)&&qr(t)&&a}}let Yr={panStep:100,bearingStep:15,pitchStep:10};class Xr{constructor(e){this._tr=new Dr(e);let t=Yr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,r=0,i=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),i=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),i=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(n=0,r=0),{cameraAnimation:o=>{let s=this._tr;o.easeTo({duration:300,easeId:`keyboardHandler`,easing:Zr,zoom:t?Math.round(s.zoom)+t*(e.shiftKey?2:1):s.zoom,bearing:s.bearing+n*this._bearingStep,pitch:s.pitch+r*this._pitchStep,offset:[-i*this._panStep,-a*this._panStep],center:s.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zr(e){return e*(2-e)}let Qr=4.000244140625;class $r{constructor(e,t){this._onTimeout=e=>{this._type=`wheel`,this._delta-=this._lastValue,this._active||this._start(e)},this._map=e,this._tr=new Dr(e),this._el=e.getCanvasContainer(),this._triggerRenderFrame=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around===`center`)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,r=e.h.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,n!==0&&n%Qr==0?this._type=`wheel`:n!==0&&Math.abs(n)<4?this._type=`trackpad`:i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*n)<200?`trackpad`:`wheel`,this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&=null,this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let r=n.mousePos(this._el,t),i=this._tr;this._around=e.L.convert(this._aroundCenter?i.center:i.unproject(r)),this._aroundPoint=i.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._tr.transform;if(this._delta!==0){let e=this._type===`wheel`&&Math.abs(this._delta)>Qr?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&n!==0&&(n=1/n);let r=typeof this._targetZoom==`number`?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(r*n))),this._type===`wheel`&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let n=typeof this._targetZoom==`number`?this._targetZoom:t.zoom,r=this._startZoom,i=this._easing,a,o=!1;if(this._type===`wheel`&&r&&i){let t=Math.min((e.h.now()-this._lastWheelEventTime)/200,1),s=i(t);a=e.B.number(r,n,s),t<1?this._frameId||=!0:o=!0}else a=n,o=!0;return this._active=!0,o&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!o,zoomDelta:a-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=e.bb;if(this._prevEase){let t=this._prevEase,r=(e.h.now()-t.start)/t.duration,i=t.easing(r+.01)-t.easing(r),a=.27/Math.sqrt(i*i+1e-4)*.01,o=Math.sqrt(.0729-a*a);n=e.ba(a,o,.25,1)}return this._prevEase={start:e.h.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ei{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ti{constructor(e){this._tr=new Dr(e),this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ni{constructor(){this._tap=new jr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,t,n){if(!this._swipePoint)if(this._tapTime){let r=t[0],i=e.timeStamp-this._tapTime<500,a=this._tapPoint.dist(r)<30;i&&a?n.length>0&&(this._swipePoint=r,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(e,t,n)}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;let r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){if(this._tapTime)this._swipePoint&&n.length===0&&this.reset();else{let r=this._tap.touchend(e,t,n);r&&(this._tapTime=e.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ri{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add(`maplibregl-touch-drag-pan`)}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove(`maplibregl-touch-drag-pan`)}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ii{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ai{constructor(e,t,n,r){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add(`maplibregl-touch-zoom-rotate`)}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove(`maplibregl-touch-zoom-rotate`)}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let oi=e=>e.zoom||e.drag||e.pitch||e.rotate;class si extends e.k{}function ci(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class li{constructor(e,t){this.handleWindowEvent=e=>{this.handleEvent(e,`${e.type}Window`)},this.handleEvent=(e,t)=>{if(e.type===`blur`)return void this.stop(!0);this._updatingCamera=!0;let r=e.type===`renderFrame`?void 0:e,i={needsRenderFrame:!1},a={},o={},s=e.touches,c=s?this._getMapTouches(s):void 0,l=c?n.touchPos(this._el,c):n.mousePos(this._el,e);for(let{handlerName:n,handler:s,allowed:u}of this._handlers){if(!s.isEnabled())continue;let d;this._blockedByActive(o,u,n)?s.reset():s[t||e.type]&&(d=s[t||e.type](e,l,c),this.mergeHandlerResult(i,a,d,n,r),d&&d.needsRenderFrame&&this._triggerRenderFrame()),(d||s.isActive())&&(o[n]=s)}let u={};for(let e in this._previousActiveHandlers)o[e]||(u[e]=r);this._previousActiveHandlers=o,(Object.keys(u).length||ci(i))&&(this._changes.push([i,a,u]),this._triggerRenderFrame()),(Object.keys(o).length||ci(i))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:d}=i;d&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],d(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yr(e),this._bearingSnap=t.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(t);let r=this._el;this._listeners=[[r,`touchstart`,{passive:!0}],[r,`touchmove`,{passive:!1}],[r,`touchend`,void 0],[r,`touchcancel`,void 0],[r,`mousedown`,void 0],[r,`mousemove`,void 0],[r,`mouseup`,void 0],[document,`mousemove`,{capture:!0}],[document,`mouseup`,void 0],[r,`mouseover`,void 0],[r,`mouseout`,void 0],[r,`dblclick`,void 0],[r,`click`,void 0],[r,`keydown`,{capture:!1}],[r,`keyup`,void 0],[r,`wheel`,{passive:!1}],[r,`contextmenu`,void 0],[window,`blur`,void 0]];for(let[e,t,r]of this._listeners)n.addEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(let[e,t,r]of this._listeners)n.removeEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){let t=this._map,r=t.getCanvasContainer();this._add(`mapEvent`,new Tr(t,e));let i=t.boxZoom=new Or(t,e);this._add(`boxZoom`,i),e.interactive&&e.boxZoom&&i.enable();let a=new Mr(t),o=new ti(t);t.doubleClickZoom=new ei(o,a),this._add(`tapZoom`,a),this._add(`clickZoom`,o),e.interactive&&e.doubleClickZoom&&t.doubleClickZoom.enable();let s=new ni;this._add(`tapDragZoom`,s);let c=t.touchPitch=new Jr(t);this._add(`touchPitch`,c),e.interactive&&e.touchPitch&&t.touchPitch.enable(e.touchPitch);let l=Rr(e),u=zr(e);t.dragRotate=new ii(e,l,u),this._add(`mouseRotate`,l,[`mousePitch`]),this._add(`mousePitch`,u,[`mouseRotate`]),e.interactive&&e.dragRotate&&t.dragRotate.enable();let d=(({enable:e,clickTolerance:t})=>new Nr({clickTolerance:t,move:(e,t)=>({around:t,panDelta:t.sub(e)}),activateOnStart:!0,moveStateManager:new Fr({checkCorrectEvent:e=>n.mouseButton(e)===0&&!e.ctrlKey}),enable:e,assignEvents:Lr}))(e),f=new Br(e,t);t.dragPan=new ri(r,d,f),this._add(`mousePan`,d),this._add(`touchPan`,f,[`touchZoom`,`touchRotate`]),e.interactive&&e.dragPan&&t.dragPan.enable(e.dragPan);let p=new Kr,m=new Wr;t.touchZoomRotate=new ai(r,m,p,s),this._add(`touchRotate`,p,[`touchPan`,`touchZoom`]),this._add(`touchZoom`,m,[`touchPan`,`touchRotate`]),e.interactive&&e.touchZoomRotate&&t.touchZoomRotate.enable(e.touchZoomRotate);let h=t.scrollZoom=new $r(t,(()=>this._triggerRenderFrame()));this._add(`scrollZoom`,h,[`mousePan`]),e.interactive&&e.scrollZoom&&t.scrollZoom.enable(e.scrollZoom);let g=t.keyboard=new Xr(t);this._add(`keyboard`,g),e.interactive&&e.keyboard&&t.keyboard.enable(),this._add(`blockableMapEvent`,new Er(t))}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(let{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!oi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,t,n){for(let r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}_getMapTouches(e){let t=[];for(let n of e)this._el.contains(n.target)&&t.push(n);return t}mergeHandlerResult(t,n,r,i,a){if(!r)return;e.e(t,r);let o={handlerName:i,originalEvent:r.originalEvent||a};r.zoomDelta!==void 0&&(n.zoom=o),r.panDelta!==void 0&&(n.drag=o),r.pitchDelta!==void 0&&(n.pitch=o),r.bearingDelta!==void 0&&(n.rotate=o)}_applyChanges(){let t={},n={},r={};for(let[i,a,o]of this._changes)i.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(i.panDelta)),i.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+i.pitchDelta),i.around!==void 0&&(t.around=i.around),i.pinchAround!==void 0&&(t.pinchAround=i.pinchAround),i.noInertia&&(t.noInertia=i.noInertia),e.e(n,a),e.e(r,o);this._updateMapTransform(t,n,r),this._changes=[]}_updateMapTransform(e,t,n){let r=this._map,i=r._getTransformForUpdate(),a=r.terrain;if(!(ci(e)||a&&this._terrainMovement))return this._fireEvents(t,n,!0);let{panDelta:o,zoomDelta:s,bearingDelta:c,pitchDelta:l,around:u,pinchAround:d}=e;d!==void 0&&(u=d),r._stop(!0),u||=r.transform.centerPoint;let f=i.pointLocation(o?u.sub(o):u);c&&(i.bearing+=c),l&&(i.pitch+=l),s&&(i.zoom+=s),a?this._terrainMovement||!t.drag&&!t.zoom?t.drag&&this._terrainMovement?i.center=i.pointLocation(i.centerPoint.sub(o)):i.setLocationAtPoint(f,u):(this._terrainMovement=!0,this._map._elevationFreeze=!0,i.setLocationAtPoint(f,u),this._map.once(`moveend`,(()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,i.recalculateZoom(r.terrain)}))):i.setLocationAtPoint(f,u),r._applyUpdatedTransform(i),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}_fireEvents(t,n,r){let i=oi(this._eventsInProgress),a=oi(t),o={};for(let e in t){let{originalEvent:n}=t[e];this._eventsInProgress[e]||(o[`${e}start`]=n),this._eventsInProgress[e]=t[e]}!i&&a&&this._fireEvent(`movestart`,a.originalEvent);for(let e in o)this._fireEvent(e,o[e]);a&&this._fireEvent(`move`,a.originalEvent);for(let e in t){let{originalEvent:n}=t[e];this._fireEvent(e,n)}let s={},c;for(let e in this._eventsInProgress){let{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],c=n[t]||r,s[`${e}end`]=c)}for(let e in s)this._fireEvent(e,s[e]);let l=oi(this._eventsInProgress);if(r&&(i||a)&&!l){this._updatingCamera=!0;let t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>e!==0&&-this._bearingSnap<e&&e<this._bearingSnap;!t||!t.essential&&e.h.prefersReducedMotion?(this._map.fire(new e.k(`moveend`,{originalEvent:c})),n(this._map.getBearing())&&this._map.resetNorth()):(n(t.bearing||this._map.getBearing())&&(t.bearing=0),t.freezeElevation=!0,this._map.easeTo(t,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new e.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new si(`renderFrame`,{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ui extends e.E{constructor(t,n){super(),this._renderFrameCallback=()=>{let t=Math.min((e.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on(`moveend`,(()=>{delete this._requestedCameraState}))}getCenter(){return new e.L(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,n,r){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},n),r)}panTo(t,n,r){return this.easeTo(e.e({center:t},n),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,n,r){return this.easeTo(e.e({zoom:t},n),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,n,r){return this.easeTo(e.e({bearing:t},n),r)}resetNorth(t,n){return this.rotateTo(0,e.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(e.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=N.convert(e);let n=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,t)}_cameraForBoxAndBearing(t,n,r,i){let a={top:0,bottom:0,right:0,left:0};if(typeof(i=e.e({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding==`number`){let e=i.padding;i.padding={top:e,bottom:e,right:e,left:e}}i.padding=e.e(a,i.padding);let o=this.transform,s=o.padding,c=o.project(e.L.convert(t)),l=o.project(e.L.convert(n)),u=c.rotate(-r*Math.PI/180),d=l.rotate(-r*Math.PI/180),f=new e.P(Math.max(u.x,d.x),Math.max(u.y,d.y)),p=new e.P(Math.min(u.x,d.x),Math.min(u.y,d.y)),m=f.sub(p),h=(o.width-(s.left+s.right+i.padding.left+i.padding.right))/m.x,g=(o.height-(s.top+s.bottom+i.padding.top+i.padding.bottom))/m.y;if(g<0||h<0)return void e.w(`Map cannot fit within canvas with the given bounds, padding, and/or offset.`);let _=Math.min(o.scaleZoom(o.scale*Math.min(h,g)),i.maxZoom),v=e.P.convert(i.offset),y=new e.P((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(r*Math.PI/180),b=v.add(y).mult(o.scale/o.zoomScale(_));return{center:o.unproject(c.add(l).div(2).sub(b)),zoom:_,bearing:r}}fitBounds(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}fitScreenCoordinates(t,n,r,i,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.P.convert(t)),this.transform.pointLocation(e.P.convert(n)),r,i),i,a)}_fitInternal(t,n,r){return t?(delete(n=e.e(t,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this}jumpTo(t,n){this.stop();let r=this._getTransformForUpdate(),i=!1,a=!1,o=!1;return`zoom`in t&&r.zoom!==+t.zoom&&(i=!0,r.zoom=+t.zoom),t.center!==void 0&&(r.center=e.L.convert(t.center)),`bearing`in t&&r.bearing!==+t.bearing&&(a=!0,r.bearing=+t.bearing),`pitch`in t&&r.pitch!==+t.pitch&&(o=!0,r.pitch=+t.pitch),t.padding==null||r.isPaddingEqual(t.padding)||(r.padding=t.padding),this._applyUpdatedTransform(r),this.fire(new e.k(`movestart`,n)).fire(new e.k(`move`,n)),i&&this.fire(new e.k(`zoomstart`,n)).fire(new e.k(`zoom`,n)).fire(new e.k(`zoomend`,n)),a&&this.fire(new e.k(`rotatestart`,n)).fire(new e.k(`rotate`,n)).fire(new e.k(`rotateend`,n)),o&&this.fire(new e.k(`pitchstart`,n)).fire(new e.k(`pitch`,n)).fire(new e.k(`pitchend`,n)),this.fire(new e.k(`moveend`,n))}calculateCameraOptionsFromTo(t,n,r,i=0){let a=e.U.fromLngLat(t,n),o=e.U.fromLngLat(r,i),s=o.x-a.x,c=o.y-a.y,l=o.z-a.z,u=Math.hypot(s,c,l);if(u===0)throw Error(`Can't calculate camera options with same From and To`);let d=Math.hypot(s,c),f=this.transform.scaleZoom(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(s,-c)/Math.PI,m=180*Math.acos(d/u)/Math.PI;return m=l<0?90-m:90+m,{center:o.toLngLat(),zoom:f,pitch:m,bearing:p}}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.bb},t)).animate||!t.essential&&e.h.prefersReducedMotion)&&(t.duration=0);let r=this._getTransformForUpdate(),i=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),c=`zoom`in t?+t.zoom:i,l=`bearing`in t?this._normalizeBearing(t.bearing,a):a,u=`pitch`in t?+t.pitch:o,d=`padding`in t?t.padding:r.padding,f=e.P.convert(t.offset),p=r.centerPoint.add(f),m=r.pointLocation(p),h=e.L.convert(t.center||m);this._normalizeCenter(h);let g=r.project(m),_=r.project(h).sub(g),v=r.zoomScale(c-i),y,b;t.around&&(y=e.L.convert(t.around),b=r.locationPoint(y));let x={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||c!==i,this._rotating=this._rotating||a!==l,this._pitching=this._pitching||u!==o,this._padding=!r.isPaddingEqual(d),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,x),this.terrain&&this._prepareElevation(h),this._ease((m=>{if(this._zooming&&(r.zoom=e.B.number(i,c,m)),this._rotating&&(r.bearing=e.B.number(a,l,m)),this._pitching&&(r.pitch=e.B.number(o,u,m)),this._padding&&(r.interpolatePadding(s,d,m),p=r.centerPoint.add(f)),this.terrain&&!t.freezeElevation&&this._updateElevation(m),y)r.setLocationAtPoint(y,b);else{let e=r.zoomScale(r.zoom-i),t=(c>i?Math.min(2,v):Math.max(.5,v))**(1-m),n=r.unproject(g.add(_.mult(m*t)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?n.wrap():n,p)}this._applyUpdatedTransform(r),this._fireMoveEvents(n)}),(e=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,e)}),t),this}_prepareEase(t,n,r={}){this._moving=!0,n||r.moving||this.fire(new e.k(`movestart`,t)),this._zooming&&!r.zooming&&this.fire(new e.k(`zoomstart`,t)),this._rotating&&!r.rotating&&this.fire(new e.k(`rotatestart`,t)),this._pitching&&!r.pitching&&this.fire(new e.k(`pitchstart`,t))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){let e=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(e-(n-(e*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=e.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||=this.transform.clone(),this._requestedCameraState):this.transform}_applyUpdatedTransform(e){if(!this.transformCameraUpdate)return;let t=e.clone(),{center:n,zoom:r,pitch:i,bearing:a,elevation:o}=this.transformCameraUpdate(t);n&&(t.center=n),r!==void 0&&(t.zoom=r),i!==void 0&&(t.pitch=i),a!==void 0&&(t.bearing=a),o!==void 0&&(t.elevation=o),this.transform.apply(t)}_fireMoveEvents(t){this.fire(new e.k(`move`,t)),this._zooming&&this.fire(new e.k(`zoom`,t)),this._rotating&&this.fire(new e.k(`rotate`,t)),this._pitching&&this.fire(new e.k(`pitch`,t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;let r=this._zooming,i=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.k(`zoomend`,t)),i&&this.fire(new e.k(`rotateend`,t)),a&&this.fire(new e.k(`pitchend`,t)),this.fire(new e.k(`moveend`,t))}flyTo(t,n){if(!t.essential&&e.h.prefersReducedMotion){let r=e.F(t,[`center`,`zoom`,`bearing`,`pitch`,`around`]);return this.jumpTo(r,n)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.bb},t);let r=this._getTransformForUpdate(),i=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),c=`zoom`in t?e.ad(+t.zoom,r.minZoom,r.maxZoom):i,l=`bearing`in t?this._normalizeBearing(t.bearing,a):a,u=`pitch`in t?+t.pitch:o,d=`padding`in t?t.padding:r.padding,f=r.zoomScale(c-i),p=e.P.convert(t.offset),m=r.centerPoint.add(p),h=r.pointLocation(m),g=e.L.convert(t.center||h);this._normalizeCenter(g);let _=r.project(h),v=r.project(g).sub(_),y=t.curve,b=Math.max(r.width,r.height),x=b/f,S=v.mag();if(`minZoom`in t){let n=e.ad(Math.min(t.minZoom,i,c),r.minZoom,r.maxZoom),a=b/r.zoomScale(n-i);y=Math.sqrt(a/S*2)}let C=y*y;function w(e){let t=(x*x-b*b+(e?-1:1)*C*C*S*S)/(2*(e?x:b)*C*S);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function D(e){return(Math.exp(e)+Math.exp(-e))/2}let O=w(!1),k=function(e){return D(O)/D(O+y*e)},A=function(e){return b*((D(O)*(E(t=O+y*e)/D(t))-E(O))/C)/S;var t},j=(w(!0)-O)/y;if(Math.abs(S)<1e-6||!isFinite(j)){if(Math.abs(b-x)<1e-6)return this.easeTo(t,n);let e=x<b?-1:1;j=Math.abs(Math.log(x/b))/y,A=function(){return 0},k=function(t){return Math.exp(e*y*t)}}return t.duration=`duration`in t?+t.duration:1e3*j/(`screenSpeed`in t?+t.screenSpeed/y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=a!==l,this._pitching=u!==o,this._padding=!r.isPaddingEqual(d),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(g),this._ease((f=>{let h=f*j,y=1/k(h);r.zoom=f===1?c:i+r.scaleZoom(y),this._rotating&&(r.bearing=e.B.number(a,l,f)),this._pitching&&(r.pitch=e.B.number(o,u,f)),this._padding&&(r.interpolatePadding(s,d,f),m=r.centerPoint.add(p)),this.terrain&&!t.freezeElevation&&this._updateElevation(f);let b=f===1?g:r.unproject(_.add(v.mult(A(h))).mult(y));r.setLocationAtPoint(r.renderWorldCopies?b.wrap():b,m),this._applyUpdatedTransform(r),this._fireMoveEvents(n)}),(()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}if(!e){let e=this.handlers;e&&e.stop(!1)}return this}_ease(t,n,r){!1===r.animate||r.duration===0?(t(1),n()):(this._easeStart=e.h.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=e.b5(t,-180,180);let r=Math.abs(t-n);return Math.abs(t-360-n)<r&&(t-=360),Math.abs(t+360-n)<r&&(t+=360),t}_normalizeCenter(e){let t=this.transform;if(!t.renderWorldCopies||t.lngRange)return;let n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(e.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class di{constructor(e={}){this._toggleAttribution=()=>{this._container.classList.contains(`maplibregl-compact`)&&(this._container.classList.contains(`maplibregl-compact-show`)?(this._container.setAttribute(`open`,``),this._container.classList.remove(`maplibregl-compact-show`)):(this._container.classList.add(`maplibregl-compact-show`),this._container.removeAttribute(`open`)))},this._updateData=e=>{!e||e.sourceDataType!==`metadata`&&e.sourceDataType!==`visibility`&&e.dataType!==`style`&&e.type!==`terrain`||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute(`open`,``):this._container.classList.contains(`maplibregl-compact`)||this._container.classList.contains(`maplibregl-attrib-empty`)||(this._container.setAttribute(`open`,``),this._container.classList.add(`maplibregl-compact`,`maplibregl-compact-show`)):(this._container.setAttribute(`open`,``),this._container.classList.contains(`maplibregl-compact`)&&this._container.classList.remove(`maplibregl-compact`,`maplibregl-compact-show`))},this._updateCompactMinimize=()=>{this._container.classList.contains(`maplibregl-compact`)&&this._container.classList.contains(`maplibregl-compact-show`)&&this._container.classList.remove(`maplibregl-compact-show`)},this.options=e}getDefaultPosition(){return`bottom-right`}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=n.create(`details`,`maplibregl-ctrl maplibregl-ctrl-attrib`),this._compactButton=n.create(`summary`,`maplibregl-ctrl-attrib-button`,this._container),this._compactButton.addEventListener(`click`,this._toggleAttribution),this._setElementTitle(this._compactButton,`ToggleAttribution`),this._innerContainer=n.create(`div`,`maplibregl-ctrl-attrib-inner`,this._container),this._updateAttributions(),this._updateCompact(),this._map.on(`styledata`,this._updateData),this._map.on(`sourcedata`,this._updateData),this._map.on(`terrain`,this._updateData),this._map.on(`resize`,this._updateCompact),this._map.on(`drag`,this._updateCompactMinimize),this._container}onRemove(){n.remove(this._container),this._map.off(`styledata`,this._updateData),this._map.off(`sourcedata`,this._updateData),this._map.off(`terrain`,this._updateData),this._map.off(`resize`,this._updateCompact),this._map.off(`drag`,this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,t){let n=this._map._getUIString(`AttributionControl.${t}`);e.title=n,e.setAttribute(`aria-label`,n)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((e=>typeof e==`string`?e:``))):typeof this.options.customAttribution==`string`&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}let t=this._map.style.sourceCaches;for(let n in t){let r=t[n];if(r.used||r.usedForTerrain){let t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e=e.filter((e=>String(e).trim())),e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,n)=>{for(let r=n+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0}));let n=e.join(` | `);n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove(`maplibregl-attrib-empty`)):this._container.classList.add(`maplibregl-attrib-empty`),this._updateCompact(),this._editLink=null)}}class fi{constructor(e={}){this._updateCompact=()=>{let e=this._container.children;if(e.length){let t=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&t.classList.add(`maplibregl-compact`):t.classList.remove(`maplibregl-compact`)}},this.options=e}getDefaultPosition(){return`bottom-left`}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=n.create(`div`,`maplibregl-ctrl`);let t=n.create(`a`,`maplibregl-ctrl-logo`);return t.target=`_blank`,t.rel=`noopener nofollow`,t.href=`https://maplibre.org/`,t.setAttribute(`aria-label`,this._map._getUIString(`LogoControl.Title`)),t.setAttribute(`rel`,`noopener nofollow`),this._container.appendChild(t),this._container.style.display=`block`,this._map.on(`resize`,this._updateCompact),this._updateCompact(),this._container}onRemove(){n.remove(this._container),this._map.off(`resize`,this._updateCompact),this._map=void 0,this._compact=void 0}}class pi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){let t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(let t of n)if(t.id===e)return void(t.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw Error(`Attempting to run(), but is already running.`);let t=this._currentlyRunning=this._queue;this._queue=[];for(let n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}let mi={"AttributionControl.ToggleAttribution":`Toggle attribution`,"AttributionControl.MapFeedback":`Map feedback`,"FullscreenControl.Enter":`Enter fullscreen`,"FullscreenControl.Exit":`Exit fullscreen`,"GeolocateControl.FindMyLocation":`Find my location`,"GeolocateControl.LocationNotAvailable":`Location not available`,"LogoControl.Title":`Mapbox logo`,"NavigationControl.ResetBearing":`Reset bearing to north`,"NavigationControl.ZoomIn":`Zoom in`,"NavigationControl.ZoomOut":`Zoom out`,"ScaleControl.Feet":`ft`,"ScaleControl.Meters":`m`,"ScaleControl.Kilometers":`km`,"ScaleControl.Miles":`mi`,"ScaleControl.NauticalMiles":`nm`,"TerrainControl.enableTerrain":`Enable terrain`,"TerrainControl.disableTerrain":`Disable terrain`};var hi=e.Q([{name:`a_pos3d`,type:`Int16`,components:3}]);class gi extends e.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];let r={};for(let i of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))r[i.key]=!0,this._renderableTilesKeys.push(i.key),this._tiles[i.key]||(i.posMatrix=new Float64Array(16),e.aS(i.posMatrix,0,e.N,0,e.N,0,1),this._tiles[i.key]=new se(i,this.tileSize));for(let e in this._tiles)r[e]||delete this._tiles[e]}freeRtt(e){for(let t in this._tiles){let n=this._tiles[t];(!e||n.tileID.equals(e)||n.tileID.isChildOf(e)||e.isChildOf(n.tileID))&&(n.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(t){let n={};for(let r of this._renderableTilesKeys){let i=this._tiles[r].tileID;if(i.canonical.equals(t.canonical)){let i=t.clone();i.posMatrix=new Float64Array(16),e.aS(i.posMatrix,0,e.N,0,e.N,0,1),n[r]=i}else if(i.canonical.isChildOf(t.canonical)){let a=t.clone();a.posMatrix=new Float64Array(16);let o=i.canonical.z-t.canonical.z,s=i.canonical.x-(i.canonical.x>>o<<o),c=i.canonical.y-(i.canonical.y>>o<<o),l=e.N>>o;e.aS(a.posMatrix,0,l,0,l,0,1),e.$(a.posMatrix,a.posMatrix,[-s*l,-c*l,0]),n[r]=a}else if(t.canonical.isChildOf(i.canonical)){let a=t.clone();a.posMatrix=new Float64Array(16);let o=t.canonical.z-i.canonical.z,s=t.canonical.x-(t.canonical.x>>o<<o),c=t.canonical.y-(t.canonical.y>>o<<o),l=e.N>>o;e.aS(a.posMatrix,0,e.N,0,e.N,0,1),e.$(a.posMatrix,a.posMatrix,[s*l,c*l,0]),e.a0(a.posMatrix,a.posMatrix,[1/2**o,1/2**o,0]),n[r]=a}}return n}getSourceTile(e,t){let n=this.sourceCache._source,r=e.overscaledZ-this.deltaZoom;if(r>n.maxzoom&&(r=n.maxzoom),r<n.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(r).key);let i=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!i||!i.dem)&&t)for(;r>=n.minzoom&&(!i||!i.dem);)i=this.sourceCache.getTileByID(e.scaledTo(r--).key);return i}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter((t=>t.timeAdded>=e))}}class _i{constructor(e,t,n){this.painter=e,this.sourceCache=new gi(t),this.options=n,this.exaggeration=typeof n.exaggeration==`number`?n.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,r,i=e.N){if(!(n>=0&&n<i&&r>=0&&r<i))return 0;let a=this.getTerrainData(t),o=a.tile?.dem;if(!o)return 0;let s=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e}([],[n/i*e.N,r/i*e.N],a.u_terrain_matrix),c=[s[0]*o.dim,s[1]*o.dim],l=Math.floor(c[0]),u=Math.floor(c[1]),d=c[0]-l,f=c[1]-u;return o.get(l,u)*(1-d)*(1-f)+o.get(l+1,u)*d*(1-f)+o.get(l,u+1)*(1-d)*f+o.get(l+1,u+1)*d*f}getElevationForLngLatZoom(t,n){let{tileID:r,mercatorX:i,mercatorY:a}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(r,i%e.N,a%e.N,e.N)}getElevation(t,n,r,i=e.N){return this.getDEMElevation(t,n,r,i)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){let t=this.painter.context;this._emptyDepthTexture=new y(t,new e.R({width:1,height:1},new Uint8Array(4)),t.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new y(t,new e.R({width:1,height:1}),t.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=e.ao([])}let n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){let e=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new y(e,n.dem.getPixels(),e.gl.RGBA,{premultiply:!1}),n.demTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}let r=n&&n+n.tileID.key+t.key;if(r&&!this._demMatrixCache[r]){let r=this.sourceCache.sourceCache._source.maxzoom,i=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=r?i=t.canonical.z-r:e.w(`cannot calculate elevation if elevation maxzoom > source.maxzoom`));let a=t.canonical.x-(t.canonical.x>>i<<i),o=t.canonical.y-(t.canonical.y>>i<<i),s=e.bc(new Float64Array(16),[1/(e.N<<i),1/(e.N<<i),0]);e.$(s,s,[a*e.N,o*e.N,0]),this._demMatrixCache[t.key]={matrix:s,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:r?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){let t=this.painter,n=t.width/devicePixelRatio,r=t.height/devicePixelRatio;return!this._fbo||this._fbo.width===n&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new y(t.context,{width:n,height:r,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new y(t.context,{width:n,height:r,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=t.context.createFramebuffer(n,r,!0,!1),this._fbo.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,n,r))),this._fbo.colorAttachment.set(e===`coords`?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let e=0,t=0;e<this._coordsTextureSize;e++)for(let r=0;r<this._coordsTextureSize;r++,t+=4)n[t+0]=255&r,n[t+1]=255&e,n[t+2]=r>>8<<4|e>>8,n[t+3]=0;let r=new y(t,new e.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),t.gl.RGBA,{premultiply:!1});return r.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=r,r}pointCoordinate(t){let n=new Uint8Array(4),r=this.painter.context,i=r.gl;r.bindFramebuffer.set(this.getFramebuffer(`coords`).framebuffer),i.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,i.RGBA,i.UNSIGNED_BYTE,n),r.bindFramebuffer.set(null);let a=n[0]+(n[2]>>4<<8),o=n[1]+((15&n[2])<<8),s=this.coordsIndex[255-n[3]],c=s&&this.sourceCache.getTileByID(s);if(!c)return null;let l=this._coordsTextureSize,u=(1<<c.tileID.canonical.z)*l;return new e.U(this._allowMercatorOverflow(t,(c.tileID.canonical.x*l+a)/u),(c.tileID.canonical.y*l+o)/u,this.getElevation(c.tileID,a,o,l))}getTerrainMesh(){if(this._mesh)return this._mesh;let t=this.painter.context,n=new e.bd,r=new e.b0,i=this.meshSize,a=e.N/i,o=i*i;for(let e=0;e<=i;e++)for(let t=0;t<=i;t++)n.emplaceBack(t*a,e*a,0);for(let e=0;e<o;e+=i+1)for(let t=0;t<i;t++)r.emplaceBack(t+e,i+t+e+1,i+t+e+2),r.emplaceBack(t+e,i+t+e+2,t+e+1);let s=n.length,c=s+2*(i+1);for(let t of[0,1])for(let r=0;r<=i;r++)for(let i of[0,1])n.emplaceBack(r*a,t*e.N,i);for(let e=0;e<2*i;e+=2)r.emplaceBack(c+e,c+e+1,c+e+3),r.emplaceBack(c+e,c+e+3,c+e+2),r.emplaceBack(s+e,s+e+3,s+e+1),r.emplaceBack(s+e,s+e+2,s+e+3);let l=n.length,u=l+2*(i+1);for(let t of[0,1])for(let r=0;r<=i;r++)for(let i of[0,1])n.emplaceBack(t*e.N,r*a,i);for(let e=0;e<2*i;e+=2)r.emplaceBack(l+e,l+e+1,l+e+3),r.emplaceBack(l+e,l+e+3,l+e+2),r.emplaceBack(u+e,u+e+3,u+e+1),r.emplaceBack(u+e,u+e+2,u+e+3);return this._mesh={indexBuffer:t.createIndexBuffer(r),vertexBuffer:t.createVertexBuffer(n,hi.members),segments:e.S.simpleSegment(0,0,n.length,r.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*e.be/2**t/5}getMinTileElevationForLngLatZoom(e,t){let{tileID:n}=this._getOverscaledTileIDFromLngLatZoom(e,t);return this.getMinMaxElevation(n).minElevation??0}getMinMaxElevation(e){let t=this.getTerrainData(e).tile,n={minElevation:null,maxElevation:null};return t&&t.dem&&(n.minElevation=t.dem.min*this.exaggeration,n.maxElevation=t.dem.max*this.exaggeration),n}_getOverscaledTileIDFromLngLatZoom(t,n){let r=e.U.fromLngLat(t.wrap()),i=(1<<n)*e.N,a=r.x*i,o=r.y*i,s=Math.floor(a/e.N),c=Math.floor(o/e.N);return{tileID:new e.O(n,0,n,s,c),mercatorX:a,mercatorY:o}}_allowMercatorOverflow(t,n){let r=t.x<this.painter.width/2,i=e.bf(n),a=this.painter.transform.center.lng;return r&&Math.sign(i)>0&&Math.sign(a)<0||!r&&Math.sign(i)<0&&Math.sign(a)>0?(i=360*Math.sign(a)+i,e.G(i)):n}}class vi{constructor(e,t,n){this._context=e,this._size=t,this._tileSize=n,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let t=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),n=new y(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return n.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),t.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),t.colorAttachment.set(n.texture),{id:e,fbo:t,texture:n,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((t=>e.id!==t)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let e of this._recentlyUsed)if(!this._objects[e].inUse)return this._objects[e];if(this._objects.length>=this._size)throw Error(`No free RenderPool available, call freeAllObjects() required!`);let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((e=>!e.inUse))}}let yi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class bi{constructor(e,t){this.painter=e,this.terrain=t,this.pool=new vi(e.context,30,t.sourceCache.tileSize*t.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,t){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((n=>!e._layers[n].isHidden(t))),this._coordsDescendingInv={};for(let t in e.sourceCaches){this._coordsDescendingInv[t]={};let n=e.sourceCaches[t].getVisibleCoordinates();for(let e of n){let n=this.terrain.sourceCache.getTerrainCoords(e);for(let e in n)this._coordsDescendingInv[t][e]||(this._coordsDescendingInv[t][e]=[]),this._coordsDescendingInv[t][e].push(n[e])}}this._coordsDescendingInvStr={};for(let t of e._order){let n=e._layers[t],r=n.source;if(yi[n.type]&&!this._coordsDescendingInvStr[r]){this._coordsDescendingInvStr[r]={};for(let e in this._coordsDescendingInv[r])this._coordsDescendingInvStr[r][e]=this._coordsDescendingInv[r][e].map((e=>e.key)).sort().join()}}for(let e of this._renderableTiles)for(let t in this._coordsDescendingInvStr){let n=this._coordsDescendingInvStr[t][e.tileID.key];n&&n!==e.rttCoords[t]&&(e.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;let n=t.type,r=this.painter,i=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(yi[n]&&(this._prevType&&yi[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!i))return!0;if(yi[this._prevType]||yi[n]&&i){this._prevType=n;let t=this._stacks.length-1,i=this._stacks[t]||[];for(let n of this._renderableTiles){if(this.pool.isFull()&&(or(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(n),n.rtt[t]){let e=this.pool.getObjectForId(n.rtt[t].id);if(e.stamp===n.rtt[t].stamp){this.pool.useObject(e);continue}}let a=this.pool.getOrCreateFreeObject();this.pool.useObject(a),this.pool.stampObject(a),n.rtt[t]={id:a.id,stamp:a.stamp},r.context.bindFramebuffer.set(a.fbo.framebuffer),r.context.clear({color:e.aT.transparent,stencil:0}),r.currentStencilSource=void 0;for(let e=0;e<i.length;e++){let t=r.style._layers[i[e]],o=t.source?this._coordsDescendingInv[t.source][n.tileID.key]:[n.tileID];r.context.viewport.set([0,0,a.fbo.width,a.fbo.height]),r._renderTileClippingMasks(t,o),r.renderLayer(r,r.style.sourceCaches[t.source],t,o),t.source&&(n.rttCoords[t.source]=this._coordsDescendingInvStr[t.source][n.tileID.key])}}return or(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),yi[n]}return!1}}let xi=t,Si={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:e.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:`sans-serif`,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ci=e=>{e.touchstart=e.dragStart,e.touchmoveWindow=e.dragMove,e.touchend=e.dragEnd},wi={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ti{constructor(t,r,i=!1){this.mousedown=t=>{this.startMouse(e.e({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),n.mousePos(this.element,t)),n.addEventListener(window,`mousemove`,this.mousemove),n.addEventListener(window,`mouseup`,this.mouseup)},this.mousemove=e=>{this.moveMouse(e,n.mousePos(this.element,e))},this.mouseup=e=>{this.mouseRotate.dragEnd(e),this.mousePitch&&this.mousePitch.dragEnd(e),this.offTemp()},this.touchstart=e=>{e.targetTouches.length===1?(this._startPos=this._lastPos=n.touchPos(this.element,e.targetTouches)[0],this.startTouch(e,this._startPos),n.addEventListener(window,`touchmove`,this.touchmove,{passive:!1}),n.addEventListener(window,`touchend`,this.touchend)):this.reset()},this.touchmove=e=>{e.targetTouches.length===1?(this._lastPos=n.touchPos(this.element,e.targetTouches)[0],this.moveTouch(e,this._lastPos)):this.reset()},this.touchend=e=>{e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let a=t.dragRotate._mouseRotate.getClickTolerance(),o=t.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=Rr({clickTolerance:a,enable:!0}),this.touchRotate=(({enable:e,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>new Nr({clickTolerance:t,move:(e,t)=>({bearingDelta:(t.x-e.x)*n}),moveStateManager:new Ir,enable:e,assignEvents:Ci}))({clickTolerance:a,enable:!0}),this.map=t,i&&(this.mousePitch=zr({clickTolerance:o,enable:!0}),this.touchPitch=(({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>new Nr({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*n}),moveStateManager:new Ir,enable:e,assignEvents:Ci}))({clickTolerance:o,enable:!0})),n.addEventListener(r,`mousedown`,this.mousedown),n.addEventListener(r,`touchstart`,this.touchstart,{passive:!1}),n.addEventListener(r,`touchcancel`,this.reset)}startMouse(e,t){this.mouseRotate.dragStart(e,t),this.mousePitch&&this.mousePitch.dragStart(e,t),n.disableDrag()}startTouch(e,t){this.touchRotate.dragStart(e,t),this.touchPitch&&this.touchPitch.dragStart(e,t),n.disableDrag()}moveMouse(e,t){let n=this.map,{bearingDelta:r}=this.mouseRotate.dragMove(e,t)||{};if(r&&n.setBearing(n.getBearing()+r),this.mousePitch){let{pitchDelta:r}=this.mousePitch.dragMove(e,t)||{};r&&n.setPitch(n.getPitch()+r)}}moveTouch(e,t){let n=this.map,{bearingDelta:r}=this.touchRotate.dragMove(e,t)||{};if(r&&n.setBearing(n.getBearing()+r),this.touchPitch){let{pitchDelta:r}=this.touchPitch.dragMove(e,t)||{};r&&n.setPitch(n.getPitch()+r)}}off(){let e=this.element;n.removeEventListener(e,`mousedown`,this.mousedown),n.removeEventListener(e,`touchstart`,this.touchstart,{passive:!1}),n.removeEventListener(window,`touchmove`,this.touchmove,{passive:!1}),n.removeEventListener(window,`touchend`,this.touchend),n.removeEventListener(e,`touchcancel`,this.reset),this.offTemp()}offTemp(){n.enableDrag(),n.removeEventListener(window,`mousemove`,this.mousemove),n.removeEventListener(window,`mouseup`,this.mouseup),n.removeEventListener(window,`touchmove`,this.touchmove,{passive:!1}),n.removeEventListener(window,`touchend`,this.touchend)}}let Ei;function Di(t,n,r){if(t=new e.L(t.lng,t.lat),n){let i=new e.L(t.lng-360,t.lat),a=new e.L(t.lng+360,t.lat),o=r.locationPoint(t).distSqr(n);r.locationPoint(i).distSqr(n)<o?t=i:r.locationPoint(a).distSqr(n)<o&&(t=a)}for(;Math.abs(t.lng-r.center.lng)>180;){let e=r.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}let Oi={center:`translate(-50%,-50%)`,top:`translate(-50%,0)`,"top-left":`translate(0,0)`,"top-right":`translate(-100%,0)`,bottom:`translate(-50%,-100%)`,"bottom-left":`translate(0,-100%)`,"bottom-right":`translate(-100%,-100%)`,left:`translate(0,-50%)`,right:`translate(-100%,-50%)`};function ki(e,t,n){let r=e.classList;for(let e in Oi)r.remove(`maplibregl-${n}-anchor-${e}`);r.add(`maplibregl-${n}-anchor-${t}`)}class Ai extends e.E{constructor(t){if(super(),this._onKeyPress=e=>{let t=e.code,n=e.charCode||e.keyCode;t!==`Space`&&t!==`Enter`&&n!==32&&n!==13||this.togglePopup()},this._onMapClick=e=>{let t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()},this._update=e=>{if(!this._map)return;let t=this._map.loaded()&&!this._map.isMoving();(e?.type===`terrain`||e?.type===`render`&&!t)&&this._map.once(`render`,this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Di(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let r=``;this._rotationAlignment===`viewport`||this._rotationAlignment===`auto`?r=`rotateZ(${this._rotation}deg)`:this._rotationAlignment===`map`&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let i=``;this._pitchAlignment===`viewport`||this._pitchAlignment===`auto`?i=`rotateX(0deg)`:this._pitchAlignment===`map`&&(i=`rotateX(${this._map.getPitch()}deg)`),e&&e.type!==`moveend`||(this._pos=this._pos.round()),n.setTransform(this._element,`${Oi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${i} ${r}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout((()=>{let e=this._map.unproject(this._pos),t=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/2**(this._map.transform.tileZoom+8);this._element.style.opacity=e.distanceTo(this._lngLat)>20*t?`0.2`:`1.0`,this._opacityTimeout=null}),100))},this._onMove=t=>{if(!this._isDragging){let e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents=`none`,this._state===`pending`&&(this._state=`active`,this.fire(new e.k(`dragstart`))),this.fire(new e.k(`drag`)))},this._onUp=()=>{this._element.style.pointerEvents=`auto`,this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off(`mousemove`,this._onMove),this._map.off(`touchmove`,this._onMove),this._state===`active`&&this.fire(new e.k(`dragend`)),this._state=`inactive`},this._addDragHandler=e=>{this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state=`pending`,this._map.on(`mousemove`,this._onMove),this._map.on(`touchmove`,this._onMove),this._map.once(`mouseup`,this._onUp),this._map.once(`touchend`,this._onUp))},this._anchor=t&&t.anchor||`center`,this._color=t&&t.color||`#3FB1CE`,this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state=`inactive`,this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||`auto`,this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!==`auto`?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create(`div`),this._element.setAttribute(`aria-label`,`Map marker`);let r=n.createNS(`http://www.w3.org/2000/svg`,`svg`);r.setAttributeNS(null,`display`,`block`),r.setAttributeNS(null,`height`,`41px`),r.setAttributeNS(null,`width`,`27px`),r.setAttributeNS(null,`viewBox`,`0 0 27 41`);let i=n.createNS(`http://www.w3.org/2000/svg`,`g`);i.setAttributeNS(null,`stroke`,`none`),i.setAttributeNS(null,`stroke-width`,`1`),i.setAttributeNS(null,`fill`,`none`),i.setAttributeNS(null,`fill-rule`,`evenodd`);let a=n.createNS(`http://www.w3.org/2000/svg`,`g`);a.setAttributeNS(null,`fill-rule`,`nonzero`);let o=n.createNS(`http://www.w3.org/2000/svg`,`g`);o.setAttributeNS(null,`transform`,`translate(3.0, 29.0)`),o.setAttributeNS(null,`fill`,`#000000`);for(let e of[{rx:`10.5`,ry:`5.25002273`},{rx:`10.5`,ry:`5.25002273`},{rx:`9.5`,ry:`4.77275007`},{rx:`8.5`,ry:`4.29549936`},{rx:`7.5`,ry:`3.81822308`},{rx:`6.5`,ry:`3.34094679`},{rx:`5.5`,ry:`2.86367051`},{rx:`4.5`,ry:`2.38636864`}]){let t=n.createNS(`http://www.w3.org/2000/svg`,`ellipse`);t.setAttributeNS(null,`opacity`,`0.04`),t.setAttributeNS(null,`cx`,`10.5`),t.setAttributeNS(null,`cy`,`5.80029008`),t.setAttributeNS(null,`rx`,e.rx),t.setAttributeNS(null,`ry`,e.ry),o.appendChild(t)}let s=n.createNS(`http://www.w3.org/2000/svg`,`g`);s.setAttributeNS(null,`fill`,this._color);let c=n.createNS(`http://www.w3.org/2000/svg`,`path`);c.setAttributeNS(null,`d`,`M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z`),s.appendChild(c);let l=n.createNS(`http://www.w3.org/2000/svg`,`g`);l.setAttributeNS(null,`opacity`,`0.25`),l.setAttributeNS(null,`fill`,`#000000`);let u=n.createNS(`http://www.w3.org/2000/svg`,`path`);u.setAttributeNS(null,`d`,`M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z`),l.appendChild(u);let d=n.createNS(`http://www.w3.org/2000/svg`,`g`);d.setAttributeNS(null,`transform`,`translate(6.0, 7.0)`),d.setAttributeNS(null,`fill`,`#FFFFFF`);let f=n.createNS(`http://www.w3.org/2000/svg`,`g`);f.setAttributeNS(null,`transform`,`translate(8.0, 8.0)`);let p=n.createNS(`http://www.w3.org/2000/svg`,`circle`);p.setAttributeNS(null,`fill`,`#000000`),p.setAttributeNS(null,`opacity`,`0.25`),p.setAttributeNS(null,`cx`,`5.5`),p.setAttributeNS(null,`cy`,`5.5`),p.setAttributeNS(null,`r`,`5.4999962`);let m=n.createNS(`http://www.w3.org/2000/svg`,`circle`);m.setAttributeNS(null,`fill`,`#FFFFFF`),m.setAttributeNS(null,`cx`,`5.5`),m.setAttributeNS(null,`cy`,`5.5`),m.setAttributeNS(null,`r`,`5.4999962`),f.appendChild(p),f.appendChild(m),a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(d),a.appendChild(f),r.appendChild(a),r.setAttributeNS(null,`height`,41*this._scale+`px`),r.setAttributeNS(null,`width`,27*this._scale+`px`),this._element.appendChild(r),this._offset=e.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add(`maplibregl-marker`),this._element.addEventListener(`dragstart`,(e=>{e.preventDefault()})),this._element.addEventListener(`mousedown`,(e=>{e.preventDefault()})),ki(this._element,this._anchor,`marker`),t&&t.className)for(let e of t.className.split(` `))this._element.classList.add(e);this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on(`move`,this._update),e.on(`moveend`,this._update),e.on(`terrain`,this._update),this.setDraggable(this._draggable),this._update(),this._map.on(`click`,this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off(`click`,this._onMapClick),this._map.off(`move`,this._update),this._map.off(`moveend`,this._update),this._map.off(`mousedown`,this._addDragHandler),this._map.off(`touchstart`,this._addDragHandler),this._map.off(`mouseup`,this._onUp),this._map.off(`touchend`,this._onUp),this._map.off(`mousemove`,this._onMove),this._map.off(`touchmove`,this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener(`keypress`,this._onKeyPress),this._originalTabIndex||this._element.removeAttribute(`tabindex`)),e){if(!(`offset`in e.options)){let t=38.1,n=13.5,r=13.5/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-n+r)],"bottom-right":[-r,-1*(t-n+r)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute(`tabindex`),this._originalTabIndex||this._element.setAttribute(`tabindex`,`0`),this._element.addEventListener(`keypress`,this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return e&&(e.isOpen()?e.remove():e.addTo(this._map)),this}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on(`mousedown`,this._addDragHandler),this._map.on(`touchstart`,this._addDragHandler)):(this._map.off(`mousedown`,this._addDragHandler),this._map.off(`touchstart`,this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||`auto`,this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!==`auto`?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}let ji={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Mi=0,Ni=!1,Pi={maxWidth:100,unit:`metric`};function Fi(e,t,n){let r=n&&n.maxWidth||100,i=e._container.clientHeight/2,a=e.unproject([0,i]),o=e.unproject([r,i]),s=a.distanceTo(o);if(n&&n.unit===`imperial`){let n=3.2808*s;n>5280?Ii(t,r,n/5280,e._getUIString(`ScaleControl.Miles`)):Ii(t,r,n,e._getUIString(`ScaleControl.Feet`))}else n&&n.unit===`nautical`?Ii(t,r,s/1852,e._getUIString(`ScaleControl.NauticalMiles`)):s>=1e3?Ii(t,r,s/1e3,e._getUIString(`ScaleControl.Kilometers`)):Ii(t,r,s,e._getUIString(`ScaleControl.Meters`))}function Ii(e,t,n,r){let i=function(e){let t=10**(`${Math.floor(e)}`.length-1),n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){let t=10**Math.ceil(-Math.log(e)/Math.LN10);return Math.round(e*t)/t}(n),t*n}(n);e.style.width=i/n*t+`px`,e.innerHTML=`${i}&nbsp;${r}`}let Li={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:``,maxWidth:`240px`},Ri=[`a[href]`,`[tabindex]:not([tabindex='-1'])`,`[contenteditable]:not([contenteditable='false'])`,`button:not([disabled])`,`input:not([disabled])`,`select:not([disabled])`,`textarea:not([disabled])`].join(`, `);function zi(t){if(t){if(typeof t==`number`){let n=Math.round(Math.abs(t)/Math.SQRT2);return{center:new e.P(0,0),top:new e.P(0,t),"top-left":new e.P(n,n),"top-right":new e.P(-n,n),bottom:new e.P(0,-t),"bottom-left":new e.P(n,-n),"bottom-right":new e.P(-n,-n),left:new e.P(t,0),right:new e.P(-t,0)}}if(t instanceof e.P||Array.isArray(t)){let n=e.P.convert(t);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:e.P.convert(t.center||[0,0]),top:e.P.convert(t.top||[0,0]),"top-left":e.P.convert(t[`top-left`]||[0,0]),"top-right":e.P.convert(t[`top-right`]||[0,0]),bottom:e.P.convert(t.bottom||[0,0]),"bottom-left":e.P.convert(t[`bottom-left`]||[0,0]),"bottom-right":e.P.convert(t[`bottom-right`]||[0,0]),left:e.P.convert(t.left||[0,0]),right:e.P.convert(t.right||[0,0])}}return zi(new e.P(0,0))}let Bi={extend:(t,...n)=>e.e(t,...n),run(e){e()},logToElement(e,t=!1,n=`log`){let r=window.document.getElementById(n);r&&(t&&(r.innerHTML=``),r.innerHTML+=`<br>${e}`)}},Vi=t;class Hi{static get version(){return Vi}static get workerCount(){return fe.workerCount}static set workerCount(e){fe.workerCount=e}static get maxParallelImageRequests(){return e.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){e.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return e.c.WORKER_URL}static set workerUrl(t){e.c.WORKER_URL=t}static addProtocol(t,n){e.c.REGISTERED_PROTOCOLS[t]=n}static removeProtocol(t){delete e.c.REGISTERED_PROTOCOLS[t]}}return Hi.Map=class extends ui{constructor(t){if(e.bg.mark(e.bh.create),(t=e.e({},Si,t)).minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw Error(`maxZoom must be greater than or equal to minZoom`);if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw Error(`maxPitch must be greater than or equal to minPitch`);if(t.minPitch!=null&&t.minPitch<0)throw Error(`minPitch must be greater than or equal to 0`);if(t.maxPitch!=null&&t.maxPitch>85)throw Error(`maxPitch must be less than or equal to 85`);if(super(new dr(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._cooperativeGesturesOnWheel=e=>{this._onCooperativeGesture(e,e[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&=(this._frame.cancel(),null),this.fire(new e.k(`webglcontextlost`,{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new e.k(`webglcontextrestored`,{originalEvent:t}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._cooperativeGestures=t.cooperativeGestures,this._metaKey=navigator.platform.indexOf(`Mac`)===0?`metaKey`:`ctrlKey`,this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new pi,this._controls=[],this._mapId=e.a2(),this._locale=e.e({},mi,t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this._imageQueueHandle=l.addThrottleControl((()=>this.isMoving())),this._requestManager=new d(t.transformRequest),typeof t.container==`string`){if(this._container=document.getElementById(t.container),!this._container)throw Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw Error(`Invalid type: 'container' must be a String or HTMLElement.`);this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on(`move`,(()=>this._update(!1))),this.on(`moveend`,(()=>this._update(!1))),this.on(`zoom`,(()=>this._update(!0))),this.on(`terrain`,(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once(`idle`,(()=>{this._idleTriggered=!0})),typeof window<`u`){addEventListener(`online`,this._onWindowOnline,!1);let e=!1,t=fr((e=>{this._trackResize&&!this._removed&&this.resize(e)._update()}),50);this._resizeObserver=new ResizeObserver((n=>{e?t(n):e=!0})),this._resizeObserver.observe(this._container)}this.handlers=new li(this,t),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=t.hash&&new pr(typeof t.hash==`string`&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new di({customAttribution:t.customAttribution})),t.maplibreLogo&&this.addControl(new fi,t.logoPosition),this.on(`style.load`,(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on(`data`,(t=>{this._update(t.dataType===`style`),this.fire(new e.k(`${t.dataType}data`,t))})),this.on(`dataloading`,(t=>{this.fire(new e.k(`${t.dataType}dataloading`,t))})),this.on(`dataabort`,(t=>{this.fire(new e.k(`sourcedataabort`,t))}))}_getMapId(){return this._mapId}addControl(t,n){if(n===void 0&&(n=t.getDefaultPosition?t.getDefaultPosition():`top-right`),!t||!t.onAdd)return this.fire(new e.j(Error(`Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.`)));let r=t.onAdd(this);this._controls.push(t);let i=this._controlPositions[n];return n.indexOf(`bottom`)===-1?i.appendChild(r):i.insertBefore(r,i.firstChild),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.j(Error(`Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.`)));let n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}calculateCameraOptionsFromTo(e,t,n,r){return r==null&&this.terrain&&(r=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(e,t,n,r)}resize(t){var n;let r=this._containerDimensions(),i=r[0],a=r[1],o=this._getClampedPixelRatio(i,a);if(this._resizeCanvas(i,a,o),this.painter.resize(i,a,o),this.painter.overLimit()){let e=this.painter.context.gl;this._maxCanvasSize=[e.drawingBufferWidth,e.drawingBufferHeight];let t=this._getClampedPixelRatio(i,a);this._resizeCanvas(i,a,t),this.painter.resize(i,a,t)}this.transform.resize(i,a),(n=this._requestedCameraState)==null||n.resize(i,a);let s=!this._moving;return s&&(this.stop(),this.fire(new e.k(`movestart`,t)).fire(new e.k(`move`,t))),this.fire(new e.k(`resize`,t)),s&&this.fire(new e.k(`moveend`,t)),this}_getClampedPixelRatio(e,t){let{0:n,1:r}=this._maxCanvasSize,i=this.getPixelRatio(),a=e*i,o=t*i;return Math.min(a>n?n/a:1,o>r?r/o:1)*i}getPixelRatio(){return this._overridePixelRatio??devicePixelRatio}setPixelRatio(e){this._overridePixelRatio=e,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(N.convert(e)),this._update()}setMinZoom(e){if((e??=-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw Error(`minZoom must be between -2 and the current maxZoom, inclusive`)}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e??=22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw Error(`maxZoom must be greater than the current minZoom`)}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e??=0)<0)throw Error(`minPitch must be greater than or equal to 0`);if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw Error(`minPitch must be between 0 and the current maxPitch, inclusive`)}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e??=60)>85)throw Error(`maxPitch must be less than or equal to 85`);if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw Error(`maxPitch must be greater than the current minPitch`)}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(t){return this.transform.locationPoint(e.L.convert(t),this.style&&this.terrain)}unproject(t){return this.transform.pointLocation(e.P.convert(t),this.terrain)}isMoving(){return this._moving||this.handlers?.isMoving()}isZooming(){return this._zooming||this.handlers?.isZooming()}isRotating(){return this._rotating||this.handlers?.isRotating()}_createDelegatedListener(e,t,n){if(e===`mouseenter`||e===`mouseover`){let r=!1;return{layer:t,listener:n,delegates:{mousemove:i=>{let a=this.getLayer(t)?this.queryRenderedFeatures(i.point,{layers:[t]}):[];a.length?r||(r=!0,n.call(this,new Sr(e,this,i.originalEvent,{features:a}))):r=!1},mouseout:()=>{r=!1}}}}if(e===`mouseleave`||e===`mouseout`){let r=!1;return{layer:t,listener:n,delegates:{mousemove:i=>{(this.getLayer(t)?this.queryRenderedFeatures(i.point,{layers:[t]}):[]).length?r=!0:r&&(r=!1,n.call(this,new Sr(e,this,i.originalEvent)))},mouseout:t=>{r&&(r=!1,n.call(this,new Sr(e,this,t.originalEvent)))}}}}{let r=e=>{let r=this.getLayer(t)?this.queryRenderedFeatures(e.point,{layers:[t]}):[];r.length&&(e.features=r,n.call(this,e),delete e.features)};return{layer:t,listener:n,delegates:{[e]:r}}}}on(e,t,n){if(n===void 0)return super.on(e,t);let r=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(let e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,n){if(n===void 0)return super.once(e,t);let r=this._createDelegatedListener(e,t,n);for(let e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,n){return n===void 0?super.off(e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&(r=>{let i=this._delegatedListeners[e];for(let e=0;e<i.length;e++){let r=i[e];if(r.layer===t&&r.listener===n){for(let e in r.delegates)this.off(e,r.delegates[e]);return i.splice(e,1),this}}})(),this)}queryRenderedFeatures(t,n){if(!this.style)return[];let r,i=t instanceof e.P||Array.isArray(t),a=i?t:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(i?{}:t)||{},a instanceof e.P||typeof a[0]==`number`)r=[e.P.convert(a)];else{let t=e.P.convert(a[0]),n=e.P.convert(a[1]);r=[t,new e.P(n.x,t.y),n,new e.P(t.x,n.y),t]}return this.style.queryRenderedFeatures(r,n,this.transform)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(t,n){return!1!==(n=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(t,n))}setTransformRequest(e){return this._requestManager.setTransformRequest(e),this}_getUIString(e){let t=this._locale[e];if(t==null)throw Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once(`style.load`,(()=>this._updateStyle(e,t)));let n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!e)),e?(this.style=new st(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof e==`string`?this.style.loadURL(e,t,n):this.style.loadJSON(e,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new st(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,n){if(typeof t==`string`){let r=this._requestManager.transformRequest(t,u.Style);e.f(r,((t,r)=>{t?this.fire(new e.j(t)):r&&this._updateDiff(r,n)}))}else typeof t==`object`&&this._updateDiff(t,n)}_updateDiff(t,n){try{this.style.setState(t,n)&&this._update(!0)}catch(r){e.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(t,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.w(`There is no style added to the map.`)}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(t){let n=this.style&&this.style.sourceCaches[t];if(n!==void 0)return n.loaded();this.fire(new e.j(Error(`There is no source with ID '${t}'`)))}setTerrain(t){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off(`data`,this._terrainDataCallback),t){let n=this.style.sourceCaches[t.source];if(!n)throw Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);for(let n in this.style._layers){let r=this.style._layers[n];r.type===`hillshade`&&r.source===t.source&&e.w(`You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.`)}this.terrain=new _i(this.painter,n,t),this.painter.renderToTexture=new bi(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=e=>{e.dataType===`style`?this.terrain.sourceCache.freeRtt():e.dataType===`source`&&e.tile&&(e.sourceId!==t.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(e.tile.tileID))},this.style.on(`data`,this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new e.k(`terrain`,{terrain:t})),this}getTerrain(){return this.terrain?.options??null}areTilesLoaded(){let e=this.style&&this.style.sourceCaches;for(let t in e){let n=e[t]._tiles;for(let e in n){let t=n[e];if(t.state!==`loaded`&&t.state!==`errored`)return!1}}return!0}addSourceType(e,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this.style.removeSource(e),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,n,r={}){let{pixelRatio:i=1,sdf:a=!1,stretchX:o,stretchY:s,content:c}=r;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||e.a(n))){if(n.width===void 0||n.height===void 0)return this.fire(new e.j(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:r,height:l,data:u}=n,d=n;return this.style.addImage(t,{data:new e.R({width:r,height:l},new Uint8Array(u)),pixelRatio:i,stretchX:o,stretchY:s,content:c,sdf:a,version:0,userImage:d}),d.onAdd&&d.onAdd(this,t),this}}{let{width:r,height:l,data:u}=e.h.getImageData(n);this.style.addImage(t,{data:new e.R({width:r,height:l},u),pixelRatio:i,stretchX:o,stretchY:s,content:c,sdf:a,version:0})}}updateImage(t,n){let r=this.style.getImage(t);if(!r)return this.fire(new e.j(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let{width:i,height:a,data:o}=n instanceof HTMLImageElement||e.a(n)?e.h.getImageData(n):n;if(i===void 0||a===void 0)return this.fire(new e.j(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(i!==r.data.width||a!==r.data.height)return this.fire(new e.j(Error(`The width and height of the updated image must be that same as the previous version of the image`)));let s=!(n instanceof HTMLImageElement||e.a(n));return r.data.replace(o,s),this.style.updateImage(t,r),this}getImage(e){return this.style.getImage(e)}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.j(Error(`Missing required image id`))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){l.getImage(this._requestManager.transformRequest(e,u.Image),t)}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)}setFilter(e,t,n={}){return this.style.setFilter(e,t,n),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,n,r={}){return this.style.setPaintProperty(e,t,n,r),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,n,r={}){return this.style.setLayoutProperty(e,t,n,r),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setGlyphs(e,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(e,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(e,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(e,t,n,(e=>{e||this._update(!0)})),this}removeSprite(e){return this._lazyInitEmptyStyle(),this.style.removeSprite(e),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(e,t,(e=>{e||this._update(!0)})),this}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_setupContainer(){let e=this._container;e.classList.add(`maplibregl-map`);let t=this._canvasContainer=n.create(`div`,`maplibregl-canvas-container`,e);this._interactive&&t.classList.add(`maplibregl-interactive`),this._canvas=n.create(`canvas`,`maplibregl-canvas`,t),this._canvas.addEventListener(`webglcontextlost`,this._contextLost,!1),this._canvas.addEventListener(`webglcontextrestored`,this._contextRestored,!1),this._canvas.setAttribute(`tabindex`,`0`),this._canvas.setAttribute(`aria-label`,`Map`),this._canvas.setAttribute(`role`,`region`);let r=this._containerDimensions(),i=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],i);let a=this._controlContainer=n.create(`div`,`maplibregl-control-container`,e),o=this._controlPositions={};[`top-left`,`top-right`,`bottom-left`,`bottom-right`].forEach((e=>{o[e]=n.create(`div`,`maplibregl-ctrl-${e} `,a)})),this._container.addEventListener(`scroll`,this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=n.create(`div`,`maplibregl-cooperative-gesture-screen`,this._container);let e=typeof this._cooperativeGestures!=`boolean`&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:`Use Ctrl + scroll to zoom the map`;navigator.platform.indexOf(`Mac`)===0&&(e=typeof this._cooperativeGestures!=`boolean`&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:`Use ⌘ + scroll to zoom the map`),this._cooperativeGesturesScreen.innerHTML=`\n            <div class="maplibregl-desktop-message">${e}</div>\n            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!=`boolean`&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:`Use two fingers to move the map`}</div>\n        `,this._cooperativeGesturesScreen.setAttribute(`aria-hidden`,`true`),this._canvasContainer.addEventListener(`wheel`,this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add(`maplibregl-cooperative-gestures`)}_destroyCooperativeGestures(){n.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener(`wheel`,this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove(`maplibregl-cooperative-gestures`)}_resizeCanvas(e,t,n){this._canvas.width=Math.floor(n*e),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_setupPainter(){let e={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},t=null;this._canvas.addEventListener(`webglcontextcreationerror`,(n=>{t={requestedAttributes:e},n&&(t.statusMessage=n.statusMessage,t.type=n.type)}),{once:!0});let n=this._canvas.getContext(`webgl2`,e)||this._canvas.getContext(`webgl`,e);if(!n){let e=`Failed to initialize WebGL`;throw t?(t.message=e,Error(JSON.stringify(t))):Error(e)}this.painter=new sr(n,this.transform),r.testSupport(n)}_onCooperativeGesture(e,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add(`maplibregl-show`),setTimeout((()=>{this._cooperativeGesturesScreen.classList.remove(`maplibregl-show`)}),100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(t){let n=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let t=this.transform.zoom,i=e.h.now();this.style.zoomHistory.update(t,i);let a=new e.a8(t,{now:i,fadeDuration:n,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),o=a.crossFadingFactor();o===1&&o===this._crossFadingFactor||(r=!0,this._crossFadingFactor=o),this.style.update(a)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,n,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:n,showPadding:this.showPadding}),this.fire(new e.k(`render`)),this.loaded()&&!this._loaded&&(this._loaded=!0,e.bg.mark(e.bh.load),this.fire(new e.k(`load`))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let i=this._sourcesDirty||this._styleDirty||this._placementDirty;return i||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.k(`idle`)),!this._loaded||this._fullyLoaded||i||(this._fullyLoaded=!0,e.bg.mark(e.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&=(this._frame.cancel(),null),this._render(0)),this}remove(){var t;this._hash&&this._hash.remove();for(let e of this._controls)e.onRemove(this);this._controls=[],this._frame&&=(this._frame.cancel(),null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<`u`&&removeEventListener(`online`,this._onWindowOnline,!1),l.removeThrottleControl(this._imageQueueHandle),(t=this._resizeObserver)==null||t.disconnect();let r=this.painter.context.gl.getExtension(`WEBGL_lose_context`);r&&r.loseContext(),this._canvas.removeEventListener(`webglcontextrestored`,this._contextRestored,!1),this._canvas.removeEventListener(`webglcontextlost`,this._contextLost,!1),n.remove(this._canvasContainer),n.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove(`maplibregl-map`),e.bg.clearMetrics(),this._removed=!0,this.fire(new e.k(`remove`))}triggerRepaint(){this.style&&!this._frame&&(this._frame=e.h.frame((t=>{e.bg.frame(t),this._frame=null,this._render(t)})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get version(){return xi}getCameraTargetElevation(){return this.transform.elevation}},Hi.NavigationControl=class{constructor(t){this._updateZoomButtons=()=>{let e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute(`aria-disabled`,t.toString()),this._zoomOutButton.setAttribute(`aria-disabled`,n.toString())},this._rotateCompassArrow=()=>{let e=this.options.visualizePitch?`scale(${1/Math.cos(this._map.transform.pitch*(Math.PI/180))**.5}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,t)=>{let n=this._map._getUIString(`NavigationControl.${t}`);e.title=n,e.setAttribute(`aria-label`,n)},this.options=e.e({},wi,t),this._container=n.create(`div`,`maplibregl-ctrl maplibregl-ctrl-group`),this._container.addEventListener(`contextmenu`,(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton(`maplibregl-ctrl-zoom-in`,(e=>this._map.zoomIn({},{originalEvent:e}))),n.create(`span`,`maplibregl-ctrl-icon`,this._zoomInButton).setAttribute(`aria-hidden`,`true`),this._zoomOutButton=this._createButton(`maplibregl-ctrl-zoom-out`,(e=>this._map.zoomOut({},{originalEvent:e}))),n.create(`span`,`maplibregl-ctrl-icon`,this._zoomOutButton).setAttribute(`aria-hidden`,`true`)),this.options.showCompass&&(this._compass=this._createButton(`maplibregl-ctrl-compass`,(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=n.create(`span`,`maplibregl-ctrl-icon`,this._compass),this._compassIcon.setAttribute(`aria-hidden`,`true`))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,`ZoomIn`),this._setButtonTitle(this._zoomOutButton,`ZoomOut`),this._map.on(`zoom`,this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,`ResetBearing`),this.options.visualizePitch&&this._map.on(`pitch`,this._rotateCompassArrow),this._map.on(`rotate`,this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ti(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){n.remove(this._container),this.options.showZoom&&this._map.off(`zoom`,this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off(`pitch`,this._rotateCompassArrow),this._map.off(`rotate`,this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){let r=n.create(`button`,e,this._container);return r.type=`button`,r.addEventListener(`click`,t),r}},Hi.GeolocateControl=class extends e.E{constructor(t){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.k(`outofmaxbounds`,t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case`WAITING_ACTIVE`:case`ACTIVE_LOCK`:case`ACTIVE_ERROR`:this._watchState=`ACTIVE_LOCK`,this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-waiting`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-active-error`),this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-active`);break;case`BACKGROUND`:case`BACKGROUND_ERROR`:this._watchState=`BACKGROUND`,this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-waiting`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-background-error`),this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-background`);break;default:throw Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!==`OFF`&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!==`ACTIVE_LOCK`||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove(`maplibregl-user-location-dot-stale`),this.fire(new e.k(`geolocate`,t)),this._finish()}},this._updateCamera=t=>{let n=new e.L(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,i=this._map.getBearing(),a=e.e({bearing:i},this.options.fitBoundsOptions),o=N.fromLngLat(n,r);this._map.fitBounds(o,a,{geolocateSource:!0})},this._updateMarker=t=>{if(t){let n=new e.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState=`OFF`,this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-waiting`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-active`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-active-error`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-background`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-background-error`),this._geolocateButton.disabled=!0;let e=this._map._getUIString(`GeolocateControl.LocationNotAvailable`);this._geolocateButton.title=e,this._geolocateButton.setAttribute(`aria-label`,e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Ni)return;this._setErrorState()}this._watchState!==`OFF`&&this.options.showUserLocation&&this._dotElement.classList.add(`maplibregl-user-location-dot-stale`),this.fire(new e.k(`error`,t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener(`contextmenu`,(e=>e.preventDefault())),this._geolocateButton=n.create(`button`,`maplibregl-ctrl-geolocate`,this._container),n.create(`span`,`maplibregl-ctrl-icon`,this._geolocateButton).setAttribute(`aria-hidden`,`true`),this._geolocateButton.type=`button`,!1===t){e.w(`Geolocation support is not available so the GeolocateControl will be disabled.`);let t=this._map._getUIString(`GeolocateControl.LocationNotAvailable`);this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute(`aria-label`,t)}else{let e=this._map._getUIString(`GeolocateControl.FindMyLocation`);this._geolocateButton.title=e,this._geolocateButton.setAttribute(`aria-label`,e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute(`aria-pressed`,`false`),this._watchState=`OFF`),this.options.showUserLocation&&(this._dotElement=n.create(`div`,`maplibregl-user-location-dot`),this._userLocationDotMarker=new Ai({element:this._dotElement}),this._circleElement=n.create(`div`,`maplibregl-user-location-accuracy-circle`),this._accuracyCircleMarker=new Ai({element:this._circleElement,pitchAlignment:`map`}),this.options.trackUserLocation&&(this._watchState=`OFF`),this._map.on(`zoom`,this._onZoom)),this._geolocateButton.addEventListener(`click`,this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on(`movestart`,(t=>{t.geolocateSource||this._watchState!==`ACTIVE_LOCK`||t.originalEvent&&t.originalEvent.type===`resize`||(this._watchState=`BACKGROUND`,this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-background`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-active`),this.fire(new e.k(`trackuserlocationend`)))}))}},this.options=e.e({},ji,t)}onAdd(e){return this._map=e,this._container=n.create(`div`,`maplibregl-ctrl maplibregl-ctrl-group`),function(e,t=!1){Ei===void 0||t?window.navigator.permissions===void 0?(Ei=!!window.navigator.geolocation,e(Ei)):window.navigator.permissions.query({name:`geolocation`}).then((t=>{Ei=t.state!==`denied`,e(Ei)})).catch((()=>{Ei=!!window.navigator.geolocation,e(Ei)})):e(Ei)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off(`zoom`,this._onZoom),this._map=void 0,Mi=0,Ni=!1}_isOutOfMapMaxBounds(e){let t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case`WAITING_ACTIVE`:this._watchState=`ACTIVE_ERROR`,this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-active`),this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-active-error`);break;case`ACTIVE_LOCK`:this._watchState=`ACTIVE_ERROR`,this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-active`),this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-active-error`),this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-waiting`);break;case`BACKGROUND`:this._watchState=`BACKGROUND_ERROR`,this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-background`),this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-background-error`),this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-waiting`);break;case`ACTIVE_ERROR`:break;default:throw Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let e=this._map.getBounds(),t=e.getSouthEast(),n=e.getNorthEast(),r=t.distanceTo(n),i=Math.ceil(this._accuracy/(r/this._map._container.clientHeight)*2);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}trigger(){if(!this._setup)return e.w(`Geolocate control triggered before added to a map`),!1;if(this.options.trackUserLocation){switch(this._watchState){case`OFF`:this._watchState=`WAITING_ACTIVE`,this.fire(new e.k(`trackuserlocationstart`));break;case`WAITING_ACTIVE`:case`ACTIVE_LOCK`:case`ACTIVE_ERROR`:case`BACKGROUND_ERROR`:Mi--,Ni=!1,this._watchState=`OFF`,this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-waiting`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-active`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-active-error`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-background`),this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-background-error`),this.fire(new e.k(`trackuserlocationend`));break;case`BACKGROUND`:this._watchState=`ACTIVE_LOCK`,this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-background`),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.k(`trackuserlocationstart`));break;default:throw Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case`WAITING_ACTIVE`:this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-waiting`),this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-active`);break;case`ACTIVE_LOCK`:this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-active`);break;case`OFF`:break;default:throw Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState===`OFF`&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let e;this._geolocateButton.classList.add(`maplibregl-ctrl-geolocate-waiting`),this._geolocateButton.setAttribute(`aria-pressed`,`true`),Mi++,Mi>1?(e={maximumAge:6e5,timeout:0},Ni=!0):(e=this.options.positionOptions,Ni=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove(`maplibregl-ctrl-geolocate-waiting`),this._geolocateButton.setAttribute(`aria-pressed`,`false`),this.options.showUserLocation&&this._updateMarker(null)}},Hi.AttributionControl=di,Hi.LogoControl=fi,Hi.ScaleControl=class{constructor(t){this._onMove=()=>{Fi(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Fi(this._map,this._container,this.options)},this.options=e.e({},Pi,t)}getDefaultPosition(){return`bottom-left`}onAdd(e){return this._map=e,this._container=n.create(`div`,`maplibregl-ctrl maplibregl-ctrl-scale`,e.getContainer()),this._map.on(`move`,this._onMove),this._onMove(),this._container}onRemove(){n.remove(this._container),this._map.off(`move`,this._onMove),this._map=void 0}},Hi.FullscreenControl=class extends e.E{constructor(t={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w(`Full screen control 'container' must be a DOM element.`)),`onfullscreenchange`in document?this._fullscreenchange=`fullscreenchange`:`onmozfullscreenchange`in document?this._fullscreenchange=`mozfullscreenchange`:`onwebkitfullscreenchange`in document?this._fullscreenchange=`webkitfullscreenchange`:`onmsfullscreenchange`in document&&(this._fullscreenchange=`MSFullscreenChange`)}onAdd(e){return this._map=e,this._container||=this._map.getContainer(),this._controlContainer=n.create(`div`,`maplibregl-ctrl maplibregl-ctrl-group`),this._setupUI(),this._controlContainer}onRemove(){n.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let e=this._fullscreenButton=n.create(`button`,`maplibregl-ctrl-fullscreen`,this._controlContainer);n.create(`span`,`maplibregl-ctrl-icon`,e).setAttribute(`aria-hidden`,`true`),e.type=`button`,this._updateTitle(),this._fullscreenButton.addEventListener(`click`,this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let e=this._getTitle();this._fullscreenButton.setAttribute(`aria-label`,e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?`FullscreenControl.Exit`:`FullscreenControl.Enter`)}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(`maplibregl-ctrl-shrink`),this._fullscreenButton.classList.toggle(`maplibregl-ctrl-fullscreen`),this._updateTitle(),this._fullscreen?(this.fire(new e.k(`fullscreenstart`)),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new e.k(`fullscreenend`)),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle(`maplibregl-pseudo-fullscreen`),this._handleFullscreenChange(),this._map.resize()}},Hi.TerrainControl=class{constructor(e){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove(`maplibregl-ctrl-terrain`),this._terrainButton.classList.remove(`maplibregl-ctrl-terrain-enabled`),this._map.terrain?(this._terrainButton.classList.add(`maplibregl-ctrl-terrain-enabled`),this._terrainButton.title=this._map._getUIString(`TerrainControl.disableTerrain`)):(this._terrainButton.classList.add(`maplibregl-ctrl-terrain`),this._terrainButton.title=this._map._getUIString(`TerrainControl.enableTerrain`))},this.options=e}onAdd(e){return this._map=e,this._container=n.create(`div`,`maplibregl-ctrl maplibregl-ctrl-group`),this._terrainButton=n.create(`button`,`maplibregl-ctrl-terrain`,this._container),n.create(`span`,`maplibregl-ctrl-icon`,this._terrainButton).setAttribute(`aria-hidden`,`true`),this._terrainButton.type=`button`,this._terrainButton.addEventListener(`click`,this._toggleTerrain),this._updateTerrainIcon(),this._map.on(`terrain`,this._updateTerrainIcon),this._container}onRemove(){n.remove(this._container),this._map.off(`terrain`,this._updateTerrainIcon),this._map=void 0}},Hi.Popup=class extends e.E{constructor(t){super(),this.remove=()=>(this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off(`move`,this._update),this._map.off(`move`,this._onClose),this._map.off(`click`,this._onClose),this._map.off(`remove`,this.remove),this._map.off(`mousemove`,this._onMouseMove),this._map.off(`mouseup`,this._onMouseUp),this._map.off(`drag`,this._onDrag),delete this._map),this.fire(new e.k(`close`)),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=n.create(`div`,`maplibregl-popup`,this._map.getContainer()),this._tip=n.create(`div`,`maplibregl-popup-tip`,this._container),this._container.appendChild(this._content),this.options.className)for(let e of this.options.className.split(` `))this._container.classList.add(e);this._trackPointer&&this._container.classList.add(`maplibregl-popup-track-pointer`)}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Di(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!e)return;let t=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),r=this.options.anchor,i=zi(this.options.offset);if(!r){let e=this._container.offsetWidth,n=this._container.offsetHeight,a;a=t.y+i.bottom.y<n?[`top`]:t.y>this._map.transform.height-n?[`bottom`]:[],t.x<e/2?a.push(`left`):t.x>this._map.transform.width-e/2&&a.push(`right`),r=a.length===0?`bottom`:a.join(`-`)}let a=t.add(i[r]).round();n.setTransform(this._container,`${Oi[r]} translate(${a.x}px,${a.y}px)`),ki(this._container,r,`popup`)},this._onClose=()=>{this.remove()},this.options=e.e(Object.create(Li),t)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on(`click`,this._onClose),this.options.closeOnMove&&this._map.on(`move`,this._onClose),this._map.on(`remove`,this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on(`mousemove`,this._onMouseMove),this._map.on(`mouseup`,this._onMouseUp),this._container&&this._container.classList.add(`maplibregl-popup-track-pointer`),this._map._canvasContainer.classList.add(`maplibregl-track-pointer`)):this._map.on(`move`,this._update),this.fire(new e.k(`open`)),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.L.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on(`move`,this._update),this._map.off(`mousemove`,this._onMouseMove),this._container&&this._container.classList.remove(`maplibregl-popup-track-pointer`),this._map._canvasContainer.classList.remove(`maplibregl-track-pointer`)),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off(`move`,this._update),this._map.on(`mousemove`,this._onMouseMove),this._map.on(`drag`,this._onDrag),this._container&&this._container.classList.add(`maplibregl-popup-track-pointer`),this._map._canvasContainer.classList.add(`maplibregl-track-pointer`)),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){let t=document.createDocumentFragment(),n=document.createElement(`body`),r;for(n.innerHTML=e;r=n.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){return this._container?.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create(`div`,`maplibregl-popup-content`,this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){this._container&&this._container.classList.add(e)}removeClassName(e){this._container&&this._container.classList.remove(e)}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}_createCloseButton(){this.options.closeButton&&(this._closeButton=n.create(`button`,`maplibregl-popup-close-button`,this._content),this._closeButton.type=`button`,this._closeButton.setAttribute(`aria-label`,`Close popup`),this._closeButton.innerHTML=`&#215;`,this._closeButton.addEventListener(`click`,this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let e=this._container.querySelector(Ri);e&&e.focus()}},Hi.Marker=Ai,Hi.Style=st,Hi.LngLat=e.L,Hi.LngLatBounds=N,Hi.Point=e.P,Hi.MercatorCoordinate=e.U,Hi.Evented=e.E,Hi.AJAXError=e.bi,Hi.config=e.c,Hi.CanvasSource=ne,Hi.GeoJSONSource=R,Hi.ImageSource=B,Hi.RasterDEMTileSource=ee,Hi.RasterTileSource=I,Hi.VectorTileSource=F,Hi.VideoSource=te,Hi.setRTLTextPlugin=e.bj,Hi.getRTLTextPluginStatus=e.bk,Hi.prewarm=function(){W().acquire(U)},Hi.clearPrewarmedResources=function(){let e=me;e&&(e.isPreloaded()&&e.numActive()===1?(e.release(U),me=null):console.warn(`Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()`))},Bi.extend(Hi,{isSafari:e.ac,getPerformanceMetrics:e.bg.getPerformanceMetrics}),Hi})),n}))}));function NJ(e,t){return EY(e,{i:2},t&&t.out,t&&t.dictionary)}function PJ(e,t){var n=OY(e);return n+8>e.length&&TY(6,`invalid gzip data`),EY(e.subarray(n,-8),{i:2},t&&t.out||new $J(kY(e)),t&&t.dictionary)}function FJ(e,t){return EY(e.subarray(AY(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function IJ(e,t){return e[0]==31&&e[1]==139&&e[2]==8?PJ(e,t):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?NJ(e,t):FJ(e,t)}function LJ(e){return QJ(this,null,function*(){let t=yield e.getBytes(0,512e3),n=new DataView(t.data),r=n.getUint32(4,!0),i=n.getUint16(8,!0),a=new TextDecoder(`utf-8`),o=JSON.parse(a.decode(new DataView(t.data,10,r))),s=0;o.compression===`gzip`&&(s=2);let c=0;`minzoom`in o&&(c=+o.minzoom);let l=0;`maxzoom`in o&&(l=+o.maxzoom);let u=0,d=0,f=0,p=-180,m=-85,h=180,g=85;if(o.bounds){let e=o.bounds.split(`,`);p=+e[0],m=+e[1],h=+e[2],g=+e[3]}if(o.center){let e=o.center.split(`,`);u=+e[0],d=+e[1],f=+e[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:c,maxZoom:l,minLon:p,minLat:m,maxLon:h,maxLat:g,centerZoom:f,centerLon:u,centerLat:d,etag:t.etag}})}function RJ(e,t,n,r,i,a,o){return QJ(this,null,function*(){let s=yield n.getArrayBuffer(t,e.rootDirectoryOffset,e.rootDirectoryLength,e);e.specVersion===1&&(s=HY(s));let c=RY(new DataView(s),r,i,a);if(c){let e=(yield t.getBytes(c.offset,c.length,o)).data,n=new DataView(e);return n.getUint8(0)==31&&n.getUint8(1)==139&&(e=IJ(new Uint8Array(e))),{data:e}}let l=WY(new DataView(s),{z:r,x:i,y:a});if(l){let c=LY(new DataView(s),l.z,l.x,l.y);if(c){let s=yield n.getArrayBuffer(t,c.offset,c.length,e);e.specVersion===1&&(s=HY(s));let l=RY(new DataView(s),r,i,a);if(l){let e=(yield t.getBytes(l.offset,l.length,o)).data,n=new DataView(e);return n.getUint8(0)==31&&n.getUint8(1)==139&&(e=IJ(new Uint8Array(e))),{data:e}}}}})}function zJ(e,t){return(t>>>0)*4294967296+(e>>>0)}function BJ(e,t){let n=t.buf,r,i;if(i=n[t.pos++],r=(i&112)>>4,i<128||(i=n[t.pos++],r|=(i&127)<<3,i<128)||(i=n[t.pos++],r|=(i&127)<<10,i<128)||(i=n[t.pos++],r|=(i&127)<<17,i<128)||(i=n[t.pos++],r|=(i&127)<<24,i<128)||(i=n[t.pos++],r|=(i&1)<<31,i<128))return zJ(e,r);throw Error(`Expected varint not more than 10 bytes`)}function VJ(e){let t=e.buf,n,r;return r=t[e.pos++],n=r&127,r<128||(r=t[e.pos++],n|=(r&127)<<7,r<128)||(r=t[e.pos++],n|=(r&127)<<14,r<128)||(r=t[e.pos++],n|=(r&127)<<21,r<128)?n:(r=t[e.pos],n|=(r&15)<<28,BJ(n,e))}function HJ(e,t,n,r){if(r==0){n==1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);let r=t[0];t[0]=t[1],t[1]=r}}function UJ(e,t,n){if(e>26)throw Error(`Tile zoom level exceeds max safe number limit (26)`);if(t>2**e-1||n>2**e-1)throw Error(`tile x/y outside zoom level bounds`);let r=qY[e],i=2**e,a=0,o=0,s=0,c=[t,n],l=i/2;for(;l>0;)a=(c[0]&l)>0?1:0,o=(c[1]&l)>0?1:0,s+=l*l*(3*a^o),HJ(l,c,a,o),l/=2;return r+s}function WJ(e,t){return QJ(this,null,function*(){if(t===1||t===0)return e;if(t===2){if(globalThis.DecompressionStream===void 0)return IJ(new Uint8Array(e));{let t=new Response(e).body.pipeThrough(new globalThis.DecompressionStream(`gzip`));return new Response(t).arrayBuffer()}}else throw Error(`Compression method not supported`)})}function GJ(e,t){let n=0,r=e.length-1;for(;n<=r;){let i=r+n>>1,a=t-e[i].tileId;if(a>0)n=i+1;else if(a<0)r=i-1;else return e[i]}return r>=0&&(e[r].runLength===0||t-e[r].tileId<e[r].runLength)?e[r]:null}function KJ(e,t){let n=e.getUint32(t+4,!0),r=e.getUint32(t+0,!0);return n*2**32+r}function qJ(e,t){let n=new DataView(e),r=n.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:KJ(n,8),rootDirectoryLength:KJ(n,16),jsonMetadataOffset:KJ(n,24),jsonMetadataLength:KJ(n,32),leafDirectoryOffset:KJ(n,40),leafDirectoryLength:KJ(n,48),tileDataOffset:KJ(n,56),tileDataLength:KJ(n,64),numAddressedTiles:KJ(n,72),numTileEntries:KJ(n,80),numTileContents:KJ(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:t}}function JJ(e){let t={buf:new Uint8Array(e),pos:0},n=VJ(t),r=[],i=0;for(let e=0;e<n;e++){let e=VJ(t);r.push({tileId:i+e,offset:0,length:0,runLength:1}),i+=e}for(let e=0;e<n;e++)r[e].runLength=VJ(t);for(let e=0;e<n;e++)r[e].length=VJ(t);for(let e=0;e<n;e++){let n=VJ(t);n===0&&e>0?r[e].offset=r[e-1].offset+r[e-1].length:r[e].offset=n-1}return r}function YJ(e){let t=new DataView(e);return t.getUint16(2,!0)===2?(console.warn(`PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade`),2):t.getUint16(2,!0)===1?(console.warn(`PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade`),1):3}function XJ(e,t,n,r){return QJ(this,null,function*(){let i=yield e.getBytes(0,16384);if(new DataView(i.data).getUint16(0,!0)!==19792)throw Error(`Wrong magic number for PMTiles archive`);if(YJ(i.data)<3)return[yield GY.getHeader(e)];let a=i.data.slice(0,JY),o=i.etag;r&&i.etag!=r&&(console.warn(`ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for `+e.getKey()),o=void 0);let s=qJ(a,o);if(n){let n=i.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),r=e.getKey()+`|`+(s.etag||``)+`|`+s.rootDirectoryOffset+`|`+s.rootDirectoryLength,a=JJ(yield t(n,s.internalCompression));return[s,[r,a.length,a]]}return[s,void 0]})}function ZJ(e,t,n,r,i){return QJ(this,null,function*(){let a=yield e.getBytes(n,r);if(i.etag&&i.etag!==a.etag)throw new XY(a.etag);let o=JJ(yield t(a.data,i.internalCompression));if(o.length===0)throw Error(`Empty directory is invalid`);return o})}var QJ,$J,eY,tY,nY,rY,iY,aY,oY,sY,cY,lY,uY,dY,fY,pY,mY,hY,gY,_Y,vY,yY,bY,xY,SY,CY,wY,TY,EY,DY,OY,kY,AY,jY,MY,NY,PY,FY,IY,LY,RY,zY,BY,VY,HY,UY,WY,GY,KY,qY,JY,YY,XY,ZY,QY,$Y=o((()=>{for(QJ=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),$J=Uint8Array,eY=Uint16Array,tY=Int32Array,nY=new $J([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),rY=new $J([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),iY=new $J([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),aY=function(e,t){for(var n=new eY(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var i=new tY(n[30]),r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return{b:n,r:i}},oY=aY(nY,2),sY=oY.b,cY=oY.r,sY[28]=258,cY[258]=28,lY=aY(rY,0),uY=lY.b,lY.r,dY=new eY(32768),pY=0;pY<32768;++pY)fY=(pY&43690)>>1|(pY&21845)<<1,fY=(fY&52428)>>2|(fY&13107)<<2,fY=(fY&61680)>>4|(fY&3855)<<4,dY[pY]=((fY&65280)>>8|(fY&255)<<8)>>1;for(mY=function(e,t,n){for(var r=e.length,i=0,a=new eY(t);i<r;++i)e[i]&&++a[e[i]-1];var o=new eY(t);for(i=1;i<t;++i)o[i]=o[i-1]+a[i-1]<<1;var s;if(n){s=new eY(1<<t);var c=15-t;for(i=0;i<r;++i)if(e[i])for(var l=i<<4|e[i],u=t-e[i],d=o[e[i]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)s[dY[d]>>c]=l}else for(s=new eY(r),i=0;i<r;++i)e[i]&&(s[i]=dY[o[e[i]-1]++]>>15-e[i]);return s},hY=new $J(288),pY=0;pY<144;++pY)hY[pY]=8;for(pY=144;pY<256;++pY)hY[pY]=9;for(pY=256;pY<280;++pY)hY[pY]=7;for(pY=280;pY<288;++pY)hY[pY]=8;for(gY=new $J(32),pY=0;pY<32;++pY)gY[pY]=5;_Y=mY(hY,9,1),vY=mY(gY,5,1),yY=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},bY=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},xY=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},SY=function(e){return(e+7)/8|0},CY=function(e,t,n){(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length);var r=new $J(n-t);return r.set(e.subarray(t,n)),r},wY=[`unexpected EOF`,`invalid block type`,`invalid length/literal`,`invalid distance`,`stream finished`,`no stream handler`,,`no callback`,`invalid UTF-8 data`,`extra field too long`,`date not in range 1980-2099`,`filename too long`,`stream finishing`,`invalid zip data`],TY=function(e,t,n){var r=Error(t||wY[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,TY),!n)throw r;return r},EY=function(e,t,n,r){var i=e.length,a=r?r.length:0;if(!i||t.f&&!t.l)return n||new $J(0);var o=!n||t.i!=2,s=t.i;n||=new $J(i*3);var c=function(e){var t=n.length;if(e>t){var r=new $J(Math.max(t*2,e));r.set(n),n=r}},l=t.f||0,u=t.p||0,d=t.b||0,f=t.l,p=t.d,m=t.m,h=t.n,g=i*8;do{if(!f){l=bY(e,u,1);var _=bY(e,u+1,3);if(u+=3,!_){var v=SY(u)+4,y=e[v-4]|e[v-3]<<8,b=v+y;if(b>i){s&&TY(0);break}o&&c(d+y),n.set(e.subarray(v,b),d),t.b=d+=y,t.p=u=b*8,t.f=l;continue}else if(_==1)f=_Y,p=vY,m=9,h=5;else if(_==2){var x=bY(e,u,31)+257,S=bY(e,u+10,15)+4,C=x+bY(e,u+5,31)+1;u+=14;for(var w=new $J(C),E=new $J(19),D=0;D<S;++D)E[iY[D]]=bY(e,u+D*3,7);u+=S*3;for(var O=yY(E),k=(1<<O)-1,A=mY(E,O,1),D=0;D<C;){var j=A[bY(e,u,k)];u+=j&15;var v=j>>4;if(v<16)w[D++]=v;else{var M=0,N=0;for(v==16?(N=3+bY(e,u,3),u+=2,M=w[D-1]):v==17?(N=3+bY(e,u,7),u+=3):v==18&&(N=11+bY(e,u,127),u+=7);N--;)w[D++]=M}}var P=w.subarray(0,x),F=w.subarray(x);m=yY(P),h=yY(F),f=mY(P,m,1),p=mY(F,h,1)}else TY(1);if(u>g){s&&TY(0);break}}o&&c(d+131072);for(var I=(1<<m)-1,ee=(1<<h)-1,R=u;;R=u){var M=f[xY(e,u)&I],z=M>>4;if(u+=M&15,u>g){s&&TY(0);break}if(M||TY(2),z<256)n[d++]=z;else if(z==256){R=u,f=null;break}else{var B=z-254;if(z>264){var D=z-257,te=nY[D];B=bY(e,u,(1<<te)-1)+sY[D],u+=te}var ne=p[xY(e,u)&ee],re=ne>>4;ne||TY(3),u+=ne&15;var F=uY[re];if(re>3){var te=rY[re];F+=xY(e,u)&(1<<te)-1,u+=te}if(u>g){s&&TY(0);break}o&&c(d+131072);var V=d+B;if(d<F){var ie=a-F,ae=Math.min(F,V);for(ie+d<0&&TY(3);d<ae;++d)n[d]=r[ie+d]}for(;d<V;d+=4)n[d]=n[d-F],n[d+1]=n[d+1-F],n[d+2]=n[d+2-F],n[d+3]=n[d+3-F];d=V}}t.l=f,t.p=R,t.b=d,t.f=l,f&&(l=1,t.m=m,t.d=p,t.n=h)}while(!l);return d==n.length?n:CY(n,0,d)},DY=new $J(0),OY=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&TY(6,`invalid gzip data`);var t=e[3],n=10;t&4&&(n+=(e[10]|e[11]<<8)+2);for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(t&2)},kY=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},AY=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&TY(6,`invalid zlib data`),(e[1]>>5&1)==+!t&&TY(6,`invalid zlib data: `+(e[1]&32?`need`:`unexpected`)+` dictionary`),(e[1]>>3&4)+2},jY=typeof TextDecoder<`u`&&new TextDecoder;try{jY.decode(DY,{stream:!0})}catch{}MY=(e,t)=>e*2**t,NY=(e,t)=>Math.floor(e/2**t),PY=(e,t)=>MY(e.getUint16(t+1,!0),8)+e.getUint8(t),FY=(e,t)=>MY(e.getUint32(t+2,!0),16)+e.getUint16(t,!0),IY=(e,t,n,r,i)=>{if(e!=r.getUint8(i))return e-r.getUint8(i);let a=PY(r,i+1);if(t!=a)return t-a;let o=PY(r,i+4);return n==o?0:n-o},LY=(e,t,n,r)=>{let i=zY(e,t|128,n,r);return i?{z:t,x:n,y:r,offset:i[0],length:i[1],is_dir:!0}:null},RY=(e,t,n,r)=>{let i=zY(e,t,n,r);return i?{z:t,x:n,y:r,offset:i[0],length:i[1],is_dir:!1}:null},zY=(e,t,n,r)=>{let i=0,a=e.byteLength/17-1;for(;i<=a;){let o=a+i>>1,s=IY(t,n,r,e,o*17);if(s>0)i=o+1;else if(s<0)a=o-1;else return[FY(e,o*17+7),e.getUint32(o*17+13,!0)]}return null},BY=(e,t)=>e.is_dir&&!t.is_dir?1:!e.is_dir&&t.is_dir?-1:e.z===t.z?e.x===t.x?e.y-t.y:e.x-t.x:e.z-t.z,VY=(e,t)=>{let n=e.getUint8(t*17);return{z:n&127,x:PY(e,t*17+1),y:PY(e,t*17+4),offset:FY(e,t*17+7),length:e.getUint32(t*17+13,!0),is_dir:n>>7==1}},HY=e=>{let t=[],n=new DataView(e);for(let e=0;e<n.byteLength/17;e++)t.push(VY(n,e));return UY(t)},UY=e=>{e.sort(BY);let t=new ArrayBuffer(17*e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++){let r=e[t],i=r.z;r.is_dir&&(i|=128),n[t*17]=i,n[t*17+1]=r.x&255,n[t*17+2]=r.x>>8&255,n[t*17+3]=r.x>>16&255,n[t*17+4]=r.y&255,n[t*17+5]=r.y>>8&255,n[t*17+6]=r.y>>16&255,n[t*17+7]=r.offset&255,n[t*17+8]=NY(r.offset,8)&255,n[t*17+9]=NY(r.offset,16)&255,n[t*17+10]=NY(r.offset,24)&255,n[t*17+11]=NY(r.offset,32)&255,n[t*17+12]=NY(r.offset,48)&255,n[t*17+13]=r.length&255,n[t*17+14]=r.length>>8&255,n[t*17+15]=r.length>>16&255,n[t*17+16]=r.length>>24&255}return t},WY=(e,t)=>{if(e.byteLength<17)return null;let n=VY(e,e.byteLength/17-1);if(n.is_dir){let e=n.z,r=t.z-e;return{z:e,x:Math.trunc(t.x/(1<<r)),y:Math.trunc(t.y/(1<<r))}}return null},GY={getHeader:LJ,getZxy:RJ},KY=class{constructor(){this.tile=(e,t)=>{if(e.type==`json`){let n=e.url.substr(10),r=this.tiles.get(n);return r||(r=new QY(n),this.tiles.set(n,r)),r.getHeader().then(n=>{t(null,{tiles:[e.url+`/{z}/{x}/{y}`],minzoom:n.minZoom,maxzoom:n.maxZoom,bounds:[n.minLon,n.minLat,n.maxLon,n.maxLat]},null,null)}).catch(e=>{t(e,null,null,null)}),{cancel:()=>{}}}else{let n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=e.url.match(n);if(!r)throw Error(`Invalid PMTiles protocol URL`);let i=r[1],a=this.tiles.get(i);a||(a=new QY(i),this.tiles.set(i,a));let o=r[2],s=r[3],c=r[4],l=new AbortController,u=l.signal;return a.getHeader().then(e=>{a.getZxy(+o,+s,+c,u).then(n=>{n?t(null,new Uint8Array(n.data),n.cacheControl,n.expires):e.tileType==1?t(null,new Uint8Array,null,null):t(null,null,null,null)}).catch(e=>{e.name!==`AbortError`&&t(e,null,null,null)})}),{cancel:()=>{l.abort()}}}},this.tiles=new Map}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}},qY=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555],JY=127,YY=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n){return QJ(this,null,function*(){let r;n||=(r=new AbortController,r.signal);let i=new Headers(this.customHeaders);i.set(`Range`,`bytes=`+e+`-`+(e+t-1));let a=yield fetch(this.url,{signal:n,headers:i});if(a.status===416&&e===0){let e=a.headers.get(`Content-Range`);if(!e||!e.startsWith(`bytes */`))throw Error(`Missing content-length on 416 response`);let t=+e.substr(8);a=yield fetch(this.url,{signal:n,headers:{Range:`bytes=0-`+(t-1)}})}if(a.status>=300)throw Error(`Bad response code: `+a.status);let o=a.headers.get(`Content-Length`);if(a.status===200&&(!o||+o>t))throw r&&r.abort(),Error(`Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.`);return{data:yield a.arrayBuffer(),etag:a.headers.get(`ETag`)||void 0,cacheControl:a.headers.get(`Cache-Control`)||void 0,expires:a.headers.get(`Expires`)||void 0}})}},XY=class extends Error{},ZY=class{constructor(e=100,t=!0,n=WJ){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.prefetch=t,this.decompress=n}getHeader(e,t){return QJ(this,null,function*(){let n=e.getKey();if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;let r=new Promise((n,r)=>{XJ(e,this.decompress,this.prefetch,t).then(e=>{e[1]&&this.cache.set(e[1][0],{lastUsed:this.counter++,data:Promise.resolve(e[1][2])}),n(e[0]),this.prune()}).catch(e=>{r(e)})});return this.cache.set(n,{lastUsed:this.counter++,data:r}),r})}getDirectory(e,t,n,r){return QJ(this,null,function*(){let i=e.getKey()+`|`+(r.etag||``)+`|`+t+`|`+n;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;let a=new Promise((i,a)=>{ZJ(e,this.decompress,t,n,r).then(e=>{i(e),this.prune()}).catch(e=>{a(e)})});return this.cache.set(i,{lastUsed:this.counter++,data:a}),a})}getArrayBuffer(e,t,n,r){return QJ(this,null,function*(){let i=e.getKey()+`|`+(r.etag||``)+`|`+t+`|`+n;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;let a=new Promise((a,o)=>{e.getBytes(t,n).then(e=>{if(r.etag&&r.etag!==e.etag)throw new XY(e.etag);a(e.data),this.cache.has(i),this.prune()}).catch(e=>{o(e)})});return this.cache.set(i,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,r)=>{n.lastUsed<e&&(e=n.lastUsed,t=r)}),t&&this.cache.delete(t)}}invalidate(e,t){return QJ(this,null,function*(){this.cache.delete(e.getKey()),yield this.getHeader(e,t)})}},QY=class{constructor(e,t,n){typeof e==`string`?this.source=new YY(e):this.source=e,n?this.decompress=n:this.decompress=WJ,t?this.cache=t:this.cache=new ZY}getHeader(){return QJ(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,r){return QJ(this,null,function*(){let i=UJ(e,t,n),a=yield this.cache.getHeader(this.source);if(a.specVersion<3)return GY.getZxy(a,this.source,this.cache,e,t,n,r);if(e<a.minZoom||e>a.maxZoom)return;let o=a.rootDirectoryOffset,s=a.rootDirectoryLength;for(let e=0;e<=3;e++){let e=GJ(yield this.cache.getDirectory(this.source,o,s,a),i);if(e)if(e.runLength>0){let t=yield this.source.getBytes(a.tileDataOffset+e.offset,e.length,r);if(a.etag&&a.etag!==t.etag)throw new XY(t.etag);return{data:yield this.decompress(t.data,a.tileCompression),cacheControl:t.cacheControl,expires:t.expires}}else o=a.leafDirectoryOffset+e.offset,s=e.length;else return}throw Error(`Maximum directory depth exceeded`)})}getZxy(e,t,n,r){return QJ(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,r)}catch(i){if(i instanceof XY)return this.cache.invalidate(this.source,i.message),yield this.getZxyAttempt(e,t,n,r);throw i}})}getMetadataAttempt(){return QJ(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength);if(e.etag&&e.etag!==t.etag)throw new XY(t.etag);let n=yield this.decompress(t.data,e.internalCompression),r=new TextDecoder(`utf-8`);return JSON.parse(r.decode(n))})}getMetadata(){return QJ(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof XY)return this.cache.invalidate(this.source,e.message),yield this.getMetadataAttempt();throw e}})}}}));function eX(e,t){var n=typeof my<`u`&&!!my&&typeof my.showToast==`function`&&my.isFRM!==!0,r=typeof wx<`u`&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0);if(!(n||r)&&(t||=document,t)){var i=t.head||t.getElementsByTagName(`head`)[0];if(!i){i=t.createElement(`head`);var a=t.body||t.getElementsByTagName(`body`)[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement(`style`);return o.type=`text/css`,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}var tX,nX,rX,iX,aX=o((()=>{cv(),Ix(),Py(),ov(),Rb(),tX=u(MJ()),$Y(),eq(),nq(),Tq(),nX=[`id`,`attributionControl`,`style`,`rotation`,`mapInstance`],eX(`.maplibregl-map{-webkit-tap-highlight-color:rgb(0 0 0/0);font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:-moz-full-screen{height:100%;width:100%}.maplibregl-map:-ms-fullscreen{height:100%;width:100%}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23999' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{-webkit-animation:maplibregl-spin 2s linear infinite;animation:maplibregl-spin 2s linear infinite}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E")}}@-webkit-keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (-ms-high-contrast:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:hsla(0,0%,100%,.5);margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:hsla(0,0%,100%,.5);background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:hsla(0,0%,100%,.75);border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:rgb(0 0 0/5%)}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{-webkit-animation:maplibregl-user-location-dot-pulse 2s infinite;animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px rgba(0,0,0,.35);box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@-webkit-keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:rgba(0,0,0,.4);color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}`),window.maplibregl=tX.default,rX=0,iX=class extends wq{constructor(...e){super(...e),J(this,`version`,tq.MAPBOX),J(this,`viewport`,void 0)}getType(){return`mapbox`}lngLatToCoord(e,t={x:0,y:0,z:0}){let{x:n,y:r}=this.lngLatToMercator(e,0);return[n-t.x,r-t.y]}lngLatToMercator(e,t){let{x:n=0,y:r=0,z:i=0}=window.maplibregl.MercatorCoordinate.fromLngLat(e,t);return{x:n,y:r,z:i}}getModelMatrix(e,t,n,r=[1,1,1],i={x:0,y:0,z:0}){let a=window.maplibregl.MercatorCoordinate.fromLngLat(e,t),o=a.meterInMercatorCoordinateUnits(),s=Ky();return Qy(s,s,lb(a.x-i.x,a.y-i.y,a.z||0-i.z)),$y(s,s,lb(o*r[0],-o*r[1],o*r[2])),eb(s,s,n[0]),tb(s,s,n[1]),nb(s,s,n[2]),s}init(){var e=this;return Z(function*(){let t=e.config,{id:n=`map`,attributionControl:r=!1,style:i=`light`,rotation:a=0,mapInstance:o}=t,s=Fx(t,nX);e.viewport=new $K,!o&&!window.maplibregl&&console.error(e.configService.getSceneWarninfo(`SDK`)),o?(e.map=o,e.$mapContainer=e.map.getContainer()):(e.$mapContainer=e.creatMapContainer(n),typeof i!=`string`&&e.addProtocol(),e.map=new window.maplibregl.Map(Y({container:e.$mapContainer,style:e.getMapStyleValue(i),attributionControl:r,bearing:a},s))),e.map.on(`load`,()=>{e.handleCameraChanged()}),e.map.on(`move`,e.handleCameraChanged),e.handleCameraChanged()})()}addProtocol(){let e=new KY;tX.default.addProtocol(`pmtiles`,e.tile)}destroy(){var e;(e=this.$mapContainer)==null||(e=e.parentNode)==null||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(e,...t){this.eventEmitter.emit(e,...t)}once(e,...t){this.eventEmitter.once(e,...t)}getMapContainer(){return this.$mapContainer}getCanvasOverlays(){return this.getMapContainer()?.querySelector(`.maplibregl-canvas-container`)}meterToCoord(e,t){let n=new tX.default.LngLat(e[0],e[1]),r=new tX.default.LngLat(t[0],t[1]),i=n.distanceTo(r),a=tX.default.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),o=tX.default.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),{x:s,y:c}=a,{x:l,y:u}=o;return Math.sqrt((s-l)**2+(c-u)**2)*4194304*2/i}exportMap(e){let t=this.map.getCanvas();return e===`jpg`?t?.toDataURL(`image/jpeg`):t?.toDataURL(`image/png`)}creatMapContainer(e){let t=e;typeof e==`string`&&(t=document.getElementById(e));let n=document.createElement(`div`);return n.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,n.id=`l7_mapbox_div`+ rX++,t.appendChild(n),n}}})),oX,sX=o((()=>{BH(),aX(),oX=class extends zH{getServiceConstructor(){return iX}}})),cX,lX=o((()=>{cX=e=>{let{tk:t}=e;return new Promise(e=>{let n=document.createElement(`script`);n.type=`text/javascript`,n.src=`https://api.tianditu.gov.cn/api?v=4.0&tk=${t}`,n.onload=function(){console.log(`TianDiTu API script loaded.`),e(!0)},n.onerror=function(){console.error(`Failed to load TianDiTu API script.`),e(!1)},document.head.appendChild(n)})}})),uX,dX,fX,pX=o((()=>{Py(),ov(),Tq(),UC(),GG(),eq(),lX(),uX=0,dX={zoomchange:[`Ge`]},fX=class extends wq{constructor(...e){super(...e),J(this,`viewport`,null),J(this,`evtCbProxyMap`,new Map),J(this,`sceneContainer`,void 0),J(this,`handleCameraChanged`,()=>{this.emit(`mapchange`);let e=this.map,{lng:t,lat:n}=this.map.getCenter(),r={center:[t,n],viewportHeight:e.getContainer().clientHeight,viewportWidth:e.getContainer().clientWidth,bearing:360,pitch:0,zoom:e.getZoom()-1};this.viewport&&(this.viewport.syncWithMapCamera(r),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport))})}addMarkerContainer(){let e=this.map.getContainer(),t=this.markerContainer=document.createElement(`div`);e.appendChild(t),t.setAttribute(`tabindex`,`-1`),t.id=`tdt-L7-marker`,t.style.position=`absolute`,t.style.left=``,t.style.top=``,t.style.zIndex=`600`,t.style.width=`0px`,t.style.height=`0px`,t.style.overflow=`visible`}getMarkerContainer(){return this.markerContainer}onCameraChanged(e){this.cameraChangedCallback=e}resize(e){this.sceneContainer.style.width=e.newSize.x+`px`,this.sceneContainer.style.height=e.newSize.y+`px`}update(){let e=this.map.getBounds(),{x:t,y:n}=this.map.lngLatToLayerPoint({lng:e.getSouthWest().lng,lat:e.getNorthEast().lat});this.sceneContainer.style.transition=``,this.sceneContainer.style.transformOrigin=`center`,this.sceneContainer.style.transform=`translate3d(${t}px, ${n}px, 0px) scale(1)`,this.markerContainer.style.transition=``,this.markerContainer.style.transformOrigin=`center`,this.markerContainer.style.transform=`translate3d(${-t}px, ${-n}px, 0px) scale(1)`,this.sceneContainer._tdt_pos=new T.Point(t,n),this.handleCameraChanged()}getZoomScale(e,t){let n=this.map.options.IW;return t=t===void 0?this.map.getZoom():t,n.scale(e)/n.scale(t)}zoomStartUpdate(e){let t=e.center,n=e.zoom,r=this.getZoomScale(n,this.map.getZoom()),i=T._Q.getPosition(this.sceneContainer),a=this.map.getSize().GQ(.5),o=this.map.options.IW.qW(this.map.getCenter(),n),s=this.map.options.IW.qW(t,n).DQ(o),c=new T.Point(a.x,a.y).GQ(-r);c.aQ(i),c.aQ(a),c.DQ(s),this.sceneContainer.style.transform=`translate3d(${c.x}px,${c.y}px,0px) scale(${r})`,this.sceneContainer.style.transformOrigin=`0 0`,this.sceneContainer.style.transition=`transform 0.25s cubic-bezier(0,0,0.25,1)`,this.handleCameraChanged()}getOverlayContainer(){let e=this.map.getPanes()?.overlayPane,t=document.createElement(`div`);e.parentElement.appendChild(t),t.id=`tdt-L7`;let n=this.map.getSize();return t.style.zIndex=`200`,t.style.width=`${n.x}px`,t.style.height=`${n.y}px`,this.sceneContainer=t,t}init(){var e=this;return Z(function*(){e.viewport=new $K;let{id:t,mapInstance:n,center:r=[121.30654632240122,31.25744185633306],token:i=`b15e548080c79819617367d3f6095c69`,minZoom:a=1,maxZoom:o=18,zoom:s=3}=e.config;if(window.T||(yield cX({tk:i})),n){e.map=n,e.map.centerAndZoom(new window.T.LngLat(r[0],r[1]),s),e.$mapContainer=e.map.getContainer();let t=new window.T.LngLat(r[0],r[1]);e.map.centerAndZoom(t,s),e.setMinZoom(a),e.setMaxZoom(o)}else{if(!t)throw Error(`No container id specified`);e.$mapContainer=e.creatMapContainer(t);let n=new T.Map(e.$mapContainer,{center:window.T.LngLat(r[0],r[1]),minZoom:a,maxZoom:o,zoom:s,projection:`EPSG:900913`});e.map=n;let i=new window.T.Control.Zoom;n.addControl(i)}let c=e.map.getContainer().querySelector(`.tdt-pane`);c.style.zIndex=1,e.handleCameraChanged(),e.map.on(`move`,e.update,e),e.map.on(`Ge`,e.zoomStartUpdate,e),e.map.on(`resize`,e.resize,e)})()}destroy(){}on(e,t){if(cy.indexOf(e)!==-1)this.eventEmitter.on(e,t);else{let n=e=>{let n=this.evtCbProxyMap.get(e);if(n||this.evtCbProxyMap.set(e,n=new Map),n.get(t))return;let r=(...e)=>{e[0]&&typeof e[0]==`object`&&!e[0].lngLat&&!e[0].lnglat&&(e[0].lngLat=e[0].latlng||e[0].latLng,e[0].map=this.map),t(...e)};n.set(t,r),this.map.on(e,r)};Array.isArray(dX[e])?dX[e].forEach(t=>{n(t||e)}):n(dX[e]||e)}}off(e,t){if(cy.indexOf(e)!==-1){this.eventEmitter.off(e,t);return}let n=n=>{var r;let i=this.evtCbProxyMap.get(e)?.get(t);i&&((r=this.evtCbProxyMap.get(n))==null||r.delete(t),this.map.off(n,i))};Array.isArray(dX[e])?dX[e].forEach(t=>{n(t||e)}):n(dX[e]||e)}once(e,t){throw Error(`Method not implemented.`)}getMapContainer(){return this.map.getContainer()}getType(){return`tdtmap`}getMapCanvasContainer(){return this.map.getContainer()?.getElementsByClassName(`tdt-container`)[0]}getSize(){let e=this.map.getSize();return[e.x,e.y]}getZoom(){return this.map.getZoom()}setZoom(e){return this.map.setZoom(e)}getCenter(){return this.map.getCenter()}setCenter(e){let t=window.T.LngLat(e[0],e[1]);this.map.centerAndZoom(t,this.map.getZoom())}setZoomAndCenter(e,t){let n=window.T.LngLat(t[0],t[1]);this.map.centerAndZoom(n,e)}getPitch(){return 0}getRotation(){return 0}setRotation(e){this.map.setBearing(e)}zoomIn(e,t){this.map.zoomIn(e,t)}zoomOut(e,t){this.map.zoomOut(e,t)}panTo(e){this.map.panTo(e)}panBy(e=0,t=0){this.map.panBy([e,t])}fitBounds(e){let[t,n]=e;this.map.setViewport([new window.T.LngLat(t[0],t[1]),new window.T.LngLat(n[0],n[1])])}setMaxZoom(e){this.map.setMaxZoom(e)}setMinZoom(e){this.map.setMinZoom(e)}setMapStatus(e){e.doubleClickZoom===!0&&this.map.enableDoubleClickZoom(),e.doubleClickZoom===!1&&this.map.disableDoubleClickZoom(),e.dragEnable===!1&&this.map.disableDrag(),e.dragEnable===!0&&this.map.enableDrag(),e.keyboardEnable===!1&&this.map.disableKeyboard(),e.keyboardEnable===!0&&this.map.enableKeyboard(),e.zoomEnable===!1&&this.map.disableScrollWheelZoom(),e.zoomEnable===!0&&this.map.enableScrollWheelZoom()}getModelMatrix(){throw Error(`Method not implemented.`)}pixelToLngLat([e,t]){let n=this.map.layerPointToLngLat({x:e,y:t});return{lng:n.lng,lat:n.lat}}lngLatToPixel([e,t]){let n=this.map.lngLatToLayerPoint({lng:e,lat:t});return{x:n.x,y:n.y}}containerToLngLat([e,t]){let n=this.map.containerPointToLngLat({x:e,y:t});return{lng:n.lng,lat:n.lat}}lngLatToContainer([e,t]){let n=this.map.lngLatToContainerPoint({lat:t,lng:e});return{x:n.x,y:n.y}}lngLatToCoord([e,t]){let n=this.lngLatToPixel([e,t]);return[n.x,n.y]}lngLatToCoords(e){return e.map(e=>Array.isArray(e[0])?this.lngLatToCoords(e):this.lngLatToCoord(e))}getBounds(){let e=this.map.getBounds(),t=e.getSouthWest(),n=e.getNorthEast();return[[t.lng,t.lat],[n.lng,n.lat]]}lngLatToMercator(e,t){let{x:n=0,y:r=0,z:i=0}=MU.fromLngLat(e,t);return{x:n,y:r,z:i}}getCustomCoordCenter(){throw Error(`Method not implemented.`)}creatMapContainer(e){let t=e;typeof e==`string`&&(t=document.getElementById(e));let n=document.createElement(`div`);return n.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,n.id=`l7_tdt_div`+ uX++,t.appendChild(n),n}}})),mX,hX=o((()=>{BH(),pX(),mX=class extends zH{getServiceConstructor(){return fX}}})),gX,_X,vX,yX,bX,xX,SX,CX,wX=o((()=>{if(!window)throw Error(`TMap JSAPI can only be used in Browser.`);gX=function(e){return e.notload=`notload`,e.loading=`loading`,e.loaded=`loaded`,e.failed=`failed`,e}(gX||{}),_X={key:``,version:`1.exp`,libraries:[]},vX={TMap:gX.notload},yX=[],bX=e=>{if(typeof e==`function`){if(vX.TMap===gX.loaded){e(window.TMap);return}yX.push(e)}},xX=e=>new Promise((t,n)=>{if(vX.TMap===gX.failed)n(``);else if(vX.TMap===gX.notload){let{key:r,version:i,libraries:a}=e;if(!r){n(`请填写key`);return}_X.key=r,_X.version=i||_X.version,_X.libraries=a||_X.libraries,vX.TMap=gX.loading,window._onTMapAPILoaded=e=>{if(delete window._onTMapAPILoaded,e)vX.TMap=gX.failed,n(e);else for(vX.TMap=gX.loaded;yX.length;)yX.splice(0,1)[0](window.TMap)};let o=document.createElement(`script`);o.type=`text/javascript`,o.async=!1,o.src=`https://map.qq.com/api/gljs?callback=_onTMapAPILoaded&v=`+_X.version+`&key=`+r+`&plugin=`+_X.libraries.join(`,`),o.onerror=e=>{vX.TMap=gX.failed,n(e)},(document.body||document.head).appendChild(o),bX(t)}else if(vX.TMap===gX.loaded){if(e.key&&e.key!==_X.key){n(`多个不一致的 key`);return}if(e.version&&e.version!==_X.version){n(`不允许多个版本 JSAPI 混用`);return}bX(t)}}),SX=()=>{delete window.TMap,vX={TMap:gX.notload}},CX={load:xX,reset:SX}}));function TX(e,t){var n=typeof my<`u`&&!!my&&typeof my.showToast==`function`&&my.isFRM!==!0,r=typeof wx<`u`&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0);if(!(n||r)&&(t||=document,t)){var i=t.head||t.getElementsByTagName(`head`)[0];if(!i){i=t.createElement(`head`);var a=t.body||t.getElementsByTagName(`body`)[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement(`style`);return o.type=`text/css`,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}var EX,DX,OX,kX,AX,jX=o((()=>{cv(),Ix(),Py(),ov(),UC(),GG(),kp(),Rb(),eq(),Tq(),wX(),EX=[`id`,`mapInstance`,`center`,`token`,`version`,`libraries`,`minZoom`,`maxZoom`,`rotation`,`pitch`,`mapSize`,`logoVisible`],TX(`img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],
.logo-text {
  display: none !important;
}

.tencent-map > canvas + div {
  z-index: 3 !important;
}
`),DX=`OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77`,OX=`1.exp`,kX={mapmove:`center_changed`,camerachange:[`drag`,`pan`,`rotate`,`pitch`,`zoom`],zoomchange:`zoom`,dragging:`drag`},AX=class extends wq{constructor(...e){super(...e),J(this,`viewport`,null),J(this,`evtCbProxyMap`,new Map),J(this,`handleCameraChanged`,()=>{this.emit(`mapchange`);let e=this.map,{lng:t,lat:n}=e.getCenter(),r={center:[t,n],viewportHeight:e.getContainer().clientHeight,viewportWidth:e.getContainer().clientWidth,bearing:e.getHeading(),pitch:e.getPitch(),zoom:e.getZoom()-1};this.viewport.syncWithMapCamera(r),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)})}init(){var e=this;return Z(function*(){e.viewport=new $K;let t=e.config,{id:n,mapInstance:r,center:i=[121.30654632240122,31.25744185633306],token:a=DX,version:o=OX,libraries:s=[],minZoom:c=3,maxZoom:l=18,rotation:u=0,pitch:d=0,mapSize:f=1e4,logoVisible:p=!0}=t,m=Fx(t,EX);if(window.TMap||r||(yield CX.load({key:a,version:o,libraries:s})),r)e.map=r,e.$mapContainer=e.map.getContainer(),p===!1&&e.hideLogo();else{if(!n)throw Error(`No container id specified`);let t=iu(n),r=new TMap.Map(t,Y({maxZoom:l,minZoom:c,rotation:u,pitch:d,showControl:!1,center:new TMap.LatLng(i[1],i[0])},m));e.map=r,e.$mapContainer=r.getContainer(),p===!1&&e.hideLogo()}e.map.canvasContainer.style.position=`absolute`,e.map.drawContainer.classList.add(`tencent-map`);let h=e.map.controlManager.controlContainer?.parentNode;h&&(h.style.zIndex=2),e.simpleMapCoord.setSize(f),e.map.on(`drag`,e.handleCameraChanged),e.map.on(`pan`,e.handleCameraChanged),e.map.on(`rotate`,e.handleCameraChanged),e.map.on(`pitch`,e.handleCameraChanged),e.map.on(`zoom`,e.handleCameraChanged),e.handleCameraChanged()})()}destroy(){this.map.destroy()}onCameraChanged(e){this.cameraChangedCallback=e}addMarkerContainer(){this.markerContainer=cu(`div`,`l7-marker-container`,this.map.getContainer()),this.markerContainer.setAttribute(`tabindex`,`-1`),this.markerContainer.style.zIndex=`2`}getMarkerContainer(){return this.markerContainer}on(e,t){if(cy.indexOf(e)!==-1)this.eventEmitter.on(e,t);else{let n=e=>{let n=this.evtCbProxyMap.get(e);if(n||this.evtCbProxyMap.set(e,n=new Map),n.get(t))return;let r=(...e)=>{e[0]&&typeof e[0]==`object`&&!e[0].lngLat&&!e[0].lnglat&&(e[0].lngLat=e[0].latlng||e[0].latLng),t(...e)};n.set(t,r),e===`mouseover`&&this.map.getContainer().addEventListener(`mouseover`,e=>{this.map.emit(e.type,new gU(e.type,this.map,e))}),this.map.on(e,r)};Array.isArray(kX[e])?kX[e].forEach(t=>{n(t||e)}):n(kX[e]||e)}}off(e,t){if(cy.indexOf(e)!==-1){this.eventEmitter.off(e,t);return}let n=n=>{var r;let i=this.evtCbProxyMap.get(e)?.get(t);i&&((r=this.evtCbProxyMap.get(n))==null||r.delete(t),this.map.off(n,i))};Array.isArray(kX[e])?kX[e].forEach(t=>{n(t||e)}):n(kX[e]||e)}once(){throw Error(`Method not implemented.`)}getContainer(){return this.map.getContainer()}getSize(){return[this.map.width,this.map.height]}getMinZoom(){return this.map.transform._minZoom}getMaxZoom(){return this.map.transform._maxZoom}getType(){return`tmap`}getZoom(){return this.map.getZoom()}getCenter(){let{lng:e,lat:t}=this.map.getCenter();return{lng:e,lat:t}}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getRotation()}getBounds(){let e=this.map.getBounds().getNorthEast(),t=this.map.getBounds().getSouthWest();return[[t.lng,t.lat],[e.lng,e.lat]]}getMapContainer(){return this.map.getContainer()}getMapCanvasContainer(){return this.map.getContainer()?.getElementsByTagName(`canvas`)[0]}getCanvasOverlays(){var e;return(e=this.getMapCanvasContainer())==null||(e=e.nextSibling)==null?void 0:e.firstChild}getMapStyleConfig(){throw Error(`Method not implemented.`)}setBgColor(e){this.bgColor=e}setMapStyle(e){this.map.setMapStyleId(e)}setRotation(e){this.map.setRotation(e)}zoomIn(){this.map.setZoom(this.getZoom()+1)}zoomOut(){this.map.setZoom(this.getZoom()-1)}panTo([e,t]){this.map.panTo(new TMap.LatLng(t,e))}panBy(e,t){this.map.panBy([e,t])}fitBounds(e,t){let[n,r]=e,i=new TMap.LatLng(n[1],n[0]),a=new TMap.LatLng(r[1],r[0]),o=new TMap.LatLngBounds(i,a);this.map.fitBounds(o,t)}setZoomAndCenter(e,[t,n]){this.map.setCenter(new TMap.LatLng(n,t)),this.map.setZoom(e)}setCenter([e,t]){this.map.setCenter(new TMap.LatLng(t,e))}setPitch(e){this.map.setPitch(e)}setZoom(e){this.map.setZoom(e)}setMapStatus(e){Object.keys(e).map(t=>{switch(t){case`doubleClickZoom`:this.map.setDoubleClickZoom(!!e.doubleClickZoom);break;case`dragEnable`:this.map.setDraggable(!!e.dragEnable);break;case`rotateEnable`:this.map.setRotatable(!!e.rotateEnable);break;case`zoomEnable`:this.map.setDoubleClickZoom(!!e.zoomEnable),this.map.setScrollable(!!e.zoomEnable);break;case`keyboardEnable`:case`resizeEnable`:case`showIndoorMap`:throw Error(`Options may bot be supported`);default:}})}meterToCoord([e,t],[n,r]){let i=TMap.geometry.computeDistance([new TMap.LatLng(t,e),new TMap.LatLng(r,n)]),[a,o]=this.lngLatToCoord([e,t]),[s,c]=this.lngLatToCoord([n,r]);return Math.sqrt((a-s)**2+(o-c)**2)/i}pixelToLngLat([e,t]){let{lng:n,lat:r}=this.map.getCenter(),{x:i,y:a}=this.lngLatToPixel([n,r]),{x:o,y:s}=this.lngLatToContainer([n,r]),{lng:c,lat:l}=this.map.unprojectFromContainer(new TMap.Point(o+(e-i),s+(t-a)));return this.containerToLngLat([c,l])}lngLatToPixel([e,t]){let{x:n,y:r}=this.map.projectToWorldPlane(new TMap.LatLng(t,e));return{x:n,y:r}}containerToLngLat([e,t]){let{lng:n,lat:r}=this.map.unprojectFromContainer(new TMap.Point(e,t));return{lng:n,lat:r}}lngLatToContainer([e,t]){let{x:n,y:r}=this.map.projectToContainer(new TMap.LatLng(t,e));return{x:n,y:r}}lngLatToCoord([e,t]){let{x:n,y:r}=this.lngLatToPixel([e,t]);return[n,-r]}lngLatToCoords(e){return e.map(e=>Array.isArray(e[0])?this.lngLatToCoords(e):this.lngLatToCoord(e))}lngLatToMercator(e,t){let{x:n=0,y:r=0,z:i=0}=MU.fromLngLat(e,t);return{x:n,y:r,z:i}}getModelMatrix(e,t,n,r=[1,1,1]){let i=this.viewport.projectFlat(e),a=Ky();return Qy(a,a,lb(i[0],i[1],t)),$y(a,a,lb(r[0],r[1],r[2])),eb(a,a,n[0]),tb(a,a,n[1]),nb(a,a,n[2]),a}getCustomCoordCenter(){throw Error(`Method not implemented.`)}exportMap(e){let t=this.getMapCanvasContainer();return e===`jpg`?t?.toDataURL(`image/jpeg`):t?.toDataURL(`image/png`)}rotateY(){throw Error(`Method not implemented.`)}hideLogo(){let e=this.map.getContainer();e&&uu(e,`tmap-contianer--hide-logo`)}}})),MX,NX=o((()=>{BH(),jX(),MX=class extends zH{getServiceConstructor(){return AX}}})),PX=o((()=>{Tq(),BH()})),FX,IX,LX,RX=o((()=>{vq(),Uq(),Qq(),hJ(),bJ(),jJ(),sX(),hX(),NX(),eq(),PX(),FX=_q,IX=_q,LX=_q}));function zX(e){return e==null}var BX=o((()=>{})),VX,HX=o((()=>{VX=function(e,t,n){return e<t?t:e>n?n:e}}));function UX(e){return typeof e==`number`}var WX=o((()=>{})),GX=o((()=>{HX(),BX(),WX()})),KX=o((()=>{})),qX=o((()=>{}));function JX(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Class extends value `+String(t)+` is not a constructor or null`);tZ(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function YX(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function XX(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})}function ZX(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,o=Object.create((typeof Iterator==`function`?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),typeof Symbol==`function`&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return c([e,t])}}function c(s){if(r)throw TypeError(`Generator is already executing.`);for(;o&&(o=0,s[0]&&(n=0)),n;)try{if(r=1,i&&(a=s[0]&2?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[s[0]&2,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if((a=n.trys,!(a=a.length>0&&a[a.length-1]))&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){n.label=s[1];break}if(s[0]===6&&n.label<a[1]){n.label=a[1],a=s;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(s);break}a[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],i=0}finally{r=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}function QX(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)}function $X(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function eZ(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}var tZ,nZ,rZ=o((()=>{tZ=function(e,t){return tZ=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},tZ(e,t)},nZ=function(){return nZ=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},nZ.apply(this,arguments)}})),iZ=o((()=>{})),aZ=o((()=>{iZ()})),oZ=o((()=>{})),sZ=o((()=>{})),cZ=o((()=>{KX(),qX(),aZ(),GX(),oZ(),sZ()})),lZ=s(((e,t)=>{var n=Object.prototype.hasOwnProperty,r=`~`;function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1));function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,n,i,o){if(typeof n!=`function`)throw TypeError(`The listener must be a function`);var s=new a(n,i||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function s(e,t){--e._eventsCount===0?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var e=[],t,i;if(this._eventsCount===0)return e;for(i in t=this._events)n.call(t,i)&&e.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e},c.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,o=Array(a);i<a;i++)o[i]=n[i].fn;return o},c.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,i,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var c=this._events[s],l=arguments.length,u,d;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,a),!0;case 6:return c.fn.call(c.context,t,n,i,a,o),!0}for(d=1,u=Array(l-1);d<l;d++)u[d-1]=arguments[d];c.fn.apply(c.context,u)}else{var f=c.length,p;for(d=0;d<f;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),l){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,n);break;case 4:c[d].fn.call(c[d].context,t,n,i);break;default:if(!u)for(p=1,u=Array(l-1);p<l;p++)u[p-1]=arguments[p];c[d].fn.apply(c[d].context,u)}}return!0},c.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn===t&&(!i||o.once)&&(!n||o.context===n)&&s(this,a);else{for(var c=0,l=[],u=o.length;c<u;c++)(o[c].fn!==t||i&&!o[c].once||n&&o[c].context!==n)&&l.push(o[c]);l.length?this._events[a]=l.length===1?l[0]:l:s(this,a)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,t!==void 0&&(t.exports=c)})),uZ,dZ,fZ=o((()=>{uZ=u(lZ(),1),dZ=uZ.default}));function pZ(e){return e}function mZ(e,t,n){return e<<16|t<<8|n}function hZ(e){return e>>>8&255}function gZ(e){return e>>>16&255}function _Z(e){return e&255}function vZ(e){switch(e){case d1.F32:case d1.U32:case d1.S32:return 4;case d1.U16:case d1.S16:case d1.F16:return 2;case d1.U8:case d1.S8:return 1;default:throw Error(`whoops`)}}function yZ(e){return vZ(gZ(e))}function bZ(e){return vZ(gZ(e))*pZ(hZ(e))}function xZ(e){var t=_Z(e);if(t&p1.Depth)return s1.Depth;if(t&p1.Normalized)return s1.Float;var n=gZ(e);if(n===d1.F16||n===d1.F32)return s1.Float;if(n===d1.U8||n===d1.U16||n===d1.U32)return s1.Uint;if(n===d1.S8||n===d1.S16||n===d1.S32)return s1.Sint;throw Error(`whoops`)}function SZ(e,t){if(t===void 0&&(t=``),!e)throw Error(`Assert fail: ${t}`)}function CZ(e){if(e!=null)return e;throw Error(`Missing object`)}function wZ(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function TZ(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function EZ(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}function DZ(e,t,n,r){return r===void 0&&(r=1),{r:e,g:t,b:n,a:r}}function OZ(e){return!!(e&&!(e&e-1))}function kZ(e,t){return e??t}function AZ(e){return e===void 0?null:e}function jZ(e,t){var n=t-1;return e+n&~n}function MZ(e,t){for(var n=Array(e),r=0;r<e;r++)n[r]=t();return n}function NZ(e,t){return t===void 0&&(t=1),e.split(`
`).map(function(e,n){return`${PZ(``+(t+n),4,` `)}  ${e}`}).join(`
`)}function PZ(e,t,n){for(n===void 0&&(n=`0`);e.length<t;)e=`${n}${e}`;return e}function FZ(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function IZ(e,t){return e===void 0&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function LZ(e,t){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),FZ(e.rgbBlendState,t.rgbBlendState),FZ(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function RZ(e,t){e.length!==t.length&&(e.length=t.length);for(var n=0;n<t.length;n++)e[n]=LZ(e[n],t[n])}function zZ(e,t){t.attachmentsState!==void 0&&RZ(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&TZ(e.blendConstant,t.blendConstant),e.depthCompare=kZ(t.depthCompare,e.depthCompare),e.depthWrite=kZ(t.depthWrite,e.depthWrite),e.stencilWrite=kZ(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&IZ(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&IZ(e.stencilBack,t.stencilBack),e.cullMode=kZ(t.cullMode,e.cullMode),e.frontFace=kZ(t.frontFace,e.frontFace),e.polygonOffset=kZ(t.polygonOffset,e.polygonOffset),e.polygonOffsetFactor=kZ(t.polygonOffsetFactor,e.polygonOffsetFactor),e.polygonOffsetUnits=kZ(t.polygonOffsetUnits,e.polygonOffsetUnits)}function BZ(e){var t=Object.assign({},e);return t.attachmentsState=[],RZ(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&EZ(t.blendConstant),t.stencilFront=IZ(void 0,e.stencilFront),t.stencilBack=IZ(void 0,e.stencilBack),t}function VZ(e,t){e===void 0&&(e=null),t===void 0&&(t=_1);var n=BZ(t);return e!==null&&zZ(n,e),n}function HZ(e,t,n){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function UZ(e,t){for(var n=Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r]);return n}function WZ(e,t){return e.texture===t.texture&&e.binding===t.binding}function GZ(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function KZ(e,t){return e===null?t===null:t===null?!1:e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison}function qZ(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],!(e.samplerBindings.length!==t.samplerBindings.length||!HZ(e.samplerBindings,t.samplerBindings,KZ)||!HZ(e.uniformBufferBindings,t.uniformBufferBindings,GZ)||!HZ(e.storageBufferBindings,t.storageBufferBindings,GZ)||!HZ(e.storageTextureBindings,t.storageTextureBindings,WZ))}function JZ(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function YZ(e,t){return!(!JZ(e.rgbBlendState,t.rgbBlendState)||!JZ(e.alphaBlendState,t.alphaBlendState)||e.channelWriteMask!==t.channelWriteMask)}function XZ(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function ZZ(e,t){return!HZ(e.attachmentsState,t.attachmentsState,YZ)||e.blendConstant&&t.blendConstant&&!wZ(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!XZ(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!XZ(e.stencilBack,t.stencilBack)?!1:e.depthCompare===t.depthCompare&&e.depthWrite===t.depthWrite&&e.stencilWrite===t.stencilWrite&&e.cullMode===t.cullMode&&e.frontFace===t.frontFace&&e.polygonOffset===t.polygonOffset&&e.polygonOffsetFactor===t.polygonOffsetFactor&&e.polygonOffsetUnits===t.polygonOffsetUnits}function QZ(e,t){return e.id===t.id}function $Z(e,t){return e===t}function eQ(e,t){return!(e.topology!==t.topology||e.inputLayout!==t.inputLayout||e.sampleCount!==t.sampleCount||e.megaStateDescriptor&&t.megaStateDescriptor&&!ZZ(e.megaStateDescriptor,t.megaStateDescriptor)||!QZ(e.program,t.program)||!HZ(e.colorAttachmentFormats,t.colorAttachmentFormats,$Z)||e.depthStencilAttachmentFormat!==t.depthStencilAttachmentFormat)}function tQ(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function nQ(e,t){return zX(e)?zX(t):zX(t)?!1:e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&HZ(e.attributes,t.attributes,tQ)}function rQ(e,t){return!(e.indexBufferFormat!==t.indexBufferFormat||!HZ(e.vertexBufferDescriptors,t.vertexBufferDescriptors,nQ)||!QZ(e.program,t.program))}function iQ(e){return{sampler:e.sampler,texture:e.texture,dimension:e.dimension,formatKind:e.formatKind,comparison:e.comparison}}function aQ(e){var t=e.buffer,n=e.size;return{binding:e.binding,buffer:t,offset:e.offset,size:n}}function oQ(e){return{binding:e.binding,texture:e.texture}}function sQ(e){return{samplerBindings:e.samplerBindings&&UZ(e.samplerBindings,iQ),uniformBufferBindings:e.uniformBufferBindings&&UZ(e.uniformBufferBindings,aQ),storageBufferBindings:e.storageBufferBindings&&UZ(e.storageBufferBindings,aQ),storageTextureBindings:e.storageTextureBindings&&UZ(e.storageTextureBindings,oQ),pipeline:e.pipeline}}function cQ(e){var t=e.inputLayout,n=e.program,r=e.topology;return{inputLayout:t,megaStateDescriptor:e.megaStateDescriptor&&BZ(e.megaStateDescriptor),program:n,topology:r,colorAttachmentFormats:e.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:e.depthStencilAttachmentFormat,sampleCount:e.sampleCount}}function lQ(e){return{shaderLocation:e.shaderLocation,format:e.format,offset:e.offset,divisor:e.divisor}}function uQ(e){return zX(e)?e:{arrayStride:e.arrayStride,stepMode:e.stepMode,attributes:UZ(e.attributes,lQ)}}function dQ(e){return{vertexBufferDescriptors:UZ(e.vertexBufferDescriptors,uQ),indexBufferFormat:e.indexBufferFormat,program:e.program}}function fQ(e){if(e[e.length-1]!==`]`)return{name:e,length:1,isArray:!1};var t=e.match(b1);if(!t||t.length<2)throw Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:Number(t[2])||1,isArray:!!t[2]}}function pQ(){var e=null;return function(t,n,r){var i=e!==r;return i&&(t.uniform1i(n,r),e=r),i}}function mQ(e,t,n,r){var i=null,a=null;return function(o,s,c){var l=t(c,n),u=l.length,d=!1;if(i===null)i=new Float32Array(u),a=u,d=!0;else{SZ(a===u,`Uniform length cannot change.`);for(var f=0;f<u;++f)if(l[f]!==i[f]){d=!0;break}}return d&&(r(o,e,s,l),i.set(l)),d}}function hQ(e,t,n,r){e[t](n,r)}function gQ(e,t,n,r){e[t](n,!1,r)}function _Q(e,t,n,r){t===1&&typeof e==`boolean`&&(e=e?1:0),Number.isFinite(e)&&(w1[0]=e,e=w1);var i=e.length;if(e instanceof n)return e;var a=r[i];a||(a=new n(i),r[i]=a);for(var o=0;o<i;o++)a[o]=e[o];return a}function vQ(e,t){return _Q(e,t,Float32Array,x1)}function yQ(e,t){return _Q(e,t,Int32Array,S1)}function bQ(e,t){return _Q(e,t,Uint32Array,C1)}function xQ(e,t,n){var r=T1[n.type];if(!r)throw Error(`Unknown GLSL uniform type ${n.type}`);return r().bind(null,e,t)}function SQ(e){return Object.prototype.toString.call(e)in E1}function CQ(e,t){return`#define ${e} ${t}`}function wQ(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(e,n,r){var i=Number(r);return t[n]=isNaN(i)?r:i,``}),t}function TQ(e,t){var n=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(e,r,i){var a=Number(r);return n.push({location:isNaN(a)?t[r]:a,name:i}),``}),n}function EQ(e){if(e===void 0)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(t!==null){var n=parseInt(t[1],10);if(!Number.isNaN(n))return n}return null}function DQ(e){return[e,``]}function OQ(e,t,n,r,i){r===void 0&&(r=null),i===void 0&&(i=!0);var a=e.glslVersion===`#version 100`,o=t===`frag`&&n.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm)?.length>1,s=n.replace(`\r
`,`
`).split(`
`).map(function(e){return e.replace(/[/][/].*$/,``)}).filter(function(e){return!(!e||/^\s+$/.test(e))}),c=``;r!==null&&(c=Object.keys(r).map(function(e){return CQ(e,r[e])}).join(`
`));var l=s.find(function(e){return e.startsWith(`precision`)})||`precision mediump float;`,u=i?s.filter(function(e){return!e.startsWith(`precision`)}).join(`
`):s.join(`
`),d=``;if(e.viewportOrigin===c1.UPPER_LEFT&&(d+=`${CQ(`VIEWPORT_ORIGIN_TL`,`1`)}
`),e.clipSpaceNearZ===l1.ZERO&&(d+=`${CQ(`CLIPSPACE_NEAR_ZERO`,`1`)}
`),e.explicitBindingLocations){var f=0,p=0,m=0;u=u.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(e,t,n,r){return`layout(${n?`${n}, `:``}set = ${f}, binding = ${p++}) uniform ${r}`}),f++,p=0,SZ(e.separateSamplerTextures),u=u.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(e,n,r,i,a){var o=EQ(r);o===null&&(o=p++);var s=$X(DQ(i),2),c=s[0],l=s[1];return t===`frag`?`
layout(set = ${f}, binding = ${o*2+0}) uniform texture${c} T_${a};
layout(set = ${f}, binding = ${o*2+1}) uniform sampler${l} S_${a};`.trim():``}),u=u.replace(t===`frag`?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(e,t){return`layout(location = ${m++}) ${t}`}),d+=`${CQ(`gl_VertexID`,`gl_VertexIndex`)}
`,d+=`${CQ(`gl_InstanceID`,`gl_InstanceIndex`)}
`,l=l.replace(/^precision (.*) sampler(.*);$/gm,``)}else{var h=0;u=u.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(e,t,n,r,i){var a=EQ(n);return a===null&&(a=h++),`uniform sampler${r} ${i}; // BINDING=${a}`})}if(u=u.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,function(e,t,n){return`SAMPLER_${t}(P_${n})`}),u=u.replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,function(e,t,n){return`PP_SAMPLER_${t}(P_${n})`}),u=u.replace(/\bPU_TEXTURE\((.*?)\)/g,function(e,t){return`TEXTURE(P_${t})`}),e.separateSamplerTextures)u=u.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(e,t,n){var r=$X(DQ(t),2);return`texture${r[0]} T_P_${n}, sampler${r[1]} S_P_${n}`}),u=u.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(e,t,n){return`T_${n}, S_${n}`}),u=u.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(e,t,n){return`sampler${t}(T_${n}, S_${n})`}),u=u.replace(/\bTEXTURE\((.*?)\)/g,function(e,t){return`T_${t}`});else{var g=[];u=u.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(e,t,n){return`sampler${t} P_${n}`}),u=u.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(e,t,n){return n}),u=u.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(e,t,n){return g.push([n,t]),n}),a&&g.forEach(function(e){var t=$X(e,2),n=t[0],r=t[1];u=u.replace(RegExp(`texture\\(${n}`,`g`),function(){return`texture${r}(${n}`})}),u=u.replace(/\bTEXTURE\((.*?)\)/g,function(e,t){return t})}var _=`${a?``:e.glslVersion}
${a&&o?`#extension GL_EXT_draw_buffers : require
`:``}
${a&&t===`frag`?`#extension GL_OES_standard_derivatives : enable
`:``}${i?l:``}
${d||``}${c?c+`
`:``}
${u}
`.trim();if(e.explicitBindingLocations&&t===`frag`&&(_=_.replace(/^\b(out)\b/g,function(e,t){return`layout(location = 0) ${t}`})),a){if(t===`frag`&&(_=_.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(e,t,n){return`varying ${t} ${n};
`})),t===`vert`&&(_=_.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(e,t,n){return`varying ${t} ${n};
`}),_=_.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(e,t,n){return`attribute ${t} ${n};
`})),_=_.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(e,t){return t.trim().replace(/^.*$/gm,function(e){var t=e.trim();return t.startsWith(`#`)?t:e?`uniform ${t}`:``})}),t===`frag`)if(o){var v=[];_=_.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(e,t){return v.push(t),`vec4 ${t};
`});var y=_.lastIndexOf(`}`);_=_.substring(0,y)+`
    ${v.map(function(e,t){return`gl_FragData[${t}] = ${e};
    `}).join(`
`)}`+_.substring(y)}else{var b;if(_=_.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(e,t,n){return b=n,`${t} ${n};
`}),b){var y=_.lastIndexOf(`}`);_=_.substring(0,y)+`
  gl_FragColor = vec4(${b});
`+_.substring(y)}}_=_.replace(/^\s*layout\((.*)\)/gm,``)}return _}function kQ(e){return k1===void 0?typeof WebGL2RenderingContext<`u`&&e instanceof WebGL2RenderingContext?(k1=!0,!0):(k1=!!(e&&e._version===2),k1):k1}function AQ(e){switch(gZ(e)){case d1.BC1:case d1.BC2:case d1.BC3:case d1.BC4_UNORM:case d1.BC4_SNORM:case d1.BC5_UNORM:case d1.BC5_SNORM:return!0;default:return!1}}function jQ(e){if(_Z(e)&p1.Normalized)return!1;var t=gZ(e);return t===d1.S8||t===d1.S16||t===d1.S32||t===d1.U8||t===d1.U16||t===d1.U32}function MQ(e){switch(e){case e1.STATIC:return Q.STATIC_DRAW;case e1.DYNAMIC:return Q.DYNAMIC_DRAW}}function NQ(e){if(e&$$.INDEX)return Q.ELEMENT_ARRAY_BUFFER;if(e&$$.VERTEX)return Q.ARRAY_BUFFER;if(e&$$.UNIFORM)return Q.UNIFORM_BUFFER}function PQ(e){switch(e){case Q$.TRIANGLES:return Q.TRIANGLES;case Q$.POINTS:return Q.POINTS;case Q$.TRIANGLE_STRIP:return Q.TRIANGLE_STRIP;case Q$.LINES:return Q.LINES;case Q$.LINE_STRIP:return Q.LINE_STRIP;default:throw Error(`Unknown primitive topology mode`)}}function FQ(e){switch(e){case d1.U8:return Q.UNSIGNED_BYTE;case d1.U16:return Q.UNSIGNED_SHORT;case d1.U32:return Q.UNSIGNED_INT;case d1.S8:return Q.BYTE;case d1.S16:return Q.SHORT;case d1.S32:return Q.INT;case d1.F16:return Q.HALF_FLOAT;case d1.F32:return Q.FLOAT;default:throw Error(`whoops`)}}function IQ(e){switch(e){case f1.R:return 1;case f1.RG:return 2;case f1.RGB:return 3;case f1.RGBA:return 4;default:return 1}}function LQ(e){var t=gZ(e),n=hZ(e),r=_Z(e),i=FQ(t);return{size:IQ(n),type:i,normalized:!!(r&p1.Normalized)}}function RQ(e){switch(e){case $.U8_R:return Q.UNSIGNED_BYTE;case $.U16_R:return Q.UNSIGNED_SHORT;case $.U32_R:return Q.UNSIGNED_INT;default:throw Error(`whoops`)}}function zQ(e){switch(e){case Y$.CLAMP_TO_EDGE:return Q.CLAMP_TO_EDGE;case Y$.REPEAT:return Q.REPEAT;case Y$.MIRRORED_REPEAT:return Q.MIRRORED_REPEAT;default:throw Error(`whoops`)}}function BQ(e,t){if(t===Z$.LINEAR&&e===X$.BILINEAR)return Q.LINEAR_MIPMAP_LINEAR;if(t===Z$.LINEAR&&e===X$.POINT)return Q.NEAREST_MIPMAP_LINEAR;if(t===Z$.NEAREST&&e===X$.BILINEAR)return Q.LINEAR_MIPMAP_NEAREST;if(t===Z$.NEAREST&&e===X$.POINT)return Q.NEAREST_MIPMAP_NEAREST;if(t===Z$.NO_MIP&&e===X$.BILINEAR)return Q.LINEAR;if(t===Z$.NO_MIP&&e===X$.POINT)return Q.NEAREST;throw Error(`Unknown texture filter mode`)}function VQ(e,t){t===void 0&&(t=0);var n=e;return n.gl_buffer_pages[t/n.pageByteSize|0]}function HQ(e){return e.gl_texture}function UQ(e){return e.gl_sampler}function WQ(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function GQ(e,t){for(var n=[];;){var r=t.exec(e);if(!r)break;n.push(r)}return n}function KQ(e){return e.blendMode==J$.ADD&&e.blendSrcFactor==q$.ONE&&e.blendDstFactor===q$.ZERO}function qQ(e){switch(e){case u1.OcclusionConservative:return Q.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw Error(`whoops`)}}function JQ(e){if(e===r1.TEXTURE_2D)return Q.TEXTURE_2D;if(e===r1.TEXTURE_2D_ARRAY)return Q.TEXTURE_2D_ARRAY;if(e===r1.TEXTURE_CUBE_MAP)return Q.TEXTURE_CUBE_MAP;if(e===r1.TEXTURE_3D)return Q.TEXTURE_3D;throw Error(`whoops`)}function YQ(e,t,n,r){return!(e%n!==0||t%r!==0)}function XQ(){return(X1===null||X1.byteLength===0)&&(X1=new Uint8Array(J1.memory.buffer)),X1}function ZQ(e,t){return e>>>=0,Y1.decode(XQ().subarray(e,e+t))}function QQ(e){Q1===Z1.length&&Z1.push(Z1.length+1);let t=Q1;return Q1=Z1[t],Z1[t]=e,t}function $Q(e){return Z1[e]}function e$(e){e<132||(Z1[e]=Q1,Q1=e)}function t$(e){let t=$Q(e);return e$(e),t}function n$(e,t,n){if(n===void 0){let n=e0.encode(e),r=t(n.length,1)>>>0;return XQ().subarray(r,r+n.length).set(n),$1=n.length,r}let r=e.length,i=t(r,1)>>>0,a=XQ(),o=0;for(;o<r;o++){let t=e.charCodeAt(o);if(t>127)break;a[i+o]=t}if(o!==r){o!==0&&(e=e.slice(o)),i=n(i,r,r=o+e.length*3,1)>>>0;let t=XQ().subarray(i+o,i+r),a=t0(e,t);o+=a.written}return $1=o,i}function r$(){return(n0===null||n0.byteLength===0)&&(n0=new Int32Array(J1.memory.buffer)),n0}function i$(e,t,n){let r,i;try{let s=J1.__wbindgen_add_to_stack_pointer(-16),c=n$(e,J1.__wbindgen_malloc,J1.__wbindgen_realloc),l=$1,u=n$(t,J1.__wbindgen_malloc,J1.__wbindgen_realloc),d=$1;J1.glsl_compile(s,c,l,u,d,n);var a=r$()[s/4+0],o=r$()[s/4+1];return r=a,i=o,ZQ(a,o)}finally{J1.__wbindgen_add_to_stack_pointer(16),J1.__wbindgen_free(r,i,1)}}async function a$(e,t){if(typeof Response==`function`&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming==`function`)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if(e.headers.get(`Content-Type`)!=`application/wasm`)console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}let n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{let n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function o$(){let e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(e,t){return QQ(ZQ(e,t))},e.wbg.__wbindgen_object_drop_ref=function(e){t$(e)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log($Q(e))},e.wbg.__wbg_log_576ca876af0d4a77=function(e,t){console.log($Q(e),$Q(t))},e.wbg.__wbindgen_throw=function(e,t){throw Error(ZQ(e,t))},e}function s$(e,t){return J1=e.exports,c$.__wbindgen_wasm_module=t,n0=null,X1=null,J1}async function c$(e){if(J1!==void 0)return J1;let t=o$();(typeof e==`string`||typeof Request==`function`&&e instanceof Request||typeof URL==`function`&&e instanceof URL)&&(e=fetch(e));let{instance:n,module:r}=await a$(await e,t);return s$(n,r)}function l$(e){var t=0;return e&i1.SAMPLED&&(t|=i0.TEXTURE_BINDING|i0.COPY_DST|i0.COPY_SRC),e&i1.STORAGE&&(t|=i0.TEXTURE_BINDING|i0.STORAGE_BINDING|i0.COPY_SRC|i0.COPY_DST),e&i1.RENDER_TARGET&&(t|=i0.RENDER_ATTACHMENT|i0.TEXTURE_BINDING|i0.COPY_SRC|i0.COPY_DST),t}function u$(e){if(e===$.U8_R_NORM)return`r8unorm`;if(e===$.S8_R_NORM)return`r8snorm`;if(e===$.U8_RG_NORM)return`rg8unorm`;if(e===$.S8_RG_NORM)return`rg8snorm`;if(e===$.U32_R)return`r32uint`;if(e===$.S32_R)return`r32sint`;if(e===$.F32_R)return`r32float`;if(e===$.U16_RG)return`rg16uint`;if(e===$.S16_RG)return`rg16sint`;if(e===$.F16_RG)return`rg16float`;if(e===$.U8_RGBA_RT)return`bgra8unorm`;if(e===$.U8_RGBA_RT_SRGB)return`bgra8unorm-srgb`;if(e===$.U8_RGBA_NORM)return`rgba8unorm`;if(e===$.U8_RGBA_SRGB)return`rgba8unorm-srgb`;if(e===$.S8_RGBA_NORM)return`rgba8snorm`;if(e===$.U32_RG)return`rg32uint`;if(e===$.S32_RG)return`rg32sint`;if(e===$.F32_RG)return`rg32float`;if(e===$.U16_RGBA)return`rgba16uint`;if(e===$.S16_RGBA)return`rgba16sint`;if(e===$.F16_RGBA)return`rgba16float`;if(e===$.F32_RGBA)return`rgba32float`;if(e===$.U32_RGBA)return`rgba32uint`;if(e===$.S32_RGBA)return`rgba32sint`;if(e===$.D24)return`depth24plus`;if(e===$.D24_S8)return`depth24plus-stencil8`;if(e===$.D32F)return`depth32float`;if(e===$.D32F_S8)return`depth32float-stencil8`;if(e===$.BC1)return`bc1-rgba-unorm`;if(e===$.BC1_SRGB)return`bc1-rgba-unorm-srgb`;if(e===$.BC2)return`bc2-rgba-unorm`;if(e===$.BC2_SRGB)return`bc2-rgba-unorm-srgb`;if(e===$.BC3)return`bc3-rgba-unorm`;if(e===$.BC3_SRGB)return`bc3-rgba-unorm-srgb`;if(e===$.BC4_SNORM)return`bc4-r-snorm`;if(e===$.BC4_UNORM)return`bc4-r-unorm`;if(e===$.BC5_SNORM)return`bc5-rg-snorm`;if(e===$.BC5_UNORM)return`bc5-rg-unorm`;throw`whoops`}function d$(e){if(e===r1.TEXTURE_2D||e===r1.TEXTURE_CUBE_MAP||e===r1.TEXTURE_2D_ARRAY)return`2d`;if(e===r1.TEXTURE_3D)return`3d`;throw Error(`whoops`)}function f$(e){if(e===r1.TEXTURE_2D)return`2d`;if(e===r1.TEXTURE_CUBE_MAP)return`cube`;if(e===r1.TEXTURE_2D_ARRAY)return`2d-array`;if(e===r1.TEXTURE_3D)return`3d`;throw Error(`whoops`)}function p$(e){var t=0;return e&$$.INDEX&&(t|=GPUBufferUsage.INDEX),e&$$.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&$$.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&$$.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&$$.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&$$.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|=GPUBufferUsage.COPY_DST,t}function m$(e){if(e===Y$.CLAMP_TO_EDGE)return`clamp-to-edge`;if(e===Y$.REPEAT)return`repeat`;if(e===Y$.MIRRORED_REPEAT)return`mirror-repeat`;throw Error(`whoops`)}function h$(e){if(e===X$.BILINEAR)return`linear`;if(e===X$.POINT)return`nearest`;throw Error(`whoops`)}function g$(e){if(e===Z$.LINEAR)return`linear`;if(e===Z$.NEAREST||e===Z$.NO_MIP)return`nearest`;throw Error(`whoops`)}function _$(e){return e.gpuBuffer}function v$(e){return e.gpuSampler}function y$(e){return e.querySet}function b$(e){if(e===u1.OcclusionConservative)return`occlusion`;throw Error(`whoops`)}function x$(e){switch(e){case Q$.TRIANGLES:return`triangle-list`;case Q$.POINTS:return`point-list`;case Q$.TRIANGLE_STRIP:return`triangle-strip`;case Q$.LINES:return`line-list`;case Q$.LINE_STRIP:return`line-strip`;default:throw Error(`Unknown primitive topology mode`)}}function S$(e){if(e===K$.NONE)return`none`;if(e===K$.FRONT)return`front`;if(e===K$.BACK)return`back`;throw Error(`whoops`)}function C$(e){if(e===G$.CCW)return`ccw`;if(e===G$.CW)return`cw`;throw Error(`whoops`)}function w$(e,t){return{topology:x$(e),cullMode:S$(t.cullMode),frontFace:C$(t.frontFace)}}function T$(e){if(e===q$.ZERO)return`zero`;if(e===q$.ONE)return`one`;if(e===q$.SRC)return`src`;if(e===q$.ONE_MINUS_SRC)return`one-minus-src`;if(e===q$.DST)return`dst`;if(e===q$.ONE_MINUS_DST)return`one-minus-dst`;if(e===q$.SRC_ALPHA)return`src-alpha`;if(e===q$.ONE_MINUS_SRC_ALPHA)return`one-minus-src-alpha`;if(e===q$.DST_ALPHA)return`dst-alpha`;if(e===q$.ONE_MINUS_DST_ALPHA)return`one-minus-dst-alpha`;if(e===q$.CONST)return`constant`;if(e===q$.ONE_MINUS_CONSTANT)return`one-minus-constant`;if(e===q$.SRC_ALPHA_SATURATE)return`src-alpha-saturated`;throw Error(`whoops`)}function E$(e){if(e===J$.ADD)return`add`;if(e===J$.SUBSTRACT)return`subtract`;if(e===J$.REVERSE_SUBSTRACT)return`reverse-subtract`;if(e===J$.MIN)return`min`;if(e===J$.MAX)return`max`;throw Error(`whoops`)}function D$(e){return{operation:E$(e.blendMode),srcFactor:T$(e.blendSrcFactor),dstFactor:T$(e.blendDstFactor)}}function O$(e){return e.blendMode===J$.ADD&&e.blendSrcFactor===q$.ONE&&e.blendDstFactor===q$.ZERO}function k$(e){if(!(O$(e.rgbBlendState)&&O$(e.alphaBlendState)))return{color:D$(e.rgbBlendState),alpha:D$(e.alphaBlendState)}}function A$(e,t){return{format:u$(t),blend:k$(e),writeMask:e.channelWriteMask}}function j$(e,t){return t.attachmentsState.map(function(t,n){return A$(t,e[n])})}function M$(e){if(e===W$.NEVER)return`never`;if(e===W$.LESS)return`less`;if(e===W$.EQUAL)return`equal`;if(e===W$.LEQUAL)return`less-equal`;if(e===W$.GREATER)return`greater`;if(e===W$.NOTEQUAL)return`not-equal`;if(e===W$.GEQUAL)return`greater-equal`;if(e===W$.ALWAYS)return`always`;throw Error(`whoops`)}function N$(e){if(e===o1.KEEP)return`keep`;if(e===o1.REPLACE)return`replace`;if(e===o1.ZERO)return`zero`;if(e===o1.DECREMENT_CLAMP)return`decrement-clamp`;if(e===o1.DECREMENT_WRAP)return`decrement-wrap`;if(e===o1.INCREMENT_CLAMP)return`increment-clamp`;if(e===o1.INCREMENT_WRAP)return`increment-wrap`;if(e===o1.INVERT)return`invert`;throw Error(`whoops`)}function P$(e,t){if(!zX(e))return{format:u$(e),depthWriteEnabled:!!t.depthWrite,depthCompare:M$(t.depthCompare),depthBias:t.polygonOffset?t.polygonOffsetUnits:0,depthBiasSlopeScale:t.polygonOffset?t.polygonOffsetFactor:0,stencilFront:{compare:M$(t.stencilFront.compare),passOp:N$(t.stencilFront.passOp),failOp:N$(t.stencilFront.failOp),depthFailOp:N$(t.stencilFront.depthFailOp)},stencilBack:{compare:M$(t.stencilBack.compare),passOp:N$(t.stencilBack.passOp),failOp:N$(t.stencilBack.failOp),depthFailOp:N$(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}function F$(e){if(e!==null){if(e===$.U16_R)return`uint16`;if(e===$.U32_R)return`uint32`;throw Error(`whoops`)}}function I$(e){if(e===t1.VERTEX)return`vertex`;if(e===t1.INSTANCE)return`instance`;throw Error(`whoops`)}function L$(e){if(e===$.U8_R||e===$.U8_RG)return`uint8x2`;if(e===$.U8_RGB||e===$.U8_RGBA)return`uint8x4`;if(e===$.U8_RG_NORM)return`unorm8x2`;if(e===$.U8_RGBA_NORM)return`unorm8x4`;if(e===$.S8_RGB_NORM||e===$.S8_RGBA_NORM)return`snorm8x4`;if(e===$.U16_RG_NORM)return`unorm16x2`;if(e===$.U16_RGBA_NORM)return`unorm16x4`;if(e===$.S16_RG_NORM)return`snorm16x2`;if(e===$.S16_RGBA_NORM)return`snorm16x4`;if(e===$.S16_RG)return`uint16x2`;if(e===$.F16_RG)return`float16x2`;if(e===$.F16_RGBA)return`float16x4`;if(e===$.F32_R)return`float32`;if(e===$.F32_RG)return`float32x2`;if(e===$.F32_RGB)return`float32x3`;if(e===$.F32_RGBA)return`float32x4`;throw`whoops`}function R$(e){switch(gZ(e)){case d1.BC1:case d1.BC2:case d1.BC3:case d1.BC4_SNORM:case d1.BC4_UNORM:case d1.BC5_SNORM:case d1.BC5_UNORM:return!0;default:return!1}}function z$(e){switch(gZ(e)){case d1.BC1:case d1.BC2:case d1.BC3:case d1.BC4_SNORM:case d1.BC4_UNORM:case d1.BC5_SNORM:case d1.BC5_UNORM:return 4;default:return 1}}function B$(e,t,n,r){switch(n===void 0&&(n=!1),e){case $.S8_R:case $.S8_R_NORM:case $.S8_RG_NORM:case $.S8_RGB_NORM:case $.S8_RGBA_NORM:var i=(t instanceof ArrayBuffer,new Int8Array(t));return r&&i.set(new Int8Array(r)),i;case $.U8_R:case $.U8_R_NORM:case $.U8_RG:case $.U8_RG_NORM:case $.U8_RGB:case $.U8_RGB_NORM:case $.U8_RGB_SRGB:case $.U8_RGBA:case $.U8_RGBA_NORM:case $.U8_RGBA_SRGB:var a=(t instanceof ArrayBuffer,new Uint8Array(t));return r&&a.set(new Uint8Array(r)),a;case $.S16_R:case $.S16_RG:case $.S16_RG_NORM:case $.S16_RGB_NORM:case $.S16_RGBA:case $.S16_RGBA_NORM:var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return r&&o.set(new Int16Array(r)),o;case $.U16_R:case $.U16_RGB:case $.U16_RGBA_5551:case $.U16_RGBA_NORM:case $.U16_RG_NORM:case $.U16_R_NORM:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return r&&s.set(new Uint16Array(r)),s;case $.S32_R:var c=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return r&&c.set(new Int32Array(r)),c;case $.U32_R:case $.U32_RG:var l=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return r&&l.set(new Uint32Array(r)),l;case $.F32_R:case $.F32_RG:case $.F32_RGB:case $.F32_RGBA:var u=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return r&&u.set(new Float32Array(r)),u}var d=(t instanceof ArrayBuffer,new Uint8Array(t));return r&&d.set(new Uint8Array(r)),d}function V$(e){var t=(e&32768)>>15,n=(e&31744)>>10,r=e&1023;return n===0?(t?-1:1)*2**-14*(r/2**10):n==31?r?NaN:(t?-1:1)*(1/0):(t?-1:1)*2**(n-15)*(1+r/2**10)}function H$(e){switch(e){case`r8unorm`:case`r8snorm`:case`r8uint`:case`r8sint`:return{width:1,height:1,length:1};case`r16uint`:case`r16sint`:case`r16float`:case`rg8unorm`:case`rg8snorm`:case`rg8uint`:case`rg8sint`:return{width:1,height:1,length:2};case`r32uint`:case`r32sint`:case`r32float`:case`rg16uint`:case`rg16sint`:case`rg16float`:case`rgba8unorm`:case`rgba8unorm-srgb`:case`rgba8snorm`:case`rgba8uint`:case`rgba8sint`:case`bgra8unorm`:case`bgra8unorm-srgb`:case`rgb9e5ufloat`:case`rgb10a2unorm`:case`rg11b10ufloat`:return{width:1,height:1,length:4};case`rg32uint`:case`rg32sint`:case`rg32float`:case`rgba16uint`:case`rgba16sint`:case`rgba16float`:return{width:1,height:1,length:8};case`rgba32uint`:case`rgba32sint`:case`rgba32float`:return{width:1,height:1,length:16};case`stencil8`:throw Error(`No fixed size for Stencil8 format!`);case`depth16unorm`:return{width:1,height:1,length:2};case`depth24plus`:throw Error(`No fixed size for Depth24Plus format!`);case`depth24plus-stencil8`:throw Error(`No fixed size for Depth24PlusStencil8 format!`);case`depth32float`:return{width:1,height:1,length:4};case`depth32float-stencil8`:return{width:1,height:1,length:5};case`bc7-rgba-unorm`:case`bc7-rgba-unorm-srgb`:case`bc6h-rgb-ufloat`:case`bc6h-rgb-float`:case`bc2-rgba-unorm`:case`bc2-rgba-unorm-srgb`:case`bc3-rgba-unorm`:case`bc3-rgba-unorm-srgb`:case`bc5-rg-unorm`:case`bc5-rg-snorm`:return{width:4,height:4,length:16};case`bc4-r-unorm`:case`bc4-r-snorm`:case`bc1-rgba-unorm`:case`bc1-rgba-unorm-srgb`:return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var Q,U$,W$,G$,K$,q$,J$,Y$,X$,Z$,Q$,$$,e1,t1,n1,r1,i1,a1,o1,s1,c1,l1,u1,d1,f1,p1,$,m1,h1,g1,_1,v1,y1,b1,x1,S1,C1,w1,T1,E1,D1,O1,k1,A1,j1,M1,N1,P1,F1,I1,L1,R1,z1,B1,V1,H1,U1,W1,G1,K1,q1,J1,Y1,X1,Z1,Q1,$1,e0,t0,n0,r0,i0,a0,o0,s0,c0,l0,u0,d0,f0,p0,m0,h0,g0,_0,v0,y0,b0,x0,S0=o((()=>{cZ(),rZ(),fZ(),(function(e){e[e.DEPTH_BUFFER_BIT=256]=`DEPTH_BUFFER_BIT`,e[e.STENCIL_BUFFER_BIT=1024]=`STENCIL_BUFFER_BIT`,e[e.COLOR_BUFFER_BIT=16384]=`COLOR_BUFFER_BIT`,e[e.POINTS=0]=`POINTS`,e[e.LINES=1]=`LINES`,e[e.LINE_LOOP=2]=`LINE_LOOP`,e[e.LINE_STRIP=3]=`LINE_STRIP`,e[e.TRIANGLES=4]=`TRIANGLES`,e[e.TRIANGLE_STRIP=5]=`TRIANGLE_STRIP`,e[e.TRIANGLE_FAN=6]=`TRIANGLE_FAN`,e[e.ZERO=0]=`ZERO`,e[e.ONE=1]=`ONE`,e[e.SRC_COLOR=768]=`SRC_COLOR`,e[e.ONE_MINUS_SRC_COLOR=769]=`ONE_MINUS_SRC_COLOR`,e[e.SRC_ALPHA=770]=`SRC_ALPHA`,e[e.ONE_MINUS_SRC_ALPHA=771]=`ONE_MINUS_SRC_ALPHA`,e[e.DST_ALPHA=772]=`DST_ALPHA`,e[e.ONE_MINUS_DST_ALPHA=773]=`ONE_MINUS_DST_ALPHA`,e[e.DST_COLOR=774]=`DST_COLOR`,e[e.ONE_MINUS_DST_COLOR=775]=`ONE_MINUS_DST_COLOR`,e[e.SRC_ALPHA_SATURATE=776]=`SRC_ALPHA_SATURATE`,e[e.CONSTANT_COLOR=32769]=`CONSTANT_COLOR`,e[e.ONE_MINUS_CONSTANT_COLOR=32770]=`ONE_MINUS_CONSTANT_COLOR`,e[e.CONSTANT_ALPHA=32771]=`CONSTANT_ALPHA`,e[e.ONE_MINUS_CONSTANT_ALPHA=32772]=`ONE_MINUS_CONSTANT_ALPHA`,e[e.FUNC_ADD=32774]=`FUNC_ADD`,e[e.FUNC_SUBTRACT=32778]=`FUNC_SUBTRACT`,e[e.FUNC_REVERSE_SUBTRACT=32779]=`FUNC_REVERSE_SUBTRACT`,e[e.BLEND_EQUATION=32777]=`BLEND_EQUATION`,e[e.BLEND_EQUATION_RGB=32777]=`BLEND_EQUATION_RGB`,e[e.BLEND_EQUATION_ALPHA=34877]=`BLEND_EQUATION_ALPHA`,e[e.BLEND_DST_RGB=32968]=`BLEND_DST_RGB`,e[e.BLEND_SRC_RGB=32969]=`BLEND_SRC_RGB`,e[e.BLEND_DST_ALPHA=32970]=`BLEND_DST_ALPHA`,e[e.BLEND_SRC_ALPHA=32971]=`BLEND_SRC_ALPHA`,e[e.BLEND_COLOR=32773]=`BLEND_COLOR`,e[e.ARRAY_BUFFER_BINDING=34964]=`ARRAY_BUFFER_BINDING`,e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]=`ELEMENT_ARRAY_BUFFER_BINDING`,e[e.LINE_WIDTH=2849]=`LINE_WIDTH`,e[e.ALIASED_POINT_SIZE_RANGE=33901]=`ALIASED_POINT_SIZE_RANGE`,e[e.ALIASED_LINE_WIDTH_RANGE=33902]=`ALIASED_LINE_WIDTH_RANGE`,e[e.CULL_FACE_MODE=2885]=`CULL_FACE_MODE`,e[e.FRONT_FACE=2886]=`FRONT_FACE`,e[e.DEPTH_RANGE=2928]=`DEPTH_RANGE`,e[e.DEPTH_WRITEMASK=2930]=`DEPTH_WRITEMASK`,e[e.DEPTH_CLEAR_VALUE=2931]=`DEPTH_CLEAR_VALUE`,e[e.DEPTH_FUNC=2932]=`DEPTH_FUNC`,e[e.STENCIL_CLEAR_VALUE=2961]=`STENCIL_CLEAR_VALUE`,e[e.STENCIL_FUNC=2962]=`STENCIL_FUNC`,e[e.STENCIL_FAIL=2964]=`STENCIL_FAIL`,e[e.STENCIL_PASS_DEPTH_FAIL=2965]=`STENCIL_PASS_DEPTH_FAIL`,e[e.STENCIL_PASS_DEPTH_PASS=2966]=`STENCIL_PASS_DEPTH_PASS`,e[e.STENCIL_REF=2967]=`STENCIL_REF`,e[e.STENCIL_VALUE_MASK=2963]=`STENCIL_VALUE_MASK`,e[e.STENCIL_WRITEMASK=2968]=`STENCIL_WRITEMASK`,e[e.STENCIL_BACK_FUNC=34816]=`STENCIL_BACK_FUNC`,e[e.STENCIL_BACK_FAIL=34817]=`STENCIL_BACK_FAIL`,e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]=`STENCIL_BACK_PASS_DEPTH_FAIL`,e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]=`STENCIL_BACK_PASS_DEPTH_PASS`,e[e.STENCIL_BACK_REF=36003]=`STENCIL_BACK_REF`,e[e.STENCIL_BACK_VALUE_MASK=36004]=`STENCIL_BACK_VALUE_MASK`,e[e.STENCIL_BACK_WRITEMASK=36005]=`STENCIL_BACK_WRITEMASK`,e[e.VIEWPORT=2978]=`VIEWPORT`,e[e.SCISSOR_BOX=3088]=`SCISSOR_BOX`,e[e.COLOR_CLEAR_VALUE=3106]=`COLOR_CLEAR_VALUE`,e[e.COLOR_WRITEMASK=3107]=`COLOR_WRITEMASK`,e[e.UNPACK_ALIGNMENT=3317]=`UNPACK_ALIGNMENT`,e[e.PACK_ALIGNMENT=3333]=`PACK_ALIGNMENT`,e[e.MAX_TEXTURE_SIZE=3379]=`MAX_TEXTURE_SIZE`,e[e.MAX_VIEWPORT_DIMS=3386]=`MAX_VIEWPORT_DIMS`,e[e.SUBPIXEL_BITS=3408]=`SUBPIXEL_BITS`,e[e.RED_BITS=3410]=`RED_BITS`,e[e.GREEN_BITS=3411]=`GREEN_BITS`,e[e.BLUE_BITS=3412]=`BLUE_BITS`,e[e.ALPHA_BITS=3413]=`ALPHA_BITS`,e[e.DEPTH_BITS=3414]=`DEPTH_BITS`,e[e.STENCIL_BITS=3415]=`STENCIL_BITS`,e[e.POLYGON_OFFSET_UNITS=10752]=`POLYGON_OFFSET_UNITS`,e[e.POLYGON_OFFSET_FACTOR=32824]=`POLYGON_OFFSET_FACTOR`,e[e.TEXTURE_BINDING_2D=32873]=`TEXTURE_BINDING_2D`,e[e.SAMPLE_BUFFERS=32936]=`SAMPLE_BUFFERS`,e[e.SAMPLES=32937]=`SAMPLES`,e[e.SAMPLE_COVERAGE_VALUE=32938]=`SAMPLE_COVERAGE_VALUE`,e[e.SAMPLE_COVERAGE_INVERT=32939]=`SAMPLE_COVERAGE_INVERT`,e[e.COMPRESSED_TEXTURE_FORMATS=34467]=`COMPRESSED_TEXTURE_FORMATS`,e[e.VENDOR=7936]=`VENDOR`,e[e.RENDERER=7937]=`RENDERER`,e[e.VERSION=7938]=`VERSION`,e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]=`IMPLEMENTATION_COLOR_READ_TYPE`,e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]=`IMPLEMENTATION_COLOR_READ_FORMAT`,e[e.BROWSER_DEFAULT_WEBGL=37444]=`BROWSER_DEFAULT_WEBGL`,e[e.STATIC_DRAW=35044]=`STATIC_DRAW`,e[e.STREAM_DRAW=35040]=`STREAM_DRAW`,e[e.DYNAMIC_DRAW=35048]=`DYNAMIC_DRAW`,e[e.ARRAY_BUFFER=34962]=`ARRAY_BUFFER`,e[e.ELEMENT_ARRAY_BUFFER=34963]=`ELEMENT_ARRAY_BUFFER`,e[e.BUFFER_SIZE=34660]=`BUFFER_SIZE`,e[e.BUFFER_USAGE=34661]=`BUFFER_USAGE`,e[e.CURRENT_VERTEX_ATTRIB=34342]=`CURRENT_VERTEX_ATTRIB`,e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]=`VERTEX_ATTRIB_ARRAY_ENABLED`,e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]=`VERTEX_ATTRIB_ARRAY_SIZE`,e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]=`VERTEX_ATTRIB_ARRAY_STRIDE`,e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]=`VERTEX_ATTRIB_ARRAY_TYPE`,e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]=`VERTEX_ATTRIB_ARRAY_NORMALIZED`,e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]=`VERTEX_ATTRIB_ARRAY_POINTER`,e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]=`VERTEX_ATTRIB_ARRAY_BUFFER_BINDING`,e[e.CULL_FACE=2884]=`CULL_FACE`,e[e.FRONT=1028]=`FRONT`,e[e.BACK=1029]=`BACK`,e[e.FRONT_AND_BACK=1032]=`FRONT_AND_BACK`,e[e.BLEND=3042]=`BLEND`,e[e.DEPTH_TEST=2929]=`DEPTH_TEST`,e[e.DITHER=3024]=`DITHER`,e[e.POLYGON_OFFSET_FILL=32823]=`POLYGON_OFFSET_FILL`,e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]=`SAMPLE_ALPHA_TO_COVERAGE`,e[e.SAMPLE_COVERAGE=32928]=`SAMPLE_COVERAGE`,e[e.SCISSOR_TEST=3089]=`SCISSOR_TEST`,e[e.STENCIL_TEST=2960]=`STENCIL_TEST`,e[e.NO_ERROR=0]=`NO_ERROR`,e[e.INVALID_ENUM=1280]=`INVALID_ENUM`,e[e.INVALID_VALUE=1281]=`INVALID_VALUE`,e[e.INVALID_OPERATION=1282]=`INVALID_OPERATION`,e[e.OUT_OF_MEMORY=1285]=`OUT_OF_MEMORY`,e[e.CONTEXT_LOST_WEBGL=37442]=`CONTEXT_LOST_WEBGL`,e[e.CW=2304]=`CW`,e[e.CCW=2305]=`CCW`,e[e.DONT_CARE=4352]=`DONT_CARE`,e[e.FASTEST=4353]=`FASTEST`,e[e.NICEST=4354]=`NICEST`,e[e.GENERATE_MIPMAP_HINT=33170]=`GENERATE_MIPMAP_HINT`,e[e.BYTE=5120]=`BYTE`,e[e.UNSIGNED_BYTE=5121]=`UNSIGNED_BYTE`,e[e.SHORT=5122]=`SHORT`,e[e.UNSIGNED_SHORT=5123]=`UNSIGNED_SHORT`,e[e.INT=5124]=`INT`,e[e.UNSIGNED_INT=5125]=`UNSIGNED_INT`,e[e.FLOAT=5126]=`FLOAT`,e[e.DOUBLE=5130]=`DOUBLE`,e[e.DEPTH_COMPONENT=6402]=`DEPTH_COMPONENT`,e[e.ALPHA=6406]=`ALPHA`,e[e.RGB=6407]=`RGB`,e[e.RGBA=6408]=`RGBA`,e[e.LUMINANCE=6409]=`LUMINANCE`,e[e.LUMINANCE_ALPHA=6410]=`LUMINANCE_ALPHA`,e[e.UNSIGNED_SHORT_4_4_4_4=32819]=`UNSIGNED_SHORT_4_4_4_4`,e[e.UNSIGNED_SHORT_5_5_5_1=32820]=`UNSIGNED_SHORT_5_5_5_1`,e[e.UNSIGNED_SHORT_5_6_5=33635]=`UNSIGNED_SHORT_5_6_5`,e[e.FRAGMENT_SHADER=35632]=`FRAGMENT_SHADER`,e[e.VERTEX_SHADER=35633]=`VERTEX_SHADER`,e[e.COMPILE_STATUS=35713]=`COMPILE_STATUS`,e[e.DELETE_STATUS=35712]=`DELETE_STATUS`,e[e.LINK_STATUS=35714]=`LINK_STATUS`,e[e.VALIDATE_STATUS=35715]=`VALIDATE_STATUS`,e[e.ATTACHED_SHADERS=35717]=`ATTACHED_SHADERS`,e[e.ACTIVE_ATTRIBUTES=35721]=`ACTIVE_ATTRIBUTES`,e[e.ACTIVE_UNIFORMS=35718]=`ACTIVE_UNIFORMS`,e[e.MAX_VERTEX_ATTRIBS=34921]=`MAX_VERTEX_ATTRIBS`,e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]=`MAX_VERTEX_UNIFORM_VECTORS`,e[e.MAX_VARYING_VECTORS=36348]=`MAX_VARYING_VECTORS`,e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]=`MAX_COMBINED_TEXTURE_IMAGE_UNITS`,e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]=`MAX_VERTEX_TEXTURE_IMAGE_UNITS`,e[e.MAX_TEXTURE_IMAGE_UNITS=34930]=`MAX_TEXTURE_IMAGE_UNITS`,e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]=`MAX_FRAGMENT_UNIFORM_VECTORS`,e[e.SHADER_TYPE=35663]=`SHADER_TYPE`,e[e.SHADING_LANGUAGE_VERSION=35724]=`SHADING_LANGUAGE_VERSION`,e[e.CURRENT_PROGRAM=35725]=`CURRENT_PROGRAM`,e[e.NEVER=512]=`NEVER`,e[e.ALWAYS=519]=`ALWAYS`,e[e.LESS=513]=`LESS`,e[e.EQUAL=514]=`EQUAL`,e[e.LEQUAL=515]=`LEQUAL`,e[e.GREATER=516]=`GREATER`,e[e.GEQUAL=518]=`GEQUAL`,e[e.NOTEQUAL=517]=`NOTEQUAL`,e[e.KEEP=7680]=`KEEP`,e[e.REPLACE=7681]=`REPLACE`,e[e.INCR=7682]=`INCR`,e[e.DECR=7683]=`DECR`,e[e.INVERT=5386]=`INVERT`,e[e.INCR_WRAP=34055]=`INCR_WRAP`,e[e.DECR_WRAP=34056]=`DECR_WRAP`,e[e.NEAREST=9728]=`NEAREST`,e[e.LINEAR=9729]=`LINEAR`,e[e.NEAREST_MIPMAP_NEAREST=9984]=`NEAREST_MIPMAP_NEAREST`,e[e.LINEAR_MIPMAP_NEAREST=9985]=`LINEAR_MIPMAP_NEAREST`,e[e.NEAREST_MIPMAP_LINEAR=9986]=`NEAREST_MIPMAP_LINEAR`,e[e.LINEAR_MIPMAP_LINEAR=9987]=`LINEAR_MIPMAP_LINEAR`,e[e.TEXTURE_MAG_FILTER=10240]=`TEXTURE_MAG_FILTER`,e[e.TEXTURE_MIN_FILTER=10241]=`TEXTURE_MIN_FILTER`,e[e.TEXTURE_WRAP_S=10242]=`TEXTURE_WRAP_S`,e[e.TEXTURE_WRAP_T=10243]=`TEXTURE_WRAP_T`,e[e.TEXTURE_2D=3553]=`TEXTURE_2D`,e[e.TEXTURE=5890]=`TEXTURE`,e[e.TEXTURE_CUBE_MAP=34067]=`TEXTURE_CUBE_MAP`,e[e.TEXTURE_BINDING_CUBE_MAP=34068]=`TEXTURE_BINDING_CUBE_MAP`,e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]=`TEXTURE_CUBE_MAP_POSITIVE_X`,e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]=`TEXTURE_CUBE_MAP_NEGATIVE_X`,e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]=`TEXTURE_CUBE_MAP_POSITIVE_Y`,e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]=`TEXTURE_CUBE_MAP_NEGATIVE_Y`,e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]=`TEXTURE_CUBE_MAP_POSITIVE_Z`,e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]=`TEXTURE_CUBE_MAP_NEGATIVE_Z`,e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]=`MAX_CUBE_MAP_TEXTURE_SIZE`,e[e.TEXTURE0=33984]=`TEXTURE0`,e[e.ACTIVE_TEXTURE=34016]=`ACTIVE_TEXTURE`,e[e.REPEAT=10497]=`REPEAT`,e[e.CLAMP_TO_EDGE=33071]=`CLAMP_TO_EDGE`,e[e.MIRRORED_REPEAT=33648]=`MIRRORED_REPEAT`,e[e.TEXTURE_WIDTH=4096]=`TEXTURE_WIDTH`,e[e.TEXTURE_HEIGHT=4097]=`TEXTURE_HEIGHT`,e[e.FLOAT_VEC2=35664]=`FLOAT_VEC2`,e[e.FLOAT_VEC3=35665]=`FLOAT_VEC3`,e[e.FLOAT_VEC4=35666]=`FLOAT_VEC4`,e[e.INT_VEC2=35667]=`INT_VEC2`,e[e.INT_VEC3=35668]=`INT_VEC3`,e[e.INT_VEC4=35669]=`INT_VEC4`,e[e.BOOL=35670]=`BOOL`,e[e.BOOL_VEC2=35671]=`BOOL_VEC2`,e[e.BOOL_VEC3=35672]=`BOOL_VEC3`,e[e.BOOL_VEC4=35673]=`BOOL_VEC4`,e[e.FLOAT_MAT2=35674]=`FLOAT_MAT2`,e[e.FLOAT_MAT3=35675]=`FLOAT_MAT3`,e[e.FLOAT_MAT4=35676]=`FLOAT_MAT4`,e[e.SAMPLER_2D=35678]=`SAMPLER_2D`,e[e.SAMPLER_CUBE=35680]=`SAMPLER_CUBE`,e[e.LOW_FLOAT=36336]=`LOW_FLOAT`,e[e.MEDIUM_FLOAT=36337]=`MEDIUM_FLOAT`,e[e.HIGH_FLOAT=36338]=`HIGH_FLOAT`,e[e.LOW_INT=36339]=`LOW_INT`,e[e.MEDIUM_INT=36340]=`MEDIUM_INT`,e[e.HIGH_INT=36341]=`HIGH_INT`,e[e.FRAMEBUFFER=36160]=`FRAMEBUFFER`,e[e.RENDERBUFFER=36161]=`RENDERBUFFER`,e[e.RGBA4=32854]=`RGBA4`,e[e.RGB5_A1=32855]=`RGB5_A1`,e[e.RGB565=36194]=`RGB565`,e[e.DEPTH_COMPONENT16=33189]=`DEPTH_COMPONENT16`,e[e.STENCIL_INDEX=6401]=`STENCIL_INDEX`,e[e.STENCIL_INDEX8=36168]=`STENCIL_INDEX8`,e[e.DEPTH_STENCIL=34041]=`DEPTH_STENCIL`,e[e.RENDERBUFFER_WIDTH=36162]=`RENDERBUFFER_WIDTH`,e[e.RENDERBUFFER_HEIGHT=36163]=`RENDERBUFFER_HEIGHT`,e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]=`RENDERBUFFER_INTERNAL_FORMAT`,e[e.RENDERBUFFER_RED_SIZE=36176]=`RENDERBUFFER_RED_SIZE`,e[e.RENDERBUFFER_GREEN_SIZE=36177]=`RENDERBUFFER_GREEN_SIZE`,e[e.RENDERBUFFER_BLUE_SIZE=36178]=`RENDERBUFFER_BLUE_SIZE`,e[e.RENDERBUFFER_ALPHA_SIZE=36179]=`RENDERBUFFER_ALPHA_SIZE`,e[e.RENDERBUFFER_DEPTH_SIZE=36180]=`RENDERBUFFER_DEPTH_SIZE`,e[e.RENDERBUFFER_STENCIL_SIZE=36181]=`RENDERBUFFER_STENCIL_SIZE`,e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]=`FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE`,e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]=`FRAMEBUFFER_ATTACHMENT_OBJECT_NAME`,e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]=`FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL`,e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]=`FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE`,e[e.COLOR_ATTACHMENT0=36064]=`COLOR_ATTACHMENT0`,e[e.DEPTH_ATTACHMENT=36096]=`DEPTH_ATTACHMENT`,e[e.STENCIL_ATTACHMENT=36128]=`STENCIL_ATTACHMENT`,e[e.DEPTH_STENCIL_ATTACHMENT=33306]=`DEPTH_STENCIL_ATTACHMENT`,e[e.NONE=0]=`NONE`,e[e.FRAMEBUFFER_COMPLETE=36053]=`FRAMEBUFFER_COMPLETE`,e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]=`FRAMEBUFFER_INCOMPLETE_ATTACHMENT`,e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]=`FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT`,e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]=`FRAMEBUFFER_INCOMPLETE_DIMENSIONS`,e[e.FRAMEBUFFER_UNSUPPORTED=36061]=`FRAMEBUFFER_UNSUPPORTED`,e[e.FRAMEBUFFER_BINDING=36006]=`FRAMEBUFFER_BINDING`,e[e.RENDERBUFFER_BINDING=36007]=`RENDERBUFFER_BINDING`,e[e.READ_FRAMEBUFFER=36008]=`READ_FRAMEBUFFER`,e[e.DRAW_FRAMEBUFFER=36009]=`DRAW_FRAMEBUFFER`,e[e.MAX_RENDERBUFFER_SIZE=34024]=`MAX_RENDERBUFFER_SIZE`,e[e.INVALID_FRAMEBUFFER_OPERATION=1286]=`INVALID_FRAMEBUFFER_OPERATION`,e[e.UNPACK_FLIP_Y_WEBGL=37440]=`UNPACK_FLIP_Y_WEBGL`,e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]=`UNPACK_PREMULTIPLY_ALPHA_WEBGL`,e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]=`UNPACK_COLORSPACE_CONVERSION_WEBGL`,e[e.READ_BUFFER=3074]=`READ_BUFFER`,e[e.UNPACK_ROW_LENGTH=3314]=`UNPACK_ROW_LENGTH`,e[e.UNPACK_SKIP_ROWS=3315]=`UNPACK_SKIP_ROWS`,e[e.UNPACK_SKIP_PIXELS=3316]=`UNPACK_SKIP_PIXELS`,e[e.PACK_ROW_LENGTH=3330]=`PACK_ROW_LENGTH`,e[e.PACK_SKIP_ROWS=3331]=`PACK_SKIP_ROWS`,e[e.PACK_SKIP_PIXELS=3332]=`PACK_SKIP_PIXELS`,e[e.TEXTURE_BINDING_3D=32874]=`TEXTURE_BINDING_3D`,e[e.UNPACK_SKIP_IMAGES=32877]=`UNPACK_SKIP_IMAGES`,e[e.UNPACK_IMAGE_HEIGHT=32878]=`UNPACK_IMAGE_HEIGHT`,e[e.MAX_3D_TEXTURE_SIZE=32883]=`MAX_3D_TEXTURE_SIZE`,e[e.MAX_ELEMENTS_VERTICES=33e3]=`MAX_ELEMENTS_VERTICES`,e[e.MAX_ELEMENTS_INDICES=33001]=`MAX_ELEMENTS_INDICES`,e[e.MAX_TEXTURE_LOD_BIAS=34045]=`MAX_TEXTURE_LOD_BIAS`,e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]=`MAX_FRAGMENT_UNIFORM_COMPONENTS`,e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]=`MAX_VERTEX_UNIFORM_COMPONENTS`,e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]=`MAX_ARRAY_TEXTURE_LAYERS`,e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]=`MIN_PROGRAM_TEXEL_OFFSET`,e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]=`MAX_PROGRAM_TEXEL_OFFSET`,e[e.MAX_VARYING_COMPONENTS=35659]=`MAX_VARYING_COMPONENTS`,e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]=`FRAGMENT_SHADER_DERIVATIVE_HINT`,e[e.RASTERIZER_DISCARD=35977]=`RASTERIZER_DISCARD`,e[e.VERTEX_ARRAY_BINDING=34229]=`VERTEX_ARRAY_BINDING`,e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]=`MAX_VERTEX_OUTPUT_COMPONENTS`,e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]=`MAX_FRAGMENT_INPUT_COMPONENTS`,e[e.MAX_SERVER_WAIT_TIMEOUT=37137]=`MAX_SERVER_WAIT_TIMEOUT`,e[e.MAX_ELEMENT_INDEX=36203]=`MAX_ELEMENT_INDEX`,e[e.RED=6403]=`RED`,e[e.RGB8=32849]=`RGB8`,e[e.RGBA8=32856]=`RGBA8`,e[e.RGB10_A2=32857]=`RGB10_A2`,e[e.TEXTURE_3D=32879]=`TEXTURE_3D`,e[e.TEXTURE_WRAP_R=32882]=`TEXTURE_WRAP_R`,e[e.TEXTURE_MIN_LOD=33082]=`TEXTURE_MIN_LOD`,e[e.TEXTURE_MAX_LOD=33083]=`TEXTURE_MAX_LOD`,e[e.TEXTURE_BASE_LEVEL=33084]=`TEXTURE_BASE_LEVEL`,e[e.TEXTURE_MAX_LEVEL=33085]=`TEXTURE_MAX_LEVEL`,e[e.TEXTURE_COMPARE_MODE=34892]=`TEXTURE_COMPARE_MODE`,e[e.TEXTURE_COMPARE_FUNC=34893]=`TEXTURE_COMPARE_FUNC`,e[e.SRGB=35904]=`SRGB`,e[e.SRGB8=35905]=`SRGB8`,e[e.SRGB8_ALPHA8=35907]=`SRGB8_ALPHA8`,e[e.COMPARE_REF_TO_TEXTURE=34894]=`COMPARE_REF_TO_TEXTURE`,e[e.RGBA32F=34836]=`RGBA32F`,e[e.RGB32F=34837]=`RGB32F`,e[e.RGBA16F=34842]=`RGBA16F`,e[e.RGB16F=34843]=`RGB16F`,e[e.TEXTURE_2D_ARRAY=35866]=`TEXTURE_2D_ARRAY`,e[e.TEXTURE_BINDING_2D_ARRAY=35869]=`TEXTURE_BINDING_2D_ARRAY`,e[e.R11F_G11F_B10F=35898]=`R11F_G11F_B10F`,e[e.RGB9_E5=35901]=`RGB9_E5`,e[e.RGBA32UI=36208]=`RGBA32UI`,e[e.RGB32UI=36209]=`RGB32UI`,e[e.RGBA16UI=36214]=`RGBA16UI`,e[e.RGB16UI=36215]=`RGB16UI`,e[e.RGBA8UI=36220]=`RGBA8UI`,e[e.RGB8UI=36221]=`RGB8UI`,e[e.RGBA32I=36226]=`RGBA32I`,e[e.RGB32I=36227]=`RGB32I`,e[e.RGBA16I=36232]=`RGBA16I`,e[e.RGB16I=36233]=`RGB16I`,e[e.RGBA8I=36238]=`RGBA8I`,e[e.RGB8I=36239]=`RGB8I`,e[e.RED_INTEGER=36244]=`RED_INTEGER`,e[e.RGB_INTEGER=36248]=`RGB_INTEGER`,e[e.RGBA_INTEGER=36249]=`RGBA_INTEGER`,e[e.R8=33321]=`R8`,e[e.RG8=33323]=`RG8`,e[e.R16F=33325]=`R16F`,e[e.R32F=33326]=`R32F`,e[e.RG16F=33327]=`RG16F`,e[e.RG32F=33328]=`RG32F`,e[e.R8I=33329]=`R8I`,e[e.R8UI=33330]=`R8UI`,e[e.R16I=33331]=`R16I`,e[e.R16UI=33332]=`R16UI`,e[e.R32I=33333]=`R32I`,e[e.R32UI=33334]=`R32UI`,e[e.RG8I=33335]=`RG8I`,e[e.RG8UI=33336]=`RG8UI`,e[e.RG16I=33337]=`RG16I`,e[e.RG16UI=33338]=`RG16UI`,e[e.RG32I=33339]=`RG32I`,e[e.RG32UI=33340]=`RG32UI`,e[e.R8_SNORM=36756]=`R8_SNORM`,e[e.RG8_SNORM=36757]=`RG8_SNORM`,e[e.RGB8_SNORM=36758]=`RGB8_SNORM`,e[e.RGBA8_SNORM=36759]=`RGBA8_SNORM`,e[e.RGB10_A2UI=36975]=`RGB10_A2UI`,e[e.TEXTURE_IMMUTABLE_FORMAT=37167]=`TEXTURE_IMMUTABLE_FORMAT`,e[e.TEXTURE_IMMUTABLE_LEVELS=33503]=`TEXTURE_IMMUTABLE_LEVELS`,e[e.UNSIGNED_INT_2_10_10_10_REV=33640]=`UNSIGNED_INT_2_10_10_10_REV`,e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]=`UNSIGNED_INT_10F_11F_11F_REV`,e[e.UNSIGNED_INT_5_9_9_9_REV=35902]=`UNSIGNED_INT_5_9_9_9_REV`,e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]=`FLOAT_32_UNSIGNED_INT_24_8_REV`,e[e.UNSIGNED_INT_24_8=34042]=`UNSIGNED_INT_24_8`,e[e.HALF_FLOAT=5131]=`HALF_FLOAT`,e[e.RG=33319]=`RG`,e[e.RG_INTEGER=33320]=`RG_INTEGER`,e[e.INT_2_10_10_10_REV=36255]=`INT_2_10_10_10_REV`,e[e.CURRENT_QUERY=34917]=`CURRENT_QUERY`,e[e.QUERY_RESULT=34918]=`QUERY_RESULT`,e[e.QUERY_RESULT_AVAILABLE=34919]=`QUERY_RESULT_AVAILABLE`,e[e.ANY_SAMPLES_PASSED=35887]=`ANY_SAMPLES_PASSED`,e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]=`ANY_SAMPLES_PASSED_CONSERVATIVE`,e[e.MAX_DRAW_BUFFERS=34852]=`MAX_DRAW_BUFFERS`,e[e.DRAW_BUFFER0=34853]=`DRAW_BUFFER0`,e[e.DRAW_BUFFER1=34854]=`DRAW_BUFFER1`,e[e.DRAW_BUFFER2=34855]=`DRAW_BUFFER2`,e[e.DRAW_BUFFER3=34856]=`DRAW_BUFFER3`,e[e.DRAW_BUFFER4=34857]=`DRAW_BUFFER4`,e[e.DRAW_BUFFER5=34858]=`DRAW_BUFFER5`,e[e.DRAW_BUFFER6=34859]=`DRAW_BUFFER6`,e[e.DRAW_BUFFER7=34860]=`DRAW_BUFFER7`,e[e.DRAW_BUFFER8=34861]=`DRAW_BUFFER8`,e[e.DRAW_BUFFER9=34862]=`DRAW_BUFFER9`,e[e.DRAW_BUFFER10=34863]=`DRAW_BUFFER10`,e[e.DRAW_BUFFER11=34864]=`DRAW_BUFFER11`,e[e.DRAW_BUFFER12=34865]=`DRAW_BUFFER12`,e[e.DRAW_BUFFER13=34866]=`DRAW_BUFFER13`,e[e.DRAW_BUFFER14=34867]=`DRAW_BUFFER14`,e[e.DRAW_BUFFER15=34868]=`DRAW_BUFFER15`,e[e.MAX_COLOR_ATTACHMENTS=36063]=`MAX_COLOR_ATTACHMENTS`,e[e.COLOR_ATTACHMENT1=36065]=`COLOR_ATTACHMENT1`,e[e.COLOR_ATTACHMENT2=36066]=`COLOR_ATTACHMENT2`,e[e.COLOR_ATTACHMENT3=36067]=`COLOR_ATTACHMENT3`,e[e.COLOR_ATTACHMENT4=36068]=`COLOR_ATTACHMENT4`,e[e.COLOR_ATTACHMENT5=36069]=`COLOR_ATTACHMENT5`,e[e.COLOR_ATTACHMENT6=36070]=`COLOR_ATTACHMENT6`,e[e.COLOR_ATTACHMENT7=36071]=`COLOR_ATTACHMENT7`,e[e.COLOR_ATTACHMENT8=36072]=`COLOR_ATTACHMENT8`,e[e.COLOR_ATTACHMENT9=36073]=`COLOR_ATTACHMENT9`,e[e.COLOR_ATTACHMENT10=36074]=`COLOR_ATTACHMENT10`,e[e.COLOR_ATTACHMENT11=36075]=`COLOR_ATTACHMENT11`,e[e.COLOR_ATTACHMENT12=36076]=`COLOR_ATTACHMENT12`,e[e.COLOR_ATTACHMENT13=36077]=`COLOR_ATTACHMENT13`,e[e.COLOR_ATTACHMENT14=36078]=`COLOR_ATTACHMENT14`,e[e.COLOR_ATTACHMENT15=36079]=`COLOR_ATTACHMENT15`,e[e.SAMPLER_3D=35679]=`SAMPLER_3D`,e[e.SAMPLER_2D_SHADOW=35682]=`SAMPLER_2D_SHADOW`,e[e.SAMPLER_2D_ARRAY=36289]=`SAMPLER_2D_ARRAY`,e[e.SAMPLER_2D_ARRAY_SHADOW=36292]=`SAMPLER_2D_ARRAY_SHADOW`,e[e.SAMPLER_CUBE_SHADOW=36293]=`SAMPLER_CUBE_SHADOW`,e[e.INT_SAMPLER_2D=36298]=`INT_SAMPLER_2D`,e[e.INT_SAMPLER_3D=36299]=`INT_SAMPLER_3D`,e[e.INT_SAMPLER_CUBE=36300]=`INT_SAMPLER_CUBE`,e[e.INT_SAMPLER_2D_ARRAY=36303]=`INT_SAMPLER_2D_ARRAY`,e[e.UNSIGNED_INT_SAMPLER_2D=36306]=`UNSIGNED_INT_SAMPLER_2D`,e[e.UNSIGNED_INT_SAMPLER_3D=36307]=`UNSIGNED_INT_SAMPLER_3D`,e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]=`UNSIGNED_INT_SAMPLER_CUBE`,e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]=`UNSIGNED_INT_SAMPLER_2D_ARRAY`,e[e.MAX_SAMPLES=36183]=`MAX_SAMPLES`,e[e.SAMPLER_BINDING=35097]=`SAMPLER_BINDING`,e[e.PIXEL_PACK_BUFFER=35051]=`PIXEL_PACK_BUFFER`,e[e.PIXEL_UNPACK_BUFFER=35052]=`PIXEL_UNPACK_BUFFER`,e[e.PIXEL_PACK_BUFFER_BINDING=35053]=`PIXEL_PACK_BUFFER_BINDING`,e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]=`PIXEL_UNPACK_BUFFER_BINDING`,e[e.COPY_READ_BUFFER=36662]=`COPY_READ_BUFFER`,e[e.COPY_WRITE_BUFFER=36663]=`COPY_WRITE_BUFFER`,e[e.COPY_READ_BUFFER_BINDING=36662]=`COPY_READ_BUFFER_BINDING`,e[e.COPY_WRITE_BUFFER_BINDING=36663]=`COPY_WRITE_BUFFER_BINDING`,e[e.FLOAT_MAT2x3=35685]=`FLOAT_MAT2x3`,e[e.FLOAT_MAT2x4=35686]=`FLOAT_MAT2x4`,e[e.FLOAT_MAT3x2=35687]=`FLOAT_MAT3x2`,e[e.FLOAT_MAT3x4=35688]=`FLOAT_MAT3x4`,e[e.FLOAT_MAT4x2=35689]=`FLOAT_MAT4x2`,e[e.FLOAT_MAT4x3=35690]=`FLOAT_MAT4x3`,e[e.UNSIGNED_INT_VEC2=36294]=`UNSIGNED_INT_VEC2`,e[e.UNSIGNED_INT_VEC3=36295]=`UNSIGNED_INT_VEC3`,e[e.UNSIGNED_INT_VEC4=36296]=`UNSIGNED_INT_VEC4`,e[e.UNSIGNED_NORMALIZED=35863]=`UNSIGNED_NORMALIZED`,e[e.SIGNED_NORMALIZED=36764]=`SIGNED_NORMALIZED`,e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]=`VERTEX_ATTRIB_ARRAY_INTEGER`,e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]=`VERTEX_ATTRIB_ARRAY_DIVISOR`,e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]=`TRANSFORM_FEEDBACK_BUFFER_MODE`,e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]=`MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS`,e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]=`TRANSFORM_FEEDBACK_VARYINGS`,e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]=`TRANSFORM_FEEDBACK_BUFFER_START`,e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]=`TRANSFORM_FEEDBACK_BUFFER_SIZE`,e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]=`TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN`,e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]=`MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS`,e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]=`MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS`,e[e.INTERLEAVED_ATTRIBS=35980]=`INTERLEAVED_ATTRIBS`,e[e.SEPARATE_ATTRIBS=35981]=`SEPARATE_ATTRIBS`,e[e.TRANSFORM_FEEDBACK_BUFFER=35982]=`TRANSFORM_FEEDBACK_BUFFER`,e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]=`TRANSFORM_FEEDBACK_BUFFER_BINDING`,e[e.TRANSFORM_FEEDBACK=36386]=`TRANSFORM_FEEDBACK`,e[e.TRANSFORM_FEEDBACK_PAUSED=36387]=`TRANSFORM_FEEDBACK_PAUSED`,e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]=`TRANSFORM_FEEDBACK_ACTIVE`,e[e.TRANSFORM_FEEDBACK_BINDING=36389]=`TRANSFORM_FEEDBACK_BINDING`,e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]=`FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING`,e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]=`FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE`,e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]=`FRAMEBUFFER_ATTACHMENT_RED_SIZE`,e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]=`FRAMEBUFFER_ATTACHMENT_GREEN_SIZE`,e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]=`FRAMEBUFFER_ATTACHMENT_BLUE_SIZE`,e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]=`FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE`,e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]=`FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE`,e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]=`FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE`,e[e.FRAMEBUFFER_DEFAULT=33304]=`FRAMEBUFFER_DEFAULT`,e[e.DEPTH24_STENCIL8=35056]=`DEPTH24_STENCIL8`,e[e.DRAW_FRAMEBUFFER_BINDING=36006]=`DRAW_FRAMEBUFFER_BINDING`,e[e.READ_FRAMEBUFFER_BINDING=36010]=`READ_FRAMEBUFFER_BINDING`,e[e.RENDERBUFFER_SAMPLES=36011]=`RENDERBUFFER_SAMPLES`,e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]=`FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER`,e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]=`FRAMEBUFFER_INCOMPLETE_MULTISAMPLE`,e[e.UNIFORM_BUFFER=35345]=`UNIFORM_BUFFER`,e[e.UNIFORM_BUFFER_BINDING=35368]=`UNIFORM_BUFFER_BINDING`,e[e.UNIFORM_BUFFER_START=35369]=`UNIFORM_BUFFER_START`,e[e.UNIFORM_BUFFER_SIZE=35370]=`UNIFORM_BUFFER_SIZE`,e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]=`MAX_VERTEX_UNIFORM_BLOCKS`,e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]=`MAX_FRAGMENT_UNIFORM_BLOCKS`,e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]=`MAX_COMBINED_UNIFORM_BLOCKS`,e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]=`MAX_UNIFORM_BUFFER_BINDINGS`,e[e.MAX_UNIFORM_BLOCK_SIZE=35376]=`MAX_UNIFORM_BLOCK_SIZE`,e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]=`MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS`,e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]=`MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS`,e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]=`UNIFORM_BUFFER_OFFSET_ALIGNMENT`,e[e.ACTIVE_UNIFORM_BLOCKS=35382]=`ACTIVE_UNIFORM_BLOCKS`,e[e.UNIFORM_TYPE=35383]=`UNIFORM_TYPE`,e[e.UNIFORM_SIZE=35384]=`UNIFORM_SIZE`,e[e.UNIFORM_BLOCK_INDEX=35386]=`UNIFORM_BLOCK_INDEX`,e[e.UNIFORM_OFFSET=35387]=`UNIFORM_OFFSET`,e[e.UNIFORM_ARRAY_STRIDE=35388]=`UNIFORM_ARRAY_STRIDE`,e[e.UNIFORM_MATRIX_STRIDE=35389]=`UNIFORM_MATRIX_STRIDE`,e[e.UNIFORM_IS_ROW_MAJOR=35390]=`UNIFORM_IS_ROW_MAJOR`,e[e.UNIFORM_BLOCK_BINDING=35391]=`UNIFORM_BLOCK_BINDING`,e[e.UNIFORM_BLOCK_DATA_SIZE=35392]=`UNIFORM_BLOCK_DATA_SIZE`,e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]=`UNIFORM_BLOCK_ACTIVE_UNIFORMS`,e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]=`UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES`,e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]=`UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER`,e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]=`UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER`,e[e.OBJECT_TYPE=37138]=`OBJECT_TYPE`,e[e.SYNC_CONDITION=37139]=`SYNC_CONDITION`,e[e.SYNC_STATUS=37140]=`SYNC_STATUS`,e[e.SYNC_FLAGS=37141]=`SYNC_FLAGS`,e[e.SYNC_FENCE=37142]=`SYNC_FENCE`,e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]=`SYNC_GPU_COMMANDS_COMPLETE`,e[e.UNSIGNALED=37144]=`UNSIGNALED`,e[e.SIGNALED=37145]=`SIGNALED`,e[e.ALREADY_SIGNALED=37146]=`ALREADY_SIGNALED`,e[e.TIMEOUT_EXPIRED=37147]=`TIMEOUT_EXPIRED`,e[e.CONDITION_SATISFIED=37148]=`CONDITION_SATISFIED`,e[e.WAIT_FAILED=37149]=`WAIT_FAILED`,e[e.SYNC_FLUSH_COMMANDS_BIT=1]=`SYNC_FLUSH_COMMANDS_BIT`,e[e.COLOR=6144]=`COLOR`,e[e.DEPTH=6145]=`DEPTH`,e[e.STENCIL=6146]=`STENCIL`,e[e.MIN=32775]=`MIN`,e[e.MAX=32776]=`MAX`,e[e.DEPTH_COMPONENT24=33190]=`DEPTH_COMPONENT24`,e[e.STREAM_READ=35041]=`STREAM_READ`,e[e.STREAM_COPY=35042]=`STREAM_COPY`,e[e.STATIC_READ=35045]=`STATIC_READ`,e[e.STATIC_COPY=35046]=`STATIC_COPY`,e[e.DYNAMIC_READ=35049]=`DYNAMIC_READ`,e[e.DYNAMIC_COPY=35050]=`DYNAMIC_COPY`,e[e.DEPTH_COMPONENT32F=36012]=`DEPTH_COMPONENT32F`,e[e.DEPTH32F_STENCIL8=36013]=`DEPTH32F_STENCIL8`,e[e.INVALID_INDEX=4294967295]=`INVALID_INDEX`,e[e.TIMEOUT_IGNORED=-1]=`TIMEOUT_IGNORED`,e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]=`MAX_CLIENT_WAIT_TIMEOUT_WEBGL`,e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]=`VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE`,e[e.UNMASKED_VENDOR_WEBGL=37445]=`UNMASKED_VENDOR_WEBGL`,e[e.UNMASKED_RENDERER_WEBGL=37446]=`UNMASKED_RENDERER_WEBGL`,e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]=`MAX_TEXTURE_MAX_ANISOTROPY_EXT`,e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]=`TEXTURE_MAX_ANISOTROPY_EXT`,e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]=`COMPRESSED_RGB_S3TC_DXT1_EXT`,e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]=`COMPRESSED_RGBA_S3TC_DXT1_EXT`,e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]=`COMPRESSED_RGBA_S3TC_DXT3_EXT`,e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]=`COMPRESSED_RGBA_S3TC_DXT5_EXT`,e[e.COMPRESSED_R11_EAC=37488]=`COMPRESSED_R11_EAC`,e[e.COMPRESSED_SIGNED_R11_EAC=37489]=`COMPRESSED_SIGNED_R11_EAC`,e[e.COMPRESSED_RG11_EAC=37490]=`COMPRESSED_RG11_EAC`,e[e.COMPRESSED_SIGNED_RG11_EAC=37491]=`COMPRESSED_SIGNED_RG11_EAC`,e[e.COMPRESSED_RGB8_ETC2=37492]=`COMPRESSED_RGB8_ETC2`,e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]=`COMPRESSED_RGBA8_ETC2_EAC`,e[e.COMPRESSED_SRGB8_ETC2=37494]=`COMPRESSED_SRGB8_ETC2`,e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]=`COMPRESSED_SRGB8_ALPHA8_ETC2_EAC`,e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]=`COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2`,e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]=`COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2`,e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]=`COMPRESSED_RGB_PVRTC_4BPPV1_IMG`,e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]=`COMPRESSED_RGBA_PVRTC_4BPPV1_IMG`,e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]=`COMPRESSED_RGB_PVRTC_2BPPV1_IMG`,e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]=`COMPRESSED_RGBA_PVRTC_2BPPV1_IMG`,e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]=`COMPRESSED_RGB_ETC1_WEBGL`,e[e.COMPRESSED_RGB_ATC_WEBGL=35986]=`COMPRESSED_RGB_ATC_WEBGL`,e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]=`COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL`,e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]=`COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL`,e[e.UNSIGNED_INT_24_8_WEBGL=34042]=`UNSIGNED_INT_24_8_WEBGL`,e[e.HALF_FLOAT_OES=36193]=`HALF_FLOAT_OES`,e[e.RGBA32F_EXT=34836]=`RGBA32F_EXT`,e[e.RGB32F_EXT=34837]=`RGB32F_EXT`,e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]=`FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT`,e[e.UNSIGNED_NORMALIZED_EXT=35863]=`UNSIGNED_NORMALIZED_EXT`,e[e.MIN_EXT=32775]=`MIN_EXT`,e[e.MAX_EXT=32776]=`MAX_EXT`,e[e.SRGB_EXT=35904]=`SRGB_EXT`,e[e.SRGB_ALPHA_EXT=35906]=`SRGB_ALPHA_EXT`,e[e.SRGB8_ALPHA8_EXT=35907]=`SRGB8_ALPHA8_EXT`,e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]=`FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT`,e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]=`FRAGMENT_SHADER_DERIVATIVE_HINT_OES`,e[e.COLOR_ATTACHMENT0_WEBGL=36064]=`COLOR_ATTACHMENT0_WEBGL`,e[e.COLOR_ATTACHMENT1_WEBGL=36065]=`COLOR_ATTACHMENT1_WEBGL`,e[e.COLOR_ATTACHMENT2_WEBGL=36066]=`COLOR_ATTACHMENT2_WEBGL`,e[e.COLOR_ATTACHMENT3_WEBGL=36067]=`COLOR_ATTACHMENT3_WEBGL`,e[e.COLOR_ATTACHMENT4_WEBGL=36068]=`COLOR_ATTACHMENT4_WEBGL`,e[e.COLOR_ATTACHMENT5_WEBGL=36069]=`COLOR_ATTACHMENT5_WEBGL`,e[e.COLOR_ATTACHMENT6_WEBGL=36070]=`COLOR_ATTACHMENT6_WEBGL`,e[e.COLOR_ATTACHMENT7_WEBGL=36071]=`COLOR_ATTACHMENT7_WEBGL`,e[e.COLOR_ATTACHMENT8_WEBGL=36072]=`COLOR_ATTACHMENT8_WEBGL`,e[e.COLOR_ATTACHMENT9_WEBGL=36073]=`COLOR_ATTACHMENT9_WEBGL`,e[e.COLOR_ATTACHMENT10_WEBGL=36074]=`COLOR_ATTACHMENT10_WEBGL`,e[e.COLOR_ATTACHMENT11_WEBGL=36075]=`COLOR_ATTACHMENT11_WEBGL`,e[e.COLOR_ATTACHMENT12_WEBGL=36076]=`COLOR_ATTACHMENT12_WEBGL`,e[e.COLOR_ATTACHMENT13_WEBGL=36077]=`COLOR_ATTACHMENT13_WEBGL`,e[e.COLOR_ATTACHMENT14_WEBGL=36078]=`COLOR_ATTACHMENT14_WEBGL`,e[e.COLOR_ATTACHMENT15_WEBGL=36079]=`COLOR_ATTACHMENT15_WEBGL`,e[e.DRAW_BUFFER0_WEBGL=34853]=`DRAW_BUFFER0_WEBGL`,e[e.DRAW_BUFFER1_WEBGL=34854]=`DRAW_BUFFER1_WEBGL`,e[e.DRAW_BUFFER2_WEBGL=34855]=`DRAW_BUFFER2_WEBGL`,e[e.DRAW_BUFFER3_WEBGL=34856]=`DRAW_BUFFER3_WEBGL`,e[e.DRAW_BUFFER4_WEBGL=34857]=`DRAW_BUFFER4_WEBGL`,e[e.DRAW_BUFFER5_WEBGL=34858]=`DRAW_BUFFER5_WEBGL`,e[e.DRAW_BUFFER6_WEBGL=34859]=`DRAW_BUFFER6_WEBGL`,e[e.DRAW_BUFFER7_WEBGL=34860]=`DRAW_BUFFER7_WEBGL`,e[e.DRAW_BUFFER8_WEBGL=34861]=`DRAW_BUFFER8_WEBGL`,e[e.DRAW_BUFFER9_WEBGL=34862]=`DRAW_BUFFER9_WEBGL`,e[e.DRAW_BUFFER10_WEBGL=34863]=`DRAW_BUFFER10_WEBGL`,e[e.DRAW_BUFFER11_WEBGL=34864]=`DRAW_BUFFER11_WEBGL`,e[e.DRAW_BUFFER12_WEBGL=34865]=`DRAW_BUFFER12_WEBGL`,e[e.DRAW_BUFFER13_WEBGL=34866]=`DRAW_BUFFER13_WEBGL`,e[e.DRAW_BUFFER14_WEBGL=34867]=`DRAW_BUFFER14_WEBGL`,e[e.DRAW_BUFFER15_WEBGL=34868]=`DRAW_BUFFER15_WEBGL`,e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]=`MAX_COLOR_ATTACHMENTS_WEBGL`,e[e.MAX_DRAW_BUFFERS_WEBGL=34852]=`MAX_DRAW_BUFFERS_WEBGL`,e[e.VERTEX_ARRAY_BINDING_OES=34229]=`VERTEX_ARRAY_BINDING_OES`,e[e.QUERY_COUNTER_BITS_EXT=34916]=`QUERY_COUNTER_BITS_EXT`,e[e.CURRENT_QUERY_EXT=34917]=`CURRENT_QUERY_EXT`,e[e.QUERY_RESULT_EXT=34918]=`QUERY_RESULT_EXT`,e[e.QUERY_RESULT_AVAILABLE_EXT=34919]=`QUERY_RESULT_AVAILABLE_EXT`,e[e.TIME_ELAPSED_EXT=35007]=`TIME_ELAPSED_EXT`,e[e.TIMESTAMP_EXT=36392]=`TIMESTAMP_EXT`,e[e.GPU_DISJOINT_EXT=36795]=`GPU_DISJOINT_EXT`})(Q||={}),(function(e){e[e.Buffer=0]=`Buffer`,e[e.Texture=1]=`Texture`,e[e.RenderTarget=2]=`RenderTarget`,e[e.Sampler=3]=`Sampler`,e[e.Program=4]=`Program`,e[e.Bindings=5]=`Bindings`,e[e.InputLayout=6]=`InputLayout`,e[e.RenderPipeline=7]=`RenderPipeline`,e[e.ComputePipeline=8]=`ComputePipeline`,e[e.Readback=9]=`Readback`,e[e.QueryPool=10]=`QueryPool`,e[e.RenderBundle=11]=`RenderBundle`})(U$||={}),(function(e){e[e.NEVER=512]=`NEVER`,e[e.LESS=513]=`LESS`,e[e.EQUAL=514]=`EQUAL`,e[e.LEQUAL=515]=`LEQUAL`,e[e.GREATER=516]=`GREATER`,e[e.NOTEQUAL=517]=`NOTEQUAL`,e[e.GEQUAL=518]=`GEQUAL`,e[e.ALWAYS=519]=`ALWAYS`})(W$||={}),(function(e){e[e.CCW=2305]=`CCW`,e[e.CW=2304]=`CW`})(G$||={}),(function(e){e[e.NONE=0]=`NONE`,e[e.FRONT=1]=`FRONT`,e[e.BACK=2]=`BACK`,e[e.FRONT_AND_BACK=3]=`FRONT_AND_BACK`})(K$||={}),(function(e){e[e.ZERO=0]=`ZERO`,e[e.ONE=1]=`ONE`,e[e.SRC=768]=`SRC`,e[e.ONE_MINUS_SRC=769]=`ONE_MINUS_SRC`,e[e.DST=774]=`DST`,e[e.ONE_MINUS_DST=775]=`ONE_MINUS_DST`,e[e.SRC_ALPHA=770]=`SRC_ALPHA`,e[e.ONE_MINUS_SRC_ALPHA=771]=`ONE_MINUS_SRC_ALPHA`,e[e.DST_ALPHA=772]=`DST_ALPHA`,e[e.ONE_MINUS_DST_ALPHA=773]=`ONE_MINUS_DST_ALPHA`,e[e.CONST=32769]=`CONST`,e[e.ONE_MINUS_CONSTANT=32770]=`ONE_MINUS_CONSTANT`,e[e.SRC_ALPHA_SATURATE=776]=`SRC_ALPHA_SATURATE`})(q$||={}),(function(e){e[e.ADD=32774]=`ADD`,e[e.SUBSTRACT=32778]=`SUBSTRACT`,e[e.REVERSE_SUBSTRACT=32779]=`REVERSE_SUBSTRACT`,e[e.MIN=32775]=`MIN`,e[e.MAX=32776]=`MAX`})(J$||={}),(function(e){e[e.CLAMP_TO_EDGE=0]=`CLAMP_TO_EDGE`,e[e.REPEAT=1]=`REPEAT`,e[e.MIRRORED_REPEAT=2]=`MIRRORED_REPEAT`})(Y$||={}),(function(e){e[e.POINT=0]=`POINT`,e[e.BILINEAR=1]=`BILINEAR`})(X$||={}),(function(e){e[e.NO_MIP=0]=`NO_MIP`,e[e.NEAREST=1]=`NEAREST`,e[e.LINEAR=2]=`LINEAR`})(Z$||={}),(function(e){e[e.POINTS=0]=`POINTS`,e[e.TRIANGLES=1]=`TRIANGLES`,e[e.TRIANGLE_STRIP=2]=`TRIANGLE_STRIP`,e[e.LINES=3]=`LINES`,e[e.LINE_STRIP=4]=`LINE_STRIP`})(Q$||={}),(function(e){e[e.MAP_READ=1]=`MAP_READ`,e[e.MAP_WRITE=2]=`MAP_WRITE`,e[e.COPY_SRC=4]=`COPY_SRC`,e[e.COPY_DST=8]=`COPY_DST`,e[e.INDEX=16]=`INDEX`,e[e.VERTEX=32]=`VERTEX`,e[e.UNIFORM=64]=`UNIFORM`,e[e.STORAGE=128]=`STORAGE`,e[e.INDIRECT=256]=`INDIRECT`,e[e.QUERY_RESOLVE=512]=`QUERY_RESOLVE`})($$||={}),(function(e){e[e.STATIC=1]=`STATIC`,e[e.DYNAMIC=2]=`DYNAMIC`})(e1||={}),(function(e){e[e.VERTEX=1]=`VERTEX`,e[e.INSTANCE=2]=`INSTANCE`})(t1||={}),(function(e){e.LOADED=`loaded`})(n1||={}),(function(e){e[e.TEXTURE_2D=0]=`TEXTURE_2D`,e[e.TEXTURE_2D_ARRAY=1]=`TEXTURE_2D_ARRAY`,e[e.TEXTURE_3D=2]=`TEXTURE_3D`,e[e.TEXTURE_CUBE_MAP=3]=`TEXTURE_CUBE_MAP`})(r1||={}),(function(e){e[e.SAMPLED=1]=`SAMPLED`,e[e.RENDER_TARGET=2]=`RENDER_TARGET`,e[e.STORAGE=4]=`STORAGE`})(i1||={}),(function(e){e[e.NONE=0]=`NONE`,e[e.RED=1]=`RED`,e[e.GREEN=2]=`GREEN`,e[e.BLUE=4]=`BLUE`,e[e.ALPHA=8]=`ALPHA`,e[e.RGB=7]=`RGB`,e[e.ALL=15]=`ALL`})(a1||={}),(function(e){e[e.KEEP=7680]=`KEEP`,e[e.ZERO=0]=`ZERO`,e[e.REPLACE=7681]=`REPLACE`,e[e.INVERT=5386]=`INVERT`,e[e.INCREMENT_CLAMP=7682]=`INCREMENT_CLAMP`,e[e.DECREMENT_CLAMP=7683]=`DECREMENT_CLAMP`,e[e.INCREMENT_WRAP=34055]=`INCREMENT_WRAP`,e[e.DECREMENT_WRAP=34056]=`DECREMENT_WRAP`})(o1||={}),(function(e){e[e.Float=0]=`Float`,e[e.UnfilterableFloat=1]=`UnfilterableFloat`,e[e.Uint=2]=`Uint`,e[e.Sint=3]=`Sint`,e[e.Depth=4]=`Depth`})(s1||={}),(function(e){e[e.LOWER_LEFT=0]=`LOWER_LEFT`,e[e.UPPER_LEFT=1]=`UPPER_LEFT`})(c1||={}),(function(e){e[e.NEGATIVE_ONE=0]=`NEGATIVE_ONE`,e[e.ZERO=1]=`ZERO`})(l1||={}),(function(e){e[e.OcclusionConservative=0]=`OcclusionConservative`})(u1||={}),(function(e){e[e.U8=1]=`U8`,e[e.U16=2]=`U16`,e[e.U32=3]=`U32`,e[e.S8=4]=`S8`,e[e.S16=5]=`S16`,e[e.S32=6]=`S32`,e[e.F16=7]=`F16`,e[e.F32=8]=`F32`,e[e.BC1=65]=`BC1`,e[e.BC2=66]=`BC2`,e[e.BC3=67]=`BC3`,e[e.BC4_UNORM=68]=`BC4_UNORM`,e[e.BC4_SNORM=69]=`BC4_SNORM`,e[e.BC5_UNORM=70]=`BC5_UNORM`,e[e.BC5_SNORM=71]=`BC5_SNORM`,e[e.U16_PACKED_5551=97]=`U16_PACKED_5551`,e[e.U16_PACKED_565=98]=`U16_PACKED_565`,e[e.D24=129]=`D24`,e[e.D32F=130]=`D32F`,e[e.D24S8=131]=`D24S8`,e[e.D32FS8=132]=`D32FS8`})(d1||={}),(function(e){e[e.R=1]=`R`,e[e.RG=2]=`RG`,e[e.RGB=3]=`RGB`,e[e.RGBA=4]=`RGBA`,e[e.A=5]=`A`})(f1||={}),(function(e){e[e.None=0]=`None`,e[e.Normalized=1]=`Normalized`,e[e.sRGB=2]=`sRGB`,e[e.Depth=4]=`Depth`,e[e.Stencil=8]=`Stencil`,e[e.RenderTarget=16]=`RenderTarget`,e[e.Luminance=32]=`Luminance`})(p1||={}),(function(e){e[e.ALPHA=mZ(d1.U8,f1.A,p1.None)]=`ALPHA`,e[e.U8_LUMINANCE=mZ(d1.U8,f1.A,p1.Luminance)]=`U8_LUMINANCE`,e[e.F16_LUMINANCE=mZ(d1.F16,f1.A,p1.Luminance)]=`F16_LUMINANCE`,e[e.F32_LUMINANCE=mZ(d1.F32,f1.A,p1.Luminance)]=`F32_LUMINANCE`,e[e.F16_R=mZ(d1.F16,f1.R,p1.None)]=`F16_R`,e[e.F16_RG=mZ(d1.F16,f1.RG,p1.None)]=`F16_RG`,e[e.F16_RGB=mZ(d1.F16,f1.RGB,p1.None)]=`F16_RGB`,e[e.F16_RGBA=mZ(d1.F16,f1.RGBA,p1.None)]=`F16_RGBA`,e[e.F32_R=mZ(d1.F32,f1.R,p1.None)]=`F32_R`,e[e.F32_RG=mZ(d1.F32,f1.RG,p1.None)]=`F32_RG`,e[e.F32_RGB=mZ(d1.F32,f1.RGB,p1.None)]=`F32_RGB`,e[e.F32_RGBA=mZ(d1.F32,f1.RGBA,p1.None)]=`F32_RGBA`,e[e.U8_R=mZ(d1.U8,f1.R,p1.None)]=`U8_R`,e[e.U8_R_NORM=mZ(d1.U8,f1.R,p1.Normalized)]=`U8_R_NORM`,e[e.U8_RG=mZ(d1.U8,f1.RG,p1.None)]=`U8_RG`,e[e.U8_RG_NORM=mZ(d1.U8,f1.RG,p1.Normalized)]=`U8_RG_NORM`,e[e.U8_RGB=mZ(d1.U8,f1.RGB,p1.None)]=`U8_RGB`,e[e.U8_RGB_NORM=mZ(d1.U8,f1.RGB,p1.Normalized)]=`U8_RGB_NORM`,e[e.U8_RGB_SRGB=mZ(d1.U8,f1.RGB,p1.sRGB|p1.Normalized)]=`U8_RGB_SRGB`,e[e.U8_RGBA=mZ(d1.U8,f1.RGBA,p1.None)]=`U8_RGBA`,e[e.U8_RGBA_NORM=mZ(d1.U8,f1.RGBA,p1.Normalized)]=`U8_RGBA_NORM`,e[e.U8_RGBA_SRGB=mZ(d1.U8,f1.RGBA,p1.sRGB|p1.Normalized)]=`U8_RGBA_SRGB`,e[e.U16_R=mZ(d1.U16,f1.R,p1.None)]=`U16_R`,e[e.U16_R_NORM=mZ(d1.U16,f1.R,p1.Normalized)]=`U16_R_NORM`,e[e.U16_RG_NORM=mZ(d1.U16,f1.RG,p1.Normalized)]=`U16_RG_NORM`,e[e.U16_RGBA_NORM=mZ(d1.U16,f1.RGBA,p1.Normalized)]=`U16_RGBA_NORM`,e[e.U16_RGBA=mZ(d1.U16,f1.RGBA,p1.None)]=`U16_RGBA`,e[e.U16_RGB=mZ(d1.U16,f1.RGB,p1.None)]=`U16_RGB`,e[e.U16_RG=mZ(d1.U16,f1.RG,p1.None)]=`U16_RG`,e[e.U32_R=mZ(d1.U32,f1.R,p1.None)]=`U32_R`,e[e.U32_RG=mZ(d1.U32,f1.RG,p1.None)]=`U32_RG`,e[e.U32_RGB=mZ(d1.U32,f1.RGB,p1.None)]=`U32_RGB`,e[e.U32_RGBA=mZ(d1.U32,f1.RGBA,p1.None)]=`U32_RGBA`,e[e.S8_R=mZ(d1.S8,f1.R,p1.None)]=`S8_R`,e[e.S8_R_NORM=mZ(d1.S8,f1.R,p1.Normalized)]=`S8_R_NORM`,e[e.S8_RG_NORM=mZ(d1.S8,f1.RG,p1.Normalized)]=`S8_RG_NORM`,e[e.S8_RGB_NORM=mZ(d1.S8,f1.RGB,p1.Normalized)]=`S8_RGB_NORM`,e[e.S8_RGBA_NORM=mZ(d1.S8,f1.RGBA,p1.Normalized)]=`S8_RGBA_NORM`,e[e.S16_R=mZ(d1.S16,f1.R,p1.None)]=`S16_R`,e[e.S16_RG=mZ(d1.S16,f1.RG,p1.None)]=`S16_RG`,e[e.S16_RG_NORM=mZ(d1.S16,f1.RG,p1.Normalized)]=`S16_RG_NORM`,e[e.S16_RGB_NORM=mZ(d1.S16,f1.RGB,p1.Normalized)]=`S16_RGB_NORM`,e[e.S16_RGBA=mZ(d1.S16,f1.RGBA,p1.None)]=`S16_RGBA`,e[e.S16_RGBA_NORM=mZ(d1.S16,f1.RGBA,p1.Normalized)]=`S16_RGBA_NORM`,e[e.S32_R=mZ(d1.S32,f1.R,p1.None)]=`S32_R`,e[e.S32_RG=mZ(d1.S32,f1.RG,p1.None)]=`S32_RG`,e[e.S32_RGB=mZ(d1.S32,f1.RGB,p1.None)]=`S32_RGB`,e[e.S32_RGBA=mZ(d1.S32,f1.RGBA,p1.None)]=`S32_RGBA`,e[e.U16_RGBA_5551=mZ(d1.U16_PACKED_5551,f1.RGBA,p1.Normalized)]=`U16_RGBA_5551`,e[e.U16_RGB_565=mZ(d1.U16_PACKED_565,f1.RGB,p1.Normalized)]=`U16_RGB_565`,e[e.BC1=mZ(d1.BC1,f1.RGBA,p1.Normalized)]=`BC1`,e[e.BC1_SRGB=mZ(d1.BC1,f1.RGBA,p1.Normalized|p1.sRGB)]=`BC1_SRGB`,e[e.BC2=mZ(d1.BC2,f1.RGBA,p1.Normalized)]=`BC2`,e[e.BC2_SRGB=mZ(d1.BC2,f1.RGBA,p1.Normalized|p1.sRGB)]=`BC2_SRGB`,e[e.BC3=mZ(d1.BC3,f1.RGBA,p1.Normalized)]=`BC3`,e[e.BC3_SRGB=mZ(d1.BC3,f1.RGBA,p1.Normalized|p1.sRGB)]=`BC3_SRGB`,e[e.BC4_UNORM=mZ(d1.BC4_UNORM,f1.R,p1.Normalized)]=`BC4_UNORM`,e[e.BC4_SNORM=mZ(d1.BC4_SNORM,f1.R,p1.Normalized)]=`BC4_SNORM`,e[e.BC5_UNORM=mZ(d1.BC5_UNORM,f1.RG,p1.Normalized)]=`BC5_UNORM`,e[e.BC5_SNORM=mZ(d1.BC5_SNORM,f1.RG,p1.Normalized)]=`BC5_SNORM`,e[e.D24=mZ(d1.D24,f1.R,p1.Depth)]=`D24`,e[e.D24_S8=mZ(d1.D24S8,f1.RG,p1.Depth|p1.Stencil)]=`D24_S8`,e[e.D32F=mZ(d1.D32F,f1.R,p1.Depth)]=`D32F`,e[e.D32F_S8=mZ(d1.D32FS8,f1.RG,p1.Depth|p1.Stencil)]=`D32F_S8`,e[e.U8_RGB_RT=mZ(d1.U8,f1.RGB,p1.RenderTarget|p1.Normalized)]=`U8_RGB_RT`,e[e.U8_RGBA_RT=mZ(d1.U8,f1.RGBA,p1.RenderTarget|p1.Normalized)]=`U8_RGBA_RT`,e[e.U8_RGBA_RT_SRGB=mZ(d1.U8,f1.RGBA,p1.RenderTarget|p1.Normalized|p1.sRGB)]=`U8_RGBA_RT_SRGB`})($||={}),m1=DZ(0,0,0,0),DZ(0,0,0,1),h1=DZ(1,1,1,0),DZ(1,1,1,1),g1={blendMode:J$.ADD,blendSrcFactor:q$.ONE,blendDstFactor:q$.ZERO},_1={attachmentsState:[{channelWriteMask:a1.ALL,rgbBlendState:g1,alphaBlendState:g1}],blendConstant:EZ(m1),depthWrite:!0,depthCompare:W$.LEQUAL,stencilWrite:!1,stencilFront:{compare:W$.ALWAYS,passOp:o1.KEEP,depthFailOp:o1.KEEP,failOp:o1.KEEP},stencilBack:{compare:W$.ALWAYS,passOp:o1.KEEP,depthFailOp:o1.KEEP,failOp:o1.KEEP},cullMode:K$.NONE,frontFace:G$.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0},VZ({depthCompare:W$.ALWAYS,depthWrite:!1},_1),v1={texture:null,sampler:null,formatKind:s1.Float,dimension:r1.TEXTURE_2D},b1=/([^[]*)(\[[0-9]+\])?/,x1={},S1={},C1={},w1=[0],T1=(y1={},y1[Q.FLOAT]=mQ.bind(null,`uniform1fv`,vQ,1,hQ),y1[Q.FLOAT_VEC2]=mQ.bind(null,`uniform2fv`,vQ,2,hQ),y1[Q.FLOAT_VEC3]=mQ.bind(null,`uniform3fv`,vQ,3,hQ),y1[Q.FLOAT_VEC4]=mQ.bind(null,`uniform4fv`,vQ,4,hQ),y1[Q.INT]=mQ.bind(null,`uniform1iv`,yQ,1,hQ),y1[Q.INT_VEC2]=mQ.bind(null,`uniform2iv`,yQ,2,hQ),y1[Q.INT_VEC3]=mQ.bind(null,`uniform3iv`,yQ,3,hQ),y1[Q.INT_VEC4]=mQ.bind(null,`uniform4iv`,yQ,4,hQ),y1[Q.BOOL]=mQ.bind(null,`uniform1iv`,yQ,1,hQ),y1[Q.BOOL_VEC2]=mQ.bind(null,`uniform2iv`,yQ,2,hQ),y1[Q.BOOL_VEC3]=mQ.bind(null,`uniform3iv`,yQ,3,hQ),y1[Q.BOOL_VEC4]=mQ.bind(null,`uniform4iv`,yQ,4,hQ),y1[Q.FLOAT_MAT2]=mQ.bind(null,`uniformMatrix2fv`,vQ,4,gQ),y1[Q.FLOAT_MAT3]=mQ.bind(null,`uniformMatrix3fv`,vQ,9,gQ),y1[Q.FLOAT_MAT4]=mQ.bind(null,`uniformMatrix4fv`,vQ,16,gQ),y1[Q.UNSIGNED_INT]=mQ.bind(null,`uniform1uiv`,bQ,1,hQ),y1[Q.UNSIGNED_INT_VEC2]=mQ.bind(null,`uniform2uiv`,bQ,2,hQ),y1[Q.UNSIGNED_INT_VEC3]=mQ.bind(null,`uniform3uiv`,bQ,3,hQ),y1[Q.UNSIGNED_INT_VEC4]=mQ.bind(null,`uniform4uiv`,bQ,4,hQ),y1[Q.FLOAT_MAT2x3]=mQ.bind(null,`uniformMatrix2x3fv`,vQ,6,gQ),y1[Q.FLOAT_MAT2x4]=mQ.bind(null,`uniformMatrix2x4fv`,vQ,8,gQ),y1[Q.FLOAT_MAT3x2]=mQ.bind(null,`uniformMatrix3x2fv`,vQ,6,gQ),y1[Q.FLOAT_MAT3x4]=mQ.bind(null,`uniformMatrix3x4fv`,vQ,12,gQ),y1[Q.FLOAT_MAT4x2]=mQ.bind(null,`uniformMatrix4x2fv`,vQ,8,gQ),y1[Q.FLOAT_MAT4x3]=mQ.bind(null,`uniformMatrix4x3fv`,vQ,12,gQ),y1[Q.SAMPLER_2D]=pQ,y1[Q.SAMPLER_CUBE]=pQ,y1[Q.SAMPLER_3D]=pQ,y1[Q.SAMPLER_2D_SHADOW]=pQ,y1[Q.SAMPLER_2D_ARRAY]=pQ,y1[Q.SAMPLER_2D_ARRAY_SHADOW]=pQ,y1[Q.SAMPLER_CUBE_SHADOW]=pQ,y1[Q.INT_SAMPLER_2D]=pQ,y1[Q.INT_SAMPLER_3D]=pQ,y1[Q.INT_SAMPLER_CUBE]=pQ,y1[Q.INT_SAMPLER_2D_ARRAY]=pQ,y1[Q.UNSIGNED_INT_SAMPLER_2D]=pQ,y1[Q.UNSIGNED_INT_SAMPLER_3D]=pQ,y1[Q.UNSIGNED_INT_SAMPLER_CUBE]=pQ,y1[Q.UNSIGNED_INT_SAMPLER_2D_ARRAY]=pQ,y1),E1={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},D1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,i.device.resourceCreationTracker!==null&&i.device.resourceCreationTracker.trackResourceCreated(i),i}return t.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(dZ),O1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.Bindings;var o=i.uniformBufferBindings,s=i.samplerBindings;return a.uniformBufferBindings=o||[],a.samplerBindings=s||[],a.bindingLayouts=a.createBindingLayouts(),a}return t.prototype.createBindingLayouts=function(){var e=0,t=0,n=[],r=this.uniformBufferBindings.length,i=this.samplerBindings.length;return n.push({firstUniformBuffer:e,numUniformBuffers:r,firstSampler:t,numSamplers:i}),e+=r,t+=i,{numUniformBuffers:e,numSamplers:t,bindingLayoutTables:n}},t}(D1),A1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.Buffer;var o=i.viewOrSize,s=i.usage,c=i.hint,l=c===void 0?e1.STATIC:c,u=r.uniformBufferMaxPageByteSize,d=r.gl,f=s&$$.UNIFORM;f||(kQ(d)?d.bindVertexArray(null):r.OES_vertex_array_object.bindVertexArrayOES(null));var p=UX(o)?jZ(o,4):jZ(o.byteLength,4);a.gl_buffer_pages=[];var m;if(f){for(var h=p;h>0;)a.gl_buffer_pages.push(a.createBufferPage(Math.min(h,u),s,l)),h-=u;m=u}else a.gl_buffer_pages.push(a.createBufferPage(p,s,l)),m=p;return a.pageByteSize=m,a.byteSize=p,a.usage=s,a.gl_target=NQ(s),UX(o)||a.setSubData(0,new Uint8Array(o.buffer)),f||(kQ(d)?d.bindVertexArray(a.device.currentBoundVAO):r.OES_vertex_array_object.bindVertexArrayOES(a.device.currentBoundVAO)),a}return t.prototype.setSubData=function(e,t,n,r){n===void 0&&(n=0),r===void 0&&(r=t.byteLength-n);for(var i=this.device.gl,a=this.pageByteSize,o=e+r,s=e,c=e%a;s<o;){var l=kQ(i)?i.COPY_WRITE_BUFFER:this.gl_target,u=VQ(this,s);if(u.ubo)return;i.bindBuffer(l,u),kQ(i)?i.bufferSubData(l,c,t,n,Math.min(o-s,a)):i.bufferSubData(l,c,t),s+=a,c=0,n+=a,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(e,t,n){var r=this.device.gl,i=t&$$.UNIFORM;if(!kQ(r)&&i)return{ubo:!0};var a=this.device.ensureResourceExists(r.createBuffer()),o=NQ(t),s=MQ(n);return r.bindBuffer(o,a),r.bufferData(o,e,s),a},t}(D1),j1=function(e){JX(t,e);function t(t){var n,r,i,a,o=t.id,s=t.device,c=t.descriptor,l=e.call(this,{id:o,device:s})||this;l.type=U$.InputLayout;var u=c.vertexBufferDescriptors,d=c.indexBufferFormat,f=c.program;SZ(d===$.U16_R||d===$.U32_R||d===null);var p=d===null?null:RQ(d),m=d===null?null:yZ(d),h=l.device.gl,g=l.device.ensureResourceExists(kQ(h)?h.createVertexArray():s.OES_vertex_array_object.createVertexArrayOES());kQ(h)?h.bindVertexArray(g):s.OES_vertex_array_object.bindVertexArrayOES(g),h.bindBuffer(h.ARRAY_BUFFER,VQ(l.device.fallbackVertexBuffer));try{for(var _=QX(c.vertexBufferDescriptors),v=_.next();!v.done;v=_.next()){var y=v.value,b=y.stepMode,x=y.attributes;try{for(var S=(i=void 0,QX(x)),C=S.next();!C.done;C=S.next()){var w=C.value,E=w.shaderLocation,D=w.format,O=w.divisor,k=O===void 0?1:O,A=kQ(h)?E:f.attributes[E]?.location,j=LQ(D);if(w.vertexFormat=j,!zX(A)){jQ(D);var M=j.size,N=j.type,P=j.normalized;h.vertexAttribPointer(A,M,N,P,0,0),b===t1.INSTANCE&&(kQ(h)?h.vertexAttribDivisor(A,k):s.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(A,k)),h.enableVertexAttribArray(A)}}}catch(e){i={error:e}}finally{try{C&&!C.done&&(a=S.return)&&a.call(S)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{v&&!v.done&&(r=_.return)&&r.call(_)}finally{if(n)throw n.error}}return kQ(h)?h.bindVertexArray(null):s.OES_vertex_array_object.bindVertexArrayOES(null),l.vertexBufferDescriptors=u,l.vao=g,l.indexBufferFormat=d,l.indexBufferType=p,l.indexBufferCompByteSize=m,l.program=f,l}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(kQ(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(D1),M1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=t.fake,o=e.call(this,{id:n,device:r})||this;o.type=U$.Texture,i=nZ({dimension:r1.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},i);var s=o.device.gl,c,l,u=o.clampmipLevelCount(i);if(o.immutable=i.usage===i1.RENDER_TARGET,o.pixelStore=i.pixelStore,o.format=i.format,o.dimension=i.dimension,o.formatKind=xZ(i.format),o.width=i.width,o.height=i.height,o.depthOrArrayLayers=i.depthOrArrayLayers,o.mipmaps=u>=1,!a){l=o.device.ensureResourceExists(s.createTexture());var d=o.device.translateTextureType(i.format),f=o.device.translateTextureInternalFormat(i.format);if(o.device.setActiveTexture(s.TEXTURE0),o.device.currentTextures[0]=null,o.preprocessImage(),i.dimension===r1.TEXTURE_2D){if(c=Q.TEXTURE_2D,s.bindTexture(c,l),o.immutable)if(kQ(s))s.texStorage2D(c,u,f,i.width,i.height);else{var p=(f===Q.DEPTH_COMPONENT||o.isNPOT(),0);(o.format===$.D32F||o.format===$.D24_S8)&&!kQ(s)&&!r.WEBGL_depth_texture||(s.texImage2D(c,p,f,i.width,i.height,0,f,d,null),o.mipmaps&&(o.mipmaps=!1,s.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),s.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),s.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE)))}SZ(i.depthOrArrayLayers===1)}else if(i.dimension===r1.TEXTURE_2D_ARRAY)c=Q.TEXTURE_2D_ARRAY,s.bindTexture(c,l),o.immutable&&kQ(s)&&s.texStorage3D(c,u,f,i.width,i.height,i.depthOrArrayLayers);else if(i.dimension===r1.TEXTURE_3D)c=Q.TEXTURE_3D,s.bindTexture(c,l),o.immutable&&kQ(s)&&s.texStorage3D(c,u,f,i.width,i.height,i.depthOrArrayLayers);else if(i.dimension===r1.TEXTURE_CUBE_MAP)c=Q.TEXTURE_CUBE_MAP,s.bindTexture(c,l),o.immutable&&kQ(s)&&s.texStorage2D(c,u,f,i.width,i.height),SZ(i.depthOrArrayLayers===6);else throw Error(`whoops`)}return o.gl_texture=l,o.gl_target=c,o.mipLevelCount=u,o}return t.prototype.setImageData=function(e,t){t===void 0&&(t=0);var n=this.device.gl;AQ(this.format);var r=this.gl_target===Q.TEXTURE_3D||this.gl_target===Q.TEXTURE_2D_ARRAY,i=this.gl_target===Q.TEXTURE_CUBE_MAP,a=SQ(e[0]);this.device.setActiveTexture(n.TEXTURE0),this.device.currentTextures[0]=null;var o=e[0],s,c;a?(s=this.width,c=this.height):(s=o.width,c=o.height,this.width=s,this.height=c),n.bindTexture(this.gl_target,this.gl_texture);var l=this.device.translateTextureFormat(this.format),u=kQ(n)?this.device.translateInternalTextureFormat(this.format):l,d=this.device.translateTextureType(this.format);this.preprocessImage();for(var f=0;f<this.depthOrArrayLayers;f++){var p=e[f],m=this.gl_target;i&&(m=Q.TEXTURE_CUBE_MAP_POSITIVE_X+f%6),this.immutable?n.texSubImage2D(m,t,0,0,s,c,l,d,p):kQ(n)?r?n.texImage3D(m,t,u,s,c,this.depthOrArrayLayers,0,l,d,p):n.texImage2D(m,t,u,s,c,0,l,d,p):a?n.texImage2D(m,t,l,s,c,0,l,d,p):n.texImage2D(m,t,l,l,d,p)}this.mipmaps&&this.generateMipmap(r)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(HQ(this))},t.prototype.clampmipLevelCount=function(e){if(e.dimension===r1.TEXTURE_2D_ARRAY&&e.depthOrArrayLayers>1&&gZ(e.format)===d1.BC1)for(var t=e.width,n=e.height,r=0;r<e.mipLevelCount;r++){if(t<=2||n<=2)return r-1;t=Math.max(t/2|0,1),n=Math.max(n/2|0,1)}return e.mipLevelCount},t.prototype.preprocessImage=function(){var e=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&e.pixelStorei(Q.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&e.pixelStorei(Q.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&e.pixelStorei(Q.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(e){e===void 0&&(e=!1);var t=this.device.gl;return!kQ(t)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(t.bindTexture(this.gl_target,this.gl_texture),e?(t.texParameteri(this.gl_target,Q.TEXTURE_BASE_LEVEL,0),t.texParameteri(this.gl_target,Q.TEXTURE_MAX_LEVEL,Math.log2(this.width)),t.texParameteri(this.gl_target,Q.TEXTURE_MIN_FILTER,Q.LINEAR_MIPMAP_LINEAR),t.texParameteri(this.gl_target,Q.TEXTURE_MAG_FILTER,Q.LINEAR)):t.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.NEAREST_MIPMAP_LINEAR),t.generateMipmap(this.gl_target),t.bindTexture(this.gl_target,null)),this},t.prototype.isNPOT=function(){var e=this.device.gl;return kQ(e)?!1:!OZ(this.width)||!OZ(this.height)},t}(D1),N1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.RenderTarget,a.gl_renderbuffer=null,a.texture=null;var o=a.device.gl,s=i.format,c=i.width,l=i.height,u=i.sampleCount,d=u===void 0?1:u,f=i.texture,p=!1;if((s===$.D32F||s===$.D24_S8)&&f&&!kQ(o)&&!r.WEBGL_depth_texture&&(f.destroy(),a.texture=null,p=!0),!p&&f)a.texture=f;else{a.gl_renderbuffer=a.device.ensureResourceExists(o.createRenderbuffer()),o.bindRenderbuffer(o.RENDERBUFFER,a.gl_renderbuffer);var m=a.device.translateTextureInternalFormat(s,!0);kQ(o)&&d>1?o.renderbufferStorageMultisample(Q.RENDERBUFFER,d,m,c,l):o.renderbufferStorage(Q.RENDERBUFFER,m,c,l)}return a.format=s,a.width=c,a.height=l,a.sampleCount=d,a}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(D1),(function(e){e[e.NeedsCompile=0]=`NeedsCompile`,e[e.Compiling=1]=`Compiling`,e[e.NeedsBind=2]=`NeedsBind`,e[e.ReadyToUse=3]=`ReadyToUse`})(P1||={}),F1=function(e){JX(t,e);function t(t,n){var r=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:r,device:i})||this;o.rawVertexGLSL=n,o.type=U$.Program,o.uniformSetters={},o.attributes=[];var s=o.device.gl;return o.descriptor=a,o.gl_program=o.device.ensureResourceExists(s.createProgram()),o.gl_shader_vert=null,o.gl_shader_frag=null,o.compileState=P1.NeedsCompile,o.tryCompileProgram(),o}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){SZ(this.compileState===P1.NeedsCompile);var e=this.descriptor,t=e.vertex,n=e.fragment,r=this.device.gl;t?.glsl&&n?.glsl&&(this.gl_shader_vert=this.compileShader(t.postprocess?t.postprocess(t.glsl):t.glsl,r.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,r.FRAGMENT_SHADER),r.attachShader(this.gl_program,this.gl_shader_vert),r.attachShader(this.gl_program,this.gl_shader_frag),r.linkProgram(this.gl_program),this.compileState=P1.Compiling,kQ(r)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_ATTRIBUTES),n=wQ(this.descriptor.vertex.glsl),r=TQ(this.rawVertexGLSL,n),i=function(t){var n=e.getActiveAttrib(a.gl_program,t),i=n.name,o=n.type,s=n.size,c=e.getAttribLocation(a.gl_program,i),l=r.find(function(e){return e.name===i})?.location;c>=0&&!zX(l)&&(a.attributes[l]={name:i,location:c,type:o,size:s})},a=this,o=0;o<t;o++)i(o)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),n=0;n<t;n++){var r=e.getActiveUniform(this.gl_program,n),i=fQ(r.name).name,a=e.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=xQ(e,a,r),r&&r.size>1)for(var o=0;o<r.size;o++)a=e.getUniformLocation(this.gl_program,`${i}[${o}]`),this.uniformSetters[`${i}[${o}]`]=xQ(e,a,r)}},t.prototype.compileShader=function(e,t){var n=this.device.gl,r=this.device.ensureResourceExists(n.createShader(t));return n.shaderSource(r,e),n.compileShader(r),r},t.prototype.setUniformsLegacy=function(e){e===void 0&&(e={});var t=this.device.gl;if(!kQ(t)){var n=!1;for(var r in e){n||=(t.useProgram(this.gl_program),!0);var i=e[r],a=this.uniformSetters[r];if(a){var o=i;o instanceof M1&&(o=o.textureIndex),a(o)}}}return this},t}(D1),I1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.QueryPool;var o=a.device.gl;if(kQ(o)){var s=i.elemCount,c=i.type;a.gl_query=MZ(s,function(){return a.device.ensureResourceExists(o.createQuery())}),a.gl_query_type=qQ(c)}return a}return t.prototype.queryResultOcclusion=function(e){var t=this.device.gl;if(kQ(t)){var n=this.gl_query[e];return t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE)?!!t.getQueryParameter(n,t.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(kQ(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},t}(D1),L1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=U$.Readback,i.gl_pbo=null,i.gl_sync=null,i}return t.prototype.clientWaitAsync=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=10);var r=this.device.gl;return new Promise(function(i,a){function o(){var s=r.clientWaitSync(e,t,0);if(s==r.WAIT_FAILED){a();return}if(s==r.TIMEOUT_EXPIRED){setTimeout(o,VX(n,0,r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}i()}o()})},t.prototype.getBufferSubDataAsync=function(e,t,n,r,i,a){return XX(this,void 0,void 0,function(){var o;return ZX(this,function(s){switch(s.label){case 0:return o=this.device.gl,kQ(o)?(this.gl_sync=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0),o.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return s.sent(),o.bindBuffer(e,t),o.getBufferSubData(e,n,r,i,a),o.bindBuffer(e,null),[2,r];case 2:return[2]}})})},t.prototype.readTexture=function(e,t,n,r,i,a,o,s){return o===void 0&&(o=0),s===void 0&&(s=a.byteLength||0),XX(this,void 0,void 0,function(){var c,l,u,d,f;return ZX(this,function(p){return c=this.device.gl,l=e,u=this.device.translateTextureFormat(l.format),d=this.device.translateTextureType(l.format),f=bZ(l.format),kQ(c)?(this.gl_pbo=this.device.ensureResourceExists(c.createBuffer()),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.bufferData(c.PIXEL_PACK_BUFFER,s,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.bindFramebuffer(Q.READ_FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(Q.READ_FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,l.gl_texture,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.readPixels(t,n,r,i,u,d,o*f),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(c.PIXEL_PACK_BUFFER,this.gl_pbo,0,a,o,0)]):[2,this.readTextureSync(e,t,n,r,i,a,o,s)]})})},t.prototype.readTextureSync=function(e,t,n,r,i,a,o,s){s===void 0&&(s=a.byteLength||0);var c=this.device.gl,l=e,u=this.device.translateTextureType(l.format);return c.bindFramebuffer(Q.FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,l.gl_texture,0),c.pixelStorei(c.PACK_ALIGNMENT,4),c.readPixels(t,n,r,i,c.RGBA,u,a),a},t.prototype.readBuffer=function(e,t,n,r,i){return XX(this,void 0,void 0,function(){var a;return ZX(this,function(o){return a=this.device.gl,kQ(a)?[2,this.getBufferSubDataAsync(a.ARRAY_BUFFER,VQ(e,t),t,n,r,i)]:[2,Promise.reject()]})})},t.prototype.destroy=function(){e.prototype.destroy.call(this),kQ(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(D1),R1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=U$.RenderPipeline,a.drawMode=PQ(i.topology??Q$.TRIANGLES),a.program=i.program,a.inputLayout=i.inputLayout,a.megaState=nZ(nZ({},BZ(_1)),i.megaStateDescriptor),a.colorAttachmentFormats=i.colorAttachmentFormats.slice(),a.depthStencilAttachmentFormat=i.depthStencilAttachmentFormat,a.sampleCount=i.sampleCount??1,a}return t}(D1),z1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=U$.ComputePipeline,a.descriptor=i,a}return t}(D1),B1=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(e){this.creationStacks.set(e,Error().stack),this.liveObjects.add(e)},e.prototype.trackResourceDestroyed=function(e){this.deletionStacks.has(e)&&console.warn(`Object double freed:`,e,`

Creation stack: `,this.creationStacks.get(e),`

Deletion stack: `,this.deletionStacks.get(e),`

This stack: `,Error().stack),this.deletionStacks.set(e,Error().stack),this.liveObjects.delete(e)},e.prototype.checkForLeaks=function(){var e,t;try{for(var n=QX(this.liveObjects.values()),r=n.next();!r.done;r=n.next()){var i=r.value;console.warn(`Object leaked:`,i,`Creation stack:`,this.creationStacks.get(i))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setResourceLeakCheck=function(e,t){t?this.liveObjects.add(e):this.liveObjects.delete(e)},e}(),V1=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.Sampler;var o=a.device.gl;if(kQ(o)){var s=a.device.ensureResourceExists(o.createSampler());o.samplerParameteri(s,Q.TEXTURE_WRAP_S,zQ(i.addressModeU)),o.samplerParameteri(s,Q.TEXTURE_WRAP_T,zQ(i.addressModeV)),o.samplerParameteri(s,Q.TEXTURE_WRAP_R,zQ(i.addressModeW??i.addressModeU)),o.samplerParameteri(s,Q.TEXTURE_MIN_FILTER,BQ(i.minFilter,i.mipmapFilter)),o.samplerParameteri(s,Q.TEXTURE_MAG_FILTER,BQ(i.magFilter,Z$.NO_MIP)),i.lodMinClamp!==void 0&&o.samplerParameterf(s,Q.TEXTURE_MIN_LOD,i.lodMinClamp),i.lodMaxClamp!==void 0&&o.samplerParameterf(s,Q.TEXTURE_MAX_LOD,i.lodMaxClamp),i.compareFunction!==void 0&&(o.samplerParameteri(s,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE),o.samplerParameteri(s,o.TEXTURE_COMPARE_FUNC,i.compareFunction));var c=i.maxAnisotropy??1;c>1&&a.device.EXT_texture_filter_anisotropic!==null&&(SZ(i.minFilter===X$.BILINEAR&&i.magFilter===X$.BILINEAR&&i.mipmapFilter===Z$.LINEAR),o.samplerParameterf(s,a.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c)),a.gl_sampler=s}else a.descriptor=i;return a}return t.prototype.setTextureParameters=function(e,t,n){var r=this.device.gl,i=this.descriptor;this.isNPOT(t,n)?r.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR):r.texParameteri(e,Q.TEXTURE_MIN_FILTER,BQ(i.minFilter,i.mipmapFilter)),r.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,zQ(i.addressModeU)),r.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,zQ(i.addressModeV)),r.texParameteri(e,Q.TEXTURE_MAG_FILTER,BQ(i.magFilter,Z$.NO_MIP));var a=i.maxAnisotropy??1;a>1&&this.device.EXT_texture_filter_anisotropic!==null&&(SZ(i.minFilter===X$.BILINEAR&&i.magFilter===X$.BILINEAR&&i.mipmapFilter===Z$.LINEAR),r.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a))},t.prototype.destroy=function(){e.prototype.destroy.call(this),kQ(this.device.gl)&&this.device.gl.deleteSampler(UQ(this))},t.prototype.isNPOT=function(e,t){return!OZ(e)||!OZ(t)},t}(D1),H1=function(){function e(){}return e.prototype.dispatchWorkgroups=function(e,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(e,t){},e.prototype.setPipeline=function(e){},e.prototype.setBindings=function(e){},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e}(),U1=function(e){JX(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;return t.type=U$.RenderBundle,t.commands=[],t}return t.prototype.push=function(e){this.commands.push(e)},t.prototype.replay=function(){this.commands.forEach(function(e){return e()})},t}(D1),W1=65536,G1=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,K1=function(){function e(e,t){t===void 0&&(t={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=BZ(_1),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=c1.LOWER_LEFT,this.clipSpaceNearZ=l1.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=e,this.contextAttributes=CZ(e.getContextAttributes()),kQ(e)?(this.EXT_texture_norm16=e.getExtension(`EXT_texture_norm16`),this.EXT_color_buffer_float=e.getExtension(`EXT_color_buffer_float`)):(this.OES_vertex_array_object=e.getExtension(`OES_vertex_array_object`),this.ANGLE_instanced_arrays=e.getExtension(`ANGLE_instanced_arrays`),this.OES_texture_float=e.getExtension(`OES_texture_float`),this.WEBGL_draw_buffers=e.getExtension(`WEBGL_draw_buffers`),this.WEBGL_depth_texture=e.getExtension(`WEBGL_depth_texture`),this.WEBGL_color_buffer_float=e.getExtension(`WEBGL_color_buffer_float`),this.EXT_color_buffer_half_float=e.getExtension(`EXT_color_buffer_half_float`),e.getExtension(`EXT_frag_depth`),e.getExtension(`OES_element_index_uint`),e.getExtension(`OES_standard_derivatives`)),this.WEBGL_compressed_texture_s3tc=e.getExtension(`WEBGL_compressed_texture_s3tc`),this.WEBGL_compressed_texture_s3tc_srgb=e.getExtension(`WEBGL_compressed_texture_s3tc_srgb`),this.EXT_texture_compression_rgtc=e.getExtension(`EXT_texture_compression_rgtc`),this.EXT_texture_filter_anisotropic=e.getExtension(`EXT_texture_filter_anisotropic`),this.EXT_texture_norm16=e.getExtension(`EXT_texture_norm16`),this.OES_texture_float_linear=e.getExtension(`OES_texture_float_linear`),this.OES_texture_half_float_linear=e.getExtension(`OES_texture_half_float_linear`),this.KHR_parallel_shader_compile=e.getExtension(`KHR_parallel_shader_compile`),kQ(e)?(this.platformString=`WebGL2`,this.glslVersion=`#version 300 es`):(this.platformString=`WebGL1`,this.glslVersion=`#version 100`),this.scTexture=new M1({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:r1.TEXTURE_2D,mipLevelCount:1,usage:i1.RENDER_TARGET,format:this.contextAttributes.alpha===!1?$.U8_RGB_RT:$.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=s1.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(r1.TEXTURE_2D,s1.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(r1.TEXTURE_2D,s1.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:$$.VERTEX,hint:e1.STATIC}),kQ(e)&&(this.fallbackTexture2DArray=this.createFallbackTexture(r1.TEXTURE_2D_ARRAY,s1.Float),this.fallbackTexture3D=this.createFallbackTexture(r1.TEXTURE_3D,s1.Float),this.fallbackTextureCube=this.createFallbackTexture(r1.TEXTURE_CUBE_MAP,s1.Float)),this.currentMegaState.depthCompare=W$.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=a1.ALL,e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new B1)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(e,t){var n=e===r1.TEXTURE_CUBE_MAP?6:1,r=t===s1.Depth?$.D32F:$.U8_RGBA_NORM,i=this.createTexture({dimension:e,format:r,usage:i1.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===s1.Float&&i.setImageData([new Uint8Array(4*n)]),HQ(i)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var e=this.gl;if(this.maxVertexAttribs=e.getParameter(Q.MAX_VERTEX_ATTRIBS),kQ(e)){this.uniformBufferMaxPageByteSize=Math.min(e.getParameter(Q.MAX_UNIFORM_BLOCK_SIZE),W1),this.uniformBufferWordAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=e.getInternalformatParameter(e.RENDERBUFFER,e.DEPTH32F_STENCIL8,e.SAMPLES);this.supportedSampleCounts=t?eZ([],$X(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=W1;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(e,t){return e-t})},e.prototype.configureSwapChain=function(e,t,n){var r=this.scTexture;r.width=e,r.height=t,this.scPlatformFramebuffer=AZ(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(e,t){switch(t===void 0&&(t=!1),e){case $.ALPHA:return Q.ALPHA;case $.U8_LUMINANCE:case $.F16_LUMINANCE:case $.F32_LUMINANCE:return Q.LUMINANCE;case $.F16_R:return Q.R16F;case $.F16_RG:return Q.RG16F;case $.F16_RGB:return Q.RGB16F;case $.F16_RGBA:return Q.RGBA16F;case $.F32_R:return Q.R32F;case $.F32_RG:return Q.RG32F;case $.F32_RGB:return Q.RGB32F;case $.F32_RGBA:return kQ(this.gl)?Q.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:Q.RGBA;case $.U8_R_NORM:return Q.R8;case $.U8_RG_NORM:return Q.RG8;case $.U8_RGB_NORM:case $.U8_RGB_RT:return Q.RGB8;case $.U8_RGB_SRGB:return Q.SRGB8;case $.U8_RGBA_NORM:case $.U8_RGBA_RT:return kQ(this.gl)?Q.RGBA8:t?Q.RGBA4:Q.RGBA;case $.U8_RGBA:return Q.RGBA;case $.U8_RGBA_SRGB:case $.U8_RGBA_RT_SRGB:return Q.SRGB8_ALPHA8;case $.U16_R:return Q.R16UI;case $.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case $.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case $.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case $.U16_RGBA_5551:return Q.RGB5_A1;case $.U16_RGB_565:return Q.RGB565;case $.U32_R:return Q.R32UI;case $.S8_RGBA_NORM:return Q.RGBA8_SNORM;case $.S8_RG_NORM:return Q.RG8_SNORM;case $.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case $.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case $.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case $.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case $.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case $.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case $.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case $.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case $.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case $.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case $.D32F_S8:return kQ(this.gl)?Q.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?Q.DEPTH_STENCIL:Q.DEPTH_COMPONENT16;case $.D24_S8:return kQ(this.gl)?Q.DEPTH24_STENCIL8:this.WEBGL_depth_texture?Q.DEPTH_STENCIL:Q.DEPTH_COMPONENT16;case $.D32F:return kQ(this.gl)?Q.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?Q.DEPTH_COMPONENT:Q.DEPTH_COMPONENT16;case $.D24:return kQ(this.gl)?Q.DEPTH_COMPONENT24:this.WEBGL_depth_texture?Q.DEPTH_COMPONENT:Q.DEPTH_COMPONENT16;default:throw Error(`whoops`)}},e.prototype.translateTextureType=function(e){switch(gZ(e)){case d1.U8:return Q.UNSIGNED_BYTE;case d1.U16:return Q.UNSIGNED_SHORT;case d1.U32:return Q.UNSIGNED_INT;case d1.S8:return Q.BYTE;case d1.F16:return Q.HALF_FLOAT;case d1.F32:return Q.FLOAT;case d1.U16_PACKED_5551:return Q.UNSIGNED_SHORT_5_5_5_1;case d1.D32F:return kQ(this.gl)?Q.FLOAT:this.WEBGL_depth_texture?Q.UNSIGNED_INT:Q.UNSIGNED_BYTE;case d1.D24:return kQ(this.gl)?Q.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Q.UNSIGNED_SHORT:Q.UNSIGNED_BYTE;case d1.D24S8:return kQ(this.gl)?Q.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Q.UNSIGNED_INT_24_8_WEBGL:Q.UNSIGNED_BYTE;case d1.D32FS8:return Q.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw Error(`whoops`)}},e.prototype.translateInternalTextureFormat=function(e){switch(e){case $.F32_R:return Q.R32F;case $.F32_RG:return Q.RG32F;case $.F32_RGB:return Q.RGB32F;case $.F32_RGBA:return Q.RGBA32F;case $.F16_R:return Q.R16F;case $.F16_RG:return Q.RG16F;case $.F16_RGB:return Q.RGB16F;case $.F16_RGBA:return Q.RGBA16F}return this.translateTextureFormat(e)},e.prototype.translateTextureFormat=function(e){if(AQ(e)||e===$.F32_LUMINANCE||e===$.U8_LUMINANCE)return this.translateTextureInternalFormat(e);var t=kQ(this.gl)||!kQ(this.gl)&&!!this.WEBGL_depth_texture;switch(e){case $.D24_S8:case $.D32F_S8:return t?Q.DEPTH_STENCIL:Q.RGBA;case $.D24:case $.D32F:return t?Q.DEPTH_COMPONENT:Q.RGBA}var n=jQ(e);switch(hZ(e)){case f1.A:return Q.ALPHA;case f1.R:return n?Q.RED_INTEGER:Q.RED;case f1.RG:return n?Q.RG_INTEGER:Q.RG;case f1.RGB:return n?Q.RGB_INTEGER:Q.RGB;case f1.RGBA:return Q.RGBA}},e.prototype.setActiveTexture=function(e){this.currentActiveTexture!==e&&(this.gl.activeTexture(e),this.currentActiveTexture=e)},e.prototype.bindVAO=function(e){this.currentBoundVAO!==e&&(kQ(this.gl)?this.gl.bindVertexArray(e):this.OES_vertex_array_object.bindVertexArrayOES(e),this.currentBoundVAO=e)},e.prototype.programCompiled=function(e){SZ(e.compileState!==P1.NeedsCompile),e.compileState===P1.Compiling&&(e.compileState=P1.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(e))},e.prototype.useProgram=function(e){this.currentProgram!==e&&(this.programCompiled(e),this.gl.useProgram(e.gl_program),this.currentProgram=e)},e.prototype.ensureResourceExists=function(e){if(e===null){var t=this.gl.getError();throw Error(`Created resource is null; GL error encountered: ${t}`)}else return e},e.prototype.createBuffer=function(e){return new A1({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new M1({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new V1({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){return new N1({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height,a=t.mipLevelCount;return SZ(a===1),this.createRenderTarget({format:n,width:r,height:i,sampleCount:1,texture:e})},e.prototype.createProgram=function(e){var t=e.vertex?.glsl;return e.vertex?.glsl&&(e.vertex.glsl=OQ(this.queryVendorInfo(),`vert`,e.vertex.glsl)),e.fragment?.glsl&&(e.fragment.glsl=OQ(this.queryVendorInfo(),`frag`,e.fragment.glsl)),this.createProgramSimple(e,t)},e.prototype.createProgramSimple=function(e,t){return new F1({id:this.getNextUniqueId(),device:this,descriptor:e},t)},e.prototype.createBindings=function(e){return new O1({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new j1({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new R1({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePass=function(){return new H1},e.prototype.createComputePipeline=function(e){return new z1({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createReadback=function(){return new L1({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(e,t){return new I1({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(e){var t=e.colorAttachment;e.depthClearValue=e.depthClearValue??`load`,e.stencilClearValue=e.stencilClearValue??`load`;for(var n=0;n<t.length;n++)e.colorAttachmentLevel||=[],e.colorAttachmentLevel[n]=e.colorAttachmentLevel[n]??0,e.colorResolveToLevel||=[],e.colorResolveToLevel[n]=e.colorResolveToLevel[n]??0,e.colorClearColor||=[],e.colorClearColor[n]=e.colorClearColor[n]??`load`,e.colorStore||=[],e.colorStore[n]=e.colorStore[n]??!1},e.prototype.createRenderBundle=function(){return new U1({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(e){e.forEach(function(e){e.replay()})},e.prototype.createRenderPass=function(e){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=e,this.formatRenderPassDescriptor(e);var t=e.colorAttachment,n=e.colorAttachmentLevel,r=e.colorClearColor,i=e.colorResolveTo,a=e.colorResolveToLevel,o=e.depthStencilAttachment,s=e.depthClearValue,c=e.stencilClearValue,l=e.depthStencilResolveTo,u=i&&i.length===1&&i[0]===this.scTexture;this.setRenderPassParametersBegin(t.length,u);for(var d=0;d<t.length;d++)this.setRenderPassParametersColor(d,t[d],n[d],i[d],a[d],u);this.setRenderPassParametersDepthStencil(o,l,u),this.validateCurrentAttachments();for(var d=0;d<t.length;d++){var f=r[d];f!==`load`&&this.setRenderPassParametersClearColor(d,f.r,f.g,f.b,f.a)}return this.setRenderPassParametersClearDepthStencil(s,c),this},e.prototype.submitPass=function(e){SZ(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(e,t,n,r,i,a){var o=this.gl,s=e,c=r;if(SZ(c.mipLevelCount===1),SZ(s.mipLevelCount===1),kQ(o))s===this.scTexture?o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,s,0)),o.bindFramebuffer(o.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,c,0),o.blitFramebuffer(i,a,i+c.width,a+c.height,t,n,t+c.width,n+c.height,o.COLOR_BUFFER_BIT,o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,null);else if(s===this.scTexture){var l=this.createRenderTargetFromTexture(r);this.submitBlitRenderPass(l,s)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(e,t,n){switch(e){case $.BC1_SRGB:case $.BC2_SRGB:case $.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb===null?!1:YQ(t,n,4,4);case $.BC1:case $.BC2:case $.BC3:return this.WEBGL_compressed_texture_s3tc===null?!1:YQ(t,n,4,4);case $.BC4_UNORM:case $.BC4_SNORM:case $.BC5_UNORM:case $.BC5_SNORM:return this.EXT_texture_compression_rgtc===null?!1:YQ(t,n,4,4);case $.U16_R_NORM:case $.U16_RG_NORM:case $.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case $.F32_R:case $.F32_RG:case $.F32_RGB:case $.F32_RGBA:return this.OES_texture_float_linear!==null;case $.F16_R:case $.F16_RG:case $.F16_RGB:case $.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(e){var t=this.gl;if(e.compileState===P1.NeedsCompile)throw Error(`whoops`);if(e.compileState===P1.Compiling){var n=void 0;return n=this.KHR_parallel_shader_compile===null?!0:t.getProgramParameter(e.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR),n&&this.programCompiled(e),n}return e.compileState===P1.NeedsBind||e.compileState===P1.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===U$.Buffer)for(var n=e.gl_buffer_pages,r=0;r<n.length;r++)WQ(n[r],`${t} Page ${r}`);else if(e.type===U$.Texture)WQ(HQ(e),t);else if(e.type===U$.Sampler)WQ(UQ(e),t);else if(e.type===U$.RenderTarget){var i=e.gl_renderbuffer;i!==null&&WQ(i,t)}else e.type===U$.InputLayout&&WQ(e.vao,t)},e.prototype.setResourceLeakCheck=function(e,t){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(e,t)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e.prototype.programPatched=function(e,t){SZ(this.shaderDebug)},e.prototype.getBufferData=function(e,t,n){n===void 0&&(n=0);var r=this.gl;kQ(r)&&(r.bindBuffer(r.COPY_READ_BUFFER,VQ(e,n*4)),r.getBufferSubData(r.COPY_READ_BUFFER,n*4,t))},e.prototype.debugGroupStatisticsDrawCall=function(e){e===void 0&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=e},e.prototype.debugGroupStatisticsBufferUpload=function(e){e===void 0&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=e},e.prototype.debugGroupStatisticsTextureBind=function(e){e===void 0&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=e},e.prototype.debugGroupStatisticsTriangles=function(e){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=e},e.prototype.reportShaderError=function(e,t){var n=this.gl,r=n.getShaderParameter(e,n.COMPILE_STATUS);if(!r){console.error(NZ(t));var i=n.getExtension(`WEBGL_debug_shaders`);i&&console.error(i.getTranslatedShaderSource(e)),console.error(n.getShaderInfoLog(e))}return r},e.prototype.checkProgramCompilationForErrors=function(e){var t=this.gl,n=e.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var r=e.descriptor;if(!this.reportShaderError(e.gl_shader_vert,r.vertex.glsl)||!this.reportShaderError(e.gl_shader_frag,r.fragment.glsl))return;console.error(t.getProgramInfoLog(e.gl_program))}},e.prototype.bindFramebufferAttachment=function(e,t,n,r){var i=this.gl;if(zX(n))i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,null);else if(n.type===U$.RenderTarget)n.gl_renderbuffer===null?n.texture!==null&&i.framebufferTexture2D(e,t,Q.TEXTURE_2D,HQ(n.texture),r):i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,n.gl_renderbuffer);else if(n.type===U$.Texture){var a=HQ(n);n.dimension===r1.TEXTURE_2D?i.framebufferTexture2D(e,t,Q.TEXTURE_2D,a,r):kQ(i)&&(n.dimension,r1.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(e,t){var n=this.gl,r=zX(t)?p1.Depth|p1.Stencil:_Z(t.format),i=!!(r&p1.Depth),a=!!(r&p1.Stencil);i&&a?kQ(this.gl)||!kQ(this.gl)&&this.WEBGL_depth_texture?this.bindFramebufferAttachment(e,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0):i?(this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,null,0)):a&&(this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var e=-1,t=-1,n=-1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];i!==null&&(e===-1?(e=i.sampleCount,t=i.width,n=i.height):(SZ(e===i.sampleCount),SZ(t===i.width),SZ(n===i.height)))}this.currentDepthStencilAttachment&&(e===-1?e=this.currentDepthStencilAttachment.sampleCount:(SZ(e===this.currentDepthStencilAttachment.sampleCount),SZ(t===this.currentDepthStencilAttachment.width),SZ(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=e},e.prototype.setRenderPassParametersBegin=function(e,t){t===void 0&&(t=!1);var n=this.gl;if(t)n.bindFramebuffer(Q.FRAMEBUFFER,null);else if(kQ(n)?n.bindFramebuffer(Q.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||n.bindFramebuffer(Q.FRAMEBUFFER,this.renderPassDrawFramebuffer),kQ(n)?n.drawBuffers([Q.COLOR_ATTACHMENT0,Q.COLOR_ATTACHMENT1,Q.COLOR_ATTACHMENT2,Q.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([Q.COLOR_ATTACHMENT0_WEBGL,Q.COLOR_ATTACHMENT1_WEBGL,Q.COLOR_ATTACHMENT2_WEBGL,Q.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var r=e;r<this.currentColorAttachments.length;r++){var i=kQ(n)?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,a=kQ(n)?Q.COLOR_ATTACHMENT0:Q.COLOR_ATTACHMENT0_WEBGL;n.framebufferRenderbuffer(i,a+r,Q.RENDERBUFFER,null),n.framebufferTexture2D(i,a+r,Q.TEXTURE_2D,null,0)}this.currentColorAttachments.length=e},e.prototype.setRenderPassParametersColor=function(e,t,n,r,i,a){a===void 0&&(a=!1);var o=this.gl,s=kQ(o);(this.currentColorAttachments[e]!==t||this.currentColorAttachmentLevels[e]!==n)&&(this.currentColorAttachments[e]=t,this.currentColorAttachmentLevels[e]=n,!a&&(s||!s&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(s?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,(s?Q.COLOR_ATTACHMENT0:Q.COLOR_ATTACHMENT0_WEBGL)+e,t,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[e]!==r||this.currentColorResolveToLevels[e]!==i)&&(this.currentColorResolveTos[e]=r,this.currentColorResolveToLevels[e]=i,r!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(e,t,n){n===void 0&&(n=!1);var r=this.gl;this.currentDepthStencilAttachment!==e&&(this.currentDepthStencilAttachment=e,!n&&!this.inBlitRenderPass&&this.bindFramebufferDepthStencilAttachment(kQ(r)?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(e,t,n,r,i){var a=this.gl;if(this.OES_draw_buffers_indexed!==null){var o=this.currentMegaState.attachmentsState[e];o&&o.channelWriteMask!==a1.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(e,!0,!0,!0,!0),o.channelWriteMask=a1.ALL)}else{var o=this.currentMegaState.attachmentsState[0];o&&o.channelWriteMask!==a1.ALL&&(a.colorMask(!0,!0,!0,!0),o.channelWriteMask=a1.ALL)}this.setScissorRectEnabled(!1),kQ(a)?a.clearBufferfv(a.COLOR,e,[t,n,r,i]):(a.clearColor(t,n,r,i),a.clear(a.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(e,t){e===void 0&&(e=`load`),t===void 0&&(t=`load`);var n=this.gl;e!==`load`&&(SZ(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),kQ(n)?n.clearBufferfv(n.DEPTH,0,[e]):(n.clearDepth(e),n.clear(n.DEPTH_BUFFER_BIT))),t!==`load`&&(SZ(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),kQ(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(e){var t=this,n;if(this.renderBundle){this.renderBundle.push(function(){return t.setBindings(e)});return}var r=this.gl,i=e,a=i.uniformBufferBindings,o=i.samplerBindings,s=i.bindingLayouts;SZ(0<s.bindingLayoutTables.length);var c=s.bindingLayoutTables[0];SZ(a.length>=c.numUniformBuffers),SZ(o.length>=c.numSamplers);for(var l=0;l<a.length;l++){var u=a[l];if(u.size!==0){var d=c.firstUniformBuffer+l,f=u.buffer,p=u.offset||0,m=u.size||f.byteSize;if(f!==this.currentUniformBuffers[d]||p!==this.currentUniformBufferByteOffsets[d]||m!==this.currentUniformBufferByteSizes[d]){var h=p%f.pageByteSize,g=f.gl_buffer_pages[p/f.pageByteSize|0];SZ(h+m<=f.pageByteSize),kQ(r)&&r.bindBufferRange(r.UNIFORM_BUFFER,d,g,h,m),this.currentUniformBuffers[d]=f,this.currentUniformBufferByteOffsets[d]=p,this.currentUniformBufferByteSizes[d]=m}}}for(var l=0;l<c.numSamplers;l++){var u=o[l],_=c.firstSampler+l,v=u!==null&&u.sampler!==null?UQ(u.sampler):null,y=u!==null&&u.texture!==null?HQ(u.texture):null;if(this.currentSamplers[_]!==v&&(kQ(r)&&r.bindSampler(_,v),this.currentSamplers[_]=v),this.currentTextures[_]!==y){if(this.setActiveTexture(r.TEXTURE0+_),y!==null){var b=CZ(u).texture,x=b.gl_target,S=b.width,C=b.height;u.texture.textureIndex=_,r.bindTexture(x,y),kQ(r)||(n=u.sampler)==null||n.setTextureParameters(x,S,C),this.debugGroupStatisticsTextureBind()}else{var w=nZ(nZ({},u),v1),E=w.dimension,D=w.formatKind,x=JQ(E);r.bindTexture(x,this.getFallbackTexture(nZ({gl_target:x,formatKind:D},w)))}this.currentTextures[_]=y}}},e.prototype.setViewport=function(e,t,n,r){this.gl.viewport(e,t,n,r)},e.prototype.setScissorRect=function(e,t,n,r){var i=this.gl;this.setScissorRectEnabled(!0),i.scissor(e,t,n,r)},e.prototype.applyAttachmentStateIndexed=function(e,t,n){var r=this.gl,i=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(i.colorMaskiOES(e,!!(n.channelWriteMask&a1.RED),!!(n.channelWriteMask&a1.GREEN),!!(n.channelWriteMask&a1.BLUE),!!(n.channelWriteMask&a1.ALPHA)),t.channelWriteMask=n.channelWriteMask);var a=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,o=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(o||a)&&(KQ(t.rgbBlendState)&&KQ(t.alphaBlendState)?i.enableiOES(e,r.BLEND):KQ(n.rgbBlendState)&&KQ(n.alphaBlendState)&&i.disableiOES(e,r.BLEND)),a&&(i.blendEquationSeparateiOES(e,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),o&&(i.blendFuncSeparateiOES(e,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(e,t){var n=this.gl;e.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&a1.RED),!!(t.channelWriteMask&a1.GREEN),!!(t.channelWriteMask&a1.BLUE),!!(t.channelWriteMask&a1.ALPHA)),e.channelWriteMask=t.channelWriteMask);var r=e.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,i=e.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(i||r)&&(KQ(e.rgbBlendState)&&KQ(e.alphaBlendState)?n.enable(n.BLEND):KQ(t.rgbBlendState)&&KQ(t.alphaBlendState)&&n.disable(n.BLEND)),r&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),e.rgbBlendState.blendMode=t.rgbBlendState.blendMode,e.alphaBlendState.blendMode=t.alphaBlendState.blendMode),i&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(e){var t=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var r=0;r<e.attachmentsState.length;r++)this.applyAttachmentStateIndexed(r,n.attachmentsState[0],e.attachmentsState[0]);else SZ(e.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],e.attachmentsState[0]);wZ(n.blendConstant,e.blendConstant)||(t.blendColor(e.blendConstant.r,e.blendConstant.g,e.blendConstant.b,e.blendConstant.a),TZ(n.blendConstant,e.blendConstant)),n.depthCompare!==e.depthCompare&&(t.depthFunc(e.depthCompare),n.depthCompare=e.depthCompare),!!n.depthWrite!=!!e.depthWrite&&(t.depthMask(e.depthWrite),n.depthWrite=e.depthWrite),!!n.stencilWrite!=!!e.stencilWrite&&(t.stencilMask(e.stencilWrite?255:0),n.stencilWrite=e.stencilWrite);var i=!1;if(!XZ(n.stencilFront,e.stencilFront)){i=!0;var a=e.stencilFront,o=a.passOp,s=a.failOp,c=a.depthFailOp,l=a.compare;(n.stencilFront.passOp!==o||n.stencilFront.failOp!==s||n.stencilFront.depthFailOp!==c)&&(t.stencilOpSeparate(t.FRONT,s,c,o),n.stencilFront.passOp=o,n.stencilFront.failOp=s,n.stencilFront.depthFailOp=c),n.stencilFront.compare!==l&&(this.setStencilReference(0),n.stencilFront.compare=l)}if(!XZ(n.stencilBack,e.stencilBack)){i=!0;var u=e.stencilBack,o=u.passOp,s=u.failOp,c=u.depthFailOp,l=u.compare;(n.stencilBack.passOp!==o||n.stencilBack.failOp!==s||n.stencilBack.depthFailOp!==c)&&(t.stencilOpSeparate(t.BACK,s,c,o),n.stencilBack.passOp=o,n.stencilBack.failOp=s,n.stencilBack.depthFailOp=c),n.stencilBack.compare!==l&&(this.setStencilReference(0),n.stencilBack.compare=l)}(n.stencilFront.mask!==e.stencilFront.mask||n.stencilBack.mask!==e.stencilBack.mask)&&(i=!0,n.stencilFront.mask=e.stencilFront.mask,n.stencilBack.mask=e.stencilBack.mask),i&&this.applyStencil(),n.cullMode!==e.cullMode&&(n.cullMode===K$.NONE?t.enable(t.CULL_FACE):e.cullMode===K$.NONE&&t.disable(t.CULL_FACE),e.cullMode===K$.BACK?t.cullFace(t.BACK):e.cullMode===K$.FRONT?t.cullFace(t.FRONT):e.cullMode===K$.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=e.cullMode),n.frontFace!==e.frontFace&&(t.frontFace(e.frontFace),n.frontFace=e.frontFace),n.polygonOffset!==e.polygonOffset&&(e.polygonOffset?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=e.polygonOffset),(n.polygonOffsetFactor!==e.polygonOffsetFactor||n.polygonOffsetUnits!==e.polygonOffsetUnits)&&(t.polygonOffset(e.polygonOffsetFactor,e.polygonOffsetUnits),n.polygonOffsetFactor=e.polygonOffsetFactor,n.polygonOffsetUnits=e.polygonOffsetUnits)},e.prototype.validatePipelineFormats=function(e){for(var t=0;t<this.currentColorAttachments.length;t++)if(this.currentColorAttachments[t]===null)continue;this.currentDepthStencilAttachment&&SZ(this.currentDepthStencilAttachment.format===e.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&SZ(this.currentSampleCount===e.sampleCount)},e.prototype.setPipeline=function(e){var t=this;if(this.renderBundle){this.renderBundle.push(function(){return t.setPipeline(e)});return}this.currentPipeline=e,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===P1.NeedsBind){var r=this.gl,i=n.gl_program,a=n.descriptor,o=GQ(a.vertex.glsl,G1);if(kQ(r))for(var s=0;s<o.length;s++){var c=$X(o[s],2)[1],l=r.getUniformBlockIndex(i,c);l!==-1&&l!==4294967295&&r.uniformBlockBinding(i,l,s)}for(var u=GQ(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),s=0;s<u.length;s++){var d=$X(u[s],3),f=d[1],p=d[2],m=r.getUniformLocation(i,f);r.uniform1i(m,parseInt(p))}n.compileState=P1.ReadyToUse}},e.prototype.setVertexInput=function(e,t,n){var r,i,a=this;if(this.renderBundle){this.renderBundle.push(function(){return a.setVertexInput(e,t,n)});return}if(e!==null){SZ(this.currentPipeline.inputLayout===e);var o=e;this.bindVAO(o.vao);for(var s=this.gl,c=0;c<o.vertexBufferDescriptors.length;c++){var l=o.vertexBufferDescriptors[c],u=l.arrayStride,d=l.attributes;try{for(var f=(r=void 0,QX(d)),p=f.next();!p.done;p=f.next()){var m=p.value,h=m.shaderLocation,g=m.offset,_=kQ(s)?h:o.program.attributes[h]?.location;if(!zX(_)){var v=t[c];if(v===null)continue;var y=m.vertexFormat;s.bindBuffer(s.ARRAY_BUFFER,VQ(v.buffer));var b=(v.offset||0)+g;s.vertexAttribPointer(_,y.size,y.type,y.normalized,u,b)}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(SZ(n!==null==(o.indexBufferFormat!==null)),n!==null){var x=n.buffer;SZ(x.usage===$$.INDEX),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,VQ(x)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else SZ(this.currentPipeline.inputLayout===null),SZ(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(e){this.currentStencilRef!==e&&(this.currentStencilRef=e,this.applyStencil())},e.prototype.draw=function(e,t,n,r){var i,a=this;if(this.renderBundle){this.renderBundle.push(function(){return a.draw(e,t,n,r)});return}var o=this.gl,s=this.currentPipeline;if(t){var c=[s.drawMode,n||0,e,t];kQ(o)?o.drawArraysInstanced.apply(o,eZ([],$X(c),!1)):(i=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(i,eZ([],$X(c),!1))}else o.drawArrays(s.drawMode,n,e);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))},e.prototype.drawIndexed=function(e,t,n,r,i){var a,o=this;if(this.renderBundle){this.renderBundle.push(function(){return o.drawIndexed(e,t,n,r,i)});return}var s=this.gl,c=this.currentPipeline,l=CZ(c.inputLayout),u=CZ(this.currentIndexBufferByteOffset)+n*l.indexBufferCompByteSize;if(t){var d=[c.drawMode,e,l.indexBufferType,u,t];kQ(s)?s.drawElementsInstanced.apply(s,eZ([],$X(d),!1)):(a=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(a,eZ([],$X(d),!1))}else s.drawElements(c.drawMode,e,l.indexBufferType,u);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))},e.prototype.drawIndirect=function(e,t){},e.prototype.drawIndexedIndirect=function(e,t){},e.prototype.beginOcclusionQuery=function(e){var t=this.gl;if(kQ(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[e])}},e.prototype.endOcclusionQuery=function(){var e=this.gl;if(kQ(e)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;e.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(e){var t=e;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(e){},e.prototype.endPass=function(){for(var e=this.gl,t=kQ(e),n=this.currentColorResolveTos.length===1&&this.currentColorResolveTos[0]===this.scTexture,r=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(a!==null){var o=this.currentColorResolveTos[i],s=!1;o!==null&&(SZ(a.width===o.width&&a.height===o.height),this.setScissorRectEnabled(!1),n||(t&&e.bindFramebuffer(e.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),s=!0,n||(o===this.scTexture?e.bindFramebuffer(t?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,this.scPlatformFramebuffer):(e.bindFramebuffer(t?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&e.framebufferTexture2D(t?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o.gl_texture,this.currentColorResolveToLevels[i]))),n||(t?(e.blitFramebuffer(0,0,a.width,a.height,0,0,o.width,o.height,e.COLOR_BUFFER_BIT,e.LINEAR),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,o)),r=!0),this.currentRenderPassDescriptor.colorStore[i]||!n&&!s&&(e.bindFramebuffer(t?Q.READ_FRAMEBUFFER:Q.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?Q.READ_FRAMEBUFFER:Q.FRAMEBUFFER,e.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),n||e.bindFramebuffer(t?Q.READ_FRAMEBUFFER:Q.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var c=this.currentDepthStencilAttachment;if(c){var l=this.currentDepthStencilResolveTo,s=!1;l&&(SZ(c.width===l.width&&c.height===l.height),this.setScissorRectEnabled(!1),n||(e.bindFramebuffer(t?Q.READ_FRAMEBUFFER:Q.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),e.bindFramebuffer(t?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?Q.READ_FRAMEBUFFER:Q.FRAMEBUFFER,c),this.bindFramebufferDepthStencilAttachment(t?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,l))),s=!0,n||(t&&e.blitFramebuffer(0,0,c.width,c.height,0,0,l.width,l.height,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(t?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,null)),r=!0),!n&&!this.currentRenderPassDescriptor.depthStencilStore&&(s||=(e.bindFramebuffer(t?Q.READ_FRAMEBUFFER:Q.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?Q.READ_FRAMEBUFFER:Q.FRAMEBUFFER,c),!0),t&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[e.DEPTH_STENCIL_ATTACHMENT])),!n&&s&&e.bindFramebuffer(t?Q.READ_FRAMEBUFFER:Q.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}!n&&!r&&e.bindFramebuffer(t?Q.DRAW_FRAMEBUFFER:Q.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(e){if(this.currentScissorEnabled!==e){var t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=e}},e.prototype.applyStencil=function(){zX(this.currentStencilRef)||(this.gl.stencilFuncSeparate(Q.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(Q.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(e){var t=e.gl_target,n=e.formatKind;if(t===Q.TEXTURE_2D)return n===s1.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Q.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Q.TEXTURE_3D)return this.fallbackTexture3D;if(t===Q.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw Error(`whoops`)},e.prototype.submitBlitRenderPass=function(e,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:$$.VERTEX|$$.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:t1.VERTEX,attributes:[{format:$.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:Q$.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[$.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:BZ(_1)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:e.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:e}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var r=this.createRenderPass({colorAttachment:[e],colorResolveTo:[t],colorClearColor:[h1]}),i=this.getCanvas(),a=i.width,o=i.height;r.setPipeline(this.blitRenderPipeline),r.setBindings(this.blitBindings),r.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),r.setViewport(0,0,a,o),this.gl.disable(this.gl.BLEND),r.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),q1=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return XX(this,void 0,void 0,function(){var t,n,r,i,a,o,s,c,l,u,d,f,p;return ZX(this,function(m){return t=this.pluginOptions,n=t.targets,r=t.xrCompatible,i=t.antialias,a=i===void 0?!1:i,o=t.preserveDrawingBuffer,s=o===void 0?!1:o,c=t.premultipliedAlpha,l=c===void 0?!0:c,u=t.shaderDebug,d=t.trackResources,f={antialias:a,preserveDrawingBuffer:s,stencil:!0,premultipliedAlpha:l,xrCompatible:r},this.handleContextEvents(e),n.includes(`webgl2`)&&(p=e.getContext(`webgl2`,f)||e.getContext(`experimental-webgl2`,f)),!p&&n.includes(`webgl1`)&&(p=e.getContext(`webgl`,f)||e.getContext(`experimental-webgl`,f)),[2,new K1(p,{shaderDebug:u,trackResources:d})]})})},e.prototype.handleContextEvents=function(e){var t=this.pluginOptions,n=t.onContextLost,r=t.onContextRestored,i=t.onContextCreationError;i&&e.addEventListener(`webglcontextcreationerror`,i,!1),n&&e.addEventListener(`webglcontextlost`,n,!1),r&&e.addEventListener(`webglcontextrestored`,r,!1)},e}(),Y1=typeof TextDecoder<`u`?new TextDecoder(`utf-8`,{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error(`TextDecoder not available`)}},typeof TextDecoder<`u`&&Y1.decode(),X1=null,Z1=Array(128).fill(void 0),Z1.push(void 0,null,!0,!1),Q1=Z1.length,$1=0,e0=typeof TextEncoder<`u`?new TextEncoder(`utf-8`):{encode:()=>{throw Error(`TextEncoder not available`)}},t0=typeof e0.encodeInto==`function`?function(e,t){return e0.encodeInto(e,t)}:function(e,t){let n=e0.encode(e);return t.set(n),{read:e.length,written:n.length}},n0=null,r0=class e{static __wrap(t){t>>>=0;let n=Object.create(e.prototype);return n.__wbg_ptr=t,n}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){let e=this.__destroy_into_raw();J1.__wbg_wgslcomposer_free(e)}constructor(){let t=J1.wgslcomposer_new();return e.__wrap(t)}load_composable(e){let t=n$(e,J1.__wbindgen_malloc,J1.__wbindgen_realloc),n=$1;J1.wgslcomposer_load_composable(this.__wbg_ptr,t,n)}wgsl_compile(e){let t,n;try{let a=J1.__wbindgen_add_to_stack_pointer(-16),o=n$(e,J1.__wbindgen_malloc,J1.__wbindgen_realloc),s=$1;J1.wgslcomposer_wgsl_compile(a,this.__wbg_ptr,o,s);var r=r$()[a/4+0],i=r$()[a/4+1];return t=r,n=i,ZQ(r,i)}finally{J1.__wbindgen_add_to_stack_pointer(16),J1.__wbindgen_free(t,n,1)}}},(function(e){e[e.COPY_SRC=1]=`COPY_SRC`,e[e.COPY_DST=2]=`COPY_DST`,e[e.TEXTURE_BINDING=4]=`TEXTURE_BINDING`,e[e.STORAGE_BINDING=8]=`STORAGE_BINDING`,e[e.STORAGE=8]=`STORAGE`,e[e.RENDER_ATTACHMENT=16]=`RENDER_ATTACHMENT`})(i0||={}),(function(e){e[e.READ=1]=`READ`,e[e.WRITE=2]=`WRITE`})(a0||={}),o0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,i}return t.prototype.destroy=function(){},t}(dZ),s0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.Bindings;var o=i.pipeline;SZ(!!o);var s=i.uniformBufferBindings,c=i.storageBufferBindings,l=i.samplerBindings,u=i.storageTextureBindings;a.numUniformBuffers=s?.length||0;var d=[[],[],[],[]],f=0;if(s&&s.length)for(var p=0;p<s.length;p++){var m=i.uniformBufferBindings[p],h=m.binding,g=m.size,_=m.offset,v=m.buffer,y={buffer:_$(v),offset:_??0,size:g};d[0].push({binding:h??f++,resource:y})}if(l&&l.length){f=0;for(var p=0;p<l.length;p++){var b=nZ(nZ({},l[p]),v1),h=i.samplerBindings[p],x=h.texture===null?a.device.getFallbackTexture(b):h.texture;b.dimension=x.dimension,b.formatKind=xZ(x.format);var S=x.gpuTextureView;if(d[1].push({binding:h.textureBinding??f++,resource:S}),h.samplerBinding!==-1){var C=v$(h.sampler===null?a.device.getFallbackSampler(b):h.sampler);d[1].push({binding:h.samplerBinding??f++,resource:C})}}}if(c&&c.length){f=0;for(var p=0;p<c.length;p++){var w=i.storageBufferBindings[p],h=w.binding,g=w.size,_=w.offset,v=w.buffer,y={buffer:_$(v),offset:_??0,size:g};d[2].push({binding:h??f++,resource:y})}}if(u&&u.length){f=0;for(var p=0;p<u.length;p++){var E=i.storageTextureBindings[p],h=E.binding,x=E.texture,S=x.gpuTextureView;d[3].push({binding:h??f++,resource:S})}}var D=d.findLastIndex(function(e){return!!e.length});return a.gpuBindGroup=d.map(function(e,t){return t<=D&&a.device.device.createBindGroup({layout:o.getBindGroupLayout(t),entries:e})}),a}return t}(o0),c0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.Buffer;var o=i.usage,s=i.viewOrSize,c=!!(o&$$.MAP_READ);a.usage=p$(o),c&&(a.usage=$$.MAP_READ|$$.COPY_DST);var l=!UX(s);return a.view=UX(s)?null:s,a.size=UX(s)?jZ(s,4):jZ(s.byteLength,4),UX(s)?a.gpuBuffer=a.device.device.createBuffer({usage:a.usage,size:a.size,mappedAtCreation:c?l:!1}):(a.gpuBuffer=a.device.device.createBuffer({usage:a.usage,size:a.size,mappedAtCreation:!0}),new(s&&s.constructor||Float32Array)(a.gpuBuffer.getMappedRange()).set(s),a.gpuBuffer.unmap()),a}return t.prototype.setSubData=function(e,t,n,r){n===void 0&&(n=0),r===void 0&&(r=0);var i=this.gpuBuffer;r||=t.byteLength,r=Math.min(r,this.size-e);var a=t.byteOffset+n,o=a+r,s=r+3&-4;if(s!==r){var c=new Uint8Array(t.buffer.slice(a,o));t=new Uint8Array(s),t.set(c),n=0,a=0,o=s,r=s}for(var l=1024*1024*15,u=0;o-(a+u)>l;)this.device.device.queue.writeBuffer(i,e+u,t.buffer,a+u,l),u+=l;this.device.device.queue.writeBuffer(i,e+u,t.buffer,a+u,r-u)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(o0),l0=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(e,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(e,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(e,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(e.gpuBuffer,t)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(e){SZ(this.gpuComputePassEncoder===null),this.frameCommandEncoder=e,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(e){var t=CZ(e.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(t)},e.prototype.setBindings=function(e){var t=this,n=e;n.gpuBindGroup.forEach(function(e,r){e&&t.gpuComputePassEncoder.setBindGroup(r,n.gpuBindGroup[r])})},e.prototype.pushDebugGroup=function(e){this.gpuComputePassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuComputePassEncoder.insertDebugMarker(e)},e}(),u0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.ComputePipeline,a.gpuComputePipeline=null,a.descriptor=i;var o=i.program.computeStage;if(o===null)return a;var s={layout:`auto`,compute:nZ({},o)};return a.gpuComputePipeline=a.device.device.createComputePipeline(s),a.name!==void 0&&(a.gpuComputePipeline.label=a.name),a}return t.prototype.getBindGroupLayout=function(e){return this.gpuComputePipeline.getBindGroupLayout(e)},t}(o0),d0=function(e){JX(t,e);function t(t){var n,r,i,a,o=t.id,s=t.device,c=t.descriptor,l=e.call(this,{id:o,device:s})||this;l.type=U$.InputLayout;var u=[];try{for(var d=QX(c.vertexBufferDescriptors),f=d.next();!f.done;f=d.next()){var p=f.value,m=p.arrayStride,h=p.stepMode,g=p.attributes;u.push({arrayStride:m,stepMode:I$(h),attributes:[]});try{for(var _=(i=void 0,QX(g)),v=_.next();!v.done;v=_.next()){var y=v.value,b=y.shaderLocation,x=y.format,S=y.offset;u[u.length-1].attributes.push({shaderLocation:b,format:L$(x),offset:S})}}catch(e){i={error:e}}finally{try{v&&!v.done&&(a=_.return)&&a.call(_)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}return l.indexFormat=F$(c.indexBufferFormat),l.buffers=u,l}return t}(o0),f0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=U$.Program,a.vertexStage=null,a.fragmentStage=null,a.computeStage=null,a.descriptor=i,i.vertex&&(a.vertexStage=a.createShaderStage(i.vertex,`vertex`)),i.fragment&&(a.fragmentStage=a.createShaderStage(i.fragment,`fragment`)),i.compute&&(a.computeStage=a.createShaderStage(i.compute,`compute`)),a}return t.prototype.setUniformsLegacy=function(e){},t.prototype.createShaderStage=function(e,t){var n,r,i=e.glsl,a=e.wgsl,o=e.entryPoint,s=e.postprocess,c=!1,l=a;if(!l)try{l=this.device.glsl_compile(i,t,c)}catch(e){throw console.error(e,i),Error(`whoops`)}var u=function(e){if(!l.includes(e))return`continue`;l=l.replace(`var T_${e}: texture_2d<f32>;`,`var T_${e}: texture_depth_2d;`),l=l.replace(RegExp(`textureSample\\(T_${e}(.*)\\);\$`,`gm`),function(t,n){return`vec4<f32>(textureSample(T_${e}${n}), 0.0, 0.0, 0.0);`})};try{for(var d=QX([`u_TextureFramebufferDepth`]),f=d.next();!f.done;f=d.next()){var p=f.value;u(p)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}return s&&(l=s(l)),{module:this.device.device.createShaderModule({code:l}),entryPoint:o||`main`}},t}(o0),p0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.QueryPool;var o=i.elemCount,s=i.type;return a.querySet=a.device.device.createQuerySet({type:b$(s),count:o}),a.resolveBuffer=a.device.device.createBuffer({size:o*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),a.cpuBuffer=a.device.device.createBuffer({size:o*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),a.results=null,a}return t.prototype.queryResultOcclusion=function(e){return this.results===null?null:this.results[e]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(o0),m0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=U$.Readback,i}return t.prototype.readTexture=function(e,t,n,r,i,a,o,s){return o===void 0&&(o=0),XX(this,void 0,void 0,function(){var s,c,l,u,d,f,p,m;return ZX(this,function(h){return s=e,c=0,l=H$(s.gpuTextureformat),u=Math.ceil(r/l.width)*l.length,d=Math.ceil(u/256)*256,f=d*i,p=this.device.createBuffer({usage:$$.STORAGE|$$.MAP_READ|$$.COPY_DST,hint:e1.STATIC,viewOrSize:f}),m=this.device.device.createCommandEncoder(),m.copyTextureToBuffer({texture:s.gpuTexture,mipLevel:0,origin:{x:t,y:n,z:Math.max(c,0)}},{buffer:p.gpuBuffer,offset:0,bytesPerRow:d},{width:r,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([m.finish()]),[2,this.readBuffer(p,0,a.byteLength===f?a:null,o,f,s.format,!0,!1,u,d,i)]})})},t.prototype.readTextureSync=function(e,t,n,r,i,a,o,s){throw Error(`ERROR_MSG_METHOD_NOT_IMPLEMENTED`)},t.prototype.readBuffer=function(e,t,n,r,i,a,o,s,c,l,u){var d=this;t===void 0&&(t=0),n===void 0&&(n=null),i===void 0&&(i=0),a===void 0&&(a=$.U8_RGB),o===void 0&&(o=!1),c===void 0&&(c=0),l===void 0&&(l=0),u===void 0&&(u=0);var f=e,p=i||f.size,m=n||f.view,h=m&&m.constructor&&m.constructor.BYTES_PER_ELEMENT||yZ(a),g=f;if(!(f.usage&$$.MAP_READ&&f.usage&$$.COPY_DST)){var _=this.device.device.createCommandEncoder();g=this.device.createBuffer({usage:$$.STORAGE|$$.MAP_READ|$$.COPY_DST,hint:e1.STATIC,viewOrSize:p}),_.copyBufferToBuffer(f.gpuBuffer,t,g.gpuBuffer,0,p),this.device.device.queue.submit([_.finish()])}return new Promise(function(e,n){g.gpuBuffer.mapAsync(a0.READ,t,p).then(function(){var n=g.gpuBuffer.getMappedRange(t,p),r=m;if(o)r=r===null?B$(a,p,!0,n):B$(a,r.buffer,void 0,n);else if(r===null)switch(h){case 1:r=new Uint8Array(p),r.set(new Uint8Array(n));break;case 2:r=d.getHalfFloatAsFloatRGBAArrayBuffer(p/2,n);break;case 4:r=new Float32Array(p/4),r.set(new Float32Array(n));break}else switch(h){case 1:r=new Uint8Array(r.buffer),r.set(new Uint8Array(n));break;case 2:r=d.getHalfFloatAsFloatRGBAArrayBuffer(p/2,n,m);break;case 4:var i=m&&m.constructor||Float32Array;r=new i(r.buffer),r.set(new i(n));break}if(c!==l){h===1&&!o&&(c*=2,l*=2);for(var s=new Uint8Array(r.buffer),f=c,_=0,v=1;v<u;++v){_=v*l;for(var y=0;y<c;++y)s[f++]=s[_++]}r=h!==0&&!o?new Float32Array(s.buffer,0,f/4):new Uint8Array(s.buffer,0,f)}g.gpuBuffer.unmap(),e(r)},function(e){return n(e)})})},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(e,t,n){n||=new Float32Array(e);for(var r=new Uint16Array(t);e--;)n[e]=V$(r[e]);return n},t}(o0),h0=function(){function e(e){this.device=e,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:`load`,depthStoreOp:`store`,stencilLoadOp:`load`,stencilStoreOp:`store`},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){return this.renderBundle?.renderBundleEncoder||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(e,t){return SZ(t<e.mipLevelCount),e.mipLevelCount===1?e.gpuTextureView:e.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(e){this.descriptor=e,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var t=e.colorAttachment.length;this.gfxColorAttachment.length=t,this.gfxColorResolveTo.length=t;for(var n=0;n<e.colorAttachment.length;n++){var r=e.colorAttachment[n],i=e.colorResolveTo[n];if(r===null&&i!==null&&(r=i,i=null),this.gfxColorAttachment[n]=r,this.gfxColorResolveTo[n]=i,this.gfxColorAttachmentLevel[n]=e.colorAttachmentLevel?.[n]||0,this.gfxColorResolveToLevel[n]=e.colorResolveToLevel?.[n]||0,r!==null){this.gpuColorAttachments[n]===void 0&&(this.gpuColorAttachments[n]={});var a=this.gpuColorAttachments[n];a.view=this.getTextureView(r,this.gfxColorAttachmentLevel?.[n]||0);var o=e.colorClearColor?.[n]??`load`;o===`load`?a.loadOp=`load`:(a.loadOp=`clear`,a.clearValue=o),a.storeOp=e.colorStore?.[n]?`store`:`discard`,a.resolveTarget=void 0,i!==null&&(r.sampleCount>1?a.resolveTarget=this.getTextureView(i,this.gfxColorResolveToLevel[n]):a.storeOp=`store`)}else{this.gpuColorAttachments.length=n,this.gfxColorAttachment.length=n,this.gfxColorResolveTo.length=n;break}}if(this.gfxDepthStencilAttachment=e.depthStencilAttachment,this.gfxDepthStencilResolveTo=e.depthStencilResolveTo,e.depthStencilAttachment){var s=e.depthStencilAttachment,a=this.gpuDepthStencilAttachment;a.view=s.gpuTextureView,_Z(s.format)&p1.Depth?(e.depthClearValue===`load`?a.depthLoadOp=`load`:(a.depthLoadOp=`clear`,a.depthClearValue=e.depthClearValue),e.depthStencilStore||this.gfxDepthStencilResolveTo!==null?a.depthStoreOp=`store`:a.depthStoreOp=`discard`):(a.depthLoadOp=void 0,a.depthStoreOp=void 0),_Z(s.format)&p1.Stencil?(e.stencilClearValue===`load`?a.stencilLoadOp=`load`:(a.stencilLoadOp=`clear`,a.stencilClearValue=e.stencilClearValue),e.depthStencilStore||this.gfxDepthStencilResolveTo!==null?a.stencilStoreOp=`store`:a.stencilStoreOp=`discard`):(a.stencilLoadOp=void 0,a.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=zX(e.occlusionQueryPool)?void 0:y$(e.occlusionQueryPool)},e.prototype.beginRenderPass=function(e,t){SZ(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(t),this.frameCommandEncoder=e,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(e,t){return this.device.swapChainHeight-e-t},e.prototype.setViewport=function(e,t,n,r,i,a){i===void 0&&(i=0),a===void 0&&(a=1),this.gpuRenderPassEncoder.setViewport(e,this.flipY(t,r),n,r,i,a)},e.prototype.setScissorRect=function(e,t,n,r){this.gpuRenderPassEncoder.setScissorRect(e,this.flipY(t,r),n,r)},e.prototype.setPipeline=function(e){var t=CZ(e.gpuRenderPipeline);this.getEncoder().setPipeline(t)},e.prototype.setVertexInput=function(e,t,n){if(e!==null){var r=this.getEncoder(),i=e;n!==null&&r.setIndexBuffer(_$(n.buffer),CZ(i.indexFormat),n.offset);for(var a=0;a<t.length;a++){var o=t[a];o!==null&&r.setVertexBuffer(a,_$(o.buffer),o.offset)}}},e.prototype.setBindings=function(e){var t=e,n=this.getEncoder();t.gpuBindGroup.forEach(function(e,r){e&&n.setBindGroup(r,t.gpuBindGroup[r])})},e.prototype.setStencilReference=function(e){this.gpuRenderPassEncoder.setStencilReference(e)},e.prototype.draw=function(e,t,n,r){this.getEncoder().draw(e,t,n,r)},e.prototype.drawIndexed=function(e,t,n,r,i){this.getEncoder().drawIndexed(e,t,n,r,i)},e.prototype.drawIndirect=function(e,t){this.getEncoder().drawIndirect(_$(e),t)},e.prototype.drawIndexedIndirect=function(e,t){this.getEncoder().drawIndexedIndirect(_$(e),t)},e.prototype.beginOcclusionQuery=function(e){this.gpuRenderPassEncoder.beginOcclusionQuery(e)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(e){this.gpuRenderPassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuRenderPassEncoder.insertDebugMarker(e)},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(e){this.gpuRenderPassEncoder.executeBundles(e.map(function(e){return e.renderBundle}))},e.prototype.finish=function(){var e;(e=this.gpuRenderPassEncoder)==null||e.end(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var n=this.gfxColorAttachment[t],r=this.gfxColorResolveTo[t];n!==null&&r!==null&&n.sampleCount===1&&this.copyAttachment(r,this.gfxColorAttachmentLevel[t],n,this.gfxColorResolveToLevel[t])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(e,t,n,r){SZ(n.sampleCount===1);var i={texture:n.gpuTexture,mipLevel:r},a={texture:e.gpuTexture,mipLevel:t};SZ(n.width>>>r==e.width>>>t),SZ(n.height>>>r==e.height>>>t),SZ(!!(n.usage&i0.COPY_SRC)),SZ(!!(e.usage&i0.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(i,a,[e.width,e.height,1])},e}(),g0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;return a.type=U$.RenderPipeline,a.isCreatingAsync=!1,a.gpuRenderPipeline=null,a.descriptor=i,a.device.createRenderPipelineInternal(a,!1),a}return t.prototype.getBindGroupLayout=function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)},t}(o0),_0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=e.call(this,{id:n,device:r})||this;a.type=U$.Sampler;var o=i.lodMinClamp,s=i.mipmapFilter===Z$.NO_MIP?i.lodMinClamp:i.lodMaxClamp,c=i.maxAnisotropy??1;return c>1&&SZ(i.minFilter===X$.BILINEAR&&i.magFilter===X$.BILINEAR&&i.mipmapFilter===Z$.LINEAR),a.gpuSampler=a.device.device.createSampler({addressModeU:m$(i.addressModeU),addressModeV:m$(i.addressModeV),addressModeW:m$(i.addressModeW??i.addressModeU),lodMinClamp:o,lodMaxClamp:s,minFilter:h$(i.minFilter),magFilter:h$(i.magFilter),mipmapFilter:g$(i.mipmapFilter),compare:i.compareFunction===void 0?void 0:M$(i.compareFunction),maxAnisotropy:c}),a}return t}(o0),v0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=t.descriptor,a=t.skipCreate,o=t.sampleCount,s=e.call(this,{id:n,device:r})||this;s.type=U$.Texture,s.flipY=!1;var c=i.format,l=i.dimension,u=i.width,d=i.height,f=i.depthOrArrayLayers,p=i.mipLevelCount,m=i.usage;return s.flipY=!!i.pixelStore?.unpackFlipY,s.device.createTextureShared({format:c,dimension:l??r1.TEXTURE_2D,width:u,height:d,depthOrArrayLayers:f??1,mipLevelCount:p??1,usage:m,sampleCount:o??1},s,a),s}return t.prototype.textureFromImageBitmapOrCanvas=function(e,t,n){for(var r=t[0].width,i=t[0].height,a={size:{width:r,height:i,depthOrArrayLayers:n},format:`rgba8unorm`,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},o=e.createTexture(a),s=0;s<t.length;s++)e.queue.copyExternalImageToTexture({source:t[s],flipY:this.flipY},{texture:o,origin:[0,0,s]},[r,i]);return[o,r,i]},t.prototype.isImageBitmapOrCanvases=function(e){var t=e[0];return t instanceof ImageBitmap||t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas},t.prototype.isVideo=function(e){return e[0]instanceof HTMLVideoElement},t.prototype.setImageData=function(e,t){var n,r=this,i=this.device.device,a,o,s;if(this.isImageBitmapOrCanvases(e))n=$X(this.textureFromImageBitmapOrCanvas(i,e,this.depthOrArrayLayers),3),a=n[0],o=n[1],s=n[2];else if(this.isVideo(e))a=i.importExternalTexture({source:e[0]});else{var c=H$(this.gpuTextureformat),l=Math.ceil(this.width/c.width)*c.length;e.forEach(function(e){i.queue.writeTexture({texture:r.gpuTexture},e,{bytesPerRow:l},{width:r.width,height:r.height})})}this.width=o,this.height=s,a&&(this.gpuTexture=a),this.gpuTextureView=this.gpuTexture.createView({dimension:f$(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(o0),y0=function(e){JX(t,e);function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=U$.RenderBundle,i.renderBundleEncoder=i.device.device.createRenderBundleEncoder({colorFormats:[i.device.swapChainFormat]}),i}return t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(o0),b0=function(){function e(e,t,n,r,i,a){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=i0.RENDER_ATTACHMENT|i0.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString=`WebGPU`,this.glslVersion=`#version 440`,this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=c1.UPPER_LEFT,this.clipSpaceNearZ=l1.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=r,this.glsl_compile=i,this.WGSLComposer=a,this.fallbackTexture2D=this.createFallbackTexture(r1.TEXTURE_2D,s1.Float),this.setResourceName(this.fallbackTexture2D,`Fallback Texture2D`),this.fallbackTexture2DDepth=this.createFallbackTexture(r1.TEXTURE_2D,s1.Depth),this.setResourceName(this.fallbackTexture2DDepth,`Fallback Depth Texture2D`),this.fallbackTexture2DArray=this.createFallbackTexture(r1.TEXTURE_2D_ARRAY,s1.Float),this.setResourceName(this.fallbackTexture2DArray,`Fallback Texture2DArray`),this.fallbackTexture3D=this.createFallbackTexture(r1.TEXTURE_3D,s1.Float),this.setResourceName(this.fallbackTexture3D,`Fallback Texture3D`),this.fallbackTextureCube=this.createFallbackTexture(r1.TEXTURE_CUBE_MAP,s1.Float),this.setResourceName(this.fallbackTextureCube,`Fallback TextureCube`),this.fallbackSamplerFiltering=this.createSampler({addressModeU:Y$.REPEAT,addressModeV:Y$.REPEAT,minFilter:X$.POINT,magFilter:X$.POINT,mipmapFilter:Z$.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,`Fallback Sampler Filtering`),this.fallbackSamplerComparison=this.createSampler({addressModeU:Y$.REPEAT,addressModeV:Y$.REPEAT,minFilter:X$.POINT,magFilter:X$.POINT,mipmapFilter:Z$.NEAREST,compareFunction:W$.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,`Fallback Sampler Comparison Filtering`),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has(`texture-compression-bc`)),this.device.onuncapturederror=function(e){console.error(e.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:`premultiplied`})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(e,t){this.swapChainWidth===e&&this.swapChainHeight===t||(this.swapChainWidth=e,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var e=this.canvasContext.getCurrentTexture(),t=e.createView(),n=new v0({id:0,device:this,descriptor:{format:$.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:r1.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=e,n.gpuTextureView=t,n.name=`Onscreen`,this.setResourceName(n,`Onscreen Texture`),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){SZ(this.frameCommandEncoderPool.length===0)},e.prototype.endFrame=function(){SZ(this.frameCommandEncoderPool.every(function(e){return e!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(e){return e.finish()})),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(e){return new c0({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new v0({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new _0({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){var t=new v0({id:this.getNextUniqueId(),device:this,descriptor:nZ(nZ({},e),{dimension:r1.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:i1.RENDER_TARGET}),sampleCount:e.sampleCount});return t.depthOrArrayLayers=1,t.type=U$.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height,a=t.depthOrArrayLayers,o=t.sampleCount,s=t.mipLevelCount,c=t.gpuTexture,l=t.gpuTextureView,u=t.usage;SZ(!!(u&i0.RENDER_ATTACHMENT));var d=new v0({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:r,height:i,depthOrArrayLayers:a,dimension:r1.TEXTURE_2D,mipLevelCount:s,usage:u},skipCreate:!0});return d.depthOrArrayLayers=a,d.sampleCount=o,d.gpuTexture=c,d.gpuTextureView=l,d},e.prototype.createProgram=function(e){return e.vertex?.glsl&&(e.vertex.glsl=OQ(this.queryVendorInfo(),`vert`,e.vertex.glsl)),e.fragment?.glsl&&(e.fragment.glsl=OQ(this.queryVendorInfo(),`frag`,e.fragment.glsl)),new f0({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createProgramSimple=function(e){return new f0({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTextureShared=function(e,t,n){var r={width:e.width,height:e.height,depthOrArrayLayers:e.depthOrArrayLayers},i=e.mipLevelCount,a=u$(e.format),o=d$(e.dimension),s=l$(e.usage);if(t.gpuTextureformat=a,t.dimension=e.dimension,t.format=e.format,t.width=e.width,t.height=e.height,t.depthOrArrayLayers=e.depthOrArrayLayers,t.mipLevelCount=i,t.usage=s,t.sampleCount=e.sampleCount,!n){var c=this.device.createTexture({size:r,mipLevelCount:i,format:a,dimension:o,sampleCount:e.sampleCount,usage:s}),l=c.createView();t.gpuTexture=c,t.gpuTextureView=l}},e.prototype.getFallbackSampler=function(e){return e.formatKind===s1.Depth&&e.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(e){var t=e.dimension,n=e.formatKind;if(t===r1.TEXTURE_2D)return n===s1.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===r1.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===r1.TEXTURE_3D)return this.fallbackTexture3D;if(t===r1.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw Error(`whoops`)},e.prototype.createFallbackTexture=function(e,t){var n=e===r1.TEXTURE_CUBE_MAP?6:1,r=t===s1.Float?$.U8_RGBA_NORM:$.D24;return this.createTexture({dimension:e,format:r,usage:i1.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(e){return new s0({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new d0({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePipeline=function(e){return new u0({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new g0({id:this.getNextUniqueId(),device:this,descriptor:nZ({},e)})},e.prototype.createQueryPool=function(e,t){return new p0({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(e,t){if(e.gpuRenderPipeline===null){var n=e.descriptor,r=n.program,i=r.vertexStage,a=r.fragmentStage;if(!(i===null||a===null)){var o=n.megaStateDescriptor||{},s=o.stencilBack,c=o.stencilFront,l=YX(o,[`stencilBack`,`stencilFront`]),u=BZ(_1);n.megaStateDescriptor=nZ(nZ(nZ({},u),{stencilBack:nZ(nZ({},u.stencilBack),s),stencilFront:nZ(nZ({},u.stencilFront),c)}),l);var d=n.megaStateDescriptor.attachmentsState[0];n.colorAttachmentFormats.forEach(function(e,t){n.megaStateDescriptor.attachmentsState[t]||(n.megaStateDescriptor.attachmentsState[t]=LZ(void 0,d))});var f=w$(n.topology??Q$.TRIANGLES,n.megaStateDescriptor),p=j$(n.colorAttachmentFormats,n.megaStateDescriptor),m=P$(n.depthStencilAttachmentFormat,n.megaStateDescriptor),h=void 0;n.inputLayout!==null&&(h=n.inputLayout.buffers);var g=n.sampleCount,_={layout:`auto`,vertex:nZ(nZ({},i),{buffers:h}),primitive:f,depthStencil:m,multisample:{count:g},fragment:nZ(nZ({},a),{targets:p})};e.gpuRenderPipeline=this.device.createRenderPipeline(_)}}},e.prototype.createReadback=function(){return new m0({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new y0({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(e){var t=this.renderPassPool.pop();t===void 0&&(t=new h0(this));var n=this.frameCommandEncoderPool.pop();return n===void 0&&(n=this.device.createCommandEncoder()),t.beginRenderPass(n,e),t},e.prototype.createComputePass=function(){var e=this.computePassPool.pop();e===void 0&&(e=new l0);var t=this.frameCommandEncoderPool.pop();return t===void 0&&(t=this.device.createCommandEncoder()),e.beginComputePass(t),e},e.prototype.submitPass=function(e){var t=e;t instanceof h0?(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.renderPassPool.push(t)):t instanceof l0&&(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.computePassPool.push(t))},e.prototype.copySubTexture2D=function(e,t,n,r,i,a,o){var s=this.device.createCommandEncoder(),c=e,l=r,u={texture:l.gpuTexture,origin:[i,a,0],mipLevel:0,aspect:`all`},d={texture:c.gpuTexture,origin:[t,n,0],mipLevel:0,aspect:`all`};SZ(!!(l.usage&i0.COPY_SRC)),SZ(!!(c.usage&i0.COPY_DST)),s.copyTextureToTexture(u,d,[l.width,l.height,o||1]),this.device.queue.submit([s.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(e,t,n){if(R$(e)){if(!this.featureTextureCompressionBC)return!1;var r=z$(e);return t%r!==0||n%r!==0?!1:this.featureTextureCompressionBC}switch(e){case $.U16_RGBA_NORM:return!1;case $.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return e.descriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===U$.Buffer){var n=e;n.gpuBuffer.label=t}else if(e.type===U$.Texture){var n=e;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===U$.RenderTarget){var n=e;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===U$.Sampler){var n=e;n.gpuSampler.label=t}else if(e.type===U$.RenderPipeline){var n=e;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(e,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(e){},e.prototype.pipelineQueryReady=function(e){return e.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(e){var t=e;this.createRenderPipelineInternal(t,!1)},e}(),x0=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return XX(this,void 0,void 0,function(){var t,n,r,i,a,o,s,c;return ZX(this,function(l){switch(l.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];t=null,l.label=1;case 1:return l.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=l.sent(),[3,4];case 3:return r=l.sent(),console.log(r),[3,4];case 4:return t===null?[2,null]:(i=[`depth32float-stencil8`,`texture-compression-bc`,`float32-filterable`],a=i.filter(function(e){return t.features.has(e)}),[4,t.requestDevice({requiredFeatures:a})]);case 5:if(o=l.sent(),o&&(s=this.pluginOptions.onContextLost,o.lost.then(function(){s&&s()})),o===null||(c=e.getContext(`webgpu`),!c))return[2,null];l.label=6;case 6:return l.trys.push([6,8,,9]),[4,c$(this.pluginOptions.shaderCompilerPath)];case 7:return l.sent(),[3,9];case 8:return l.sent(),[3,9];case 9:return[2,new b0(t,o,e,c,i$,r0&&new r0)]}})})},e}()})),C0,w0=o((()=>{C0=class{constructor(e,t){let{buffer:n,offset:r,stride:i,normalized:a,size:o,divisor:s,shaderLocation:c}=t;this.buffer=n,this.attribute={shaderLocation:c,buffer:n.get(),offset:r||0,stride:i||0,normalized:a||!1,divisor:s||0},o&&(this.attribute.size=o)}get(){return this.buffer}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}}})),T0,E0,D0,O0,k0,A0,j0,M0,N0,P0,F0,I0=o((()=>{S0(),UC(),T0={[X.FLOAT]:Float32Array,[X.UNSIGNED_BYTE]:Uint8Array,[X.SHORT]:Int16Array,[X.UNSIGNED_SHORT]:Uint16Array,[X.INT]:Int32Array,[X.UNSIGNED_INT]:Uint32Array},E0={[X.POINTS]:Q$.POINTS,[X.LINES]:Q$.LINES,[X.LINE_LOOP]:Q$.LINES,[X.LINE_STRIP]:Q$.LINE_STRIP,[X.TRIANGLES]:Q$.TRIANGLES,[X.TRIANGLE_FAN]:Q$.TRIANGLES,[X.TRIANGLE_STRIP]:Q$.TRIANGLE_STRIP},D0={1:$.F32_R,2:$.F32_RG,3:$.F32_RGB,4:$.F32_RGBA},O0={[X.STATIC_DRAW]:e1.STATIC,[X.DYNAMIC_DRAW]:e1.DYNAMIC,[X.STREAM_DRAW]:e1.DYNAMIC},k0={[X.REPEAT]:Y$.REPEAT,[X.CLAMP_TO_EDGE]:Y$.CLAMP_TO_EDGE,[X.MIRRORED_REPEAT]:Y$.MIRRORED_REPEAT},A0={[X.NEVER]:W$.NEVER,[X.ALWAYS]:W$.ALWAYS,[X.LESS]:W$.LESS,[X.LEQUAL]:W$.LEQUAL,[X.GREATER]:W$.GREATER,[X.GEQUAL]:W$.GEQUAL,[X.EQUAL]:W$.EQUAL,[X.NOTEQUAL]:W$.NOTEQUAL},j0={[X.FRONT]:K$.FRONT,[X.BACK]:K$.BACK},M0={[X.FUNC_ADD]:J$.ADD,[X.MIN_EXT]:J$.MIN,[X.MAX_EXT]:J$.MAX,[X.FUNC_SUBTRACT]:J$.SUBSTRACT,[X.FUNC_REVERSE_SUBTRACT]:J$.REVERSE_SUBSTRACT},N0={[X.ZERO]:q$.ZERO,[X.ONE]:q$.ONE,[X.SRC_COLOR]:q$.SRC,[X.ONE_MINUS_SRC_COLOR]:q$.ONE_MINUS_SRC,[X.SRC_ALPHA]:q$.SRC_ALPHA,[X.ONE_MINUS_SRC_ALPHA]:q$.ONE_MINUS_SRC_ALPHA,[X.DST_COLOR]:q$.DST,[X.ONE_MINUS_DST_COLOR]:q$.ONE_MINUS_DST,[X.DST_ALPHA]:q$.DST_ALPHA,[X.ONE_MINUS_DST_ALPHA]:q$.ONE_MINUS_DST_ALPHA,[X.CONSTANT_COLOR]:q$.CONST,[X.ONE_MINUS_CONSTANT_COLOR]:q$.ONE_MINUS_CONSTANT,[X.CONSTANT_ALPHA]:q$.CONST,[X.ONE_MINUS_CONSTANT_ALPHA]:q$.ONE_MINUS_CONSTANT,[X.SRC_ALPHA_SATURATE]:q$.SRC_ALPHA_SATURATE},P0={[X.REPLACE]:o1.REPLACE,[X.KEEP]:o1.KEEP,[X.ZERO]:o1.ZERO,[X.INVERT]:o1.INVERT,[X.INCR]:o1.INCREMENT_CLAMP,[X.DECR]:o1.DECREMENT_CLAMP,[X.INCR_WRAP]:o1.INCREMENT_WRAP,[X.DECR_WRAP]:o1.DECREMENT_WRAP},F0={[X.ALWAYS]:W$.ALWAYS,[X.EQUAL]:W$.EQUAL,[X.GEQUAL]:W$.GEQUAL,[X.GREATER]:W$.GREATER,[X.LEQUAL]:W$.LEQUAL,[X.LESS]:W$.LESS,[X.NEVER]:W$.NEVER,[X.NOTEQUAL]:W$.NOTEQUAL}}));function L0(e){return Object.prototype.toString.call(e)in z0}function R0(e,t){let n=e.length,r=n+Math.ceil(n/3),i=new Float32Array(r);for(let n=0;n<r;n+=4)i[n]=e[n/4*3],i[n+1]=e[n/4*3+1],i[n+2]=e[n/4*3+2],i[n+3]=t;return i}var z0,B0=o((()=>{z0={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}})),V0,H0=o((()=>{S0(),UC(),I0(),B0(),V0=class{constructor(e,t){this.isDestroyed=!1;let{data:n,usage:r,type:i,isUBO:a,label:o}=t,s;s=L0(n)?n:new T0[this.type||X.FLOAT](n),this.type=i,this.size=s.byteLength,this.buffer=e.createBuffer({viewOrSize:s,usage:a?$$.UNIFORM:$$.VERTEX,hint:O0[r||X.STATIC_DRAW]}),o&&e.setResourceName(this.buffer,o)}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){let n;n=L0(e)?e:new T0[this.type||X.FLOAT](e),this.buffer.setSubData(t,new Uint8Array(n.buffer))}}}));function U0(e,t=0){return e+=t,e+=e<<10,e+=e>>>6,e>>>0}function W0(e){return e+=e<<3,e^=e>>>11,e+=e<<15,e>>>0}function G0(){return 0}var K0,q0,J0=o((()=>{K0=class{constructor(){this.keys=[],this.values=[]}},q0=class{constructor(e,t){this.keyEqualFunc=e,this.keyHashFunc=t,this.buckets=new Map}findBucketIndex(e,t){for(let n=0;n<e.keys.length;n++)if(this.keyEqualFunc(t,e.keys[n]))return n;return-1}findBucket(e){let t=this.keyHashFunc(e);return this.buckets.get(t)}get(e){let t=this.findBucket(e);if(t===void 0)return null;let n=this.findBucketIndex(t,e);return n<0?null:t.values[n]}add(e,t){let n=this.keyHashFunc(e);this.buckets.get(n)===void 0&&this.buckets.set(n,new K0);let r=this.buckets.get(n);r.keys.push(e),r.values.push(t)}delete(e){let t=this.findBucket(e);if(t===void 0)return;let n=this.findBucketIndex(t,e);n!==-1&&(t.keys.splice(n,1),t.values.splice(n,1))}clear(){this.buckets.clear()}size(){let e=0;for(let t of this.buckets.values())e+=t.values.length;return e}*values(){for(let e of this.buckets.values())for(let t=e.values.length-1;t>=0;t--)yield e.values[t]}}}));function Y0(e,t){return e=U0(e,t.blendMode),e=U0(e,t.blendSrcFactor),e=U0(e,t.blendDstFactor),e}function X0(e,t){return e=Y0(e,t.rgbBlendState),e=Y0(e,t.alphaBlendState),e=U0(e,t.channelWriteMask),e}function Z0(e,t){return e=U0(e,t.r<<24|t.g<<16|t.b<<8|t.a),e}function Q0(e,t){for(let n=0;n<t.attachmentsState.length;n++)e=X0(e,t.attachmentsState[n]);return e=Z0(e,t.blendConstant||m1),e=U0(e,t.depthCompare),e=U0(e,t.depthWrite?1:0),e=U0(e,t.stencilFront?.compare),e=U0(e,t.stencilFront?.passOp),e=U0(e,t.stencilFront?.failOp),e=U0(e,t.stencilFront?.depthFailOp),e=U0(e,t.stencilBack?.compare),e=U0(e,t.stencilBack?.passOp),e=U0(e,t.stencilBack?.failOp),e=U0(e,t.stencilBack?.depthFailOp),e=U0(e,t.stencilWrite?1:0),e=U0(e,t.cullMode),e=U0(e,t.frontFace?1:0),e=U0(e,t.polygonOffset?1:0),e}function $0(e){let t=0;t=U0(t,e.program.id),e.inputLayout!==null&&(t=U0(t,e.inputLayout.id)),t=Q0(t,e.megaStateDescriptor);for(let n=0;n<e.colorAttachmentFormats.length;n++)t=U0(t,e.colorAttachmentFormats[n]||0);return t=U0(t,e.depthStencilAttachmentFormat||0),W0(t)}function e2(e){let t=0;if(e.samplerBindings)for(let n=0;n<e.samplerBindings.length;n++){let r=e.samplerBindings[n];r!==null&&r.texture!==null&&(t=U0(t,r.texture.id))}if(e.uniformBufferBindings)for(let n=0;n<e.uniformBufferBindings.length;n++){let r=e.uniformBufferBindings[n];r!==null&&r.buffer!==null&&(t=U0(t,r.buffer.id),t=U0(t,r.binding),t=U0(t,r.offset),t=U0(t,r.size))}if(e.storageBufferBindings)for(let n=0;n<e.storageBufferBindings.length;n++){let r=e.storageBufferBindings[n];r!==null&&r.buffer!==null&&(t=U0(t,r.buffer.id),t=U0(t,r.binding),t=U0(t,r.offset),t=U0(t,r.size))}if(e.storageTextureBindings)for(let n=0;n<e.storageTextureBindings.length;n++){let r=e.storageTextureBindings[n];r!==null&&r.texture!==null&&(t=U0(t,r.texture.id),t=U0(t,r.binding))}return W0(t)}function t2(e,t){return e.vertex?.glsl===t.vertex?.glsl&&e.fragment?.glsl===t.fragment?.glsl}function n2(e){return{vertex:{glsl:e.vertex?.glsl},fragment:{glsl:e.fragment?.glsl}}}var r2,i2=o((()=>{S0(),J0(),r2=class{constructor(e){this.device=e,this.bindingsCache=new q0(qZ,e2),this.renderPipelinesCache=new q0(eQ,$0),this.inputLayoutsCache=new q0(rQ,G0),this.programCache=new q0(t2,G0)}createBindings(e){let t=this.bindingsCache.get(e);if(t===null){let n=sQ(e);n.uniformBufferBindings=n.uniformBufferBindings?.filter(({size:e})=>e&&e>0),t=this.device.createBindings(n),this.bindingsCache.add(n,t)}return t}createRenderPipeline(e){let t=this.renderPipelinesCache.get(e);if(t===null){let n=cQ(e);n.colorAttachmentFormats=n.colorAttachmentFormats.filter(e=>e),t=this.device.createRenderPipeline(n),this.renderPipelinesCache.add(n,t)}return t}createInputLayout(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter(e=>!!e);let t=this.inputLayoutsCache.get(e);if(t===null){let n=dQ(e);t=this.device.createInputLayout(n),this.inputLayoutsCache.add(n,t)}return t}createProgram(e){let t=this.programCache.get(e);if(t===null){let n=n2(e);t=this.device.createProgram(e),this.programCache.add(n,t)}return t}destroy(){for(let e of this.bindingsCache.values())e.destroy();for(let e of this.renderPipelinesCache.values())e.destroy();for(let e of this.inputLayoutsCache.values())e.destroy();for(let e of this.programCache.values())e.destroy();this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}}})),a2,o2=o((()=>{S0(),UC(),I0(),B0(),a2=class{constructor(e,t){let{data:n,type:r,count:i=0}=t,a;a=L0(n)?n:new T0[this.type||X.UNSIGNED_INT](n),this.type=r,this.count=i,this.indexBuffer=e.createBuffer({viewOrSize:a,usage:$$.INDEX})}get(){return this.indexBuffer}subData({data:e}){let t;t=L0(e)?e:new T0[this.type||X.UNSIGNED_INT](e),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}destroy(){this.indexBuffer.destroy()}}}));function s2(e){return!!(e&&e.texture)}var c2,l2=o((()=>{S0(),UC(),I0(),B0(),c2=class{constructor(e,t){this.device=e,this.options=t,this.isDestroy=!1;let{wrapS:n=X.CLAMP_TO_EDGE,wrapT:r=X.CLAMP_TO_EDGE,aniso:i,mag:a=X.NEAREST,min:o=X.NEAREST}=t;this.createTexture(t),this.sampler=e.createSampler({addressModeU:k0[n],addressModeV:k0[r],minFilter:o===X.NEAREST?X$.POINT:X$.BILINEAR,magFilter:a===X.NEAREST?X$.POINT:X$.BILINEAR,mipmapFilter:Z$.NO_MIP,maxAnisotropy:i})}createTexture(e){let{type:t=X.UNSIGNED_BYTE,width:n,height:r,flipY:i=!1,format:a=X.RGBA,alignment:o=1,usage:s=Sx.SAMPLED,unorm:c=!1,label:l}=e,{data:u}=e;this.width=n,this.height=r;let d=$.U8_RGBA_RT;if(t===X.UNSIGNED_BYTE&&a===X.RGBA)d=c?$.U8_RGBA_NORM:$.U8_RGBA_RT;else if(t===X.UNSIGNED_BYTE&&a===X.LUMINANCE)d=$.U8_LUMINANCE;else if(t===X.FLOAT&&a===X.LUMINANCE)d=$.F32_LUMINANCE;else if(t===X.FLOAT&&a===X.RGB)this.device.queryVendorInfo().platformString===`WebGPU`?(u&&=R0(u,0),d=$.F32_RGBA):d=$.F32_RGB;else if(t===X.FLOAT&&a===X.RGBA)d=$.F32_RGBA;else if(t===X.FLOAT&&a===X.RED)d=$.F32_R;else throw Error(`create texture error, type: ${t}, format: ${a}`);this.texture=this.device.createTexture({format:d,width:n,height:r,usage:s===Sx.SAMPLED?i1.SAMPLED:i1.RENDER_TARGET,pixelStore:{unpackFlipY:i,packAlignment:o},mipLevelCount:1}),l&&this.device.setResourceName(this.texture,l),u&&this.texture.setImageData([u])}get(){return this.texture}update(e){let{data:t}=e;this.texture.setImageData([t])}bind(){}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&this.destroy(),this.options.width=e,this.options.height=t,this.createTexture(this.options),this.isDestroy=!1}getSize(){return[this.width,this.height]}destroy(){var e;!this.isDestroy&&!this.texture.destroyed&&((e=this.texture)==null||e.destroy()),this.isDestroy=!0}}})),u2,d2=o((()=>{S0(),l2(),u2=class{constructor(e,t){this.device=e,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}createColorRenderTarget(e=!1){let{width:t,height:n,color:r}=this.options;r&&(s2(r)?(e&&r.resize({width:t,height:n}),this.colorTexture=r.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=r.width,this.height=r.height):t&&n&&(this.colorTexture=this.device.createTexture({format:$.U8_RGBA_RT,usage:i1.RENDER_TARGET,width:t,height:n}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=t,this.height=n))}createDepthRenderTarget(e=!1){let{width:t,height:n,depth:r}=this.options;r&&(s2(r)?(e&&r.resize({width:t,height:n}),this.depthTexture=r.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=r.width,this.height=r.height):t&&n&&(this.depthTexture=this.device.createTexture({format:$.D24_S8,usage:i1.RENDER_TARGET,width:t,height:n}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=t,this.height=n))}get(){return this.colorRenderTarget}destroy(){var e,t;(e=this.colorRenderTarget)==null||e.destroy(),(t=this.depthRenderTarget)==null||t.destroy()}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=e,this.options.height=t,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}}})),f2,p2,m2,h2,g2,_2,v2,y2,b2,x2,S2,C2,w2,T2=o((()=>{S0(),UC(),kp(),d2(),l2(),I0(),f2=Object.defineProperty,p2=Object.defineProperties,m2=Object.getOwnPropertyDescriptors,h2=Object.getOwnPropertySymbols,g2=Object.prototype.hasOwnProperty,_2=Object.prototype.propertyIsEnumerable,v2=(e,t,n)=>t in e?f2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y2=(e,t)=>{for(var n in t||={})g2.call(t,n)&&v2(e,n,t[n]);if(h2)for(var n of h2(t))_2.call(t,n)&&v2(e,n,t[n]);return e},b2=(e,t)=>p2(e,m2(t)),{isPlainObject:x2,isTypedArray:S2,isNil:C2}=tu,w2=class{constructor(e,t,n){this.device=e,this.options=t,this.service=n,this.destroyed=!1,this.uniforms={},this.vertexBuffers=[];let{vs:r,fs:i,attributes:a,uniforms:o,count:s,elements:c,diagnosticDerivativeUniformityEnabled:l}=t;this.options=t;let u=l?``:this.service.viewportOrigin===c1.UPPER_LEFT?`diagnostic(off,derivative_uniformity);`:``;this.program=n.renderCache.createProgram({vertex:{glsl:r},fragment:{glsl:i,postprocess:e=>u+e}}),o&&(this.uniforms=this.extractUniforms(o));let d=[],f=0;Object.keys(a).forEach(e=>{let t=a[e],n=t.get();this.vertexBuffers.push(n.get());let{offset:r=0,stride:i=0,size:o=1,divisor:s=0,shaderLocation:c=0}=t.attribute;d.push({arrayStride:i||o*4,stepMode:t1.VERTEX,attributes:[{format:D0[o],shaderLocation:c,offset:r,divisor:s}]}),f=n.size/o}),s||(this.options.count=f),c&&(this.indexBuffer=c.get()),this.inputLayout=n.renderCache.createInputLayout({vertexBufferDescriptors:d,indexBufferFormat:c?$.U32_R:null,program:this.program}),this.pipeline=this.createPipeline(t)}createPipeline(e,t){let{primitive:n=X.TRIANGLES,depth:r,cull:i,blend:a,stencil:o}=e,s=this.initDepthDrawParams({depth:r}),c=!!(s&&s.enable),l=this.initCullDrawParams({cull:i}),u=!!(l&&l.enable),d=this.getBlendDrawParams({blend:a}),f=!!(d&&d.enable),p=this.getStencilDrawParams({stencil:o}),m=!!(p&&p.enable),h=this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:E0[n],colorAttachmentFormats:[$.U8_RGBA_RT],depthStencilAttachmentFormat:$.D24_S8,megaStateDescriptor:{attachmentsState:[t?{channelWriteMask:a1.ALL,rgbBlendState:{blendMode:J$.ADD,blendSrcFactor:q$.ONE,blendDstFactor:q$.ZERO},alphaBlendState:{blendMode:J$.ADD,blendSrcFactor:q$.ONE,blendDstFactor:q$.ZERO}}:{channelWriteMask:m&&p.opFront.zpass===o1.REPLACE?a1.NONE:a1.ALL,rgbBlendState:{blendMode:f&&d.equation.rgb||J$.ADD,blendSrcFactor:f&&d.func.srcRGB||q$.SRC_ALPHA,blendDstFactor:f&&d.func.dstRGB||q$.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:f&&d.equation.alpha||J$.ADD,blendSrcFactor:f&&d.func.srcAlpha||q$.ONE,blendDstFactor:f&&d.func.dstAlpha||q$.ONE}}],blendConstant:f?m1:void 0,depthWrite:c,depthCompare:c&&s.func||W$.LESS,cullMode:u&&l.face||K$.NONE,stencilWrite:m,stencilFront:{compare:m?p.func.cmp:W$.ALWAYS,passOp:p.opFront.zpass,failOp:p.opFront.fail,depthFailOp:p.opFront.zfail,mask:p.opFront.mask},stencilBack:{compare:m?p.func.cmp:W$.ALWAYS,passOp:p.opBack.zpass,failOp:p.opBack.fail,depthFailOp:p.opBack.zfail,mask:p.opBack.mask}}});return m&&!C2(o?.func?.ref)&&(h.stencilFuncReference=o.func.ref),h}updateAttributesAndElements(){}updateAttributes(){}addUniforms(e){this.uniforms=y2(y2({},this.uniforms),this.extractUniforms(e))}draw(e,t){let n=y2(y2({},this.options),e),{count:r=0,instances:i,elements:a,uniforms:o={},uniformBuffers:s,textures:c}=n;this.uniforms=y2(y2({},this.uniforms),this.extractUniforms(o));let{renderPass:l,currentFramebuffer:u,width:d,height:f}=this.service;this.pipeline=this.createPipeline(n,t);let p=this.service.device,m=p.swapChainHeight;if(p.swapChainHeight=u?.height||f,l.setViewport(0,0,u?.width||d,u?.height||f),p.swapChainHeight=m,l.setPipeline(this.pipeline),C2(this.pipeline.stencilFuncReference)||l.setStencilReference(this.pipeline.stencilFuncReference),l.setVertexInput(this.inputLayout,this.vertexBuffers.map(e=>({buffer:e})),a?{buffer:this.indexBuffer,offset:0}:null),s&&(this.bindings=p.createBindings({pipeline:this.pipeline,uniformBufferBindings:s.map((e,t)=>{let n=e;return{binding:t,buffer:n.get(),size:n.size}}),samplerBindings:c?.map(e=>({texture:e.texture,sampler:e.sampler}))})),this.bindings&&(l.setBindings(this.bindings),Object.keys(this.uniforms).forEach(e=>{let t=this.uniforms[e];t instanceof c2?this.uniforms[e]=t.get():t instanceof u2&&(this.uniforms[e]=t.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),a){let e=a.count;e===0?l.draw(r,i):l.drawIndexed(e,i)}else l.draw(r,i)}destroy(){var e,t,n;(e=this.vertexBuffers)==null||e.forEach(e=>e.destroy()),(t=this.indexBuffer)==null||t.destroy(),(n=this.bindings)==null||n.destroy(),this.pipeline.destroy(),this.destroyed=!0}initDepthDrawParams({depth:e}){if(e)return{enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:A0[e.func||X.LESS],range:e.range||[0,1]}}getBlendDrawParams({blend:e}){let{enable:t,func:n,equation:r,color:i=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:N0[n&&n.srcRGB||X.SRC_ALPHA],srcAlpha:N0[n&&n.srcAlpha||X.SRC_ALPHA],dstRGB:N0[n&&n.dstRGB||X.ONE_MINUS_SRC_ALPHA],dstAlpha:N0[n&&n.dstAlpha||X.ONE_MINUS_SRC_ALPHA]},equation:{rgb:M0[r&&r.rgb||X.FUNC_ADD],alpha:M0[r&&r.alpha||X.FUNC_ADD]},color:i}}getStencilDrawParams({stencil:e}){let{enable:t,mask:n=4294967295,func:r={cmp:X.ALWAYS,ref:0,mask:4294967295},opFront:i={fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP},opBack:a={fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP}}=e||{};return{enable:!!t,mask:n,func:b2(y2({},r),{cmp:F0[r.cmp]}),opFront:{fail:P0[i.fail],zfail:P0[i.zfail],zpass:P0[i.zpass],mask:r.mask},opBack:{fail:P0[a.fail],zfail:P0[a.zfail],zpass:P0[a.zpass],mask:r.mask}}}initCullDrawParams({cull:e}){if(e){let{enable:t,face:n=X.BACK}=e;return{enable:!!t,face:j0[n]}}}extractUniforms(e){let t={};return Object.keys(e).forEach(n=>{this.extractUniformsRecursively(n,e[n],t,``)}),t}extractUniformsRecursively(e,t,n,r){if(t===null||typeof t==`number`||typeof t==`boolean`||Array.isArray(t)&&typeof t[0]==`number`||S2(t)||t===``||`resize`in t){n[`${r&&r+`.`}${e}`]=t;return}x2(t)&&Object.keys(t).forEach(i=>{this.extractUniformsRecursively(i,t[i],n,`${r&&r+`.`}${e}`)}),Array.isArray(t)&&t.forEach((t,i)=>{Object.keys(t).forEach(a=>{this.extractUniformsRecursively(a,t[a],n,`${r&&r+`.`}${e}[${i}]`)})})}}}));function E2(e){return typeof WebGL2RenderingContext<`u`&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}var D2=o((()=>{})),O2,k2,A2,j2=o((()=>{S0(),kp(),w0(),H0(),i2(),o2(),d2(),T2(),l2(),D2(),O2=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),{isUndefined:k2}=tu,A2=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>this.device.queryVendorInfo().platformString,this.createModel=e=>new w2(this.device,e,this),this.createAttribute=e=>new C0(this.device,e),this.createBuffer=e=>new V0(this.device,e),this.createElements=e=>new a2(this.device,e),this.createTexture2D=e=>new c2(this.device,e),this.createFramebuffer=e=>new u2(this.device,e),this.useFramebuffer=(e,t)=>{this.currentFramebuffer=e,this.beginFrame(),t(),this.endFrame(),this.currentFramebuffer=null},this.useFramebufferAsync=(e,t)=>O2(this,null,function*(){this.currentFramebuffer=e,this.preRenderPass=this.renderPass,this.beginFrame(),yield t(),this.endFrame(),this.currentFramebuffer=null,this.renderPass=this.preRenderPass}),this.clear=e=>{let{color:t,depth:n,stencil:r,framebuffer:i=null}=e;if(i)i.clearOptions={color:t,depth:n,stencil:r};else{let e=this.queryVerdorInfo();if(e===`WebGL1`){let e=this.getGLContext();k2(r)?k2(n)||(e.clearDepth(n),e.clear(e.DEPTH_BUFFER_BIT)):(e.clearStencil(r),e.clear(e.STENCIL_BUFFER_BIT))}else if(e===`WebGL2`){let e=this.getGLContext();k2(r)?k2(n)||e.clearBufferfv(e.DEPTH,0,[n]):e.clearBufferiv(e.STENCIL,0,[r])}}},this.viewport=({width:e,height:t})=>{this.swapChain.configureSwapChain(e,t),this.createMainColorDepthRT(e,t),this.width=e,this.height=t},this.readPixels=e=>{let{framebuffer:t,x:n,y:r,width:i,height:a}=e,o=this.device.createReadback(),s=t.colorTexture,c=o.readTextureSync(s,n,this.viewportOrigin===c1.LOWER_LEFT?r:this.height-r,i,a,new Uint8Array(i*a*4));if(this.viewportOrigin!==c1.LOWER_LEFT)for(let e=0;e<c.length;e+=4){let t=c[e];c[e]=c[e+2],c[e+2]=t}return o.destroy(),c},this.readPixelsAsync=e=>O2(this,null,function*(){let{framebuffer:t,x:n,y:r,width:i,height:a}=e,o=this.device.createReadback(),s=t.colorTexture,c=yield o.readTexture(s,n,this.viewportOrigin===c1.LOWER_LEFT?r:this.height-r,i,a,new Uint8Array(i*a*4));if(this.viewportOrigin!==c1.LOWER_LEFT)for(let e=0;e<c.length;e+=4){let t=c[e];c[e]=c[e+2],c[e+2]=t}return o.destroy(),c}),this.getViewportSize=()=>({width:this.width,height:this.height}),this.getContainer=()=>this.canvas?.parentElement,this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.device.gl,this.destroy=()=>{var e;this.canvas=null,(e=this.uniformBuffers)==null||e.forEach(e=>{e.destroy()}),this.device.destroy(),this.renderCache.destroy()}}init(e,t){return O2(this,null,function*(){let{enableWebGPU:n,shaderCompilerPath:r,antialias:i}=t;this.canvas=e;let a=yield(n?new x0({shaderCompilerPath:r}):new q1({targets:[`webgl2`,`webgl1`],antialias:i,onContextLost(e){console.warn(`context lost`,e)},onContextCreationError(e){console.warn(`context creation error`,e)},onContextRestored(e){console.warn(`context restored`,e)}})).createSwapChain(e);a.configureSwapChain(e.width,e.height),this.device=a.getDevice(),this.swapChain=a,this.renderCache=new r2(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin;let o=this.device.gl;this.extensionObject={OES_texture_float:!E2(o)&&this.device.OES_texture_float},this.createMainColorDepthRT(e.width,e.height)})}createMainColorDepthRT(e,t){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:$.U8_RGBA_RT,width:e,height:t,usage:i1.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:$.D24_S8,width:e,height:t,usage:i1.RENDER_TARGET}))}beginFrame(){this.device.beginFrame();let{currentFramebuffer:e,swapChain:t,mainColorRT:n,mainDepthRT:r}=this,i=e?e.colorRenderTarget:n,a=e?null:t.getOnscreenTexture(),o=e?e.depthRenderTarget:r,{color:s=[0,0,0,0],depth:c=1,stencil:l=0}=e?.clearOptions||{},u=i?DZ(s[0]*255,s[1]*255,s[2]*255,s[3]):m1,d=o?c:void 0,f=o?l:void 0;this.renderPass=this.device.createRenderPass({colorAttachment:[i],colorResolveTo:[a],colorClearColor:[u],colorStore:[!0],depthStencilAttachment:o,depthClearValue:d,stencilClearValue:f})}endFrame(){this.device.submitPass(this.renderPass),this.device.endFrame()}getPointSizeRange(){let e=this.device.gl;return e.getParameter(e.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){}setBaseState(){}setCustomLayerDefaults(){}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}}})),M2=s(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):n.createREGL=r()})(e,(function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n=`
`;function r(e){return typeof atob<`u`?atob(e):`base64:`+e}function i(e){var t=Error(`(regl) `+e);throw console.error(t),t}function a(e,t){e||i(t)}function o(e){return e?`: `+e:``}function s(e,t,n){e in t||i(`unknown parameter (`+e+`)`+o(n)+`. possible values: `+Object.keys(t).join())}function c(t,n){e(t)||i(`invalid parameter type`+o(n)+`. must be a typed array`)}function l(e,t){switch(t){case`number`:return typeof e==`number`;case`object`:return typeof e==`object`;case`string`:return typeof e==`string`;case`boolean`:return typeof e==`boolean`;case`function`:return typeof e==`function`;case`undefined`:return e===void 0;case`symbol`:return typeof e==`symbol`}}function u(e,t,n){l(e,t)||i(`invalid parameter type`+o(n)+`. expected `+t+`, got `+typeof e)}function d(e,t){e>=0&&(e|0)===e||i(`invalid parameter type, (`+e+`)`+o(t)+`. must be a nonnegative integer`)}function f(e,t,n){t.indexOf(e)<0&&i(`invalid value`+o(n)+`. must be one of: `+t)}var p=[`gl`,`canvas`,`container`,`attributes`,`pixelRatio`,`extensions`,`optionalExtensions`,`profile`,`onDone`];function m(e){Object.keys(e).forEach(function(e){p.indexOf(e)<0&&i(`invalid regl constructor argument "`+e+`". must be one of `+p)})}function h(e,t){for(e+=``;e.length<t;)e=` `+e;return e}function g(){this.name=`unknown`,this.lines=[],this.index={},this.hasErrors=!1}function _(e,t){this.number=e,this.line=t,this.errors=[]}function v(e,t,n){this.file=e,this.line=t,this.message=n}function y(){var e=Error(),t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:`unknown`}function b(){var e=Error(),t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:`unknown`}function x(e,t){var n=e.split(`
`),i=1,a=0,o={unknown:new g,0:new g};o.unknown.name=o[0].name=t||y(),o.unknown.lines.push(new _(0,``));for(var s=0;s<n.length;++s){var c=n[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(c);if(l)switch(l[1]){case`line`:var u=/(\d+)(\s+\d+)?/.exec(l[2]);u&&(i=u[1]|0,u[2]&&(a=u[2]|0,a in o||(o[a]=new g)));break;case`define`:var d=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);d&&(o[a].name=d[1]?r(d[2]):d[2]);break}o[a].lines.push(new _(i++,c))}return Object.keys(o).forEach(function(e){var t=o[e];t.lines.forEach(function(e){t.index[e.number]=e})}),o}function S(e){var t=[];return e.split(`
`).forEach(function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new v(n[1]|0,n[2]|0,n[3].trim())):e.length>0&&t.push(new v(`unknown`,0,e))}}),t}function C(e,t){t.forEach(function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r){r.errors.push(t),n.hasErrors=!0;return}}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}function w(e,t,r,i,o){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),c=i===e.FRAGMENT_SHADER?`fragment`:`vertex`;M(r,`string`,c+` shader source must be a string`,o);var l=x(r,o);C(l,S(s)),Object.keys(l).forEach(function(e){var t=l[e];if(!t.hasErrors)return;var r=[``],i=[``];function a(e,t){r.push(e),i.push(t||``)}a(`file number `+e+`: `+t.name+`
`,`color:red;text-decoration:underline;font-weight:bold`),t.lines.forEach(function(e){if(e.errors.length>0){a(h(e.number,4)+`|  `,`background-color:yellow; font-weight:bold`),a(e.line+n,`color:red; background-color:yellow; font-weight:bold`);var t=0;e.errors.forEach(function(r){var i=r.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(o){var s=o[1];switch(i=o[2],s){case`assign`:s=`=`;break}t=Math.max(e.line.indexOf(s,t),0)}else t=0;a(h(`| `,6)),a(h(`^^^`,t+3)+n,`font-weight:bold`),a(h(`| `,6)),a(i+n,`font-weight:bold`)}),a(h(`| `,6)+n)}else a(h(e.number,4)+`|  `),a(e.line+n,`color:red`)}),typeof document<`u`&&!window.chrome?(i[0]=r.join(`%c`),console.log.apply(console,i)):console.log(r.join(``))}),a.raise(`Error compiling `+c+` shader, `+l[0].name)}}function E(e,t,r,i,o){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),c=x(r,o),l=`Error linking program with vertex shader, "`+x(i,o)[0].name+`", and fragment shader "`+c[0].name+`"`;typeof document<`u`?console.log(`%c`+l+n+`%c`+s,`color:red;text-decoration:underline;font-weight:bold`,`color:red`):console.log(l+n+s),a.raise(l)}}function D(e){e._commandRef=y()}function O(e,t,n,r){D(e);function i(e){return e?r.id(e):0}e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);function a(e,t){Object.keys(t).forEach(function(t){e[r.id(t)]=!0})}var o=e._uniformSet={};a(o,t.static),a(o,t.dynamic);var s=e._attributeSet={};a(s,n.static),a(s,n.dynamic),e._hasCount=`count`in e.static||`count`in e.dynamic||`elements`in e.static||`elements`in e.dynamic}function k(e,t){var n=b();i(e+` in command `+(t||y())+(n===`unknown`?``:` called from `+n))}function A(e,t,n){e||k(t,n||y())}function j(e,t,n,r){e in t||k(`unknown parameter (`+e+`)`+o(n)+`. possible values: `+Object.keys(t).join(),r||y())}function M(e,t,n,r){l(e,t)||k(`invalid parameter type`+o(n)+`. expected `+t+`, got `+typeof e,r||y())}function N(e){e()}function P(e,t,n){e.texture?f(e.texture._texture.internalformat,t,`unsupported texture format for attachment`):f(e.renderbuffer._renderbuffer.format,n,`unsupported renderbuffer format for attachment`)}var F=33071,I=9728,ee=9984,R=9985,z=9986,B=9987,te=5120,ne=5121,re=5122,V=5123,ie=5124,ae=5125,oe=5126,se=32819,ce=32820,H=33635,le=34042,ue=36193,de={};de[te]=de[ne]=1,de[re]=de[V]=de[ue]=de[H]=de[se]=de[ce]=2,de[ie]=de[ae]=de[oe]=de[le]=4;function U(e,t){return e===ce||e===se||e===H?2:e===le?4:de[e]*t}function fe(e){return!(e&e-1)&&!!e}function pe(e,t,n){var r,i=t.width,o=t.height,s=t.channels;a(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,`invalid texture shape`),(e.wrapS!==F||e.wrapT!==F)&&a(fe(i)&&fe(o),`incompatible wrap mode for texture, both width and height must be power of 2`),t.mipmask===1?i!==1&&o!==1&&a(e.minFilter!==ee&&e.minFilter!==z&&e.minFilter!==R&&e.minFilter!==B,`min filter requires mipmap`):(a(fe(i)&&fe(o),`texture must be a square power of 2 to support mipmapping`),a(t.mipmask===(i<<1)-1,`missing or incomplete mipmap data`)),t.type===oe&&(n.extensions.indexOf(`oes_texture_float_linear`)<0&&a(e.minFilter===I&&e.magFilter===I,`filter not supported, must enable oes_texture_float_linear`),a(!e.genMipmaps,`mipmap generation not supported with float textures`));var c=t.images;for(r=0;r<16;++r)if(c[r]){var l=i>>r,u=o>>r;a(t.mipmask&1<<r,`missing mipmap data`);var d=c[r];if(a(d.width===l&&d.height===u,`invalid shape for mip images`),a(d.format===t.format&&d.internalformat===t.internalformat&&d.type===t.type,`incompatible type for mip image`),!d.compressed)if(d.data){var f=Math.ceil(U(d.type,s)*l/d.unpackAlignment)*d.unpackAlignment;a(d.data.byteLength===f*u,`invalid data for image, buffer size is inconsistent with image format`)}else d.element||d.copy}else e.genMipmaps||a((t.mipmask&1<<r)==0,`extra mipmap data`);t.compressed&&a(!e.genMipmaps,`mipmap generation for compressed images not supported`)}function me(e,t,n,r){var i=e.width,o=e.height,s=e.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,`invalid texture shape`),a(i===o,`cube map must be square`),a(t.wrapS===F&&t.wrapT===F,`wrap mode not supported by cube map`);for(var c=0;c<n.length;++c){var l=n[c];a(l.width===i&&l.height===o,`inconsistent cube map face shape`),t.genMipmaps&&(a(!l.compressed,`can not generate mipmap for compressed textures`),a(l.mipmask===1,`can not specify mipmaps and generate mipmaps`));for(var u=l.images,d=0;d<16;++d){var f=u[d];if(f){var p=i>>d,m=o>>d;a(l.mipmask&1<<d,`missing mipmap data`),a(f.width===p&&f.height===m,`invalid shape for mip images`),a(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,`incompatible type for mip image`),f.compressed||(f.data?a(f.data.byteLength===p*m*Math.max(U(f.type,s),f.unpackAlignment),`invalid data for image, buffer size is inconsistent with image format`):f.element||f.copy)}}}}var W=t(a,{optional:N,raise:i,commandRaise:k,command:A,parameter:s,commandParameter:j,constructor:m,type:u,commandType:M,isTypedArray:c,nni:d,oneOf:f,shaderError:w,linkError:E,callSite:b,saveCommandRef:D,saveDrawInfo:O,framebufferFormat:P,guessCommand:y,texture2D:pe,textureCube:me}),he=0,ge=0;function _e(e,t){this.id=he++,this.type=e,this.data=t}function G(e){return e.replace(/\\/g,`\\\\`).replace(/"/g,`\\"`)}function K(e){if(e.length===0)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&(t===`"`||t===`'`))return[`"`+G(e.substr(1,e.length-2))+`"`];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return K(e.substr(0,r.index)).concat(K(r[1])).concat(K(e.substr(r.index+r[0].length)));var i=e.split(`.`);if(i.length===1)return[`"`+G(e)+`"`];for(var a=[],o=0;o<i.length;++o)a=a.concat(K(i[o]));return a}function ve(e){return`[`+K(e).join(`][`)+`]`}function ye(e,t){return new _e(e,ve(t+``))}function be(e){return typeof e==`function`&&!e._reglType||e instanceof _e}function xe(e,t){return typeof e==`function`?new _e(ge,e):e}var Se={DynamicVariable:_e,define:ye,isDynamic:be,unbox:xe,accessor:ve},Ce={next:typeof requestAnimationFrame==`function`?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:typeof cancelAnimationFrame==`function`?function(e){return cancelAnimationFrame(e)}:clearTimeout},we=typeof performance<`u`&&performance.now?function(){return performance.now()}:function(){return+new Date};function Te(){var e={"":0},t=[``];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}function Ee(e,n,r){var i=document.createElement(`canvas`);t(i.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(i),e===document.body&&(i.style.position=`absolute`,t(e.style,{margin:0,padding:0}));function a(){var n=window.innerWidth,a=window.innerHeight;if(e!==document.body){var o=e.getBoundingClientRect();n=o.right-o.left,a=o.bottom-o.top}i.width=r*n,i.height=r*a,t(i.style,{width:n+`px`,height:a+`px`})}var o;e!==document.body&&typeof ResizeObserver==`function`?(o=new ResizeObserver(function(){setTimeout(a)}),o.observe(e)):window.addEventListener(`resize`,a,!1);function s(){o?o.disconnect():window.removeEventListener(`resize`,a),e.removeChild(i)}return a(),{canvas:i,onDestroy:s}}function De(e,t){function n(n){try{return e.getContext(n,t)}catch{return null}}return n(`webgl`)||n(`experimental-webgl`)||n(`webgl-experimental`)}function Oe(e){return typeof e.nodeName==`string`&&typeof e.appendChild==`function`&&typeof e.getBoundingClientRect==`function`}function ke(e){return typeof e.drawArrays==`function`||typeof e.drawElements==`function`}function Ae(e){return typeof e==`string`?e.split():(W(Array.isArray(e),`invalid extension array`),e)}function je(e){return typeof e==`string`?(W(typeof document<`u`,`not supported outside of DOM`),document.querySelector(e)):e}function Me(e){var t=e||{},n,r,i,a,o={},s=[],c=[],l=typeof window>`u`?1:window.devicePixelRatio,u=!1,d=function(e){e&&W.raise(e)},f=function(){};if(typeof t==`string`?(W(typeof document<`u`,`selector queries only supported in DOM enviroments`),n=document.querySelector(t),W(n,`invalid query string for element`)):typeof t==`object`?Oe(t)?n=t:ke(t)?(a=t,i=a.canvas):(W.constructor(t),`gl`in t?a=t.gl:`canvas`in t?i=je(t.canvas):`container`in t&&(r=je(t.container)),`attributes`in t&&(o=t.attributes,W.type(o,`object`,`invalid context attributes`)),`extensions`in t&&(s=Ae(t.extensions)),`optionalExtensions`in t&&(c=Ae(t.optionalExtensions)),`onDone`in t&&(W.type(t.onDone,`function`,`invalid or missing onDone callback`),d=t.onDone),`profile`in t&&(u=!!t.profile),`pixelRatio`in t&&(l=+t.pixelRatio,W(l>0,`invalid pixel ratio`))):W.raise(`invalid arguments to regl`),n&&(n.nodeName.toLowerCase()===`canvas`?i=n:r=n),!a){if(!i){W(typeof document<`u`,`must manually specify webgl context outside of DOM environments`);var p=Ee(r||document.body,d,l);if(!p)return null;i=p.canvas,f=p.onDestroy}o.premultipliedAlpha===void 0&&(o.premultipliedAlpha=!0),a=De(i,o)}return a?{gl:a,canvas:i,container:r,extensions:s,optionalExtensions:c,pixelRatio:l,profile:u,onDone:d,onDestroy:f}:(f(),d(`webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org`),null)}function Ne(e,t){var n={};function r(t){W.type(t,`string`,`extension name must be string`);var r=t.toLowerCase(),i;try{i=n[r]=e.getExtension(r)}catch{}return!!i}for(var i=0;i<t.extensions.length;++i){var a=t.extensions[i];if(!r(a))return t.onDestroy(),t.onDone(`"`+a+`" extension is not supported by the current WebGL context, try upgrading your system or a different browser`),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach(function(e){if(n[e]&&!r(e))throw Error(`(regl): error restoring extension `+e)})}}}function Pe(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}var Fe=5120,Ie=5121,Le=5122,q=5123,Re=5124,ze=5125,Be=5126;function Ve(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function He(e){var t=(e>65535)<<4,n;return e>>>=t,n=(e>255)<<3,e>>>=n,t|=n,n=(e>15)<<2,e>>>=n,t|=n,n=(e>3)<<1,e>>>=n,t|=n,t|e>>1}function Ue(){var e=Pe(8,function(){return[]});function t(t){var n=Ve(t),r=e[He(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[He(t.byteLength)>>2].push(t)}function r(e,n){var r=null;switch(e){case Fe:r=new Int8Array(t(n),0,n);break;case Ie:r=new Uint8Array(t(n),0,n);break;case Le:r=new Int16Array(t(2*n),0,n);break;case q:r=new Uint16Array(t(2*n),0,n);break;case Re:r=new Int32Array(t(4*n),0,n);break;case ze:r=new Uint32Array(t(4*n),0,n);break;case Be:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length===n?r:r.subarray(0,n)}function i(e){n(e.buffer)}return{alloc:t,free:n,allocType:r,freeType:i}}var We=Ue();We.zero=Ue();var Ge=3408,Ke=3410,qe=3411,Je=3412,Ye=3413,Xe=3414,Ze=3415,Qe=33901,$e=33902,et=3379,tt=3386,nt=34921,rt=36347,it=36348,at=35661,ot=35660,st=34930,ct=36349,lt=34076,ut=34024,dt=7936,ft=7937,pt=7938,mt=35724,ht=34047,gt=36063,_t=34852,vt=3553,yt=34067,bt=34069,xt=33984,St=6408,Ct=5126,wt=5121,Tt=36160,Et=36053,Dt=36064,Ot=16384,kt=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(ht));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(_t),i=e.getParameter(gt));var a=!!t.oes_texture_float;if(a){var o=e.createTexture();e.bindTexture(vt,o),e.texImage2D(vt,0,St,1,1,0,St,Ct,null);var s=e.createFramebuffer();if(e.bindFramebuffer(Tt,s),e.framebufferTexture2D(Tt,Dt,vt,o,0),e.bindTexture(vt,null),e.checkFramebufferStatus(Tt)!==Et)a=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(Ot);var c=We.allocType(Ct,4);e.readPixels(0,0,1,1,St,Ct,c),e.getError()?a=!1:(e.deleteFramebuffer(s),e.deleteTexture(o),a=c[0]===1),We.freeType(c)}}var l=typeof navigator<`u`&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),u=!0;if(!l){var d=e.createTexture(),f=We.allocType(wt,36);e.activeTexture(xt),e.bindTexture(yt,d),e.texImage2D(bt,0,St,3,3,0,St,wt,f),We.freeType(f),e.bindTexture(yt,null),e.deleteTexture(d),u=!e.getError()}return{colorBits:[e.getParameter(Ke),e.getParameter(qe),e.getParameter(Je),e.getParameter(Ye)],depthBits:e.getParameter(Xe),stencilBits:e.getParameter(Ze),subpixelBits:e.getParameter(Ge),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(Qe),lineWidthDims:e.getParameter($e),maxViewportDims:e.getParameter(tt),maxCombinedTextureUnits:e.getParameter(at),maxCubeMapSize:e.getParameter(lt),maxRenderbufferSize:e.getParameter(ut),maxTextureUnits:e.getParameter(st),maxTextureSize:e.getParameter(et),maxAttributes:e.getParameter(nt),maxVertexUniforms:e.getParameter(rt),maxVertexTextureUnits:e.getParameter(ot),maxVaryingVectors:e.getParameter(it),maxFragmentUniforms:e.getParameter(ct),glsl:e.getParameter(mt),renderer:e.getParameter(ft),vendor:e.getParameter(dt),version:e.getParameter(pt),readFloat:a,npotTextureCube:u}};function At(t){return!!t&&typeof t==`object`&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&typeof t.offset==`number`&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var jt=function(e){return Object.keys(e).map(function(t){return e[t]})},Mt={shape:Rt,flatten:Lt};function Nt(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}function Pt(e,t,n,r){for(var i=0,a=0;a<t;++a)for(var o=e[a],s=0;s<n;++s)r[i++]=o[s]}function Ft(e,t,n,r,i,a){for(var o=a,s=0;s<t;++s)for(var c=e[s],l=0;l<n;++l)for(var u=c[l],d=0;d<r;++d)i[o++]=u[d]}function It(e,t,n,r,i){for(var a=1,o=n+1;o<t.length;++o)a*=t[o];var s=t[n];if(t.length-n===4){var c=t[n+1],l=t[n+2],u=t[n+3];for(o=0;o<s;++o)Ft(e[o],c,l,u,r,i),i+=a}else for(o=0;o<s;++o)It(e[o],t,n+1,r,i),i+=a}function Lt(e,t,n,r){var i=1;if(t.length)for(var a=0;a<t.length;++a)i*=t[a];else i=0;var o=r||We.allocType(n,i);switch(t.length){case 0:break;case 1:Nt(e,t[0],o);break;case 2:Pt(e,t[0],t[1],o);break;case 3:Ft(e,t[0],t[1],t[2],o,0);break;default:It(e,t,0,o,0)}return o}function Rt(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t}var zt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Bt={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Vt={dynamic:35048,stream:35040,static:35044},Ht=Mt.flatten,Ut=Mt.shape,Wt=35044,Gt=35040,Kt=5121,qt=5126,Jt=[];Jt[5120]=1,Jt[5122]=2,Jt[5124]=4,Jt[5121]=1,Jt[5123]=2,Jt[5125]=4,Jt[5126]=4;function Yt(e){return zt[Object.prototype.toString.call(e)]|0}function Xt(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function Zt(e,t,n,r,i,a,o){for(var s=0,c=0;c<n;++c)for(var l=0;l<r;++l)e[s++]=t[i*c+a*l+o]}function Qt(t,n,r,i){var a=0,o={};function s(e){this.id=a++,this.buffer=t.createBuffer(),this.type=e,this.usage=Wt,this.byteLength=0,this.dimension=1,this.dtype=Kt,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){p(this)};var c=[];function l(e,t){var n=c.pop();return n||=new s(e),n.bind(),f(n,t,Gt,0,1,!1),n}function u(e){c.push(e)}function d(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function f(t,n,r,i,a,o){var s;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||qt,n.length>0){var c;if(Array.isArray(n[0])){s=Ut(n);for(var l=1,u=1;u<s.length;++u)l*=s[u];t.dimension=l,c=Ht(n,s,t.dtype),d(t,c,r),o?t.persistentData=c:We.freeType(c)}else if(typeof n[0]==`number`){t.dimension=a;var f=We.allocType(t.dtype,n.length);Xt(f,n),d(t,f,r),o?t.persistentData=f:We.freeType(f)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||Yt(n[0])||qt,c=Ht(n,[n.length,n[0].length],t.dtype),d(t,c,r),o?t.persistentData=c:We.freeType(c)):W.raise(`invalid buffer data`)}}else if(e(n))t.dtype=i||Yt(n),t.dimension=a,d(t,n,r),o&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(At(n)){s=n.shape;var p=n.stride,m=n.offset,h=0,g=0,_=0,v=0;s.length===1?(h=s[0],g=1,_=p[0],v=0):s.length===2?(h=s[0],g=s[1],_=p[0],v=p[1]):W.raise(`invalid shape`),t.dtype=i||Yt(n.data)||qt,t.dimension=g;var y=We.allocType(t.dtype,h*g);Zt(y,n.data,h,g,_,v,m),d(t,y,r),o?t.persistentData=y:We.freeType(y)}else n instanceof ArrayBuffer?(t.dtype=Kt,t.dimension=a,d(t,n,r),o&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):W.raise(`invalid buffer data`)}function p(e){n.bufferCount--,i(e);var r=e.buffer;W(r,`buffer must not be deleted already`),t.deleteBuffer(r),e.buffer=null,delete o[e.id]}function m(i,a,c,l){n.bufferCount++;var u=new s(a);o[u.id]=u;function d(n){var i=Wt,a=null,o=0,s=0,c=1;return Array.isArray(n)||e(n)||At(n)||n instanceof ArrayBuffer?a=n:typeof n==`number`?o=n|0:n&&(W.type(n,`object`,`buffer arguments must be an object, a number or an array`),`data`in n&&(W(a===null||Array.isArray(a)||e(a)||At(a),`invalid data for buffer`),a=n.data),`usage`in n&&(W.parameter(n.usage,Vt,`invalid buffer usage`),i=Vt[n.usage]),`type`in n&&(W.parameter(n.type,Bt,`invalid buffer type`),s=Bt[n.type]),`dimension`in n&&(W.type(n.dimension,`number`,`invalid dimension`),c=n.dimension|0),`length`in n&&(W.nni(o,`buffer length must be a nonnegative integer`),o=n.length|0)),u.bind(),a?f(u,a,i,s,c,l):(o&&t.bufferData(u.type,o,i),u.dtype=s||Kt,u.usage=i,u.dimension=c,u.byteLength=o),r.profile&&(u.stats.size=u.byteLength*Jt[u.dtype]),d}function m(e,n){W(n+e.byteLength<=u.byteLength,`invalid buffer subdata call, buffer is too small.  Can't write data of size `+e.byteLength+` starting from offset `+n+` to a buffer of size `+u.byteLength),t.bufferSubData(u.type,n,e)}function h(t,n){var r=(n||0)|0,i;if(u.bind(),e(t)||t instanceof ArrayBuffer)m(t,r);else if(Array.isArray(t)){if(t.length>0)if(typeof t[0]==`number`){var a=We.allocType(u.dtype,t.length);Xt(a,t),m(a,r),We.freeType(a)}else if(Array.isArray(t[0])||e(t[0])){i=Ut(t);var o=Ht(t,i,u.dtype);m(o,r),We.freeType(o)}else W.raise(`invalid buffer data`)}else if(At(t)){i=t.shape;var s=t.stride,c=0,l=0,f=0,p=0;i.length===1?(c=i[0],l=1,f=s[0],p=0):i.length===2?(c=i[0],l=i[1],f=s[0],p=s[1]):W.raise(`invalid shape`);var h=Array.isArray(t.data)?u.dtype:Yt(t.data),g=We.allocType(h,c*l);Zt(g,t.data,c,l,f,p,t.offset),m(g,r),We.freeType(g)}else W.raise(`invalid data for buffer subdata`);return d}return c||d(i),d._reglType=`buffer`,d._buffer=u,d.subdata=h,r.profile&&(d.stats=u.stats),d.destroy=function(){p(u)},d}function h(){jt(o).forEach(function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(o).forEach(function(t){e+=o[t].stats.size}),e}),{create:m,createStream:l,destroyStream:u,clear:function(){jt(o).forEach(p),c.forEach(p)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:h,_initBuffer:f}}var $t={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},en=0,tn=1,nn=4,rn=5120,an=5121,on=5122,sn=5123,cn=5124,ln=5125,un=34963,dn=35040,fn=35044;function pn(t,n,r,i){var a={},o=0,s={uint8:an,uint16:sn};n.oes_element_index_uint&&(s.uint32=ln);function c(e){this.id=o++,a[this.id]=this,this.buffer=e,this.primType=nn,this.vertCount=0,this.type=0}c.prototype.bind=function(){this.buffer.bind()};var l=[];function u(e){var t=l.pop();return t||=new c(r.create(null,un,!0,!1)._buffer),f(t,e,dn,-1,-1,0,0),t}function d(e){l.push(e)}function f(i,a,o,s,c,l,u){i.buffer.bind();var d;if(a){var f=u;!u&&(!e(a)||At(a)&&!e(a.data))&&(f=n.oes_element_index_uint?ln:sn),r._initBuffer(i.buffer,a,o,f,3)}else t.bufferData(un,l,o),i.buffer.dtype=d||an,i.buffer.usage=o,i.buffer.dimension=3,i.buffer.byteLength=l;if(d=u,!u){switch(i.buffer.dtype){case an:case rn:d=an;break;case sn:case on:d=sn;break;case ln:case cn:d=ln;break;default:W.raise(`unsupported type for element array`)}i.buffer.dtype=d}i.type=d,W(d!==ln||!!n.oes_element_index_uint,`32 bit element buffers not supported, enable oes_element_index_uint first`);var p=c;p<0&&(p=i.buffer.byteLength,d===sn?p>>=1:d===ln&&(p>>=2)),i.vertCount=p;var m=s;if(s<0){m=nn;var h=i.buffer.dimension;h===1&&(m=en),h===2&&(m=tn),h===3&&(m=nn)}i.primType=m}function p(e){i.elementsCount--,W(e.buffer!==null,`must not double destroy elements`),delete a[e.id],e.buffer.destroy(),e.buffer=null}function m(t,n){var a=r.create(null,un,!0),o=new c(a._buffer);i.elementsCount++;function l(t){if(!t)a(),o.primType=nn,o.vertCount=0,o.type=an;else if(typeof t==`number`)a(t),o.primType=nn,o.vertCount=t|0,o.type=an;else{var n=null,r=fn,i=-1,c=-1,u=0,d=0;Array.isArray(t)||e(t)||At(t)?n=t:(W.type(t,`object`,`invalid arguments for elements`),`data`in t&&(n=t.data,W(Array.isArray(n)||e(n)||At(n),`invalid data for element buffer`)),`usage`in t&&(W.parameter(t.usage,Vt,`invalid element buffer usage`),r=Vt[t.usage]),`primitive`in t&&(W.parameter(t.primitive,$t,`invalid element buffer primitive`),i=$t[t.primitive]),`count`in t&&(W(typeof t.count==`number`&&t.count>=0,`invalid vertex count for elements`),c=t.count|0),`type`in t&&(W.parameter(t.type,s,`invalid buffer type`),d=s[t.type]),`length`in t?u=t.length|0:(u=c,d===sn||d===on?u*=2:(d===ln||d===cn)&&(u*=4))),f(o,n,r,i,c,u,d)}return l}return l(t),l._reglType=`elements`,l._elements=o,l.subdata=function(e,t){return a.subdata(e,t),l},l.destroy=function(){p(o)},l}return{create:m,createStream:u,destroyStream:d,getElements:function(e){return typeof e==`function`&&e._elements instanceof c?e._elements:null},clear:function(){jt(a).forEach(p)}}}var mn=new Float32Array(1),hn=new Uint32Array(mn.buffer),gn=5123;function _n(e){for(var t=We.allocType(gn,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{mn[0]=e[n];var r=hn[0],i=r>>>31<<15,a=(r<<1>>>24)-127,o=r>>13&1023;if(a<-24)t[n]=i;else if(a<-14){var s=-14-a;t[n]=i+(o+1024>>s)}else a>15?t[n]=i+31744:t[n]=i+(a+15<<10)+o}return t}function vn(t){return Array.isArray(t)||e(t)}var yn=function(e){return!(e&e-1)&&!!e},bn=34467,xn=3553,Sn=34067,Cn=34069,wn=6408,Tn=6406,En=6407,Dn=6409,On=6410,kn=32854,An=32855,jn=36194,Mn=32819,Nn=32820,Pn=33635,Fn=34042,In=6402,Ln=34041,Rn=35904,zn=35906,Bn=36193,Vn=33776,Hn=33777,Un=33778,Wn=33779,Gn=35986,Kn=35987,qn=34798,Jn=35840,Yn=35841,Xn=35842,Zn=35843,Qn=36196,$n=5121,er=5123,tr=5125,nr=5126,rr=10242,ir=10243,ar=10497,or=33071,sr=33648,cr=10240,lr=10241,ur=9728,dr=9729,fr=9984,pr=9985,mr=9986,hr=9987,gr=33170,_r=4352,vr=4353,yr=4354,br=34046,xr=3317,Sr=37440,Cr=37441,wr=37443,Tr=37444,Er=33984,Dr=[fr,mr,pr,hr],Or=[0,Dn,On,En,wn],kr={};kr[Dn]=kr[Tn]=kr[In]=1,kr[Ln]=kr[On]=2,kr[En]=kr[Rn]=3,kr[wn]=kr[zn]=4;function Ar(e){return`[object `+e+`]`}var jr=Ar(`HTMLCanvasElement`),Mr=Ar(`OffscreenCanvas`),Nr=Ar(`CanvasRenderingContext2D`),Pr=Ar(`ImageBitmap`),Fr=Ar(`HTMLImageElement`),Ir=Ar(`HTMLVideoElement`),Lr=Object.keys(zt).concat([jr,Mr,Nr,Pr,Fr,Ir]),Rr=[];Rr[$n]=1,Rr[nr]=4,Rr[Bn]=2,Rr[er]=2,Rr[tr]=4;var zr=[];zr[kn]=2,zr[An]=2,zr[jn]=2,zr[Ln]=4,zr[Vn]=.5,zr[Hn]=.5,zr[Un]=1,zr[Wn]=1,zr[Gn]=.5,zr[Kn]=1,zr[qn]=1,zr[Jn]=.5,zr[Yn]=.25,zr[Xn]=.5,zr[Zn]=.25,zr[Qn]=.5;function Br(e){return Array.isArray(e)&&(e.length===0||typeof e[0]==`number`)}function Vr(e){return!(!Array.isArray(e)||e.length===0||!vn(e[0]))}function Hr(e){return Object.prototype.toString.call(e)}function Ur(e){return Hr(e)===jr}function Wr(e){return Hr(e)===Mr}function Gr(e){return Hr(e)===Nr}function Kr(e){return Hr(e)===Pr}function qr(e){return Hr(e)===Fr}function Jr(e){return Hr(e)===Ir}function Yr(e){if(!e)return!1;var t=Hr(e);return Lr.indexOf(t)>=0?!0:Br(e)||Vr(e)||At(e)}function Xr(e){return zt[Object.prototype.toString.call(e)]|0}function Zr(e,t){var n=t.length;switch(e.type){case $n:case er:case tr:case nr:var r=We.allocType(e.type,n);r.set(t),e.data=r;break;case Bn:e.data=_n(t);break;default:W.raise(`unsupported texture type, must specify a typed array`)}}function Qr(e,t){return We.allocType(e.type===Bn?nr:e.type,t)}function $r(e,t){e.type===Bn?(e.data=_n(t),We.freeType(t)):e.data=t}function ei(e,t,n,r,i,a){for(var o=e.width,s=e.height,c=e.channels,l=Qr(e,o*s*c),u=0,d=0;d<s;++d)for(var f=0;f<o;++f)for(var p=0;p<c;++p)l[u++]=t[n*f+r*d+i*p+a];$r(e,l)}function ti(e,t,n,r,i,a){var o=zr[e]===void 0?kr[e]*Rr[t]:zr[e];if(a&&(o*=6),i){for(var s=0,c=n;c>=1;)s+=o*c*c,c/=2;return s}else return o*n*r}function ni(n,r,i,a,o,s,c){var l={"don't care":_r,"dont care":_r,nice:yr,fast:vr},u={repeat:ar,clamp:or,mirror:sr},d={nearest:ur,linear:dr},f=t({mipmap:hr,"nearest mipmap nearest":fr,"linear mipmap nearest":pr,"nearest mipmap linear":mr,"linear mipmap linear":hr},d),p={none:0,browser:Tr},m={uint8:$n,rgba4:Mn,rgb565:Pn,"rgb5 a1":Nn},h={alpha:Tn,luminance:Dn,"luminance alpha":On,rgb:En,rgba:wn,rgba4:kn,"rgb5 a1":An,rgb565:jn},g={};r.ext_srgb&&(h.srgb=Rn,h.srgba=zn),r.oes_texture_float&&(m.float32=m.float=nr),r.oes_texture_half_float&&(m.float16=m[`half float`]=Bn),r.webgl_depth_texture&&(t(h,{depth:In,"depth stencil":Ln}),t(m,{uint16:er,uint32:tr,"depth stencil":Fn})),r.webgl_compressed_texture_s3tc&&t(g,{"rgb s3tc dxt1":Vn,"rgba s3tc dxt1":Hn,"rgba s3tc dxt3":Un,"rgba s3tc dxt5":Wn}),r.webgl_compressed_texture_atc&&t(g,{"rgb atc":Gn,"rgba atc explicit alpha":Kn,"rgba atc interpolated alpha":qn}),r.webgl_compressed_texture_pvrtc&&t(g,{"rgb pvrtc 4bppv1":Jn,"rgb pvrtc 2bppv1":Yn,"rgba pvrtc 4bppv1":Xn,"rgba pvrtc 2bppv1":Zn}),r.webgl_compressed_texture_etc1&&(g[`rgb etc1`]=Qn);var _=Array.prototype.slice.call(n.getParameter(bn));Object.keys(g).forEach(function(e){var t=g[e];_.indexOf(t)>=0&&(h[e]=t)});var v=Object.keys(h);i.textureFormats=v;var y=[];Object.keys(h).forEach(function(e){var t=h[e];y[t]=e});var b=[];Object.keys(m).forEach(function(e){var t=m[e];b[t]=e});var x=[];Object.keys(d).forEach(function(e){var t=d[e];x[t]=e});var S=[];Object.keys(f).forEach(function(e){var t=f[e];S[t]=e});var C=[];Object.keys(u).forEach(function(e){var t=u[e];C[t]=e});var w=v.reduce(function(e,t){var n=h[t];return n===Dn||n===Tn||n===Dn||n===On||n===In||n===Ln||r.ext_srgb&&(n===Rn||n===zn)?e[n]=n:n===An||t.indexOf(`rgba`)>=0?e[n]=wn:e[n]=En,e},{});function E(){this.internalformat=wn,this.format=wn,this.type=$n,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Tr,this.width=0,this.height=0,this.channels=0}function D(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function O(e,t){if(!(typeof t!=`object`||!t)){if(`premultiplyAlpha`in t&&(W.type(t.premultiplyAlpha,`boolean`,`invalid premultiplyAlpha`),e.premultiplyAlpha=t.premultiplyAlpha),`flipY`in t&&(W.type(t.flipY,`boolean`,`invalid texture flip`),e.flipY=t.flipY),`alignment`in t&&(W.oneOf(t.alignment,[1,2,4,8],`invalid texture unpack alignment`),e.unpackAlignment=t.alignment),`colorSpace`in t&&(W.parameter(t.colorSpace,p,`invalid colorSpace`),e.colorSpace=p[t.colorSpace]),`type`in t){var n=t.type;W(r.oes_texture_float||!(n===`float`||n===`float32`),`you must enable the OES_texture_float extension in order to use floating point textures.`),W(r.oes_texture_half_float||!(n===`half float`||n===`float16`),`you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.`),W(r.webgl_depth_texture||!(n===`uint16`||n===`uint32`||n===`depth stencil`),`you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.`),W.parameter(n,m,`invalid texture type`),e.type=m[n]}var a=e.width,o=e.height,s=e.channels,c=!1;`shape`in t?(W(Array.isArray(t.shape)&&t.shape.length>=2,`shape must be an array`),a=t.shape[0],o=t.shape[1],t.shape.length===3&&(s=t.shape[2],W(s>0&&s<=4,`invalid number of channels`),c=!0),W(a>=0&&a<=i.maxTextureSize,`invalid width`),W(o>=0&&o<=i.maxTextureSize,`invalid height`)):(`radius`in t&&(a=o=t.radius,W(a>=0&&a<=i.maxTextureSize,`invalid radius`)),`width`in t&&(a=t.width,W(a>=0&&a<=i.maxTextureSize,`invalid width`)),`height`in t&&(o=t.height,W(o>=0&&o<=i.maxTextureSize,`invalid height`)),`channels`in t&&(s=t.channels,W(s>0&&s<=4,`invalid number of channels`),c=!0)),e.width=a|0,e.height=o|0,e.channels=s|0;var l=!1;if(`format`in t){var u=t.format;W(r.webgl_depth_texture||!(u===`depth`||u===`depth stencil`),`you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.`),W.parameter(u,h,`invalid texture format`),e.format=w[e.internalformat=h[u]],u in m&&(`type`in t||(e.type=m[u])),u in g&&(e.compressed=!0),l=!0}!c&&l?e.channels=kr[e.format]:c&&!l?e.channels!==Or[e.format]&&(e.format=e.internalformat=Or[e.channels]):l&&c&&W(e.channels===kr[e.format],`number of channels inconsistent with specified format`)}}function k(e){n.pixelStorei(Sr,e.flipY),n.pixelStorei(Cr,e.premultiplyAlpha),n.pixelStorei(wr,e.colorSpace),n.pixelStorei(xr,e.unpackAlignment)}function A(){E.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function j(t,n){var r=null;if(Yr(n)?r=n:n&&(W.type(n,`object`,`invalid pixel data type`),O(t,n),`x`in n&&(t.xOffset=n.x|0),`y`in n&&(t.yOffset=n.y|0),Yr(n.data)&&(r=n.data)),W(!t.compressed||r instanceof Uint8Array,`compressed texture data must be stored in a uint8array`),n.copy){W(!r,`can not specify copy and data field for the same texture`);var a=o.viewportWidth,s=o.viewportHeight;t.width=t.width||a-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,W(t.xOffset>=0&&t.xOffset<a&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=a&&t.height>0&&t.height<=s,`copy texture read out of bounds`)}else if(!r)t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;else if(e(r))t.channels=t.channels||4,t.data=r,!(`type`in n)&&t.type===$n&&(t.type=Xr(r));else if(Br(r))t.channels=t.channels||4,Zr(t,r),t.alignment=1,t.needsFree=!0;else if(At(r)){var c=r.data;!Array.isArray(c)&&t.type===$n&&(t.type=Xr(c));var l=r.shape,u=r.stride,d,f,p,m,h,g;l.length===3?(p=l[2],g=u[2]):(W(l.length===2,`invalid ndarray pixel data, must be 2 or 3D`),p=1,g=1),d=l[0],f=l[1],m=u[0],h=u[1],t.alignment=1,t.width=d,t.height=f,t.channels=p,t.format=t.internalformat=Or[p],t.needsFree=!0,ei(t,c,m,h,g,r.offset)}else if(Ur(r)||Wr(r)||Gr(r))Ur(r)||Wr(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(Kr(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(qr(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(Jr(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(Vr(r)){var _=t.width||r[0].length,v=t.height||r.length,y=t.channels;vn(r[0][0])?y||=r[0][0].length:y||=1;for(var b=Mt.shape(r),x=1,S=0;S<b.length;++S)x*=b[S];var C=Qr(t,x);Mt.flatten(r,b,``,C),$r(t,C),t.alignment=1,t.width=_,t.height=v,t.channels=y,t.format=t.internalformat=Or[y],t.needsFree=!0}t.type===nr?W(i.extensions.indexOf(`oes_texture_float`)>=0,`oes_texture_float extension not enabled`):t.type===Bn&&W(i.extensions.indexOf(`oes_texture_half_float`)>=0,`oes_texture_half_float extension not enabled`)}function M(e,t,r){var i=e.element,o=e.data,s=e.internalformat,c=e.format,l=e.type,u=e.width,d=e.height;k(e),i?n.texImage2D(t,r,c,c,l,i):e.compressed?n.compressedTexImage2D(t,r,s,u,d,0,o):e.needsCopy?(a(),n.copyTexImage2D(t,r,c,e.xOffset,e.yOffset,u,d,0)):n.texImage2D(t,r,c,u,d,0,c,l,o||null)}function N(e,t,r,i,o){var s=e.element,c=e.data,l=e.internalformat,u=e.format,d=e.type,f=e.width,p=e.height;k(e),s?n.texSubImage2D(t,o,r,i,u,d,s):e.compressed?n.compressedTexSubImage2D(t,o,r,i,l,f,p,c):e.needsCopy?(a(),n.copyTexSubImage2D(t,o,r,i,e.xOffset,e.yOffset,f,p)):n.texSubImage2D(t,o,r,i,f,p,u,d,c)}var P=[];function F(){return P.pop()||new A}function I(e){e.needsFree&&We.freeType(e.data),A.call(e),P.push(e)}function ee(){E.call(this),this.genMipmaps=!1,this.mipmapHint=_r,this.mipmask=0,this.images=Array(16)}function R(e,t,n){var r=e.images[0]=F();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function z(e,t){var n=null;if(Yr(t))n=e.images[0]=F(),D(n,e),j(n,t),e.mipmask=1;else if(O(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)n=e.images[i]=F(),D(n,e),n.width>>=i,n.height>>=i,j(n,r[i]),e.mipmask|=1<<i;else n=e.images[0]=F(),D(n,e),j(n,t),e.mipmask=1;D(e,e.images[0]),e.compressed&&(e.internalformat===Vn||e.internalformat===Hn||e.internalformat===Un||e.internalformat===Wn)&&W(e.width%4==0&&e.height%4==0,`for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4`)}function B(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;M(n[r],t,r)}}var te=[];function ne(){var e=te.pop()||new ee;E.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function re(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&I(t[n]),t[n]=null;te.push(e)}function V(){this.minFilter=ur,this.magFilter=ur,this.wrapS=or,this.wrapT=or,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=_r}function ie(e,t){if(`min`in t){var n=t.min;W.parameter(n,f),e.minFilter=f[n],Dr.indexOf(e.minFilter)>=0&&!(`faces`in t)&&(e.genMipmaps=!0)}if(`mag`in t){var r=t.mag;W.parameter(r,d),e.magFilter=d[r]}var a=e.wrapS,o=e.wrapT;if(`wrap`in t){var s=t.wrap;typeof s==`string`?(W.parameter(s,u),a=o=u[s]):Array.isArray(s)&&(W.parameter(s[0],u),W.parameter(s[1],u),a=u[s[0]],o=u[s[1]])}else{if(`wrapS`in t){var c=t.wrapS;W.parameter(c,u),a=u[c]}if(`wrapT`in t){var p=t.wrapT;W.parameter(p,u),o=u[p]}}if(e.wrapS=a,e.wrapT=o,`anisotropic`in t){var m=t.anisotropic;W(typeof m==`number`&&m>=1&&m<=i.maxAnisotropic,`aniso samples must be between 1 and `),e.anisotropic=t.anisotropic}if(`mipmap`in t){var h=!1;switch(typeof t.mipmap){case`string`:W.parameter(t.mipmap,l,`invalid mipmap hint`),e.mipmapHint=l[t.mipmap],e.genMipmaps=!0,h=!0;break;case`boolean`:h=e.genMipmaps=t.mipmap;break;case`object`:W(Array.isArray(t.mipmap),`invalid mipmap type`),e.genMipmaps=!1,h=!0;break;default:W.raise(`invalid mipmap type`)}h&&!(`min`in t)&&(e.minFilter=fr)}}function ae(e,t){n.texParameteri(t,lr,e.minFilter),n.texParameteri(t,cr,e.magFilter),n.texParameteri(t,rr,e.wrapS),n.texParameteri(t,ir,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,br,e.anisotropic),e.genMipmaps&&(n.hint(gr,e.mipmapHint),n.generateMipmap(t))}var oe=0,se={},ce=i.maxTextureUnits,H=Array(ce).map(function(){return null});function le(e){E.call(this),this.mipmask=0,this.internalformat=wn,this.id=oe++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new V,c.profile&&(this.stats={size:0})}function ue(e){n.activeTexture(Er),n.bindTexture(e.target,e.texture)}function de(){var e=H[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(xn,null)}function U(e){var t=e.texture;W(t,`must not double destroy texture`);var r=e.unit,i=e.target;r>=0&&(n.activeTexture(Er+r),n.bindTexture(i,null),H[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete se[e.id],s.textureCount--}t(le.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<ce;++r){var i=H[r];if(i){if(i.bindCount>0)continue;i.unit=-1}H[r]=e,t=r;break}t>=ce&&W.raise(`insufficient number of texture units`),c.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),e.unit=t,n.activeTexture(Er+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){--this.bindCount},decRef:function(){--this.refCount<=0&&U(this)}});function fe(e,t){var r=new le(xn);se[r.id]=r,s.textureCount++;function a(e,t){var n=r.texInfo;V.call(n);var o=ne();return typeof e==`number`?typeof t==`number`?R(o,e|0,t|0):R(o,e|0,e|0):e?(W.type(e,`object`,`invalid arguments to regl.texture`),ie(n,e),z(o,e)):R(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),r.mipmask=o.mipmask,D(r,o),W.texture2D(n,o,i),r.internalformat=o.internalformat,a.width=o.width,a.height=o.height,ue(r),B(o,xn),ae(n,xn),de(),re(o),c.profile&&(r.stats.size=ti(r.internalformat,r.type,o.width,o.height,n.genMipmaps,!1)),a.format=y[r.internalformat],a.type=b[r.type],a.mag=x[n.magFilter],a.min=S[n.minFilter],a.wrapS=C[n.wrapS],a.wrapT=C[n.wrapT],a}function o(e,t,n,i){W(!!e,`must specify image data`);var o=t|0,s=n|0,c=i|0,l=F();return D(l,r),l.width=0,l.height=0,j(l,e),l.width=l.width||(r.width>>c)-o,l.height=l.height||(r.height>>c)-s,W(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,`incompatible format for texture.subimage`),W(o>=0&&s>=0&&o+l.width<=r.width&&s+l.height<=r.height,`texture.subimage write out of bounds`),W(r.mipmask&1<<c,`missing mipmap data`),W(l.data||l.element||l.needsCopy,`missing image data`),ue(r),N(l,xn,o,s,c),de(),I(l),a}function l(e,t){var i=e|0,o=t|0||i;if(i===r.width&&o===r.height)return a;a.width=r.width=i,a.height=r.height=o,ue(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,u=o>>s;if(!l||!u)break;n.texImage2D(xn,s,r.format,l,u,0,r.format,r.type,null)}return de(),c.profile&&(r.stats.size=ti(r.internalformat,r.type,i,o,!1,!1)),a}return a(e,t),a.subimage=o,a.resize=l,a._reglType=`texture2d`,a._texture=r,c.profile&&(a.stats=r.stats),a.destroy=function(){r.decRef()},a}function pe(e,t,r,a,o,l){var u=new le(Sn);se[u.id]=u,s.cubeCount++;var d=[,,,,,,];function f(e,t,n,r,a,o){var s,l=u.texInfo;for(V.call(l),s=0;s<6;++s)d[s]=ne();if(typeof e==`number`||!e){var p=e|0||1;for(s=0;s<6;++s)R(d[s],p,p)}else if(typeof e==`object`)if(t)z(d[0],e),z(d[1],t),z(d[2],n),z(d[3],r),z(d[4],a),z(d[5],o);else if(ie(l,e),O(u,e),`faces`in e){var m=e.faces;for(W(Array.isArray(m)&&m.length===6,`cube faces must be a length 6 array`),s=0;s<6;++s)W(typeof m[s]==`object`&&!!m[s],`invalid input for cube map face`),D(d[s],u),z(d[s],m[s])}else for(s=0;s<6;++s)z(d[s],e);else W.raise(`invalid arguments to cube map`);for(D(u,d[0]),i.npotTextureCube||W(yn(u.width)&&yn(u.height),`your browser does not support non power or two texture dimensions`),l.genMipmaps?u.mipmask=(d[0].width<<1)-1:u.mipmask=d[0].mipmask,W.textureCube(u,l,d,i),u.internalformat=d[0].internalformat,f.width=d[0].width,f.height=d[0].height,ue(u),s=0;s<6;++s)B(d[s],Cn+s);for(ae(l,Sn),de(),c.profile&&(u.stats.size=ti(u.internalformat,u.type,f.width,f.height,l.genMipmaps,!0)),f.format=y[u.internalformat],f.type=b[u.type],f.mag=x[l.magFilter],f.min=S[l.minFilter],f.wrapS=C[l.wrapS],f.wrapT=C[l.wrapT],s=0;s<6;++s)re(d[s]);return f}function p(e,t,n,r,i){W(!!t,`must specify image data`),W(typeof e==`number`&&e===(e|0)&&e>=0&&e<6,`invalid face`);var a=n|0,o=r|0,s=i|0,c=F();return D(c,u),c.width=0,c.height=0,j(c,t),c.width=c.width||(u.width>>s)-a,c.height=c.height||(u.height>>s)-o,W(u.type===c.type&&u.format===c.format&&u.internalformat===c.internalformat,`incompatible format for texture.subimage`),W(a>=0&&o>=0&&a+c.width<=u.width&&o+c.height<=u.height,`texture.subimage write out of bounds`),W(u.mipmask&1<<s,`missing mipmap data`),W(c.data||c.element||c.needsCopy,`missing image data`),ue(u),N(c,Cn+e,a,o,s),de(),I(c),f}function m(e){var t=e|0;if(t!==u.width){f.width=u.width=t,f.height=u.height=t,ue(u);for(var r=0;r<6;++r)for(var i=0;u.mipmask>>i;++i)n.texImage2D(Cn+r,i,u.format,t>>i,t>>i,0,u.format,u.type,null);return de(),c.profile&&(u.stats.size=ti(u.internalformat,u.type,f.width,f.height,!1,!0)),f}}return f(e,t,r,a,o,l),f.subimage=p,f.resize=m,f._reglType=`textureCube`,f._texture=u,c.profile&&(f.stats=u.stats),f.destroy=function(){u.decRef()},f}function me(){for(var e=0;e<ce;++e)n.activeTexture(Er+e),n.bindTexture(xn,null),H[e]=null;jt(se).forEach(U),s.cubeCount=0,s.textureCount=0}c.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(se).forEach(function(t){e+=se[t].stats.size}),e});function he(){for(var e=0;e<ce;++e){var t=H[e];t&&(t.bindCount=0,t.unit=-1,H[e]=null)}jt(se).forEach(function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(e.mipmask&1<<t)if(e.target===xn)n.texImage2D(xn,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(Cn+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);ae(e.texInfo,e.target)})}return{create2D:fe,createCube:pe,clear:me,getTexture:function(e){return null},restore:he}}var ri=36161,ii=32854,ai=32855,oi=36194,si=33189,ci=36168,li=34041,ui=35907,di=34836,fi=34842,pi=34843,mi=[];mi[ii]=2,mi[ai]=2,mi[oi]=2,mi[si]=2,mi[ci]=1,mi[li]=4,mi[ui]=4,mi[di]=16,mi[fi]=8,mi[pi]=6;function hi(e,t,n){return mi[e]*t*n}var gi=function(e,t,n,r,i){var a={rgba4:ii,rgb565:oi,"rgb5 a1":ai,depth:si,stencil:ci,"depth stencil":li};t.ext_srgb&&(a.srgba=ui),t.ext_color_buffer_half_float&&(a.rgba16f=fi,a.rgb16f=pi),t.webgl_color_buffer_float&&(a.rgba32f=di);var o=[];Object.keys(a).forEach(function(e){var t=a[e];o[t]=e});var s=0,c={};function l(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=ii,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}l.prototype.decRef=function(){--this.refCount<=0&&u(this)};function u(t){var n=t.renderbuffer;W(n,`must not double destroy renderbuffer`),e.bindRenderbuffer(ri,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete c[t.id],r.renderbufferCount--}function d(t,s){var u=new l(e.createRenderbuffer());c[u.id]=u,r.renderbufferCount++;function d(t,r){var s=0,c=0,l=ii;if(typeof t==`object`&&t){var f=t;if(`shape`in f){var p=f.shape;W(Array.isArray(p)&&p.length>=2,`invalid renderbuffer shape`),s=p[0]|0,c=p[1]|0}else `radius`in f&&(s=c=f.radius|0),`width`in f&&(s=f.width|0),`height`in f&&(c=f.height|0);`format`in f&&(W.parameter(f.format,a,`invalid renderbuffer format`),l=a[f.format])}else typeof t==`number`?(s=t|0,c=typeof r==`number`?r|0:s):t?W.raise(`invalid arguments to renderbuffer constructor`):s=c=1;if(W(s>0&&c>0&&s<=n.maxRenderbufferSize&&c<=n.maxRenderbufferSize,`invalid renderbuffer size`),!(s===u.width&&c===u.height&&l===u.format))return d.width=u.width=s,d.height=u.height=c,u.format=l,e.bindRenderbuffer(ri,u.renderbuffer),e.renderbufferStorage(ri,l,s,c),W(e.getError()===0,`invalid render buffer format`),i.profile&&(u.stats.size=hi(u.format,u.width,u.height)),d.format=o[u.format],d}function f(t,r){var a=t|0,o=r|0||a;return a===u.width&&o===u.height?d:(W(a>0&&o>0&&a<=n.maxRenderbufferSize&&o<=n.maxRenderbufferSize,`invalid renderbuffer size`),d.width=u.width=a,d.height=u.height=o,e.bindRenderbuffer(ri,u.renderbuffer),e.renderbufferStorage(ri,u.format,a,o),W(e.getError()===0,`invalid render buffer format`),i.profile&&(u.stats.size=hi(u.format,u.width,u.height)),d)}return d(t,s),d.resize=f,d._reglType=`renderbuffer`,d._renderbuffer=u,i.profile&&(d.stats=u.stats),d.destroy=function(){u.decRef()},d}i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(c).forEach(function(t){e+=c[t].stats.size}),e});function f(){jt(c).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(ri,t.renderbuffer),e.renderbufferStorage(ri,t.format,t.width,t.height)}),e.bindRenderbuffer(ri,null)}return{create:d,clear:function(){jt(c).forEach(u)},restore:f}},_i=36160,vi=36161,yi=3553,bi=34069,xi=36064,Si=36096,Ci=36128,wi=33306,Ti=36053,Ei=36054,Di=36055,Oi=36057,ki=36061,Ai=36193,ji=5121,Mi=5126,Ni=6407,Pi=6408,Fi=6402,Ii=[Ni,Pi],Li=[];Li[Pi]=4,Li[Ni]=3;var Ri=[];Ri[ji]=1,Ri[Mi]=4,Ri[Ai]=2;var zi=32854,Bi=32855,Vi=36194,Hi=33189,Ui=36168,Wi=34041,Gi=[zi,Bi,Vi,35907,34842,34843,34836],Ki={};Ki[Ti]=`complete`,Ki[Ei]=`incomplete attachment`,Ki[Oi]=`incomplete dimensions`,Ki[Di]=`incomplete, missing attachment`,Ki[ki]=`unsupported`;function qi(e,n,r,i,a,o){var s={cur:null,next:null,dirty:!1,setFBO:null},c=[`rgba`],l=[`rgba4`,`rgb565`,`rgb5 a1`];n.ext_srgb&&l.push(`srgba`),n.ext_color_buffer_half_float&&l.push(`rgba16f`,`rgb16f`),n.webgl_color_buffer_float&&l.push(`rgba32f`);var u=[`uint8`];n.oes_texture_half_float&&u.push(`half float`,`float16`),n.oes_texture_float&&u.push(`float`,`float32`);function d(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),a=Math.max(1,r.height);W(i===t&&a===n,`inconsistent width/height for supplied texture`),r.refCount+=1}else{var o=e.renderbuffer._renderbuffer;W(o.width===t&&o.height===n,`inconsistent width/height for renderbuffer`),o.refCount+=1}}function m(t,n){n&&(n.texture?e.framebufferTexture2D(_i,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(_i,t,vi,n.renderbuffer._renderbuffer.renderbuffer))}function h(e){var t=yi,n=null,r=null,i=e;typeof e==`object`&&(i=e.data,`target`in e&&(t=e.target|0)),W.type(i,`function`,`invalid attachment data`);var a=i._reglType;return a===`texture2d`?(n=i,W(t===yi)):a===`textureCube`?(n=i,W(t>=bi&&t<bi+6,`invalid cube map target`)):a===`renderbuffer`?(r=i,t=vi):W.raise(`invalid regl object for attachment`),new d(t,n,r)}function g(e,t,n,r,o){if(n){var s=i.create2D({width:e,height:t,format:r,type:o});return s._texture.refCount=0,new d(yi,s,null)}else{var c=a.create({width:e,height:t,format:r});return c._renderbuffer.refCount=0,new d(vi,null,c)}}function _(e){return e&&(e.texture||e.renderbuffer)}function v(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}var y=0,b={};function x(){this.id=y++,b[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function S(e){e.colorAttachments.forEach(f),f(e.depthAttachment),f(e.stencilAttachment),f(e.depthStencilAttachment)}function C(t){var n=t.framebuffer;W(n,`must not double destroy framebuffer`),e.deleteFramebuffer(n),t.framebuffer=null,o.framebufferCount--,delete b[t.id]}function w(t){var n;e.bindFramebuffer(_i,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)m(xi+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(_i,xi+n,yi,null,0);e.framebufferTexture2D(_i,wi,yi,null,0),e.framebufferTexture2D(_i,Si,yi,null,0),e.framebufferTexture2D(_i,Ci,yi,null,0),m(Si,t.depthAttachment),m(Ci,t.stencilAttachment),m(wi,t.depthStencilAttachment);var a=e.checkFramebufferStatus(_i);!e.isContextLost()&&a!==Ti&&W.raise(`framebuffer configuration not supported, status = `+Ki[a]),e.bindFramebuffer(_i,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function E(e,i){var a=new x;o.framebufferCount++;function d(e,t){var i;W(s.next!==a,`can not update framebuffer which is currently in use`);var o=0,f=0,m=!0,v=!0,y=null,b=!0,x=`rgba`,C=`uint8`,E=1,D=null,O=null,k=null,A=!1;if(typeof e==`number`)o=e|0,f=t|0||o;else if(!e)o=f=1;else{W.type(e,`object`,`invalid arguments for framebuffer`);var j=e;if(`shape`in j){var M=j.shape;W(Array.isArray(M)&&M.length>=2,`invalid shape for framebuffer`),o=M[0],f=M[1]}else `radius`in j&&(o=f=j.radius),`width`in j&&(o=j.width),`height`in j&&(f=j.height);(`color`in j||`colors`in j)&&(y=j.color||j.colors,Array.isArray(y)&&W(y.length===1||n.webgl_draw_buffers,`multiple render targets not supported`)),y||(`colorCount`in j&&(E=j.colorCount|0,W(E>0,`invalid color buffer count`)),`colorTexture`in j&&(b=!!j.colorTexture,x=`rgba4`),`colorType`in j&&(C=j.colorType,b?(W(n.oes_texture_float||!(C===`float`||C===`float32`),`you must enable OES_texture_float in order to use floating point framebuffer objects`),W(n.oes_texture_half_float||!(C===`half float`||C===`float16`),`you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects`)):C===`half float`||C===`float16`?(W(n.ext_color_buffer_half_float,`you must enable EXT_color_buffer_half_float to use 16-bit render buffers`),x=`rgba16f`):(C===`float`||C===`float32`)&&(W(n.webgl_color_buffer_float,`you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers`),x=`rgba32f`),W.oneOf(C,u,`invalid color type`)),`colorFormat`in j&&(x=j.colorFormat,c.indexOf(x)>=0?b=!0:l.indexOf(x)>=0?b=!1:b?W.oneOf(j.colorFormat,c,`invalid color format for texture`):W.oneOf(j.colorFormat,l,`invalid color format for renderbuffer`))),(`depthTexture`in j||`depthStencilTexture`in j)&&(A=!!(j.depthTexture||j.depthStencilTexture),W(!A||n.webgl_depth_texture,`webgl_depth_texture extension not supported`)),`depth`in j&&(typeof j.depth==`boolean`?m=j.depth:(D=j.depth,v=!1)),`stencil`in j&&(typeof j.stencil==`boolean`?v=j.stencil:(O=j.stencil,m=!1)),`depthStencil`in j&&(typeof j.depthStencil==`boolean`?m=v=j.depthStencil:(k=j.depthStencil,m=!1,v=!1))}var N=null,P=null,F=null,I=null;if(Array.isArray(y))N=y.map(h);else if(y)N=[h(y)];else for(N=Array(E),i=0;i<E;++i)N[i]=g(o,f,b,x,C);W(n.webgl_draw_buffers||N.length<=1,`you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.`),W(N.length<=r.maxColorAttachments,`too many color attachments, not supported`),o||=N[0].width,f||=N[0].height,D?P=h(D):m&&!v&&(P=g(o,f,A,`depth`,`uint32`)),O?F=h(O):v&&!m&&(F=g(o,f,!1,`stencil`,`uint8`)),k?I=h(k):!D&&!O&&v&&m&&(I=g(o,f,A,`depth stencil`,`depth stencil`)),W(!!D+!!O+!!k<=1,`invalid framebuffer configuration, can specify exactly one depth/stencil attachment`);var ee=null;for(i=0;i<N.length;++i)if(p(N[i],o,f),W(!N[i]||N[i].texture&&Ii.indexOf(N[i].texture._texture.format)>=0||N[i].renderbuffer&&Gi.indexOf(N[i].renderbuffer._renderbuffer.format)>=0,`framebuffer color attachment `+i+` is invalid`),N[i]&&N[i].texture){var R=Li[N[i].texture._texture.format]*Ri[N[i].texture._texture.type];ee===null?ee=R:W(ee===R,`all color attachments much have the same number of bits per pixel.`)}return p(P,o,f),W(!P||P.texture&&P.texture._texture.format===Fi||P.renderbuffer&&P.renderbuffer._renderbuffer.format===Hi,`invalid depth attachment for framebuffer object`),p(F,o,f),W(!F||F.renderbuffer&&F.renderbuffer._renderbuffer.format===Ui,`invalid stencil attachment for framebuffer object`),p(I,o,f),W(!I||I.texture&&I.texture._texture.format===Wi||I.renderbuffer&&I.renderbuffer._renderbuffer.format===Wi,`invalid depth-stencil attachment for framebuffer object`),S(a),a.width=o,a.height=f,a.colorAttachments=N,a.depthAttachment=P,a.stencilAttachment=F,a.depthStencilAttachment=I,d.color=N.map(_),d.depth=_(P),d.stencil=_(F),d.depthStencil=_(I),d.width=a.width,d.height=a.height,w(a),d}function f(e,t){W(s.next!==a,`can not resize a framebuffer which is currently in use`);var n=Math.max(e|0,1),r=Math.max(t|0||n,1);if(n===a.width&&r===a.height)return d;for(var i=a.colorAttachments,o=0;o<i.length;++o)v(i[o],n,r);return v(a.depthAttachment,n,r),v(a.stencilAttachment,n,r),v(a.depthStencilAttachment,n,r),a.width=d.width=n,a.height=d.height=r,w(a),d}return d(e,i),t(d,{resize:f,_reglType:`framebuffer`,_framebuffer:a,destroy:function(){C(a),S(a)},use:function(e){s.setFBO({framebuffer:d},e)}})}function D(e){var a=[,,,,,,];function o(e){var r;W(a.indexOf(s.next)<0,`can not update framebuffer which is currently in use`);var l={color:null},d=0,f=null,p=`rgba`,m=`uint8`,h=1;if(typeof e==`number`)d=e|0;else if(!e)d=1;else{W.type(e,`object`,`invalid arguments for framebuffer`);var g=e;if(`shape`in g){var _=g.shape;W(Array.isArray(_)&&_.length>=2,`invalid shape for framebuffer`),W(_[0]===_[1],`cube framebuffer must be square`),d=_[0]}else `radius`in g&&(d=g.radius|0),`width`in g?(d=g.width|0,`height`in g&&W(g.height===d,`must be square`)):`height`in g&&(d=g.height|0);(`color`in g||`colors`in g)&&(f=g.color||g.colors,Array.isArray(f)&&W(f.length===1||n.webgl_draw_buffers,`multiple render targets not supported`)),f||(`colorCount`in g&&(h=g.colorCount|0,W(h>0,`invalid color buffer count`)),`colorType`in g&&(W.oneOf(g.colorType,u,`invalid color type`),m=g.colorType),`colorFormat`in g&&(p=g.colorFormat,W.oneOf(g.colorFormat,c,`invalid color format for texture`))),`depth`in g&&(l.depth=g.depth),`stencil`in g&&(l.stencil=g.stencil),`depthStencil`in g&&(l.depthStencil=g.depthStencil)}var v;if(f)if(Array.isArray(f))for(v=[],r=0;r<f.length;++r)v[r]=f[r];else v=[f];else{v=Array(h);var y={radius:d,format:p,type:m};for(r=0;r<h;++r)v[r]=i.createCube(y)}for(l.color=Array(v.length),r=0;r<v.length;++r){var b=v[r];W(typeof b==`function`&&b._reglType===`textureCube`,`invalid cube map`),d||=b.width,W(b.width===d&&b.height===d,`invalid cube map shape`),l.color[r]={target:bi,data:v[r]}}for(r=0;r<6;++r){for(var x=0;x<v.length;++x)l.color[x].target=bi+r;r>0&&(l.depth=a[0].depth,l.stencil=a[0].stencil,l.depthStencil=a[0].depthStencil),a[r]?a[r](l):a[r]=E(l)}return t(o,{width:d,height:d,color:v})}function l(e){var t,n=e|0;if(W(n>0&&n<=r.maxCubeMapSize,`invalid radius for cube fbo`),n===o.width)return o;var i=o.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)a[t].resize(n);return o.width=o.height=n,o}return o(e),t(o,{faces:a,resize:l,_reglType:`framebufferCube`,destroy:function(){a.forEach(function(e){e.destroy()})}})}function O(){s.cur=null,s.next=null,s.dirty=!0,jt(b).forEach(function(t){t.framebuffer=e.createFramebuffer(),w(t)})}return t(s,{getFramebuffer:function(e){if(typeof e==`function`&&e._reglType===`framebuffer`){var t=e._framebuffer;if(t instanceof x)return t}return null},create:E,createCube:D,clear:function(){jt(b).forEach(C)},restore:O})}var Ji=5126,Yi=34962;function Xi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ji,this.offset=0,this.stride=0,this.divisor=0}function Zi(t,n,r,i,a){for(var o=r.maxAttributes,s=Array(o),c=0;c<o;++c)s[c]=new Xi;var l=0,u={},d={Record:Xi,scope:{},state:s,currentVAO:null,targetVAO:null,restore:p()?b:function(){},createVAO:x,getVAO:h,destroyBuffer:f,setVAO:p()?g:_,clear:p()?v:function(){}};function f(e){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}}function p(){return n.oes_vertex_array_object}function m(){return n.angle_instanced_arrays}function h(e){return typeof e==`function`&&e._vao?e._vao:null}function g(e){if(e!==d.currentVAO){var t=p();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),d.currentVAO=e}}function _(e){if(e!==d.currentVAO){if(e)e.bindAttrs();else for(var n=m(),r=0;r<s.length;++r){var i=s[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}d.currentVAO=e}}function v(){jt(u).forEach(function(e){e.destroy()})}function y(){this.id=++l,this.attributes=[];var e=p();e?this.vao=e.createVertexArrayOES():this.vao=null,u[this.id]=this,this.buffers=[]}y.prototype.bindAttrs=function(){for(var e=m(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(Yi,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var a=n.length;a<o;++a)t.disableVertexAttribArray(a)},y.prototype.refresh=function(){var e=p();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),d.currentVAO=this)},y.prototype.destroy=function(){if(this.vao){var e=p();this===d.currentVAO&&(d.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}u[this.id]&&(delete u[this.id],--i.vaoCount)};function b(){p()&&jt(u).forEach(function(e){e.refresh()})}function x(t){var r=new y;i.vaoCount+=1;function s(t){W(Array.isArray(t),`arguments to vertex array constructor must be an array`),W(t.length<o,`too many attributes`),W(t.length>0,`must specify at least one attribute`);for(var i=0;i<r.buffers.length;++i)r.buffers[i].destroy();r.buffers.length=0;var c=r.attributes;c.length=t.length;for(var l=0;l<t.length;++l){var u=t[l],d=c[l]=new Xi;if(Array.isArray(u)||e(u)||At(u)){var f=a.create(u,Yi,!1,!0);d.buffer=a.getBuffer(f),d.size=d.buffer.dimension|0,d.normalized=!1,d.type=d.buffer.dtype,d.offset=0,d.stride=0,d.divisor=0,d.state=1,r.buffers.push(f)}else a.getBuffer(u)?(d.buffer=a.getBuffer(u),d.size=d.buffer.dimension|0,d.normalized=!1,d.type=d.buffer.dtype,d.offset=0,d.stride=0,d.divisor=0,d.state=1):a.getBuffer(u.buffer)?(d.buffer=a.getBuffer(u.buffer),d.size=(+u.size||d.buffer.dimension)|0,d.normalized=!!u.normalized||!1,`type`in u?(W.parameter(u.type,Bt,`invalid buffer type`),d.type=Bt[u.type]):d.type=d.buffer.dtype,d.offset=(u.offset||0)|0,d.stride=(u.stride||0)|0,d.divisor=(u.divisor||0)|0,d.state=1,W(d.size>=1&&d.size<=4,`size must be between 1 and 4`),W(d.offset>=0,`invalid offset`),W(d.stride>=0&&d.stride<=255,`stride must be between 0 and 255`),W(d.divisor>=0,`divisor must be positive`),W(!d.divisor||!!n.angle_instanced_arrays,`ANGLE_instanced_arrays must be enabled to use divisor`)):`x`in u?(W(l>0,`first attribute must not be a constant`),d.x=+u.x||0,d.y=+u.y||0,d.z=+u.z||0,d.w=+u.w||0,d.state=2):W(!1,`invalid attribute spec for location `+l)}return r.refresh(),s}return s.destroy=function(){r.destroy()},s._vao=r,s._reglType=`vao`,s(t)}return d}var Qi=35632,$i=35633,ea=35718,ta=35721;function na(e,t,n,r){var i={},a={};function o(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function s(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id){e[n].location=t.location;return}e.push(t)}function c(n,r,o){var s=n===Qi?i:a,c=s[r];if(!c){var l=t.str(r);c=e.createShader(n),e.shaderSource(c,l),e.compileShader(c),W.shaderError(e,c,l,n,o),s[r]=c}return c}var l={},u=[],d=0;function f(e,t){this.id=d++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(n,i,a){var l,u,d=c(Qi,n.fragId),f=c($i,n.vertId),p=n.program=e.createProgram();if(e.attachShader(p,d),e.attachShader(p,f),a)for(l=0;l<a.length;++l){var m=a[l];e.bindAttribLocation(p,m[0],m[1])}e.linkProgram(p),W.linkError(e,p,t.str(n.fragId),t.str(n.vertId),i);var h=e.getProgramParameter(p,ea);r.profile&&(n.stats.uniformsCount=h);var g=n.uniforms;for(l=0;l<h;++l)if(u=e.getActiveUniform(p,l),u)if(u.size>1)for(var _=0;_<u.size;++_){var v=u.name.replace(`[0]`,`[`+_+`]`);s(g,new o(v,t.id(v),e.getUniformLocation(p,v),u))}else s(g,new o(u.name,t.id(u.name),e.getUniformLocation(p,u.name),u));var y=e.getProgramParameter(p,ta);r.profile&&(n.stats.attributesCount=y);var b=n.attributes;for(l=0;l<y;++l)u=e.getActiveAttrib(p,l),u&&s(b,new o(u.name,t.id(u.name),e.getAttribLocation(p,u.name),u))}r.profile&&(n.getMaxUniformsCount=function(){var e=0;return u.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},n.getMaxAttributesCount=function(){var e=0;return u.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e});function m(){i={},a={};for(var e=0;e<u.length;++e)p(u[e],null,u[e].attributes.map(function(e){return[e.location,e.name]}))}return{clear:function(){var t=e.deleteShader.bind(e);jt(i).forEach(t),i={},jt(a).forEach(t),a={},u.forEach(function(t){e.deleteProgram(t.program)}),u.length=0,l={},n.shaderCount=0},program:function(e,t,r,i){W.command(e>=0,`missing vertex shader`,r),W.command(t>=0,`missing fragment shader`,r);var a=l[t];a||=l[t]={};var o=a[e];if(o&&!i)return o;var s=new f(t,e);return n.shaderCount++,p(s,r,i),o||(a[e]=s),u.push(s),s},restore:m,shader:c,frag:-1,vert:-1}}var ra=6408,ia=5121,aa=3333,oa=5126;function sa(t,n,r,i,a,o,s){function c(c){var l;n.next===null?(W(a.preserveDrawingBuffer,`you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer`),l=ia):(W(n.next.colorAttachments[0].texture!==null,`You cannot read from a renderbuffer`),l=n.next.colorAttachments[0].texture._texture.type,o.oes_texture_float?(W(l===ia||l===oa,`Reading from a framebuffer is only allowed for the types 'uint8' and 'float'`),l===oa&&W(s.readFloat,`Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float`)):W(l===ia,`Reading from a framebuffer is only allowed for the type 'uint8'`));var u=0,d=0,f=i.framebufferWidth,p=i.framebufferHeight,m=null;e(c)?m=c:c&&(W.type(c,`object`,`invalid arguments to regl.read()`),u=c.x|0,d=c.y|0,W(u>=0&&u<i.framebufferWidth,`invalid x offset for regl.read`),W(d>=0&&d<i.framebufferHeight,`invalid y offset for regl.read`),f=(c.width||i.framebufferWidth-u)|0,p=(c.height||i.framebufferHeight-d)|0,m=c.data||null),m&&(l===ia?W(m instanceof Uint8Array,`buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'`):l===oa&&W(m instanceof Float32Array,`buffer must be 'Float32Array' when reading from a framebuffer of type 'float'`)),W(f>0&&f+u<=i.framebufferWidth,`invalid width for read pixels`),W(p>0&&p+d<=i.framebufferHeight,`invalid height for read pixels`),r();var h=f*p*4;return m||(l===ia?m=new Uint8Array(h):l===oa&&(m||=new Float32Array(h))),W.isTypedArray(m,`data buffer for regl.read() must be a typedarray`),W(m.byteLength>=h,`data buffer for regl.read() too small`),t.pixelStorei(aa,4),t.readPixels(u,d,f,p,ra,l,m),m}function l(e){var t;return n.setFBO({framebuffer:e.framebuffer},function(){t=c(e)}),t}function u(e){return!e||!(`framebuffer`in e)?c(e):l(e)}return u}function ca(e){return Array.prototype.slice.call(e)}function la(e){return ca(e).join(``)}function ua(){var e=0,n=[],r=[];function i(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var a=`g`+ e++;return n.push(a),r.push(t),a}function a(){var n=[];function r(){n.push.apply(n,ca(arguments))}var i=[];function a(){var t=`v`+ e++;return i.push(t),arguments.length>0&&(n.push(t,`=`),n.push.apply(n,ca(arguments)),n.push(`;`)),t}return t(r,{def:a,toString:function(){return la([i.length>0?`var `+i.join(`,`)+`;`:``,la(n)])}})}function o(){var e=a(),n=a(),r=e.toString,i=n.toString;function o(t,r){n(t,r,`=`,e.def(t,r),`;`)}return t(function(){e.apply(e,ca(arguments))},{def:e.def,entry:e,exit:n,save:o,set:function(t,n,r){o(t,n),e(t,n,`=`,r,`;`)},toString:function(){return r()+i()}})}function s(){var e=la(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,ca(arguments)),this},else:function(){return r.apply(r,ca(arguments)),this},toString:function(){var t=a();return t&&=`else{`+t+`}`,la([`if(`,e,`){`,i(),`}`,t])}})}var c=a(),l={};function u(e,n){var r=[];function i(){var e=`a`+r.length;return r.push(e),e}n||=0;for(var a=0;a<n;++a)i();var s=o(),c=s.toString;return l[e]=t(s,{arg:i,toString:function(){return la([`function(`,r.join(),`){`,c(),`}`])}})}function d(){var e=[`"use strict";`,c,`return {`];Object.keys(l).forEach(function(t){e.push(`"`,t,`":`,l[t].toString(),`,`)}),e.push(`}`);var t=la(e).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`);return Function.apply(null,n.concat(t)).apply(null,r)}return{global:c,link:i,block:a,proc:u,scope:o,cond:s,compile:d}}var da=`xyzw`.split(``),fa=5121,pa=1,ma=2,ha=0,ga=1,_a=2,va=3,ya=4,ba=`dither`,xa=`blend.enable`,Sa=`blend.color`,Ca=`blend.equation`,wa=`blend.func`,Ta=`depth.enable`,Ea=`depth.func`,Da=`depth.range`,Oa=`depth.mask`,ka=`colorMask`,Aa=`cull.enable`,ja=`cull.face`,Ma=`frontFace`,Na=`lineWidth`,Pa=`polygonOffset.enable`,Fa=`polygonOffset.offset`,Ia=`sample.alpha`,La=`sample.enable`,Ra=`sample.coverage`,za=`stencil.enable`,Ba=`stencil.mask`,Va=`stencil.func`,Ha=`stencil.opFront`,Ua=`stencil.opBack`,Wa=`scissor.enable`,Ga=`scissor.box`,Ka=`viewport`,qa=`profile`,Ja=`framebuffer`,Ya=`vert`,Xa=`frag`,Za=`elements`,Qa=`primitive`,$a=`count`,eo=`offset`,to=`instances`,no=`vao`,ro=`Width`,io=`Height`,ao=Ja+ro,oo=Ja+io,so=Ka+ro,co=Ka+io,lo=`drawingBuffer`,uo=lo+ro,fo=lo+io,po=[wa,Ca,Va,Ha,Ua,Ra,Ka,Ga,Fa],mo=34962,ho=34963,go=35632,_o=35633,vo=3553,yo=34067,bo=2884,xo=3042,So=3024,Co=2960,wo=2929,To=3089,Eo=32823,Do=32926,Oo=32928,ko=5126,Ao=35664,jo=35665,Mo=35666,No=5124,Po=35667,Fo=35668,Io=35669,Lo=35670,Ro=35671,zo=35672,Bo=35673,Vo=35674,Ho=35675,Uo=35676,Wo=35678,Go=35680,Ko=4,qo=1028,Jo=1029,Yo=2304,Xo=2305,Zo=32775,Qo=32776,$o=519,es=7680,ts=0,ns=1,rs=32774,is=513,as=36160,os=36064,ss={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},cs=[`constant color, constant alpha`,`one minus constant color, constant alpha`,`constant color, one minus constant alpha`,`one minus constant color, one minus constant alpha`,`constant alpha, constant color`,`constant alpha, one minus constant color`,`one minus constant alpha, constant color`,`one minus constant alpha, one minus constant color`],ls={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},us={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ds={frag:go,vert:_o},fs={cw:Yo,ccw:Xo};function ps(t){return Array.isArray(t)||e(t)||At(t)}function ms(e){return e.sort(function(e,t){return e===Ka?-1:t===Ka?1:e<t?-1:1})}function hs(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function gs(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function _s(e){return new hs(!1,!1,!1,e)}function vs(e,t){var n=e.type;if(n===ha){var r=e.data.length;return new hs(!0,r>=1,r>=2,t)}else if(n===ya){var i=e.data;return new hs(i.thisDep,i.contextDep,i.propDep,t)}else return new hs(n===va,n===_a,n===ga,t)}var ys=new hs(!1,!1,!1,function(){});function bs(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m){var h=l.Record,g={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(g.min=Zo,g.max=Qo);var _=n.angle_instanced_arrays,v=n.webgl_draw_buffers,y={dirty:!0,profile:m.profile},b={},x=[],S={},C={};function w(e){return e.replace(`.`,`_`)}function E(e,t,n){var r=w(e);x.push(e),b[r]=y[r]=!!n,S[r]=t}function D(e,t,n){var r=w(e);x.push(e),Array.isArray(n)?(y[r]=n.slice(),b[r]=n.slice()):y[r]=b[r]=n,C[r]=t}E(ba,So),E(xa,xo),D(Sa,`blendColor`,[0,0,0,0]),D(Ca,`blendEquationSeparate`,[rs,rs]),D(wa,`blendFuncSeparate`,[ns,ts,ns,ts]),E(Ta,wo,!0),D(Ea,`depthFunc`,is),D(Da,`depthRange`,[0,1]),D(Oa,`depthMask`,!0),D(ka,ka,[!0,!0,!0,!0]),E(Aa,bo),D(ja,`cullFace`,Jo),D(Ma,Ma,Xo),D(Na,Na,1),E(Pa,Eo),D(Fa,`polygonOffset`,[0,0]),E(Ia,Do),E(La,Oo),D(Ra,`sampleCoverage`,[1,!1]),E(za,Co),D(Ba,`stencilMask`,-1),D(Va,`stencilFunc`,[$o,0,-1]),D(Ha,`stencilOpSeparate`,[qo,es,es,es]),D(Ua,`stencilOpSeparate`,[Jo,es,es,es]),E(Wa,To),D(Ga,`scissor`,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),D(Ka,Ka,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var O={gl:e,context:f,strings:t,next:b,current:y,draw:d,elements:a,buffer:i,shader:u,attributes:l.state,vao:l,uniforms:c,framebuffer:s,extensions:n,timer:p,isBufferArgs:ps},k={primTypes:$t,compareFuncs:ls,blendFuncs:ss,blendEquations:g,stencilOps:us,glTypes:Bt,orientationType:fs};W.optional(function(){O.isArrayLike=vn}),v&&(k.backBuffer=[Jo],k.drawBuffer=Pe(r.maxDrawbuffers,function(e){return e===0?[0]:Pe(e,function(e){return os+e})}));var A=0;function j(){var e=ua(),n=e.link,r=e.global;e.id=A++,e.batchId=`0`;var i=n(O),a=e.shared={props:`a0`};Object.keys(O).forEach(function(e){a[e]=r.def(i,`.`,e)}),W.optional(function(){e.CHECK=n(W),e.commandStr=W.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e(`if(!(`,t,`))`,this.CHECK,`.commandRaise(`,n(r),`,`,this.command,`);`)},k.invalidBlendCombinations=cs});var o=e.next={},s=e.current={};Object.keys(C).forEach(function(e){Array.isArray(y[e])&&(o[e]=r.def(a.next,`.`,e),s[e]=r.def(a.current,`.`,e))});var c=e.constants={};Object.keys(k).forEach(function(e){c[e]=r.def(JSON.stringify(k[e]))}),e.invoke=function(t,r){switch(r.type){case ha:var i=[`this`,a.context,a.props,e.batchId];return t.def(n(r.data),`.call(`,i.slice(0,Math.max(r.data.length+1,4)),`)`);case ga:return t.def(a.props,r.data);case _a:return t.def(a.context,r.data);case va:return t.def(`this`,r.data);case ya:return r.data.append(e,t),r.data.ref}},e.attribCache={};var u={};return e.scopeAttrib=function(e){var r=t.id(e);if(r in u)return u[r];var i=l.scope[r];return i||=l.scope[r]=new h,u[r]=n(i)},e}function M(e){var t=e.static,n=e.dynamic,r;if(qa in t){var i=!!t[qa];r=_s(function(e,t){return i}),r.enable=i}else if(qa in n){var a=n[qa];r=vs(a,function(e,t){return e.invoke(t,a)})}return r}function N(e,t){var n=e.static,r=e.dynamic;if(Ja in n){var i=n[Ja];return i?(i=s.getFramebuffer(i),W.command(i,`invalid framebuffer object`),_s(function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,`.next`,n);var a=r.context;return t.set(a,`.`+ao,n+`.width`),t.set(a,`.`+oo,n+`.height`),n})):_s(function(e,t){var n=e.shared;t.set(n.framebuffer,`.next`,`null`);var r=n.context;return t.set(r,`.`+ao,r+`.`+uo),t.set(r,`.`+oo,r+`.`+fo),`null`})}else if(Ja in r){var a=r[Ja];return vs(a,function(e,t){var n=e.invoke(t,a),r=e.shared,i=r.framebuffer,o=t.def(i,`.getFramebuffer(`,n,`)`);W.optional(function(){e.assert(t,`!`+n+`||`+o,`invalid framebuffer object`)}),t.set(i,`.next`,o);var s=r.context;return t.set(s,`.`+ao,o+`?`+o+`.width:`+s+`.`+uo),t.set(s,`.`+oo,o+`?`+o+`.height:`+s+`.`+fo),o})}else return null}function P(e,t,n){var r=e.static,i=e.dynamic;function a(e){if(e in r){var a=r[e];W.commandType(a,`object`,`invalid `+e,n.commandStr);var o=!0,s=a.x|0,c=a.y|0,l,u;return`width`in a?(l=a.width|0,W.command(l>=0,`invalid `+e,n.commandStr)):o=!1,`height`in a?(u=a.height|0,W.command(u>=0,`invalid `+e,n.commandStr)):o=!1,new hs(!o&&t&&t.thisDep,!o&&t&&t.contextDep,!o&&t&&t.propDep,function(e,t){var n=e.shared.context,r=l;`width`in a||(r=t.def(n,`.`,ao,`-`,s));var i=u;return`height`in a||(i=t.def(n,`.`,oo,`-`,c)),[s,c,r,i]})}else if(e in i){var d=i[e],f=vs(d,function(t,n){var r=t.invoke(n,d);W.optional(function(){t.assert(n,r+`&&typeof `+r+`==="object"`,`invalid `+e)});var i=t.shared.context,a=n.def(r,`.x|0`),o=n.def(r,`.y|0`),s=n.def(`"width" in `,r,`?`,r,`.width|0:`,`(`,i,`.`,ao,`-`,a,`)`),c=n.def(`"height" in `,r,`?`,r,`.height|0:`,`(`,i,`.`,oo,`-`,o,`)`);return W.optional(function(){t.assert(n,s+`>=0&&`+c+`>=0`,`invalid `+e)}),[a,o,s,c]});return t&&(f.thisDep=f.thisDep||t.thisDep,f.contextDep=f.contextDep||t.contextDep,f.propDep=f.propDep||t.propDep),f}else if(t)return new hs(t.thisDep,t.contextDep,t.propDep,function(e,t){var n=e.shared.context;return[0,0,t.def(n,`.`,ao),t.def(n,`.`,oo)]});else return null}var o=a(Ka);if(o){var s=o;o=new hs(o.thisDep,o.contextDep,o.propDep,function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,`.`+so,n[2]),t.set(r,`.`+co,n[3]),n})}return{viewport:o,scissor_box:a(Ga)}}function F(e,t){var n=e.static;if(typeof n[Xa]==`string`&&typeof n[Ya]==`string`){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&typeof r[i[0]]==`number`){for(var a=[],o=0;o<i.length;++o)W(typeof r[i[o]]==`number`,`must specify all vertex attribute locations when using vaos`),a.push([r[i[o]]|0,i[o]]);return a}}return null}function I(e,n,r){var i=e.static,a=e.dynamic;function o(e){if(e in i){var n=t.id(i[e]);W.optional(function(){u.shader(ds[e],n,W.guessCommand())});var r=_s(function(){return n});return r.id=n,r}else if(e in a){var o=a[e];return vs(o,function(t,n){var r=t.invoke(n,o),i=n.def(t.shared.strings,`.id(`,r,`)`);return W.optional(function(){n(t.shared.shader,`.shader(`,ds[e],`,`,i,`,`,t.command,`);`)}),i})}return null}var s=o(Xa),c=o(Ya),l=null,d;return gs(s)&&gs(c)?(l=u.program(c.id,s.id,null,r),d=_s(function(e,t){return e.link(l)})):d=new hs(s&&s.thisDep||c&&c.thisDep,s&&s.contextDep||c&&c.contextDep,s&&s.propDep||c&&c.propDep,function(e,t){var n=e.shared.shader,r=s?s.append(e,t):t.def(n,`.`,Xa),i=c?c.append(e,t):t.def(n,`.`,Ya),a=n+`.program(`+i+`,`+r;return W.optional(function(){a+=`,`+e.command}),t.def(a+`)`)}),{frag:s,vert:c,progVar:d,program:l}}function ee(e,t){var n=e.static,r=e.dynamic;function i(){if(Za in n){var e=n[Za];ps(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e),W.command(e,`invalid elements`,t.commandStr));var i=_s(function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null});return i.value=e,i}else if(Za in r){var o=r[Za];return vs(o,function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def(`null`),c=t.def(r,`(`,a,`)`),l=e.cond(c).then(s,`=`,i,`.createStream(`,a,`);`).else(s,`=`,i,`.getElements(`,a,`);`);return W.optional(function(){e.assert(l.else,`!`+a+`||`+s,`invalid elements`)}),t.entry(l),t.exit(e.cond(c).then(i,`.destroyStream(`,s,`);`)),e.ELEMENTS=s,s})}return null}var o=i();function s(){if(Qa in n){var e=n[Qa];return W.commandParameter(e,$t,`invalid primitve`,t.commandStr),_s(function(t,n){return $t[e]})}else if(Qa in r){var i=r[Qa];return vs(i,function(e,t){var n=e.constants.primTypes,r=e.invoke(t,i);return W.optional(function(){e.assert(t,r+` in `+n,`invalid primitive, must be one of `+Object.keys($t))}),t.def(n,`[`,r,`]`)})}else if(o)return gs(o)?o.value?_s(function(e,t){return t.def(e.ELEMENTS,`.primType`)}):_s(function(){return Ko}):new hs(o.thisDep,o.contextDep,o.propDep,function(e,t){var n=e.ELEMENTS;return t.def(n,`?`,n,`.primType:`,Ko)});return null}function c(e,i){if(e in n){var a=n[e]|0;return W.command(!i||a>=0,`invalid `+e,t.commandStr),_s(function(e,t){return i&&(e.OFFSET=a),a})}else if(e in r){var s=r[e];return vs(s,function(t,n){var r=t.invoke(n,s);return i&&(t.OFFSET=r,W.optional(function(){t.assert(n,r+`>=0`,`invalid `+e)})),r})}else if(i&&o)return _s(function(e,t){return e.OFFSET=`0`,0});return null}var l=c(eo,!0);function u(){if($a in n){var e=n[$a]|0;return W.command(typeof e==`number`&&e>=0,`invalid vertex count`,t.commandStr),_s(function(){return e})}else if($a in r){var i=r[$a];return vs(i,function(e,t){var n=e.invoke(t,i);return W.optional(function(){e.assert(t,`typeof `+n+`==="number"&&`+n+`>=0&&`+n+`===(`+n+`|0)`,`invalid vertex count`)}),n})}else if(o)if(gs(o)){if(o)return l?new hs(l.thisDep,l.contextDep,l.propDep,function(e,t){var n=t.def(e.ELEMENTS,`.vertCount-`,e.OFFSET);return W.optional(function(){e.assert(t,n+`>=0`,`invalid vertex offset/element buffer too small`)}),n}):_s(function(e,t){return t.def(e.ELEMENTS,`.vertCount`)});var a=_s(function(){return-1});return W.optional(function(){a.MISSING=!0}),a}else{var s=new hs(o.thisDep||l.thisDep,o.contextDep||l.contextDep,o.propDep||l.propDep,function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,`?`,n,`.vertCount-`,e.OFFSET,`:-1`):t.def(n,`?`,n,`.vertCount:-1`)});return W.optional(function(){s.DYNAMIC=!0}),s}return null}return{elements:o,primitive:s(),count:u(),instances:c(to,!1),offset:l}}function R(e,t){var n=e.static,i=e.dynamic,a={};return x.forEach(function(e){var o=w(e);function s(t,r){if(e in n){var s=t(n[e]);a[o]=_s(function(){return s})}else if(e in i){var c=i[e];a[o]=vs(c,function(e,t){return r(e,t,e.invoke(t,c))})}}switch(e){case Aa:case xa:case ba:case za:case Ta:case Wa:case Pa:case Ia:case La:case Oa:return s(function(n){return W.commandType(n,`boolean`,e,t.commandStr),n},function(t,n,r){return W.optional(function(){t.assert(n,`typeof `+r+`==="boolean"`,`invalid flag `+e,t.commandStr)}),r});case Ea:return s(function(n){return W.commandParameter(n,ls,`invalid `+e,t.commandStr),ls[n]},function(t,n,r){var i=t.constants.compareFuncs;return W.optional(function(){t.assert(n,r+` in `+i,`invalid `+e+`, must be one of `+Object.keys(ls))}),n.def(i,`[`,r,`]`)});case Da:return s(function(e){return W.command(vn(e)&&e.length===2&&typeof e[0]==`number`&&typeof e[1]==`number`&&e[0]<=e[1],`depth range is 2d array`,t.commandStr),e},function(e,t,n){return W.optional(function(){e.assert(t,e.shared.isArrayLike+`(`+n+`)&&`+n+`.length===2&&typeof `+n+`[0]==="number"&&typeof `+n+`[1]==="number"&&`+n+`[0]<=`+n+`[1]`,`depth range must be a 2d array`)}),[t.def(`+`,n,`[0]`),t.def(`+`,n,`[1]`)]});case wa:return s(function(e){W.commandType(e,`object`,`blend.func`,t.commandStr);var n=`srcRGB`in e?e.srcRGB:e.src,r=`srcAlpha`in e?e.srcAlpha:e.src,i=`dstRGB`in e?e.dstRGB:e.dst,a=`dstAlpha`in e?e.dstAlpha:e.dst;return W.commandParameter(n,ss,o+`.srcRGB`,t.commandStr),W.commandParameter(r,ss,o+`.srcAlpha`,t.commandStr),W.commandParameter(i,ss,o+`.dstRGB`,t.commandStr),W.commandParameter(a,ss,o+`.dstAlpha`,t.commandStr),W.command(cs.indexOf(n+`, `+i)===-1,`unallowed blending combination (srcRGB, dstRGB) = (`+n+`, `+i+`)`,t.commandStr),[ss[n],ss[i],ss[r],ss[a]]},function(t,n,r){var i=t.constants.blendFuncs;W.optional(function(){t.assert(n,r+`&&typeof `+r+`==="object"`,`invalid blend func, must be an object`)});function a(a,o){var s=n.def(`"`,a,o,`" in `,r,`?`,r,`.`,a,o,`:`,r,`.`,a);return W.optional(function(){t.assert(n,s+` in `+i,`invalid `+e+`.`+a+o+`, must be one of `+Object.keys(ss))}),s}var o=a(`src`,`RGB`),s=a(`dst`,`RGB`);W.optional(function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+`.indexOf(`+o+`+", "+`+s+`) === -1 `,`unallowed blending combination for (srcRGB, dstRGB)`)});var c=n.def(i,`[`,o,`]`),l=n.def(i,`[`,a(`src`,`Alpha`),`]`);return[c,n.def(i,`[`,s,`]`),l,n.def(i,`[`,a(`dst`,`Alpha`),`]`)]});case Ca:return s(function(n){if(typeof n==`string`)return W.commandParameter(n,g,`invalid `+e,t.commandStr),[g[n],g[n]];if(typeof n==`object`)return W.commandParameter(n.rgb,g,e+`.rgb`,t.commandStr),W.commandParameter(n.alpha,g,e+`.alpha`,t.commandStr),[g[n.rgb],g[n.alpha]];W.commandRaise(`invalid blend.equation`,t.commandStr)},function(t,n,r){var i=t.constants.blendEquations,a=n.def(),o=n.def(),s=t.cond(`typeof `,r,`==="string"`);return W.optional(function(){function n(e,n,r){t.assert(e,r+` in `+i,`invalid `+n+`, must be one of `+Object.keys(g))}n(s.then,e,r),t.assert(s.else,r+`&&typeof `+r+`==="object"`,`invalid `+e),n(s.else,e+`.rgb`,r+`.rgb`),n(s.else,e+`.alpha`,r+`.alpha`)}),s.then(a,`=`,o,`=`,i,`[`,r,`];`),s.else(a,`=`,i,`[`,r,`.rgb];`,o,`=`,i,`[`,r,`.alpha];`),n(s),[a,o]});case Sa:return s(function(e){return W.command(vn(e)&&e.length===4,`blend.color must be a 4d array`,t.commandStr),Pe(4,function(t){return+e[t]})},function(e,t,n){return W.optional(function(){e.assert(t,e.shared.isArrayLike+`(`+n+`)&&`+n+`.length===4`,`blend.color must be a 4d array`)}),Pe(4,function(e){return t.def(`+`,n,`[`,e,`]`)})});case Ba:return s(function(e){return W.commandType(e,`number`,o,t.commandStr),e|0},function(e,t,n){return W.optional(function(){e.assert(t,`typeof `+n+`==="number"`,`invalid stencil.mask`)}),t.def(n,`|0`)});case Va:return s(function(n){W.commandType(n,`object`,o,t.commandStr);var r=n.cmp||`keep`,i=n.ref||0,a=`mask`in n?n.mask:-1;return W.commandParameter(r,ls,e+`.cmp`,t.commandStr),W.commandType(i,`number`,e+`.ref`,t.commandStr),W.commandType(a,`number`,e+`.mask`,t.commandStr),[ls[r],i,a]},function(e,t,n){var r=e.constants.compareFuncs;return W.optional(function(){function i(){e.assert(t,Array.prototype.join.call(arguments,``),`invalid stencil.func`)}i(n+`&&typeof `,n,`==="object"`),i(`!("cmp" in `,n,`)||(`,n,`.cmp in `,r,`)`)}),[t.def(`"cmp" in `,n,`?`,r,`[`,n,`.cmp]`,`:`,es),t.def(n,`.ref|0`),t.def(`"mask" in `,n,`?`,n,`.mask|0:-1`)]});case Ha:case Ua:return s(function(n){W.commandType(n,`object`,o,t.commandStr);var r=n.fail||`keep`,i=n.zfail||`keep`,a=n.zpass||`keep`;return W.commandParameter(r,us,e+`.fail`,t.commandStr),W.commandParameter(i,us,e+`.zfail`,t.commandStr),W.commandParameter(a,us,e+`.zpass`,t.commandStr),[e===Ua?Jo:qo,us[r],us[i],us[a]]},function(t,n,r){var i=t.constants.stencilOps;W.optional(function(){t.assert(n,r+`&&typeof `+r+`==="object"`,`invalid `+e)});function a(a){return W.optional(function(){t.assert(n,`!("`+a+`" in `+r+`)||(`+r+`.`+a+` in `+i+`)`,`invalid `+e+`.`+a+`, must be one of `+Object.keys(us))}),n.def(`"`,a,`" in `,r,`?`,i,`[`,r,`.`,a,`]:`,es)}return[e===Ua?Jo:qo,a(`fail`),a(`zfail`),a(`zpass`)]});case Fa:return s(function(e){W.commandType(e,`object`,o,t.commandStr);var n=e.factor|0,r=e.units|0;return W.commandType(n,`number`,o+`.factor`,t.commandStr),W.commandType(r,`number`,o+`.units`,t.commandStr),[n,r]},function(t,n,r){return W.optional(function(){t.assert(n,r+`&&typeof `+r+`==="object"`,`invalid `+e)}),[n.def(r,`.factor|0`),n.def(r,`.units|0`)]});case ja:return s(function(e){var n=0;return e===`front`?n=qo:e===`back`&&(n=Jo),W.command(!!n,o,t.commandStr),n},function(e,t,n){return W.optional(function(){e.assert(t,n+`==="front"||`+n+`==="back"`,`invalid cull.face`)}),t.def(n,`==="front"?`,qo,`:`,Jo)});case Na:return s(function(e){return W.command(typeof e==`number`&&e>=r.lineWidthDims[0]&&e<=r.lineWidthDims[1],`invalid line width, must be a positive number between `+r.lineWidthDims[0]+` and `+r.lineWidthDims[1],t.commandStr),e},function(e,t,n){return W.optional(function(){e.assert(t,`typeof `+n+`==="number"&&`+n+`>=`+r.lineWidthDims[0]+`&&`+n+`<=`+r.lineWidthDims[1],`invalid line width`)}),n});case Ma:return s(function(e){return W.commandParameter(e,fs,o,t.commandStr),fs[e]},function(e,t,n){return W.optional(function(){e.assert(t,n+`==="cw"||`+n+`==="ccw"`,`invalid frontFace, must be one of cw,ccw`)}),t.def(n+`==="cw"?`+Yo+`:`+Xo)});case ka:return s(function(e){return W.command(vn(e)&&e.length===4,`color.mask must be length 4 array`,t.commandStr),e.map(function(e){return!!e})},function(e,t,n){return W.optional(function(){e.assert(t,e.shared.isArrayLike+`(`+n+`)&&`+n+`.length===4`,`invalid color.mask`)}),Pe(4,function(e){return`!!`+n+`[`+e+`]`})});case Ra:return s(function(e){W.command(typeof e==`object`&&e,o,t.commandStr);var n=`value`in e?e.value:1,r=!!e.invert;return W.command(typeof n==`number`&&n>=0&&n<=1,`sample.coverage.value must be a number between 0 and 1`,t.commandStr),[n,r]},function(e,t,n){return W.optional(function(){e.assert(t,n+`&&typeof `+n+`==="object"`,`invalid sample.coverage`)}),[t.def(`"value" in `,n,`?+`,n,`.value:1`),t.def(`!!`,n,`.invert`)]})}}),a}function z(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach(function(e){var r=n[e],a;if(typeof r==`number`||typeof r==`boolean`)a=_s(function(){return r});else if(typeof r==`function`){var o=r._reglType;o===`texture2d`||o===`textureCube`?a=_s(function(e){return e.link(r)}):o===`framebuffer`||o===`framebufferCube`?(W.command(r.color.length>0,`missing color attachment for framebuffer sent to uniform "`+e+`"`,t.commandStr),a=_s(function(e){return e.link(r.color[0])})):W.commandRaise(`invalid data for uniform "`+e+`"`,t.commandStr)}else vn(r)?a=_s(function(t){return t.global.def(`[`,Pe(r.length,function(n){return W.command(typeof r[n]==`number`||typeof r[n]==`boolean`,`invalid uniform `+e,t.commandStr),r[n]}),`]`)}):W.commandRaise(`invalid or missing data for uniform "`+e+`"`,t.commandStr);a.value=r,i[e]=a}),Object.keys(r).forEach(function(e){var t=r[e];i[e]=vs(t,function(e,n){return e.invoke(n,t)})}),i}function B(e,n){var r=e.static,a=e.dynamic,o={};return Object.keys(r).forEach(function(e){var a=r[e],s=t.id(e),c=new h;if(ps(a))c.state=pa,c.buffer=i.getBuffer(i.create(a,mo,!1,!0)),c.type=0;else{var l=i.getBuffer(a);if(l)c.state=pa,c.buffer=l,c.type=0;else if(W.command(typeof a==`object`&&a,`invalid data for attribute `+e,n.commandStr),`constant`in a){var u=a.constant;c.buffer=`null`,c.state=ma,typeof u==`number`?c.x=u:(W.command(vn(u)&&u.length>0&&u.length<=4,`invalid constant for attribute `+e,n.commandStr),da.forEach(function(e,t){t<u.length&&(c[e]=u[t])}))}else{l=ps(a.buffer)?i.getBuffer(i.create(a.buffer,mo,!1,!0)):i.getBuffer(a.buffer),W.command(!!l,`missing buffer for attribute "`+e+`"`,n.commandStr);var d=a.offset|0;W.command(d>=0,`invalid offset for attribute "`+e+`"`,n.commandStr);var f=a.stride|0;W.command(f>=0&&f<256,`invalid stride for attribute "`+e+`", must be integer betweeen [0, 255]`,n.commandStr);var p=a.size|0;W.command(!(`size`in a)||p>0&&p<=4,`invalid size for attribute "`+e+`", must be 1,2,3,4`,n.commandStr);var m=!!a.normalized,g=0;`type`in a&&(W.commandParameter(a.type,Bt,`invalid type for attribute `+e,n.commandStr),g=Bt[a.type]);var v=a.divisor|0;`divisor`in a&&(W.command(v===0||_,`cannot specify divisor for attribute "`+e+`", instancing not supported`,n.commandStr),W.command(v>=0,`invalid divisor for attribute "`+e+`"`,n.commandStr)),W.optional(function(){var t=n.commandStr,r=[`buffer`,`offset`,`divisor`,`normalized`,`type`,`size`,`stride`];Object.keys(a).forEach(function(n){W.command(r.indexOf(n)>=0,`unknown parameter "`+n+`" for attribute pointer "`+e+`" (valid parameters are `+r+`)`,t)})}),c.buffer=l,c.state=pa,c.size=p,c.normalized=m,c.type=g||l.dtype,c.offset=d,c.stride=f,c.divisor=v}}o[e]=_s(function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(c).forEach(function(e){r[e]=c[e]}),c.buffer&&(r.buffer=e.link(c.buffer),r.type=r.type||r.buffer+`.dtype`),n[s]=r,r})}),Object.keys(a).forEach(function(e){var t=a[e];function n(n,r){var i=n.invoke(r,t),a=n.shared,o=n.constants,s=a.isBufferArgs,c=a.buffer;W.optional(function(){n.assert(r,i+`&&(typeof `+i+`==="object"||typeof `+i+`==="function")&&(`+s+`(`+i+`)||`+c+`.getBuffer(`+i+`)||`+c+`.getBuffer(`+i+`.buffer)||`+s+`(`+i+`.buffer)||("constant" in `+i+`&&(typeof `+i+`.constant==="number"||`+a.isArrayLike+`(`+i+`.constant))))`,`invalid dynamic attribute "`+e+`"`)});var l={isStream:r.def(!1)},u=new h;u.state=pa,Object.keys(u).forEach(function(e){l[e]=r.def(``+u[e])});var d=l.buffer,f=l.type;r(`if(`,s,`(`,i,`)){`,l.isStream,`=true;`,d,`=`,c,`.createStream(`,mo,`,`,i,`);`,f,`=`,d,`.dtype;`,`}else{`,d,`=`,c,`.getBuffer(`,i,`);`,`if(`,d,`){`,f,`=`,d,`.dtype;`,`}else if("constant" in `,i,`){`,l.state,`=`,ma,`;`,`if(typeof `+i+`.constant === "number"){`,l[da[0]],`=`,i,`.constant;`,da.slice(1).map(function(e){return l[e]}).join(`=`),`=0;`,`}else{`,da.map(function(e,t){return l[e]+`=`+i+`.constant.length>`+t+`?`+i+`.constant[`+t+`]:0;`}).join(``),`}}else{`,`if(`,s,`(`,i,`.buffer)){`,d,`=`,c,`.createStream(`,mo,`,`,i,`.buffer);`,`}else{`,d,`=`,c,`.getBuffer(`,i,`.buffer);`,`}`,f,`="type" in `,i,`?`,o.glTypes,`[`,i,`.type]:`,d,`.dtype;`,l.normalized,`=!!`,i,`.normalized;`);function p(e){r(l[e],`=`,i,`.`,e,`|0;`)}return p(`size`),p(`offset`),p(`stride`),p(`divisor`),r(`}}`),r.exit(`if(`,l.isStream,`){`,c,`.destroyStream(`,d,`);`,`}`),l}o[e]=vs(t,n)}),o}function te(e,t){var n=e.static,r=e.dynamic;if(no in n){var i=n[no];return i!==null&&l.getVAO(i)===null&&(i=l.createVAO(i)),_s(function(e){return e.link(l.getVAO(i))})}else if(no in r){var a=r[no];return vs(a,function(e,t){var n=e.invoke(t,a);return t.def(e.shared.vao+`.getVAO(`+n+`)`)})}return null}function ne(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n=t[e];r[e]=_s(function(e,t){return typeof n==`number`||typeof n==`boolean`?``+n:e.link(n)})}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=vs(t,function(e,n){return e.invoke(n,t)})}),r}function re(e,t,r,i,a){var o=e.static,s=e.dynamic;W.optional(function(){var e=[Ja,Ya,Xa,Za,Qa,eo,$a,to,qa,no].concat(x);function t(t){Object.keys(t).forEach(function(t){W.command(e.indexOf(t)>=0,`unknown parameter "`+t+`"`,a.commandStr)})}t(o),t(s)});var c=F(e,t),u=N(e,a),d=P(e,u,a),f=ee(e,a),p=R(e,a),m=I(e,a,c);function h(e){var t=d[e];t&&(p[e]=t)}h(Ka),h(w(Ga));var g={framebuffer:u,draw:f,shader:m,state:p,dirty:Object.keys(p).length>0,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(g.profile=M(e,a),g.uniforms=z(r,a),g.drawVAO=g.scopeVAO=te(e,a),!g.drawVAO&&m.program&&!c&&n.angle_instanced_arrays){var _=!0,v=m.program.attributes.map(function(e){var n=t.static[e];return _&&=!!n,n});if(_&&v.length>0){var y=l.getVAO(l.createVAO(v));g.drawVAO=new hs(null,null,null,function(e,t){return e.link(y)}),g.useVAO=!0}}return c?g.useVAO=!0:g.attributes=B(t,a),g.context=ne(i,a),g}function V(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach(function(a){t.save(r,`.`+a);var o=n[a];i(r,`.`,a,`=`,o.append(e,t),`;`)}),t(i)}function ie(e,t,n,r){var i=e.shared,a=i.gl,o=i.framebuffer,s;v&&(s=t.def(i.extensions,`.webgl_draw_buffers`));var c=e.constants,l=c.drawBuffer,u=c.backBuffer,d=n?n.append(e,t):t.def(o,`.next`);r||t(`if(`,d,`!==`,o,`.cur){`),t(`if(`,d,`){`,a,`.bindFramebuffer(`,as,`,`,d,`.framebuffer);`),v&&t(s,`.drawBuffersWEBGL(`,l,`[`,d,`.colorAttachments.length]);`),t(`}else{`,a,`.bindFramebuffer(`,as,`,null);`),v&&t(s,`.drawBuffersWEBGL(`,u,`);`),t(`}`,o,`.cur=`,d,`;`),r||t(`}`)}function ae(e,t,n){var r=e.shared,i=r.gl,a=e.current,o=e.next,s=r.current,c=r.next,l=e.cond(s,`.dirty`);x.forEach(function(t){var r=w(t);if(!(r in n.state)){var u,d;if(r in o){u=o[r],d=a[r];var f=Pe(y[r].length,function(e){return l.def(u,`[`,e,`]`)});l(e.cond(f.map(function(e,t){return e+`!==`+d+`[`+t+`]`}).join(`||`)).then(i,`.`,C[r],`(`,f,`);`,f.map(function(e,t){return d+`[`+t+`]=`+e}).join(`;`),`;`))}else{u=l.def(c,`.`,r);var p=e.cond(u,`!==`,s,`.`,r);l(p),r in S?p(e.cond(u).then(i,`.enable(`,S[r],`);`).else(i,`.disable(`,S[r],`);`),s,`.`,r,`=`,u,`;`):p(i,`.`,C[r],`(`,u,`);`,s,`.`,r,`=`,u,`;`)}}}),Object.keys(n.state).length===0&&l(s,`.dirty=false;`),t(l)}function oe(e,t,n,r){var i=e.shared,a=e.current,o=i.current,s=i.gl;ms(Object.keys(n)).forEach(function(i){var c=n[i];if(!(r&&!r(c))){var l=c.append(e,t);if(S[i]){var u=S[i];gs(c)?l?t(s,`.enable(`,u,`);`):t(s,`.disable(`,u,`);`):t(e.cond(l).then(s,`.enable(`,u,`);`).else(s,`.disable(`,u,`);`)),t(o,`.`,i,`=`,l,`;`)}else if(vn(l)){var d=a[i];t(s,`.`,C[i],`(`,l,`);`,l.map(function(e,t){return d+`[`+t+`]=`+e}).join(`;`),`;`)}else t(s,`.`,C[i],`(`,l,`);`,o,`.`,i,`=`,l,`;`)}})}function se(e,t){_&&(e.instancing=t.def(e.shared.extensions,`.angle_instanced_arrays`))}function ce(e,t,n,r,i){var a=e.shared,o=e.stats,s=a.current,c=a.timer,l=n.profile;function u(){return typeof performance>`u`?`Date.now()`:`performance.now()`}var d,f;function m(e){d=t.def(),e(d,`=`,u(),`;`),typeof i==`string`?e(o,`.count+=`,i,`;`):e(o,`.count++;`),p&&(r?(f=t.def(),e(f,`=`,c,`.getNumPendingQueries();`)):e(c,`.beginQuery(`,o,`);`))}function h(e){e(o,`.cpuTime+=`,u(),`-`,d,`;`),p&&(r?e(c,`.pushScopeStats(`,f,`,`,c,`.getNumPendingQueries(),`,o,`);`):e(c,`.endQuery();`))}function g(e){var n=t.def(s,`.profile`);t(s,`.profile=`,e,`;`),t.exit(s,`.profile=`,n,`;`)}var _;if(l){if(gs(l)){l.enable?(m(t),h(t.exit),g(`true`)):g(`false`);return}_=l.append(e,t),g(_)}else _=t.def(s,`.profile`);var v=e.block();m(v),t(`if(`,_,`){`,v,`}`);var y=e.block();h(y),t.exit(`if(`,_,`){`,y,`}`)}function H(e,t,n,r,i){var a=e.shared;function o(e){switch(e){case Ao:case Po:case Ro:return 2;case jo:case Fo:case zo:return 3;case Mo:case Io:case Bo:return 4;default:return 1}}function s(n,r,i){var o=a.gl,s=t.def(n,`.location`),c=t.def(a.attributes,`[`,s,`]`),l=i.state,u=i.buffer,d=[i.x,i.y,i.z,i.w],f=[`buffer`,`normalized`,`offset`,`stride`];function p(){t(`if(!`,c,`.buffer){`,o,`.enableVertexAttribArray(`,s,`);}`);var n=i.type,a=i.size?t.def(i.size,`||`,r):r;if(t(`if(`,c,`.type!==`,n,`||`,c,`.size!==`,a,`||`,f.map(function(e){return c+`.`+e+`!==`+i[e]}).join(`||`),`){`,o,`.bindBuffer(`,mo,`,`,u,`.buffer);`,o,`.vertexAttribPointer(`,[s,a,n,i.normalized,i.stride,i.offset],`);`,c,`.type=`,n,`;`,c,`.size=`,a,`;`,f.map(function(e){return c+`.`+e+`=`+i[e]+`;`}).join(``),`}`),_){var l=i.divisor;t(`if(`,c,`.divisor!==`,l,`){`,e.instancing,`.vertexAttribDivisorANGLE(`,[s,l],`);`,c,`.divisor=`,l,`;}`)}}function m(){t(`if(`,c,`.buffer){`,o,`.disableVertexAttribArray(`,s,`);`,c,`.buffer=null;`,`}if(`,da.map(function(e,t){return c+`.`+e+`!==`+d[t]}).join(`||`),`){`,o,`.vertexAttrib4f(`,s,`,`,d,`);`,da.map(function(e,t){return c+`.`+e+`=`+d[t]+`;`}).join(``),`}`)}l===pa?p():l===ma?m():(t(`if(`,l,`===`,pa,`){`),p(),t(`}else{`),m(),t(`}`))}r.forEach(function(r){var a=r.name,c=n.attributes[a],l;if(c){if(!i(c))return;l=c.append(e,t)}else{if(!i(ys))return;var u=e.scopeAttrib(a);W.optional(function(){e.assert(t,u+`.state`,`missing attribute `+a)}),l={},Object.keys(new h).forEach(function(e){l[e]=t.def(u,`.`,e)})}s(e.link(r),o(r.info.type),l)})}function le(e,n,r,i,a){for(var o=e.shared,s=o.gl,c,l=0;l<i.length;++l){var u=i[l],d=u.name,f=u.info.type,p=r.uniforms[d],m=e.link(u)+`.location`,h;if(p){if(!a(p))continue;if(gs(p)){var g=p.value;if(W.command(g!=null,`missing uniform "`+d+`"`,e.commandStr),f===Wo||f===Go){W.command(typeof g==`function`&&(f===Wo&&(g._reglType===`texture2d`||g._reglType===`framebuffer`)||f===Go&&(g._reglType===`textureCube`||g._reglType===`framebufferCube`)),`invalid texture for uniform `+d,e.commandStr);var _=e.link(g._texture||g.color[0]._texture);n(s,`.uniform1i(`,m,`,`,_+`.bind());`),n.exit(_,`.unbind();`)}else if(f===Vo||f===Ho||f===Uo){W.optional(function(){W.command(vn(g),`invalid matrix for uniform `+d,e.commandStr),W.command(f===Vo&&g.length===4||f===Ho&&g.length===9||f===Uo&&g.length===16,`invalid length for matrix uniform `+d,e.commandStr)});var v=e.global.def(`new Float32Array([`+Array.prototype.slice.call(g)+`])`),y=2;f===Ho?y=3:f===Uo&&(y=4),n(s,`.uniformMatrix`,y,`fv(`,m,`,false,`,v,`);`)}else{switch(f){case ko:W.commandType(g,`number`,`uniform `+d,e.commandStr),c=`1f`;break;case Ao:W.command(vn(g)&&g.length===2,`uniform `+d,e.commandStr),c=`2f`;break;case jo:W.command(vn(g)&&g.length===3,`uniform `+d,e.commandStr),c=`3f`;break;case Mo:W.command(vn(g)&&g.length===4,`uniform `+d,e.commandStr),c=`4f`;break;case Lo:W.commandType(g,`boolean`,`uniform `+d,e.commandStr),c=`1i`;break;case No:W.commandType(g,`number`,`uniform `+d,e.commandStr),c=`1i`;break;case Ro:W.command(vn(g)&&g.length===2,`uniform `+d,e.commandStr),c=`2i`;break;case Po:W.command(vn(g)&&g.length===2,`uniform `+d,e.commandStr),c=`2i`;break;case zo:W.command(vn(g)&&g.length===3,`uniform `+d,e.commandStr),c=`3i`;break;case Fo:W.command(vn(g)&&g.length===3,`uniform `+d,e.commandStr),c=`3i`;break;case Bo:W.command(vn(g)&&g.length===4,`uniform `+d,e.commandStr),c=`4i`;break;case Io:W.command(vn(g)&&g.length===4,`uniform `+d,e.commandStr),c=`4i`;break}n(s,`.uniform`,c,`(`,m,`,`,vn(g)?Array.prototype.slice.call(g):g,`);`)}continue}else h=p.append(e,n)}else{if(!a(ys))continue;h=n.def(o.uniforms,`[`,t.id(d),`]`)}f===Wo?n(`if(`,h,`&&`,h,`._reglType==="framebuffer"){`,h,`=`,h,`.color[0];`,`}`):f===Go&&n(`if(`,h,`&&`,h,`._reglType==="framebufferCube"){`,h,`=`,h,`.color[0];`,`}`),W.optional(function(){function t(t,r){e.assert(n,t,`bad data or missing for uniform "`+d+`".  `+r)}function r(e){t(`typeof `+h+`==="`+e+`"`,`invalid type, expected `+e)}function i(n,r){t(o.isArrayLike+`(`+h+`)&&`+h+`.length===`+n,`invalid vector, should have length `+n,e.commandStr)}function a(n){t(`typeof `+h+`==="function"&&`+h+`._reglType==="texture`+(n===vo?`2d`:`Cube`)+`"`,`invalid texture type`,e.commandStr)}switch(f){case No:r(`number`);break;case Po:i(2,`number`);break;case Fo:i(3,`number`);break;case Io:i(4,`number`);break;case ko:r(`number`);break;case Ao:i(2,`number`);break;case jo:i(3,`number`);break;case Mo:i(4,`number`);break;case Lo:r(`boolean`);break;case Ro:i(2,`boolean`);break;case zo:i(3,`boolean`);break;case Bo:i(4,`boolean`);break;case Vo:i(4,`number`);break;case Ho:i(9,`number`);break;case Uo:i(16,`number`);break;case Wo:a(vo);break;case Go:a(yo);break}});var b=1;switch(f){case Wo:case Go:var x=n.def(h,`._texture`);n(s,`.uniform1i(`,m,`,`,x,`.bind());`),n.exit(x,`.unbind();`);continue;case No:case Lo:c=`1i`;break;case Po:case Ro:c=`2i`,b=2;break;case Fo:case zo:c=`3i`,b=3;break;case Io:case Bo:c=`4i`,b=4;break;case ko:c=`1f`;break;case Ao:c=`2f`,b=2;break;case jo:c=`3f`,b=3;break;case Mo:c=`4f`,b=4;break;case Vo:c=`Matrix2fv`;break;case Ho:c=`Matrix3fv`;break;case Uo:c=`Matrix4fv`;break}if(n(s,`.uniform`,c,`(`,m,`,`),c.charAt(0)===`M`){var S=(f-Vo+2)**2,C=e.global.def(`new Float32Array(`,S,`)`);n(`false,(Array.isArray(`,h,`)||`,h,` instanceof Float32Array)?`,h,`:(`,Pe(S,function(e){return C+`[`+e+`]=`+h+`[`+e+`]`}),`,`,C,`)`)}else n(b>1?Pe(b,function(e){return h+`[`+e+`]`}):h);n(`);`)}}function ue(e,t,n,r){var i=e.shared,a=i.gl,o=i.draw,s=r.draw;function c(){var i=s.elements,c,l=t;return i?((i.contextDep&&r.contextDynamic||i.propDep)&&(l=n),c=i.append(e,l)):c=l.def(o,`.`,Za),c&&l(`if(`+c+`)`+a+`.bindBuffer(`+ho+`,`+c+`.buffer.buffer);`),c}function l(){var i=s.count,a,c=t;return i?((i.contextDep&&r.contextDynamic||i.propDep)&&(c=n),a=i.append(e,c),W.optional(function(){i.MISSING&&e.assert(t,`false`,`missing vertex count`),i.DYNAMIC&&e.assert(c,a+`>=0`,`missing vertex count`)})):(a=c.def(o,`.`,$a),W.optional(function(){e.assert(c,a+`>=0`,`missing vertex count`)})),a}var u=c();function d(i){var a=s[i];return a?a.contextDep&&r.contextDynamic||a.propDep?a.append(e,n):a.append(e,t):t.def(o,`.`,i)}var f=d(Qa),p=d(eo),m=l();if(typeof m==`number`){if(m===0)return}else n(`if(`,m,`){`),n.exit(`}`);var h,g;_&&(h=d(to),g=e.instancing);var v=u+`.type`,y=s.elements&&gs(s.elements);function b(){function e(){n(g,`.drawElementsInstancedANGLE(`,[f,m,v,p+`<<((`+v+`-`+fa+`)>>1)`,h],`);`)}function t(){n(g,`.drawArraysInstancedANGLE(`,[f,p,m,h],`);`)}u?y?e():(n(`if(`,u,`){`),e(),n(`}else{`),t(),n(`}`)):t()}function x(){function e(){n(a+`.drawElements(`+[f,m,v,p+`<<((`+v+`-`+fa+`)>>1)`]+`);`)}function t(){n(a+`.drawArrays(`+[f,p,m]+`);`)}u?y?e():(n(`if(`,u,`){`),e(),n(`}else{`),t(),n(`}`)):t()}_&&(typeof h!=`number`||h>=0)?typeof h==`string`?(n(`if(`,h,`>0){`),b(),n(`}else if(`,h,`<0){`),x(),n(`}`)):b():x()}function de(e,t,n,r,i){var a=j(),o=a.proc(`body`,i);return W.optional(function(){a.commandStr=t.commandStr,a.command=a.link(t.commandStr)}),_&&(a.instancing=o.def(a.shared.extensions,`.angle_instanced_arrays`)),e(a,o,n,r),a.compile().body}function U(e,t,n,r){se(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,`.setVAO(`,n.drawVAO.append(e,t),`);`):t(e.shared.vao,`.setVAO(`,e.shared.vao,`.targetVAO);`):(t(e.shared.vao,`.setVAO(null);`),H(e,t,n,r.attributes,function(){return!0})),le(e,t,n,r.uniforms,function(){return!0}),ue(e,t,t,n)}function fe(e,t){var n=e.proc(`draw`,1);se(e,n),V(e,n,t.context),ie(e,n,t.framebuffer),ae(e,n,t),oe(e,n,t.state),ce(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,`.useProgram(`,r,`.program);`),t.shader.program)U(e,n,t,t.shader.program);else{n(e.shared.vao,`.setVAO(null);`);var i=e.global.def(`{}`),a=n.def(r,`.id`),o=n.def(i,`[`,a,`]`);n(e.cond(o).then(o,`.call(this,a0);`).else(o,`=`,i,`[`,a,`]=`,e.link(function(n){return de(U,e,t,n,1)}),`(`,r,`);`,o,`.call(this,a0);`))}Object.keys(t.state).length>0&&n(e.shared.current,`.dirty=true;`)}function pe(e,t,n,r){e.batchId=`a1`,se(e,t);function i(){return!0}H(e,t,n,r.attributes,i),le(e,t,n,r.uniforms,i),ue(e,t,t,n)}function me(e,t,n,r){se(e,t);var i=n.contextDep,a=t.def(),o=`a0`,s=`a1`,c=t.def();e.shared.props=c,e.batchId=a;var l=e.scope(),u=e.scope();t(l.entry,`for(`,a,`=0;`,a,`<`,s,`;++`,a,`){`,c,`=`,o,`[`,a,`];`,u,`}`,l.exit);function d(e){return e.contextDep&&i||e.propDep}function f(e){return!d(e)}if(n.needsContext&&V(e,u,n.context),n.needsFramebuffer&&ie(e,u,n.framebuffer),oe(e,u,n.state,d),n.profile&&d(n.profile)&&ce(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?d(n.drawVAO)?u(e.shared.vao,`.setVAO(`,n.drawVAO.append(e,u),`);`):l(e.shared.vao,`.setVAO(`,n.drawVAO.append(e,l),`);`):l(e.shared.vao,`.setVAO(`,e.shared.vao,`.targetVAO);`):(l(e.shared.vao,`.setVAO(null);`),H(e,l,n,r.attributes,f),H(e,u,n,r.attributes,d)),le(e,l,n,r.uniforms,f),le(e,u,n,r.uniforms,d),ue(e,l,u,n);else{var p=e.global.def(`{}`),m=n.shader.progVar.append(e,u),h=u.def(m,`.id`),g=u.def(p,`[`,h,`]`);u(e.shared.gl,`.useProgram(`,m,`.program);`,`if(!`,g,`){`,g,`=`,p,`[`,h,`]=`,e.link(function(t){return de(pe,e,n,t,2)}),`(`,m,`);}`,g,`.call(this,a0[`,a,`],`,a,`);`)}}function he(e,t){var n=e.proc(`batch`,2);e.batchId=`0`,se(e,n);var r=!1,i=!0;Object.keys(t.context).forEach(function(e){r||=t.context[e].propDep}),r||(V(e,n,t.context),i=!1);var a=t.framebuffer,o=!1;a?(a.propDep?r=o=!0:a.contextDep&&r&&(o=!0),o||ie(e,n,a)):ie(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0);function s(e){return e.contextDep&&r||e.propDep}ae(e,n,t),oe(e,n,t.state,function(e){return!s(e)}),(!t.profile||!s(t.profile))&&ce(e,n,t,!1,`a1`),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=o;var c=t.shader.progVar;if(c.contextDep&&r||c.propDep)me(e,n,t,null);else{var l=c.append(e,n);if(n(e.shared.gl,`.useProgram(`,l,`.program);`),t.shader.program)me(e,n,t,t.shader.program);else{n(e.shared.vao,`.setVAO(null);`);var u=e.global.def(`{}`),d=n.def(l,`.id`),f=n.def(u,`[`,d,`]`);n(e.cond(f).then(f,`.call(this,a0,a1);`).else(f,`=`,u,`[`,d,`]=`,e.link(function(n){return de(me,e,t,n,2)}),`(`,l,`);`,f,`.call(this,a0,a1);`))}}Object.keys(t.state).length>0&&n(e.shared.current,`.dirty=true;`)}function ge(e,n){var r=e.proc(`scope`,3);e.batchId=`a2`;var i=e.shared,a=i.current;V(e,r,n.context),n.framebuffer&&n.framebuffer.append(e,r),ms(Object.keys(n.state)).forEach(function(t){var a=n.state[t].append(e,r);vn(a)?a.forEach(function(n,i){r.set(e.next[t],`[`+i+`]`,n)}):r.set(i.next,`.`+t,a)}),ce(e,r,n,!0,!0),[Za,eo,$a,to,Qa].forEach(function(t){var a=n.draw[t];a&&r.set(i.draw,`.`+t,``+a.append(e,r))}),Object.keys(n.uniforms).forEach(function(a){r.set(i.uniforms,`[`+t.id(a)+`]`,n.uniforms[a].append(e,r))}),Object.keys(n.attributes).forEach(function(t){var i=n.attributes[t].append(e,r),a=e.scopeAttrib(t);Object.keys(new h).forEach(function(e){r.set(a,`.`+e,i[e])})}),n.scopeVAO&&r.set(i.vao,`.targetVAO`,n.scopeVAO.append(e,r));function o(t){var a=n.shader[t];a&&r.set(i.shader,`.`+t,a.append(e,r))}o(Ya),o(Xa),Object.keys(n.state).length>0&&(r(a,`.dirty=true;`),r.exit(a,`.dirty=true;`)),r(`a1(`,e.shared.context,`,a0,`,e.batchId,`);`)}function _e(e){if(!(typeof e!=`object`||vn(e))){for(var t=Object.keys(e),n=0;n<t.length;++n)if(Se.isDynamic(e[t[n]]))return!0;return!1}}function G(e,t,n){var r=t.static[n];if(!r||!_e(r))return;var i=e.global,a=Object.keys(r),o=!1,s=!1,c=!1,l=e.global.def(`{}`);a.forEach(function(t){var n=r[t];if(Se.isDynamic(n)){typeof n==`function`&&(n=r[t]=Se.unbox(n));var a=vs(n,null);o||=a.thisDep,c||=a.propDep,s||=a.contextDep}else{switch(i(l,`.`,t,`=`),typeof n){case`number`:i(n);break;case`string`:i(`"`,n,`"`);break;case`object`:Array.isArray(n)&&i(`[`,n.join(),`]`);break;default:i(e.link(n));break}i(`;`)}});function u(e,t){a.forEach(function(n){var i=r[n];Se.isDynamic(i)&&t(l,`.`,n,`=`,e.invoke(t,i),`;`)})}t.dynamic[n]=new Se.DynamicVariable(ya,{thisDep:o,contextDep:s,propDep:c,ref:l,append:u}),delete t.static[n]}function K(e,t,n,r,i){var a=j();a.stats=a.link(i),Object.keys(t.static).forEach(function(e){G(a,t,e)}),po.forEach(function(t){G(a,e,t)});var o=re(e,t,n,r,a);return fe(a,o),ge(a,o),he(a,o),a.compile()}return{next:b,current:y,procs:(function(){var e=j(),t=e.proc(`poll`),i=e.proc(`refresh`),a=e.block();t(a),i(a);var o=e.shared,s=o.gl,c=o.next,l=o.current;a(l,`.dirty=false;`),ie(e,t),ie(e,i,null,!0);var u;_&&(u=e.link(_)),n.oes_vertex_array_object&&i(e.link(n.oes_vertex_array_object),`.bindVertexArrayOES(null);`);for(var d=0;d<r.maxAttributes;++d){var f=i.def(o.attributes,`[`,d,`]`),p=e.cond(f,`.buffer`);p.then(s,`.enableVertexAttribArray(`,d,`);`,s,`.bindBuffer(`,mo,`,`,f,`.buffer.buffer);`,s,`.vertexAttribPointer(`,d,`,`,f,`.size,`,f,`.type,`,f,`.normalized,`,f,`.stride,`,f,`.offset);`).else(s,`.disableVertexAttribArray(`,d,`);`,s,`.vertexAttrib4f(`,d,`,`,f,`.x,`,f,`.y,`,f,`.z,`,f,`.w);`,f,`.buffer=null;`),i(p),_&&i(u,`.vertexAttribDivisorANGLE(`,d,`,`,f,`.divisor);`)}return i(e.shared.vao,`.currentVAO=null;`,e.shared.vao,`.setVAO(`,e.shared.vao,`.targetVAO);`),Object.keys(S).forEach(function(n){var r=S[n],o=a.def(c,`.`,n),u=e.block();u(`if(`,o,`){`,s,`.enable(`,r,`)}else{`,s,`.disable(`,r,`)}`,l,`.`,n,`=`,o,`;`),i(u),t(`if(`,o,`!==`,l,`.`,n,`){`,u,`}`)}),Object.keys(C).forEach(function(n){var r=C[n],o=y[n],u,d,f=e.block();if(f(s,`.`,r,`(`),vn(o)){var p=o.length;u=e.global.def(c,`.`,n),d=e.global.def(l,`.`,n),f(Pe(p,function(e){return u+`[`+e+`]`}),`);`,Pe(p,function(e){return d+`[`+e+`]=`+u+`[`+e+`];`}).join(``)),t(`if(`,Pe(p,function(e){return u+`[`+e+`]!==`+d+`[`+e+`]`}).join(`||`),`){`,f,`}`)}else u=a.def(c,`.`,n),d=a.def(l,`.`,n),f(u,`);`,l,`.`,n,`=`,u,`;`),t(`if(`,u,`!==`,d,`){`,f,`}`);i(f)}),e.compile()})(),compile:K}}function xs(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ss=34918,Cs=34919,ws=35007,Ts=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function i(e){n.push(e)}var a=[];function o(e){var n=r();t.ext_disjoint_timer_query.beginQueryEXT(ws,n),a.push(n),p(a.length-1,a.length,e)}function s(){t.ext_disjoint_timer_query.endQueryEXT(ws)}function c(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var l=[];function u(){return l.pop()||new c}function d(e){l.push(e)}var f=[];function p(e,t,n){var r=u();r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,f.push(r)}var m=[],h=[];function g(){var e,n,r=a.length;if(r!==0){h.length=Math.max(h.length,r+1),m.length=Math.max(m.length,r+1),m[0]=0,h[0]=0;var o=0;for(e=0,n=0;n<a.length;++n){var s=a[n];t.ext_disjoint_timer_query.getQueryObjectEXT(s,Cs)?(o+=t.ext_disjoint_timer_query.getQueryObjectEXT(s,Ss),i(s)):a[e++]=s,m[n+1]=o,h[n+1]=e}for(a.length=e,e=0,n=0;n<f.length;++n){var c=f[n],l=c.startQueryIndex,u=c.endQueryIndex;c.sum+=m[u]-m[l];var p=h[l],g=h[u];g===p?(c.stats.gpuTime+=c.sum/1e6,d(c)):(c.startQueryIndex=p,c.endQueryIndex=g,f[e++]=c)}f.length=e}}return{beginQuery:o,endQuery:s,pushScopeStats:p,update:g,getNumPendingQueries:function(){return a.length},clear:function(){n.push.apply(n,a);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);a.length=0,n.length=0},restore:function(){a.length=0,n.length=0}}},Es=16384,Ds=256,Os=1024,ks=34962,As=`webglcontextlost`,js=`webglcontextrestored`,Ms=1,Ns=2,Ps=3;function Fs(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}function Is(e){var n=Me(e);if(!n)return null;var r=n.gl,i=r.getContextAttributes(),a=r.isContextLost(),o=Ne(r,n);if(!o)return null;var s=Te(),c=xs(),l=o.extensions,u=Ts(r,l),d=we(),f=r.drawingBufferWidth,p=r.drawingBufferHeight,m={tick:0,time:0,viewportWidth:f,viewportHeight:p,framebufferWidth:f,framebufferHeight:p,drawingBufferWidth:f,drawingBufferHeight:p,pixelRatio:n.pixelRatio},h={},g={elements:null,primitive:4,count:-1,offset:0,instances:-1},_=kt(r,l),v=Qt(r,c,n,b),y=Zi(r,l,_,c,v);function b(e){return y.destroyBuffer(e)}var x=pn(r,l,v,c),S=na(r,s,c,n),C=ni(r,l,_,function(){D.procs.poll()},m,c,n),w=gi(r,l,_,c,n),E=qi(r,l,_,C,w,c),D=bs(r,s,l,_,v,x,C,E,h,y,S,g,m,u,n),O=sa(r,E,D.procs.poll,m,i,l,_),k=D.next,A=r.canvas,j=[],M=[],N=[],P=[n.onDestroy],F=null;function I(){if(j.length===0){u&&u.update(),F=null;return}F=Ce.next(I),se();for(var e=j.length-1;e>=0;--e){var t=j[e];t&&t(m,null,0)}r.flush(),u&&u.update()}function ee(){!F&&j.length>0&&(F=Ce.next(I))}function R(){F&&=(Ce.cancel(I),null)}function z(e){e.preventDefault(),a=!0,R(),M.forEach(function(e){e()})}function B(e){r.getError(),a=!1,o.restore(),S.restore(),v.restore(),C.restore(),w.restore(),E.restore(),y.restore(),u&&u.restore(),D.procs.refresh(),ee(),N.forEach(function(e){e()})}A&&(A.addEventListener(As,z,!1),A.addEventListener(js,B,!1));function te(){j.length=0,R(),A&&(A.removeEventListener(As,z),A.removeEventListener(js,B)),S.clear(),E.clear(),w.clear(),C.clear(),x.clear(),v.clear(),y.clear(),u&&u.clear(),P.forEach(function(e){e()})}function ne(e){W(!!e,`invalid args to regl({...})`),W.type(e,`object`,`invalid args to regl({...})`);function n(e){var n=t({},e);delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,`stencil`in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach(function(r){n[e+`.`+r]=t[r]})}}return r(`blend`),r(`depth`),r(`cull`),r(`stencil`),r(`polygonOffset`),r(`scissor`),r(`sample`),`vao`in e&&(n.vao=e.vao),n}function r(e){var t={},n={};return Object.keys(e).forEach(function(r){var i=e[r];Se.isDynamic(i)?n[r]=Se.unbox(i,r):t[r]=i}),{dynamic:n,static:t}}var i=r(e.context||{}),o=r(e.uniforms||{}),s=r(e.attributes||{}),c=r(n(e)),l={gpuTime:0,cpuTime:0,count:0},u=D.compile(c,s,o,i,l),d=u.draw,f=u.batch,p=u.scope,m=[];function h(e){for(;m.length<e;)m.push(null);return m}function g(e,t){var n;if(a&&W.raise(`context lost`),typeof e==`function`)return p.call(this,null,e,0);if(typeof t==`function`)if(typeof e==`number`)for(n=0;n<e;++n)p.call(this,null,t,n);else if(Array.isArray(e))for(n=0;n<e.length;++n)p.call(this,e[n],t,n);else return p.call(this,e,t,0);else if(typeof e==`number`){if(e>0)return f.call(this,h(e|0),e|0)}else if(Array.isArray(e)){if(e.length)return f.call(this,e,e.length)}else return d.call(this,e)}return t(g,{stats:l})}var re=E.setFBO=ne({framebuffer:Se.define.call(null,Ms,`framebuffer`)});function V(e,t){var n=0;D.procs.poll();var i=t.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=Es),`depth`in t&&(r.clearDepth(+t.depth),n|=Ds),`stencil`in t&&(r.clearStencil(t.stencil|0),n|=Os),W(!!n,`called regl.clear with no buffer specified`),r.clear(n)}function ie(e){if(W(typeof e==`object`&&e,`regl.clear() takes an object as input`),`framebuffer`in e)if(e.framebuffer&&e.framebuffer_reglType===`framebufferCube`)for(var n=0;n<6;++n)re(t({framebuffer:e.framebuffer.faces[n]},e),V);else re(e,V);else V(null,e)}function ae(e){W.type(e,`function`,`regl.frame() callback must be a function`),j.push(e);function t(){var t=Fs(j,e);W(t>=0,`cannot cancel a frame twice`);function n(){var e=Fs(j,n);j[e]=j[j.length-1],--j.length,j.length<=0&&R()}j[t]=n}return ee(),{cancel:t}}function oe(){var e=k.viewport,t=k.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=r.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=r.drawingBufferHeight}function se(){m.tick+=1,m.time=H(),oe(),D.procs.poll()}function ce(){oe(),D.procs.refresh(),u&&u.update()}function H(){return(we()-d)/1e3}ce();function le(e,t){W.type(t,`function`,`listener callback must be a function`);var n;switch(e){case`frame`:return ae(t);case`lost`:n=M;break;case`restore`:n=N;break;case`destroy`:n=P;break;default:W.raise(`invalid event, must be one of frame,lost,restore,destroy`)}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t){n[e]=n[n.length-1],n.pop();return}}}}var ue=t(ne,{clear:ie,prop:Se.define.bind(null,Ms),context:Se.define.bind(null,Ns),this:Se.define.bind(null,Ps),draw:ne({}),buffer:function(e){return v.create(e,ks,!1,!1)},elements:function(e){return x.create(e,!1)},texture:C.create2D,cube:C.createCube,renderbuffer:w.create,framebuffer:E.create,framebufferCube:E.createCube,vao:y.createVAO,attributes:i,frame:ae,on:le,limits:_,hasExtension:function(e){return _.extensions.indexOf(e.toLowerCase())>=0},read:O,destroy:te,_gl:r,_refresh:ce,poll:function(){se(),u&&u.update()},now:H,stats:c});return n.onDone(null,ue),ue}return Is}))})),N2,P2=o((()=>{N2=class{constructor(e,t){let{buffer:n,offset:r,stride:i,normalized:a,size:o,divisor:s}=t;this.buffer=n,this.attribute={buffer:n.get(),offset:r||0,stride:i||0,normalized:a||!1,divisor:s||0},o&&(this.attribute.size=o)}get(){return this.attribute}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}}})),F2,I2,L2,R2,z2,B2,V2,H2,U2,W2,G2,K2,q2,J2,Y2=o((()=>{UC(),F2={[X.POINTS]:`points`,[X.LINES]:`lines`,[X.LINE_LOOP]:`line loop`,[X.LINE_STRIP]:`line strip`,[X.TRIANGLES]:`triangles`,[X.TRIANGLE_FAN]:`triangle fan`,[X.TRIANGLE_STRIP]:`triangle strip`},I2={[X.STATIC_DRAW]:`static`,[X.DYNAMIC_DRAW]:`dynamic`,[X.STREAM_DRAW]:`stream`},L2={[X.BYTE]:`int8`,[X.INT]:`int32`,[X.UNSIGNED_BYTE]:`uint8`,[X.UNSIGNED_SHORT]:`uint16`,[X.UNSIGNED_INT]:`uint32`,[X.FLOAT]:`float`},R2={[X.ALPHA]:`alpha`,[X.LUMINANCE]:`luminance`,[X.LUMINANCE_ALPHA]:`luminance alpha`,[X.RGB]:`rgb`,[X.RGBA]:`rgba`,[X.RGBA4]:`rgba4`,[X.RGB5_A1]:`rgb5 a1`,[X.RGB565]:`rgb565`,[X.DEPTH_COMPONENT]:`depth`,[X.DEPTH_STENCIL]:`depth stencil`},z2={[X.DONT_CARE]:`dont care`,[X.NICEST]:`nice`,[X.FASTEST]:`fast`},B2={[X.NEAREST]:`nearest`,[X.LINEAR]:`linear`,[X.LINEAR_MIPMAP_LINEAR]:`mipmap`,[X.NEAREST_MIPMAP_LINEAR]:`nearest mipmap linear`,[X.LINEAR_MIPMAP_NEAREST]:`linear mipmap nearest`,[X.NEAREST_MIPMAP_NEAREST]:`nearest mipmap nearest`},V2={[X.REPEAT]:`repeat`,[X.CLAMP_TO_EDGE]:`clamp`,[X.MIRRORED_REPEAT]:`mirror`},H2={[X.NONE]:`none`,[X.BROWSER_DEFAULT_WEBGL]:`browser`},U2={[X.NEVER]:`never`,[X.ALWAYS]:`always`,[X.LESS]:`less`,[X.LEQUAL]:`lequal`,[X.GREATER]:`greater`,[X.GEQUAL]:`gequal`,[X.EQUAL]:`equal`,[X.NOTEQUAL]:`notequal`},W2={[X.FUNC_ADD]:`add`,[X.MIN_EXT]:`min`,[X.MAX_EXT]:`max`,[X.FUNC_SUBTRACT]:`subtract`,[X.FUNC_REVERSE_SUBTRACT]:`reverse subtract`},G2={[X.ZERO]:`zero`,[X.ONE]:`one`,[X.SRC_COLOR]:`src color`,[X.ONE_MINUS_SRC_COLOR]:`one minus src color`,[X.SRC_ALPHA]:`src alpha`,[X.ONE_MINUS_SRC_ALPHA]:`one minus src alpha`,[X.DST_COLOR]:`dst color`,[X.ONE_MINUS_DST_COLOR]:`one minus dst color`,[X.DST_ALPHA]:`dst alpha`,[X.ONE_MINUS_DST_ALPHA]:`one minus dst alpha`,[X.CONSTANT_COLOR]:`constant color`,[X.ONE_MINUS_CONSTANT_COLOR]:`one minus constant color`,[X.CONSTANT_ALPHA]:`constant alpha`,[X.ONE_MINUS_CONSTANT_ALPHA]:`one minus constant alpha`,[X.SRC_ALPHA_SATURATE]:`src alpha saturate`},K2={[X.NEVER]:`never`,[X.ALWAYS]:`always`,[X.LESS]:`less`,[X.LEQUAL]:`lequal`,[X.GREATER]:`greater`,[X.GEQUAL]:`gequal`,[X.EQUAL]:`equal`,[X.NOTEQUAL]:`notequal`},q2={[X.ZERO]:`zero`,[X.KEEP]:`keep`,[X.REPLACE]:`replace`,[X.INVERT]:`invert`,[X.INCR]:`increment`,[X.DECR]:`decrement`,[X.INCR_WRAP]:`increment wrap`,[X.DECR_WRAP]:`decrement wrap`},J2={[X.FRONT]:`front`,[X.BACK]:`back`}})),X2,Z2=o((()=>{UC(),Y2(),X2=class{constructor(e,t){this.isDestroyed=!1;let{data:n,usage:r,type:i}=t;this.buffer=e.buffer({data:n,usage:I2[r||X.STATIC_DRAW],type:L2[i||X.UNSIGNED_BYTE]})}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){this.buffer.subdata(e,t)}}})),Q2,$2=o((()=>{UC(),Y2(),Q2=class{constructor(e,t){let{data:n,usage:r,type:i,count:a}=t;this.elements=e.elements({data:n,usage:I2[r||X.STATIC_DRAW],type:L2[i||X.UNSIGNED_BYTE],count:a})}get(){return this.elements}subData({data:e}){this.elements.subdata(e)}destroy(){}}})),e4,t4=o((()=>{e4=class{constructor(e,t){let{width:n,height:r,color:i,colors:a}=t,o={width:n,height:r};Array.isArray(a)&&(o.colors=a.map(e=>e.get())),i&&typeof i!=`boolean`&&(o.color=i.get()),this.framebuffer=e.framebuffer(o)}get(){return this.framebuffer}destroy(){this.framebuffer.destroy()}resize({width:e,height:t}){this.framebuffer.resize(e,t)}}})),n4,r4,i4,a4,o4,s4,c4,l4,u4,d4,f4,p4,m4=o((()=>{S0(),UC(),kp(),Y2(),n4=Object.defineProperty,r4=Object.defineProperties,i4=Object.getOwnPropertyDescriptors,a4=Object.getOwnPropertySymbols,o4=Object.prototype.hasOwnProperty,s4=Object.prototype.propertyIsEnumerable,c4=(e,t,n)=>t in e?n4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,l4=(e,t)=>{for(var n in t||={})o4.call(t,n)&&c4(e,n,t[n]);if(a4)for(var n of a4(t))s4.call(t,n)&&c4(e,n,t[n]);return e},u4=(e,t)=>r4(e,i4(t)),{isPlainObject:d4,isTypedArray:f4}=tu,p4=class{constructor(e,t){this.destroyed=!1,this.uniforms={},this.reGl=e;let{vs:n,fs:r,attributes:i,uniforms:a,primitive:o,count:s,elements:c,depth:l,cull:u,instances:d}=t,f={platformString:`WebGL1`,glslVersion:`#version 100`,explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:c1.LOWER_LEFT,clipSpaceNearZ:l1.NEGATIVE_ONE,supportMRT:!1},p={};this.options=t,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach(t=>{p[t]=e.prop(t)}));let m={};Object.keys(i).forEach(e=>{m[e]=i[e].get()});let h={attributes:m,frag:xv(OQ(f,`frag`,r,null,!1)),uniforms:p,vert:xv(OQ(f,`vert`,n,null,!1)),colorMask:e.prop(`colorMask`),lineWidth:1,blend:{enable:e.prop(`blend.enable`),func:e.prop(`blend.func`),equation:e.prop(`blend.equation`),color:e.prop(`blend.color`)},stencil:{enable:e.prop(`stencil.enable`),mask:e.prop(`stencil.mask`),func:e.prop(`stencil.func`),opFront:e.prop(`stencil.opFront`),opBack:e.prop(`stencil.opBack`)},primitive:F2[o===void 0?X.TRIANGLES:o]};d&&(h.instances=d),s?h.count=s:c&&(h.elements=c.get()),this.initDepthDrawParams({depth:l},h),this.initCullDrawParams({cull:u},h),this.drawCommand=e(h),this.drawParams=h}updateAttributesAndElements(e,t){let n={};Object.keys(e).forEach(t=>{n[t]=e[t].get()}),this.drawParams.attributes=n,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}updateAttributes(e){let t={};Object.keys(e).forEach(n=>{t[n]=e[n].get()}),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}addUniforms(e){this.uniforms=l4(l4({},this.uniforms),this.extractUniforms(e))}draw(e,t){if(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)return;let n=l4(l4({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach(e=>{let t=typeof n[e];t===`boolean`||t===`number`||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()}),r.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),r.stencil=this.getStencilDrawParams(e),r.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(r)}destroy(){var e;(e=this.drawParams?.elements)==null||e.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(e=>{e?.destroy()}),this.destroyed=!0}initDepthDrawParams({depth:e},t){e&&(t.depth={enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:U2[e.func||X.LESS],range:e.range||[0,1]})}getBlendDrawParams({blend:e}){let{enable:t,func:n,equation:r,color:i=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:G2[n&&n.srcRGB||X.SRC_ALPHA],srcAlpha:G2[n&&n.srcAlpha||X.SRC_ALPHA],dstRGB:G2[n&&n.dstRGB||X.ONE_MINUS_SRC_ALPHA],dstAlpha:G2[n&&n.dstAlpha||X.ONE_MINUS_SRC_ALPHA]},equation:{rgb:W2[r&&r.rgb||X.FUNC_ADD],alpha:W2[r&&r.alpha||X.FUNC_ADD]},color:i}}getStencilDrawParams({stencil:e}){let{enable:t,mask:n=-1,func:r={cmp:X.ALWAYS,ref:0,mask:-1},opFront:i={fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP},opBack:a={fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP}}=e||{};return{enable:!!t,mask:n,func:u4(l4({},r),{cmp:K2[r.cmp]}),opFront:{fail:q2[i.fail],zfail:q2[i.zfail],zpass:q2[i.zpass]},opBack:{fail:q2[a.fail],zfail:q2[a.zfail],zpass:q2[a.zpass]}}}getColorMaskDrawParams({stencil:e},t){return e?.enable&&e.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}initCullDrawParams({cull:e},t){if(e){let{enable:n,face:r=X.BACK}=e;t.cull={enable:!!n,face:J2[r]}}}extractUniforms(e){let t={};return Object.keys(e).forEach(n=>{this.extractUniformsRecursively(n,e[n],t,``)}),t}extractUniformsRecursively(e,t,n,r){if(t===null||typeof t==`number`||typeof t==`boolean`||Array.isArray(t)&&typeof t[0]==`number`||f4(t)||t===``||`resize`in t){n[`${r&&r+`.`}${e}`]=t;return}d4(t)&&Object.keys(t).forEach(i=>{this.extractUniformsRecursively(i,t[i],n,`${r&&r+`.`}${e}`)}),Array.isArray(t)&&t.forEach((t,i)=>{Object.keys(t).forEach(a=>{this.extractUniformsRecursively(a,t[a],n,`${r&&r+`.`}${e}[${i}]`)})})}}})),h4,g4=o((()=>{UC(),Y2(),h4=class{constructor(e,t){this.isDestroy=!1;let{data:n,type:r=X.UNSIGNED_BYTE,width:i,height:a,flipY:o=!1,format:s=X.RGBA,mipmap:c=!1,wrapS:l=X.CLAMP_TO_EDGE,wrapT:u=X.CLAMP_TO_EDGE,aniso:d=0,alignment:f=1,premultiplyAlpha:p=!1,mag:m=X.NEAREST,min:h=X.NEAREST,colorSpace:g=X.BROWSER_DEFAULT_WEBGL,x:_=0,y:v=0,copy:y=!1}=t;this.width=i,this.height=a;let b={width:i,height:a,type:L2[r],format:R2[s],wrapS:V2[l],wrapT:V2[u],mag:B2[m],min:B2[h],alignment:f,flipY:o,colorSpace:H2[g],premultiplyAlpha:p,aniso:d,x:_,y:v,copy:y};n&&(b.data=n),typeof c==`number`?b.mipmap=z2[c]:typeof c==`boolean`&&(b.mipmap=c),this.texture=e.texture(b)}get(){return this.texture}update(e={}){this.texture(e)}bind(){this.texture._texture.bind()}resize({width:e,height:t}){this.texture.resize(e,t),this.width=e,this.height=t}getSize(){return[this.width,this.height]}destroy(){var e;this.isDestroy||(e=this.texture)==null||e.destroy(),this.isDestroy=!0}}})),_4,v4,y4,b4=o((()=>{_4=u(M2()),P2(),Z2(),$2(),t4(),m4(),g4(),v4=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),y4=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>`WebGL1`,this.createModel=e=>new p4(this.gl,e),this.createAttribute=e=>new N2(this.gl,e),this.createBuffer=e=>new X2(this.gl,e),this.createElements=e=>new Q2(this.gl,e),this.createTexture2D=e=>new h4(this.gl,e),this.createFramebuffer=e=>new e4(this.gl,e),this.useFramebuffer=(e,t)=>{this.gl({framebuffer:e?e.get():null})(t)},this.useFramebufferAsync=(e,t)=>v4(this,null,function*(){this.gl({framebuffer:e?e.get():null})(t)}),this.clear=e=>{var t;let{color:n,depth:r,stencil:i,framebuffer:a=null}=e,o={color:n,depth:r,stencil:i};o.framebuffer=a===null?a:a.get(),(t=this.gl)==null||t.clear(o)},this.viewport=({x:e,y:t,width:n,height:r})=>{this.gl._gl.viewport(e,t,n,r),this.width=n,this.height=r,this.gl._refresh()},this.readPixels=e=>{let{framebuffer:t,x:n,y:r,width:i,height:a}=e,o={x:n,y:r,width:i,height:a};return t&&(o.framebuffer=t.get()),this.gl.read(o)},this.readPixelsAsync=e=>v4(this,null,function*(){return this.readPixels(e)}),this.getViewportSize=()=>({width:this.gl._gl.drawingBufferWidth,height:this.gl._gl.drawingBufferHeight}),this.getContainer=()=>this.canvas?.parentElement,this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.gl._gl,this.destroy=()=>{var e;this.canvas=null,(e=(this.gl?._gl)?.getExtension(`WEBGL_lose_context`))==null||e.loseContext(),this.gl.destroy(),this.gl=null}}init(e,t,n){return v4(this,null,function*(){this.canvas=e,n?this.gl=n:this.gl=yield new Promise((e,n)=>{(0,_4.default)({canvas:this.canvas,attributes:{alpha:!0,antialias:t.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,stencil:t.stencil},extensions:[`OES_element_index_uint`,`OES_standard_derivatives`,`ANGLE_instanced_arrays`],optionalExtensions:[`oes_texture_float_linear`,`OES_texture_float`,`EXT_texture_filter_anisotropic`,`EXT_blend_minmax`,`WEBGL_depth_texture`,`WEBGL_lose_context`],profile:!0,onDone:(t,r)=>{(t||!r)&&n(t),e(r)}})}),this.extensionObject={OES_texture_float:this.testExtension(`OES_texture_float`)}})}getPointSizeRange(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){this.gl({cull:{enable:!1,face:`back`},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:`add`},framebuffer:null}),this.gl._refresh()}setBaseState(){this.gl({cull:{enable:!1,face:`back`},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:`add`},framebuffer:null}),this.gl._refresh()}setCustomLayerDefaults(){let e=this.getGLContext();e.disable(e.CULL_FACE)}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}beginFrame(){}endFrame(){}}})),x4=o((()=>{j2(),b4()})),S4,C4,w4,T4=o((()=>{kp(),S4=u(Mf()),C4=[`selectstart`,`selecting`,`selectend`],w4=class extends S4.EventEmitter{constructor(e,t={}){super(),this.isEnable=!1,this.onDragStart=e=>{this.box.style.display=`block`,this.startEvent=this.endEvent=e,this.syncBoxBound(),this.emit(`selectstart`,this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragging=e=>{this.endEvent=e,this.syncBoxBound(),this.emit(`selecting`,this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragEnd=e=>{this.endEvent=e,this.box.style.display=`none`,this.emit(`selectend`,this.getLngLatBox(),this.startEvent,this.endEvent)},this.scene=e,this.options=t}get container(){return this.scene.getMapService().getMarkerContainer()}enable(){if(this.isEnable)return;let{className:e}=this.options;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor=`crosshair`,!this.box){let t=cu(`div`,void 0,this.container);t.classList.add(`l7-select-box`),e&&t.classList.add(e),t.style.display=`none`,this.box=t}this.scene.on(`dragstart`,this.onDragStart),this.scene.on(`dragging`,this.onDragging),this.scene.on(`dragend`,this.onDragEnd),this.isEnable=!0}disable(){this.isEnable&&=(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor=`auto`,this.scene.off(`dragstart`,this.onDragStart),this.scene.off(`dragging`,this.onDragging),this.scene.off(`dragend`,this.onDragEnd),!1)}syncBoxBound(){let{x:e,y:t}=this.startEvent,{x:n,y:r}=this.endEvent,i=Math.min(e,n),a=Math.min(t,r),o=Math.abs(e-n),s=Math.abs(t-r);this.box.style.top=`${a}px`,this.box.style.left=`${i}px`,this.box.style.width=`${o}px`,this.box.style.height=`${s}px`}getLngLatBox(){let{lngLat:{lng:e,lat:t}}=this.startEvent,{lngLat:{lng:n,lat:r}}=this.endEvent;return Bd([[e,t],[n,r]])}}})),E4,D4,O4,k4,A4,j4,M4,N4,P4,F4,I4,L4=o((()=>{RH(),UC(),TH(),x4(),kp(),T4(),E4=Object.defineProperty,D4=Object.defineProperties,O4=Object.getOwnPropertyDescriptors,k4=Object.getOwnPropertySymbols,A4=Object.prototype.hasOwnProperty,j4=Object.prototype.propertyIsEnumerable,M4=(e,t,n)=>t in e?E4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,N4=(e,t)=>{for(var n in t||={})A4.call(t,n)&&M4(e,n,t[n]);if(k4)for(var n of k4(t))j4.call(t,n)&&M4(e,n,t[n]);return e},P4=(e,t)=>D4(e,O4(t)),F4=(e,t,n)=>new Promise((r,i)=>{var a=e=>{try{s(n.next(e))}catch(e){i(e)}},o=e=>{try{s(n.throw(e))}catch(e){i(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((n=n.apply(e,t)).next())}),I4=class{constructor(e){let{id:t,map:n,renderer:r=`device`}=e,i=TC();this.container=i,n.setContainer(i,t),r===`regl`?i.rendererService=new y4:i.rendererService=new A2,this.sceneService=i.sceneService,this.mapService=i.mapService,this.iconService=i.iconService,this.fontService=i.fontService,this.controlService=i.controlService,this.layerService=i.layerService,this.debugService=i.debugService,this.debugService.setEnable(e.debug),this.markerService=i.markerService,this.interactionService=i.interactionService,this.popupService=i.popupService,this.boxSelect=new w4(this,{}),this.initComponent(t),this.sceneService.init(e),this.initControl()}get map(){return this.mapService.map}get loaded(){return this.sceneService.loaded}getServiceContainer(){return this.container}getSize(){return this.mapService.getSize()}getMinZoom(){return this.mapService.getMinZoom()}getMaxZoom(){return this.mapService.getMaxZoom()}getType(){return this.mapService.getType()}getMapContainer(){return this.mapService.getMapContainer()}getMapCanvasContainer(){return this.mapService.getMapCanvasContainer()}getMapService(){return this.mapService}getDebugService(){return this.debugService}exportPng(e){return F4(this,null,function*(){return this.sceneService.exportPng(e)})}exportMap(e){return F4(this,null,function*(){return this.sceneService.exportPng(e)})}registerRenderService(e){this.sceneService.loaded?new e(this).init():this.on(`loaded`,()=>{new e(this).init()})}setBgColor(e){this.mapService.setBgColor(e)}addLayer(e){this.loaded?this.preAddLayer(e):this.once(`loaded`,()=>{this.preAddLayer(e)})}preAddLayer(e){let t=EC(this.container);if(e.setContainer(t),this.sceneService.addLayer(e),e.inited){this.initTileLayer(e);let t=this.initMask(e);this.addMask(t,e.id)}else e.on(`inited`,()=>{this.initTileLayer(e);let t=this.initMask(e);this.addMask(t,e.id)})}initMask(e){let{mask:t,maskfence:n,maskColor:r=`#000`,maskOpacity:i=0}=e.getLayerConfig();if(!(!t||!n))return new cV().source(n).shape(`fill`).style({color:r,opacity:i})}addMask(e,t){if(!e)return;let n=this.getLayer(t);if(n){let t=EC(this.container);e.setContainer(t),n.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn(`parent layer not find!`)}getPickedLayer(){return this.layerService.pickedLayerId}getLayers(){return this.layerService.getLayers()}getLayer(e){return this.layerService.getLayer(e)}getLayerByName(e){return this.layerService.getLayerByName(e)}removeLayer(e,t){return F4(this,null,function*(){yield this.layerService.remove(e,t)})}removeAllLayer(){return F4(this,null,function*(){yield this.layerService.removeAllLayers()})}render(){this.sceneService.render()}setEnableRender(e){this.layerService.setEnableRender(e)}addIconFont(e,t){this.fontService.addIconFont(e,t)}addIconFonts(e){e.forEach(([e,t])=>{this.fontService.addIconFont(e,t)})}addFontFace(e,t){this.fontService.once(`fontloaded`,e=>{this.emit(`fontloaded`,e)}),this.fontService.addFontFace(e,t)}addImage(e,t){return F4(this,null,function*(){yield this.iconService.addImage(e,t)})}hasImage(e){return this.iconService.hasImage(e)}removeImage(e){this.iconService.removeImage(e)}addIconFontGlyphs(e,t){this.fontService.addIconGlyphs(t)}addControl(e){this.controlService.addControl(e,this.container)}removeControl(e){this.controlService.removeControl(e)}getControlByName(e){return this.controlService.getControlByName(e)}addMarker(e){this.markerService.addMarker(e)}addMarkerLayer(e){this.markerService.addMarkerLayer(e)}removeMarkerLayer(e){this.markerService.removeMarkerLayer(e)}removeAllMarkers(){this.markerService.removeAllMarkers()}removeAllMakers(){console.warn(`removeAllMakers 已废弃，请使用 removeAllMarkers`),this.markerService.removeAllMarkers()}addPopup(e){this.popupService.addPopup(e)}removePopup(e){this.popupService.removePopup(e)}on(e,t){var n;C4.includes(e)?(n=this.boxSelect)==null||n.on(e,t):RC.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}once(e,t){var n;C4.includes(e)?(n=this.boxSelect)==null||n.once(e,t):RC.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}emit(e,t){RC.includes(e)?this.sceneService.emit(e,t):this.mapService.on(e,t)}off(e,t){var n;C4.includes(e)?(n=this.boxSelect)==null||n.off(e,t):RC.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}getZoom(){return this.mapService.getZoom()}getCenter(e){return this.mapService.getCenter(e)}setCenter(e,t){return this.mapService.setCenter(e,t)}getPitch(){return this.mapService.getPitch()}setPitch(e){return this.mapService.setPitch(e)}getRotation(){return this.mapService.getRotation()}getBounds(){return this.mapService.getBounds()}setRotation(e){this.mapService.setRotation(e)}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}panTo(e){this.mapService.panTo(e)}panBy(e,t){this.mapService.panBy(e,t)}getContainer(){return this.mapService.getContainer()}setZoom(e){this.mapService.setZoom(e)}fitBounds(e,t){let{fitBoundsOptions:n,animate:r}=this.sceneService.getSceneConfig();this.mapService.fitBounds(e,t||P4(N4({},n),{animate:r}))}setZoomAndCenter(e,t){this.mapService.setZoomAndCenter(e,t)}setMapStyle(e){this.mapService.setMapStyle(e)}setMapStatus(e){this.mapService.setMapStatus(e)}pixelToLngLat(e){return this.mapService.pixelToLngLat(e)}lngLatToPixel(e){return this.mapService.lngLatToPixel(e)}containerToLngLat(e){return this.mapService.containerToLngLat(e)}lngLatToContainer(e){return this.mapService.lngLatToContainer(e)}destroy(){this.sceneService.destroy()}registerPostProcessingPass(e){this.container.postProcessingPass.name=new e}enableShaderPick(){this.layerService.enableShaderPick()}diasbleShaderPick(){this.layerService.disableShaderPick()}enableBoxSelect(e=!0){this.boxSelect.enable(),e&&this.boxSelect.once(`selectend`,()=>{this.disableBoxSelect()})}disableBoxSelect(){this.boxSelect.disable()}static addProtocol(e,t){Co.REGISTERED_PROTOCOLS[e]=t}static removeProtocol(e){delete Co.REGISTERED_PROTOCOLS[e]}getProtocol(e){return Co.REGISTERED_PROTOCOLS[e]}startAnimate(){this.layerService.startAnimate()}stopAnimate(){this.layerService.stopAnimate()}getPointSizeRange(){return this.sceneService.getPointSizeRange()}initComponent(e){this.controlService.init({container:iu(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}initControl(){let{logoVisible:e,logoPosition:t}=this.sceneService.getSceneConfig();e&&this.addControl(new CD({position:t}))}initTileLayer(e){e.getSource().isTile&&(e.tileLayer=new kV(e))}}})),R4,z4=o((()=>{R4=`2.23.2`})),B4=c({AJAXError:()=>Vo,AttributeType:()=>oy,BKDRHash:()=>Ud,BaiduMap:()=>Hq,BaseLayer:()=>YP,BaseMapService:()=>wq,BaseMapWrapper:()=>zH,BaseModel:()=>uF,BasePostProcessingPass:()=>gv,BlendType:()=>$v,ButtonControl:()=>JE,CameraUniform:()=>Rv,CanvasLayer:()=>CF,CanvasUpdateType:()=>gF,CityBuildingLayer:()=>AI,Control:()=>KE,CoordinateSystem:()=>Gv,CoordinateUniform:()=>Kv,DOM:()=>ru,Earth:()=>Zq,EarthLayer:()=>YV,ExportImage:()=>cD,FrequencyController:()=>Wu,Fullscreen:()=>gD,GaodeMap:()=>FX,GaodeMapV1:()=>IX,GaodeMapV2:()=>LX,GeoLocate:()=>vD,GeometryLayer:()=>qI,GoogleMap:()=>mJ,HeatmapLayer:()=>SL,IDebugLog:()=>Jv,ILayerStage:()=>ny,ImageLayer:()=>AL,InteractionEvent:()=>Xv,LRUCache:()=>vf,LayerPopup:()=>FH,LayerSwitch:()=>xD,LineLayer:()=>OR,LinearDir:()=>pF,LoadTileDataStatus:()=>Pf,Logo:()=>CD,Map:()=>yJ,MapLibre:()=>oX,MapServiceEvent:()=>cy,MapTheme:()=>OD,Mapbox:()=>AJ,Marker:()=>LE,MarkerLayer:()=>HE,MaskLayer:()=>cV,MaskOperation:()=>ty,MouseLocation:()=>AD,PassType:()=>lv,PointLayer:()=>Fz,PolygonLayer:()=>mB,PopperControl:()=>eD,Popup:()=>MH,PositionType:()=>Bv,RasterLayer:()=>MB,RasterTileType:()=>VC,Satistics:()=>bf,Scale:()=>MD,ScaleTypes:()=>iy,Scene:()=>I4,SceneConifg:()=>Co,SceneEventList:()=>RC,SelectControl:()=>rD,SizeUnitType:()=>hF,Source:()=>PE,SourceTile:()=>ip,StencilType:()=>ey,StyleScaleType:()=>ay,Swipe:()=>EH,TMap:()=>mX,TencentMap:()=>MX,TextureBlend:()=>mF,TextureUsage:()=>Sx,TileDebugLayer:()=>jV,TileLayer:()=>kV,TilesetManager:()=>bp,UpdateTileStrategy:()=>Nf,Viewport:()=>$K,WindLayer:()=>CH,Zoom:()=>OH,aProjectFlat:()=>Sd,amap2Project:()=>wd,amap2UnProject:()=>Td,anchorTranslate:()=>Qo,anchorType:()=>Zo,applyAnchorClass:()=>Xo,bBoxToBounds:()=>Ad,bindAll:()=>Uu,boundsContains:()=>kd,calAngle:()=>Fd,calDistance:()=>Md,calculateCentroid:()=>Rd,calculatePointsCenterAndRadius:()=>zd,createLayerContainer:()=>EC,createSceneContainer:()=>TC,decodePickingColor:()=>Rs,defaultValue:()=>Op,djb2hash:()=>Wd,encodePickingColor:()=>zs,expandUrl:()=>Cp,extent:()=>pd,flow:()=>Ld,formatImage:()=>Jo,fp64LowPart:()=>ud,generateCatRamp:()=>Hs,generateColorRamp:()=>Bs,generateCustomRamp:()=>Ws,generateLinearRamp:()=>Vs,generateQuantizeRamp:()=>Us,getAngle:()=>Id,getArrayBuffer:()=>Uo,getBBoxFromPoints:()=>Bd,getData:()=>Go,getDefaultDomain:()=>Ks,getImage:()=>qo,getJSON:()=>Ho,getProtocolAction:()=>Bo,getReferrer:()=>Ru,getTileIndices:()=>Qf,getTileWarpXY:()=>ep,getURLFromTemplate:()=>wp,getWMTSURLFromTemplate:()=>Tp,gl:()=>X,globalConfigService:()=>DC,guid:()=>Gd,isAndroid:()=>Vu,isColor:()=>Is,isImageBitmap:()=>Fu,isNumber:()=>ld,isPC:()=>Lu,isURLTemplate:()=>Sp,isWorker:()=>Iu,isiOS:()=>Bu,latitude:()=>bd,lineAtOffset:()=>cf,lineAtOffsetAsyc:()=>lf,lineStyleType:()=>fF,lngLatInExtent:()=>fd,lngLatToMeters:()=>_d,lnglatDistance:()=>Ed,lodashUtil:()=>tu,longitude:()=>yd,makeXMLHttpRequestPromise:()=>Eo,metersToLngLat:()=>vd,normalize:()=>jd,osmLonLat2TileXY:()=>Xf,osmTileXY2LonLat:()=>Zf,packCircleVertex:()=>Ov,padBounds:()=>Od,postData:()=>Wo,project:()=>Dd,removeDuplicateUniforms:()=>xv,rgb2arr:()=>Ls,sameOrigin:()=>Oo,tileToBounds:()=>$f,tranfrormCoord:()=>hd,unProjectFlat:()=>Cd,validateLngLat:()=>xd,version:()=>R4}),V4=o((()=>{FE(),RH(),UC(),TH(),RX(),L4(),kp(),z4()})),H4=s(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?r(e):typeof define==`function`&&define.amd?define([`exports`],r):(n=typeof globalThis<`u`?globalThis:n||self,r(n.leaflet={}))})(e,(function(e){var t=`1.9.4`;function n(e){var t,n,r,i;for(n=1,r=arguments.length;n<r;n++)for(t in i=arguments[n],i)e[t]=i[t];return e}var r=Object.create||(function(){function e(){}return function(t){return e.prototype=t,new e}})();function i(e,t){var n=Array.prototype.slice;if(e.bind)return e.bind.apply(e,n.call(arguments,1));var r=n.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(n.call(arguments)):arguments)}}var a=0;function o(e){return`_leaflet_id`in e||(e._leaflet_id=++a),e._leaflet_id}function s(e,t,n){var r,i,a,o=function(){r=!1,i&&=(a.apply(n,i),!1)};return a=function(){r?i=arguments:(e.apply(n,arguments),setTimeout(o,t),r=!0)},a}function c(e,t,n){var r=t[1],i=t[0],a=r-i;return e===r&&n?e:((e-i)%a+a)%a+i}function l(){return!1}function u(e,t){if(t===!1)return e;var n=10**(t===void 0?6:t);return Math.round(e*n)/n}function d(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,``)}function f(e){return d(e).split(/\s+/)}function p(e,t){for(var n in Object.prototype.hasOwnProperty.call(e,`options`)||(e.options=e.options?r(e.options):{}),t)e.options[n]=t[n];return e.options}function m(e,t,n){var r=[];for(var i in e)r.push(encodeURIComponent(n?i.toUpperCase():i)+`=`+encodeURIComponent(e[i]));return(!t||t.indexOf(`?`)===-1?`?`:`&`)+r.join(`&`)}var h=/\{ *([\w_ -]+) *\}/g;function g(e,t){return e.replace(h,function(e,n){var r=t[n];if(r===void 0)throw Error(`No value provided for variable `+e);return typeof r==`function`&&(r=r(t)),r})}var _=Array.isArray||function(e){return Object.prototype.toString.call(e)===`[object Array]`};function v(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}var y=`data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=`;function b(e){return window[`webkit`+e]||window[`moz`+e]||window[`ms`+e]}var x=0;function S(e){var t=+new Date,n=Math.max(0,16-(t-x));return x=t+n,window.setTimeout(e,n)}var C=window.requestAnimationFrame||b(`RequestAnimationFrame`)||S,w=window.cancelAnimationFrame||b(`CancelAnimationFrame`)||b(`CancelRequestAnimationFrame`)||function(e){window.clearTimeout(e)};function E(e,t,n){if(n&&C===S)e.call(t);else return C.call(window,i(e,t))}function D(e){e&&w.call(window,e)}var O={__proto__:null,extend:n,create:r,bind:i,get lastId(){return a},stamp:o,throttle:s,wrapNum:c,falseFn:l,formatNum:u,trim:d,splitWords:f,setOptions:p,getParamString:m,template:g,isArray:_,indexOf:v,emptyImageUrl:y,requestFn:C,cancelFn:w,requestAnimFrame:E,cancelAnimFrame:D};function k(){}k.extend=function(e){var t=function(){p(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=t.__super__=this.prototype,a=r(i);for(var o in a.constructor=t,t.prototype=a,this)Object.prototype.hasOwnProperty.call(this,o)&&o!==`prototype`&&o!==`__super__`&&(t[o]=this[o]);return e.statics&&n(t,e.statics),e.includes&&(A(e.includes),n.apply(null,[a].concat(e.includes))),n(a,e),delete a.statics,delete a.includes,a.options&&(a.options=i.options?r(i.options):{},n(a.options,e.options)),a._initHooks=[],a.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=a._initHooks.length;e<t;e++)a._initHooks[e].call(this)}},t},k.include=function(e){var t=this.prototype.options;return n(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},k.mergeOptions=function(e){return n(this.prototype.options,e),this},k.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n=typeof e==`function`?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};function A(e){if(!(typeof L>`u`||!L||!L.Mixin)){e=_(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn(`Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.`,Error().stack)}}var j={on:function(e,t,n){if(typeof e==`object`)for(var r in e)this._on(r,e[r],t);else{e=f(e);for(var i=0,a=e.length;i<a;i++)this._on(e[i],t,n)}return this},off:function(e,t,n){if(!arguments.length)delete this._events;else if(typeof e==`object`)for(var r in e)this._off(r,e[r],t);else{e=f(e);for(var i=arguments.length===1,a=0,o=e.length;a<o;a++)i?this._off(e[a]):this._off(e[a],t,n)}return this},_on:function(e,t,n,r){if(typeof t!=`function`){console.warn(`wrong listener type: `+typeof t);return}if(this._listens(e,t,n)===!1){n===this&&(n=void 0);var i={fn:t,ctx:n};r&&(i.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(i)}},_off:function(e,t,n){var r,i,a;if(this._events&&(r=this._events[e],r)){if(arguments.length===1){if(this._firingCount)for(i=0,a=r.length;i<a;i++)r[i].fn=l;delete this._events[e];return}if(typeof t!=`function`){console.warn(`wrong listener type: `+typeof t);return}var o=this._listens(e,t,n);if(o!==!1){var s=r[o];this._firingCount&&(s.fn=l,this._events[e]=r=r.slice()),r.splice(o,1)}}},fire:function(e,t,r){if(!this.listens(e,r))return this;var i=n({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var a=this._events[e];if(a){this._firingCount=this._firingCount+1||1;for(var o=0,s=a.length;o<s;o++){var c=a[o],l=c.fn;c.once&&this.off(e,l,c.ctx),l.call(c.ctx||this,i)}this._firingCount--}}return r&&this._propagateEvent(i),this},listens:function(e,t,n,r){typeof e!=`string`&&console.warn(`"string" type argument expected`);var i=t;typeof t!=`function`&&(r=!!t,i=void 0,n=void 0);var a=this._events&&this._events[e];if(a&&a.length&&this._listens(e,i,n)!==!1)return!0;if(r){for(var o in this._eventParents)if(this._eventParents[o].listens(e,t,n,r))return!0}return!1},_listens:function(e,t,n){if(!this._events)return!1;var r=this._events[e]||[];if(!t)return!!r.length;n===this&&(n=void 0);for(var i=0,a=r.length;i<a;i++)if(r[i].fn===t&&r[i].ctx===n)return i;return!1},once:function(e,t,n){if(typeof e==`object`)for(var r in e)this._on(r,e[r],t,!0);else{e=f(e);for(var i=0,a=e.length;i<a;i++)this._on(e[i],t,n,!0)}return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[o(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[o(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,n({layer:e.target,propagatedFrom:e.target},e),!0)}};j.addEventListener=j.on,j.removeEventListener=j.clearAllEventListeners=j.off,j.addOneTimeEventListener=j.once,j.fireEvent=j.fire,j.hasEventListeners=j.listens;var M=k.extend(j);function N(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}var P=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};N.prototype={clone:function(){return new N(this.x,this.y)},add:function(e){return this.clone()._add(F(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(F(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new N(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new N(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=P(this.x),this.y=P(this.y),this},distanceTo:function(e){e=F(e);var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){return e=F(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=F(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return`Point(`+u(this.x)+`, `+u(this.y)+`)`}};function F(e,t,n){return e instanceof N?e:_(e)?new N(e[0],e[1]):e==null?e:typeof e==`object`&&`x`in e&&`y`in e?new N(e.x,e.y):new N(e,t,n)}function I(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;r<i;r++)this.extend(n[r])}I.prototype={extend:function(e){var t,n;if(!e)return this;if(e instanceof N||typeof e[0]==`number`||`x`in e)t=n=F(e);else if(e=ee(e),t=e.min,n=e.max,!t||!n)return this;return!this.min&&!this.max?(this.min=t.clone(),this.max=n.clone()):(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)),this},getCenter:function(e){return F((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return F(this.min.x,this.max.y)},getTopRight:function(){return F(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;return e=typeof e[0]==`number`||e instanceof N?F(e):ee(e),e instanceof I?(t=e.min,n=e.max):t=n=e,t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=ee(e);var t=this.min,n=this.max,r=e.min,i=e.max,a=i.x>=t.x&&r.x<=n.x,o=i.y>=t.y&&r.y<=n.y;return a&&o},overlaps:function(e){e=ee(e);var t=this.min,n=this.max,r=e.min,i=e.max,a=i.x>t.x&&r.x<n.x,o=i.y>t.y&&r.y<n.y;return a&&o},isValid:function(){return!!(this.min&&this.max)},pad:function(e){var t=this.min,n=this.max,r=Math.abs(t.x-n.x)*e,i=Math.abs(t.y-n.y)*e;return ee(F(t.x-r,t.y-i),F(n.x+r,n.y+i))},equals:function(e){return e?(e=ee(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight())):!1}};function ee(e,t){return!e||e instanceof I?e:new I(e,t)}function R(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;r<i;r++)this.extend(n[r])}R.prototype={extend:function(e){var t=this._southWest,n=this._northEast,r,i;if(e instanceof B)r=e,i=e;else if(e instanceof R){if(r=e._southWest,i=e._northEast,!r||!i)return this}else return e?this.extend(te(e)||z(e)):this;return!t&&!n?(this._southWest=new B(r.lat,r.lng),this._northEast=new B(i.lat,i.lng)):(t.lat=Math.min(r.lat,t.lat),t.lng=Math.min(r.lng,t.lng),n.lat=Math.max(i.lat,n.lat),n.lng=Math.max(i.lng,n.lng)),this},pad:function(e){var t=this._southWest,n=this._northEast,r=Math.abs(t.lat-n.lat)*e,i=Math.abs(t.lng-n.lng)*e;return new R(new B(t.lat-r,t.lng-i),new B(n.lat+r,n.lng+i))},getCenter:function(){return new B((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new B(this.getNorth(),this.getWest())},getSouthEast:function(){return new B(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e=typeof e[0]==`number`||e instanceof B||`lat`in e?te(e):z(e);var t=this._southWest,n=this._northEast,r,i;return e instanceof R?(r=e.getSouthWest(),i=e.getNorthEast()):r=i=e,r.lat>=t.lat&&i.lat<=n.lat&&r.lng>=t.lng&&i.lng<=n.lng},intersects:function(e){e=z(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),i=e.getNorthEast(),a=i.lat>=t.lat&&r.lat<=n.lat,o=i.lng>=t.lng&&r.lng<=n.lng;return a&&o},overlaps:function(e){e=z(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),i=e.getNorthEast(),a=i.lat>t.lat&&r.lat<n.lat,o=i.lng>t.lng&&r.lng<n.lng;return a&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(`,`)},equals:function(e,t){return e?(e=z(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function z(e,t){return e instanceof R?e:new R(e,t)}function B(e,t,n){if(isNaN(e)||isNaN(t))throw Error(`Invalid LatLng object: (`+e+`, `+t+`)`);this.lat=+e,this.lng=+t,n!==void 0&&(this.alt=+n)}B.prototype={equals:function(e,t){return e?(e=te(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(t===void 0?1e-9:t)):!1},toString:function(e){return`LatLng(`+u(this.lat,e)+`, `+u(this.lng,e)+`)`},distanceTo:function(e){return re.distance(this,te(e))},wrap:function(){return re.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return z([this.lat-t,this.lng-n],[this.lat+t,this.lng+n])},clone:function(){return new B(this.lat,this.lng,this.alt)}};function te(e,t,n){return e instanceof B?e:_(e)&&typeof e[0]!=`object`?e.length===3?new B(e[0],e[1],e[2]):e.length===2?new B(e[0],e[1]):null:e==null?e:typeof e==`object`&&`lat`in e?new B(e.lat,`lng`in e?e.lng:e.lon,e.alt):t===void 0?null:new B(e,t,n)}var ne={latLngToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation._transform(n,r)},pointToLatLng:function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*2**e},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e);return new I(this.transformation.transform(t.min,n),this.transformation.transform(t.max,n))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?c(e.lng,this.wrapLng,!0):e.lng,n=this.wrapLat?c(e.lat,this.wrapLat,!0):e.lat,r=e.alt;return new B(n,t,r)},wrapLatLngBounds:function(e){var t=e.getCenter(),n=this.wrapLatLng(t),r=t.lat-n.lat,i=t.lng-n.lng;if(r===0&&i===0)return e;var a=e.getSouthWest(),o=e.getNorthEast();return new R(new B(a.lat-r,a.lng-i),new B(o.lat-r,o.lng-i))}},re=n({},ne,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var n=Math.PI/180,r=e.lat*n,i=t.lat*n,a=Math.sin((t.lat-e.lat)*n/2),o=Math.sin((t.lng-e.lng)*n/2),s=a*a+Math.cos(r)*Math.cos(i)*o*o,c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*c}}),V=6378137,ie={R:V,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),i=Math.sin(r*t);return new N(this.R*e.lng*t,this.R*Math.log((1+i)/(1-i))/2)},unproject:function(e){var t=180/Math.PI;return new B((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:(function(){var e=V*Math.PI;return new I([-e,-e],[e,e])})()};function ae(e,t,n,r){if(_(e)){this._a=e[0],this._b=e[1],this._c=e[2],this._d=e[3];return}this._a=e,this._b=t,this._c=n,this._d=r}ae.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t||=1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t||=1,new N((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};function oe(e,t,n,r){return new ae(e,t,n,r)}var se=n({},re,{code:`EPSG:3857`,projection:ie,transformation:function(){var e=.5/(Math.PI*ie.R);return oe(e,.5,-e,.5)}()}),ce=n({},se,{code:`EPSG:900913`});function H(e){return document.createElementNS(`http://www.w3.org/2000/svg`,e)}function le(e,t){var n=``,r,i,a,o,s,c;for(r=0,a=e.length;r<a;r++){for(s=e[r],i=0,o=s.length;i<o;i++)c=s[i],n+=(i?`L`:`M`)+c.x+` `+c.y;n+=t?Ue.svg?`z`:`x`:``}return n||`M0 0`}var ue=document.documentElement.style,de=`ActiveXObject`in window,U=de&&!document.addEventListener,fe=`msLaunchUri`in navigator&&!(`documentMode`in document),pe=He(`webkit`),me=He(`android`),W=He(`android 2`)||He(`android 3`),he=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ge=me&&He(`Google`)&&he<537&&!(`AudioNode`in window),_e=!!window.opera,G=!fe&&He(`chrome`),K=He(`gecko`)&&!pe&&!_e&&!de,ve=!G&&He(`safari`),ye=He(`phantom`),be=`OTransition`in ue,xe=navigator.platform.indexOf(`Win`)===0,Se=de&&`transition`in ue,Ce=`WebKitCSSMatrix`in window&&`m11`in new window.WebKitCSSMatrix&&!W,we=`MozPerspective`in ue,Te=!window.L_DISABLE_3D&&(Se||Ce||we)&&!be&&!ye,Ee=typeof orientation<`u`||He(`mobile`),De=Ee&&pe,Oe=Ee&&Ce,ke=!window.PointerEvent&&window.MSPointerEvent,Ae=!!(window.PointerEvent||ke),je=`ontouchstart`in window||!!window.TouchEvent,Me=!window.L_NO_TOUCH&&(je||Ae),Ne=Ee&&_e,Pe=Ee&&K,Fe=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ie=function(){var e=!1;try{var t=Object.defineProperty({},`passive`,{get:function(){e=!0}});window.addEventListener(`testPassiveEventSupport`,l,t),window.removeEventListener(`testPassiveEventSupport`,l,t)}catch{}return e}(),Le=function(){return!!document.createElement(`canvas`).getContext}(),q=!!(document.createElementNS&&H(`svg`).createSVGRect),Re=!!q&&(function(){var e=document.createElement(`div`);return e.innerHTML=`<svg/>`,(e.firstChild&&e.firstChild.namespaceURI)===`http://www.w3.org/2000/svg`})(),ze=!q&&function(){try{var e=document.createElement(`div`);e.innerHTML=`<v:shape adj="1"/>`;var t=e.firstChild;return t.style.behavior=`url(#default#VML)`,t&&typeof t.adj==`object`}catch{return!1}}(),Be=navigator.platform.indexOf(`Mac`)===0,Ve=navigator.platform.indexOf(`Linux`)===0;function He(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var Ue={ie:de,ielt9:U,edge:fe,webkit:pe,android:me,android23:W,androidStock:ge,opera:_e,chrome:G,gecko:K,safari:ve,phantom:ye,opera12:be,win:xe,ie3d:Se,webkit3d:Ce,gecko3d:we,any3d:Te,mobile:Ee,mobileWebkit:De,mobileWebkit3d:Oe,msPointer:ke,pointer:Ae,touch:Me,touchNative:je,mobileOpera:Ne,mobileGecko:Pe,retina:Fe,passiveEvents:Ie,canvas:Le,svg:q,vml:ze,inlineSvg:Re,mac:Be,linux:Ve},We=Ue.msPointer?`MSPointerDown`:`pointerdown`,Ge=Ue.msPointer?`MSPointerMove`:`pointermove`,Ke=Ue.msPointer?`MSPointerUp`:`pointerup`,qe=Ue.msPointer?`MSPointerCancel`:`pointercancel`,Je={touchstart:We,touchmove:Ge,touchend:Ke,touchcancel:qe},Ye={touchstart:at,touchmove:it,touchend:it,touchcancel:it},Xe={},Ze=!1;function Qe(e,t,n){return t===`touchstart`&&rt(),Ye[t]?(n=Ye[t].bind(this,n),e.addEventListener(Je[t],n,!1),n):(console.warn(`wrong event specified:`,t),l)}function $e(e,t,n){if(!Je[t]){console.warn(`wrong event specified:`,t);return}e.removeEventListener(Je[t],n,!1)}function et(e){Xe[e.pointerId]=e}function tt(e){Xe[e.pointerId]&&(Xe[e.pointerId]=e)}function nt(e){delete Xe[e.pointerId]}function rt(){Ze||=(document.addEventListener(We,et,!0),document.addEventListener(Ge,tt,!0),document.addEventListener(Ke,nt,!0),document.addEventListener(qe,nt,!0),!0)}function it(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||`mouse`)){for(var n in t.touches=[],Xe)t.touches.push(Xe[n]);t.changedTouches=[t],e(t)}}function at(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&en(t),it(e,t)}function ot(e){var t={},n,r;for(r in e)n=e[r],t[r]=n&&n.bind?n.bind(e):n;return e=t,t.type=`dblclick`,t.detail=2,t.isTrusted=!1,t._simulated=!0,t}var st=200;function ct(e,t){e.addEventListener(`dblclick`,t);var n=0,r;function i(e){if(e.detail!==1){r=e.detail;return}if(!(e.pointerType===`mouse`||e.sourceCapabilities&&!e.sourceCapabilities.firesTouchEvents)){var i=nn(e);if(!(i.some(function(e){return e instanceof HTMLLabelElement&&e.attributes.for})&&!i.some(function(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement}))){var a=Date.now();a-n<=st?(r++,r===2&&t(ot(e))):r=1,n=a}}}return e.addEventListener(`click`,i),{dblclick:t,simDblclick:i}}function lt(e,t){e.removeEventListener(`dblclick`,t.dblclick),e.removeEventListener(`click`,t.simDblclick)}var ut=Dt([`transform`,`webkitTransform`,`OTransform`,`MozTransform`,`msTransform`]),dt=Dt([`webkitTransition`,`transition`,`OTransition`,`MozTransition`,`msTransition`]),ft=dt===`webkitTransition`||dt===`OTransition`?dt+`End`:`transitionend`;function pt(e){return typeof e==`string`?document.getElementById(e):e}function mt(e,t){var n=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!n||n===`auto`)&&document.defaultView){var r=document.defaultView.getComputedStyle(e,null);n=r?r[t]:null}return n===`auto`?null:n}function ht(e,t,n){var r=document.createElement(e);return r.className=t||``,n&&n.appendChild(r),r}function gt(e){var t=e.parentNode;t&&t.removeChild(e)}function _t(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function vt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function yt(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function bt(e,t){if(e.classList!==void 0)return e.classList.contains(t);var n=wt(e);return n.length>0&&RegExp(`(^|\\s)`+t+`(\\s|$)`).test(n)}function xt(e,t){if(e.classList!==void 0)for(var n=f(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!bt(e,t)){var a=wt(e);Ct(e,(a?a+` `:``)+t)}}function St(e,t){e.classList===void 0?Ct(e,d((` `+wt(e)+` `).replace(` `+t+` `,` `))):e.classList.remove(t)}function Ct(e,t){e.className.baseVal===void 0?e.className=t:e.className.baseVal=t}function wt(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Tt(e,t){`opacity`in e.style?e.style.opacity=t:`filter`in e.style&&Et(e,t)}function Et(e,t){var n=!1,r=`DXImageTransform.Microsoft.Alpha`;try{n=e.filters.item(r)}catch{if(t===1)return}t=Math.round(t*100),n?(n.Enabled=t!==100,n.Opacity=t):e.style.filter+=` progid:`+r+`(opacity=`+t+`)`}function Dt(e){for(var t=document.documentElement.style,n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}function Ot(e,t,n){var r=t||new N(0,0);e.style[ut]=(Ue.ie3d?`translate(`+r.x+`px,`+r.y+`px)`:`translate3d(`+r.x+`px,`+r.y+`px,0)`)+(n?` scale(`+n+`)`:``)}function kt(e,t){e._leaflet_pos=t,Ue.any3d?Ot(e,t):(e.style.left=t.x+`px`,e.style.top=t.y+`px`)}function At(e){return e._leaflet_pos||new N(0,0)}var jt,Mt,Nt;if(`onselectstart`in document)jt=function(){Wt(window,`selectstart`,en)},Mt=function(){Kt(window,`selectstart`,en)};else{var Pt=Dt([`userSelect`,`WebkitUserSelect`,`OUserSelect`,`MozUserSelect`,`msUserSelect`]);jt=function(){if(Pt){var e=document.documentElement.style;Nt=e[Pt],e[Pt]=`none`}},Mt=function(){Pt&&(document.documentElement.style[Pt]=Nt,Nt=void 0)}}function Ft(){Wt(window,`dragstart`,en)}function It(){Kt(window,`dragstart`,en)}var Lt,Rt;function zt(e){for(;e.tabIndex===-1;)e=e.parentNode;e.style&&(Bt(),Lt=e,Rt=e.style.outlineStyle,e.style.outlineStyle=`none`,Wt(window,`keydown`,Bt))}function Bt(){Lt&&(Lt.style.outlineStyle=Rt,Lt=void 0,Rt=void 0,Kt(window,`keydown`,Bt))}function Vt(e){do e=e.parentNode;while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function Ht(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var Ut={__proto__:null,TRANSFORM:ut,TRANSITION:dt,TRANSITION_END:ft,get:pt,getStyle:mt,create:ht,remove:gt,empty:_t,toFront:vt,toBack:yt,hasClass:bt,addClass:xt,removeClass:St,setClass:Ct,getClass:wt,setOpacity:Tt,testProp:Dt,setTransform:Ot,setPosition:kt,getPosition:At,get disableTextSelection(){return jt},get enableTextSelection(){return Mt},disableImageDrag:Ft,enableImageDrag:It,preventOutline:zt,restoreOutline:Bt,getSizedParentNode:Vt,getScale:Ht};function Wt(e,t,n,r){if(t&&typeof t==`object`)for(var i in t)Yt(e,i,t[i],n);else{t=f(t);for(var a=0,o=t.length;a<o;a++)Yt(e,t[a],n,r)}return this}var Gt=`_leaflet_events`;function Kt(e,t,n,r){if(arguments.length===1)qt(e),delete e[Gt];else if(t&&typeof t==`object`)for(var i in t)Xt(e,i,t[i],n);else if(t=f(t),arguments.length===2)qt(e,function(e){return v(t,e)!==-1});else for(var a=0,o=t.length;a<o;a++)Xt(e,t[a],n,r);return this}function qt(e,t){for(var n in e[Gt]){var r=n.split(/\d/)[0];(!t||t(r))&&Xt(e,r,null,null,n)}}var Jt={mouseenter:`mouseover`,mouseleave:`mouseout`,wheel:!(`onwheel`in window)&&`mousewheel`};function Yt(e,t,n,r){var i=t+o(n)+(r?`_`+o(r):``);if(e[Gt]&&e[Gt][i])return this;var a=function(t){return n.call(r||e,t||window.event)},s=a;!Ue.touchNative&&Ue.pointer&&t.indexOf(`touch`)===0?a=Qe(e,t,a):Ue.touch&&t===`dblclick`?a=ct(e,a):`addEventListener`in e?t===`touchstart`||t===`touchmove`||t===`wheel`||t===`mousewheel`?e.addEventListener(Jt[t]||t,a,Ue.passiveEvents?{passive:!1}:!1):t===`mouseenter`||t===`mouseleave`?(a=function(t){t||=window.event,sn(e,t)&&s(t)},e.addEventListener(Jt[t],a,!1)):e.addEventListener(t,s,!1):e.attachEvent(`on`+t,a),e[Gt]=e[Gt]||{},e[Gt][i]=a}function Xt(e,t,n,r,i){i||=t+o(n)+(r?`_`+o(r):``);var a=e[Gt]&&e[Gt][i];if(!a)return this;!Ue.touchNative&&Ue.pointer&&t.indexOf(`touch`)===0?$e(e,t,a):Ue.touch&&t===`dblclick`?lt(e,a):`removeEventListener`in e?e.removeEventListener(Jt[t]||t,a,!1):e.detachEvent(`on`+t,a),e[Gt][i]=null}function Zt(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Qt(e){return Yt(e,`wheel`,Zt),this}function $t(e){return Wt(e,`mousedown touchstart dblclick contextmenu`,Zt),e._leaflet_disable_click=!0,this}function en(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function tn(e){return en(e),Zt(e),this}function nn(e){if(e.composedPath)return e.composedPath();for(var t=[],n=e.target;n;)t.push(n),n=n.parentNode;return t}function rn(e,t){if(!t)return new N(e.clientX,e.clientY);var n=Ht(t),r=n.boundingClientRect;return new N((e.clientX-r.left)/n.x-t.clientLeft,(e.clientY-r.top)/n.y-t.clientTop)}var an=Ue.linux&&Ue.chrome?window.devicePixelRatio:Ue.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function on(e){return Ue.edge?e.wheelDeltaY/2:e.deltaY&&e.deltaMode===0?-e.deltaY/an:e.deltaY&&e.deltaMode===1?-e.deltaY*20:e.deltaY&&e.deltaMode===2?-e.deltaY*60:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?-e.detail*20:e.detail?e.detail/-32765*60:0}function sn(e,t){var n=t.relatedTarget;if(!n)return!0;try{for(;n&&n!==e;)n=n.parentNode}catch{return!1}return n!==e}var cn={__proto__:null,on:Wt,off:Kt,stopPropagation:Zt,disableScrollPropagation:Qt,disableClickPropagation:$t,preventDefault:en,stop:tn,getPropagationPath:nn,getMousePosition:rn,getWheelDelta:on,isExternalTarget:sn,addListener:Wt,removeListener:Kt},ln=M.extend({run:function(e,t,n,r){this.stop(),this._el=e,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=At(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire(`start`),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=E(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,n=this._duration*1e3;t<n?this._runFrame(this._easeOut(t/n),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var n=this._startPos.add(this._offset.multiplyBy(e));t&&n._round(),kt(this._el,n),this.fire(`step`)},_complete:function(){D(this._animId),this._inProgress=!1,this.fire(`end`)},_easeOut:function(e){return 1-(1-e)**this._easeOutPower}}),un=M.extend({options:{crs:se,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=p(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=i(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),t.zoom!==void 0&&(this._zoom=this._limitZoom(t.zoom)),t.center&&t.zoom!==void 0&&this.setView(te(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=dt&&Ue.any3d&&!Ue.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Wt(this._proxy,ft,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,r){return t=t===void 0?this._zoom:this._limitZoom(t),e=this._limitCenter(te(e),t,this.options.maxBounds),r||={},this._stop(),this._loaded&&!r.reset&&r!==!0&&(r.animate!==void 0&&(r.zoom=n({animate:r.animate},r.zoom),r.pan=n({animate:r.animate,duration:r.duration},r.pan)),this._zoom===t?this._tryAnimatedPan(e,r.pan):this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,r.zoom))?(clearTimeout(this._sizeTimer),this):(this._resetView(e,t,r.pan&&r.pan.noMoveStart),this)},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e||=Ue.any3d?this.options.zoomDelta:1,this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e||=Ue.any3d?this.options.zoomDelta:1,this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,n){var r=this.getZoomScale(t),i=this.getSize().divideBy(2),a=(e instanceof N?e:this.latLngToContainerPoint(e)).subtract(i).multiplyBy(1-1/r),o=this.containerPointToLatLng(i.add(a));return this.setView(o,t,{zoom:n})},_getBoundsCenterZoom:function(e,t){t||={},e=e.getBounds?e.getBounds():z(e);var n=F(t.paddingTopLeft||t.padding||[0,0]),r=F(t.paddingBottomRight||t.padding||[0,0]),i=this.getBoundsZoom(e,!1,n.add(r));if(i=typeof t.maxZoom==`number`?Math.min(t.maxZoom,i):i,i===1/0)return{center:e.getCenter(),zoom:i};var a=r.subtract(n).divideBy(2),o=this.project(e.getSouthWest(),i),s=this.project(e.getNorthEast(),i);return{center:this.unproject(o.add(s).divideBy(2).add(a),i),zoom:i}},fitBounds:function(e,t){if(e=z(e),!e.isValid())throw Error(`Bounds are not valid.`);var n=this._getBoundsCenterZoom(e,t);return this.setView(n.center,n.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(e=F(e).round(),t||={},!e.x&&!e.y)return this.fire(`moveend`);if(t.animate!==!0&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ln,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire(`movestart`),t.animate!==!1){xt(this._mapPane,`leaflet-pan-anim`);var n=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire(`move`).fire(`moveend`);return this},flyTo:function(e,t,n){if(n||={},n.animate===!1||!Ue.any3d)return this.setView(e,t,n);this._stop();var r=this.project(this.getCenter()),i=this.project(e),a=this.getSize(),o=this._zoom;e=te(e),t=t===void 0?o:t;var s=Math.max(a.x,a.y),c=s*this.getZoomScale(o,t),l=i.distanceTo(r)||1,u=1.42,d=u*u;function f(e){var t=e?-1:1,n=e?c:s,r=(c*c-s*s+t*d*d*l*l)/(2*n*d*l),i=Math.sqrt(r*r+1)-r;return i<1e-9?-18:Math.log(i)}function p(e){return(Math.exp(e)-Math.exp(-e))/2}function m(e){return(Math.exp(e)+Math.exp(-e))/2}function h(e){return p(e)/m(e)}var g=f(0);function _(e){return s*(m(g)/m(g+u*e))}function v(e){return s*(m(g)*h(g+u*e)-p(g))/d}function y(e){return 1-(1-e)**1.5}var b=Date.now(),x=(f(1)-g)/u,S=n.duration?1e3*n.duration:1e3*x*.8;function C(){var n=(Date.now()-b)/S,a=y(n)*x;n<=1?(this._flyToFrame=E(C,this),this._move(this.unproject(r.add(i.subtract(r).multiplyBy(v(a)/l)),o),this.getScaleZoom(s/_(a),o),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),C.call(this),this},flyToBounds:function(e,t){var n=this._getBoundsCenterZoom(e,t);return this.flyTo(n.center,n.zoom,t)},setMaxBounds:function(e){return e=z(e),this.listens(`moveend`,this._panInsideMaxBounds)&&this.off(`moveend`,this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on(`moveend`,this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire(`zoomlevelschange`),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire(`zoomlevelschange`),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var n=this.getCenter(),r=this._limitCenter(n,this._zoom,z(e));return n.equals(r)||this.panTo(r,t),this._enforcingBounds=!1,this},panInside:function(e,t){t||={};var n=F(t.paddingTopLeft||t.padding||[0,0]),r=F(t.paddingBottomRight||t.padding||[0,0]),i=this.project(this.getCenter()),a=this.project(e),o=this.getPixelBounds(),s=ee([o.min.add(n),o.max.subtract(r)]),c=s.getSize();if(!s.contains(a)){this._enforcingBounds=!0;var l=a.subtract(s.getCenter()),u=s.extend(a).getSize().subtract(c);i.x+=l.x<0?-u.x:u.x,i.y+=l.y<0?-u.y:u.y,this.panTo(this.unproject(i),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=n({animate:!1,pan:!0},e===!0?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),a=t.divideBy(2).round(),o=r.divideBy(2).round(),s=a.subtract(o);return!s.x&&!s.y?this:(e.animate&&e.pan?this.panBy(s):(e.pan&&this._rawPanBy(s),this.fire(`move`),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(i(this.fire,this,`moveend`),200)):this.fire(`moveend`)),this.fire(`resize`,{oldSize:t,newSize:r}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire(`viewreset`),this._stop()},locate:function(e){if(e=this._locateOptions=n({timeout:1e4,watch:!1},e),!(`geolocation`in navigator))return this._handleGeolocationError({code:0,message:`Geolocation not supported.`}),this;var t=i(this._handleGeolocationResponse,this),r=i(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,r,e):navigator.geolocation.getCurrentPosition(t,r,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,n=e.message||(t===1?`permission denied`:t===2?`position unavailable`:`timeout`);this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire(`locationerror`,{code:t,message:`Geolocation error: `+n+`.`})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=e.coords.latitude,n=e.coords.longitude,r=new B(t,n),i=r.toBounds(e.coords.accuracy*2),a=this._locateOptions;if(a.setView){var o=this.getBoundsZoom(i);this.setView(r,a.maxZoom?Math.min(o,a.maxZoom):o)}var s={latlng:r,bounds:i,timestamp:e.timestamp};for(var c in e.coords)typeof e.coords[c]==`number`&&(s[c]=e.coords[c]);this.fire(`locationfound`,s)}},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off(`moveend`,this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw Error(`Map container is being reused by another instance`);try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}for(var e in this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),gt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&=(D(this._resizeRequest),null),this._clearHandlers(),this._loaded&&this.fire(`unload`),this._layers)this._layers[e].remove();for(e in this._panes)gt(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var n=ht(`div`,`leaflet-pane`+(e?` leaflet-`+e.replace(`Pane`,``)+`-pane`:``),t||this._mapPane);return e&&(this._panes[e]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds();return new R(this.unproject(e.getBottomLeft()),this.unproject(e.getTopRight()))},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=z(e),n=F(n||[0,0]);var r=this.getZoom()||0,i=this.getMinZoom(),a=this.getMaxZoom(),o=e.getNorthWest(),s=e.getSouthEast(),c=this.getSize().subtract(n),l=ee(this.project(s,r),this.project(o,r)).getSize(),u=Ue.any3d?this.options.zoomSnap:1,d=c.x/l.x,f=c.y/l.y,p=t?Math.max(d,f):Math.min(d,f);return r=this.getScaleZoom(p,r),u&&(r=Math.round(r/(u/100))*(u/100),r=t?Math.ceil(r/u)*u:Math.floor(r/u)*u),Math.max(i,Math.min(a,r))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new N(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var n=this._getTopLeftPoint(e,t);return new I(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(e===void 0?this.getZoom():e)},getPane:function(e){return typeof e==`string`?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var n=this.options.crs;return t=t===void 0?this._zoom:t,n.scale(e)/n.scale(t)},getScaleZoom:function(e,t){var n=this.options.crs;t=t===void 0?this._zoom:t;var r=n.zoom(e*n.scale(t));return isNaN(r)?1/0:r},project:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.latLngToPoint(te(e),t)},unproject:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.pointToLatLng(F(e),t)},layerPointToLatLng:function(e){var t=F(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){return this.project(te(e))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(te(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(z(e))},distance:function(e,t){return this.options.crs.distance(te(e),te(t))},containerPointToLayerPoint:function(e){return F(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return F(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(F(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(te(e)))},mouseEventToContainerPoint:function(e){return rn(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=pt(e);if(!t)throw Error(`Map container not found.`);if(t._leaflet_id)throw Error(`Map container is already initialized.`);Wt(t,`scroll`,this._onScroll,this),this._containerId=o(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ue.any3d,xt(e,`leaflet-container`+(Ue.touch?` leaflet-touch`:``)+(Ue.retina?` leaflet-retina`:``)+(Ue.ielt9?` leaflet-oldie`:``)+(Ue.safari?` leaflet-safari`:``)+(this._fadeAnimated?` leaflet-fade-anim`:``));var t=mt(e,`position`);t!==`absolute`&&t!==`relative`&&t!==`fixed`&&t!==`sticky`&&(e.style.position=`relative`),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane(`mapPane`,this._container),kt(this._mapPane,new N(0,0)),this.createPane(`tilePane`),this.createPane(`overlayPane`),this.createPane(`shadowPane`),this.createPane(`markerPane`),this.createPane(`tooltipPane`),this.createPane(`popupPane`),this.options.markerZoomAnimation||(xt(e.markerPane,`leaflet-zoom-hide`),xt(e.shadowPane,`leaflet-zoom-hide`))},_resetView:function(e,t,n){kt(this._mapPane,new N(0,0));var r=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire(`viewprereset`);var i=this._zoom!==t;this._moveStart(i,n)._move(e,t)._moveEnd(i),this.fire(`viewreset`),r&&this.fire(`load`)},_moveStart:function(e,t){return e&&this.fire(`zoomstart`),t||this.fire(`movestart`),this},_move:function(e,t,n,r){t===void 0&&(t=this._zoom);var i=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),r?n&&n.pinch&&this.fire(`zoom`,n):((i||n&&n.pinch)&&this.fire(`zoom`,n),this.fire(`move`,n)),this},_moveEnd:function(e){return e&&this.fire(`zoomend`),this.fire(`moveend`)},_stop:function(){return D(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){kt(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw Error(`Set map center and zoom first.`)},_initEvents:function(e){this._targets={},this._targets[o(this._container)]=this;var t=e?Kt:Wt;t(this._container,`click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup`,this._handleDOMEvent,this),this.options.trackResize&&t(window,`resize`,this._onResize,this),Ue.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,`moveend`,this._onMoveEnd)},_onResize:function(){D(this._resizeRequest),this._resizeRequest=E(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var n=[],r,i=t===`mouseout`||t===`mouseover`,a=e.target||e.srcElement,s=!1;a;){if(r=this._targets[o(a)],r&&(t===`click`||t===`preclick`)&&this._draggableMoved(r)){s=!0;break}if(r&&r.listens(t,!0)&&(i&&!sn(a,e)||(n.push(r),i))||a===this._container)break;a=a.parentNode}return!n.length&&!s&&!i&&this.listens(t,!0)&&(n=[this]),n},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||e.type===`click`&&this._isClickDisabled(t))){var n=e.type;n===`mousedown`&&zt(t),this._fireDOMEvent(e,n)}},_mouseEvents:[`click`,`dblclick`,`mouseover`,`mouseout`,`contextmenu`],_fireDOMEvent:function(e,t,r){if(e.type===`click`){var i=n({},e);i.type=`preclick`,this._fireDOMEvent(i,i.type,r)}var a=this._findEventTargets(e,t);if(r){for(var o=[],s=0;s<r.length;s++)r[s].listens(t,!0)&&o.push(r[s]);a=o.concat(a)}if(a.length){t===`contextmenu`&&en(e);var c=a[0],l={originalEvent:e};if(e.type!==`keypress`&&e.type!==`keydown`&&e.type!==`keyup`){var u=c.getLatLng&&(!c._radius||c._radius<=10);l.containerPoint=u?this.latLngToContainerPoint(c.getLatLng()):this.mouseEventToContainerPoint(e),l.layerPoint=this.containerPointToLayerPoint(l.containerPoint),l.latlng=u?c.getLatLng():this.layerPointToLatLng(l.layerPoint)}for(s=0;s<a.length;s++)if(a[s].fire(t,l,!0),l.originalEvent._stopped||a[s].options.bubblingMouseEvents===!1&&v(this._mouseEvents,t)!==-1)return}},_draggableMoved:function(e){return e=e.dragging&&e.dragging.enabled()?e:this,e.dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on(`load`,e,t),this},_getMapPanePos:function(){return At(this._mapPane)||new N(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){return(e&&t!==void 0?this._getNewPixelOrigin(e,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,n){var r=this._getNewPixelOrigin(n,t);return this.project(e,t)._subtract(r)},_latLngBoundsToNewLayerBounds:function(e,t,n){var r=this._getNewPixelOrigin(n,t);return ee([this.project(e.getSouthWest(),t)._subtract(r),this.project(e.getNorthWest(),t)._subtract(r),this.project(e.getSouthEast(),t)._subtract(r),this.project(e.getNorthEast(),t)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var r=this.project(e,t),i=this.getSize().divideBy(2),a=new I(r.subtract(i),r.add(i)),o=this._getBoundsOffset(a,n,t);return Math.abs(o.x)<=1&&Math.abs(o.y)<=1?e:this.unproject(r.add(o),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),r=new I(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(r,t))},_getBoundsOffset:function(e,t,n){var r=ee(this.project(t.getNorthEast(),n),this.project(t.getSouthWest(),n)),i=r.min.subtract(e.min),a=r.max.subtract(e.max);return new N(this._rebound(i.x,-a.x),this._rebound(i.y,-a.y))},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom(),r=Ue.any3d?this.options.zoomSnap:1;return r&&(e=Math.round(e/r)*r),Math.max(t,Math.min(n,e))},_onPanTransitionStep:function(){this.fire(`move`)},_onPanTransitionEnd:function(){St(this._mapPane,`leaflet-pan-anim`),this.fire(`moveend`)},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._trunc();return(t&&t.animate)!==!0&&!this.getSize().contains(n)?!1:(this.panBy(n,t),!0)},_createAnimProxy:function(){var e=this._proxy=ht(`div`,`leaflet-proxy leaflet-zoom-animated`);this._panes.mapPane.appendChild(e),this.on(`zoomanim`,function(e){var t=ut,n=this._proxy.style[t];Ot(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on(`load moveend`,this._animMoveEnd,this),this._on(`unload`,this._destroyAnimProxy,this)},_destroyAnimProxy:function(){gt(this._proxy),this.off(`load moveend`,this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();Ot(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf(`transform`)>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName(`leaflet-zoom-animated`).length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;if(n||={},!this._zoomAnimated||n.animate===!1||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(t),i=this._getCenterOffset(e)._divideBy(1-1/r);return n.animate!==!0&&!this.getSize().contains(i)?!1:(E(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,n,r){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,xt(this._mapPane,`leaflet-zoom-anim`)),this.fire(`zoomanim`,{center:e,zoom:t,noUpdate:r}),this._tempFireZoomEvent||=this._zoom!==this._animateToZoom,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(i(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&St(this._mapPane,`leaflet-zoom-anim`),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire(`zoom`),delete this._tempFireZoomEvent,this.fire(`move`),this._moveEnd(!0))}});function dn(e,t){return new un(e,t)}var fn=k.extend({options:{position:`topright`},initialize:function(e){p(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),r=e._controlCorners[n];return xt(t,`leaflet-control`),n.indexOf(`bottom`)===-1?r.appendChild(t):r.insertBefore(t,r.firstChild),this._map.on(`unload`,this.remove,this),this},remove:function(){return this._map?(gt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off(`unload`,this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),pn=function(e){return new fn(e)};un.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t=`leaflet-`,n=this._controlContainer=ht(`div`,t+`control-container`,this._container);function r(r,i){var a=t+r+` `+t+i;e[r+i]=ht(`div`,a,n)}r(`top`,`left`),r(`top`,`right`),r(`bottom`,`left`),r(`bottom`,`right`)},_clearControlPos:function(){for(var e in this._controlCorners)gt(this._controlCorners[e]);gt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var mn=fn.extend({options:{collapsed:!0,position:`topright`,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,n,r){return n<r?-1:r<n?1:0}},initialize:function(e,t,n){for(var r in p(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,e)this._addLayer(e[r],r);for(r in t)this._addLayer(t[r],r,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on(`zoomend`,this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on(`add remove`,this._onLayerChange,this);return this._container},addTo:function(e){return fn.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off(`zoomend`,this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off(`add remove`,this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off(`add remove`,this._onLayerChange,this);var t=this._getLayer(o(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){xt(this._container,`leaflet-control-layers-expanded`),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(xt(this._section,`leaflet-control-layers-scrollbar`),this._section.style.height=e+`px`):St(this._section,`leaflet-control-layers-scrollbar`),this._checkDisabledLayers(),this},collapse:function(){return St(this._container,`leaflet-control-layers-expanded`),this},_initLayout:function(){var e=`leaflet-control-layers`,t=this._container=ht(`div`,e),n=this.options.collapsed;t.setAttribute(`aria-haspopup`,!0),$t(t),Qt(t);var r=this._section=ht(`section`,e+`-list`);n&&(this._map.on(`click`,this.collapse,this),Wt(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var i=this._layersLink=ht(`a`,e+`-toggle`,t);i.href=`#`,i.title=`Layers`,i.setAttribute(`role`,`button`),Wt(i,{keydown:function(e){e.keyCode===13&&this._expandSafely()},click:function(e){en(e),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=ht(`div`,e+`-base`,r),this._separator=ht(`div`,e+`-separator`,r),this._overlaysList=ht(`div`,e+`-overlays`,r),t.appendChild(r)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&o(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,n){this._map&&e.on(`add remove`,this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:n}),this.options.sortLayers&&this._layers.sort(i(function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;_t(this._baseLayersList),_t(this._overlaysList),this._layerControlInputs=[];var e,t,n,r,i=0;for(n=0;n<this._layers.length;n++)r=this._layers[n],this._addItem(r),t||=r.overlay,e||=!r.overlay,i+=r.overlay?0:1;return this.options.hideSingleBase&&(e&&=i>1,this._baseLayersList.style.display=e?``:`none`),this._separator.style.display=t&&e?``:`none`,this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(o(e.target)),n=t.overlay?e.type===`add`?`overlayadd`:`overlayremove`:e.type===`add`?`baselayerchange`:null;n&&this._map.fire(n,t)},_createRadioElement:function(e,t){var n=`<input type="radio" class="leaflet-control-layers-selector" name="`+e+`"`+(t?` checked="checked"`:``)+`/>`,r=document.createElement(`div`);return r.innerHTML=n,r.firstChild},_addItem:function(e){var t=document.createElement(`label`),n=this._map.hasLayer(e.layer),r;e.overlay?(r=document.createElement(`input`),r.type=`checkbox`,r.className=`leaflet-control-layers-selector`,r.defaultChecked=n):r=this._createRadioElement(`leaflet-base-layers_`+o(this),n),this._layerControlInputs.push(r),r.layerId=o(e.layer),Wt(r,`click`,this._onInputClick,this);var i=document.createElement(`span`);i.innerHTML=` `+e.name;var a=document.createElement(`span`);return t.appendChild(a),a.appendChild(r),a.appendChild(i),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(t),this._checkDisabledLayers(),t},_onInputClick:function(){if(!this._preventClick){var e=this._layerControlInputs,t,n,r=[],i=[];this._handlingClick=!0;for(var a=e.length-1;a>=0;a--)t=e[a],n=this._getLayer(t.layerId).layer,t.checked?r.push(n):t.checked||i.push(n);for(a=0;a<i.length;a++)this._map.hasLayer(i[a])&&this._map.removeLayer(i[a]);for(a=0;a<r.length;a++)this._map.hasLayer(r[a])||this._map.addLayer(r[a]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e=this._layerControlInputs,t,n,r=this._map.getZoom(),i=e.length-1;i>=0;i--)t=e[i],n=this._getLayer(t.layerId).layer,t.disabled=n.options.minZoom!==void 0&&r<n.options.minZoom||n.options.maxZoom!==void 0&&r>n.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,Wt(e,`click`,en),this.expand();var t=this;setTimeout(function(){Kt(e,`click`,en),t._preventClick=!1})}}),hn=function(e,t,n){return new mn(e,t,n)},gn=fn.extend({options:{position:`topleft`,zoomInText:`<span aria-hidden="true">+</span>`,zoomInTitle:`Zoom in`,zoomOutText:`<span aria-hidden="true">&#x2212;</span>`,zoomOutTitle:`Zoom out`},onAdd:function(e){var t=`leaflet-control-zoom`,n=ht(`div`,t+` leaflet-bar`),r=this.options;return this._zoomInButton=this._createButton(r.zoomInText,r.zoomInTitle,t+`-in`,n,this._zoomIn),this._zoomOutButton=this._createButton(r.zoomOutText,r.zoomOutTitle,t+`-out`,n,this._zoomOut),this._updateDisabled(),e.on(`zoomend zoomlevelschange`,this._updateDisabled,this),n},onRemove:function(e){e.off(`zoomend zoomlevelschange`,this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,n,r,i){var a=ht(`a`,n,r);return a.innerHTML=e,a.href=`#`,a.title=t,a.setAttribute(`role`,`button`),a.setAttribute(`aria-label`,t),$t(a),Wt(a,`click`,tn),Wt(a,`click`,i,this),Wt(a,`click`,this._refocusOnMap,this),a},_updateDisabled:function(){var e=this._map,t=`leaflet-disabled`;St(this._zoomInButton,t),St(this._zoomOutButton,t),this._zoomInButton.setAttribute(`aria-disabled`,`false`),this._zoomOutButton.setAttribute(`aria-disabled`,`false`),(this._disabled||e._zoom===e.getMinZoom())&&(xt(this._zoomOutButton,t),this._zoomOutButton.setAttribute(`aria-disabled`,`true`)),(this._disabled||e._zoom===e.getMaxZoom())&&(xt(this._zoomInButton,t),this._zoomInButton.setAttribute(`aria-disabled`,`true`))}});un.mergeOptions({zoomControl:!0}),un.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new gn,this.addControl(this.zoomControl))});var _n=function(e){return new gn(e)},vn=fn.extend({options:{position:`bottomleft`,maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t=`leaflet-control-scale`,n=ht(`div`,t),r=this.options;return this._addScales(r,t+`-line`,n),e.on(r.updateWhenIdle?`moveend`:`move`,this._update,this),e.whenReady(this._update,this),n},onRemove:function(e){e.off(this.options.updateWhenIdle?`moveend`:`move`,this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=ht(`div`,t,n)),e.imperial&&(this._iScale=ht(`div`,t,n))},_update:function(){var e=this._map,t=e.getSize().y/2,n=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(n)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),n=t<1e3?t+` m`:t/1e3+` km`;this._updateScale(this._mScale,n,t/e)},_updateImperial:function(e){var t=e*3.2808399,n,r,i;t>5280?(n=t/5280,r=this._getRoundNum(n),this._updateScale(this._iScale,r+` mi`,r/n)):(i=this._getRoundNum(t),this._updateScale(this._iScale,i+` ft`,i/t))},_updateScale:function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)+`px`,e.innerHTML=t},_getRoundNum:function(e){var t=10**((Math.floor(e)+``).length-1),n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,t*n}}),yn=function(e){return new vn(e)},bn=fn.extend({options:{position:`bottomright`,prefix:`<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">`+(Ue.inlineSvg?`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> `:``)+`Leaflet</a>`},initialize:function(e){p(this,e),this._attributions={}},onAdd:function(e){for(var t in e.attributionControl=this,this._container=ht(`div`,`leaflet-control-attribution`),$t(this._container),e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on(`layeradd`,this._addAttribution,this),this._container},onRemove:function(e){e.off(`layeradd`,this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once(`remove`,function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e&&this._attributions[e]&&(this._attributions[e]--,this._update()),this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(`, `)),this._container.innerHTML=n.join(` <span aria-hidden="true">|</span> `)}}});un.mergeOptions({attributionControl:!0}),un.addInitHook(function(){this.options.attributionControl&&new bn().addTo(this)}),fn.Layers=mn,fn.Zoom=gn,fn.Scale=vn,fn.Attribution=bn,pn.layers=hn,pn.zoom=_n,pn.scale=yn,pn.attribution=function(e){return new bn(e)};var xn=k.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});xn.addTo=function(e,t){return e.addHandler(t,this),this};var Sn={Events:j},Cn=Ue.touch?`touchstart mousedown`:`mousedown`,wn=M.extend({options:{clickTolerance:3},initialize:function(e,t,n,r){p(this,r),this._element=e,this._dragStartTarget=t||e,this._preventOutline=n},enable:function(){this._enabled||=(Wt(this._dragStartTarget,Cn,this._onDown,this),!0)},disable:function(){this._enabled&&(wn._dragging===this&&this.finishDrag(!0),Kt(this._dragStartTarget,Cn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!bt(this._element,`leaflet-zoom-anim`))){if(e.touches&&e.touches.length!==1){wn._dragging===this&&this.finishDrag();return}if(!(wn._dragging||e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)&&(wn._dragging=this,this._preventOutline&&zt(this._element),Ft(),jt(),!this._moving)){this.fire(`down`);var t=e.touches?e.touches[0]:e,n=Vt(this._element);this._startPoint=new N(t.clientX,t.clientY),this._startPos=At(this._element),this._parentScale=Ht(n);var r=e.type===`mousedown`;Wt(document,r?`mousemove`:`touchmove`,this._onMove,this),Wt(document,r?`mouseup`:`touchend touchcancel`,this._onUp,this)}}},_onMove:function(e){if(this._enabled){if(e.touches&&e.touches.length>1){this._moved=!0;return}var t=e.touches&&e.touches.length===1?e.touches[0]:e,n=new N(t.clientX,t.clientY)._subtract(this._startPoint);!n.x&&!n.y||Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,en(e),this._moved||(this.fire(`dragstart`),this._moved=!0,xt(document.body,`leaflet-dragging`),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),xt(this._lastTarget,`leaflet-drag-target`)),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=e,this._updatePosition())}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire(`predrag`,e),kt(this._element,this._newPos),this.fire(`drag`,e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){St(document.body,`leaflet-dragging`),this._lastTarget&&=(St(this._lastTarget,`leaflet-drag-target`),null),Kt(document,`mousemove touchmove`,this._onMove,this),Kt(document,`mouseup touchend touchcancel`,this._onUp,this),It(),Mt();var t=this._moved&&this._moving;this._moving=!1,wn._dragging=!1,t&&this.fire(`dragend`,{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function Tn(e,t,n){var r,i=[1,4,2,8],a,o,s,c,l,u,d,f;for(a=0,u=e.length;a<u;a++)e[a]._code=Rn(e[a],t);for(s=0;s<4;s++){for(d=i[s],r=[],a=0,u=e.length,o=u-1;a<u;o=a++)c=e[a],l=e[o],c._code&d?l._code&d||(f=Ln(l,c,d,t,n),f._code=Rn(f,t),r.push(f)):(l._code&d&&(f=Ln(l,c,d,t,n),f._code=Rn(f,t),r.push(f)),r.push(c));e=r}return e}function En(e,t){var n,r,i,a,o,s,c,l,u;if(!e||e.length===0)throw Error(`latlngs not passed`);Vn(e)||(console.warn(`latlngs are not flat! Only the first ring will be used`),e=e[0]);var d=te([0,0]),f=z(e);f.getNorthWest().distanceTo(f.getSouthWest())*f.getNorthEast().distanceTo(f.getNorthWest())<1700&&(d=Dn(e));var p=e.length,m=[];for(n=0;n<p;n++){var h=te(e[n]);m.push(t.project(te([h.lat-d.lat,h.lng-d.lng])))}for(s=c=l=0,n=0,r=p-1;n<p;r=n++)i=m[n],a=m[r],o=i.y*a.x-a.y*i.x,c+=(i.x+a.x)*o,l+=(i.y+a.y)*o,s+=o*3;u=s===0?m[0]:[c/s,l/s];var g=t.unproject(F(u));return te([g.lat+d.lat,g.lng+d.lng])}function Dn(e){for(var t=0,n=0,r=0,i=0;i<e.length;i++){var a=te(e[i]);t+=a.lat,n+=a.lng,r++}return te([t/r,n/r])}var On={__proto__:null,clipPolygon:Tn,polygonCenter:En,centroid:Dn};function kn(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=Pn(e,n),e=Mn(e,n),e}function An(e,t,n){return Math.sqrt(Bn(e,t,n,!0))}function jn(e,t,n){return Bn(e,t,n)}function Mn(e,t){var n=e.length,r=new(typeof Uint8Array<`u`?Uint8Array:Array)(n);r[0]=r[n-1]=1,Nn(e,r,t,0,n-1);var i,a=[];for(i=0;i<n;i++)r[i]&&a.push(e[i]);return a}function Nn(e,t,n,r,i){var a=0,o,s,c;for(s=r+1;s<=i-1;s++)c=Bn(e[s],e[r],e[i],!0),c>a&&(o=s,a=c);a>n&&(t[o]=1,Nn(e,t,n,r,o),Nn(e,t,n,o,i))}function Pn(e,t){for(var n=[e[0]],r=1,i=0,a=e.length;r<a;r++)zn(e[r],e[i])>t&&(n.push(e[r]),i=r);return i<a-1&&n.push(e[a-1]),n}var Fn;function In(e,t,n,r,i){var a=r?Fn:Rn(e,n),o=Rn(t,n),s,c,l;for(Fn=o;;){if(!(a|o))return[e,t];if(a&o)return!1;s=a||o,c=Ln(e,t,s,n,i),l=Rn(c,n),s===a?(e=c,a=l):(t=c,o=l)}}function Ln(e,t,n,r,i){var a=t.x-e.x,o=t.y-e.y,s=r.min,c=r.max,l,u;return n&8?(l=e.x+a*(c.y-e.y)/o,u=c.y):n&4?(l=e.x+a*(s.y-e.y)/o,u=s.y):n&2?(l=c.x,u=e.y+o*(c.x-e.x)/a):n&1&&(l=s.x,u=e.y+o*(s.x-e.x)/a),new N(l,u,i)}function Rn(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n}function zn(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r}function Bn(e,t,n,r){var i=t.x,a=t.y,o=n.x-i,s=n.y-a,c=o*o+s*s,l;return c>0&&(l=((e.x-i)*o+(e.y-a)*s)/c,l>1?(i=n.x,a=n.y):l>0&&(i+=o*l,a+=s*l)),o=e.x-i,s=e.y-a,r?o*o+s*s:new N(i,a)}function Vn(e){return!_(e[0])||typeof e[0][0]!=`object`&&e[0][0]!==void 0}function Hn(e){return console.warn(`Deprecated use of _flat, please use L.LineUtil.isFlat instead.`),Vn(e)}function Un(e,t){var n,r,i,a,o,s,c,l;if(!e||e.length===0)throw Error(`latlngs not passed`);Vn(e)||(console.warn(`latlngs are not flat! Only the first ring will be used`),e=e[0]);var u=te([0,0]),d=z(e);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(u=Dn(e));var f=e.length,p=[];for(n=0;n<f;n++){var m=te(e[n]);p.push(t.project(te([m.lat-u.lat,m.lng-u.lng])))}for(n=0,r=0;n<f-1;n++)r+=p[n].distanceTo(p[n+1])/2;if(r===0)l=p[0];else for(n=0,a=0;n<f-1;n++)if(o=p[n],s=p[n+1],i=o.distanceTo(s),a+=i,a>r){c=(a-r)/i,l=[s.x-c*(s.x-o.x),s.y-c*(s.y-o.y)];break}var h=t.unproject(F(l));return te([h.lat+u.lat,h.lng+u.lng])}var Wn={__proto__:null,simplify:kn,pointToSegmentDistance:An,closestPointOnSegment:jn,clipSegment:In,_getEdgeIntersection:Ln,_getBitCode:Rn,_sqClosestPointOnSegment:Bn,isFlat:Vn,_flat:Hn,polylineCenter:Un},Gn={project:function(e){return new N(e.lng,e.lat)},unproject:function(e){return new B(e.y,e.x)},bounds:new I([-180,-90],[180,90])},Kn={R:6378137,R_MINOR:6356752.314245179,bounds:new I([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,n=this.R,r=e.lat*t,i=this.R_MINOR/n,a=Math.sqrt(1-i*i),o=a*Math.sin(r),s=Math.tan(Math.PI/4-r/2)/((1-o)/(1+o))**(a/2);return r=-n*Math.log(Math.max(s,1e-10)),new N(e.lng*t*n,r)},unproject:function(e){for(var t=180/Math.PI,n=this.R,r=this.R_MINOR/n,i=Math.sqrt(1-r*r),a=Math.exp(-e.y/n),o=Math.PI/2-2*Math.atan(a),s=0,c=.1,l;s<15&&Math.abs(c)>1e-7;s++)l=i*Math.sin(o),l=((1-l)/(1+l))**(i/2),c=Math.PI/2-2*Math.atan(a*l)-o,o+=c;return new B(o*t,e.x*t/n)}},qn={__proto__:null,LonLat:Gn,Mercator:Kn,SphericalMercator:ie},Jn=n({},re,{code:`EPSG:3395`,projection:Kn,transformation:function(){var e=.5/(Math.PI*Kn.R);return oe(e,.5,-e,.5)}()}),Yn=n({},re,{code:`EPSG:4326`,projection:Gn,transformation:oe(1/180,1,-1/180,.5)}),Xn=n({},ne,{projection:Gn,transformation:oe(1,0,-1,0),scale:function(e){return 2**e},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(n*n+r*r)},infinite:!0});ne.Earth=re,ne.EPSG3395=Jn,ne.EPSG3857=se,ne.EPSG900913=ce,ne.EPSG4326=Yn,ne.Simple=Xn;var Zn=M.extend({options:{pane:`overlayPane`,attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[o(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[o(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var n=this.getEvents();t.on(n,this),this.once(`remove`,function(){t.off(n,this)},this)}this.onAdd(t),this.fire(`add`),t.fire(`layeradd`,{layer:this})}}});un.include({addLayer:function(e){if(!e._layerAdd)throw Error(`The provided object is not a Layer.`);var t=o(e);return this._layers[t]?this:(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e),this)},removeLayer:function(e){var t=o(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire(`layerremove`,{layer:e}),e.fire(`remove`)),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return o(e)in this._layers},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},_addLayers:function(e){e=e?_(e)?e:[e]:[];for(var t=0,n=e.length;t<n;t++)this.addLayer(e[t])},_addZoomLimit:function(e){(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))&&(this._zoomBoundLayers[o(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=o(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,n=this._getZoomSpan();for(var r in this._zoomBoundLayers){var i=this._zoomBoundLayers[r].options;e=i.minZoom===void 0?e:Math.min(e,i.minZoom),t=i.maxZoom===void 0?t:Math.max(t,i.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,n!==this._getZoomSpan()&&this.fire(`zoomlevelschange`),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Qn=Zn.extend({initialize:function(e,t){p(this,t),this._layers={};var n,r;if(e)for(n=0,r=e.length;n<r;n++)this.addLayer(e[n])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return(typeof e==`number`?e:this.getLayerId(e))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t=Array.prototype.slice.call(arguments,1),n,r;for(n in this._layers)r=this._layers[n],r[e]&&r[e].apply(r,t);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke(`setZIndex`,e)},getLayerId:function(e){return o(e)}}),$n=function(e,t){return new Qn(e,t)},er=Qn.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),Qn.prototype.addLayer.call(this,e),this.fire(`layeradd`,{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),Qn.prototype.removeLayer.call(this,e),this.fire(`layerremove`,{layer:e})):this},setStyle:function(e){return this.invoke(`setStyle`,e)},bringToFront:function(){return this.invoke(`bringToFront`)},bringToBack:function(){return this.invoke(`bringToBack`)},getBounds:function(){var e=new R;for(var t in this._layers){var n=this._layers[t];e.extend(n.getBounds?n.getBounds():n.getLatLng())}return e}}),tr=function(e,t){return new er(e,t)},nr=k.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){p(this,e)},createIcon:function(e){return this._createIcon(`icon`,e)},createShadow:function(e){return this._createIcon(`shadow`,e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if(e===`icon`)throw Error(`iconUrl not set in Icon options (see the docs).`);return null}var r=this._createImg(n,t&&t.tagName===`IMG`?t:null);return this._setIconStyles(r,e),(this.options.crossOrigin||this.options.crossOrigin===``)&&(r.crossOrigin=this.options.crossOrigin===!0?``:this.options.crossOrigin),r},_setIconStyles:function(e,t){var n=this.options,r=n[t+`Size`];typeof r==`number`&&(r=[r,r]);var i=F(r),a=F(t===`shadow`&&n.shadowAnchor||n.iconAnchor||i&&i.divideBy(2,!0));e.className=`leaflet-marker-`+t+` `+(n.className||``),a&&(e.style.marginLeft=-a.x+`px`,e.style.marginTop=-a.y+`px`),i&&(e.style.width=i.x+`px`,e.style.height=i.y+`px`)},_createImg:function(e,t){return t||=document.createElement(`img`),t.src=e,t},_getIconUrl:function(e){return Ue.retina&&this.options[e+`RetinaUrl`]||this.options[e+`Url`]}});function rr(e){return new nr(e)}var ir=nr.extend({options:{iconUrl:`marker-icon.png`,iconRetinaUrl:`marker-icon-2x.png`,shadowUrl:`marker-shadow.png`,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return typeof ir.imagePath!=`string`&&(ir.imagePath=this._detectIconPath()),(this.options.imagePath||ir.imagePath)+nr.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(e,t,n){var r=t.exec(e);return r&&r[n]};return e=t(e,/^url\((['"])?(.+)\1\)$/,2),e&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=ht(`div`,`leaflet-default-icon-path`,document.body),t=mt(e,`background-image`)||mt(e,`backgroundImage`);if(document.body.removeChild(e),t=this._stripUrl(t),t)return t;var n=document.querySelector(`link[href$="leaflet.css"]`);return n?n.href.substring(0,n.href.length-11-1):``}}),ar=xn.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||=new wn(e,e,!0),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),xt(e,`leaflet-marker-draggable`)},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&St(this._marker._icon,`leaflet-marker-draggable`)},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,n=t._map,r=this._marker.options.autoPanSpeed,i=this._marker.options.autoPanPadding,a=At(t._icon),o=n.getPixelBounds(),s=n.getPixelOrigin(),c=ee(o.min._subtract(s).add(i),o.max._subtract(s).subtract(i));if(!c.contains(a)){var l=F((Math.max(c.max.x,a.x)-c.max.x)/(o.max.x-c.max.x)-(Math.min(c.min.x,a.x)-c.min.x)/(o.min.x-c.min.x),(Math.max(c.max.y,a.y)-c.max.y)/(o.max.y-c.max.y)-(Math.min(c.min.y,a.y)-c.min.y)/(o.min.y-c.min.y)).multiplyBy(r);n.panBy(l,{animate:!1}),this._draggable._newPos._add(l),this._draggable._startPos._add(l),kt(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=E(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire(`movestart`).fire(`dragstart`)},_onPreDrag:function(e){this._marker.options.autoPan&&(D(this._panRequest),this._panRequest=E(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,n=t._shadow,r=At(t._icon),i=t._map.layerPointToLatLng(r);n&&kt(n,r),t._latlng=i,e.latlng=i,e.oldLatLng=this._oldLatLng,t.fire(`move`,e).fire(`drag`,e)},_onDragEnd:function(e){D(this._panRequest),delete this._oldLatLng,this._marker.fire(`moveend`).fire(`dragend`,e)}}),or=Zn.extend({options:{icon:new ir,interactive:!0,keyboard:!0,title:``,alt:`Marker`,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:`markerPane`,shadowPane:`shadowPane`,bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){p(this,t),this._latlng=te(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on(`zoomanim`,this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off(`zoomanim`,this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=te(e),this.update(),this.fire(`move`,{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t=`leaflet-zoom-`+(this._zoomAnimated?`animated`:`hide`),n=e.icon.createIcon(this._icon),r=!1;n!==this._icon&&(this._icon&&this._removeIcon(),r=!0,e.title&&(n.title=e.title),n.tagName===`IMG`&&(n.alt=e.alt||``)),xt(n,t),e.keyboard&&(n.tabIndex=`0`,n.setAttribute(`role`,`button`)),this._icon=n,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Wt(n,`focus`,this._panOnFocus,this);var i=e.icon.createShadow(this._shadow),a=!1;i!==this._shadow&&(this._removeShadow(),a=!0),i&&(xt(i,t),i.alt=``),this._shadow=i,e.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),i&&a&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Kt(this._icon,`focus`,this._panOnFocus,this),gt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&gt(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&kt(this._icon,e),this._shadow&&kt(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(xt(this._icon,`leaflet-interactive`),this.addInteractiveTarget(this._icon),ar)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ar(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&Tt(this._icon,e),this._shadow&&Tt(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,n=t.iconSize?F(t.iconSize):F(0,0),r=t.iconAnchor?F(t.iconAnchor):F(0,0);e.panInside(this._latlng,{paddingTopLeft:r,paddingBottomRight:n.subtract(r)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function sr(e,t){return new or(e,t)}var cr=Zn.extend({options:{stroke:!0,color:`#3388ff`,weight:3,opacity:1,lineCap:`round`,lineJoin:`round`,dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:`evenodd`,interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return p(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,`weight`)&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),lr=cr.extend({options:{fill:!0,radius:10},initialize:function(e,t){p(this,t),this._latlng=te(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=te(e),this.redraw(),this.fire(`move`,{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return cr.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,n=this._clickTolerance(),r=[e+n,t+n];this._pxBounds=new I(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ur(e,t){return new lr(e,t)}var dr=lr.extend({initialize:function(e,t,r){if(typeof t==`number`&&(t=n({},r,{radius:t})),p(this,t),this._latlng=te(e),isNaN(this.options.radius))throw Error(`Circle radius cannot be NaN`);this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new R(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:cr.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,n=this._map,r=n.options.crs;if(r.distance===re.distance){var i=Math.PI/180,a=this._mRadius/re.R/i,o=n.project([t+a,e]),s=n.project([t-a,e]),c=o.add(s).divideBy(2),l=n.unproject(c).lat,u=Math.acos((Math.cos(a*i)-Math.sin(t*i)*Math.sin(l*i))/(Math.cos(t*i)*Math.cos(l*i)))/i;(isNaN(u)||u===0)&&(u=a/Math.cos(Math.PI/180*t)),this._point=c.subtract(n.getPixelOrigin()),this._radius=isNaN(u)?0:c.x-n.project([l,e-u]).x,this._radiusY=c.y-o.y}else{var d=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(d).x}this._updateBounds()}});function fr(e,t,n){return new dr(e,t,n)}var pr=cr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){p(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t=1/0,n=null,r=Bn,i,a,o=0,s=this._parts.length;o<s;o++)for(var c=this._parts[o],l=1,u=c.length;l<u;l++){i=c[l-1],a=c[l];var d=r(e,i,a,!0);d<t&&(t=d,n=r(e,i,a))}return n&&(n.distance=Math.sqrt(t)),n},getCenter:function(){if(!this._map)throw Error(`Must add layer to map before using getCenter()`);return Un(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t||=this._defaultShape(),e=te(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new R,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Vn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],n=Vn(e),r=0,i=e.length;r<i;r++)n?(t[r]=te(e[r]),this._bounds.extend(t[r])):t[r]=this._convertLatLngs(e[r]);return t},_project:function(){var e=new I;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new N(e,e);this._rawPxBounds&&(this._pxBounds=new I([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,n){var r=e[0]instanceof B,i=e.length,a,o;if(r){for(o=[],a=0;a<i;a++)o[a]=this._map.latLngToLayerPoint(e[a]),n.extend(o[a]);t.push(o)}else for(a=0;a<i;a++)this._projectLatlngs(e[a],t,n)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}var t=this._parts,n,r,i,a,o,s,c;for(n=0,i=0,a=this._rings.length;n<a;n++)for(c=this._rings[n],r=0,o=c.length;r<o-1;r++)s=In(c[r],c[r+1],e,r,!0),s&&(t[i]=t[i]||[],t[i].push(s[0]),(s[1]!==c[r+1]||r===o-2)&&(t[i].push(s[1]),i++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,n=0,r=e.length;n<r;n++)e[n]=kn(e[n],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var n,r,i,a,o,s,c=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,a=this._parts.length;n<a;n++)for(s=this._parts[n],r=0,o=s.length,i=o-1;r<o;i=r++)if(!(!t&&r===0)&&An(e,s[i],s[r])<=c)return!0;return!1}});function mr(e,t){return new pr(e,t)}pr._flat=Hn;var hr=pr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw Error(`Must add layer to map before using getCenter()`);return En(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=pr.prototype._convertLatLngs.call(this,e),n=t.length;return n>=2&&t[0]instanceof B&&t[0].equals(t[n-1])&&t.pop(),t},_setLatLngs:function(e){pr.prototype._setLatLngs.call(this,e),Vn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Vn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,n=new N(t,t);if(e=new I(e.min.subtract(n),e.max.add(n)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}for(var r=0,i=this._rings.length,a;r<i;r++)a=Tn(this._rings[r],e,!0),a.length&&this._parts.push(a)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t=!1,n,r,i,a,o,s,c,l;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(a=0,c=this._parts.length;a<c;a++)for(n=this._parts[a],o=0,l=n.length,s=l-1;o<l;s=o++)r=n[o],i=n[s],r.y>e.y!=i.y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(t=!t);return t||pr.prototype._containsPoint.call(this,e,!0)}});function gr(e,t){return new hr(e,t)}var _r=er.extend({initialize:function(e,t){p(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t=_(e)?e:e.features,n,r,i;if(t){for(n=0,r=t.length;n<r;n++)i=t[n],(i.geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var a=this.options;if(a.filter&&!a.filter(e))return this;var o=vr(e,a);return o?(o.feature=Tr(e),o.defaultOptions=o.options,this.resetStyle(o),a.onEachFeature&&a.onEachFeature(e,o),this.addLayer(o)):this},resetStyle:function(e){return e===void 0?this.eachLayer(this.resetStyle,this):(e.options=n({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){e.setStyle&&(typeof t==`function`&&(t=t(e.feature)),e.setStyle(t))}});function vr(e,t){var n=e.type===`Feature`?e.geometry:e,r=n?n.coordinates:null,i=[],a=t&&t.pointToLayer,o=t&&t.coordsToLatLng||br,s,c,l,u;if(!r&&!n)return null;switch(n.type){case`Point`:return s=o(r),yr(a,e,s,t);case`MultiPoint`:for(l=0,u=r.length;l<u;l++)s=o(r[l]),i.push(yr(a,e,s,t));return new er(i);case`LineString`:case`MultiLineString`:return c=xr(r,n.type===`LineString`?0:1,o),new pr(c,t);case`Polygon`:case`MultiPolygon`:return c=xr(r,n.type===`Polygon`?1:2,o),new hr(c,t);case`GeometryCollection`:for(l=0,u=n.geometries.length;l<u;l++){var d=vr({geometry:n.geometries[l],type:`Feature`,properties:e.properties},t);d&&i.push(d)}return new er(i);case`FeatureCollection`:for(l=0,u=n.features.length;l<u;l++){var f=vr(n.features[l],t);f&&i.push(f)}return new er(i);default:throw Error(`Invalid GeoJSON object.`)}}function yr(e,t,n,r){return e?e(t,n):new or(n,r&&r.markersInheritOptions&&r)}function br(e){return new B(e[1],e[0],e[2])}function xr(e,t,n){for(var r=[],i=0,a=e.length,o;i<a;i++)o=t?xr(e[i],t-1,n):(n||br)(e[i]),r.push(o);return r}function Sr(e,t){return e=te(e),e.alt===void 0?[u(e.lng,t),u(e.lat,t)]:[u(e.lng,t),u(e.lat,t),u(e.alt,t)]}function Cr(e,t,n,r){for(var i=[],a=0,o=e.length;a<o;a++)i.push(t?Cr(e[a],Vn(e[a])?0:t-1,n,r):Sr(e[a],r));return!t&&n&&i.length>0&&i.push(i[0].slice()),i}function wr(e,t){return e.feature?n({},e.feature,{geometry:t}):Tr(t)}function Tr(e){return e.type===`Feature`||e.type===`FeatureCollection`?e:{type:`Feature`,properties:{},geometry:e}}var Er={toGeoJSON:function(e){return wr(this,{type:`Point`,coordinates:Sr(this.getLatLng(),e)})}};or.include(Er),dr.include(Er),lr.include(Er),pr.include({toGeoJSON:function(e){var t=!Vn(this._latlngs),n=Cr(this._latlngs,t?1:0,!1,e);return wr(this,{type:(t?`Multi`:``)+`LineString`,coordinates:n})}}),hr.include({toGeoJSON:function(e){var t=!Vn(this._latlngs),n=t&&!Vn(this._latlngs[0]),r=Cr(this._latlngs,n?2:t?1:0,!0,e);return t||(r=[r]),wr(this,{type:(n?`Multi`:``)+`Polygon`,coordinates:r})}}),Qn.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(n){t.push(n.toGeoJSON(e).geometry.coordinates)}),wr(this,{type:`MultiPoint`,coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(t===`MultiPoint`)return this.toMultiPoint(e);var n=t===`GeometryCollection`,r=[];return this.eachLayer(function(t){if(t.toGeoJSON){var i=t.toGeoJSON(e);if(n)r.push(i.geometry);else{var a=Tr(i);a.type===`FeatureCollection`?r.push.apply(r,a.features):r.push(a)}}}),n?wr(this,{geometries:r,type:`GeometryCollection`}):{type:`FeatureCollection`,features:r}}});function Dr(e,t){return new _r(e,t)}var Or=Dr,kr=Zn.extend({options:{opacity:1,alt:``,interactive:!1,crossOrigin:!1,errorOverlayUrl:``,zIndex:1,className:``},initialize:function(e,t,n){this._url=e,this._bounds=z(t),p(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(xt(this._image,`leaflet-interactive`),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){gt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&vt(this._image),this},bringToBack:function(){return this._map&&yt(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=z(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e=this._url.tagName===`IMG`,t=this._image=e?this._url:ht(`img`);if(xt(t,`leaflet-image-layer`),this._zoomAnimated&&xt(t,`leaflet-zoom-animated`),this.options.className&&xt(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onload=i(this.fire,this,`load`),t.onerror=i(this._overlayOnError,this,`error`),(this.options.crossOrigin||this.options.crossOrigin===``)&&(t.crossOrigin=this.options.crossOrigin===!0?``:this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e){this._url=t.src;return}t.src=this._url,t.alt=this.options.alt},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;Ot(this._image,n,t)},_reset:function(){var e=this._image,t=new I(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=t.getSize();kt(e,t.min),e.style.width=n.x+`px`,e.style.height=n.y+`px`},_updateOpacity:function(){Tt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire(`error`);var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Ar=function(e,t,n){return new kr(e,t,n)},jr=kr.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e=this._url.tagName===`VIDEO`,t=this._image=e?this._url:ht(`video`);if(xt(t,`leaflet-image-layer`),this._zoomAnimated&&xt(t,`leaflet-zoom-animated`),this.options.className&&xt(t,this.options.className),t.onselectstart=l,t.onmousemove=l,t.onloadeddata=i(this.fire,this,`load`),e){for(var n=t.getElementsByTagName(`source`),r=[],a=0;a<n.length;a++)r.push(n[a].src);this._url=n.length>0?r:[t.src];return}_(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,`objectFit`)&&(t.style.objectFit=`fill`),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var o=0;o<this._url.length;o++){var s=ht(`source`);s.src=this._url[o],t.appendChild(s)}}});function Mr(e,t,n){return new jr(e,t,n)}var Nr=kr.extend({_initImage:function(){var e=this._image=this._url;xt(e,`leaflet-image-layer`),this._zoomAnimated&&xt(e,`leaflet-zoom-animated`),this.options.className&&xt(e,this.options.className),e.onselectstart=l,e.onmousemove=l}});function Pr(e,t,n){return new Nr(e,t,n)}var Fr=Zn.extend({options:{interactive:!1,offset:[0,0],className:``,pane:void 0,content:``},initialize:function(e,t){e&&(e instanceof B||_(e))?(this._latlng=te(e),p(this,t)):(p(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return e=arguments.length?e:this._source._map,e.hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&Tt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&Tt(this._container,1),this.bringToFront(),this.options.interactive&&(xt(this._container,`leaflet-interactive`),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(Tt(this._container,0),this._removeTimeout=setTimeout(i(gt,void 0,this._container),200)):gt(this._container),this.options.interactive&&(St(this._container,`leaflet-interactive`),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=te(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility=`hidden`,this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility=``,this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&vt(this._container),this},bringToBack:function(){return this._map&&yt(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof er){t=null;var n=this._source._layers;for(var r in n)if(n[r]._map){t=n[r];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else if(t.getBounds)e=t.getBounds().getCenter();else throw Error(`Unable to get source layer LatLng.`);return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t=typeof this._content==`function`?this._content(this._source||this):this._content;if(typeof t==`string`)e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire(`contentupdate`)}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=F(this.options.offset),n=this._getAnchor();this._zoomAnimated?kt(this._container,e.add(n)):t=t.add(e).add(n);var r=this._containerBottom=-t.y,i=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=r+`px`,this._container.style.left=i+`px`}},_getAnchor:function(){return[0,0]}});un.include({_initOverlay:function(e,t,n,r){var i=t;return i instanceof e||(i=new e(r).setContent(t)),n&&i.setLatLng(n),i}}),Zn.include({_initOverlay:function(e,t,n,r){var i=n;return i instanceof e?(p(i,r),i._source=this):(i=t&&!r?t:new e(r,this),i.setContent(n)),i}});var Ir=Fr.extend({options:{pane:`popupPane`,offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:``},openOn:function(e){return e=arguments.length?e:this._source._map,!e.hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Fr.prototype.openOn.call(this,e)},onAdd:function(e){Fr.prototype.onAdd.call(this,e),e.fire(`popupopen`,{popup:this}),this._source&&(this._source.fire(`popupopen`,{popup:this},!0),this._source instanceof cr||this._source.on(`preclick`,Zt))},onRemove:function(e){Fr.prototype.onRemove.call(this,e),e.fire(`popupclose`,{popup:this}),this._source&&(this._source.fire(`popupclose`,{popup:this},!0),this._source instanceof cr||this._source.off(`preclick`,Zt))},getEvents:function(){var e=Fr.prototype.getEvents.call(this);return(this.options.closeOnClick===void 0?this._map.options.closePopupOnClick:this.options.closeOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e=`leaflet-popup`,t=this._container=ht(`div`,e+` `+(this.options.className||``)+` leaflet-zoom-animated`),n=this._wrapper=ht(`div`,e+`-content-wrapper`,t);if(this._contentNode=ht(`div`,e+`-content`,n),$t(t),Qt(this._contentNode),Wt(t,`contextmenu`,Zt),this._tipContainer=ht(`div`,e+`-tip-container`,t),this._tip=ht(`div`,e+`-tip`,this._tipContainer),this.options.closeButton){var r=this._closeButton=ht(`a`,e+`-close-button`,t);r.setAttribute(`role`,`button`),r.setAttribute(`aria-label`,`Close popup`),r.href=`#close`,r.innerHTML=`<span aria-hidden="true">&#215;</span>`,Wt(r,`click`,function(e){en(e),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width=``,t.whiteSpace=`nowrap`;var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),t.width=n+1+`px`,t.whiteSpace=``,t.height=``;var r=e.offsetHeight,i=this.options.maxHeight,a=`leaflet-popup-scrolled`;i&&r>i?(t.height=i+`px`,xt(e,a)):St(e,a),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),n=this._getAnchor();kt(this._container,t.add(n))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var e=this._map,t=parseInt(mt(this._container,`marginBottom`),10)||0,n=this._container.offsetHeight+t,r=this._containerWidth,i=new N(this._containerLeft,-n-this._containerBottom);i._add(At(this._container));var a=e.layerPointToContainerPoint(i),o=F(this.options.autoPanPadding),s=F(this.options.autoPanPaddingTopLeft||o),c=F(this.options.autoPanPaddingBottomRight||o),l=e.getSize(),u=0,d=0;a.x+r+c.x>l.x&&(u=a.x+r-l.x+c.x),a.x-u-s.x<0&&(u=a.x-s.x),a.y+n+c.y>l.y&&(d=a.y+n-l.y+c.y),a.y-d-s.y<0&&(d=a.y-s.y),(u||d)&&(this.options.keepInView&&(this._autopanning=!0),e.fire(`autopanstart`).panBy([u,d]))}},_getAnchor:function(){return F(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Lr=function(e,t){return new Ir(e,t)};un.mergeOptions({closePopupOnClick:!0}),un.include({openPopup:function(e,t,n){return this._initOverlay(Ir,e,t,n).openOn(this),this},closePopup:function(e){return e=arguments.length?e:this._popup,e&&e.close(),this}}),Zn.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Ir,this._popup,e,t),this._popupHandlersAdded||=(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),!0),this},unbindPopup:function(){return this._popup&&=(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,null),this},openPopup:function(e){return this._popup&&(this instanceof er||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(!(!this._popup||!this._map)){tn(e);var t=e.layer||e.target;if(this._popup._source===t&&!(t instanceof cr)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng);return}this._popup._source=t,this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){e.originalEvent.keyCode===13&&this._openPopup(e)}});var Rr=Fr.extend({options:{pane:`tooltipPane`,offset:[0,0],direction:`auto`,permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Fr.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire(`tooltipopen`,{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire(`tooltipopen`,{tooltip:this},!0))},onRemove:function(e){Fr.prototype.onRemove.call(this,e),e.fire(`tooltipclose`,{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire(`tooltipclose`,{tooltip:this},!0))},getEvents:function(){var e=Fr.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){this._contentNode=this._container=ht(`div`,`leaflet-tooltip `+(this.options.className||``)+` leaflet-zoom-`+(this._zoomAnimated?`animated`:`hide`)),this._container.setAttribute(`role`,`tooltip`),this._container.setAttribute(`id`,`leaflet-tooltip-`+o(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,n,r=this._map,i=this._container,a=r.latLngToContainerPoint(r.getCenter()),o=r.layerPointToContainerPoint(e),s=this.options.direction,c=i.offsetWidth,l=i.offsetHeight,u=F(this.options.offset),d=this._getAnchor();s===`top`?(t=c/2,n=l):s===`bottom`?(t=c/2,n=0):s===`center`?(t=c/2,n=l/2):s===`right`?(t=0,n=l/2):s===`left`?(t=c,n=l/2):o.x<a.x?(s=`right`,t=0,n=l/2):(s=`left`,t=c+(u.x+d.x)*2,n=l/2),e=e.subtract(F(t,n,!0)).add(u).add(d),St(i,`leaflet-tooltip-right`),St(i,`leaflet-tooltip-left`),St(i,`leaflet-tooltip-top`),St(i,`leaflet-tooltip-bottom`),xt(i,`leaflet-tooltip-`+s),kt(i,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&Tt(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return F(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),zr=function(e,t){return new Rr(e,t)};un.include({openTooltip:function(e,t,n){return this._initOverlay(Rr,e,t,n).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Zn.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Rr,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&=(this._initTooltipInteractions(!0),this.closeTooltip(),null),this},_initTooltipInteractions:function(e){if(!(!e&&this._tooltipHandlersAdded)){var t=e?`off`:`on`,n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[t](n),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof er||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t=typeof e.getElement==`function`&&e.getElement();t&&(Wt(t,`focus`,function(){this._tooltip._source=e,this.openTooltip()},this),Wt(t,`blur`,this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t=typeof e.getElement==`function`&&e.getElement();t&&t.setAttribute(`aria-describedby`,this._tooltip._container.id)},_openTooltip:function(e){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once(`moveend`,function(){t._openOnceFlag=!1,t._openTooltip(e)});return}this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)}},_moveTooltip:function(e){var t=e.latlng,n,r;this._tooltip.options.sticky&&e.originalEvent&&(n=this._map.mouseEventToContainerPoint(e.originalEvent),r=this._map.containerPointToLayerPoint(n),t=this._map.layerPointToLatLng(r)),this._tooltip.setLatLng(t)}});var Br=nr.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:`leaflet-div-icon`},createIcon:function(e){var t=e&&e.tagName===`DIV`?e:document.createElement(`div`),n=this.options;if(n.html instanceof Element?(_t(t),t.appendChild(n.html)):t.innerHTML=n.html===!1?``:n.html,n.bgPos){var r=F(n.bgPos);t.style.backgroundPosition=-r.x+`px `+-r.y+`px`}return this._setIconStyles(t,`icon`),t},createShadow:function(){return null}});function Vr(e){return new Br(e)}nr.Default=ir;var Hr=Zn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ue.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:`tilePane`,className:``,keepBuffer:2},initialize:function(e){p(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),gt(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(vt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(yt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||=s(this._onMoveEnd,this.options.updateInterval,this),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement(`div`)},getTileSize:function(){var e=this.options.tileSize;return e instanceof N?e:new N(e,e)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t=this.getPane().children,n=-e(-1/0,1/0),r=0,i=t.length,a;r<i;r++)a=t[r].style.zIndex,t[r]!==this._container&&a&&(n=e(n,+a));isFinite(n)&&(this.options.zIndex=n+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ue.ielt9){Tt(this._container,this.options.opacity);var e=+new Date,t=!1,n=!1;for(var r in this._tiles){var i=this._tiles[r];if(!(!i.current||!i.loaded)){var a=Math.min(1,(e-i.loaded)/200);Tt(i.el,a),a<1?t=!0:(i.active?n=!0:this._onOpaqueTile(i),i.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),t&&(D(this._fadeFrame),this._fadeFrame=E(this._updateOpacity,this))}},_onOpaqueTile:l,_initContainer:function(){this._container||(this._container=ht(`div`,`leaflet-layer `+(this.options.className||``)),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(e!==void 0){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===e?(this._levels[n].el.style.zIndex=t-Math.abs(e-n),this._onUpdateLevel(n)):(gt(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var r=this._levels[e],i=this._map;return r||(r=this._levels[e]={},r.el=ht(`div`,`leaflet-tile-container leaflet-zoom-animated`,this._container),r.el.style.zIndex=t,r.origin=i.project(i.unproject(i.getPixelOrigin()),e).round(),r.zoom=e,this._setZoomTransform(r,i.getCenter(),i.getZoom()),r.el.offsetWidth,this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:l,_onRemoveLevel:l,_onCreateLevel:l,_pruneTiles:function(){if(this._map){var e,t,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom){this._removeAllTiles();return}for(e in this._tiles)t=this._tiles[e],t.retain=t.current;for(e in this._tiles)if(t=this._tiles[e],t.current&&!t.active){var r=t.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)gt(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,n,r){var i=Math.floor(e/2),a=Math.floor(t/2),o=n-1,s=new N(+i,+a);s.z=+o;var c=this._tileCoordsToKey(s),l=this._tiles[c];return l&&l.active?(l.retain=!0,!0):(l&&l.loaded&&(l.retain=!0),o>r?this._retainParent(i,a,o,r):!1)},_retainChildren:function(e,t,n,r){for(var i=2*e;i<2*e+2;i++)for(var a=2*t;a<2*t+2;a++){var o=new N(i,a);o.z=n+1;var s=this._tileCoordsToKey(o),c=this._tiles[s];if(c&&c.active){c.retain=!0;continue}else c&&c.loaded&&(c.retain=!0);n+1<r&&this._retainChildren(i,a,n+1,r)}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return t.minNativeZoom!==void 0&&e<t.minNativeZoom?t.minNativeZoom:t.maxNativeZoom!==void 0&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,n,r){var i=Math.round(t);i=this.options.maxZoom!==void 0&&i>this.options.maxZoom||this.options.minZoom!==void 0&&i<this.options.minZoom?void 0:this._clampZoom(i);var a=this.options.updateWhenZooming&&i!==this._tileZoom;(!r||a)&&(this._tileZoom=i,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),i!==void 0&&this._update(e),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var n in this._levels)this._setZoomTransform(this._levels[n],e,t)},_setZoomTransform:function(e,t,n){var r=this._map.getZoomScale(n,e.zoom),i=e.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(t,n)).round();Ue.any3d?Ot(e.el,i,r):kt(e.el,i)},_resetGrid:function(){var e=this._map,t=e.options.crs,n=this._tileSize=this.getTileSize(),r=this._tileZoom,i=this._map.getPixelWorldBounds(this._tileZoom);i&&(this._globalTileRange=this._pxBoundsToTileRange(i)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],r).x/n.x),Math.ceil(e.project([0,t.wrapLng[1]],r).x/n.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],r).y/n.x),Math.ceil(e.project([t.wrapLat[1],0],r).y/n.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(e){var t=this._map,n=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),r=t.getZoomScale(n,this._tileZoom),i=t.project(e,this._tileZoom).floor(),a=t.getSize().divideBy(r*2);return new I(i.subtract(a),i.add(a))},_update:function(e){var t=this._map;if(t){var n=this._clampZoom(t.getZoom());if(e===void 0&&(e=t.getCenter()),this._tileZoom!==void 0){var r=this._getTiledPixelBounds(e),i=this._pxBoundsToTileRange(r),a=i.getCenter(),o=[],s=this.options.keepBuffer,c=new I(i.getBottomLeft().subtract([s,-s]),i.getTopRight().add([s,-s]));if(!(isFinite(i.min.x)&&isFinite(i.min.y)&&isFinite(i.max.x)&&isFinite(i.max.y)))throw Error(`Attempted to load an infinite number of tiles`);for(var l in this._tiles){var u=this._tiles[l].coords;(u.z!==this._tileZoom||!c.contains(new N(u.x,u.y)))&&(this._tiles[l].current=!1)}if(Math.abs(n-this._tileZoom)>1){this._setView(e,n);return}for(var d=i.min.y;d<=i.max.y;d++)for(var f=i.min.x;f<=i.max.x;f++){var p=new N(f,d);if(p.z=this._tileZoom,this._isValidTile(p)){var m=this._tiles[this._tileCoordsToKey(p)];m?m.current=!0:o.push(p)}}if(o.sort(function(e,t){return e.distanceTo(a)-t.distanceTo(a)}),o.length!==0){this._loading||(this._loading=!0,this.fire(`loading`));var h=document.createDocumentFragment();for(f=0;f<o.length;f++)this._addTile(o[f],h);this._level.el.appendChild(h)}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var n=this._globalTileRange;if(!t.wrapLng&&(e.x<n.min.x||e.x>n.max.x)||!t.wrapLat&&(e.y<n.min.y||e.y>n.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(e);return z(this.options.bounds).overlaps(r)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,n=this.getTileSize(),r=e.scaleBy(n),i=r.add(n);return[t.unproject(r,e.z),t.unproject(i,e.z)]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),n=new R(t[0],t[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(e){return e.x+`:`+e.y+`:`+e.z},_keyToTileCoords:function(e){var t=e.split(`:`),n=new N(+t[0],+t[1]);return n.z=+t[2],n},_removeTile:function(e){var t=this._tiles[e];t&&(gt(t.el),delete this._tiles[e],this.fire(`tileunload`,{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){xt(e,`leaflet-tile`);var t=this.getTileSize();e.style.width=t.x+`px`,e.style.height=t.y+`px`,e.onselectstart=l,e.onmousemove=l,Ue.ielt9&&this.options.opacity<1&&Tt(e,this.options.opacity)},_addTile:function(e,t){var n=this._getTilePos(e),r=this._tileCoordsToKey(e),a=this.createTile(this._wrapCoords(e),i(this._tileReady,this,e));this._initTile(a),this.createTile.length<2&&E(i(this._tileReady,this,e,null,a)),kt(a,n),this._tiles[r]={el:a,coords:e,current:!0},t.appendChild(a),this.fire(`tileloadstart`,{tile:a,coords:e})},_tileReady:function(e,t,n){t&&this.fire(`tileerror`,{error:t,tile:n,coords:e});var r=this._tileCoordsToKey(e);n=this._tiles[r],n&&(n.loaded=+new Date,this._map._fadeAnimated?(Tt(n.el,0),D(this._fadeFrame),this._fadeFrame=E(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),t||(xt(n.el,`leaflet-tile-loaded`),this.fire(`tileload`,{tile:n.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire(`load`),Ue.ielt9||!this._map._fadeAnimated?E(this._pruneTiles,this):setTimeout(i(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new N(this._wrapX?c(e.x,this._wrapX):e.x,this._wrapY?c(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new I(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Ur(e){return new Hr(e)}var Wr=Hr.extend({options:{minZoom:0,maxZoom:18,subdomains:`abc`,errorTileUrl:``,zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,t=p(this,t),t.detectRetina&&Ue.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),typeof t.subdomains==`string`&&(t.subdomains=t.subdomains.split(``)),this.on(`tileunload`,this._onTileRemove)},setUrl:function(e,t){return this._url===e&&t===void 0&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var n=document.createElement(`img`);return Wt(n,`load`,i(this._tileOnLoad,this,t,n)),Wt(n,`error`,i(this._tileOnError,this,t,n)),(this.options.crossOrigin||this.options.crossOrigin===``)&&(n.crossOrigin=this.options.crossOrigin===!0?``:this.options.crossOrigin),typeof this.options.referrerPolicy==`string`&&(n.referrerPolicy=this.options.referrerPolicy),n.alt=``,n.src=this.getTileUrl(e),n},getTileUrl:function(e){var t={r:Ue.retina?`@2x`:``,s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=r),t[`-y`]=r}return g(this._url,n(t,this.options))},_tileOnLoad:function(e,t){Ue.ielt9?setTimeout(i(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,n){var r=this.options.errorTileUrl;r&&t.getAttribute(`src`)!==r&&(t.src=r),e(n,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom,n=this.options.zoomReverse,r=this.options.zoomOffset;return n&&(e=t-e),e+r},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&(t=this._tiles[e].el,t.onload=l,t.onerror=l,!t.complete)){t.src=y;var n=this._tiles[e].coords;gt(t),delete this._tiles[e],this.fire(`tileabort`,{tile:t,coords:n})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute(`src`,y),Hr.prototype._removeTile.call(this,e)},_tileReady:function(e,t,n){if(!(!this._map||n&&n.getAttribute(`src`)===y))return Hr.prototype._tileReady.call(this,e,t,n)}});function Gr(e,t){return new Wr(e,t)}var Kr=Wr.extend({defaultWmsParams:{service:`WMS`,request:`GetMap`,layers:``,styles:``,format:`image/jpeg`,transparent:!1,version:`1.1.1`},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var r=n({},this.defaultWmsParams);for(var i in t)i in this.options||(r[i]=t[i]);t=p(this,t);var a=t.detectRetina&&Ue.retina?2:1,o=this.getTileSize();r.width=o.x*a,r.height=o.y*a,this.wmsParams=r},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?`crs`:`srs`;this.wmsParams[t]=this._crs.code,Wr.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),n=this._crs,r=ee(n.project(t[0]),n.project(t[1])),i=r.min,a=r.max,o=(this._wmsVersion>=1.3&&this._crs===Yn?[i.y,i.x,a.y,a.x]:[i.x,i.y,a.x,a.y]).join(`,`),s=Wr.prototype.getTileUrl.call(this,e);return s+m(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?`&BBOX=`:`&bbox=`)+o},setParams:function(e,t){return n(this.wmsParams,e),t||this.redraw(),this}});function qr(e,t){return new Kr(e,t)}Wr.WMS=Kr,Gr.wms=qr;var Jr=Zn.extend({options:{padding:.1},initialize:function(e){p(this,e),o(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),xt(this._container,`leaflet-zoom-animated`)),this.getPane().appendChild(this._container),this._update(),this.on(`update`,this._updatePaths,this)},onRemove:function(){this.off(`update`,this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var n=this._map.getZoomScale(t,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),i=this._map.project(this._center,t),a=r.multiplyBy(-n).add(i).subtract(this._map._getNewPixelOrigin(e,t));Ue.any3d?Ot(this._container,a,n):kt(this._container,a)},_reset:function(){for(var e in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),n=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new I(n,n.add(t.multiplyBy(1+e*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Yr=Jr.extend({options:{tolerance:0},getEvents:function(){var e=Jr.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Jr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement(`canvas`);Wt(e,`mousemove`,this._onMouseMove,this),Wt(e,`click dblclick mousedown mouseup contextmenu`,this._onClick,this),Wt(e,`mouseout`,this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext(`2d`)},_destroyContainer:function(){D(this._redrawRequest),delete this._ctx,gt(this._container),Kt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var e;for(var t in this._redrawBounds=null,this._layers)e=this._layers[t],e._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Jr.prototype._update.call(this);var e=this._bounds,t=this._container,n=e.getSize(),r=Ue.retina?2:1;kt(t,e.min),t.width=r*n.x,t.height=r*n.y,t.style.width=n.x+`px`,t.style.height=n.y+`px`,Ue.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire(`update`)}},_reset:function(){Jr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[o(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,n=t.next,r=t.prev;n?n.prev=r:this._drawLast=r,r?r.next=n:this._drawFirst=n,delete e._order,delete this._layers[o(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if(typeof e.options.dashArray==`string`){var t=e.options.dashArray.split(/[, ]+/),n=[],r,i;for(i=0;i<t.length;i++){if(r=Number(t[i]),isNaN(r))return;n.push(r)}e.options._dashArray=n}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||E(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new I,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var n=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)e=r.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var n,r,i,a,o=e._parts,s=o.length,c=this._ctx;if(s){for(c.beginPath(),n=0;n<s;n++){for(r=0,i=o[n].length;r<i;r++)a=o[n][r],c[r?`lineTo`:`moveTo`](a.x,a.y);t&&c.closePath()}this._fillStroke(c,e)}}},_updateCircle:function(e){if(!(!this._drawing||e._empty())){var t=e._point,n=this._ctx,r=Math.max(Math.round(e._radius),1),i=(Math.max(Math.round(e._radiusY),1)||r)/r;i!==1&&(n.save(),n.scale(1,i)),n.beginPath(),n.arc(t.x,t.y/i,r,0,Math.PI*2,!1),i!==1&&n.restore(),this._fillStroke(n,e)}},_fillStroke:function(e,t){var n=t.options;n.fill&&(e.globalAlpha=n.fillOpacity,e.fillStyle=n.fillColor||n.color,e.fill(n.fillRule||`evenodd`)),n.stroke&&n.weight!==0&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=n.opacity,e.lineWidth=n.weight,e.strokeStyle=n.color,e.lineCap=n.lineCap,e.lineJoin=n.lineJoin,e.stroke())},_onClick:function(e){for(var t=this._map.mouseEventToLayerPoint(e),n,r,i=this._drawFirst;i;i=i.next)n=i.layer,n.options.interactive&&n._containsPoint(t)&&(!(e.type===`click`||e.type===`preclick`)||!this._map._draggableMoved(n))&&(r=n);this._fireEvent(r?[r]:!1,e)},_onMouseMove:function(e){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(St(this._container,`leaflet-interactive`),this._fireEvent([t],e,`mouseout`),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var n,r,a=this._drawFirst;a;a=a.next)n=a.layer,n.options.interactive&&n._containsPoint(t)&&(r=n);r!==this._hoveredLayer&&(this._handleMouseOut(e),r&&(xt(this._container,`leaflet-interactive`),this._fireEvent([r],e,`mouseover`),this._hoveredLayer=r)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,e),this._mouseHoverThrottled=!0,setTimeout(i(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,t,n){this._map._fireDOMEvent(t,n||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var n=t.next,r=t.prev;if(n)n.prev=r;else return;r?r.next=n:n&&(this._drawFirst=n),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e)}},_bringToBack:function(e){var t=e._order;if(t){var n=t.next,r=t.prev;if(r)r.next=n;else return;n?n.prev=r:r&&(this._drawLast=r),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e)}}});function Xr(e){return Ue.canvas?new Yr(e):null}var Zr=(function(){try{return document.namespaces.add(`lvml`,`urn:schemas-microsoft-com:vml`),function(e){return document.createElement(`<lvml:`+e+` class="lvml">`)}}catch{}return function(e){return document.createElement(`<`+e+` xmlns="urn:schemas-microsoft.com:vml" class="lvml">`)}})(),Qr={_initContainer:function(){this._container=ht(`div`,`leaflet-vml-container`)},_update:function(){this._map._animatingZoom||(Jr.prototype._update.call(this),this.fire(`update`))},_initPath:function(e){var t=e._container=Zr(`shape`);xt(t,`leaflet-vml-shape `+(this.options.className||``)),t.coordsize=`1 1`,e._path=Zr(`path`),t.appendChild(e._path),this._updateStyle(e),this._layers[o(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;gt(t),e.removeInteractiveTarget(t),delete this._layers[o(e)]},_updateStyle:function(e){var t=e._stroke,n=e._fill,r=e.options,i=e._container;i.stroked=!!r.stroke,i.filled=!!r.fill,r.stroke?(t||=e._stroke=Zr(`stroke`),i.appendChild(t),t.weight=r.weight+`px`,t.color=r.color,t.opacity=r.opacity,r.dashArray?t.dashStyle=_(r.dashArray)?r.dashArray.join(` `):r.dashArray.replace(/( *, *)/g,` `):t.dashStyle=``,t.endcap=r.lineCap.replace(`butt`,`flat`),t.joinstyle=r.lineJoin):t&&(i.removeChild(t),e._stroke=null),r.fill?(n||=e._fill=Zr(`fill`),i.appendChild(n),n.color=r.fillColor||r.color,n.opacity=r.fillOpacity):n&&(i.removeChild(n),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),n=Math.round(e._radius),r=Math.round(e._radiusY||n);this._setPath(e,e._empty()?`M0 0`:`AL `+t.x+`,`+t.y+` `+n+`,`+r+` 0,23592600`)},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){vt(e._container)},_bringToBack:function(e){yt(e._container)}},$r=Ue.vml?Zr:H,ei=Jr.extend({_initContainer:function(){this._container=$r(`svg`),this._container.setAttribute(`pointer-events`,`none`),this._rootGroup=$r(`g`),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){gt(this._container),Kt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Jr.prototype._update.call(this);var e=this._bounds,t=e.getSize(),n=this._container;(!this._svgSize||!this._svgSize.equals(t))&&(this._svgSize=t,n.setAttribute(`width`,t.x),n.setAttribute(`height`,t.y)),kt(n,e.min),n.setAttribute(`viewBox`,[e.min.x,e.min.y,t.x,t.y].join(` `)),this.fire(`update`)}},_initPath:function(e){var t=e._path=$r(`path`);e.options.className&&xt(t,e.options.className),e.options.interactive&&xt(t,`leaflet-interactive`),this._updateStyle(e),this._layers[o(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){gt(e._path),e.removeInteractiveTarget(e._path),delete this._layers[o(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,n=e.options;t&&(n.stroke?(t.setAttribute(`stroke`,n.color),t.setAttribute(`stroke-opacity`,n.opacity),t.setAttribute(`stroke-width`,n.weight),t.setAttribute(`stroke-linecap`,n.lineCap),t.setAttribute(`stroke-linejoin`,n.lineJoin),n.dashArray?t.setAttribute(`stroke-dasharray`,n.dashArray):t.removeAttribute(`stroke-dasharray`),n.dashOffset?t.setAttribute(`stroke-dashoffset`,n.dashOffset):t.removeAttribute(`stroke-dashoffset`)):t.setAttribute(`stroke`,`none`),n.fill?(t.setAttribute(`fill`,n.fillColor||n.color),t.setAttribute(`fill-opacity`,n.fillOpacity),t.setAttribute(`fill-rule`,n.fillRule||`evenodd`)):t.setAttribute(`fill`,`none`))},_updatePoly:function(e,t){this._setPath(e,le(e._parts,t))},_updateCircle:function(e){var t=e._point,n=Math.max(Math.round(e._radius),1),r=Math.max(Math.round(e._radiusY),1)||n,i=`a`+n+`,`+r+` 0 1,0 `,a=e._empty()?`M0 0`:`M`+(t.x-n)+`,`+t.y+i+n*2+`,0 `+i+-n*2+`,0 `;this._setPath(e,a)},_setPath:function(e,t){e._path.setAttribute(`d`,t)},_bringToFront:function(e){vt(e._path)},_bringToBack:function(e){yt(e._path)}});Ue.vml&&ei.include(Qr);function ti(e){return Ue.svg||Ue.vml?new ei(e):null}un.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||=this._renderer=this._createRenderer(),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if(e===`overlayPane`||e===void 0)return!1;var t=this._paneRenderers[e];return t===void 0&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Xr(e)||ti(e)}});var ni=hr.extend({initialize:function(e,t){hr.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=z(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function ri(e,t){return new ni(e,t)}ei.create=$r,ei.pointsToPath=le,_r.geometryToLayer=vr,_r.coordsToLatLng=br,_r.coordsToLatLngs=xr,_r.latLngToCoords=Sr,_r.latLngsToCoords=Cr,_r.getFeature=wr,_r.asFeature=Tr,un.mergeOptions({boxZoom:!0});var ii=xn.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on(`unload`,this._destroy,this)},addHooks:function(){Wt(this._container,`mousedown`,this._onMouseDown,this)},removeHooks:function(){Kt(this._container,`mousedown`,this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){gt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),jt(),Ft(),this._startPoint=this._map.mouseEventToContainerPoint(e),Wt(document,{contextmenu:tn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=ht(`div`,`leaflet-zoom-box`,this._container),xt(this._container,`leaflet-crosshair`),this._map.fire(`boxzoomstart`)),this._point=this._map.mouseEventToContainerPoint(e);var t=new I(this._point,this._startPoint),n=t.getSize();kt(this._box,t.min),this._box.style.width=n.x+`px`,this._box.style.height=n.y+`px`},_finish:function(){this._moved&&(gt(this._box),St(this._container,`leaflet-crosshair`)),Mt(),It(),Kt(document,{contextmenu:tn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if(!(e.which!==1&&e.button!==1)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(i(this._resetState,this),0);var t=new R(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire(`boxzoomend`,{boxZoomBounds:t})}},_onKeyDown:function(e){e.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});un.addInitHook(`addHandler`,`boxZoom`,ii),un.mergeOptions({doubleClickZoom:!0});var ai=xn.extend({addHooks:function(){this._map.on(`dblclick`,this._onDoubleClick,this)},removeHooks:function(){this._map.off(`dblclick`,this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom(),r=t.options.zoomDelta,i=e.originalEvent.shiftKey?n-r:n+r;t.options.doubleClickZoom===`center`?t.setZoom(i):t.setZoomAround(e.containerPoint,i)}});un.addInitHook(`addHandler`,`doubleClickZoom`,ai),un.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var oi=xn.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new wn(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on(`predrag`,this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on(`predrag`,this._onPreDragWrap,this),e.on(`zoomend`,this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}xt(this._map._container,`leaflet-grab leaflet-touch-drag`),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){St(this._map._container,`leaflet-grab`),St(this._map._container,`leaflet-touch-drag`),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=z(this._map.options.maxBounds);this._offsetLimit=ee(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire(`movestart`).fire(`dragstart`),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(t),this._prunePositions(t)}this._map.fire(`move`,e).fire(`drag`,e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2);this._initialWorldOffset=this._map.latLngToLayerPoint([0,0]).subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,r=this._draggable._newPos.x,i=(r-t+n)%e+t-n,a=(r+t+n)%e-t-n,o=Math.abs(i+n)<Math.abs(a+n)?i:a;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=o},_onDragEnd:function(e){var t=this._map,n=t.options,r=!n.inertia||e.noInertia||this._times.length<2;if(t.fire(`dragend`,e),r)t.fire(`moveend`);else{this._prunePositions(+new Date);var i=this._lastPos.subtract(this._positions[0]),a=(this._lastTime-this._times[0])/1e3,o=n.easeLinearity,s=i.multiplyBy(o/a),c=s.distanceTo([0,0]),l=Math.min(n.inertiaMaxSpeed,c),u=s.multiplyBy(l/c),d=l/(n.inertiaDeceleration*o),f=u.multiplyBy(-d/2).round();!f.x&&!f.y?t.fire(`moveend`):(f=t._limitOffset(f,t.options.maxBounds),E(function(){t.panBy(f,{duration:d,easeLinearity:o,noMoveStart:!0,animate:!0})}))}}});un.addInitHook(`addHandler`,`dragging`,oi),un.mergeOptions({keyboard:!0,keyboardPanDelta:80});var si=xn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex=`0`),Wt(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Kt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,n=e.scrollTop||t.scrollTop,r=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(r,n)}},_onFocus:function(){this._focused=!0,this._map.fire(`focus`)},_onBlur:function(){this._focused=!1,this._map.fire(`blur`)},_setPanDelta:function(e){var t=this._panKeys={},n=this.keyCodes,r,i;for(r=0,i=n.left.length;r<i;r++)t[n.left[r]]=[-1*e,0];for(r=0,i=n.right.length;r<i;r++)t[n.right[r]]=[e,0];for(r=0,i=n.down.length;r<i;r++)t[n.down[r]]=[0,e];for(r=0,i=n.up.length;r<i;r++)t[n.up[r]]=[0,-1*e]},_setZoomDelta:function(e){var t=this._zoomKeys={},n=this.keyCodes,r,i;for(r=0,i=n.zoomIn.length;r<i;r++)t[n.zoomIn[r]]=e;for(r=0,i=n.zoomOut.length;r<i;r++)t[n.zoomOut[r]]=-e},_addHooks:function(){Wt(document,`keydown`,this._onKeyDown,this)},_removeHooks:function(){Kt(document,`keydown`,this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t=e.keyCode,n=this._map,r;if(t in this._panKeys){if(!n._panAnim||!n._panAnim._inProgress)if(r=this._panKeys[t],e.shiftKey&&(r=F(r).multiplyBy(3)),n.options.maxBounds&&(r=n._limitOffset(F(r),n.options.maxBounds)),n.options.worldCopyJump){var i=n.wrapLatLng(n.unproject(n.project(n.getCenter()).add(r)));n.panTo(i)}else n.panBy(r)}else if(t in this._zoomKeys)n.setZoom(n.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[t]);else if(t===27&&n._popup&&n._popup.options.closeOnEscapeKey)n.closePopup();else return;tn(e)}}});un.addInitHook(`addHandler`,`keyboard`,si),un.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ci=xn.extend({addHooks:function(){Wt(this._map._container,`wheel`,this._onWheelScroll,this),this._delta=0},removeHooks:function(){Kt(this._map._container,`wheel`,this._onWheelScroll,this)},_onWheelScroll:function(e){var t=on(e),n=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||=+new Date;var r=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(i(this._performZoom,this),r),tn(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),n=this._map.options.zoomSnap||0;e._stop();var r=this._delta/(this._map.options.wheelPxPerZoomLevel*4),i=4*Math.log(2/(1+Math.exp(-Math.abs(r))))/Math.LN2,a=n?Math.ceil(i/n)*n:i,o=e._limitZoom(t+(this._delta>0?a:-a))-t;this._delta=0,this._startTime=null,o&&(e.options.scrollWheelZoom===`center`?e.setZoom(t+o):e.setZoomAround(this._lastMousePos,t+o))}});un.addInitHook(`addHandler`,`scrollWheelZoom`,ci);var li=600;un.mergeOptions({tapHold:Ue.touchNative&&Ue.safari&&Ue.mobile,tapTolerance:15});var ui=xn.extend({addHooks:function(){Wt(this._map._container,`touchstart`,this._onDown,this)},removeHooks:function(){Kt(this._map._container,`touchstart`,this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),e.touches.length===1){var t=e.touches[0];this._startPos=this._newPos=new N(t.clientX,t.clientY),this._holdTimeout=setTimeout(i(function(){this._cancel(),this._isTapValid()&&(Wt(document,`touchend`,en),Wt(document,`touchend touchcancel`,this._cancelClickPrevent),this._simulateEvent(`contextmenu`,t))},this),li),Wt(document,`touchend touchcancel contextmenu`,this._cancel,this),Wt(document,`touchmove`,this._onMove,this)}},_cancelClickPrevent:function e(){Kt(document,`touchend`,en),Kt(document,`touchend touchcancel`,e)},_cancel:function(){clearTimeout(this._holdTimeout),Kt(document,`touchend touchcancel contextmenu`,this._cancel,this),Kt(document,`touchmove`,this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new N(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var n=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});n._simulated=!0,t.target.dispatchEvent(n)}});un.addInitHook(`addHandler`,`tapHold`,ui),un.mergeOptions({touchZoom:Ue.touch,bounceAtZoomLimits:!0});var di=xn.extend({addHooks:function(){xt(this._map._container,`leaflet-touch-zoom`),Wt(this._map._container,`touchstart`,this._onTouchStart,this)},removeHooks:function(){St(this._map._container,`leaflet-touch-zoom`),Kt(this._map._container,`touchstart`,this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(!(!e.touches||e.touches.length!==2||t._animatingZoom||this._zooming)){var n=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),t.options.touchZoom!==`center`&&(this._pinchStartLatLng=t.containerPointToLatLng(n.add(r)._divideBy(2))),this._startDist=n.distanceTo(r),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),Wt(document,`touchmove`,this._onTouchMove,this),Wt(document,`touchend touchcancel`,this._onTouchEnd,this),en(e)}},_onTouchMove:function(e){if(!(!e.touches||e.touches.length!==2||!this._zooming)){var t=this._map,n=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]),a=n.distanceTo(r)/this._startDist;if(this._zoom=t.getScaleZoom(a,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&a<1||this._zoom>t.getMaxZoom()&&a>1)&&(this._zoom=t._limitZoom(this._zoom)),t.options.touchZoom===`center`){if(this._center=this._startLatLng,a===1)return}else{var o=n._add(r)._divideBy(2)._subtract(this._centerPoint);if(a===1&&o.x===0&&o.y===0)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(o),this._zoom)}this._moved||=(t._moveStart(!0,!1),!0),D(this._animRequest),this._animRequest=E(i(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0),this,!0),en(e)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,D(this._animRequest),Kt(document,`touchmove`,this._onTouchMove,this),Kt(document,`touchend touchcancel`,this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});un.addInitHook(`addHandler`,`touchZoom`,di),un.BoxZoom=ii,un.DoubleClickZoom=ai,un.Drag=oi,un.Keyboard=si,un.ScrollWheelZoom=ci,un.TapHold=ui,un.TouchZoom=di,e.Bounds=I,e.Browser=Ue,e.CRS=ne,e.Canvas=Yr,e.Circle=dr,e.CircleMarker=lr,e.Class=k,e.Control=fn,e.DivIcon=Br,e.DivOverlay=Fr,e.DomEvent=cn,e.DomUtil=Ut,e.Draggable=wn,e.Evented=M,e.FeatureGroup=er,e.GeoJSON=_r,e.GridLayer=Hr,e.Handler=xn,e.Icon=nr,e.ImageOverlay=kr,e.LatLng=B,e.LatLngBounds=R,e.Layer=Zn,e.LayerGroup=Qn,e.LineUtil=Wn,e.Map=un,e.Marker=or,e.Mixin=Sn,e.Path=cr,e.Point=N,e.PolyUtil=On,e.Polygon=hr,e.Polyline=pr,e.Popup=Ir,e.PosAnimation=ln,e.Projection=qn,e.Rectangle=ni,e.Renderer=Jr,e.SVG=ei,e.SVGOverlay=Nr,e.TileLayer=Wr,e.Tooltip=Rr,e.Transformation=ae,e.Util=O,e.VideoOverlay=jr,e.bind=i,e.bounds=ee,e.canvas=Xr,e.circle=fr,e.circleMarker=ur,e.control=pn,e.divIcon=Vr,e.extend=n,e.featureGroup=tr,e.geoJSON=Dr,e.geoJson=Or,e.gridLayer=Ur,e.icon=rr,e.imageOverlay=Ar,e.latLng=te,e.latLngBounds=z,e.layerGroup=$n,e.map=dn,e.marker=sr,e.point=F,e.polygon=gr,e.polyline=mr,e.popup=Lr,e.rectangle=ri,e.setOptions=p,e.stamp=o,e.svg=ti,e.svgOverlay=Pr,e.tileLayer=Gr,e.tooltip=zr,e.transformation=oe,e.version=t,e.videoOverlay=Mr;var fi=window.L;e.noConflict=function(){return window.L=fi,this},window.L=e}))}));V4();var U4=u(H4()),W4=[`id`,`style`,`rotation`,`mapInstance`,`version`,`mapSize`];function G4(e){"@babel/helpers - typeof";return G4=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},G4(e)}function K4(e,t){return Z4(e)||X4(e,t)||J4(e,t)||q4()}function q4(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function J4(e,t){if(e){if(typeof e==`string`)return Y4(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`)return Array.from(e);if(n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y4(e,t)}}function Y4(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function X4(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function Z4(e){if(Array.isArray(e))return e}function Q4(){Q4=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i=typeof Symbol==`function`?Symbol:{},a=i.iterator||`@@iterator`,o=i.asyncIterator||`@@asyncIterator`,s=i.toStringTag||`@@toStringTag`;function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},``)}catch{c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof f?t:f,o=Object.create(a.prototype);return r(o,`_invoke`,{value:x(e,n,new E(i||[]))}),o}function u(e,t,n){try{return{type:`normal`,arg:e.call(t,n)}}catch(e){return{type:`throw`,arg:e}}}e.wrap=l;var d={};function f(){}function p(){}function m(){}var h={};c(h,a,function(){return this});var g=Object.getPrototypeOf,_=g&&g(g(D([])));_&&_!==t&&n.call(_,a)&&(h=_);var v=m.prototype=f.prototype=Object.create(h);function y(e){[`next`,`throw`,`return`].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function b(e,t){function i(r,a,o,s){var c=u(e[r],e,a);if(c.type!==`throw`){var l=c.arg,d=l.value;return d&&G4(d)==`object`&&n.call(d,`__await`)?t.resolve(d.__await).then(function(e){i(`next`,e,o,s)},function(e){i(`throw`,e,o,s)}):t.resolve(d).then(function(e){l.value=e,o(l)},function(e){return i(`throw`,e,o,s)})}s(c.arg)}var a;r(this,`_invoke`,{value:function(e,n){function r(){return new t(function(t,r){i(e,n,t,r)})}return a=a?a.then(r,r):r()}})}function x(e,t,n){var r=`suspendedStart`;return function(i,a){if(r===`executing`)throw Error(`Generator is already running`);if(r===`completed`){if(i===`throw`)throw a;return O()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=S(o,n);if(s){if(s===d)continue;return s}}if(n.method===`next`)n.sent=n._sent=n.arg;else if(n.method===`throw`){if(r===`suspendedStart`)throw r=`completed`,n.arg;n.dispatchException(n.arg)}else n.method===`return`&&n.abrupt(`return`,n.arg);r=`executing`;var c=u(e,t,n);if(c.type===`normal`){if(r=n.done?`completed`:`suspendedYield`,c.arg===d)continue;return{value:c.arg,done:n.done}}c.type===`throw`&&(r=`completed`,n.method=`throw`,n.arg=c.arg)}}}function S(e,t){var n=t.method,r=e.iterator[n];if(r===void 0)return t.delegate=null,n===`throw`&&e.iterator.return&&(t.method=`return`,t.arg=void 0,S(e,t),t.method===`throw`)||n!==`return`&&(t.method=`throw`,t.arg=TypeError(`The iterator does not provide a '`+n+`' method`)),d;var i=u(r,e.iterator,t.arg);if(i.type===`throw`)return t.method=`throw`,t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,t.method!==`return`&&(t.method=`next`,t.arg=void 0),t.delegate=null,d):a:(t.method=`throw`,t.arg=TypeError(`iterator result is not an object`),t.delegate=null,d)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type=`normal`,delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:`root`}],e.forEach(C,this),this.reset(!0)}function D(e){if(e){var t=e[a];if(t)return t.call(e);if(typeof e.next==`function`)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=m,r(v,`constructor`,{value:m,configurable:!0}),r(m,`constructor`,{value:p,configurable:!0}),p.displayName=c(m,s,`GeneratorFunction`),e.isGeneratorFunction=function(e){var t=typeof e==`function`&&e.constructor;return!!t&&(t===p||(t.displayName||t.name)===`GeneratorFunction`)},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,s,`GeneratorFunction`)),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(b.prototype),c(b.prototype,o,function(){return this}),e.AsyncIterator=b,e.async=function(t,n,r,i,a){a===void 0&&(a=Promise);var o=new b(l(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then(function(e){return e.done?e.value:o.next()})},y(v),c(v,s,`Generator`),c(v,a,function(){return this}),c(v,`toString`,function(){return`[object Generator]`}),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=D,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method=`next`,this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)t.charAt(0)===`t`&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if(e.type===`throw`)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type=`throw`,o.arg=e,t.next=n,r&&(t.method=`next`,t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if(a.tryLoc===`root`)return r(`end`);if(a.tryLoc<=this.prev){var s=n.call(a,`catchLoc`),c=n.call(a,`finallyLoc`);if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error(`try statement without catch or finally`);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,`finallyLoc`)&&this.prev<i.finallyLoc){var a=i;break}}a&&(e===`break`||e===`continue`)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method=`next`,this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if(e.type===`throw`)throw e.arg;return e.type===`break`||e.type===`continue`?this.next=e.arg:e.type===`return`?(this.rval=this.arg=e.arg,this.method=`return`,this.next=`end`):e.type===`normal`&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if(r.type===`throw`){var i=r.arg;w(n)}return i}}throw Error(`illegal catch attempt`)},delegateYield:function(e,t,n){return this.delegate={iterator:D(e),resultName:t,nextLoc:n},this.method===`next`&&(this.arg=void 0),d}},e}function $4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?$4(Object(n),!0).forEach(function(t){h3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$4(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function t3(e,t){if(e==null)return{};var n=n3(e,t),r,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function n3(e,t){if(e==null)return{};var n={},r=Object.keys(e),i,a;for(a=0;a<r.length;a++)i=r[a],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}function r3(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){n(e);return}s.done?t(c):Promise.resolve(c).then(r,i)}function i3(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){r3(a,r,i,o,s,`next`,e)}function s(e){r3(a,r,i,o,s,`throw`,e)}o(void 0)})}}function a3(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function o3(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,g3(r.key),r)}}function s3(e,t,n){return t&&o3(e.prototype,t),n&&o3(e,n),Object.defineProperty(e,`prototype`,{writable:!1}),e}function c3(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&l3(e,t)}function l3(e,t){return l3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l3(e,t)}function u3(e){var t=p3();return function(){var n=m3(e),r;if(t){var i=m3(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d3(this,r)}}function d3(e,t){if(t&&(G4(t)===`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return f3(e)}function f3(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}function p3(){if(typeof Reflect>`u`||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy==`function`)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function m3(e){return m3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m3(e)}function h3(e,t,n){return t=g3(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g3(e){var t=_3(e,`string`);return G4(t)===`symbol`?t:String(t)}function _3(e,t){if(G4(e)!==`object`||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(G4(r)!==`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}var v3=function(e){c3(n,e);var t=u3(n);function n(){var e;a3(this,n);var r=[...arguments];return e=t.call.apply(t,[this].concat(r)),h3(f3(e),`map`,void 0),h3(f3(e),`viewport`,void 0),h3(f3(e),`sceneContainer`,void 0),h3(f3(e),`handleCameraChanged`,function(t){var n=e.map.getCenter(),r=n.lat,i=n.lng,a=e.map.getSize(),o=a.x,s=a.y;e.viewport.syncWithMapCamera({bearing:0,center:[i,r],viewportHeight:s,pitch:0,viewportWidth:o,zoom:e.map.getZoom()-1,cameraHeight:0}),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)}),e}return s3(n,[{key:`lngLatToMercator`,value:function(e,t){throw Error(`Method not implemented.`)}},{key:`getModelMatrix`,value:function(e,t,n,r,i){throw Error(`Method not implemented.`)}},{key:`init`,value:function(){var e=i3(Q4().mark(function e(){var t,n,r,i,a;return Q4().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=n===void 0?`map`:n,t.style,t.rotation,i=t.mapInstance,t.version,t.mapSize,a=t3(t,W4),this.viewport=new $K,i?(this.map=i,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new U4.Map(this.$mapContainer,e3(e3({zoomSnap:.1,zoomAnimation:!0},a),{},{center:a.center?.reverse()}))),U4.DomUtil.addClass(this.$mapContainer,`leaflet-zoom-anim`),this.map.on(`zoomanim`,this.onAnimZoom.bind(this)),this.map.on(`moveend`,this.update.bind(this)),this.handleCameraChanged();case 7:case`end`:return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:`getMapCanvasContainer`,value:function(){return this.map.getContainer()}},{key:`addMarkerContainer`,value:function(){var e=this.map.getContainer(),t=this.markerContainer=document.createElement(`div`);e.appendChild(t),t.setAttribute(`tabindex`,`-1`),t.style.position=`absolute`,t.style.left=`0px`,t.style.top=`0px`,t.style.zIndex=`600`,t.style.width=`0px`,t.style.height=`0px`,t.style.overflow=`visible`}},{key:`getOverlayContainer`,value:function(){var e=this.map.getPane(`overlayPane`),t=U4.DomUtil.create(`div`);e.appendChild(t),t.className=`leaflet-layer`;var n=this.map.getSize();return t.style.width=`${n.x}px`,t.style.height=`${n.y}px`,this.map._zoomAnimated&&U4.DomUtil.addClass(t,`leaflet-zoom-animated`),this.sceneContainer=t,t}},{key:`update`,value:function(){if(!this.map._animatingZoom){var e=this.map.getSize();this.sceneContainer.style.width=`${e.x}px`,this.sceneContainer.style.height=`${e.y}px`;var t=this.map._getMapPanePos().multiplyBy(-1);U4.DomUtil.removeClass(this.sceneContainer,`leaflet-zoom-animated`),U4.DomUtil.setPosition(this.sceneContainer,t),this.handleCameraChanged()}}},{key:`pixelToLngLat`,value:function(e){return this.map.containerPointToLatLng(e)}},{key:`containerToLngLat`,value:function(e){return this.pixelToLngLat(e)}},{key:`onAnimZoom`,value:function(e){this.map._zoomAnimated&&U4.DomUtil.addClass(this.sceneContainer,`leaflet-zoom-animated`),this.updateTransform(e.center,e.zoom)}},{key:`updateTransform`,value:function(e,t){var n=this.sceneContainer,r=this.map.getZoomScale(t,this.map.getZoom()),i=U4.DomUtil.getPosition(n),a=this.map.getSize().multiplyBy(.5),o=this.map.project(this.map.getCenter(),t),s=this.map.project(e,t).subtract(o),c=a.multiplyBy(-r).add(i).add(a).subtract(s);U4.Browser.any3d?U4.DomUtil.setTransform(n,c,r):U4.DomUtil.setPosition(n,c)}},{key:`onCameraChanged`,value:function(e){this.cameraChangedCallback=e}},{key:`getBounds`,value:function(){var e=this.map.getBounds(),t=e.getSouthWest(),n=e.getNorthEast();return[[t.lng,t.lat],[n.lng,n.lat]]}},{key:`lngLatToContainer`,value:function(e){var t=K4(e,2),n=t[0],r=t[1];return this.map.latLngToContainerPoint([r,n])}}]),n}(wq);V4();function y3(e){"@babel/helpers - typeof";return y3=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},y3(e)}function b3(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function x3(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,C3(r.key),r)}}function S3(e,t,n){return t&&x3(e.prototype,t),n&&x3(e,n),Object.defineProperty(e,`prototype`,{writable:!1}),e}function C3(e){var t=w3(e,`string`);return y3(t)===`symbol`?t:String(t)}function w3(e,t){if(y3(e)!==`object`||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(y3(r)!==`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}function T3(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&E3(e,t)}function E3(e,t){return E3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E3(e,t)}function D3(e){var t=A3();return function(){var n=j3(e),r;if(t){var i=j3(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return O3(this,r)}}function O3(e,t){if(t&&(y3(t)===`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return k3(e)}function k3(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}function A3(){if(typeof Reflect>`u`||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy==`function`)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function j3(e){return j3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},j3(e)}var M3=function(e){T3(n,e);var t=D3(n);function n(){return b3(this,n),t.apply(this,arguments)}return S3(n,[{key:`getServiceConstructor`,value:function(){return v3}}]),n}(zH);V4();function N3(e){"@babel/helpers - typeof";return N3=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},N3(e)}function P3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function F3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?P3(Object(n),!0).forEach(function(t){I3(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P3(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function I3(e,t,n){return t=L3(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L3(e){var t=R3(e,`string`);return N3(t)===`symbol`?t:String(t)}function R3(e,t){if(N3(e)!==`object`||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(N3(r)!==`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}function z3(e){return{longitude:e.getCenter().lng,latitude:e.getCenter().lat,zoom:e.getZoom()-1,pitch:0,bearing:0}}function B3(e,t,n,r){if(!n){var i=z3(e);n=new I4(F3(F3({},r),{},{id:t,map:new M3({pitchEnabled:!1,rotateEnabled:!1,interactive:!1,center:[i.longitude,i.latitude],zoom:i.zoom,pitch:0,rotation:0,mapInstance:e})}))}return n}function V3(e,t){var n=z3(t),r=t.getSize();e.getMapService().updateView({viewportWidth:r.x,viewportHeight:r.y,center:[n.longitude,n.latitude],zoom:n.zoom})}function H3(e){"@babel/helpers - typeof";return H3=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},H3(e)}function U3(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function W3(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,e6(r.key),r)}}function G3(e,t,n){return t&&W3(e.prototype,t),n&&W3(e,n),Object.defineProperty(e,`prototype`,{writable:!1}),e}function K3(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&q3(e,t)}function q3(e,t){return q3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q3(e,t)}function J3(e){var t=Z3();return function(){var n=Q3(e),r;if(t){var i=Q3(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Y3(this,r)}}function Y3(e,t){if(t&&(H3(t)===`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return X3(e)}function X3(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}function Z3(){if(typeof Reflect>`u`||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy==`function`)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Q3(e){return Q3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Q3(e)}function $3(e,t,n){return t=e6(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function e6(e){var t=t6(e,`string`);return H3(t)===`symbol`?t:String(t)}function t6(e,t){if(H3(e)!==`object`||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(H3(r)!==`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}var n6=function(e){K3(n,e);var t=J3(n);function n(e){var r;return U3(this,n),r=t.call(this),$3(X3(r),`container`,void 0),$3(X3(r),`animate`,void 0),$3(X3(r),`props`,void 0),$3(X3(r),`scene`,void 0),r.props=e??{},r}return G3(n,[{key:`getScene`,value:function(){return this.scene}},{key:`onAdd`,value:function(){this.container=U4.DomUtil.create(`div`),this.container.className=`leaflet-layer`,this._zoomAnimated&&U4.DomUtil.addClass(this.container,`leaflet-zoom-animated`),this.getPane().appendChild(this.container);var e=this._map.getSize();return this.container.style.width=`${e.x}px`,this.container.style.height=`${e.y}px`,this.scene=B3(this._map,this.container,this.scene,this.props),this.update(),this}},{key:`onRemove`,value:function(e){return U4.DomUtil.remove(this.container),this}},{key:`getEvents`,value:function(){var e={moveend:this.onMoveEnd,zoom:this.onZoom};return this._zoomAnimated&&(e.zoomanim=this.onAnimZoom),e}},{key:`update`,value:function(){if(!this._map._animatingZoom){var e=this._map.getSize();this.container.style.width=`${e.x}px`,this.container.style.height=`${e.y}px`;var t=this._map._getMapPanePos().multiplyBy(-1);U4.DomUtil.setPosition(this.container,t),V3(this.scene,this._map)}}},{key:`reset`,value:function(){this.updateTransform(this._map.getCenter(),this._map.getZoom()),this.update()}},{key:`onMoveEnd`,value:function(){this.update()}},{key:`onAnimZoom`,value:function(e){this.updateTransform(e.center,e.zoom)}},{key:`onZoom`,value:function(){this.updateTransform(this._map.getCenter(),this._map.getZoom())}},{key:`updateTransform`,value:function(e,t){var n=this._map.getZoomScale(t,this._map.getZoom()),r=U4.DomUtil.getPosition(this.container),i=this._map.getSize().multiplyBy(.5),a=this._map.project(this._map.getCenter(),t),o=this._map.project(e,t).subtract(a),s=i.multiplyBy(-n).add(r).add(i).subtract(o);U4.Browser.any3d?U4.DomUtil.setTransform(this.container,s,n):U4.DomUtil.setPosition(this.container,s)}}]),n}(U4.Layer);V4();var r6=s(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?r(e,(V4(),d(B4))):typeof define==`function`&&define.amd?define([`exports`,`@antv/l7`],r):r(((n=typeof globalThis<`u`?globalThis:n||self).L7=n.L7||{},n.L7.Draw={}),n.L7)})(e,(function(e,t){var n={draw:`crosshair`,pointHover:`pointer`,pointDrag:`move`,lineHover:`pointer`,lineDrag:`move`,polygonHover:`pointer`,polygonDrag:`move`},r={point:[],line:[],polygon:[],midPoint:[],dashLine:[],text:[]},i=typeof global<`u`?global:typeof self<`u`?self:typeof window<`u`?window:{};function a(){throw Error(`setTimeout has not been defined`)}function o(){throw Error(`clearTimeout has not been defined`)}var s=a,c=o;function l(e){if(s===setTimeout)return setTimeout(e,0);if((s===a||!s)&&setTimeout)return s=setTimeout,setTimeout(e,0);try{return s(e,0)}catch{try{return s.call(null,e,0)}catch{return s.call(this,e,0)}}}typeof i.setTimeout==`function`&&(s=setTimeout),typeof i.clearTimeout==`function`&&(c=clearTimeout);var u,d=[],f=!1,p=-1;function m(){f&&u&&(f=!1,u.length?d=u.concat(d):p=-1,d.length&&h())}function h(){if(!f){var e=l(m);f=!0;for(var t=d.length;t;){for(u=d,d=[];++p<t;)u&&u[p].run();p=-1,t=d.length}u=null,f=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===o||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch{try{return c.call(null,e)}catch{return c.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};function _(){}var v=_,y=_,b=_,x=_,S=_,C=_,w=_,E=i.performance||{},D=E.now||E.mozNow||E.msNow||E.oNow||E.webkitNow||function(){return new Date().getTime()},O=new Date,k={nextTick:function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;arguments.length>n;n++)t[n-1]=arguments[n];d.push(new g(e,t)),d.length!==1||f||l(h)},title:`browser`,browser:!0,env:{},argv:[],version:``,versions:{},on:v,addListener:y,once:b,off:x,removeListener:S,removeAllListeners:C,emit:w,binding:function(e){throw Error(`process.binding is not supported`)},cwd:function(){return`/`},chdir:function(e){throw Error(`process.chdir is not supported`)},umask:function(){return 0},hrtime:function(e){var t=.001*D.call(E),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],0>(r-=e[1])&&(n--,r+=1e9)),[n,r]},platform:`browser`,release:{},config:{},uptime:function(){return(new Date-O)/1e3}},A=`top`,j=`bottom`,M=`right`,N=`left`,P=`auto`,F=[A,j,M,N],I=`start`,ee=`end`,R=`clippingParents`,z=`viewport`,B=`popper`,te=`reference`,ne=F.reduce((function(e,t){return e.concat([t+`-`+I,t+`-`+ee])}),[]),re=[].concat(F,[P]).reduce((function(e,t){return e.concat([t,t+`-`+I,t+`-`+ee])}),[]),V=[`beforeRead`,`read`,`afterRead`,`beforeMain`,`main`,`afterMain`,`beforeWrite`,`write`,`afterWrite`];function ie(e){return e?(e.nodeName||``).toLowerCase():null}function ae(e){if(e==null)return window;if(``+e!=`[object Window]`){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function oe(e){return e instanceof ae(e).Element||e instanceof Element}function se(e){return e instanceof ae(e).HTMLElement||e instanceof HTMLElement}function ce(e){return typeof ShadowRoot<`u`&&(e instanceof ae(e).ShadowRoot||e instanceof ShadowRoot)}var H={name:`applyStyles`,enabled:!0,phase:`write`,fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e];se(i)&&ie(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?``:t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:`0`,top:`0`,margin:`0`},arrow:{position:`absolute`},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],i=t.attributes[e]||{},a=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]=``,e}),{});se(r)&&ie(r)&&(Object.assign(r.style,a),Object.keys(i).forEach((function(e){r.removeAttribute(e)})))}))}},requires:[`computeStyles`]};function le(e){return e.split(`-`)[0]}var ue=Math.max,de=Math.min,U=Math.round;function fe(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+`/`+e.version})).join(` `):navigator.userAgent}function pe(){return!/^((?!chrome|android).)*safari/i.test(fe())}function me(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var r=e.getBoundingClientRect(),i=1,a=1;t&&se(e)&&(i=e.offsetWidth>0&&U(r.width)/e.offsetWidth||1,a=e.offsetHeight>0&&U(r.height)/e.offsetHeight||1);var o=(oe(e)?ae(e):window).visualViewport,s=!pe()&&n,c=(r.left+(s&&o?o.offsetLeft:0))/i,l=(r.top+(s&&o?o.offsetTop:0))/a,u=r.width/i,d=r.height/a;return{width:u,height:d,top:l,right:c+u,bottom:l+d,left:c,x:c,y:l}}function W(e){var t=me(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)>1||(n=t.width),Math.abs(t.height-r)>1||(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function he(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&ce(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function ge(e){return ae(e).getComputedStyle(e)}function _e(e){return[`table`,`td`,`th`].indexOf(ie(e))>=0}function G(e){return((oe(e)?e.ownerDocument:e.document)||window.document).documentElement}function K(e){return ie(e)===`html`?e:e.assignedSlot||e.parentNode||(ce(e)?e.host:null)||G(e)}function ve(e){return se(e)&&ge(e).position!==`fixed`?e.offsetParent:null}function ye(e){for(var t=ae(e),n=ve(e);n&&_e(n)&&ge(n).position===`static`;)n=ve(n);return n&&(ie(n)===`html`||ie(n)===`body`&&ge(n).position===`static`)?t:n||function(e){var t=/firefox/i.test(fe());if(/Trident/i.test(fe())&&se(e)&&ge(e).position===`fixed`)return null;var n=K(e);for(ce(n)&&(n=n.host);se(n)&&0>[`html`,`body`].indexOf(ie(n));){var r=ge(n);if(r.transform!==`none`||r.perspective!==`none`||r.contain===`paint`||[`transform`,`perspective`].indexOf(r.willChange)!==-1||t&&r.willChange===`filter`||t&&r.filter&&r.filter!==`none`)return n;n=n.parentNode}return null}(e)||t}function be(e){return 0>[`top`,`bottom`].indexOf(e)?`y`:`x`}function xe(e,t,n){return ue(e,de(t,n))}function Se(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Ce(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}var we={name:`arrow`,enabled:!0,phase:`main`,fn:function(e){var t,n=e.state,r=e.name,i=e.options,a=n.elements.arrow,o=n.modifiersData.popperOffsets,s=le(n.placement),c=be(s),l=[N,M].indexOf(s)>=0?`height`:`width`;if(a&&o){var u=function(e,t){return Se(typeof(e=typeof e==`function`?e(Object.assign({},t.rects,{placement:t.placement})):e)==`number`?Ce(e,F):e)}(i.padding,n),d=W(a),f=c===`y`?A:N,p=c===`y`?j:M,m=n.rects.reference[l]+n.rects.reference[c]-o[c]-n.rects.popper[l],h=o[c]-n.rects.reference[c],g=ye(a),_=g?c===`y`?g.clientHeight||0:g.clientWidth||0:0,v=_/2-d[l]/2+(m/2-h/2),y=xe(u[f],v,_-d[l]-u[p]);n.modifiersData[r]=((t={})[c]=y,t.centerOffset=y-v,t)}},effect:function(e){var t=e.state,n=e.options.element,r=n===void 0?`[data-popper-arrow]`:n;r!=null&&(typeof r!=`string`||(r=t.elements.popper.querySelector(r)))&&he(t.elements.popper,r)&&(t.elements.arrow=r)},requires:[`popperOffsets`],requiresIfExists:[`preventOverflow`]};function Te(e){return e.split(`-`)[1]}var Ee={top:`auto`,right:`auto`,bottom:`auto`,left:`auto`};function De(e){var t,n=e.popper,r=e.popperRect,i=e.placement,a=e.variation,o=e.offsets,s=e.position,c=e.gpuAcceleration,l=e.adaptive,u=e.roundOffsets,d=e.isFixed,f=o.x,p=f===void 0?0:f,m=o.y,h=m===void 0?0:m,g=typeof u==`function`?u({x:p,y:h}):{x:p,y:h};p=g.x,h=g.y;var _=o.hasOwnProperty(`x`),v=o.hasOwnProperty(`y`),y=N,b=A,x=window;if(l){var S=ye(n),C=`clientHeight`,w=`clientWidth`;S===ae(n)&&ge(S=G(n)).position!==`static`&&s===`absolute`&&(C=`scrollHeight`,w=`scrollWidth`),(i===A||(i===N||i===M)&&a===ee)&&(b=j,h-=(d&&S===x&&x.visualViewport?x.visualViewport.height:S[C])-r.height,h*=c?1:-1),(i===N||(i===A||i===j)&&a===ee)&&(y=M,p-=(d&&S===x&&x.visualViewport?x.visualViewport.width:S[w])-r.width,p*=c?1:-1)}var E,D=Object.assign({position:s},l&&Ee),O=!0===u?function(e,t){var n=e.y,r=t.devicePixelRatio||1;return{x:U(e.x*r)/r||0,y:U(n*r)/r||0}}({x:p,y:h},ae(n)):{x:p,y:h};return p=O.x,h=O.y,Object.assign({},D,c?((E={})[b]=v?`0`:``,E[y]=_?`0`:``,E.transform=(x.devicePixelRatio||1)>1?`translate3d(`+p+`px, `+h+`px, 0)`:`translate(`+p+`px, `+h+`px)`,E):((t={})[b]=v?h+`px`:``,t[y]=_?p+`px`:``,t.transform=``,t))}var Oe={passive:!0},ke={left:`right`,right:`left`,bottom:`top`,top:`bottom`};function Ae(e){return e.replace(/left|right|bottom|top/g,(function(e){return ke[e]}))}var je={start:`end`,end:`start`};function Me(e){return e.replace(/start|end/g,(function(e){return je[e]}))}function Ne(e){var t=ae(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Pe(e){return me(G(e)).left+Ne(e).scrollLeft}function Fe(e){var t=ge(e);return/auto|scroll|overlay|hidden/.test(t.overflow+t.overflowY+t.overflowX)}function Ie(e){return 0>[`html`,`body`,`#document`].indexOf(ie(e))?se(e)&&Fe(e)?e:Ie(K(e)):e.ownerDocument.body}function Le(e,t){t===void 0&&(t=[]);var n=Ie(e),r=n===e.ownerDocument?.body,i=ae(n),a=r?[i].concat(i.visualViewport||[],Fe(n)?n:[]):n,o=t.concat(a);return r?o:o.concat(Le(K(a)))}function q(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Re(e,t,n){return t===z?q(function(e,t){var n=ae(e),r=G(e),i=n.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,c=0;if(i){a=i.width,o=i.height;var l=pe();(l||!l&&t===`fixed`)&&(s=i.offsetLeft,c=i.offsetTop)}return{width:a,height:o,x:s+Pe(e),y:c}}(e,n)):oe(t)?function(e,t){var n=me(e,!1,t===`fixed`);return n.top+=e.clientTop,n.left+=e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):q(function(e){var t=G(e),n=Ne(e),r=e.ownerDocument?.body,i=ue(t.scrollWidth,t.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),a=ue(t.scrollHeight,t.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),o=-n.scrollLeft+Pe(e),s=-n.scrollTop;return ge(r||t).direction===`rtl`&&(o+=ue(t.clientWidth,r?r.clientWidth:0)-i),{width:i,height:a,x:o,y:s}}(G(e)))}function ze(e,t,n,r){var i=t===`clippingParents`?function(e){var t=Le(K(e)),n=[`absolute`,`fixed`].indexOf(ge(e).position)>=0&&se(e)?ye(e):e;return oe(n)?t.filter((function(e){return oe(e)&&he(e,n)&&ie(e)!==`body`})):[]}(e):[].concat(t),a=[].concat(i,[n]),o=a.reduce((function(t,n){var i=Re(e,n,r);return t.top=ue(i.top,t.top),t.right=de(i.right,t.right),t.bottom=de(i.bottom,t.bottom),t.left=ue(i.left,t.left),t}),Re(e,a[0],r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function Be(e){var t,n=e.reference,r=e.element,i=e.placement,a=i?le(i):null,o=i?Te(i):null,s=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(a){case A:t={x:s,y:n.y-r.height};break;case j:t={x:s,y:n.y+n.height};break;case M:t={x:n.x+n.width,y:c};break;case N:t={x:n.x-r.width,y:c};break;default:t={x:n.x,y:n.y}}var l=a?be(a):null;if(l!=null){var u=l===`y`?`height`:`width`;switch(o){case I:t[l]=t[l]-(n[u]/2-r[u]/2);break;case ee:t[l]=t[l]+(n[u]/2-r[u]/2)}}return t}function Ve(e,t){t===void 0&&(t={});var n=t.placement,r=n===void 0?e.placement:n,i=t.strategy,a=i===void 0?e.strategy:i,o=t.boundary,s=o===void 0?R:o,c=t.rootBoundary,l=c===void 0?z:c,u=t.elementContext,d=u===void 0?B:u,f=t.altBoundary,p=f!==void 0&&f,m=t.padding,h=m===void 0?0:m,g=Se(typeof h==`number`?Ce(h,F):h),_=e.rects.popper,v=e.elements[p?d===B?te:B:d],y=ze(oe(v)?v:v.contextElement||G(e.elements.popper),s,l,a),b=me(e.elements.reference),x=Be({reference:b,element:_,strategy:`absolute`,placement:r}),S=q(Object.assign({},_,x)),C=d===B?S:b,w={top:y.top-C.top+g.top,bottom:C.bottom-y.bottom+g.bottom,left:y.left-C.left+g.left,right:C.right-y.right+g.right},E=e.modifiersData.offset;if(d===B&&E){var D=E[r];Object.keys(w).forEach((function(e){var t=0>[M,j].indexOf(e)?-1:1;w[e]+=D[0>[A,j].indexOf(e)?`x`:`y`]*t}))}return w}function He(e,t){t===void 0&&(t={});var n=t.boundary,r=t.rootBoundary,i=t.padding,a=t.flipVariations,o=t.allowedAutoPlacements,s=o===void 0?re:o,c=Te(t.placement),l=c?a?ne:ne.filter((function(e){return Te(e)===c})):F,u=l.filter((function(e){return s.indexOf(e)>=0}));u.length===0&&(u=l);var d=u.reduce((function(t,a){return t[a]=Ve(e,{placement:a,boundary:n,rootBoundary:r,padding:i})[le(a)],t}),{});return Object.keys(d).sort((function(e,t){return d[e]-d[t]}))}var Ue={name:`flip`,enabled:!0,phase:`main`,fn:function(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,a=i===void 0||i,o=n.altAxis,s=o===void 0||o,c=n.fallbackPlacements,l=n.padding,u=n.boundary,d=n.rootBoundary,f=n.altBoundary,p=n.flipVariations,m=p===void 0||p,h=n.allowedAutoPlacements,g=t.options.placement,_=le(g),v=c||(_===g||!m?[Ae(g)]:function(e){if(le(e)===P)return[];var t=Ae(e);return[Me(e),t,Me(t)]}(g)),y=[g].concat(v).reduce((function(e,n){return e.concat(le(n)===P?He(t,{placement:n,boundary:u,rootBoundary:d,padding:l,flipVariations:m,allowedAutoPlacements:h}):n)}),[]),b=t.rects.reference,x=t.rects.popper,S=new Map,C=!0,w=y[0],E=0;y.length>E;E++){var D=y[E],O=le(D),k=Te(D)===I,F=[A,j].indexOf(O)>=0,ee=F?`width`:`height`,R=Ve(t,{placement:D,boundary:u,rootBoundary:d,altBoundary:f,padding:l}),z=F?k?M:N:k?j:A;b[ee]>x[ee]&&(z=Ae(z));var B=Ae(z),te=[];if(a&&te.push(0>=R[O]),s&&te.push(0>=R[z],0>=R[B]),te.every((function(e){return e}))){w=D,C=!1;break}S.set(D,te)}if(C)for(var ne=function(e){var t=y.find((function(t){var n=S.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return w=t,`break`},re=m?3:1;re>0&&ne(re)!==`break`;re--);t.placement!==w&&(t.modifiersData[r]._skip=!0,t.placement=w,t.reset=!0)}},requiresIfExists:[`offset`],data:{_skip:!1}};function We(e,t,n){return n===void 0&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Ge(e){return[A,M,j,N].some((function(t){return e[t]>=0}))}var Ke={name:`offset`,enabled:!0,phase:`main`,requires:[`popperOffsets`],fn:function(e){var t=e.state,n=e.name,r=e.options.offset,i=r===void 0?[0,0]:r,a=re.reduce((function(e,n){return e[n]=function(e,t,n){var r=le(e),i=0>[N,A].indexOf(r)?1:-1,a=typeof n==`function`?n(Object.assign({},t,{placement:e})):n,o=a[0],s=a[1];return o||=0,s=(s||0)*i,0>[N,M].indexOf(r)?{x:o,y:s}:{x:s,y:o}}(n,t.rects,i),e}),{}),o=a[t.placement],s=o.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=o.x,t.modifiersData.popperOffsets.y+=s),t.modifiersData[n]=a}},qe={name:`preventOverflow`,enabled:!0,phase:`main`,fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,a=i===void 0||i,o=n.altAxis,s=o!==void 0&&o,c=n.tether,l=c===void 0||c,u=n.tetherOffset,d=u===void 0?0:u,f=Ve(t,{boundary:n.boundary,rootBoundary:n.rootBoundary,padding:n.padding,altBoundary:n.altBoundary}),p=le(t.placement),m=Te(t.placement),h=!m,g=be(p),_=g===`x`?`y`:`x`,v=t.modifiersData.popperOffsets,y=t.rects.reference,b=t.rects.popper,x=typeof d==`function`?d(Object.assign({},t.rects,{placement:t.placement})):d,S=typeof x==`number`?{mainAxis:x,altAxis:x}:Object.assign({mainAxis:0,altAxis:0},x),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,w={x:0,y:0};if(v){if(a){var E=g===`y`?A:N,D=g===`y`?j:M,O=g===`y`?`height`:`width`,k=v[g],P=k+f[E],F=k-f[D],ee=l?-b[O]/2:0,R=m===I?y[O]:b[O],z=m===I?-b[O]:-y[O],B=t.elements.arrow,te=l&&B?W(B):{width:0,height:0},ne=t.modifiersData[`arrow#persistent`]?t.modifiersData[`arrow#persistent`].padding:{top:0,right:0,bottom:0,left:0},re=ne[E],V=ne[D],ie=xe(0,y[O],te[O]),ae=h?y[O]/2-ee-ie-re-S.mainAxis:R-ie-re-S.mainAxis,oe=h?-y[O]/2+ee+ie+V+S.mainAxis:z+ie+V+S.mainAxis,se=t.elements.arrow&&ye(t.elements.arrow),ce=C?.[g]??0,H=k+oe-ce,U=xe(l?de(P,k+ae-ce-(se?g===`y`?se.clientTop||0:se.clientLeft||0:0)):P,k,l?ue(F,H):F);v[g]=U,w[g]=U-k}if(s){var fe=v[_],pe=_===`y`?`height`:`width`,me=fe+f[g===`x`?A:N],he=fe-f[g===`x`?j:M],ge=[A,N].indexOf(p)!==-1,_e=C?.[_]??0,G=ge?me:fe-y[pe]-b[pe]-_e+S.altAxis,K=ge?fe+y[pe]+b[pe]-_e-S.altAxis:he,ve=l&&ge?function(e,t,n){var r=xe(e,t,n);return r>n?n:r}(G,fe,K):xe(l?G:me,fe,l?K:he);v[_]=ve,w[_]=ve-fe}t.modifiersData[r]=w}},requiresIfExists:[`offset`]};function Je(e,t,n){n===void 0&&(n=!1);var r,i,a=se(t),o=se(t)&&function(e){var t=e.getBoundingClientRect(),n=U(t.width)/e.offsetWidth||1,r=U(t.height)/e.offsetHeight||1;return n!==1||r!==1}(t),s=G(t),c=me(e,o,n),l={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(a||!a&&!n)&&((ie(t)!==`body`||Fe(s))&&(l=(r=t)!==ae(r)&&se(r)?{scrollLeft:(i=r).scrollLeft,scrollTop:i.scrollTop}:Ne(r)),se(t)?((u=me(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):s&&(u.x=Pe(s))),{x:c.left+l.scrollLeft-u.x,y:c.top+l.scrollTop-u.y,width:c.width,height:c.height}}function Ye(e){var t=new Map,n=new Set,r=[];function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var r=t.get(e);r&&i(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||i(e)})),r}var Xe={placement:`bottom`,modifiers:[],strategy:`absolute`};function Ze(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&typeof e.getBoundingClientRect==`function`)}))}function Qe(e){e===void 0&&(e={});var t=e.defaultModifiers,n=t===void 0?[]:t,r=e.defaultOptions,i=r===void 0?Xe:r;return function(e,t,r){r===void 0&&(r=i);var a,o,s={placement:`bottom`,orderedModifiers:[],options:Object.assign({},Xe,i),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],l=!1,u={state:s,setOptions:function(r){var a=typeof r==`function`?r(s.options):r;d(),s.options=Object.assign({},i,s.options,a),s.scrollParents={reference:oe(e)?Le(e):e.contextElement?Le(e.contextElement):[],popper:Le(t)};var o,l,f=function(e){var t=Ye(e);return V.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((o=[].concat(n,s.options.modifiers),l=o.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(l).map((function(e){return l[e]}))));return s.orderedModifiers=f.filter((function(e){return e.enabled})),s.orderedModifiers.forEach((function(e){var t=e.options,n=e.effect;if(typeof n==`function`){var r=n({state:s,name:e.name,instance:u,options:t===void 0?{}:t});c.push(r||function(){})}})),u.update()},forceUpdate:function(){if(!l){var e=s.elements,t=e.reference,n=e.popper;if(Ze(t,n)){s.rects={reference:Je(t,ye(n),s.options.strategy===`fixed`),popper:W(n)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(e){return s.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;s.orderedModifiers.length>r;r++)if(!0!==s.reset){var i=s.orderedModifiers[r],a=i.fn,o=i.options;typeof a==`function`&&(s=a({state:s,options:o===void 0?{}:o,name:i.name,instance:u})||s)}else s.reset=!1,r=-1}}},update:(a=function(){return new Promise((function(e){u.forceUpdate(),e(s)}))},function(){return o||=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(a())}))})),o}),destroy:function(){d(),l=!0}};if(!Ze(e,t))return u;function d(){c.forEach((function(e){return e()})),c=[]}return u.setOptions(r).then((function(e){!l&&r.onFirstUpdate&&r.onFirstUpdate(e)})),u}}var $e=Qe({defaultModifiers:[{name:`eventListeners`,enabled:!0,phase:`write`,fn:function(){},effect:function(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,a=i===void 0||i,o=r.resize,s=o===void 0||o,c=ae(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&l.forEach((function(e){e.addEventListener(`scroll`,n.update,Oe)})),s&&c.addEventListener(`resize`,n.update,Oe),function(){a&&l.forEach((function(e){e.removeEventListener(`scroll`,n.update,Oe)})),s&&c.removeEventListener(`resize`,n.update,Oe)}},data:{}},{name:`popperOffsets`,enabled:!0,phase:`read`,fn:function(e){var t=e.state;t.modifiersData[e.name]=Be({reference:t.rects.reference,element:t.rects.popper,strategy:`absolute`,placement:t.placement})},data:{}},{name:`computeStyles`,enabled:!0,phase:`beforeWrite`,fn:function(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=r===void 0||r,a=n.adaptive,o=a===void 0||a,s=n.roundOffsets,c=s===void 0||s,l={placement:le(t.placement),variation:Te(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:t.options.strategy===`fixed`};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,De(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,De(Object.assign({},l,{offsets:t.modifiersData.arrow,position:`absolute`,adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},H,Ke,Ue,qe,we,{name:`hide`,enabled:!0,phase:`main`,requiresIfExists:[`preventOverflow`],fn:function(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,a=t.modifiersData.preventOverflow,o=Ve(t,{elementContext:`reference`}),s=Ve(t,{altBoundary:!0}),c=We(o,r),l=We(s,i,a),u=Ge(c),d=Ge(l);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:u,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}}]}),et=`tippy-content`,tt=`tippy-backdrop`,nt=`tippy-arrow`,rt=`tippy-svg-arrow`,it={passive:!0,capture:!0},at=function(){return document.body};function ot(e,t,n){return Array.isArray(e)?e[t]??(Array.isArray(n)?n[t]:n):e}function st(e,t){var n={}.toString.call(e);return n.indexOf(`[object`)===0&&n.indexOf(t+`]`)>-1}function ct(e,t){return typeof e==`function`?e.apply(void 0,t):e}function lt(e,t){return t===0?e:function(r){clearTimeout(n),n=setTimeout((function(){e(r)}),t)};var n}function ut(e){return[].concat(e)}function dt(e,t){e.indexOf(t)===-1&&e.push(t)}function ft(e){return[].slice.call(e)}function pt(e){return Object.keys(e).reduce((function(t,n){return e[n]!==void 0&&(t[n]=e[n]),t}),{})}function mt(){return document.createElement(`div`)}function ht(e){return[`Element`,`Fragment`].some((function(t){return st(e,t)}))}function gt(e){return st(e,`MouseEvent`)}function _t(e){return ht(e)?[e]:function(e){return st(e,`NodeList`)}(e)?ft(e):Array.isArray(e)?e:ft(document.querySelectorAll(e))}function vt(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+`ms`)}))}function yt(e,t){e.forEach((function(e){e&&e.setAttribute(`data-state`,t)}))}function bt(e){var t,n=ut(e)[0];return n!=null&&(t=n.ownerDocument)!=null&&t.body?n.ownerDocument:document}function xt(e,t,n){var r=t+`EventListener`;[`transitionend`,`webkitTransitionEnd`].forEach((function(t){e[r](t,n)}))}function St(e,t){for(var n=t;n;){var r;if(e.contains(n))return!0;n=n.getRootNode==null||(r=n.getRootNode())==null?void 0:r.host}return!1}var Ct={isTouch:!1},wt=0;function Tt(){Ct.isTouch||(Ct.isTouch=!0,window.performance&&document.addEventListener(`mousemove`,Et))}function Et(){var e=performance.now();20>e-wt&&(Ct.isTouch=!1,document.removeEventListener(`mousemove`,Et)),wt=e}function Dt(){var e,t=document.activeElement;(e=t)&&e._tippy&&e._tippy.reference===e&&t.blur&&!t._tippy.state.isVisible&&t.blur()}var Ot=typeof window<`u`&&typeof document<`u`&&!!window.msCrypto,kt=Object.assign({appendTo:at,aria:{content:`auto`,expanded:`auto`},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:``,offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:`top`,plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:`mouseenter focus`,triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:`fade`,arrow:!0,content:``,inertia:!1,maxWidth:350,role:`tooltip`,theme:``,zIndex:9999}),At=Object.keys(kt);function jt(e){var t=(e.plugins||[]).reduce((function(t,n){var r=n.name;return r&&(t[r]=e[r]===void 0?kt[r]??n.defaultValue:e[r]),t}),{});return Object.assign({},e,t)}function Mt(e,t){var n=Object.assign({},t,{content:ct(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(jt(Object.assign({},kt,{plugins:t}))):At).reduce((function(t,n){var r=(e.getAttribute(`data-tippy-`+n)||``).trim();if(!r)return t;if(n===`content`)t[n]=r;else try{t[n]=JSON.parse(r)}catch{t[n]=r}return t}),{})}(e,t.plugins));return n.aria=Object.assign({},kt.aria,n.aria),n.aria={expanded:n.aria.expanded===`auto`?t.interactive:n.aria.expanded,content:n.aria.content===`auto`?t.interactive?null:`describedby`:n.aria.content},n}var Nt=function(){return`innerHTML`};function Pt(e,t){e[Nt()]=t}function Ft(e){var t=mt();return!0===e?t.className=nt:(t.className=rt,ht(e)?t.appendChild(e):Pt(t,e)),t}function It(e,t){ht(t.content)?(Pt(e,``),e.appendChild(t.content)):typeof t.content!=`function`&&(t.allowHTML?Pt(e,t.content):e.textContent=t.content)}function Lt(e){var t=e.firstElementChild,n=ft(t.children);return{box:t,content:n.find((function(e){return e.classList.contains(et)})),arrow:n.find((function(e){return e.classList.contains(nt)||e.classList.contains(rt)})),backdrop:n.find((function(e){return e.classList.contains(tt)}))}}function Rt(e){var t=mt(),n=mt();n.className=`tippy-box`,n.setAttribute(`data-state`,`hidden`),n.setAttribute(`tabindex`,`-1`);var r=mt();function i(n,r){var i=Lt(t),a=i.box,o=i.content,s=i.arrow;r.theme?a.setAttribute(`data-theme`,r.theme):a.removeAttribute(`data-theme`),typeof r.animation==`string`?a.setAttribute(`data-animation`,r.animation):a.removeAttribute(`data-animation`),r.inertia?a.setAttribute(`data-inertia`,``):a.removeAttribute(`data-inertia`),a.style.maxWidth=typeof r.maxWidth==`number`?r.maxWidth+`px`:r.maxWidth,r.role?a.setAttribute(`role`,r.role):a.removeAttribute(`role`),n.content===r.content&&n.allowHTML===r.allowHTML||It(o,e.props),r.arrow?s?n.arrow!==r.arrow&&(a.removeChild(s),a.appendChild(Ft(r.arrow))):a.appendChild(Ft(r.arrow)):s&&a.removeChild(s)}return r.className=et,r.setAttribute(`data-state`,`hidden`),It(r,e.props),t.appendChild(n),n.appendChild(r),i(e.props,e.props),{popper:t,onUpdate:i}}Rt.$$tippy=!0;var zt=1,Bt=[],Vt=[];function Ht(e,t){var n,r,i,a,o,s,c,l,u=Mt(e,Object.assign({},kt,jt(pt(t)))),d=!1,f=!1,p=!1,m=!1,h=[],g=lt(se,u.interactiveDebounce),_=zt++,v=(l=u.plugins).filter((function(e,t){return l.indexOf(e)===t})),y={id:_,reference:e,popper:mt(),popperInstance:null,props:u,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:v,clearDelayTimeouts:function(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(i)},setProps:function(t){if(!y.state.isDestroyed){P(`onBeforeUpdate`,[y,t]),ae();var n=y.props,r=Mt(e,Object.assign({},n,pt(t),{ignoreAttributes:!0}));y.props=r,ie(),n.interactiveDebounce!==r.interactiveDebounce&&(ee(),g=lt(se,r.interactiveDebounce)),n.triggerTarget&&!r.triggerTarget?ut(n.triggerTarget).forEach((function(e){e.removeAttribute(`aria-expanded`)})):r.triggerTarget&&e.removeAttribute(`aria-expanded`),I(),N(),S&&S(n,r),y.popperInstance&&(ue(),U().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)}))),P(`onAfterUpdate`,[y,t])}},setContent:function(e){y.setProps({content:e})},show:function(){var e=y.state.isVisible,t=y.state.isDestroyed,n=!y.state.isEnabled,r=Ct.isTouch&&!y.props.touch,i=ot(y.props.duration,0,kt.duration);if(!(e||t||n||r)&&!k().hasAttribute(`disabled`)&&(P(`onShow`,[y],!1),!1!==y.props.onShow(y))){if(y.state.isVisible=!0,O()&&(x.style.visibility=`visible`),N(),te(),y.state.isMounted||(x.style.transition=`none`),O()){var a=j();vt([a.box,a.content],0)}s=function(){var e;if(y.state.isVisible&&!m){if(m=!0,x.style.transition=y.props.moveTransition,O()&&y.props.animation){var t=j(),n=t.box,r=t.content;vt([n,r],i),yt([n,r],`visible`)}F(),I(),dt(Vt,y),(e=y.popperInstance)==null||e.forceUpdate(),P(`onMount`,[y]),y.props.animation&&O()&&function(e,t){re(e,t)}(i,(function(){y.state.isShown=!0,P(`onShown`,[y])}))}},function(){var e,t=y.props.appendTo,n=k();e=y.props.interactive&&t===at||t===`parent`?n.parentNode:ct(t,[n]),e.contains(x)||e.appendChild(x),y.state.isMounted=!0,ue()}()}},hide:function(){var e=!y.state.isVisible,t=y.state.isDestroyed,n=!y.state.isEnabled,r=ot(y.props.duration,1,kt.duration);if(!(e||t||n)&&(P(`onHide`,[y],!1),!1!==y.props.onHide(y))){if(y.state.isVisible=!1,y.state.isShown=!1,m=!1,d=!1,O()&&(x.style.visibility=`hidden`),ee(),ne(),N(!0),O()){var i=j(),a=i.box,o=i.content;y.props.animation&&(vt([a,o],r),yt([a,o],`hidden`))}F(),I(),y.props.animation?O()&&function(e,t){re(e,(function(){!y.state.isVisible&&x.parentNode&&x.parentNode.contains(x)&&t()}))}(r,y.unmount):y.unmount()}},hideWithInteractivity:function(e){A().addEventListener(`mousemove`,g),dt(Bt,g),g(e)},enable:function(){y.state.isEnabled=!0},disable:function(){y.hide(),y.state.isEnabled=!1},unmount:function(){y.state.isVisible&&y.hide(),y.state.isMounted&&(de(),U().forEach((function(e){e._tippy.unmount()})),x.parentNode&&x.parentNode.removeChild(x),Vt=Vt.filter((function(e){return e!==y})),y.state.isMounted=!1,P(`onHidden`,[y]))},destroy:function(){y.state.isDestroyed||(y.clearDelayTimeouts(),y.unmount(),ae(),delete e._tippy,y.state.isDestroyed=!0,P(`onDestroy`,[y]))}};if(!u.render)return y;var b=u.render(y),x=b.popper,S=b.onUpdate;x.setAttribute(`data-tippy-root`,``),x.id=`tippy-`+y.id,y.popper=x,e._tippy=y,x._tippy=y;var C=v.map((function(e){return e.fn(y)})),w=e.hasAttribute(`aria-expanded`);return ie(),I(),N(),P(`onCreate`,[y]),u.showOnCreate&&fe(),x.addEventListener(`mouseenter`,(function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()})),x.addEventListener(`mouseleave`,(function(){y.props.interactive&&y.props.trigger.indexOf(`mouseenter`)>=0&&A().addEventListener(`mousemove`,g)})),y;function E(){var e=y.props.touch;return Array.isArray(e)?e:[e,0]}function D(){return E()[0]===`hold`}function O(){var e;return!((e=y.props.render)==null||!e.$$tippy)}function k(){return c||e}function A(){var e=k().parentNode;return e?bt(e):document}function j(){return Lt(x)}function M(e){return y.state.isMounted&&!y.state.isVisible||Ct.isTouch||a&&a.type===`focus`?0:ot(y.props.delay,e?0:1,kt.delay)}function N(e){e===void 0&&(e=!1),x.style.pointerEvents=y.props.interactive&&!e?``:`none`,x.style.zIndex=``+y.props.zIndex}function P(e,t,n){var r;(n===void 0&&(n=!0),C.forEach((function(n){n[e]&&n[e].apply(n,t)})),n)&&(r=y.props)[e].apply(r,t)}function F(){var t=y.props.aria;if(t.content){var n=`aria-`+t.content,r=x.id;ut(y.props.triggerTarget||e).forEach((function(e){var t=e.getAttribute(n);if(y.state.isVisible)e.setAttribute(n,t?t+` `+r:r);else{var i=t&&t.replace(r,``).trim();i?e.setAttribute(n,i):e.removeAttribute(n)}}))}}function I(){!w&&y.props.aria.expanded&&ut(y.props.triggerTarget||e).forEach((function(e){y.props.interactive?e.setAttribute(`aria-expanded`,y.state.isVisible&&e===k()?`true`:`false`):e.removeAttribute(`aria-expanded`)}))}function ee(){A().removeEventListener(`mousemove`,g),Bt=Bt.filter((function(e){return e!==g}))}function R(t){if(!Ct.isTouch||!p&&t.type!==`mousedown`){var n=t.composedPath&&t.composedPath()[0]||t.target;if(!y.props.interactive||!St(x,n)){if(ut(y.props.triggerTarget||e).some((function(e){return St(e,n)}))){if(Ct.isTouch||y.state.isVisible&&y.props.trigger.indexOf(`click`)>=0)return}else P(`onClickOutside`,[y,t]);!0===y.props.hideOnClick&&(y.clearDelayTimeouts(),y.hide(),f=!0,setTimeout((function(){f=!1})),y.state.isMounted||ne())}}}function z(){p=!0}function B(){p=!1}function te(){var e=A();e.addEventListener(`mousedown`,R,!0),e.addEventListener(`touchend`,R,it),e.addEventListener(`touchstart`,B,it),e.addEventListener(`touchmove`,z,it)}function ne(){var e=A();e.removeEventListener(`mousedown`,R,!0),e.removeEventListener(`touchend`,R,it),e.removeEventListener(`touchstart`,B,it),e.removeEventListener(`touchmove`,z,it)}function re(e,t){var n=j().box;function r(e){e.target===n&&(xt(n,`remove`,r),t())}if(e===0)return t();xt(n,`remove`,o),xt(n,`add`,r),o=r}function V(t,n,r){r===void 0&&(r=!1),ut(y.props.triggerTarget||e).forEach((function(e){e.addEventListener(t,n,r),h.push({node:e,eventType:t,handler:n,options:r})}))}function ie(){var e;D()&&(V(`touchstart`,oe,{passive:!0}),V(`touchend`,ce,{passive:!0})),(e=y.props.trigger,e.split(/\s+/).filter(Boolean)).forEach((function(e){if(e!==`manual`)switch(V(e,oe),e){case`mouseenter`:V(`mouseleave`,ce);break;case`focus`:V(Ot?`focusout`:`blur`,H);break;case`focusin`:V(`focusout`,H)}}))}function ae(){h.forEach((function(e){e.node.removeEventListener(e.eventType,e.handler,e.options)})),h=[]}function oe(e){var t=!1;if(y.state.isEnabled&&!le(e)&&!f){var n=a?.type===`focus`;a=e,c=e.currentTarget,I(),!y.state.isVisible&&gt(e)&&Bt.forEach((function(t){return t(e)})),e.type===`click`&&(0>y.props.trigger.indexOf(`mouseenter`)||d)&&!1!==y.props.hideOnClick&&y.state.isVisible?t=!0:fe(e),e.type===`click`&&(d=!t),t&&!n&&pe(e)}}function se(e){var t=e.target,n=k().contains(t)||x.contains(t);(e.type!==`mousemove`||!n)&&(function(e,t){var n=t.clientX,r=t.clientY;return e.every((function(e){var t=e.popperRect,i=e.popperState,a=e.props.interactiveBorder,o=i.placement.split(`-`)[0],s=i.modifiersData.offset;return!s||t.top-r+(o===`bottom`?s.top.y:0)>a||r-t.bottom-(o===`top`?s.bottom.y:0)>a||t.left-n+(o===`right`?s.left.x:0)>a||n-t.right-(o===`left`?s.right.x:0)>a}))})(U().concat(x).map((function(e){var t=e._tippy.popperInstance?.state;return t?{popperRect:e.getBoundingClientRect(),popperState:t,props:u}:null})).filter(Boolean),e)&&(ee(),pe(e))}function ce(e){le(e)||y.props.trigger.indexOf(`click`)>=0&&d||(y.props.interactive?y.hideWithInteractivity(e):pe(e))}function H(e){0>y.props.trigger.indexOf(`focusin`)&&e.target!==k()||y.props.interactive&&e.relatedTarget&&x.contains(e.relatedTarget)||pe(e)}function le(e){return!!Ct.isTouch&&D()!==e.type.indexOf(`touch`)>=0}function ue(){de();var t=y.props,n=t.popperOptions,r=t.placement,i=t.offset,a=t.getReferenceClientRect,o=t.moveTransition,c=O()?Lt(x).arrow:null,l=a?{getBoundingClientRect:a,contextElement:a.contextElement||k()}:e,u=[{name:`offset`,options:{offset:i}},{name:`preventOverflow`,options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:`flip`,options:{padding:5}},{name:`computeStyles`,options:{adaptive:!o}},{name:`$$tippy`,enabled:!0,phase:`beforeWrite`,requires:[`computeStyles`],fn:function(e){var t=e.state;if(O()){var n=j().box;[`placement`,`reference-hidden`,`escaped`].forEach((function(e){e===`placement`?n.setAttribute(`data-placement`,t.placement):t.attributes.popper[`data-popper-`+e]?n.setAttribute(`data-`+e,``):n.removeAttribute(`data-`+e)})),t.attributes.popper={}}}}];O()&&c&&u.push({name:`arrow`,options:{element:c,padding:3}}),u.push.apply(u,n?.modifiers||[]),y.popperInstance=$e(l,x,Object.assign({},n,{placement:r,onFirstUpdate:s,modifiers:u}))}function de(){y.popperInstance&&=(y.popperInstance.destroy(),null)}function U(){return ft(x.querySelectorAll(`[data-tippy-root]`))}function fe(e){y.clearDelayTimeouts(),e&&P(`onTrigger`,[y,e]),te();var t=M(!0),r=E(),i=r[1];Ct.isTouch&&r[0]===`hold`&&i&&(t=i),t?n=setTimeout((function(){y.show()}),t):y.show()}function pe(e){if(y.clearDelayTimeouts(),P(`onUntrigger`,[y,e]),y.state.isVisible){if(0>y.props.trigger.indexOf(`mouseenter`)||0>y.props.trigger.indexOf(`click`)||0>[`mouseleave`,`mousemove`].indexOf(e.type)||!d){var t=M(!1);t?r=setTimeout((function(){y.state.isVisible&&y.hide()}),t):i=requestAnimationFrame((function(){y.hide()}))}}else ne()}}function Ut(e,t){t===void 0&&(t={});var n=kt.plugins.concat(t.plugins||[]);document.addEventListener(`touchstart`,Tt,it),window.addEventListener(`blur`,Dt);var r=Object.assign({},t,{plugins:n}),i=_t(e).reduce((function(e,t){var n=t&&Ht(t,r);return n&&e.push(n),e}),[]);return ht(e)?i[0]:i}Ut.defaultProps=kt,Ut.setDefaultProps=function(e){Object.keys(e).forEach((function(t){kt[t]=e[t]}))},Ut.currentInput=Ct,Object.assign({},H,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:`0`,top:`0`,margin:`0`},arrow:{position:`absolute`},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});var Wt={clientX:0,clientY:0},Gt=[];function Kt(e){Wt={clientX:e.clientX,clientY:e.clientY}}var qt={name:`followCursor`,defaultValue:!1,fn:function(e){var t=e.reference,n=bt(e.props.triggerTarget||t),r=!1,i=!1,a=!0,o=e.props;function s(){return e.props.followCursor===`initial`&&e.state.isVisible}function c(){n.addEventListener(`mousemove`,d)}function l(){n.removeEventListener(`mousemove`,d)}function u(){r=!0,e.setProps({getReferenceClientRect:null}),r=!1}function d(n){var r=!n.target||t.contains(n.target),i=e.props.followCursor,a=n.clientX,o=n.clientY,s=t.getBoundingClientRect(),c=a-s.left,l=o-s.top;!r&&e.props.interactive||e.setProps({getReferenceClientRect:function(){var e=t.getBoundingClientRect(),n=a,r=o;i===`initial`&&(n=e.left+c,r=e.top+l);var s=i===`horizontal`?e.top:r,u=i===`vertical`?e.right:n,d=i===`horizontal`?e.bottom:r,f=i===`vertical`?e.left:n;return{width:u-f,height:d-s,top:s,right:u,bottom:d,left:f}}})}function f(){e.props.followCursor&&(Gt.push({instance:e,doc:n}),function(e){e.addEventListener(`mousemove`,Kt)}(n))}function p(){(Gt=Gt.filter((function(t){return t.instance!==e}))).filter((function(e){return e.doc===n})).length===0&&function(e){e.removeEventListener(`mousemove`,Kt)}(n)}return{onCreate:f,onDestroy:p,onBeforeUpdate:function(){o=e.props},onAfterUpdate:function(t,n){var a=n.followCursor;r||a!==void 0&&o.followCursor!==a&&(p(),a?(f(),!e.state.isMounted||i||s()||c()):(l(),u()))},onMount:function(){e.props.followCursor&&!i&&(a&&=(d(Wt),!1),s()||c())},onTrigger:function(e,t){gt(t)&&(Wt={clientX:t.clientX,clientY:t.clientY}),i=t.type===`focus`},onHidden:function(){e.props.followCursor&&(u(),l(),a=!0)}}}};Ut.setDefaultProps({render:Rt});var Jt,Yt,Xt,Zt,Qt,$t,en={showTotalDistance:!1,showDashDistance:!0,showWhen:[`normal`,`active`],format:function(e){return 1e3>e?+e.toFixed(2)+`m`:+(e/1e3).toFixed(2)+`km`}},tn={showWhen:[`normal`,`active`],format:function(e){return e>1e6?`${+(e/1e6).toFixed(2)}km²`:`${+e.toFixed(2)}m²`}},nn={maxSize:100},rn={remove:[`del`,`backspace`],revert:[`command+z`,`ctrl+z`],redo:[`command+shift+z`,`ctrl+shift+z`]},an={allowHTML:!0,followCursor:!0,placement:`bottom-start`,offset:[-10,20],plugins:[qt],trigger:`manual`,hideOnClick:!1,theme:`light`},on={data:`drawData`,pointAdsorbPixel:12,lineAdsorbPixel:10},sn={dotDuration:100,dotDistance:30};function cn(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);t>n;n++)r[n]=e[n];return r}function ln(e,t,n){return t=hn(t),function(e,t){if(t&&(typeof t==`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return function(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}(e)}(e,_n()?Reflect.construct(t,n||[],hn(e).constructor):t.apply(e,n))}function un(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function dn(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,Cn(r.key),r)}}function fn(e,t,n){return t&&dn(e.prototype,t),n&&dn(e,n),Object.defineProperty(e,`prototype`,{writable:!1}),e}function pn(e,t,n){return(t=Cn(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mn(){return mn=typeof Reflect<`u`&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&(e=hn(e))!==null;);return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(3>arguments.length?e:n):i.value}},mn.apply(null,arguments)}function hn(e){return hn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},hn(e)}function gn(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&bn(e,t)}function _n(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(_n=function(){return!!e})()}function vn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yn(e){for(var t=1;arguments.length>t;t++){var n=arguments[t]==null?{}:arguments[t];t%2?vn(Object(n),!0).forEach((function(t){pn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function bn(e,t){return bn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},bn(e,t)}function xn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,t)||Tn(e,t)||function(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Sn(e){return function(e){if(Array.isArray(e))return cn(e)}(e)||function(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}(e)||Tn(e)||function(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Cn(e){var t=function(e,t){if(typeof e!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(typeof r!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}(e,`string`);return typeof t==`symbol`?t:t+``}function wn(e){return wn=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},wn(e)}function Tn(e,t){if(e){if(typeof e==`string`)return cn(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cn(e,t):void 0}}(Jt=e.DrawEvent||={}).Init=`init`,Jt.Destroy=`destroy`,Jt.Enable=`enable`,Jt.Disable=`disable`,Jt.Add=`add`,Jt.Edit=`edit`,Jt.Remove=`remove`,Jt.Clear=`clear`,Jt.Change=`change`,Jt.DragStart=`dragStart`,Jt.Dragging=`dragging`,Jt.DragEnd=`dragEnd`,Jt.Select=`select`,Jt.AddNode=`addNode`,Jt.RemoveNode=`removeNode`,(Yt=e.SourceEvent||={}).Change=`change`,Yt.Update=`update`,(Xt=e.RenderEvent||={}).Click=`click`,Xt.UnClick=`unclick`,Xt.Dragstart=`dragstart`,Xt.Mousemove=`mousemove`,Xt.Mouseout=`mouseout`,Xt.Dragging=`dragging`,Xt.Dragend=`dragend`,Xt.DblClick=`dblClick`,Xt.Contextmenu=`contextmenu`,(Zt=e.LayerEvent||={}).Mousedown=`mousedown`,Zt.Mouseup=`mouseup`,Zt.Click=`click`,Zt.UnClick=`unclick`,Zt.Dblclick=`dblclick`,Zt.Mousemove=`mousemove`,Zt.Mouseover=`mouseover`,Zt.Mouseenter=`mouseenter`,Zt.Mouseleave=`mouseleave`,Zt.Mouseout=`mouseout`,Zt.Contextmenu=`contextmenu`,(Qt=e.SceneEvent||={}).Loaded=`loaded`,Qt.MapMove=`mapmove`,Qt.MoveStart=`movestart`,Qt.MoveEnd=`moveend`,Qt.ZoomChange=`zoomchange`,Qt.ZoomStart=`zoomstart`,Qt.ZoomEnd=`zoomend`,Qt.Click=`click`,Qt.Dblclick=`dblclick`,Qt.Mousemove=`mousemove`,Qt.Mousewheel=`mousewheel`,Qt.Mouseover=`mouseover`,Qt.Mouseout=`mouseout`,Qt.Mouseup=`mouseup`,Qt.Mousedown=`mousedown`,Qt.Contextmenu=`contextmenu`,Qt.Dragstart=`dragstart`,Qt.Dragging=`dragging`,Qt.Dragend=`dragend`,($t=e.ControlEvent||={}).DrawChange=`drawchange`,$t.DataChange=`datachange`,$t.DrawSelect=`drawselect`,$t.DrawClear=`drawclear`;var En=6371008.8,Dn={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*En,kilometers:6371.0088,kilometres:6371.0088,meters:En,metres:En,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:En/1852,radians:1,yards:6967335.223679999},On={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function kn(e,t,n){n===void 0&&(n={});var r={type:`Feature`};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function An(e,t,n){if(n===void 0&&(n={}),!e)throw Error(`coordinates is required`);if(!Array.isArray(e))throw Error(`coordinates must be an Array`);if(2>e.length)throw Error(`coordinates must be at least 2 numbers long`);if(!Vn(e[0])||!Vn(e[1]))throw Error(`coordinates must contain numbers`);return kn({type:`Point`,coordinates:e},t,n)}function jn(e,t,n){n===void 0&&(n={});for(var r=0,i=e;i.length>r;r++){var a=i[r];if(4>a.length)throw Error(`Each LinearRing of a Polygon must have 4 or more Positions.`);for(var o=0;a[a.length-1].length>o;o++)if(a[a.length-1][o]!==a[0][o])throw Error(`First and last Position are not equivalent.`)}return kn({type:`Polygon`,coordinates:e},t,n)}function Mn(e,t,n){if(n===void 0&&(n={}),2>e.length)throw Error(`coordinates must be an array of two or more positions`);return kn({type:`LineString`,coordinates:e},t,n)}function Nn(e,t){t===void 0&&(t={});var n={type:`FeatureCollection`};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function Pn(e,t,n){return n===void 0&&(n={}),kn({type:`MultiLineString`,coordinates:e},t,n)}function Fn(e,t,n){return n===void 0&&(n={}),kn({type:`MultiPoint`,coordinates:e},t,n)}function In(e,t,n){return n===void 0&&(n={}),kn({type:`MultiPolygon`,coordinates:e},t,n)}function Ln(e,t){t===void 0&&(t=`kilometers`);var n=Dn[t];if(!n)throw Error(t+` units is invalid`);return e*n}function Rn(e,t){t===void 0&&(t=`kilometers`);var n=Dn[t];if(!n)throw Error(t+` units is invalid`);return e/n}function zn(e){return 180*(e%(2*Math.PI))/Math.PI}function Bn(e){return e%360*Math.PI/180}function Vn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Hn(e){return!!e&&e.constructor===Object}var Un=Object.freeze({__proto__:null,earthRadius:En,factors:Dn,unitsFactors:{centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/En,yards:1.0936133},areaFactors:On,feature:kn,geometry:function(e,t,n){switch(e){case`Point`:return An(t).geometry;case`LineString`:return Mn(t).geometry;case`Polygon`:return jn(t).geometry;case`MultiPoint`:return Fn(t).geometry;case`MultiLineString`:return Pn(t).geometry;case`MultiPolygon`:return In(t).geometry;default:throw Error(e+` is invalid`)}},point:An,points:function(e,t,n){return n===void 0&&(n={}),Nn(e.map((function(e){return An(e,t)})),n)},polygon:jn,polygons:function(e,t,n){return n===void 0&&(n={}),Nn(e.map((function(e){return jn(e,t)})),n)},lineString:Mn,lineStrings:function(e,t,n){return n===void 0&&(n={}),Nn(e.map((function(e){return Mn(e,t)})),n)},featureCollection:Nn,multiLineString:Pn,multiPoint:Fn,multiPolygon:In,geometryCollection:function(e,t,n){return n===void 0&&(n={}),kn({type:`GeometryCollection`,geometries:e},t,n)},round:function(e,t){if(t===void 0&&(t=0),t&&t<0)throw Error(`precision must be a positive number`);var n=10**(t||0);return Math.round(e*n)/n},radiansToLength:Ln,lengthToRadians:Rn,lengthToDegrees:function(e,t){return zn(Rn(e,t))},bearingToAzimuth:function(e){var t=e%360;return 0>t&&(t+=360),t},radiansToDegrees:zn,degreesToRadians:Bn,convertLength:function(e,t,n){if(t===void 0&&(t=`kilometers`),n===void 0&&(n=`kilometers`),e<0)throw Error(`length must be a positive number`);return Ln(Rn(e,t),n)},convertArea:function(e,t,n){if(t===void 0&&(t=`meters`),n===void 0&&(n=`kilometers`),e<0)throw Error(`area must be a positive number`);var r=On[t];if(!r)throw Error(`invalid original units`);var i=On[n];if(!i)throw Error(`invalid final units`);return e/r*i},isNumber:Vn,isObject:Hn,validateBBox:function(e){if(!e)throw Error(`bbox is required`);if(!Array.isArray(e))throw Error(`bbox must be an Array`);if(e.length!==4&&e.length!==6)throw Error(`bbox must be an Array of 4 or 6 numbers`);e.forEach((function(e){if(!Vn(e))throw Error(`bbox must only contain numbers`)}))},validateId:function(e){if(!e)throw Error(`id is required`);if([`string`,`number`].indexOf(typeof e)===-1)throw Error(`id must be a number or a string`)}});function Wn(e,t,n){if(e!==null)for(var r,i,a,o,s,c,l,u,d=0,f=0,p=e.type,m=p===`FeatureCollection`,h=p===`Feature`,g=m?e.features.length:1,_=0;g>_;_++){s=(u=!!(l=m?e.features[_].geometry:h?e.geometry:e)&&l.type===`GeometryCollection`)?l.geometries.length:1;for(var v=0;s>v;v++){var y=0,b=0;if((o=u?l.geometries[v]:l)!==null){c=o.coordinates;var x=o.type;switch(d=!n||x!==`Polygon`&&x!==`MultiPolygon`?0:1,x){case null:break;case`Point`:if(!1===t(c,f,_,y,b))return!1;f++,y++;break;case`LineString`:case`MultiPoint`:for(r=0;c.length>r;r++){if(!1===t(c[r],f,_,y,b))return!1;f++,x===`MultiPoint`&&y++}x===`LineString`&&y++;break;case`Polygon`:case`MultiLineString`:for(r=0;c.length>r;r++){for(i=0;c[r].length-d>i;i++){if(!1===t(c[r][i],f,_,y,b))return!1;f++}x===`MultiLineString`&&y++,x===`Polygon`&&b++}x===`Polygon`&&y++;break;case`MultiPolygon`:for(r=0;c.length>r;r++){for(b=0,i=0;c[r].length>i;i++){for(a=0;c[r][i].length-d>a;a++){if(!1===t(c[r][i][a],f,_,y,b))return!1;f++}b++}y++}break;case`GeometryCollection`:for(r=0;o.geometries.length>r;r++)if(!1===Wn(o.geometries[r],t,n))return!1;break;default:throw Error(`Unknown Geometry Type`)}}}}}function Gn(e,t){var n;switch(e.type){case`FeatureCollection`:for(n=0;e.features.length>n&&!1!==t(e.features[n].properties,n);n++);break;case`Feature`:t(e.properties,0)}}function Kn(e,t){if(e.type===`Feature`)t(e,0);else if(e.type===`FeatureCollection`)for(var n=0;e.features.length>n&&!1!==t(e.features[n],n);n++);}function qn(e){var t=[];return Wn(e,(function(e){t.push(e)})),t}function Jn(e,t){var n,r,i,a,o,s,c,l,u,d,f=0,p=e.type===`FeatureCollection`,m=e.type===`Feature`,h=p?e.features.length:1;for(n=0;h>n;n++){for(l=p?e.features[n].properties:m?e.properties:{},u=p?e.features[n].bbox:m?e.bbox:void 0,d=p?e.features[n].id:m?e.id:void 0,o=(c=!!(s=p?e.features[n].geometry:m?e.geometry:e)&&s.type===`GeometryCollection`)?s.geometries.length:1,i=0;o>i;i++)if((a=c?s.geometries[i]:s)!==null)switch(a.type){case`Point`:case`LineString`:case`MultiPoint`:case`Polygon`:case`MultiLineString`:case`MultiPolygon`:if(!1===t(a,f,l,u,d))return!1;break;case`GeometryCollection`:for(r=0;a.geometries.length>r;r++)if(!1===t(a.geometries[r],f,l,u,d))return!1;break;default:throw Error(`Unknown Geometry Type`)}else if(!1===t(null,f,l,u,d))return!1;f++}}function Yn(e,t,n){var r=n;return Jn(e,(function(e,i,a,o,s){r=i===0&&n===void 0?e:t(r,e,i,a,o,s)})),r}function Xn(e,t){Jn(e,(function(e,n,r,i,a){var o,s=e===null?null:e.type;switch(s){case null:case`Point`:case`LineString`:case`Polygon`:return!1!==t(kn(e,r,{bbox:i,id:a}),n,0)&&void 0}switch(s){case`MultiPoint`:o=`Point`;break;case`MultiLineString`:o=`LineString`;break;case`MultiPolygon`:o=`Polygon`}for(var c=0;e.coordinates.length>c;c++)if(!1===t(kn({type:o,coordinates:e.coordinates[c]},r),n,c))return!1}))}function Zn(e,t){Xn(e,(function(e,n,r){var i=0;if(e.geometry){var a=e.geometry.type;if(a!==`Point`&&a!==`MultiPoint`){var o,s=0,c=0,l=0;return!1!==Wn(e,(function(a,u,d,f,p){if(o===void 0||n>s||f>c||p>l)return o=a,s=n,c=f,l=p,void(i=0);if(!1===t(Mn([o,a],e.properties),n,r,p,i))return!1;i++,o=a}))&&void 0}}}))}function Qn(e,t,n){var r=n,i=!1;return Zn(e,(function(e,a,o,s,c){r=!1===i&&n===void 0?e:t(r,e,a,o,s,c),i=!0})),r}function $n(e,t){if(!e)throw Error(`geojson is required`);Xn(e,(function(e,n,r){if(e.geometry!==null){var i=e.geometry.coordinates;switch(e.geometry.type){case`LineString`:if(!1===t(e,n,r,0,0))return!1;break;case`Polygon`:for(var a=0;i.length>a;a++)if(!1===t(Mn(i[a],e.properties),n,r,a))return!1}}}))}var er=Object.freeze({__proto__:null,coordAll:qn,coordEach:Wn,coordReduce:function(e,t,n,r){var i=n;return Wn(e,(function(e,r,a,o,s){i=r===0&&n===void 0?e:t(i,e,r,a,o,s)}),r),i},featureEach:Kn,featureReduce:function(e,t,n){var r=n;return Kn(e,(function(e,i){r=i===0&&n===void 0?e:t(r,e,i)})),r},findPoint:function(e,t){if(!Hn(t||={}))throw Error(`options is invalid`);var n,r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,o=t.coordIndex||0,s=t.properties;switch(e.type){case`FeatureCollection`:0>r&&(r=e.features.length+r),s||=e.features[r].properties,n=e.features[r].geometry;break;case`Feature`:s||=e.properties,n=e.geometry;break;case`Point`:case`MultiPoint`:return null;case`LineString`:case`Polygon`:case`MultiLineString`:case`MultiPolygon`:n=e;break;default:throw Error(`geojson is invalid`)}if(n===null)return null;var c=n.coordinates;switch(n.type){case`Point`:return An(c,s,t);case`MultiPoint`:return 0>i&&(i=c.length+i),An(c[i],s,t);case`LineString`:return 0>o&&(o=c.length+o),An(c[o],s,t);case`Polygon`:return 0>a&&(a=c.length+a),0>o&&(o=c[a].length+o),An(c[a][o],s,t);case`MultiLineString`:return 0>i&&(i=c.length+i),0>o&&(o=c[i].length+o),An(c[i][o],s,t);case`MultiPolygon`:return 0>i&&(i=c.length+i),0>a&&(a=c[i].length+a),0>o&&(o=c[i][a].length-o),An(c[i][a][o],s,t)}throw Error(`geojson is invalid`)},findSegment:function(e,t){if(!Hn(t||={}))throw Error(`options is invalid`);var n,r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,o=t.segmentIndex||0,s=t.properties;switch(e.type){case`FeatureCollection`:0>r&&(r=e.features.length+r),s||=e.features[r].properties,n=e.features[r].geometry;break;case`Feature`:s||=e.properties,n=e.geometry;break;case`Point`:case`MultiPoint`:return null;case`LineString`:case`Polygon`:case`MultiLineString`:case`MultiPolygon`:n=e;break;default:throw Error(`geojson is invalid`)}if(n===null)return null;var c=n.coordinates;switch(n.type){case`Point`:case`MultiPoint`:return null;case`LineString`:return 0>o&&(o=c.length+o-1),Mn([c[o],c[o+1]],s,t);case`Polygon`:return 0>a&&(a=c.length+a),0>o&&(o=c[a].length+o-1),Mn([c[a][o],c[a][o+1]],s,t);case`MultiLineString`:return 0>i&&(i=c.length+i),0>o&&(o=c[i].length+o-1),Mn([c[i][o],c[i][o+1]],s,t);case`MultiPolygon`:return 0>i&&(i=c.length+i),0>a&&(a=c[i].length+a),0>o&&(o=c[i][a].length-o-1),Mn([c[i][a][o],c[i][a][o+1]],s,t)}throw Error(`geojson is invalid`)},flattenEach:Xn,flattenReduce:function(e,t,n){var r=n;return Xn(e,(function(e,i,a){r=i===0&&a===0&&n===void 0?e:t(r,e,i,a)})),r},geomEach:Jn,geomReduce:Yn,lineEach:$n,lineReduce:function(e,t,n){var r=n;return $n(e,(function(e,i,a,o){r=i===0&&n===void 0?e:t(r,e,i,a,o)})),r},propEach:Gn,propReduce:function(e,t,n){var r=n;return Gn(e,(function(e,i){r=i===0&&n===void 0?e:t(r,e,i)})),r},segmentEach:Zn,segmentReduce:Qn});function tr(e){var t=[1/0,1/0,-1/0,-1/0];return Wn(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),e[0]>t[2]&&(t[2]=e[0]),e[1]>t[3]&&(t[3]=e[1])})),t}function nr(e){if(!e)throw Error(`coord is required`);if(!Array.isArray(e)){if(e.type===`Feature`&&e.geometry!==null&&e.geometry.type===`Point`)return e.geometry.coordinates;if(e.type===`Point`)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw Error(`coord must be GeoJSON Point or an Array of numbers`)}function rr(e){if(Array.isArray(e))return e;if(e.type===`Feature`){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw Error(`coords must be GeoJSON Feature, Geometry Object or an Array`)}function ir(e){return e.type===`Feature`?e.geometry:e}function ar(e,t){return e.type===`FeatureCollection`?`FeatureCollection`:e.type===`GeometryCollection`?`GeometryCollection`:e.type===`Feature`&&e.geometry!==null?e.geometry.type:e.type}function or(e,t,n,r,i){sr(e,t,n||0,r||e.length-1,i||lr)}function sr(e,t,n,r,i){for(;r>n;){if(r-n>600){var a=r-n+1,o=t-n+1,s=Math.log(a),c=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*c*(a-c)/a)*(0>o-a/2?-1:1);sr(e,t,Math.max(n,Math.floor(t-o*c/a+l)),Math.min(r,Math.floor(t+(a-o)*c/a+l)),i)}var u=e[t],d=n,f=r;for(cr(e,n,t),i(e[r],u)>0&&cr(e,n,r);f>d;){for(cr(e,d,f),d++,f--;0>i(e[d],u);)d++;for(;i(e[f],u)>0;)f--}i(e[n],u)===0?cr(e,n,f):cr(e,++f,r),f>t||(n=f+1),t>f||(r=f-1)}}function cr(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function lr(e,t){return t>e?-1:e>t?1:0}tr.default=tr;function ur(e,t,n){if(!n)return t.indexOf(e);for(let r=0;t.length>r;r++)if(n(e,t[r]))return r;return-1}function dr(e,t){fr(e,0,e.children.length,t,e)}function fr(e,t,n,r,i){i||=xr(null),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let a=t;n>a;a++){let t=e.children[a];pr(i,e.leaf?r(t):t)}return i}function pr(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function mr(e,t){return e.minX-t.minX}function hr(e,t){return e.minY-t.minY}function gr(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function _r(e){return e.maxX-e.minX+(e.maxY-e.minY)}function vr(e,t){let n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,a-r)}function yr(e,t){return!(e.minX>t.minX||e.minY>t.minY||t.maxX>e.maxX||t.maxY>e.maxY)}function br(e,t){return!(t.minX>e.maxX||t.minY>e.maxY||e.minX>t.maxX||e.minY>t.maxY)}function xr(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Sr(e,t,n,r,i){let a=[t,n];for(;a.length;){if(r>=(n=a.pop())-(t=a.pop()))continue;let o=t+Math.ceil((n-t)/r/2)*r;or(e,o,t,n,i),a.push(t,o,o,n)}}var Cr=Object.freeze({__proto__:null,default:class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data,n=[];if(!br(e,t))return n;let r=this.toBBox,i=[];for(;t;){for(let a=0;t.children.length>a;a++){let o=t.children[a],s=t.leaf?r(o):o;br(e,s)&&(t.leaf?n.push(o):yr(e,s)?this._all(o,n):i.push(o))}t=i.pop()}return n}collides(e){let t=this.data;if(!br(e,t))return!1;let n=[];for(;t;){for(let r=0;t.children.length>r;r++){let i=t.children[r],a=t.leaf?this.toBBox(i):i;if(br(e,a)){if(t.leaf||yr(e,a))return!0;n.push(i)}}t=n.pop()}return!1}load(e){if(!e||!e.length)return this;if(this._minEntries>e.length){for(let t=0;e.length>t;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(t.height>this.data.height){let e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=xr([]),this}remove(e,t){if(!e)return this;let n=this.data,r=this.toBBox(e),i=[],a=[],o,s,c;for(;n||i.length;){if(n||(n=i.pop(),s=i[i.length-1],o=a.pop(),c=!0),n.leaf){let r=ur(e,n.children,t);if(r!==-1)return n.children.splice(r,1),i.push(n),this._condense(i),this}c||n.leaf||!yr(n,r)?s?(o++,n=s.children[o],c=!1):n=null:(i.push(n),a.push(o),o=0,s=n,n=n.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,r){let i=n-t+1,a,o=this._maxEntries;if(o>=i)return a=xr(e.slice(t,n+1)),dr(a,this.toBBox),a;r||(o=Math.ceil(i/o**((r=Math.ceil(Math.log(i)/Math.log(o)))-1))),a=xr([]),a.leaf=!1,a.height=r;let s=Math.ceil(i/o),c=s*Math.ceil(Math.sqrt(o));Sr(e,t,n,c,this.compareMinX);for(let i=t;n>=i;i+=c){let t=Math.min(i+c-1,n);Sr(e,i,t,s,this.compareMinY);for(let n=i;t>=n;n+=s)a.children.push(this._build(e,n,Math.min(n+s-1,t),r-1))}return dr(a,this.toBBox),a}_chooseSubtree(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){let n,r=1/0,o=1/0;for(let s=0;t.children.length>s;s++){let c=t.children[s],l=gr(c),u=(Math.max((a=c).maxX,(i=e).maxX)-Math.min(a.minX,i.minX))*(Math.max(a.maxY,i.maxY)-Math.min(a.minY,i.minY))-l;o>u?(o=u,r=r>l?l:r,n=c):u===o&&r>l&&(r=l,n=c)}t=n||t.children[0]}var i,a;return t}_insert(e,t,n){let r=n?e:this.toBBox(e),i=[],a=this._chooseSubtree(r,this.data,t,i);for(a.children.push(e),pr(a,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)}_split(e,t){let n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);let a=this._chooseSplitIndex(n,i,r),o=xr(n.children.splice(a,n.children.length-a));o.height=n.height,o.leaf=n.leaf,dr(n,this.toBBox),dr(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(n,o)}_splitRoot(e,t){this.data=xr([e,t]),this.data.height=e.height+1,this.data.leaf=!1,dr(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let r,i=1/0,a=1/0;for(let o=t;n-t>=o;o++){let t=fr(e,0,o,this.toBBox),s=fr(e,o,n,this.toBBox),c=vr(t,s),l=gr(t)+gr(s);i>c?(i=c,r=o,a=a>l?l:a):c===i&&a>l&&(a=l,r=o)}return r||n-t}_chooseSplitAxis(e,t,n){let r=e.leaf?this.compareMinX:mr,i=e.leaf?this.compareMinY:hr,a=this._allDistMargin(e,t,n,r);this._allDistMargin(e,t,n,i)>a&&e.children.sort(r)}_allDistMargin(e,t,n,r){e.children.sort(r);let i=this.toBBox,a=fr(e,0,t,i),o=fr(e,n-t,n,i),s=_r(a)+_r(o);for(let r=t;n-t>r;r++){let t=e.children[r];pr(a,e.leaf?i(t):t),s+=_r(a)}for(let r=n-t-1;r>=t;r--){let t=e.children[r];pr(o,e.leaf?i(t):t),s+=_r(o)}return s}_adjustParentBBoxes(e,t,n){for(let r=n;r>=0;r--)pr(t[r],e)}_condense(e){for(let t,n=e.length-1;n>=0;n--)e[n].children.length===0?n>0?(t=e[n-1].children,t.splice(t.indexOf(e[n]),1)):this.clear():dr(e[n],this.toBBox)}}});function wr(e,t){return t>e?-1:e>t?1:0}var Tr=Object.freeze({__proto__:null,default:class{constructor(e=[],t=wr){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:n}=this,r=t[e];for(;e>0;){let i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r}_down(e){let{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;r>e;){let r=1+(e<<1),a=t[r],o=r+1;if(this.length>o&&0>n(t[o],a)&&(r=o,a=t[o]),n(a,i)>=0)break;t[e]=a,e=r}t[e]=i}}}),Er=function(e,t,n,r){var i=e[0],a=e[1],o=!1;n===void 0&&(n=0),r===void 0&&(r=t.length);for(var s=(r-n)/2,c=0,l=s-1;s>c;l=c++){var u=t[n+2*c+0],d=t[n+2*c+1],f=t[n+2*l+1];d>a!=f>a&&(t[n+2*l+0]-u)*(a-d)/(f-d)+u>i&&(o=!o)}return o},Dr=function(e,t,n,r){var i=e[0],a=e[1],o=!1;n===void 0&&(n=0),r===void 0&&(r=t.length);for(var s=r-n,c=0,l=s-1;s>c;l=c++){var u=t[c+n][0],d=t[c+n][1],f=t[l+n][1];d>a!=f>a&&(t[l+n][0]-u)*(a-d)/(f-d)+u>i&&(o=!o)}return o},Or=function(e,t,n,r){return t.length>0&&Array.isArray(t[0])?Dr(e,t,n,r):Er(e,t,n,r)},kr=Er;Or.nested=Dr,Or.flat=kr;var Ar=typeof globalThis<`u`?globalThis:typeof window<`u`?window:typeof global<`u`?global:typeof self<`u`?self:{};function jr(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw Error(`Dynamic requires are not currently supported by @rollup/plugin-commonjs`)}()}},n.exports),n.exports}function Mr(e){if(e.__esModule)return e;var t=Object.defineProperty({},`__esModule`,{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var Nr=jr((function(e,t){(function(e){let t=134217729;function n(e,t,n,r,i){let a,o,s,c,l=t[0],u=r[0],d=0,f=0;u>l==u>-l?(a=l,l=t[++d]):(a=u,u=r[++f]);let p=0;if(e>d&&n>f)for(u>l==u>-l?(s=a-((o=l+a)-l),l=t[++d]):(s=a-((o=u+a)-u),u=r[++f]),a=o,s!==0&&(i[p++]=s);e>d&&n>f;)u>l==u>-l?(s=a-((o=a+l)-(c=o-a))+(l-c),l=t[++d]):(s=a-((o=a+u)-(c=o-a))+(u-c),u=r[++f]),a=o,s!==0&&(i[p++]=s);for(;e>d;)s=a-((o=a+l)-(c=o-a))+(l-c),l=t[++d],a=o,s!==0&&(i[p++]=s);for(;n>f;)s=a-((o=a+u)-(c=o-a))+(u-c),u=r[++f],a=o,s!==0&&(i[p++]=s);return a===0&&p!==0||(i[p++]=a),p}function r(e){return new Float64Array(e)}let i=r(4),a=r(8),o=r(12),s=r(16),c=r(4);e.orient2d=function(e,r,l,u,d,f){let p=(r-f)*(l-d),m=(e-d)*(u-f),h=p-m;if(p===0||m===0||p>0!=m>0)return h;let g=Math.abs(p+m);return 33306690738754716e-32*g>Math.abs(h)?-function(e,r,l,u,d,f,p){let m,h,g,_,v,y,b,x,S,C,w,E,D,O,k,A,j,M,N=e-d,P=l-d,F=r-f,I=u-f;v=(k=(x=N-(b=(y=t*N)-(y-N)))*(C=I-(S=(y=t*I)-(y-I)))-((O=N*I)-b*S-x*S-b*C))-(w=k-(j=(x=F-(b=(y=t*F)-(y-F)))*(C=P-(S=(y=t*P)-(y-P)))-((A=F*P)-b*S-x*S-b*C))),i[0]=k-(w+v)+(v-j),v=(D=O-((E=O+w)-(v=E-O))+(w-v))-(w=D-A),i[1]=D-(w+v)+(v-A),v=(M=E+w)-E,i[2]=E-(M-v)+(w-v),i[3]=M;let ee=function(e,t){let n=t[0];for(let r=1;e>r;r++)n+=t[r];return n}(4,i),R=22204460492503146e-32*p;if(ee>=R||-ee>=R||(m=e-(N+(v=e-N))+(v-d),g=l-(P+(v=l-P))+(v-d),h=r-(F+(v=r-F))+(v-f),_=u-(I+(v=u-I))+(v-f),m===0&&h===0&&g===0&&_===0)||(R=11093356479670487e-47*p+33306690738754706e-32*Math.abs(ee),(ee+=N*_+I*m-(F*g+P*h))>=R||-ee>=R))return ee;v=(k=(x=m-(b=(y=t*m)-(y-m)))*(C=I-(S=(y=t*I)-(y-I)))-((O=m*I)-b*S-x*S-b*C))-(w=k-(j=(x=h-(b=(y=t*h)-(y-h)))*(C=P-(S=(y=t*P)-(y-P)))-((A=h*P)-b*S-x*S-b*C))),c[0]=k-(w+v)+(v-j),v=(D=O-((E=O+w)-(v=E-O))+(w-v))-(w=D-A),c[1]=D-(w+v)+(v-A),v=(M=E+w)-E,c[2]=E-(M-v)+(w-v),c[3]=M;let z=n(4,i,4,c,a);v=(k=(x=N-(b=(y=t*N)-(y-N)))*(C=_-(S=(y=t*_)-(y-_)))-((O=N*_)-b*S-x*S-b*C))-(w=k-(j=(x=F-(b=(y=t*F)-(y-F)))*(C=g-(S=(y=t*g)-(y-g)))-((A=F*g)-b*S-x*S-b*C))),c[0]=k-(w+v)+(v-j),v=(D=O-((E=O+w)-(v=E-O))+(w-v))-(w=D-A),c[1]=D-(w+v)+(v-A),v=(M=E+w)-E,c[2]=E-(M-v)+(w-v),c[3]=M;let B=n(z,a,4,c,o);return v=(k=(x=m-(b=(y=t*m)-(y-m)))*(C=_-(S=(y=t*_)-(y-_)))-((O=m*_)-b*S-x*S-b*C))-(w=k-(j=(x=h-(b=(y=t*h)-(y-h)))*(C=g-(S=(y=t*g)-(y-g)))-((A=h*g)-b*S-x*S-b*C))),c[0]=k-(w+v)+(v-j),v=(D=O-((E=O+w)-(v=E-O))+(w-v))-(w=D-A),c[1]=D-(w+v)+(v-A),v=(M=E+w)-E,c[2]=E-(M-v)+(w-v),c[3]=M,s[n(B,o,4,c,s)-1]}(e,r,l,u,d,f,g):h},e.orient2dfast=function(e,t,n,r,i,a){return(t-a)*(n-i)-(e-i)*(r-a)},Object.defineProperty(e,`__esModule`,{value:!0})})(t)})),Pr=Mr(Cr),Fr=Mr(Tr),Ir=Nr.orient2d;Fr.default&&(Fr=Fr.default);var Lr=Rr;function Rr(e,t,n){t=Math.max(0,t===void 0?2:t),n||=0;var r=function(e){for(var t=e[0],n=e[0],r=e[0],i=e[0],a=0;e.length>a;a++){var o=e[a];t[0]>o[0]&&(t=o),o[0]>r[0]&&(r=o),n[1]>o[1]&&(n=o),o[1]>i[1]&&(i=o)}var s=[t,n,r,i],c=s.slice();for(a=0;e.length>a;a++)Or(e[a],s)||c.push(e[a]);return function(e){e.sort(Xr);for(var t=[],n=0;e.length>n;n++){for(;t.length>=2&&0>=Wr(t[t.length-2],t[t.length-1],e[n]);)t.pop();t.push(e[n])}for(var r=[],i=e.length-1;i>=0;i--){for(;r.length>=2&&0>=Wr(r[r.length-2],r[r.length-1],e[i]);)r.pop();r.push(e[i])}return r.pop(),t.pop(),t.concat(r)}(c)}(e),i=new Pr(16);i.toBBox=function(e){return{minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]}},i.compareMinX=function(e,t){return e[0]-t[0]},i.compareMinY=function(e,t){return e[1]-t[1]},i.load(e);for(var a,o=[],s=0;r.length>s;s++){var c=r[s];i.remove(c),a=Kr(c,a),o.push(a)}var l=new Pr(16);for(s=0;o.length>s;s++)l.insert(Gr(o[s]));for(var u=t*t,d=n*n;o.length;){var f=o.shift(),p=f.p,m=f.next.p,h=qr(p,m);if(h>=d){var g=h/u;(c=zr(i,f.prev.p,p,m,f.next.next.p,g,l))&&Math.min(qr(c,p),qr(c,m))<=g&&(o.push(f),o.push(Kr(c,f)),i.remove(c),l.remove(f),l.insert(Gr(f)),l.insert(Gr(f.next)))}}f=a;var _=[];do _.push(f.p),f=f.next;while(f!==a);return _.push(f.p),_}function zr(e,t,n,r,i,a,o){for(var s=new Fr([],Br),c=e.data;c;){for(var l=0;c.children.length>l;l++){var u=c.children[l],d=c.leaf?Jr(u,n,r):Vr(n,r,u);a<d||s.push({node:u,dist:d})}for(;s.length&&!s.peek().node.children;){var f=s.pop(),p=f.node,m=Jr(p,t,n),h=Jr(p,r,i);if(m>f.dist&&h>f.dist&&Ur(n,p,o)&&Ur(r,p,o))return p}(c=s.pop())&&(c=c.node)}return null}function Br(e,t){return e.dist-t.dist}function Vr(e,t,n){if(Hr(e,n)||Hr(t,n))return 0;var r=Yr(e[0],e[1],t[0],t[1],n.minX,n.minY,n.maxX,n.minY);if(r===0)return 0;var i=Yr(e[0],e[1],t[0],t[1],n.minX,n.minY,n.minX,n.maxY);if(i===0)return 0;var a=Yr(e[0],e[1],t[0],t[1],n.maxX,n.minY,n.maxX,n.maxY);if(a===0)return 0;var o=Yr(e[0],e[1],t[0],t[1],n.minX,n.maxY,n.maxX,n.maxY);return o===0?0:Math.min(r,i,a,o)}function Hr(e,t){return!(t.minX>e[0]||e[0]>t.maxX||t.minY>e[1]||e[1]>t.maxY)}function Ur(e,t,n){for(var r,i,a,o,s=n.search({minX:Math.min(e[0],t[0]),minY:Math.min(e[1],t[1]),maxX:Math.max(e[0],t[0]),maxY:Math.max(e[1],t[1])}),c=0;s.length>c;c++)if(i=s[c].next.p,a=e,(r=s[c].p)!==(o=t)&&i!==a&&Wr(r,i,a)>0!=Wr(r,i,o)>0&&Wr(a,o,r)>0!=Wr(a,o,i)>0)return!1;return!0}function Wr(e,t,n){return Ir(e[0],e[1],t[0],t[1],n[0],n[1])}function Gr(e){var t=e.p,n=e.next.p;return e.minX=Math.min(t[0],n[0]),e.minY=Math.min(t[1],n[1]),e.maxX=Math.max(t[0],n[0]),e.maxY=Math.max(t[1],n[1]),e}function Kr(e,t){var n={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(n.next=t.next,n.prev=t,t.next.prev=n,t.next=n):(n.prev=n,n.next=n),n}function qr(e,t){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function Jr(e,t,n){var r=t[0],i=t[1],a=n[0]-r,o=n[1]-i;if(a!==0||o!==0){var s=((e[0]-r)*a+(e[1]-i)*o)/(a*a+o*o);s>1?(r=n[0],i=n[1]):s>0&&(r+=a*s,i+=o*s)}return(a=e[0]-r)*a+(o=e[1]-i)*o}function Yr(e,t,n,r,i,a,o,s){var c,l,u,d,f=n-e,p=r-t,m=o-i,h=s-a,g=e-i,_=t-a,v=f*f+p*p,y=f*m+p*h,b=m*m+h*h,x=f*g+p*_,S=m*g+h*_,C=v*b-y*y,w=C,E=C;C===0?(l=0,w=1,d=S,E=b):(d=v*S-y*x,0>(l=y*S-b*x)?(l=0,d=S,E=b):l>w&&(l=w,d=S+y,E=b)),0>d?(d=0,0>-x?l=0:-x>v?l=w:(l=-x,w=v)):d>E&&(d=E,0>-x+y?l=0:-x+y>v?l=w:(l=-x+y,w=v));var D=(1-(u=d===0?0:d/E))*i+u*o-((1-(c=l===0?0:l/w))*e+c*n),O=(1-u)*a+u*s-((1-c)*t+c*r);return D*D+O*O}function Xr(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function Zr(e,t,n){n===void 0&&(n={});var r=nr(e),i=nr(t),a=Bn(i[1]-r[1]),o=Bn(i[0]-r[0]),s=Bn(r[1]),c=Bn(i[1]),l=Math.sin(a/2)**2+Math.sin(o/2)**2*Math.cos(s)*Math.cos(c);return Ln(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}function Qr(e){return function(e,t){t===void 0&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw Error(`@turf/bbox-polygon does not support BBox with 6 positions`);var o=[n,r];return jn([[o,[i,r],[i,a],[n,a],o]],t.properties,{bbox:e,id:t.id})}(tr(e))}function $r(e,t,n,r){r===void 0&&(r={});var i=nr(e),a=Bn(i[0]),o=Bn(i[1]),s=Bn(n),c=Rn(t,r.units),l=Math.asin(Math.sin(o)*Math.cos(c)+Math.cos(o)*Math.sin(c)*Math.cos(s));return An([zn(a+Math.atan2(Math.sin(s)*Math.sin(c)*Math.cos(o),Math.cos(c)-Math.sin(o)*Math.sin(l))),zn(l)],r.properties)}function ei(e,t,n){if(n===void 0&&(n={}),!0===n.final)return function(e,t){var n=ei(t,e);return n=(n+180)%360}(e,t);var r=nr(e),i=nr(t),a=Bn(r[0]),o=Bn(i[0]),s=Bn(r[1]),c=Bn(i[1]);return zn(Math.atan2(Math.sin(o-a)*Math.cos(c),Math.cos(s)*Math.sin(c)-Math.sin(s)*Math.cos(c)*Math.cos(o-a)))}function ti(e,t){t===void 0&&(t={});var n=tr(e);return An([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)}function ni(e,t){t===void 0&&(t={});var n=0,r=0,i=0;return Wn(e,(function(e){n+=e[0],r+=e[1],i++}),!0),An([n/i,r/i],t.properties)}function ri(e,t){switch(t===void 0&&(t={}),ar(e)){case`Point`:return An(nr(e),t.properties);case`Polygon`:var n=[];Wn(e,(function(e){n.push(e)}));var r,i,a,o,s,c,l,u,d=ni(e,{properties:t.properties}),f=d.geometry.coordinates,p=0,m=0,h=0,g=n.map((function(e){return[e[0]-f[0],e[1]-f[1]]}));for(r=0;n.length-1>r;r++)h+=u=(o=(i=g[r])[0])*(l=(a=g[r+1])[1])-(s=a[0])*(c=i[1]),p+=(o+s)*u,m+=(c+l)*u;if(h===0)return d;var _=1/(.5*h*6);return An([f[0]+_*p,f[1]+_*m],t.properties);default:var v=function(e,t){t===void 0&&(t={}),t.concavity=t.concavity||1/0;var n=[];if(Wn(e,(function(e){n.push([e[0],e[1]])})),!n.length)return null;var r=Lr(n,t.concavity);return r.length>3?jn([r]):null}(e);return v?ri(v,{properties:t.properties}):ni(e,{properties:t.properties})}}function ii(e){if(!e)throw Error(`geojson is required`);var t=[];return Xn(e,(function(e){(function(e,t){var n=[],r=e.geometry;if(r!==null){switch(r.type){case`Polygon`:n=rr(r);break;case`LineString`:n=[rr(r)]}n.forEach((function(n){(function(e,t){var n=[];return e.reduce((function(e,r){var i,a,o,s,c,l,u=Mn([e,r],t);return u.bbox=[(c=(a=r)[0])>(o=(i=e)[0])?o:c,(l=a[1])>(s=i[1])?s:l,o>c?o:c,s>l?s:l],n.push(u),r})),n})(n,e.properties).forEach((function(e){e.id=t.length,t.push(e)}))}))}})(e,t)})),Nn(t)}Lr.default=Rr;function ai(e,t,n){if(!n)return t.indexOf(e);for(let r=0;t.length>r;r++)if(n(e,t[r]))return r;return-1}function oi(e,t){si(e,0,e.children.length,t,e)}function si(e,t,n,r,i){i||=gi(null),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let a=t;n>a;a++){let t=e.children[a];ci(i,e.leaf?r(t):t)}return i}function ci(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function li(e,t){return e.minX-t.minX}function ui(e,t){return e.minY-t.minY}function di(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function fi(e){return e.maxX-e.minX+(e.maxY-e.minY)}function pi(e,t){let n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,a-r)}function mi(e,t){return!(e.minX>t.minX||e.minY>t.minY||t.maxX>e.maxX||t.maxY>e.maxY)}function hi(e,t){return!(t.minX>e.maxX||t.minY>e.maxY||e.minX>t.maxX||e.minY>t.maxY)}function gi(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _i(e,t,n,r,i){let a=[t,n];for(;a.length;){if(r>=(n=a.pop())-(t=a.pop()))continue;let o=t+Math.ceil((n-t)/r/2)*r;or(e,o,t,n,i),a.push(t,o,o,n)}}var vi,yi=Object.freeze({__proto__:null,default:class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data,n=[];if(!hi(e,t))return n;let r=this.toBBox,i=[];for(;t;){for(let a=0;t.children.length>a;a++){let o=t.children[a],s=t.leaf?r(o):o;hi(e,s)&&(t.leaf?n.push(o):mi(e,s)?this._all(o,n):i.push(o))}t=i.pop()}return n}collides(e){let t=this.data;if(!hi(e,t))return!1;let n=[];for(;t;){for(let r=0;t.children.length>r;r++){let i=t.children[r],a=t.leaf?this.toBBox(i):i;if(hi(e,a)){if(t.leaf||mi(e,a))return!0;n.push(i)}}t=n.pop()}return!1}load(e){if(!e||!e.length)return this;if(this._minEntries>e.length){for(let t=0;e.length>t;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(t.height>this.data.height){let e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=gi([]),this}remove(e,t){if(!e)return this;let n=this.data,r=this.toBBox(e),i=[],a=[],o,s,c;for(;n||i.length;){if(n||(n=i.pop(),s=i[i.length-1],o=a.pop(),c=!0),n.leaf){let r=ai(e,n.children,t);if(r!==-1)return n.children.splice(r,1),i.push(n),this._condense(i),this}c||n.leaf||!mi(n,r)?s?(o++,n=s.children[o],c=!1):n=null:(i.push(n),a.push(o),o=0,s=n,n=n.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,r){let i=n-t+1,a,o=this._maxEntries;if(o>=i)return a=gi(e.slice(t,n+1)),oi(a,this.toBBox),a;r||(o=Math.ceil(i/o**((r=Math.ceil(Math.log(i)/Math.log(o)))-1))),a=gi([]),a.leaf=!1,a.height=r;let s=Math.ceil(i/o),c=s*Math.ceil(Math.sqrt(o));_i(e,t,n,c,this.compareMinX);for(let i=t;n>=i;i+=c){let t=Math.min(i+c-1,n);_i(e,i,t,s,this.compareMinY);for(let n=i;t>=n;n+=s)a.children.push(this._build(e,n,Math.min(n+s-1,t),r-1))}return oi(a,this.toBBox),a}_chooseSubtree(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){let n,r=1/0,o=1/0;for(let s=0;t.children.length>s;s++){let c=t.children[s],l=di(c),u=(Math.max((a=c).maxX,(i=e).maxX)-Math.min(a.minX,i.minX))*(Math.max(a.maxY,i.maxY)-Math.min(a.minY,i.minY))-l;o>u?(o=u,r=r>l?l:r,n=c):u===o&&r>l&&(r=l,n=c)}t=n||t.children[0]}var i,a;return t}_insert(e,t,n){let r=n?e:this.toBBox(e),i=[],a=this._chooseSubtree(r,this.data,t,i);for(a.children.push(e),ci(a,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)}_split(e,t){let n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);let a=this._chooseSplitIndex(n,i,r),o=gi(n.children.splice(a,n.children.length-a));o.height=n.height,o.leaf=n.leaf,oi(n,this.toBBox),oi(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(n,o)}_splitRoot(e,t){this.data=gi([e,t]),this.data.height=e.height+1,this.data.leaf=!1,oi(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let r,i=1/0,a=1/0;for(let o=t;n-t>=o;o++){let t=si(e,0,o,this.toBBox),s=si(e,o,n,this.toBBox),c=pi(t,s),l=di(t)+di(s);i>c?(i=c,r=o,a=a>l?l:a):c===i&&a>l&&(a=l,r=o)}return r||n-t}_chooseSplitAxis(e,t,n){let r=e.leaf?this.compareMinX:li,i=e.leaf?this.compareMinY:ui,a=this._allDistMargin(e,t,n,r);this._allDistMargin(e,t,n,i)>a&&e.children.sort(r)}_allDistMargin(e,t,n,r){e.children.sort(r);let i=this.toBBox,a=si(e,0,t,i),o=si(e,n-t,n,i),s=fi(a)+fi(o);for(let r=t;n-t>r;r++){let t=e.children[r];ci(a,e.leaf?i(t):t),s+=fi(a)}for(let r=n-t-1;r>=t;r--){let t=e.children[r];ci(o,e.leaf?i(t):t),s+=fi(o)}return s}_adjustParentBBoxes(e,t,n){for(let r=n;r>=0;r--)ci(t[r],e)}_condense(e){for(let t,n=e.length-1;n>=0;n--)e[n].children.length===0?n>0?(t=e[n-1].children,t.splice(t.indexOf(e[n]),1)):this.clear():oi(e[n],this.toBBox)}}}),bi=Object.prototype.toString,xi=function(e){var t=bi.call(e),n=t===`[object Arguments]`;return n||=t!==`[object Array]`&&typeof e==`object`&&!!e&&typeof e.length==`number`&&e.length>=0&&bi.call(e.callee)===`[object Function]`,n};if(!Object.keys){var Si=Object.prototype.hasOwnProperty,Ci=Object.prototype.toString,wi=xi,Ti=Object.prototype.propertyIsEnumerable,Ei=!Ti.call({toString:null},`toString`),Di=Ti.call((function(){}),`prototype`),Oi=[`toString`,`toLocaleString`,`valueOf`,`hasOwnProperty`,`isPrototypeOf`,`propertyIsEnumerable`,`constructor`],ki=function(e){var t=e.constructor;return t&&t.prototype===e},Ai={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},ji=function(){if(typeof window>`u`)return!1;for(var e in window)try{if(!Ai[`$`+e]&&Si.call(window,e)&&window[e]!==null&&typeof window[e]==`object`)try{ki(window[e])}catch{return!0}}catch{return!0}return!1}();vi=function(e){var t=typeof e==`object`&&!!e,n=Ci.call(e)===`[object Function]`,r=wi(e),i=t&&Ci.call(e)===`[object String]`,a=[];if(!t&&!n&&!r)throw TypeError(`Object.keys called on a non-object`);var o=Di&&n;if(i&&e.length>0&&!Si.call(e,0))for(var s=0;e.length>s;++s)a.push(s+``);if(r&&e.length>0)for(var c=0;e.length>c;++c)a.push(c+``);else for(var l in e)o&&l===`prototype`||!Si.call(e,l)||a.push(l+``);if(Ei)for(var u=function(e){if(typeof window>`u`||!ji)return ki(e);try{return ki(e)}catch{return!1}}(e),d=0;Oi.length>d;++d)u&&Oi[d]===`constructor`||!Si.call(e,Oi[d])||a.push(Oi[d]);return a}}var Mi=Array.prototype.slice,Ni=Object.keys,Pi=Ni?function(e){return Ni(e)}:vi,Fi=Object.keys;Pi.shim=function(){return Object.keys?(function(){var e=Object.keys(arguments);return e&&e.length===arguments.length})(1,2)||(Object.keys=function(e){return xi(e)?Fi(Mi.call(e)):Fi(e)}):Object.keys=Pi,Object.keys||Pi};var Ii,Li=Pi,Ri=Error,zi=EvalError,Bi=RangeError,Vi=ReferenceError,Hi=SyntaxError,Ui=TypeError,Wi=URIError,Gi=function(){if(typeof Symbol!=`function`||typeof Object.getOwnPropertySymbols!=`function`)return!1;if(typeof Symbol.iterator==`symbol`)return!0;var e={},t=Symbol(`test`),n=Object(t);if(typeof t==`string`||Object.prototype.toString.call(t)!==`[object Symbol]`||Object.prototype.toString.call(n)!==`[object Symbol]`)return!1;for(t in e[t]=42,e)return!1;if(typeof Object.keys==`function`&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames==`function`&&Object.getOwnPropertyNames(e).length!==0)return!1;var r=Object.getOwnPropertySymbols(e);if(r.length!==1||r[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor==`function`){var i=Object.getOwnPropertyDescriptor(e,t);if(i.value!==42||!0!==i.enumerable)return!1}return!0},Ki=typeof Symbol<`u`&&Symbol,qi=function(){return typeof Ki==`function`&&typeof Symbol==`function`&&typeof Ki(`foo`)==`symbol`&&typeof Symbol(`bar`)==`symbol`&&Gi()},Ji={__proto__:null,foo:{}},Yi=Object,Xi=Object.prototype.toString,Zi=Math.max,Qi=function(e,t){for(var n=[],r=0;e.length>r;r+=1)n[r]=e[r];for(var i=0;t.length>i;i+=1)n[i+e.length]=t[i];return n},$i=Function.prototype.bind||function(e){var t=this;if(typeof t!=`function`||Xi.apply(t)!==`[object Function]`)throw TypeError(`Function.prototype.bind called on incompatible `+t);for(var n,r=function(e,t){for(var n=[],r=t||0,i=0;e.length>r;r+=1,i+=1)n[i]=e[r];return n}(arguments,1),i=Zi(0,t.length-r.length),a=[],o=0;i>o;o++)a[o]=`$`+o;if(n=Function(`binder`,`return function (`+function(e,t){for(var n=``,r=0;e.length>r;r+=1)n+=e[r],e.length>r+1&&(n+=t);return n}(a,`,`)+`){ return binder.apply(this,arguments); }`)((function(){if(this instanceof n){var i=t.apply(this,Qi(r,arguments));return Object(i)===i?i:this}return t.apply(e,Qi(r,arguments))})),t.prototype){var s=function(){};s.prototype=t.prototype,n.prototype=new s,s.prototype=null}return n},ea=$i.call(Function.prototype.call,Object.prototype.hasOwnProperty),ta=Function,na=function(e){try{return ta(`"use strict"; return (`+e+`).constructor;`)()}catch{}},ra=Object.getOwnPropertyDescriptor;if(ra)try{ra({},``)}catch{ra=null}var ia=function(){throw new Ui},aa=ra?function(){try{return ia}catch{try{return ra(arguments,`callee`).get}catch{return ia}}}():ia,oa=qi(),sa=Object.getPrototypeOf||({__proto__:Ji}.foo===Ji.foo&&!(Ji instanceof Yi)?function(e){return e.__proto__}:null),ca={},la=typeof Uint8Array<`u`&&sa?sa(Uint8Array):Ii,ua={__proto__:null,"%AggregateError%":typeof AggregateError>`u`?Ii:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>`u`?Ii:ArrayBuffer,"%ArrayIteratorPrototype%":oa&&sa?sa([][Symbol.iterator]()):Ii,"%AsyncFromSyncIteratorPrototype%":Ii,"%AsyncFunction%":ca,"%AsyncGenerator%":ca,"%AsyncGeneratorFunction%":ca,"%AsyncIteratorPrototype%":ca,"%Atomics%":typeof Atomics>`u`?Ii:Atomics,"%BigInt%":typeof BigInt>`u`?Ii:BigInt,"%BigInt64Array%":typeof BigInt64Array>`u`?Ii:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>`u`?Ii:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>`u`?Ii:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Ri,"%eval%":eval,"%EvalError%":zi,"%Float32Array%":typeof Float32Array>`u`?Ii:Float32Array,"%Float64Array%":typeof Float64Array>`u`?Ii:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>`u`?Ii:FinalizationRegistry,"%Function%":ta,"%GeneratorFunction%":ca,"%Int8Array%":typeof Int8Array>`u`?Ii:Int8Array,"%Int16Array%":typeof Int16Array>`u`?Ii:Int16Array,"%Int32Array%":typeof Int32Array>`u`?Ii:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":oa&&sa?sa(sa([][Symbol.iterator]())):Ii,"%JSON%":typeof JSON==`object`?JSON:Ii,"%Map%":typeof Map>`u`?Ii:Map,"%MapIteratorPrototype%":typeof Map<`u`&&oa&&sa?sa(new Map()[Symbol.iterator]()):Ii,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>`u`?Ii:Promise,"%Proxy%":typeof Proxy>`u`?Ii:Proxy,"%RangeError%":Bi,"%ReferenceError%":Vi,"%Reflect%":typeof Reflect>`u`?Ii:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>`u`?Ii:Set,"%SetIteratorPrototype%":typeof Set<`u`&&oa&&sa?sa(new Set()[Symbol.iterator]()):Ii,"%SharedArrayBuffer%":typeof SharedArrayBuffer>`u`?Ii:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":oa&&sa?sa(``[Symbol.iterator]()):Ii,"%Symbol%":oa?Symbol:Ii,"%SyntaxError%":Hi,"%ThrowTypeError%":aa,"%TypedArray%":la,"%TypeError%":Ui,"%Uint8Array%":typeof Uint8Array>`u`?Ii:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>`u`?Ii:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>`u`?Ii:Uint16Array,"%Uint32Array%":typeof Uint32Array>`u`?Ii:Uint32Array,"%URIError%":Wi,"%WeakMap%":typeof WeakMap>`u`?Ii:WeakMap,"%WeakRef%":typeof WeakRef>`u`?Ii:WeakRef,"%WeakSet%":typeof WeakSet>`u`?Ii:WeakSet};if(sa)try{null.error}catch(e){ua[`%Error.prototype%`]=sa(sa(e))}var da=function e(t){var n;if(t===`%AsyncFunction%`)n=na(`async function () {}`);else if(t===`%GeneratorFunction%`)n=na(`function* () {}`);else if(t===`%AsyncGeneratorFunction%`)n=na(`async function* () {}`);else if(t===`%AsyncGenerator%`){var r=e(`%AsyncGeneratorFunction%`);r&&(n=r.prototype)}else if(t===`%AsyncIteratorPrototype%`){var i=e(`%AsyncGenerator%`);i&&sa&&(n=sa(i.prototype))}return ua[t]=n,n},fa={__proto__:null,"%ArrayBufferPrototype%":[`ArrayBuffer`,`prototype`],"%ArrayPrototype%":[`Array`,`prototype`],"%ArrayProto_entries%":[`Array`,`prototype`,`entries`],"%ArrayProto_forEach%":[`Array`,`prototype`,`forEach`],"%ArrayProto_keys%":[`Array`,`prototype`,`keys`],"%ArrayProto_values%":[`Array`,`prototype`,`values`],"%AsyncFunctionPrototype%":[`AsyncFunction`,`prototype`],"%AsyncGenerator%":[`AsyncGeneratorFunction`,`prototype`],"%AsyncGeneratorPrototype%":[`AsyncGeneratorFunction`,`prototype`,`prototype`],"%BooleanPrototype%":[`Boolean`,`prototype`],"%DataViewPrototype%":[`DataView`,`prototype`],"%DatePrototype%":[`Date`,`prototype`],"%ErrorPrototype%":[`Error`,`prototype`],"%EvalErrorPrototype%":[`EvalError`,`prototype`],"%Float32ArrayPrototype%":[`Float32Array`,`prototype`],"%Float64ArrayPrototype%":[`Float64Array`,`prototype`],"%FunctionPrototype%":[`Function`,`prototype`],"%Generator%":[`GeneratorFunction`,`prototype`],"%GeneratorPrototype%":[`GeneratorFunction`,`prototype`,`prototype`],"%Int8ArrayPrototype%":[`Int8Array`,`prototype`],"%Int16ArrayPrototype%":[`Int16Array`,`prototype`],"%Int32ArrayPrototype%":[`Int32Array`,`prototype`],"%JSONParse%":[`JSON`,`parse`],"%JSONStringify%":[`JSON`,`stringify`],"%MapPrototype%":[`Map`,`prototype`],"%NumberPrototype%":[`Number`,`prototype`],"%ObjectPrototype%":[`Object`,`prototype`],"%ObjProto_toString%":[`Object`,`prototype`,`toString`],"%ObjProto_valueOf%":[`Object`,`prototype`,`valueOf`],"%PromisePrototype%":[`Promise`,`prototype`],"%PromiseProto_then%":[`Promise`,`prototype`,`then`],"%Promise_all%":[`Promise`,`all`],"%Promise_reject%":[`Promise`,`reject`],"%Promise_resolve%":[`Promise`,`resolve`],"%RangeErrorPrototype%":[`RangeError`,`prototype`],"%ReferenceErrorPrototype%":[`ReferenceError`,`prototype`],"%RegExpPrototype%":[`RegExp`,`prototype`],"%SetPrototype%":[`Set`,`prototype`],"%SharedArrayBufferPrototype%":[`SharedArrayBuffer`,`prototype`],"%StringPrototype%":[`String`,`prototype`],"%SymbolPrototype%":[`Symbol`,`prototype`],"%SyntaxErrorPrototype%":[`SyntaxError`,`prototype`],"%TypedArrayPrototype%":[`TypedArray`,`prototype`],"%TypeErrorPrototype%":[`TypeError`,`prototype`],"%Uint8ArrayPrototype%":[`Uint8Array`,`prototype`],"%Uint8ClampedArrayPrototype%":[`Uint8ClampedArray`,`prototype`],"%Uint16ArrayPrototype%":[`Uint16Array`,`prototype`],"%Uint32ArrayPrototype%":[`Uint32Array`,`prototype`],"%URIErrorPrototype%":[`URIError`,`prototype`],"%WeakMapPrototype%":[`WeakMap`,`prototype`],"%WeakSetPrototype%":[`WeakSet`,`prototype`]},pa=$i.call(Function.call,Array.prototype.concat),ma=$i.call(Function.apply,Array.prototype.splice),ha=$i.call(Function.call,String.prototype.replace),ga=$i.call(Function.call,String.prototype.slice),_a=$i.call(Function.call,RegExp.prototype.exec),va=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,ya=/\\(\\)?/g,ba=function(e,t){var n,r=e;if(ea(fa,r)&&(r=`%`+(n=fa[r])[0]+`%`),ea(ua,r)){var i=ua[r];if(i===ca&&(i=da(r)),i===void 0&&!t)throw new Ui(`intrinsic `+e+` exists, but is not available. Please file an issue!`);return{alias:n,name:r,value:i}}throw new Hi(`intrinsic `+e+` does not exist!`)},xa=function(e,t){if(typeof e!=`string`||e.length===0)throw new Ui(`intrinsic name must be a non-empty string`);if(arguments.length>1&&typeof t!=`boolean`)throw new Ui(`"allowMissing" argument must be a boolean`);if(_a(/^%?[^%]*%?$/,e)===null)throw new Hi("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=ga(e,0,1),n=ga(e,-1);if(t===`%`&&n!==`%`)throw new Hi("invalid intrinsic syntax, expected closing `%`");if(n===`%`&&t!==`%`)throw new Hi("invalid intrinsic syntax, expected opening `%`");var r=[];return ha(e,va,(function(e,t,n,i){r[r.length]=n?ha(i,ya,`$1`):t||e})),r}(e),r=n.length>0?n[0]:``,i=ba(`%`+r+`%`,t),a=i.name,o=i.value,s=!1,c=i.alias;c&&(r=c[0],ma(n,pa([0,1],c)));for(var l=1,u=!0;n.length>l;l+=1){var d=n[l],f=ga(d,0,1),p=ga(d,-1);if((f===`"`||f===`'`||f==="`"||p===`"`||p===`'`||p==="`")&&f!==p)throw new Hi(`property names with quotes must have matching quotes`);if(d!==`constructor`&&u||(s=!0),ea(ua,a=`%`+(r+=`.`+d)+`%`))o=ua[a];else if(o!=null){if(!(d in o)){if(!t)throw new Ui(`base intrinsic for `+e+` exists, but the property is not available.`);return}if(ra&&l+1>=n.length){var m=ra(o,d);o=(u=!!m)&&`get`in m&&!(`originalValue`in m.get)?m.get:o[d]}else u=ea(o,d),o=o[d];u&&!s&&(ua[a]=o)}}return o},Sa=xa(`%Object.defineProperty%`,!0)||!1;if(Sa)try{Sa({},`a`,{value:1})}catch{Sa=!1}var Ca=Sa,wa=xa(`%Object.getOwnPropertyDescriptor%`,!0);if(wa)try{wa([],`length`)}catch{wa=null}var Ta=wa,Ea=function(e,t,n){if(!e||typeof e!=`object`&&typeof e!=`function`)throw new Ui("`obj` must be an object or a function`");if(typeof t!=`string`&&typeof t!=`symbol`)throw new Ui("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!=`boolean`&&arguments[3]!==null)throw new Ui("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!=`boolean`&&arguments[4]!==null)throw new Ui("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!=`boolean`&&arguments[5]!==null)throw new Ui("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!=`boolean`)throw new Ui("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,o=arguments.length>6&&arguments[6],s=!!Ta&&Ta(e,t);if(Ca)Ca(e,t,{configurable:a===null&&s?s.configurable:!a,enumerable:r===null&&s?s.enumerable:!r,value:n,writable:i===null&&s?s.writable:!i});else{if(!o&&(r||i||a))throw new Hi(`This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.`);e[t]=n}},Da=function(){return!!Ca};Da.hasArrayLengthDefineBug=function(){if(!Ca)return null;try{return Ca([],`length`,{value:1}).length!==1}catch{return!0}};var Oa=Da,ka=typeof Symbol==`function`&&typeof Symbol(`foo`)==`symbol`,Aa=Object.prototype.toString,ja=Array.prototype.concat,Ma=Oa(),Na=function(e,t,n,r){if(t in e){if(!0===r){if(e[t]===n)return}else if(typeof(i=r)!=`function`||Aa.call(i)!==`[object Function]`||!r())return}var i;Ma?Ea(e,t,n,!0):Ea(e,t,n)},Pa=function(e,t){var n=arguments.length>2?arguments[2]:{},r=Li(t);ka&&(r=ja.call(r,Object.getOwnPropertySymbols(t)));for(var i=0;r.length>i;i+=1)Na(e,r[i],t[r[i]],n[r[i]])};Pa.supportsDescriptors=!!Ma;var Fa=Pa,Ia=Oa(),La=xa(`%Math.floor%`),Ra=jr((function(e){var t=xa(`%Function.prototype.apply%`),n=xa(`%Function.prototype.call%`),r=xa(`%Reflect.apply%`,!0)||$i.call(n,t),i=xa(`%Math.max%`);e.exports=function(e){if(typeof e!=`function`)throw new Ui(`a function is required`);return function(e,t){if(typeof e!=`function`)throw new Ui("`fn` is not a function");if(typeof t!=`number`||0>t||t>4294967295||La(t)!==t)throw new Ui("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],r=!0,i=!0;if(`length`in e&&Ta){var a=Ta(e,`length`);a&&!a.configurable&&(r=!1),a&&!a.writable&&(i=!1)}return(r||i||!n)&&(Ia?Ea(e,`length`,t,!0,!0):Ea(e,`length`,t)),e}(r($i,n,arguments),1+i(0,e.length-(arguments.length-1)),!0)};var a=function(){return r($i,t,arguments)};Ca?Ca(e.exports,`apply`,{value:a}):e.exports.apply=a})),za=Ra(xa(`String.prototype.indexOf`)),Ba=function(e,t){var n=xa(e,!!t);return typeof n==`function`&&za(e,`.prototype.`)>-1?Ra(n):n},Va=Gi(),Ha=Object,Ua=Ba(`Array.prototype.push`),Wa=Ba(`Object.prototype.propertyIsEnumerable`),Ga=Va?Object.getOwnPropertySymbols:null,Ka=function(e,t){if(e==null)throw TypeError(`target must be an object`);var n=Ha(e);if(arguments.length===1)return n;for(var r=1;arguments.length>r;++r){var i=Ha(arguments[r]),a=Li(i),o=Va&&(Object.getOwnPropertySymbols||Ga);if(o)for(var s=o(i),c=0;s.length>c;++c){var l=s[c];Wa(i,l)&&Ua(a,l)}for(var u=0;a.length>u;++u){var d=a[u];Wa(i,d)&&(n[d]=i[d])}}return n},qa=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var e=`abcdefghijklmnopqrst`,t=e.split(``),n={},r=0;t.length>r;++r)n[t[r]]=t[r];var i=Object.assign({},n),a=``;for(var o in i)a+=o;return e!==a}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,`xy`)}catch{return e[1]===`y`}return!1}()?Ka:Object.assign:Ka},Ja=Ra.apply(qa()),Ya=function(e,t){return Ja(Object,arguments)};Fa(Ya,{getPolyfill:qa,implementation:Ka,shim:function(){var e=qa();return Fa(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e}});var Xa=Ya,Za=function(){return!0},Qa=Object.getOwnPropertyDescriptor;if(Qa)try{Qa([],`length`)}catch{Qa=null}Za.functionsHaveConfigurableNames=function(){if(!Qa)return!1;var e=Qa((function(){}),`name`);return!!e&&!!e.configurable};var $a=Function.prototype.bind;Za.boundFunctionsHaveNames=function(){return typeof $a==`function`&&function(){}.bind().name!==``};var eo=Za,to=Oa(),no=eo.functionsHaveConfigurableNames(),ro=Object,io=function(e,t){if(typeof e!=`function`)throw new Ui("`fn` is not a function");return arguments.length>2&&arguments[2]&&!no||(to?Ea(e,`name`,t,!0,!0):Ea(e,`name`,t)),e}((function(){if(this==null||this!==ro(this))throw new Ui(`RegExp.prototype.flags getter called on non-object`);var e=``;return this.hasIndices&&(e+=`d`),this.global&&(e+=`g`),this.ignoreCase&&(e+=`i`),this.multiline&&(e+=`m`),this.dotAll&&(e+=`s`),this.unicode&&(e+=`u`),this.unicodeSets&&(e+=`v`),this.sticky&&(e+=`y`),e}),`get flags`,!0),ao=Fa.supportsDescriptors,oo=Object.getOwnPropertyDescriptor,so=function(){if(ao){var e=oo(RegExp.prototype,`flags`);if(e&&typeof e.get==`function`&&typeof RegExp.prototype.dotAll==`boolean`&&typeof RegExp.prototype.hasIndices==`boolean`){var t=``,n={};if(Object.defineProperty(n,`hasIndices`,{get:function(){t+=`d`}}),Object.defineProperty(n,`sticky`,{get:function(){t+=`y`}}),t===`dy`)return e.get}}return io},co=Fa.supportsDescriptors,lo=Object.getOwnPropertyDescriptor,uo=Object.defineProperty,fo=TypeError,po=Object.getPrototypeOf,mo=/a/,ho=Ra(so());Fa(ho,{getPolyfill:so,implementation:io,shim:function(){if(!co||!po)throw new fo(`RegExp.prototype.flags requires a true ES5 environment that supports property descriptors`);var e=so(),t=po(mo),n=lo(t,`flags`);return n&&n.get===e||uo(t,`flags`,{configurable:!0,enumerable:!1,get:e}),e}});var go=ho,_o=function(){return Gi()&&!!Symbol.toStringTag},vo=_o(),yo=Ba(`Object.prototype.toString`),bo=function(e){return!(vo&&e&&typeof e==`object`&&Symbol.toStringTag in e)&&yo(e)===`[object Arguments]`},xo=function(e){return!!bo(e)||typeof e==`object`&&!!e&&typeof e.length==`number`&&e.length>=0&&yo(e)!==`[object Array]`&&yo(e.callee)===`[object Function]`},So=function(){return bo(arguments)}();bo.isLegacyArguments=xo;var Co=So?bo:xo,wo=[],To=[],Eo=typeof Uint8Array<`u`?Uint8Array:Array,Do=!1;function Oo(){Do=!0;for(var e=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/`,t=0;64>t;++t)wo[t]=e[t],To[e.charCodeAt(t)]=t;To[45]=62,To[95]=63}function ko(e,t,n){for(var r,i=[],a=t;n>a;a+=3)i.push(wo[(r=(e[a]<<16)+(e[a+1]<<8)+e[a+2])>>18&63]+wo[r>>12&63]+wo[r>>6&63]+wo[63&r]);return i.join(``)}function Ao(e){var t;Do||Oo();for(var n=e.length,r=n%3,i=``,a=[],o=16383,s=0,c=n-r;c>s;s+=o)a.push(ko(e,s,s+o>c?c:s+o));return r===1?(i+=wo[(t=e[n-1])>>2],i+=wo[t<<4&63],i+=`==`):r===2&&(i+=wo[(t=(e[n-2]<<8)+e[n-1])>>10],i+=wo[t>>4&63],i+=wo[t<<2&63],i+=`=`),a.push(i),a.join(``)}function jo(e,t,n,r,i){var a,o,s=8*i-r-1,c=(1<<s)-1,l=c>>1,u=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,a=p&(1<<-u)-1,p>>=-u,u+=s;u>0;a=256*a+e[t+d],d+=f,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=r;u>0;o=256*o+e[t+d],d+=f,u-=8);if(a===0)a=1-l;else{if(a===c)return o?NaN:1/0*(p?-1:1);o+=2**r,a-=l}return(p?-1:1)*o*2**(a-r)}function Mo(e,t,n,r,i,a){var o,s,c,l=8*a-i-1,u=(1<<l)-1,d=u>>1,f=i===23?5.960464477539062e-8:0,p=r?0:a-1,m=r?1:-1,h=0>t||t===0&&0>1/t?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(s=isNaN(t)?1:0,o=u):(1>t*(c=2**-(o=Math.floor(Math.log(t)/Math.LN2)))&&(o--,c*=2),2>(t+=1>o+d?f*2**(1-d):f/c)*c||(o++,c/=2),u>o+d?1>o+d?(s=t*2**(d-1)*2**i,o=0):(s=(t*c-1)*2**i,o+=d):(s=0,o=u));i>=8;e[n+p]=255&s,p+=m,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[n+p]=255&o,p+=m,o/=256,l-=8);e[n+p-m]|=128*h}var No={}.toString,Po=Array.isArray||function(e){return No.call(e)==`[object Array]`};function Fo(){return Lo.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Io(e,t){if(Fo()<t)throw RangeError(`Invalid typed array length`);return Lo.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Lo.prototype:(e===null&&(e=new Lo(t)),e.length=t),e}function Lo(e,t,n){if(!(Lo.TYPED_ARRAY_SUPPORT||this instanceof Lo))return new Lo(e,t,n);if(typeof e==`number`){if(typeof t==`string`)throw Error(`If encoding is specified then the first argument must be a string`);return Bo(this,e)}return Ro(this,e,t,n)}function Ro(e,t,n,r){if(typeof t==`number`)throw TypeError(`"value" argument must not be a number`);return typeof ArrayBuffer<`u`&&t instanceof ArrayBuffer?function(e,t,n,r){if(0>n||n>t.byteLength)throw RangeError(`'offset' is out of bounds`);if(n+(r||0)>t.byteLength)throw RangeError(`'length' is out of bounds`);return t=n===void 0&&r===void 0?new Uint8Array(t):r===void 0?new Uint8Array(t,n):new Uint8Array(t,n,r),Lo.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Lo.prototype:e=Vo(e,t),e}(e,t,n,r):typeof t==`string`?function(e,t,n){if(typeof n==`string`&&n!==``||(n=`utf8`),!Lo.isEncoding(n))throw TypeError(`"encoding" must be a valid string encoding`);var r=0|Wo(t,n);e=Io(e,r);var i=e.write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(Uo(t)){var n=0|Ho(t.length);return(e=Io(e,n)).length===0||t.copy(e,0,0,n),e}if(t){if(typeof ArrayBuffer<`u`&&t.buffer instanceof ArrayBuffer||`length`in t)return typeof t.length!=`number`||(r=t.length)!=r?Io(e,0):Vo(e,t);if(t.type===`Buffer`&&Po(t.data))return Vo(e,t.data)}var r;throw TypeError(`First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.`)}(e,t)}function zo(e){if(typeof e!=`number`)throw TypeError(`"size" argument must be a number`);if(0>e)throw RangeError(`"size" argument must not be negative`)}function Bo(e,t){if(zo(t),e=Io(e,0>t?0:0|Ho(t)),!Lo.TYPED_ARRAY_SUPPORT)for(var n=0;t>n;++n)e[n]=0;return e}function Vo(e,t){var n=0>t.length?0:0|Ho(t.length);e=Io(e,n);for(var r=0;n>r;r+=1)e[r]=255&t[r];return e}function Ho(e){if(e>=Fo())throw RangeError(`Attempt to allocate Buffer larger than maximum size: 0x`+Fo().toString(16)+` bytes`);return 0|e}function Uo(e){return!(e==null||!e._isBuffer)}function Wo(e,t){if(Uo(e))return e.length;if(typeof ArrayBuffer<`u`&&typeof ArrayBuffer.isView==`function`&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;typeof e!=`string`&&(e=``+e);var n=e.length;if(n===0)return 0;for(var r=!1;;)switch(t){case`ascii`:case`latin1`:case`binary`:return n;case`utf8`:case`utf-8`:case void 0:return _s(e).length;case`ucs2`:case`ucs-2`:case`utf16le`:case`utf-16le`:return 2*n;case`hex`:return n>>>1;case`base64`:return vs(e).length;default:if(r)return _s(e).length;t=(``+t).toLowerCase(),r=!0}}function Go(e,t,n){var r=!1;if((t===void 0||0>t)&&(t=0),t>this.length||((n===void 0||n>this.length)&&(n=this.length),0>=n)||(t>>>=0)>=(n>>>=0))return``;for(e||=`utf8`;;)switch(e){case`hex`:return os(this,t,n);case`utf8`:case`utf-8`:return ns(this,t,n);case`ascii`:return is(this,t,n);case`latin1`:case`binary`:return as(this,t,n);case`base64`:return ts(this,t,n);case`ucs2`:case`ucs-2`:case`utf16le`:case`utf-16le`:return ss(this,t,n);default:if(r)throw TypeError(`Unknown encoding: `+e);e=(e+``).toLowerCase(),r=!0}}function Ko(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function qo(e,t,n,r,i){if(e.length===0)return-1;if(typeof n==`string`?(r=n,n=0):n>2147483647?n=2147483647:-2147483648>n&&(n=-2147483648),isNaN(n=+n)&&(n=i?0:e.length-1),0>n&&(n=e.length+n),e.length>n){if(0>n){if(!i)return-1;n=0}}else{if(i)return-1;n=e.length-1}if(typeof t==`string`&&(t=Lo.from(t,r)),Uo(t))return t.length===0?-1:Jo(e,t,n,r,i);if(typeof t==`number`)return t&=255,Lo.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==`function`?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):Jo(e,[t],n,r,i);throw TypeError(`val must be string, number or Buffer`)}function Jo(e,t,n,r,i){var a,o=1,s=e.length,c=t.length;if(r!==void 0&&((r=(r+``).toLowerCase())===`ucs2`||r===`ucs-2`||r===`utf16le`||r===`utf-16le`)){if(2>e.length||2>t.length)return-1;o=2,s/=2,c/=2,n/=2}function l(e,t){return o===1?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(a=n;s>a;a++)if(l(e,a)===l(t,u===-1?0:a-u)){if(u===-1&&(u=a),a-u+1===c)return u*o}else u!==-1&&(a-=a-u),u=-1}else for(n+c>s&&(n=s-c),a=n;a>=0;a--){for(var d=!0,f=0;c>f;f++)if(l(e,a+f)!==l(t,f)){d=!1;break}if(d)return a}return-1}function Yo(e,t,n,r){var i=e.length-(n=Number(n)||0);r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw TypeError(`Invalid hex string`);r>a/2&&(r=a/2);for(var o=0;r>o;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function Xo(e,t,n,r){return ys(_s(t,e.length-n),e,n,r)}function Zo(e,t,n,r){return ys(function(e){for(var t=[],n=0;e.length>n;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function Qo(e,t,n,r){return Zo(e,t,n,r)}function $o(e,t,n,r){return ys(vs(t),e,n,r)}function es(e,t,n,r){return ys(function(e,t){for(var n,r,i=[],a=0;e.length>a&&0<=(t-=2);++a)r=(n=e.charCodeAt(a))>>8,i.push(n%256),i.push(r);return i}(t,e.length-n),e,n,r)}function ts(e,t,n){return Ao(t===0&&n===e.length?e:e.slice(t,n))}function ns(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;n>i;){var a,o,s,c,l=e[i],u=null,d=l>239?4:l>223?3:l>191?2:1;if(n>=i+d)switch(d){case 1:128>l&&(u=l);break;case 2:(192&(a=e[i+1]))==128&&(c=(31&l)<<6|63&a)>127&&(u=c);break;case 3:o=e[i+2],(192&(a=e[i+1]))==128&&(192&o)==128&&(c=(15&l)<<12|(63&a)<<6|63&o)>2047&&(55296>c||c>57343)&&(u=c);break;case 4:o=e[i+2],s=e[i+3],(192&(a=e[i+1]))==128&&(192&o)==128&&(192&s)==128&&(c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&1114112>c&&(u=c)}u===null?(u=65533,d=1):u>65535&&(r.push((u-=65536)>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=d}return function(e){var t=e.length;if(rs>=t)return String.fromCharCode.apply(String,e);for(var n=``,r=0;t>r;)n+=String.fromCharCode.apply(String,e.slice(r,r+=rs));return n}(r)}Lo.TYPED_ARRAY_SUPPORT=i.TYPED_ARRAY_SUPPORT===void 0||i.TYPED_ARRAY_SUPPORT,Lo.poolSize=8192,Lo._augment=function(e){return e.__proto__=Lo.prototype,e},Lo.from=function(e,t,n){return Ro(null,e,t,n)},Lo.TYPED_ARRAY_SUPPORT&&(Lo.prototype.__proto__=Uint8Array.prototype,Lo.__proto__=Uint8Array),Lo.alloc=function(e,t,n){return function(e,t,n,r){return zo(t),t>0&&n!==void 0?typeof r==`string`?Io(e,t).fill(n,r):Io(e,t).fill(n):Io(e,t)}(null,e,t,n)},Lo.allocUnsafe=function(e){return Bo(null,e)},Lo.allocUnsafeSlow=function(e){return Bo(null,e)},Lo.isBuffer=function(e){return e!=null&&(!!e._isBuffer||bs(e)||function(e){return typeof e.readFloatLE==`function`&&typeof e.slice==`function`&&bs(e.slice(0,0))}(e))},Lo.compare=function(e,t){if(!Uo(e)||!Uo(t))throw TypeError(`Arguments must be Buffers`);if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);a>i;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return r>n?-1:n>r?1:0},Lo.isEncoding=function(e){switch((e+``).toLowerCase()){case`hex`:case`utf8`:case`utf-8`:case`ascii`:case`latin1`:case`binary`:case`base64`:case`ucs2`:case`ucs-2`:case`utf16le`:case`utf-16le`:return!0;default:return!1}},Lo.concat=function(e,t){if(!Po(e))throw TypeError(`"list" argument must be an Array of Buffers`);if(e.length===0)return Lo.alloc(0);var n;if(t===void 0)for(t=0,n=0;e.length>n;++n)t+=e[n].length;var r=Lo.allocUnsafe(t),i=0;for(n=0;e.length>n;++n){var a=e[n];if(!Uo(a))throw TypeError(`"list" argument must be an Array of Buffers`);a.copy(r,i),i+=a.length}return r},Lo.byteLength=Wo,Lo.prototype._isBuffer=!0,Lo.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError(`Buffer size must be a multiple of 16-bits`);for(var t=0;e>t;t+=2)Ko(this,t,t+1);return this},Lo.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError(`Buffer size must be a multiple of 32-bits`);for(var t=0;e>t;t+=4)Ko(this,t,t+3),Ko(this,t+1,t+2);return this},Lo.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError(`Buffer size must be a multiple of 64-bits`);for(var t=0;e>t;t+=8)Ko(this,t,t+7),Ko(this,t+1,t+6),Ko(this,t+2,t+5),Ko(this,t+3,t+4);return this},Lo.prototype.toString=function(){var e=0|this.length;return e===0?``:arguments.length===0?ns(this,0,e):Go.apply(this,arguments)},Lo.prototype.equals=function(e){if(!Uo(e))throw TypeError(`Argument must be a Buffer`);return this===e||Lo.compare(this,e)===0},Lo.prototype.inspect=function(){var e=``;return this.length>0&&(e=this.toString(`hex`,0,50).match(/.{2}/g).join(` `),this.length>50&&(e+=` ... `)),`<Buffer `+e+`>`},Lo.prototype.compare=function(e,t,n,r,i){if(!Uo(e))throw TypeError(`Argument must be a Buffer`);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),r===void 0&&(r=0),i===void 0&&(i=this.length),0>t||n>e.length||0>r||i>this.length)throw RangeError(`out of range index`);if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n),u=0;s>u;++u)if(c[u]!==l[u]){a=c[u],o=l[u];break}return o>a?-1:a>o?1:0},Lo.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},Lo.prototype.indexOf=function(e,t,n){return qo(this,e,t,n,!0)},Lo.prototype.lastIndexOf=function(e,t,n){return qo(this,e,t,n,!1)},Lo.prototype.write=function(e,t,n,r){if(t===void 0)r=`utf8`,n=this.length,t=0;else if(n===void 0&&typeof t==`string`)r=t,n=this.length,t=0;else{if(!isFinite(t))throw Error(`Buffer.write(string, encoding, offset[, length]) is no longer supported`);t|=0,isFinite(n)?(n|=0,r===void 0&&(r=`utf8`)):(r=n,n=void 0)}var i=this.length-t;if((n===void 0||n>i)&&(n=i),e.length>0&&(0>n||0>t)||t>this.length)throw RangeError(`Attempt to write outside buffer bounds`);r||=`utf8`;for(var a=!1;;)switch(r){case`hex`:return Yo(this,e,t,n);case`utf8`:case`utf-8`:return Xo(this,e,t,n);case`ascii`:return Zo(this,e,t,n);case`latin1`:case`binary`:return Qo(this,e,t,n);case`base64`:return $o(this,e,t,n);case`ucs2`:case`ucs-2`:case`utf16le`:case`utf-16le`:return es(this,e,t,n);default:if(a)throw TypeError(`Unknown encoding: `+r);r=(``+r).toLowerCase(),a=!0}},Lo.prototype.toJSON=function(){return{type:`Buffer`,data:Array.prototype.slice.call(this._arr||this,0)}};var rs=4096;function is(e,t,n){var r=``;n=Math.min(e.length,n);for(var i=t;n>i;++i)r+=String.fromCharCode(127&e[i]);return r}function as(e,t,n){var r=``;n=Math.min(e.length,n);for(var i=t;n>i;++i)r+=String.fromCharCode(e[i]);return r}function os(e,t,n){var r=e.length;t&&t>=0||(t=0),(!n||0>n||n>r)&&(n=r);for(var i=``,a=t;n>a;++a)i+=gs(e[a]);return i}function ss(e,t,n){for(var r=e.slice(t,n),i=``,a=0;r.length>a;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function cs(e,t,n){if(e%1!=0||0>e)throw RangeError(`offset is not uint`);if(e+t>n)throw RangeError(`Trying to access beyond buffer length`)}function ls(e,t,n,r,i,a){if(!Uo(e))throw TypeError(`"buffer" argument must be a Buffer instance`);if(t>i||a>t)throw RangeError(`"value" argument is out of bounds`);if(n+r>e.length)throw RangeError(`Index out of range`)}function us(e,t,n,r){0>t&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);a>i;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function ds(e,t,n,r){0>t&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);a>i;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function fs(e,t,n,r,i,a){if(n+r>e.length||0>n)throw RangeError(`Index out of range`)}function ps(e,t,n,r,i){return i||fs(e,0,n,4),Mo(e,t,n,r,23,4),n+4}function ms(e,t,n,r,i){return i||fs(e,0,n,8),Mo(e,t,n,r,52,8),n+8}Lo.prototype.slice=function(e,t){var n,r=this.length;if(0>(e=~~e)?0>(e+=r)&&(e=0):e>r&&(e=r),0>(t=t===void 0?r:~~t)?0>(t+=r)&&(t=0):t>r&&(t=r),e>t&&(t=e),Lo.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Lo.prototype;else{var i=t-e;n=new Lo(i,void 0);for(var a=0;i>a;++a)n[a]=this[a+e]}return n},Lo.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||cs(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},Lo.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||cs(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},Lo.prototype.readUInt8=function(e,t){return t||cs(e,1,this.length),this[e]},Lo.prototype.readUInt16LE=function(e,t){return t||cs(e,2,this.length),this[e]|this[e+1]<<8},Lo.prototype.readUInt16BE=function(e,t){return t||cs(e,2,this.length),this[e]<<8|this[e+1]},Lo.prototype.readUInt32LE=function(e,t){return t||cs(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Lo.prototype.readUInt32BE=function(e,t){return t||cs(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Lo.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||cs(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return(i*=128)>r||(r-=2**(8*t)),r},Lo.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||cs(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return(i*=128)>a||(a-=2**(8*t)),a},Lo.prototype.readInt8=function(e,t){return t||cs(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Lo.prototype.readInt16LE=function(e,t){t||cs(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Lo.prototype.readInt16BE=function(e,t){t||cs(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Lo.prototype.readInt32LE=function(e,t){return t||cs(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Lo.prototype.readInt32BE=function(e,t){return t||cs(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Lo.prototype.readFloatLE=function(e,t){return t||cs(e,4,this.length),jo(this,e,!0,23,4)},Lo.prototype.readFloatBE=function(e,t){return t||cs(e,4,this.length),jo(this,e,!1,23,4)},Lo.prototype.readDoubleLE=function(e,t){return t||cs(e,8,this.length),jo(this,e,!0,52,8)},Lo.prototype.readDoubleBE=function(e,t){return t||cs(e,8,this.length),jo(this,e,!1,52,8)},Lo.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||ls(this,e,t,n,2**(8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},Lo.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||ls(this,e,t,n,2**(8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},Lo.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,1,255,0),Lo.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Lo.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,2,65535,0),Lo.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):us(this,e,t,!0),t+2},Lo.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,2,65535,0),Lo.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):us(this,e,t,!1),t+2},Lo.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,4,4294967295,0),Lo.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):ds(this,e,t,!0),t+4},Lo.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,4,4294967295,0),Lo.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ds(this,e,t,!1),t+4},Lo.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=2**(8*n-1);ls(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)0>e&&s===0&&this[t+a-1]!==0&&(s=1),this[t+a]=(e/o|0)-s&255;return t+n},Lo.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=2**(8*n-1);ls(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)0>e&&s===0&&this[t+a+1]!==0&&(s=1),this[t+a]=(e/o|0)-s&255;return t+n},Lo.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,1,127,-128),Lo.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),0>e&&(e=255+e+1),this[t]=255&e,t+1},Lo.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,2,32767,-32768),Lo.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):us(this,e,t,!0),t+2},Lo.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,2,32767,-32768),Lo.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):us(this,e,t,!1),t+2},Lo.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,4,2147483647,-2147483648),Lo.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):ds(this,e,t,!0),t+4},Lo.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||ls(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),Lo.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ds(this,e,t,!1),t+4},Lo.prototype.writeFloatLE=function(e,t,n){return ps(this,e,t,!0,n)},Lo.prototype.writeFloatBE=function(e,t,n){return ps(this,e,t,!1,n)},Lo.prototype.writeDoubleLE=function(e,t,n){return ms(this,e,t,!0,n)},Lo.prototype.writeDoubleBE=function(e,t,n){return ms(this,e,t,!1,n)},Lo.prototype.copy=function(e,t,n,r){if(n||=0,r||r===0||(r=this.length),e.length>t||(t=e.length),t||=0,r>0&&n>r&&(r=n),r===n||e.length===0||this.length===0)return 0;if(0>t)throw RangeError(`targetStart out of bounds`);if(0>n||n>=this.length)throw RangeError(`sourceStart out of bounds`);if(0>r)throw RangeError(`sourceEnd out of bounds`);r>this.length&&(r=this.length),r-n>e.length-t&&(r=e.length-t+n);var i,a=r-n;if(this===e&&t>n&&r>t)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(1e3>a||!Lo.TYPED_ARRAY_SUPPORT)for(i=0;a>i;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},Lo.prototype.fill=function(e,t,n,r){if(typeof e==`string`){if(typeof t==`string`?(r=t,t=0,n=this.length):typeof n==`string`&&(r=n,n=this.length),e.length===1){var i=e.charCodeAt(0);256>i&&(e=i)}if(r!==void 0&&typeof r!=`string`)throw TypeError(`encoding must be a string`);if(typeof r==`string`&&!Lo.isEncoding(r))throw TypeError(`Unknown encoding: `+r)}else typeof e==`number`&&(e&=255);if(0>t||t>this.length||n>this.length)throw RangeError(`Out of range index`);if(t>=n)return this;var a;if(t>>>=0,n=n===void 0?this.length:n>>>0,e||=0,typeof e==`number`)for(a=t;n>a;++a)this[a]=e;else{var o=Uo(e)?e:_s(``+new Lo(e,r)),s=o.length;for(a=0;n-t>a;++a)this[a+t]=o[a%s]}return this};var hs=/[^+\/0-9A-Za-z-_]/g;function gs(e){return 16>e?`0`+e.toString(16):e.toString(16)}function _s(e,t){var n;t||=1/0;for(var r=e.length,i=null,a=[],o=0;r>o;++o){if((n=e.charCodeAt(o))>55295&&57344>n){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(56320>n){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,128>n){if(0>--t)break;a.push(n)}else if(2048>n){if(0>(t-=2))break;a.push(n>>6|192,63&n|128)}else if(65536>n){if(0>(t-=3))break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(n>=1114112)throw Error(`Invalid code point`);if(0>(t-=4))break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function vs(e){return function(e){var t,n,r,i,a,o;Do||Oo();var s=e.length;if(s%4>0)throw Error(`Invalid string. Length must be a multiple of 4`);o=new Eo(3*s/4-(a=e[s-2]===`=`?2:e[s-1]===`=`?1:0)),r=a>0?s-4:s;var c=0;for(t=0,n=0;r>t;t+=4,n+=3)i=To[e.charCodeAt(t)]<<18|To[e.charCodeAt(t+1)]<<12|To[e.charCodeAt(t+2)]<<6|To[e.charCodeAt(t+3)],o[c++]=i>>16&255,o[c++]=i>>8&255,o[c++]=255&i;return a===2?(i=To[e.charCodeAt(t)]<<2|To[e.charCodeAt(t+1)]>>4,o[c++]=255&i):a===1&&(i=To[e.charCodeAt(t)]<<10|To[e.charCodeAt(t+1)]<<4|To[e.charCodeAt(t+2)]>>2,o[c++]=i>>8&255,o[c++]=255&i),o}(function(e){if(2>(e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,``)}(e).replace(hs,``)).length)return``;for(;e.length%4!=0;)e+=`=`;return e}(e))}function ys(e,t,n,r){for(var i=0;r>i&&i+n<t.length&&i<e.length;++i)t[i+n]=e[i];return i}function bs(e){return!!e.constructor&&typeof e.constructor.isBuffer==`function`&&e.constructor.isBuffer(e)}var xs=typeof Object.create==`function`?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},Ss=/%[sdj%]/g;function Cs(e){if(!zs(e)){for(var t=[],n=0;arguments.length>n;n++)t.push(Os(arguments[n]));return t.join(` `)}n=1;for(var r=arguments,i=r.length,a=(e+``).replace(Ss,(function(e){if(e===`%%`)return`%`;if(n>=i)return e;switch(e){case`%s`:return r[n++]+``;case`%d`:return Number(r[n++]);case`%j`:try{return JSON.stringify(r[n++])}catch{return`[Circular]`}default:return e}})),o=r[n];i>n;o=r[++n])Is(o)||!Us(o)?a+=` `+o:a+=` `+Os(o);return a}function ws(e,t){if(Vs(i.process))return function(){return ws(e,t).apply(this,arguments)};var n=!1;return function(){return n||=(console.error(t),!0),e.apply(this,arguments)}}var Ts,Es={};function Ds(e){return Vs(Ts)&&(Ts=``),e=e.toUpperCase(),!Es[e]&&(RegExp(`\\b`+e+`\\b`,`i`).test(Ts)?Es[e]=function(){var t=Cs.apply(null,arguments);console.error(`%s %d: %s`,e,0,t)}:Es[e]=function(){}),Es[e]}function Os(e,t){var n={seen:[],stylize:As};return 3>arguments.length||(n.depth=arguments[2]),4>arguments.length||(n.colors=arguments[3]),Fs(t)?n.showHidden=t:t&&$s(n,t),Vs(n.showHidden)&&(n.showHidden=!1),Vs(n.depth)&&(n.depth=2),Vs(n.colors)&&(n.colors=!1),Vs(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=ks),js(n,e,n.depth)}function ks(e,t){var n=Os.styles[t];return n?`\x1B[`+Os.colors[n][0]+`m`+e+`\x1B[`+Os.colors[n][1]+`m`:e}function As(e,t){return e}function js(e,t,n){if(e.customInspect&&t&&Ks(t.inspect)&&t.inspect!==Os&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return zs(r)||(r=js(e,r,n)),r}var i=function(e,t){if(Vs(t))return e.stylize(`undefined`,`undefined`);if(zs(t)){var n=`'`+JSON.stringify(t).replace(/^"|"$/g,``).replace(/'/g,`\\'`).replace(/\\"/g,`"`)+`'`;return e.stylize(n,`string`)}if(Rs(t))return e.stylize(``+t,`number`);if(Fs(t))return e.stylize(``+t,`boolean`);if(Is(t))return e.stylize(`null`,`null`)}(e,t);if(i)return i;var a=Object.keys(t),o=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),Gs(t)&&(a.indexOf(`message`)>=0||a.indexOf(`description`)>=0))return Ms(t);if(a.length===0){if(Ks(t))return e.stylize(`[Function`+(t.name?`: `+t.name:``)+`]`,`special`);if(Hs(t))return e.stylize(RegExp.prototype.toString.call(t),`regexp`);if(Ws(t))return e.stylize(Date.prototype.toString.call(t),`date`);if(Gs(t))return Ms(t)}var s,c=``,l=!1,u=[`{`,`}`];return(Ps(t)&&(l=!0,u=[`[`,`]`]),Ks(t))&&(c=` [Function`+(t.name?`: `+t.name:``)+`]`),Hs(t)&&(c=` `+RegExp.prototype.toString.call(t)),Ws(t)&&(c=` `+Date.prototype.toUTCString.call(t)),Gs(t)&&(c=` `+Ms(t)),a.length!==0||l&&t.length!=0?0>n?Hs(t)?e.stylize(RegExp.prototype.toString.call(t),`regexp`):e.stylize(`[Object]`,`special`):(e.seen.push(t),s=l?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;s>o;++o)ec(t,o+``)?a.push(Ns(e,t,n,r,o+``,!0)):a.push(``);return i.forEach((function(i){i.match(/^\d+$/)||a.push(Ns(e,t,n,r,i,!0))})),a}(e,t,n,o,a):a.map((function(r){return Ns(e,t,n,o,r,l)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf(`
`),e+t.replace(/\u001b\[\d\d?m/g,``).length+1}),0)>60?n[0]+(t===``?``:t+`
 `)+` `+e.join(`,
  `)+` `+n[1]:n[0]+t+` `+e.join(`, `)+` `+n[1]}(s,c,u)):u[0]+c+u[1]}function Ms(e){return`[`+Error.prototype.toString.call(e)+`]`}function Ns(e,t,n,r,i,a){var o,s,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=e.stylize(c.set?`[Getter/Setter]`:`[Getter]`,`special`):c.set&&(s=e.stylize(`[Setter]`,`special`)),ec(r,i)||(o=`[`+i+`]`),s||(0>e.seen.indexOf(c.value)?(s=Is(n)?js(e,c.value,null):js(e,c.value,n-1)).indexOf(`
`)>-1&&(s=a?s.split(`
`).map((function(e){return`  `+e})).join(`
`).substr(2):`
`+s.split(`
`).map((function(e){return`   `+e})).join(`
`)):s=e.stylize(`[Circular]`,`special`)),Vs(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(``+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,`name`)):(o=o.replace(/'/g,`\\'`).replace(/\\"/g,`"`).replace(/(^"|"$)/g,`'`),o=e.stylize(o,`string`))}return o+`: `+s}function Ps(e){return Array.isArray(e)}function Fs(e){return typeof e==`boolean`}function Is(e){return e===null}function Ls(e){return e==null}function Rs(e){return typeof e==`number`}function zs(e){return typeof e==`string`}function Bs(e){return typeof e==`symbol`}function Vs(e){return e===void 0}function Hs(e){return Us(e)&&Ys(e)===`[object RegExp]`}function Us(e){return typeof e==`object`&&!!e}function Ws(e){return Us(e)&&Ys(e)===`[object Date]`}function Gs(e){return Us(e)&&(Ys(e)===`[object Error]`||e instanceof Error)}function Ks(e){return typeof e==`function`}function qs(e){return e===null||typeof e==`boolean`||typeof e==`number`||typeof e==`string`||typeof e==`symbol`||e===void 0}function Js(e){return Lo.isBuffer(e)}function Ys(e){return Object.prototype.toString.call(e)}function Xs(e){return 10>e?`0`+e.toString(10):e.toString(10)}Os.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Os.styles={special:`cyan`,number:`yellow`,boolean:`yellow`,undefined:`grey`,null:`bold`,string:`green`,date:`magenta`,regexp:`red`};var Zs=[`Jan`,`Feb`,`Mar`,`Apr`,`May`,`Jun`,`Jul`,`Aug`,`Sep`,`Oct`,`Nov`,`Dec`];function Qs(){var e,t;console.log(`%s - %s`,(t=[Xs((e=new Date).getHours()),Xs(e.getMinutes()),Xs(e.getSeconds())].join(`:`),[e.getDate(),Zs[e.getMonth()],t].join(` `)),Cs.apply(null,arguments))}function $s(e,t){if(!t||!Us(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}function ec(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var tc=Mr(Object.freeze({__proto__:null,format:Cs,deprecate:ws,debuglog:Ds,inspect:Os,isArray:Ps,isBoolean:Fs,isNull:Is,isNullOrUndefined:Ls,isNumber:Rs,isString:zs,isSymbol:Bs,isUndefined:Vs,isRegExp:Hs,isObject:Us,isDate:Ws,isError:Gs,isFunction:Ks,isPrimitive:qs,isBuffer:Js,log:Qs,inherits:xs,_extend:$s,default:{inherits:xs,_extend:$s,log:Qs,isBuffer:Js,isPrimitive:qs,isFunction:Ks,isError:Gs,isDate:Ws,isObject:Us,isRegExp:Hs,isUndefined:Vs,isSymbol:Bs,isString:zs,isNumber:Rs,isNullOrUndefined:Ls,isNull:Is,isBoolean:Fs,isArray:Ps,inspect:Os,deprecate:ws,format:Cs,debuglog:Ds}})).inspect,nc=typeof Map==`function`&&Map.prototype,rc=Object.getOwnPropertyDescriptor&&nc?Object.getOwnPropertyDescriptor(Map.prototype,`size`):null,ic=nc&&rc&&typeof rc.get==`function`?rc.get:null,ac=nc&&Map.prototype.forEach,oc=typeof Set==`function`&&Set.prototype,sc=Object.getOwnPropertyDescriptor&&oc?Object.getOwnPropertyDescriptor(Set.prototype,`size`):null,cc=oc&&sc&&typeof sc.get==`function`?sc.get:null,lc=oc&&Set.prototype.forEach,uc=typeof WeakMap==`function`&&WeakMap.prototype?WeakMap.prototype.has:null,dc=typeof WeakSet==`function`&&WeakSet.prototype?WeakSet.prototype.has:null,fc=typeof WeakRef==`function`&&WeakRef.prototype?WeakRef.prototype.deref:null,pc=Boolean.prototype.valueOf,mc=Object.prototype.toString,hc=Function.prototype.toString,gc=String.prototype.match,_c=String.prototype.slice,vc=String.prototype.replace,yc=String.prototype.toUpperCase,bc=String.prototype.toLowerCase,xc=RegExp.prototype.test,Sc=Array.prototype.concat,Cc=Array.prototype.join,wc=Array.prototype.slice,Tc=Math.floor,Ec=typeof BigInt==`function`?BigInt.prototype.valueOf:null,Dc=Object.getOwnPropertySymbols,Oc=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?Symbol.prototype.toString:null,kc=typeof Symbol==`function`&&typeof Symbol.iterator==`object`,Ac=typeof Symbol==`function`&&Symbol.toStringTag&&(typeof Symbol.toStringTag===kc||`symbol`)?Symbol.toStringTag:null,jc=Object.prototype.propertyIsEnumerable,Mc=(typeof Reflect==`function`?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function Nc(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&1e3>e||xc.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e==`number`){var r=0>e?-Tc(-e):Tc(e);if(r!==e){var i=r+``,a=_c.call(t,i.length+1);return vc.call(i,n,`$&_`)+`.`+vc.call(vc.call(a,/([0-9]{3})/g,`$&_`),/_$/,``)}}return vc.call(t,n,`$&_`)}var Pc=tc.custom,Fc=Vc(Pc)?Pc:null,Ic=function e(t,n,r,i){var a=n||{};if(Uc(a,`quoteStyle`)&&a.quoteStyle!==`single`&&a.quoteStyle!==`double`)throw TypeError(`option "quoteStyle" must be "single" or "double"`);if(Uc(a,`maxStringLength`)&&(typeof a.maxStringLength==`number`?0>a.maxStringLength&&a.maxStringLength!==1/0:a.maxStringLength!==null))throw TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=!Uc(a,`customInspect`)||a.customInspect;if(typeof o!=`boolean`&&o!==`symbol`)throw TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Uc(a,`indent`)&&a.indent!==null&&a.indent!==`	`&&(parseInt(a.indent,10)!==a.indent||0>=a.indent))throw TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Uc(a,`numericSeparator`)&&typeof a.numericSeparator!=`boolean`)throw TypeError('option "numericSeparator", if provided, must be `true` or `false`');var s=a.numericSeparator;if(t===void 0)return`undefined`;if(t===null)return`null`;if(typeof t==`boolean`)return t?`true`:`false`;if(typeof t==`string`)return Kc(t,a);if(typeof t==`number`){if(t===0)return 1/0/t>0?`0`:`-0`;var c=t+``;return s?Nc(t,c):c}if(typeof t==`bigint`){var l=t+`n`;return s?Nc(t,l):l}var u=a.depth===void 0?5:a.depth;if(r===void 0&&(r=0),r>=u&&u>0&&typeof t==`object`)return zc(t)?`[Array]`:`[Object]`;var d=function(e,t){var n;if(e.indent===`	`)n=`	`;else{if(typeof e.indent!=`number`||0>=e.indent)return null;n=Cc.call(Array(e.indent+1),` `)}return{base:n,prev:Cc.call(Array(t+1),n)}}(a,r);if(i===void 0)i=[];else if(Gc(i,t)>=0)return`[Circular]`;function f(t,n,o){if(n&&(i=wc.call(i)).push(n),o){var s={depth:a.depth};return Uc(a,`quoteStyle`)&&(s.quoteStyle=a.quoteStyle),e(t,s,r+1,i)}return e(t,a,r+1,i)}if(typeof t==`function`&&!Bc(t)){var p=function(e){if(e.name)return e.name;var t=gc.call(hc.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),m=Qc(t,f);return`[Function`+(p?`: `+p:` (anonymous)`)+`]`+(m.length>0?` { `+Cc.call(m,`, `)+` }`:``)}if(Vc(t)){var h=kc?vc.call(t+``,/^(Symbol\(.*\))_[^)]*$/,`$1`):Oc.call(t);return typeof t!=`object`||kc?h:Jc(h)}if(function(e){return!e||typeof e!=`object`?!1:typeof HTMLElement<`u`&&e instanceof HTMLElement?!0:typeof e.nodeName==`string`&&typeof e.getAttribute==`function`}(t)){for(var g=`<`+bc.call(t.nodeName+``),_=t.attributes||[],v=0;_.length>v;v++)g+=` `+_[v].name+`=`+Lc(Rc(_[v].value),`double`,a);return g+=`>`,t.childNodes&&t.childNodes.length&&(g+=`...`),g+=`</`+bc.call(t.nodeName+``)+`>`}if(zc(t)){if(t.length===0)return`[]`;var y=Qc(t,f);return d&&!function(e){for(var t=0;e.length>t;t++)if(Gc(e[t],`
`)>=0)return!1;return!0}(y)?`[`+Zc(y,d)+`]`:`[ `+Cc.call(y,`, `)+` ]`}if(function(e){return!(Wc(e)!==`[object Error]`||Ac&&typeof e==`object`&&Ac in e)}(t)){var b=Qc(t,f);return`cause`in Error.prototype||!(`cause`in t)||jc.call(t,`cause`)?b.length===0?`[`+t+`]`:`{ [`+t+`] `+Cc.call(b,`, `)+` }`:`{ [`+t+`] `+Cc.call(Sc.call(`[cause]: `+f(t.cause),b),`, `)+` }`}if(typeof t==`object`&&o){if(Fc&&typeof t[Fc]==`function`&&tc)return tc(t,{depth:u-r});if(o!==`symbol`&&typeof t.inspect==`function`)return t.inspect()}if(function(e){if(!ic||!e||typeof e!=`object`)return!1;try{ic.call(e);try{cc.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}(t)){var x=[];return ac&&ac.call(t,(function(e,n){x.push(f(n,t,!0)+` => `+f(e,t))})),Xc(`Map`,ic.call(t),x,d)}if(function(e){if(!cc||!e||typeof e!=`object`)return!1;try{cc.call(e);try{ic.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}(t)){var S=[];return lc&&lc.call(t,(function(e){S.push(f(e,t))})),Xc(`Set`,cc.call(t),S,d)}if(function(e){if(!uc||!e||typeof e!=`object`)return!1;try{uc.call(e,uc);try{dc.call(e,dc)}catch{return!0}return e instanceof WeakMap}catch{}return!1}(t))return Yc(`WeakMap`);if(function(e){if(!dc||!e||typeof e!=`object`)return!1;try{dc.call(e,dc);try{uc.call(e,uc)}catch{return!0}return e instanceof WeakSet}catch{}return!1}(t))return Yc(`WeakSet`);if(function(e){if(!fc||!e||typeof e!=`object`)return!1;try{return fc.call(e),!0}catch{}return!1}(t))return Yc(`WeakRef`);if(function(e){return!(Wc(e)!==`[object Number]`||Ac&&typeof e==`object`&&Ac in e)}(t))return Jc(f(Number(t)));if(function(e){if(!e||typeof e!=`object`||!Ec)return!1;try{return Ec.call(e),!0}catch{}return!1}(t))return Jc(f(Ec.call(t)));if(function(e){return!(Wc(e)!==`[object Boolean]`||Ac&&typeof e==`object`&&Ac in e)}(t))return Jc(pc.call(t));if(function(e){return!(Wc(e)!==`[object String]`||Ac&&typeof e==`object`&&Ac in e)}(t))return Jc(f(t+``));if(typeof window<`u`&&t===window)return`{ [object Window] }`;if(typeof globalThis<`u`&&t===globalThis||Ar!==void 0&&t===Ar)return`{ [object globalThis] }`;if(!function(e){return!(Wc(e)!==`[object Date]`||Ac&&typeof e==`object`&&Ac in e)}(t)&&!Bc(t)){var C=Qc(t,f),w=Mc?Mc(t)===Object.prototype:t instanceof Object||t.constructor===Object,E=t instanceof Object?``:`null prototype`,D=!w&&Ac&&Object(t)===t&&Ac in t?_c.call(Wc(t),8,-1):E?`Object`:``,O=(w||typeof t.constructor!=`function`?``:t.constructor.name?t.constructor.name+` `:``)+(D||E?`[`+Cc.call(Sc.call([],D||[],E||[]),`: `)+`] `:``);return C.length===0?O+`{}`:d?O+`{`+Zc(C,d)+`}`:O+`{ `+Cc.call(C,`, `)+` }`}return t+``};function Lc(e,t,n){var r=(n.quoteStyle||t)===`double`?`"`:`'`;return r+e+r}function Rc(e){return vc.call(e+``,/"/g,`&quot;`)}function zc(e){return!(Wc(e)!==`[object Array]`||Ac&&typeof e==`object`&&Ac in e)}function Bc(e){return!(Wc(e)!==`[object RegExp]`||Ac&&typeof e==`object`&&Ac in e)}function Vc(e){if(kc)return e&&typeof e==`object`&&e instanceof Symbol;if(typeof e==`symbol`)return!0;if(!e||typeof e!=`object`||!Oc)return!1;try{return Oc.call(e),!0}catch{}return!1}var Hc=Object.prototype.hasOwnProperty||function(e){return e in this};function Uc(e,t){return Hc.call(e,t)}function Wc(e){return mc.call(e)}function Gc(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1}function Kc(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r=`... `+n+` more character`+(n>1?`s`:``);return Kc(_c.call(e,0,t.maxStringLength),t)+r}return Lc(vc.call(vc.call(e,/(['\\])/g,`\\$1`),/[\x00-\x1f]/g,qc),`single`,t)}function qc(e){var t=e.charCodeAt(0),n={8:`b`,9:`t`,10:`n`,12:`f`,13:`r`}[t];return n?`\\`+n:`\\x`+(16>t?`0`:``)+yc.call(t.toString(16))}function Jc(e){return`Object(`+e+`)`}function Yc(e){return e+` { ? }`}function Xc(e,t,n,r){return e+` (`+t+`) {`+(r?Zc(n,r):Cc.call(n,`, `))+`}`}function Zc(e,t){if(e.length===0)return``;var n=`
`+t.prev+t.base;return n+Cc.call(e,`,`+n)+`
`+t.prev}function Qc(e,t){var n=zc(e),r=[];if(n){r.length=e.length;for(var i=0;e.length>i;i++)r[i]=Uc(e,i)?t(e[i],e):``}var a,o=typeof Dc==`function`?Dc(e):[];if(kc){a={};for(var s=0;o.length>s;s++)a[`$`+o[s]]=o[s]}for(var c in e)Uc(e,c)&&(n&&Number(c)+``===c&&e.length>c||kc&&a[`$`+c]instanceof Symbol||(xc.call(/[^\w$]/,c)?r.push(t(c,e)+`: `+t(e[c],e)):r.push(c+`: `+t(e[c],e))));if(typeof Dc==`function`)for(var l=0;o.length>l;l++)jc.call(e,o[l])&&r.push(`[`+t(o[l])+`]: `+t(e[o[l]],e));return r}var $c=xa(`%WeakMap%`,!0),el=xa(`%Map%`,!0),tl=Ba(`WeakMap.prototype.get`,!0),nl=Ba(`WeakMap.prototype.set`,!0),rl=Ba(`WeakMap.prototype.has`,!0),il=Ba(`Map.prototype.get`,!0),al=Ba(`Map.prototype.set`,!0),ol=Ba(`Map.prototype.has`,!0),sl=function(e,t){for(var n,r=e;(n=r.next)!==null;r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n},cl=function(){var e,t,n,r={assert:function(e){if(!r.has(e))throw new Ui(`Side channel does not contain `+Ic(e))},get:function(r){if($c&&r&&(typeof r==`object`||typeof r==`function`)){if(e)return tl(e,r)}else if(el){if(t)return il(t,r)}else if(n)return function(e,t){var n=sl(e,t);return n&&n.value}(n,r)},has:function(r){if($c&&r&&(typeof r==`object`||typeof r==`function`)){if(e)return rl(e,r)}else if(el){if(t)return ol(t,r)}else if(n)return function(e,t){return!!sl(e,t)}(n,r);return!1},set:function(r,i){$c&&r&&(typeof r==`object`||typeof r==`function`)?(e||=new $c,nl(e,r,i)):el?(t||=new el,al(t,r,i)):(n||={key:{},next:null},function(e,t,n){var r=sl(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(n,r,i))}};return r},ll=cl(),ul={assert:function(e,t){if(!e||typeof e!=`object`&&typeof e!=`function`)throw new Ui("`O` is not an object");if(typeof t!=`string`)throw new Ui("`slot` must be a string");if(ll.assert(e),!ul.has(e,t))throw new Ui("`"+t+"` is not present on `O`")},get:function(e,t){if(!e||typeof e!=`object`&&typeof e!=`function`)throw new Ui("`O` is not an object");if(typeof t!=`string`)throw new Ui("`slot` must be a string");var n=ll.get(e);return n&&n[`$`+t]},has:function(e,t){if(!e||typeof e!=`object`&&typeof e!=`function`)throw new Ui("`O` is not an object");if(typeof t!=`string`)throw new Ui("`slot` must be a string");var n=ll.get(e);return!!n&&ea(n,`$`+t)},set:function(e,t,n){if(!e||typeof e!=`object`&&typeof e!=`function`)throw new Ui("`O` is not an object");if(typeof t!=`string`)throw new Ui("`slot` must be a string");var r=ll.get(e);r||ll.set(e,r={}),r[`$`+t]=n}};Object.freeze&&Object.freeze(ul);var dl,fl=ul,pl=SyntaxError,ml=typeof StopIteration==`object`?StopIteration:null,hl=function(e){if(!ml)throw new pl(`this environment lacks StopIteration`);fl.set(e,`[[Done]]`,!1);var t={next:function(){var e=fl.get(this,`[[Iterator]]`),t=fl.get(e,`[[Done]]`);try{return{done:t,value:t?void 0:e.next()}}catch(t){if(fl.set(e,`[[Done]]`,!0),t!==ml)throw t;return{done:!0,value:void 0}}}};return fl.set(t,`[[Iterator]]`,e),t},gl={}.toString,_l=Array.isArray||function(e){return gl.call(e)==`[object Array]`},vl=String.prototype.valueOf,yl=Object.prototype.toString,bl=_o(),xl=function(e){return typeof e==`string`||typeof e==`object`&&(bl?function(e){try{return vl.call(e),!0}catch{return!1}}(e):yl.call(e)===`[object String]`)},Sl=typeof Map==`function`&&Map.prototype?Map:null,Cl=typeof Set==`function`&&Set.prototype?Set:null;Sl||(dl=function(e){return!1});var wl=Sl?Map.prototype.has:null,Tl=Cl?Set.prototype.has:null;dl||wl||(dl=function(e){return!1});var El,Dl=dl||function(e){if(!e||typeof e!=`object`)return!1;try{if(wl.call(e),Tl)try{Tl.call(e)}catch{return!0}return e instanceof Sl}catch{}return!1},Ol=typeof Map==`function`&&Map.prototype?Map:null,kl=typeof Set==`function`&&Set.prototype?Set:null;kl||(El=function(e){return!1});var Al=Ol?Map.prototype.has:null,jl=kl?Set.prototype.has:null;El||jl||(El=function(e){return!1});var Ml=El||function(e){if(!e||typeof e!=`object`)return!1;try{if(jl.call(e),Al)try{Al.call(e)}catch{return!0}return e instanceof kl}catch{}return!1},Nl=jr((function(e){if(qi()||Gi()){var t=Symbol.iterator;e.exports=function(e){return e!=null&&e[t]!==void 0?e[t]():Co(e)?Array.prototype[t].call(e):void 0}}else{var n=_l,r=xl,i=xa,a=i(`%Map%`,!0),o=i(`%Set%`,!0),s=Ba,c=s(`Array.prototype.push`),l=s(`String.prototype.charCodeAt`),u=s(`String.prototype.slice`),d=function(e){var t=0;return{next:function(){var n,r=t>=e.length;return r||(n=e[t],t+=1),{done:r,value:n}}}},f=function(e,t){if(n(e)||Co(e))return d(e);if(r(e)){var i=0;return{next:function(){var t=function(e,t){if(t+1>=e.length)return t+1;var n=l(e,t);if(55296>n||n>56319)return t+1;var r=l(e,t+1);return 56320>r||r>57343?t+1:t+2}(e,i),n=u(e,i,t);return i=t,{done:t>e.length,value:n}}}}return t&&e[`_es6-shim iterator_`]!==void 0?e[`_es6-shim iterator_`]():void 0};if(a||o){var p=Dl,m=Ml,h=s(`Map.prototype.forEach`,!0),g=s(`Set.prototype.forEach`,!0);if(k===void 0||!k.versions||!k.versions.node)var _=s(`Map.prototype.iterator`,!0),v=s(`Set.prototype.iterator`,!0);var y=s(`Map.prototype.@@iterator`,!0)||s(`Map.prototype._es6-shim iterator_`,!0),b=s(`Set.prototype.@@iterator`,!0)||s(`Set.prototype._es6-shim iterator_`,!0);e.exports=function(e){return function(e){if(p(e)){if(_)return hl(_(e));if(y)return y(e);if(h){var t=[];return h(e,(function(e,n){c(t,[n,e])})),d(t)}}if(m(e)){if(v)return hl(v(e));if(b)return b(e);if(g){var n=[];return g(e,(function(e){c(n,e)})),d(n)}}}(e)||f(e)}}else e.exports=function(e){if(e!=null)return f(e,!0)}}})),Pl=function(e){return e!=e},Fl=function(e,t){return e===0&&t===0?1/e==1/t:e===t||!(!Pl(e)||!Pl(t))},Il=function(){return typeof Object.is==`function`?Object.is:Fl},Ll=Ra(Il(),Object);Fa(Ll,{getPolyfill:Il,implementation:Fl,shim:function(){var e=Il();return Fa(Object,{is:e},{is:function(){return Object.is!==e}}),e}});var Rl,zl,Bl,Vl,Hl=Ll,Ul=xa(`%ArrayBuffer%`,!0),Wl=Ba(`ArrayBuffer.prototype.byteLength`,!0),Gl=Ba(`Object.prototype.toString`),Kl=!!Ul&&!Wl&&new Ul(0).slice,ql=!!Kl&&Ra(Kl),Jl=Wl||ql?function(e){if(!e||typeof e!=`object`)return!1;try{return Wl?Wl(e):ql(e,0),!0}catch{return!1}}:Ul?function(e){return Gl(e)===`[object ArrayBuffer]`}:function(e){return!1},Yl=Date.prototype.getDay,Xl=Object.prototype.toString,Zl=_o(),Ql=function(e){return typeof e==`object`&&!!e&&(Zl?function(e){try{return Yl.call(e),!0}catch{return!1}}(e):Xl.call(e)===`[object Date]`)},$l=_o();if($l){Rl=Ba(`Object.prototype.hasOwnProperty`),zl=Ba(`RegExp.prototype.exec`),Bl={};var eu=function(){throw Bl};Vl={toString:eu,valueOf:eu},typeof Symbol.toPrimitive==`symbol`&&(Vl[Symbol.toPrimitive]=eu)}var tu,nu=Ba(`Object.prototype.toString`),ru=Object.getOwnPropertyDescriptor,iu=$l?function(e){if(!e||typeof e!=`object`)return!1;var t=ru(e,`lastIndex`);if(!(t&&Rl(t,`value`)))return!1;try{zl(e,Vl)}catch(e){return e===Bl}}:function(e){return!(!e||typeof e!=`object`&&typeof e!=`function`)&&nu(e)===`[object RegExp]`},au=Ba(`SharedArrayBuffer.prototype.byteLength`,!0),ou=au?function(e){if(!e||typeof e!=`object`)return!1;try{return au(e),!0}catch{return!1}}:function(e){return!1},su=Number.prototype.toString,cu=Object.prototype.toString,lu=_o(),uu=function(e){return typeof e==`number`||typeof e==`object`&&(lu?function(e){try{return su.call(e),!0}catch{return!1}}(e):cu.call(e)===`[object Number]`)},du=Ba(`Boolean.prototype.toString`),fu=Ba(`Object.prototype.toString`),pu=_o(),mu=function(e){return typeof e==`boolean`||typeof e==`object`&&!!e&&(pu&&Symbol.toStringTag in e?function(e){try{return du(e),!0}catch{return!1}}(e):fu(e)===`[object Boolean]`)},hu=jr((function(e){var t=Object.prototype.toString;if(qi()){var n=Symbol.prototype.toString,r=/^Symbol\(.*\)$/;e.exports=function(e){if(typeof e==`symbol`)return!0;if(t.call(e)!==`[object Symbol]`)return!1;try{return function(e){return typeof e.valueOf()==`symbol`&&r.test(n.call(e))}(e)}catch{return!1}}}else e.exports=function(e){return!1}})),gu=typeof BigInt<`u`&&BigInt,_u=jr((function(e){if(typeof gu==`function`&&typeof BigInt==`function`&&typeof gu(42)==`bigint`&&typeof BigInt(42)==`bigint`){var t=BigInt.prototype.valueOf;e.exports=function(e){return e!=null&&typeof e!=`boolean`&&typeof e!=`string`&&typeof e!=`number`&&typeof e!=`symbol`&&typeof e!=`function`&&(typeof e==`bigint`||function(e){try{return t.call(e),!0}catch{}return!1}(e))}}else e.exports=function(e){return!1}})),vu=function(e){return e==null||typeof e!=`object`&&typeof e!=`function`?null:xl(e)?`String`:uu(e)?`Number`:mu(e)?`Boolean`:hu(e)?`Symbol`:_u(e)?`BigInt`:void 0},yu=typeof WeakMap==`function`&&WeakMap.prototype?WeakMap:null,bu=typeof WeakSet==`function`&&WeakSet.prototype?WeakSet:null;yu||(tu=function(e){return!1});var xu=yu?yu.prototype.has:null,Su=bu?bu.prototype.has:null;tu||xu||(tu=function(e){return!1});var Cu,wu,Tu=tu||function(e){if(!e||typeof e!=`object`)return!1;try{if(xu.call(e,xu),Su)try{Su.call(e,Su)}catch{return!0}return e instanceof yu}catch{}return!1},Eu=jr((function(e){var t=xa(`%WeakSet%`,!0),n=Ba(`WeakSet.prototype.has`,!0);if(n){var r=Ba(`WeakMap.prototype.has`,!0);e.exports=function(e){if(!e||typeof e!=`object`)return!1;try{if(n(e,n),r)try{r(e,r)}catch{return!0}return e instanceof t}catch{}return!1}}else e.exports=function(e){return!1}})),Du=function(e){if(e&&typeof e==`object`){if(Dl(e))return`Map`;if(Ml(e))return`Set`;if(Tu(e))return`WeakMap`;if(Eu(e))return`WeakSet`}return!1},Ou=Function.prototype.toString,ku=typeof Reflect==`object`&&Reflect!==null&&Reflect.apply;if(typeof ku==`function`&&typeof Object.defineProperty==`function`)try{Cu=Object.defineProperty({},`length`,{get:function(){throw wu}}),wu={},ku((function(){throw 42}),null,Cu)}catch(e){e!==wu&&(ku=null)}else ku=null;var Au=/^\s*class\b/,ju=function(e){try{var t=Ou.call(e);return Au.test(t)}catch{return!1}},Mu=function(e){try{return!ju(e)&&(Ou.call(e),!0)}catch{return!1}},Nu=Object.prototype.toString,Pu=typeof Symbol==`function`&&!!Symbol.toStringTag,Fu=!(0 in[,]),Iu=function(){return!1};if(typeof document==`object`){var Lu=document.all;Nu.call(Lu)===Nu.call(document.all)&&(Iu=function(e){if((Fu||!e)&&(e===void 0||typeof e==`object`))try{var t=Nu.call(e);return(t===`[object HTMLAllCollection]`||t===`[object HTML document.all class]`||t===`[object HTMLCollection]`||t===`[object Object]`)&&e(``)==null}catch{}return!1})}var Ru=ku?function(e){if(Iu(e))return!0;if(!e||typeof e!=`function`&&typeof e!=`object`)return!1;try{ku(e,null,Cu)}catch(e){if(e!==wu)return!1}return!ju(e)&&Mu(e)}:function(e){if(Iu(e))return!0;if(!e||typeof e!=`function`&&typeof e!=`object`)return!1;if(Pu)return Mu(e);if(ju(e))return!1;var t=Nu.call(e);return!(t!==`[object Function]`&&t!==`[object GeneratorFunction]`&&!/^\[object HTML/.test(t))&&Mu(e)},zu=Object.prototype.toString,Bu=Object.prototype.hasOwnProperty,Vu=function(e,t,n){if(!Ru(t))throw TypeError(`iterator must be a function`);var r;3>arguments.length||(r=n),zu.call(e)===`[object Array]`?function(e,t,n){for(var r=0,i=e.length;i>r;r++)Bu.call(e,r)&&(n==null?t(e[r],r,e):t.call(n,e[r],r,e))}(e,t,r):typeof e==`string`?function(e,t,n){for(var r=0,i=e.length;i>r;r++)n==null?t(e.charAt(r),r,e):t.call(n,e.charAt(r),r,e)}(e,t,r):function(e,t,n){for(var r in e)Bu.call(e,r)&&(n==null?t(e[r],r,e):t.call(n,e[r],r,e))}(e,t,r)},Hu=[`Float32Array`,`Float64Array`,`Int8Array`,`Int16Array`,`Int32Array`,`Uint8Array`,`Uint8ClampedArray`,`Uint16Array`,`Uint32Array`,`BigInt64Array`,`BigUint64Array`],Uu=typeof globalThis>`u`?Ar:globalThis,Wu=Ba(`Object.prototype.toString`),Gu=_o(),Ku=typeof globalThis>`u`?Ar:globalThis,qu=function(){for(var e=[],t=0;Hu.length>t;t++)typeof Uu[Hu[t]]==`function`&&(e[e.length]=Hu[t]);return e}(),Ju=Ba(`String.prototype.slice`),Yu=Object.getPrototypeOf,Xu=Ba(`Array.prototype.indexOf`,!0)||function(e,t){for(var n=0;e.length>n;n+=1)if(e[n]===t)return n;return-1},Zu={__proto__:null};Vu(qu,Gu&&Ta&&Yu?function(e){var t=new Ku[e];if(Symbol.toStringTag in t){var n=Yu(t),r=Ta(n,Symbol.toStringTag);r||=Ta(Yu(n),Symbol.toStringTag),Zu[`$`+e]=Ra(r.get)}}:function(e){var t=new Ku[e],n=t.slice||t.set;n&&(Zu[`$`+e]=Ra(n))});var Qu=function(e){if(!e||typeof e!=`object`)return!1;if(!Gu){var t=Ju(Wu(e),8,-1);return Xu(qu,t)>-1?t:t===`Object`&&function(e){var t=!1;return Vu(Zu,(function(n,r){if(!t)try{n(e),t=Ju(r,1)}catch{}})),t}(e)}return Ta?function(e){var t=!1;return Vu(Zu,(function(n,r){if(!t)try{`$`+n(e)===r&&(t=Ju(r,1))}catch{}})),t}(e):null},$u=Ba(`ArrayBuffer.prototype.byteLength`,!0),ed=function(e){return Jl(e)?$u?$u(e):e.byteLength:NaN},td=Ba(`SharedArrayBuffer.prototype.byteLength`,!0),nd=Ba(`Date.prototype.getTime`),rd=Object.getPrototypeOf,id=Ba(`Object.prototype.toString`),ad=xa(`%Set%`,!0),od=Ba(`Map.prototype.has`,!0),sd=Ba(`Map.prototype.get`,!0),cd=Ba(`Map.prototype.size`,!0),ld=Ba(`Set.prototype.add`,!0),ud=Ba(`Set.prototype.delete`,!0),dd=Ba(`Set.prototype.has`,!0),fd=Ba(`Set.prototype.size`,!0);function pd(e,t,n,r){for(var i,a=Nl(e);(i=a.next())&&!i.done;)if(vd(t,i.value,n,r))return ud(e,i.value),!0;return!1}function md(e){return e===void 0?null:typeof e==`object`?void 0:typeof e!=`symbol`&&(typeof e!=`string`&&typeof e!=`number`||+e==+e)}function hd(e,t,n,r,i,a){var o=md(n);if(o!=null)return o;var s=sd(t,o),c=Xa({},i,{strict:!1});return!(s===void 0&&!od(t,o)||!vd(r,s,c,a))&&!od(e,o)&&vd(r,s,c,a)}function gd(e,t,n){var r=md(n);return r??(dd(t,r)&&!dd(e,r))}function _d(e,t,n,r,i,a){for(var o,s,c=Nl(e);(o=c.next())&&!o.done;)if(vd(n,s=o.value,i,a)&&vd(r,sd(t,s),i,a))return ud(e,s),!0;return!1}function vd(e,t,n,r){var i=n||{};if(i.strict?Hl(e,t):e===t)return!0;if(vu(e)!==vu(t))return!1;if(!e||!t||typeof e!=`object`&&typeof t!=`object`)return i.strict?Hl(e,t):e==t;var a,o=r.has(e),s=r.has(t);if(o&&s){if(r.get(e)===r.get(t))return!0}else a={};return o||r.set(e,a),s||r.set(t,a),function(e,t,n,r){var i,a;if(typeof e!=typeof t||e==null||t==null||id(e)!==id(t)||Co(e)!==Co(t)||_l(e)!==_l(t))return!1;var o=e instanceof Error,s=t instanceof Error;if(o!==s||(o||s)&&(e.name!==t.name||e.message!==t.message))return!1;var c=iu(e),l=iu(t);if(c!==l||(c||l)&&(e.source!==t.source||go(e)!==go(t)))return!1;var u=Ql(e),d=Ql(t);if(u!==d||(u||d)&&nd(e)!==nd(t)||n.strict&&rd&&rd(e)!==rd(t))return!1;var f=Qu(e),p=Qu(t);if(f!==p)return!1;if(f||p){if(e.length!==t.length)return!1;for(i=0;e.length>i;i++)if(e[i]!==t[i])return!1;return!0}var m=yd(e),h=yd(t);if(m!==h)return!1;if(m||h){if(e.length!==t.length)return!1;for(i=0;e.length>i;i++)if(e[i]!==t[i])return!1;return!0}var g=Jl(e),_=Jl(t);if(g!==_)return!1;if(g||_)return ed(e)===ed(t)&&typeof Uint8Array==`function`&&vd(new Uint8Array(e),new Uint8Array(t),n,r);var v=ou(e),y=ou(t);if(v!==y)return!1;if(v||y)return td(e)===td(t)&&typeof Uint8Array==`function`&&vd(new Uint8Array(e),new Uint8Array(t),n,r);if(typeof e!=typeof t)return!1;var b=Li(e),x=Li(t);if(b.length!==x.length)return!1;for(b.sort(),x.sort(),i=b.length-1;i>=0;i--)if(b[i]!=x[i])return!1;for(i=b.length-1;i>=0;i--)if(!vd(e[a=b[i]],t[a],n,r))return!1;var S=Du(e),C=Du(t);return S===C?S===`Set`||C===`Set`?function(e,t,n,r){if(fd(e)!==fd(t))return!1;for(var i,a,o,s=Nl(e),c=Nl(t);(i=s.next())&&!i.done;)if(i.value&&typeof i.value==`object`)o||=new ad,ld(o,i.value);else if(!dd(t,i.value)){if(n.strict||!gd(e,t,i.value))return!1;o||=new ad,ld(o,i.value)}if(o){for(;(a=c.next())&&!a.done;)if(a.value&&typeof a.value==`object`){if(!pd(o,a.value,n.strict,r))return!1}else if(!n.strict&&!dd(e,a.value)&&!pd(o,a.value,n.strict,r))return!1;return fd(o)===0}return!0}(e,t,n,r):S===`Map`?function(e,t,n,r){if(cd(e)!==cd(t))return!1;for(var i,a,o,s,c,l,u=Nl(e),d=Nl(t);(i=u.next())&&!i.done;)if(c=i.value[1],(s=i.value[0])&&typeof s==`object`)o||=new ad,ld(o,s);else if((l=sd(t,s))===void 0&&!od(t,s)||!vd(c,l,n,r)){if(n.strict||!hd(e,t,s,c,n,r))return!1;o||=new ad,ld(o,s)}if(o){for(;(a=d.next())&&!a.done;)if(l=a.value[1],(s=a.value[0])&&typeof s==`object`){if(!_d(o,e,s,l,n,r))return!1}else if(!(n.strict||e.has(s)&&vd(sd(e,s),l,n,r)||_d(o,e,s,l,Xa({},n,{strict:!1}),r)))return!1;return fd(o)===0}return!0}(e,t,n,r):!0:!1}(e,t,i,r)}function yd(e){return!(!e||typeof e!=`object`||typeof e.length!=`number`)&&typeof e.copy==`function`&&typeof e.slice==`function`&&(0>=e.length||typeof e[0]==`number`)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}var bd=Object.defineProperty,xd=(e,t)=>bd(e,`name`,{value:t,configurable:!0});function Sd(e,t){return e.coordinates?e.coordinates.length===t.coordinates.length:e.length===t.length}function Cd(e){return e.coordinates.map((t=>({type:e.type.replace(`Multi`,``),coordinates:t})))}xd(class{constructor(e){var t,n;this.direction=!1,this.compareProperties=!0,this.precision=10**-(e?.precision??17),this.direction=(t=e?.direction)!=null&&t,this.compareProperties=(n=e?.compareProperties)==null||n}compare(e,t){if(e.type!==t.type||!Sd(e,t))return!1;switch(e.type){case`Point`:return this.compareCoord(e.coordinates,t.coordinates);case`LineString`:return this.compareLine(e.coordinates,t.coordinates);case`Polygon`:return this.comparePolygon(e,t);case`GeometryCollection`:return this.compareGeometryCollection(e,t);case`Feature`:return this.compareFeature(e,t);case`FeatureCollection`:return this.compareFeatureCollection(e,t);default:if(e.type.startsWith(`Multi`)){let n=Cd(e),r=Cd(t);return n.every((e=>r.some((t=>this.compare(e,t)))))}}return!1}compareCoord(e,t){return e.length===t.length&&e.every(((e,n)=>this.precision>Math.abs(e-t[n])))}compareLine(e,t,n=0,r=!1){if(!Sd(e,t))return!1;let i=e,a=t;if(r&&!this.compareCoord(i[0],a[0])){let e=this.fixStartIndex(a,i);if(!e)return!1;a=e}let o=this.compareCoord(i[n],a[n]);return this.direction||o?this.comparePath(i,a):!!this.compareCoord(i[n],a[a.length-(1+n)])&&this.comparePath(i.slice().reverse(),a)}fixStartIndex(e,t){let n,r=-1;for(let n=0;e.length>n;n++)if(this.compareCoord(e[n],t[0])){r=n;break}return 0>r||(n=[].concat(e.slice(r,e.length),e.slice(1,r+1))),n}comparePath(e,t){return e.every(((e,n)=>this.compareCoord(e,t[n])))}comparePolygon(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){let n=e.coordinates.slice(1,e.coordinates.length),r=t.coordinates.slice(1,t.coordinates.length);return n.every((e=>r.some((t=>this.compareLine(e,t,1,!0)))))}return!1}compareGeometryCollection(e,t){return Sd(e.geometries,t.geometries)&&this.compareBBox(e,t)&&e.geometries.every(((e,n)=>this.compare(e,t.geometries[n])))}compareFeature(e,t){return e.id===t.id&&(!this.compareProperties||vd(e.properties,t.properties,n,cl()))&&this.compareBBox(e,t)&&this.compare(e.geometry,t.geometry);var n}compareFeatureCollection(e,t){return Sd(e.features,t.features)&&this.compareBBox(e,t)&&e.features.every(((e,n)=>this.compare(e,t.features[n])))}compareBBox(e,t){return!(e.bbox||t.bbox)||!(!e.bbox||!t.bbox)&&this.compareCoord(e.bbox,t.bbox)}},`GeojsonEquality`),xd(Sd,`sameLength`),xd(Cd,`explode`);var wd=6371008.8,Td={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:wd,metres:wd,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:3440.069546436285,radians:1,yards:6967335.223679999},Ed={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:2.9155334959812285e-7,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Dd(e,t,n={}){let r={type:`Feature`};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function Od(e,t,n={}){if(!e)throw Error(`coordinates is required`);if(!Array.isArray(e))throw Error(`coordinates must be an Array`);if(2>e.length)throw Error(`coordinates must be at least 2 numbers long`);if(!Rd(e[0])||!Rd(e[1]))throw Error(`coordinates must contain numbers`);return Dd({type:`Point`,coordinates:e},t,n)}function kd(e,t,n={}){for(let t of e){if(4>t.length)throw Error(`Each LinearRing of a Polygon must have 4 or more Positions.`);if(t[t.length-1].length!==t[0].length)throw Error(`First and last Position are not equivalent.`);for(let e=0;t[t.length-1].length>e;e++)if(t[t.length-1][e]!==t[0][e])throw Error(`First and last Position are not equivalent.`)}return Dd({type:`Polygon`,coordinates:e},t,n)}function Ad(e,t,n={}){if(2>e.length)throw Error(`coordinates must be an array of two or more positions`);return Dd({type:`LineString`,coordinates:e},t,n)}function jd(e,t={}){let n={type:`FeatureCollection`};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function Md(e,t,n={}){return Dd({type:`MultiLineString`,coordinates:e},t,n)}function Nd(e,t,n={}){return Dd({type:`MultiPoint`,coordinates:e},t,n)}function Pd(e,t,n={}){return Dd({type:`MultiPolygon`,coordinates:e},t,n)}function Fd(e,t=`kilometers`){let n=Td[t];if(!n)throw Error(t+` units is invalid`);return e*n}function Id(e,t=`kilometers`){let n=Td[t];if(!n)throw Error(t+` units is invalid`);return e/n}function Ld(e){return 180*(e%(2*Math.PI))/Math.PI}function Rd(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function zd(e){return typeof e==`object`&&!!e&&!Array.isArray(e)}xd(Dd,`feature`),xd((function(e,t,n={}){switch(e){case`Point`:return Od(t).geometry;case`LineString`:return Ad(t).geometry;case`Polygon`:return kd(t).geometry;case`MultiPoint`:return Nd(t).geometry;case`MultiLineString`:return Md(t).geometry;case`MultiPolygon`:return Pd(t).geometry;default:throw Error(e+` is invalid`)}}),`geometry`),xd(Od,`point`),xd((function(e,t,n={}){return jd(e.map((e=>Od(e,t))),n)}),`points`),xd(kd,`polygon`),xd((function(e,t,n={}){return jd(e.map((e=>kd(e,t))),n)}),`polygons`),xd(Ad,`lineString`),xd((function(e,t,n={}){return jd(e.map((e=>Ad(e,t))),n)}),`lineStrings`),xd(jd,`featureCollection`),xd(Md,`multiLineString`),xd(Nd,`multiPoint`),xd(Pd,`multiPolygon`),xd((function(e,t,n={}){return Dd({type:`GeometryCollection`,geometries:e},t,n)}),`geometryCollection`),xd((function(e,t=0){if(t&&t<0)throw Error(`precision must be a positive number`);let n=10**(t||0);return Math.round(e*n)/n}),`round`),xd(Fd,`radiansToLength`),xd(Id,`lengthToRadians`),xd((function(e,t){return Ld(Id(e,t))}),`lengthToDegrees`),xd((function(e){let t=e%360;return 0>t&&(t+=360),t}),`bearingToAzimuth`),xd(Ld,`radiansToDegrees`),xd((function(e){return e%360*Math.PI/180}),`degreesToRadians`),xd((function(e,t=`kilometers`,n=`kilometers`){if(e<0)throw Error(`length must be a positive number`);return Fd(Id(e,t),n)}),`convertLength`),xd((function(e,t=`meters`,n=`kilometers`){if(e<0)throw Error(`area must be a positive number`);let r=Ed[t];if(!r)throw Error(`invalid original units`);let i=Ed[n];if(!i)throw Error(`invalid final units`);return e/r*i}),`convertArea`),xd(Rd,`isNumber`),xd(zd,`isObject`),xd((function(e){if(!e)throw Error(`bbox is required`);if(!Array.isArray(e))throw Error(`bbox must be an Array`);if(e.length!==4&&e.length!==6)throw Error(`bbox must be an Array of 4 or 6 numbers`);e.forEach((e=>{if(!Rd(e))throw Error(`bbox must only contain numbers`)}))}),`validateBBox`),xd((function(e){if(!e)throw Error(`id is required`);if([`string`,`number`].indexOf(typeof e)===-1)throw Error(`id must be a number or a string`)}),`validateId`);var Bd=Object.defineProperty,Vd=(e,t)=>Bd(e,`name`,{value:t,configurable:!0});function Hd(e,t,n){if(e!==null)for(var r,i,a,o,s,c,l,u,d=0,f=0,p=e.type,m=p===`FeatureCollection`,h=p===`Feature`,g=m?e.features.length:1,_=0;g>_;_++){s=(u=!!(l=m?e.features[_].geometry:h?e.geometry:e)&&l.type===`GeometryCollection`)?l.geometries.length:1;for(var v=0;s>v;v++){var y=0,b=0;if((o=u?l.geometries[v]:l)!==null){c=o.coordinates;var x=o.type;switch(d=!n||x!==`Polygon`&&x!==`MultiPolygon`?0:1,x){case null:break;case`Point`:if(!1===t(c,f,_,y,b))return!1;f++,y++;break;case`LineString`:case`MultiPoint`:for(r=0;c.length>r;r++){if(!1===t(c[r],f,_,y,b))return!1;f++,x===`MultiPoint`&&y++}x===`LineString`&&y++;break;case`Polygon`:case`MultiLineString`:for(r=0;c.length>r;r++){for(i=0;c[r].length-d>i;i++){if(!1===t(c[r][i],f,_,y,b))return!1;f++}x===`MultiLineString`&&y++,x===`Polygon`&&b++}x===`Polygon`&&y++;break;case`MultiPolygon`:for(r=0;c.length>r;r++){for(b=0,i=0;c[r].length>i;i++){for(a=0;c[r][i].length-d>a;a++){if(!1===t(c[r][i][a],f,_,y,b))return!1;f++}b++}y++}break;case`GeometryCollection`:for(r=0;o.geometries.length>r;r++)if(!1===Hd(o.geometries[r],t,n))return!1;break;default:throw Error(`Unknown Geometry Type`)}}}}}function Ud(e,t){var n;switch(e.type){case`FeatureCollection`:for(n=0;e.features.length>n&&!1!==t(e.features[n].properties,n);n++);break;case`Feature`:t(e.properties,0)}}function Wd(e,t){if(e.type===`Feature`)t(e,0);else if(e.type===`FeatureCollection`)for(var n=0;e.features.length>n&&!1!==t(e.features[n],n);n++);}function Gd(e,t){var n,r,i,a,o,s,c,l,u,d,f=0,p=e.type===`FeatureCollection`,m=e.type===`Feature`,h=p?e.features.length:1;for(n=0;h>n;n++){for(l=p?e.features[n].properties:m?e.properties:{},u=p?e.features[n].bbox:m?e.bbox:void 0,d=p?e.features[n].id:m?e.id:void 0,o=(c=!!(s=p?e.features[n].geometry:m?e.geometry:e)&&s.type===`GeometryCollection`)?s.geometries.length:1,i=0;o>i;i++)if((a=c?s.geometries[i]:s)!==null)switch(a.type){case`Point`:case`LineString`:case`MultiPoint`:case`Polygon`:case`MultiLineString`:case`MultiPolygon`:if(!1===t(a,f,l,u,d))return!1;break;case`GeometryCollection`:for(r=0;a.geometries.length>r;r++)if(!1===t(a.geometries[r],f,l,u,d))return!1;break;default:throw Error(`Unknown Geometry Type`)}else if(!1===t(null,f,l,u,d))return!1;f++}}function Kd(e,t){Gd(e,(function(e,n,r,i,a){var o,s=e===null?null:e.type;switch(s){case null:case`Point`:case`LineString`:case`Polygon`:return!1!==t(Dd(e,r,{bbox:i,id:a}),n,0)&&void 0}switch(s){case`MultiPoint`:o=`Point`;break;case`MultiLineString`:o=`LineString`;break;case`MultiPolygon`:o=`Polygon`}for(var c=0;e.coordinates.length>c;c++)if(!1===t(Dd({type:o,coordinates:e.coordinates[c]},r),n,c))return!1}))}function qd(e,t){Kd(e,(function(e,n,r){var i=0;if(e.geometry){var a=e.geometry.type;if(a!==`Point`&&a!==`MultiPoint`){var o,s=0,c=0,l=0;return!1!==Hd(e,(function(a,u,d,f,p){if(o===void 0||n>s||f>c||p>l)return o=a,s=n,c=f,l=p,void(i=0);if(!1===t(Ad([o,a],e.properties),n,r,p,i))return!1;i++,o=a}))&&void 0}}}))}function Jd(e,t){if(!e)throw Error(`geojson is required`);Kd(e,(function(e,n,r){if(e.geometry!==null){var i=e.geometry.coordinates;switch(e.geometry.type){case`LineString`:if(!1===t(e,n,r,0,0))return!1;break;case`Polygon`:for(var a=0;i.length>a;a++)if(!1===t(Ad(i[a],e.properties),n,r,a))return!1}}}))}Vd(Hd,`coordEach`),Vd((function(e,t,n,r){var i=n;return Hd(e,(function(e,r,a,o,s){i=r===0&&n===void 0?e:t(i,e,r,a,o,s)}),r),i}),`coordReduce`),Vd(Ud,`propEach`),Vd((function(e,t,n){var r=n;return Ud(e,(function(e,i){r=i===0&&n===void 0?e:t(r,e,i)})),r}),`propReduce`),Vd(Wd,`featureEach`),Vd((function(e,t,n){var r=n;return Wd(e,(function(e,i){r=i===0&&n===void 0?e:t(r,e,i)})),r}),`featureReduce`),Vd((function(e){var t=[];return Hd(e,(function(e){t.push(e)})),t}),`coordAll`),Vd(Gd,`geomEach`),Vd((function(e,t,n){var r=n;return Gd(e,(function(e,i,a,o,s){r=i===0&&n===void 0?e:t(r,e,i,a,o,s)})),r}),`geomReduce`),Vd(Kd,`flattenEach`),Vd((function(e,t,n){var r=n;return Kd(e,(function(e,i,a){r=i===0&&a===0&&n===void 0?e:t(r,e,i,a)})),r}),`flattenReduce`),Vd(qd,`segmentEach`),Vd((function(e,t,n){var r=n,i=!1;return qd(e,(function(e,a,o,s,c){r=!1===i&&n===void 0?e:t(r,e,a,o,s,c),i=!0})),r}),`segmentReduce`),Vd(Jd,`lineEach`),Vd((function(e,t,n){var r=n;return Jd(e,(function(e,i,a,o){r=i===0&&n===void 0?e:t(r,e,i,a,o)})),r}),`lineReduce`),Vd((function(e,t){if(!zd(t||={}))throw Error(`options is invalid`);var n,r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,o=t.segmentIndex||0,s=t.properties;switch(e.type){case`FeatureCollection`:0>r&&(r=e.features.length+r),s||=e.features[r].properties,n=e.features[r].geometry;break;case`Feature`:s||=e.properties,n=e.geometry;break;case`Point`:case`MultiPoint`:return null;case`LineString`:case`Polygon`:case`MultiLineString`:case`MultiPolygon`:n=e;break;default:throw Error(`geojson is invalid`)}if(n===null)return null;var c=n.coordinates;switch(n.type){case`Point`:case`MultiPoint`:return null;case`LineString`:return 0>o&&(o=c.length+o-1),Ad([c[o],c[o+1]],s,t);case`Polygon`:return 0>a&&(a=c.length+a),0>o&&(o=c[a].length+o-1),Ad([c[a][o],c[a][o+1]],s,t);case`MultiLineString`:return 0>i&&(i=c.length+i),0>o&&(o=c[i].length+o-1),Ad([c[i][o],c[i][o+1]],s,t);case`MultiPolygon`:return 0>i&&(i=c.length+i),0>a&&(a=c[i].length+a),0>o&&(o=c[i][a].length-o-1),Ad([c[i][a][o],c[i][a][o+1]],s,t)}throw Error(`geojson is invalid`)}),`findSegment`),Vd((function(e,t){if(!zd(t||={}))throw Error(`options is invalid`);var n,r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,o=t.coordIndex||0,s=t.properties;switch(e.type){case`FeatureCollection`:0>r&&(r=e.features.length+r),s||=e.features[r].properties,n=e.features[r].geometry;break;case`Feature`:s||=e.properties,n=e.geometry;break;case`Point`:case`MultiPoint`:return null;case`LineString`:case`Polygon`:case`MultiLineString`:case`MultiPolygon`:n=e;break;default:throw Error(`geojson is invalid`)}if(n===null)return null;var c=n.coordinates;switch(n.type){case`Point`:return Od(c,s,t);case`MultiPoint`:return 0>i&&(i=c.length+i),Od(c[i],s,t);case`LineString`:return 0>o&&(o=c.length+o),Od(c[o],s,t);case`Polygon`:return 0>a&&(a=c.length+a),0>o&&(o=c[a].length+o),Od(c[a][o],s,t);case`MultiLineString`:return 0>i&&(i=c.length+i),0>o&&(o=c[i].length+o),Od(c[i][o],s,t);case`MultiPolygon`:return 0>i&&(i=c.length+i),0>a&&(a=c[i].length+a),0>o&&(o=c[i][a].length-o),Od(c[i][a][o],s,t)}throw Error(`geojson is invalid`)}),`findPoint`);function Yd(e,t={}){if(e.bbox!=null&&!0!==t.recompute)return e.bbox;let n=[1/0,1/0,-1/0,-1/0];return Hd(e,(e=>{n[0]>e[0]&&(n[0]=e[0]),n[1]>e[1]&&(n[1]=e[1]),e[0]>n[2]&&(n[2]=e[0]),e[1]>n[3]&&(n[3]=e[1])})),n}(0,Object.defineProperty)(Yd,`name`,{value:`bbox`,configurable:!0});var Xd=Object.freeze({__proto__:null,bbox:Yd,default:Yd}),Zd=Mr(yi),Qd=Mr(Un),$d=Mr(er),ef=Mr(Xd).default,tf=$d.featureEach,nf=Qd.featureCollection;function rf(e){var t=new Zd(e);return t.insert=function(e){if(e.type!==`Feature`)throw Error(`invalid feature`);return e.bbox=e.bbox?e.bbox:ef(e),Zd.prototype.insert.call(this,e)},t.load=function(e){var t=[];return Array.isArray(e)?e.forEach((function(e){if(e.type!==`Feature`)throw Error(`invalid features`);e.bbox=e.bbox?e.bbox:ef(e),t.push(e)})):tf(e,(function(e){if(e.type!==`Feature`)throw Error(`invalid features`);e.bbox=e.bbox?e.bbox:ef(e),t.push(e)})),Zd.prototype.load.call(this,t)},t.remove=function(e,t){if(e.type!==`Feature`)throw Error(`invalid feature`);return e.bbox=e.bbox?e.bbox:ef(e),Zd.prototype.remove.call(this,e,t)},t.clear=function(){return Zd.prototype.clear.call(this)},t.search=function(e){return nf(Zd.prototype.search.call(this,this.toBBox(e)))},t.collides=function(e){return Zd.prototype.collides.call(this,this.toBBox(e))},t.all=function(){return nf(Zd.prototype.all.call(this))},t.toJSON=function(){return Zd.prototype.toJSON.call(this)},t.fromJSON=function(e){return Zd.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var t;if(e.bbox)t=e.bbox;else if(Array.isArray(e)&&e.length===4)t=e;else if(Array.isArray(e)&&e.length===6)t=[e[0],e[1],e[3],e[4]];else if(e.type===`Feature`)t=ef(e);else{if(e.type!==`FeatureCollection`)throw Error(`invalid geojson`);t=ef(e)}return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}var af=rf;function of(e,t){var n={},r=[];if(e.type===`LineString`&&(e=kn(e)),t.type===`LineString`&&(t=kn(t)),e.type===`Feature`&&t.type===`Feature`&&e.geometry!==null&&t.geometry!==null&&e.geometry.type===`LineString`&&t.geometry.type===`LineString`&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var i=sf(e,t);return i&&r.push(i),Nn(r)}var a=af();return a.load(ii(t)),Kn(ii(e),(function(e){Kn(a.search(e),(function(t){var i=sf(e,t);if(i){var a=rr(i).join(`,`);n[a]||(n[a]=!0,r.push(i))}}))})),Nn(r)}function sf(e,t){var n=rr(e),r=rr(t);if(n.length!==2)throw Error(`<intersects> line1 must only contain 2 coordinates`);if(r.length!==2)throw Error(`<intersects> line2 must only contain 2 coordinates`);var i=n[0][0],a=n[0][1],o=n[1][0],s=n[1][1],c=r[0][0],l=r[0][1],u=r[1][0],d=r[1][1],f=(d-l)*(o-i)-(u-c)*(s-a),p=(u-c)*(a-l)-(d-l)*(i-c),m=(o-i)*(a-l)-(s-a)*(i-c);if(f===0)return null;var h=p/f,g=m/f;return 0>h||h>1||0>g||g>1?null:An([i+h*(o-i),a+h*(s-a)])}af.default=rf;var cf=6378137;function lf(e){return Yn(e,(function(e,t){return e+function(e){var t,n=0;switch(e.type){case`Polygon`:return uf(e.coordinates);case`MultiPolygon`:for(t=0;e.coordinates.length>t;t++)n+=uf(e.coordinates[t]);return n;case`Point`:case`MultiPoint`:case`LineString`:case`MultiLineString`:return 0}return 0}(t)}),0)}function uf(e){var t=0;if(e&&e.length>0){t+=Math.abs(df(e[0]));for(var n=1;e.length>n;n++)t-=Math.abs(df(e[n]))}return t}function df(e){var t,n,r,i,a,o,s=0,c=e.length;if(c>2){for(o=0;c>o;o++)o===c-2?(r=c-2,i=c-1,a=0):o===c-1?(r=c-1,i=0,a=1):(r=o,i=o+1,a=o+2),t=e[r],n=e[i],s+=(ff(e[a][0])-ff(t[0]))*Math.sin(ff(n[1]));s=s*cf*cf/2}return s}function ff(e){return e*Math.PI/180}function pf(e,t){return t===void 0&&(t={}),Qn(e,(function(e,n){var r=n.geometry.coordinates;return e+Zr(r[0],r[1],t)}),0)}function mf(e,t){t===void 0&&(t={});var n=ir(e);switch(t.properties||e.type!==`Feature`||(t.properties=e.properties),n.type){case`Polygon`:return function(e,t){t===void 0&&(t={});var n=ir(e).coordinates;return hf(n,t.properties?t.properties:e.type===`Feature`?e.properties:{})}(n,t);case`MultiPolygon`:return function(e,t){t===void 0&&(t={});var n=ir(e).coordinates,r=t.properties?t.properties:e.type===`Feature`?e.properties:{},i=[];return n.forEach((function(e){i.push(hf(e,r))})),Nn(i)}(n,t);default:throw Error(`invalid poly`)}}function hf(e,t){return e.length>1?Pn(e,t):Mn(e[0],t)}function gf(e){for(var t,n,r=rr(e),i=0,a=1;r.length>a;)t=n||r[0],i+=((n=r[a])[0]-t[0])*(n[1]+t[1]),a++;return i>0}var _f=jr((function(e){var t=Object.prototype.hasOwnProperty,n=`~`;function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,o){if(typeof r!=`function`)throw TypeError(`The listener must be a function`);var s=new i(r,a||e,o),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function o(e,t){--e._eventsCount==0?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(this._eventsCount===0)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=this._events[n?n+e:e];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,i=t.length,a=Array(i);i>r;r++)a[r]=t[r].fn;return a},s.prototype.listenerCount=function(e){var t=this._events[n?n+e:e];return t?t.fn?1:t.length:0},s.prototype.emit=function(e,t,r,i,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var c,l,u=this._events[s],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,a),!0;case 6:return u.fn.call(u.context,t,r,i,a,o),!0}for(l=1,c=Array(d-1);d>l;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var f,p=u.length;for(l=0;p>l;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,i);break;default:if(!c)for(f=1,c=Array(d-1);d>f;f++)c[f-1]=arguments[f];u[l].fn.apply(u[l].context,c)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||o(this,a);else{for(var c=0,l=[],u=s.length;u>c;c++)(s[c].fn!==t||i&&!s[c].once||r&&s[c].context!==r)&&l.push(s[c]);l.length?this._events[a]=l.length===1?l[0]:l:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?this._events[t=n?n+e:e]&&o(this,t):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),vf=function(e){function t(e,n){var r,i=n.style;return un(this,t),(r=ln(this,t)).scene=void 0,r.style=void 0,r.layers=void 0,r.data=[],r.scene=e,r.style=i,r.layers=r.initLayers(),r.layers.forEach((function(t){e.addLayer(t)})),i.callback instanceof Function&&i.callback(r.layers),r}return gn(t,e),fn(t,[{key:`getLayers`,value:function(){return this.layers}},{key:`show`,value:function(){this.layers.forEach((function(e){e.show()}))}},{key:`hide`,value:function(){this.layers.forEach((function(e){e.hide()}))}},{key:`setData`,value:function(e){var t=Sn(e).sort((function(e,t){return e.properties.isActive-+t.properties.isActive}));this.data=t,this.layers.forEach((function(e){e.setData(Nn(t))}))}},{key:`destroy`,value:function(){var e=this;this.layers.forEach((function(t){e.scene.removeLayer(t)}))}}])}(_f.EventEmitter),yf=function(e){function n(){return un(this,n),ln(this,n,arguments)}return gn(n,e),fn(n,[{key:`initLayers`,value:function(){var e=this.style,n=e.normal,r=e.style,i=e.options;return[new t.LineLayer(i??{}).source(Nn([])).size(n.size).color(n.color).shape(`line`).style(r)]}}])}(vf),bf=function(e){var t=typeof e;return e!=null&&(t==`object`||t==`function`)},xf=typeof Ar==`object`&&Ar&&Ar.Object===Object&&Ar,Sf=typeof self==`object`&&self&&self.Object===Object&&self,Cf=xf||Sf||Function(`return this`)(),wf=function(){return Cf.Date.now()},Tf=/\s/,Ef=function(e){for(var t=e.length;t--&&Tf.test(e.charAt(t)););return t},Df=/^\s+/,Of=function(e){return e&&e.slice(0,Ef(e)+1).replace(Df,``)},kf=Cf.Symbol,Af=Object.prototype,jf=Af.hasOwnProperty,Mf=Af.toString,Nf=kf?kf.toStringTag:void 0,Pf=function(e){var t=jf.call(e,Nf),n=e[Nf];try{e[Nf]=void 0;var r=!0}catch{}var i=Mf.call(e);return r&&(t?e[Nf]=n:delete e[Nf]),i},Ff=Object.prototype.toString,If=function(e){return Ff.call(e)},Lf=kf?kf.toStringTag:void 0,Rf=function(e){return e==null?e===void 0?`[object Undefined]`:`[object Null]`:Lf&&Lf in Object(e)?Pf(e):If(e)},zf=function(e){return typeof e==`object`&&!!e},Bf=function(e){return typeof e==`symbol`||zf(e)&&Rf(e)==`[object Symbol]`},Vf=/^[-+]0x[0-9a-f]+$/i,Hf=/^0b[01]+$/i,Uf=/^0o[0-7]+$/i,Wf=parseInt,Gf=function(e){if(typeof e==`number`)return e;if(Bf(e))return NaN;if(bf(e)){var t=typeof e.valueOf==`function`?e.valueOf():e;e=bf(t)?t+``:t}if(typeof e!=`string`)return e===0?e:+e;e=Of(e);var n=Hf.test(e);return n||Uf.test(e)?Wf(e.slice(2),n?2:8):Vf.test(e)?NaN:+e},Kf=Math.max,qf=Math.min,Jf=function(e,t,n){var r,i,a,o,s,c,l=0,u=!1,d=!1,f=!0;if(typeof e!=`function`)throw TypeError(`Expected a function`);function p(t){var n=r,a=i;return r=i=void 0,l=t,o=e.apply(a,n)}function m(e){var n=e-c;return c===void 0||n>=t||0>n||d&&e-l>=a}function h(){var e=wf();if(m(e))return g(e);s=setTimeout(h,function(e){var n=t-(e-c);return d?qf(n,a-(e-l)):n}(e))}function g(e){return s=void 0,f&&r?p(e):(r=i=void 0,o)}function _(){var e=wf(),n=m(e);if(r=arguments,i=this,c=e,n){if(s===void 0)return function(e){return l=e,s=setTimeout(h,t),u?p(e):o}(c);if(d)return clearTimeout(s),s=setTimeout(h,t),p(c)}return s===void 0&&(s=setTimeout(h,t)),o}return t=Gf(t)||0,bf(n)&&(u=!!n.leading,a=(d=`maxWait`in n)?Kf(Gf(n.maxWait)||0,t):a,f=`trailing`in n?!!n.trailing:f),_.cancel=function(){s!==void 0&&clearTimeout(s),l=0,r=c=i=s=void 0},_.flush=function(){return s===void 0?o:g(wf())},_},Yf=function(n){function r(){var t;un(this,r);for(var n=arguments.length,i=Array(n),a=0;n>a;a++)i[a]=arguments[a];return(t=ln(this,r,[].concat(i))).onMouseMove=function(n){t.emit(e.RenderEvent.Mousemove,n)},t.onMouseOut=function(n){t.emit(e.RenderEvent.Mouseout,n)},t.onMouseDown=function(n){t.emit(e.RenderEvent.Dragstart,n)},t.onDragging=function(n){t.emit(e.RenderEvent.Dragging,n)},t.onDragEnd=Jf((function(n){t.emit(e.RenderEvent.Dragend,n)}),0),t.onUnClick=function(n){t.emit(e.RenderEvent.UnClick,n)},t.enableHover=function(){var n,r;t.disableHover(),(n=t.layers[0])==null||n.on(e.LayerEvent.Mousemove,t.onMouseMove),(r=t.layers[0])==null||r.on(e.LayerEvent.Mouseout,t.onMouseOut)},t.disableHover=function(){var n,r;(n=t.layers[0])==null||n.off(e.LayerEvent.Mousemove,t.onMouseMove),(r=t.layers[0])==null||r.off(e.LayerEvent.Mouseout,t.onMouseOut)},t}return gn(r,n),fn(r,[{key:`initLayers`,value:function(){var e=this.style,n=e.normal,r=e.hover,i=e.active,a=e.style,o=e.options;return[new t.LineLayer(o??{}).source(Nn([])).size(`isHover*isActive`,(function(e,t){return t?i.size:e?r.size:n.size})).color(`isHover*isActive`,(function(e,t){return t?i.color:e?r.color:n.color})).shape(`line`).style(a)]}},{key:`enableDrag`,value:function(){this.disableDrag(),this.layers[0].on(e.LayerEvent.Mousedown,this.onMouseDown),this.scene.on(e.SceneEvent.Dragging,this.onDragging),this.scene.on(e.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(e.SceneEvent.Dragend,this.onDragEnd)}},{key:`disableDrag`,value:function(){this.layers[0].off(e.LayerEvent.Mousedown,this.onMouseDown),this.scene.off(e.SceneEvent.Dragging,this.onDragging),this.scene.off(e.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(e.SceneEvent.Dragend,this.onDragEnd)}},{key:`enableUnClick`,value:function(){this.disableUnClick(),this.layers[0].on(e.LayerEvent.UnClick,this.onUnClick)}},{key:`disableUnClick`,value:function(){this.layers[0].off(e.LayerEvent.UnClick,this.onUnClick)}}])}(vf),Xf=function(n){function r(){var t;un(this,r);for(var n=arguments.length,i=Array(n),a=0;n>a;a++)i[a]=arguments[a];return(t=ln(this,r,[].concat(i))).onMouseMove=function(n){t.emit(e.RenderEvent.Mousemove,n)},t.onMouseOut=function(n){t.emit(e.RenderEvent.Mouseout,n)},t.onMouseDown=function(n){t.emit(e.RenderEvent.Click,n)},t}return gn(r,n),fn(r,[{key:`initLayers`,value:function(){var e=this.style,n=e.normal,r=e.style,i=r===void 0?{}:r,a=e.options,o=n.shape,s=n.size,c=n.color;return[new t.PointLayer(a??{}).source(Nn([])).size(s).color(c).shape(o).style(i)]}},{key:`enableClick`,value:function(){this.disableClick(),this.layers[0].on(e.LayerEvent.Mousedown,this.onMouseDown)}},{key:`disableClick`,value:function(){this.layers[0].off(e.LayerEvent.Mousedown,this.onMouseDown)}},{key:`enableHover`,value:function(){var t,n;this.disableHover(),(t=this.layers[0])==null||t.on(e.LayerEvent.Mousemove,this.onMouseMove),(n=this.layers[0])==null||n.on(e.LayerEvent.Mouseout,this.onMouseOut)}},{key:`disableHover`,value:function(){var t,n;(t=this.layers[0])==null||t.off(e.LayerEvent.Mousemove,this.onMouseMove),(n=this.layers[0])==null||n.off(e.LayerEvent.Mouseout,this.onMouseOut)}}])}(vf),Zf=function(n){function r(){var t;un(this,r);for(var n=arguments.length,i=Array(n),a=0;n>a;a++)i[a]=arguments[a];return(t=ln(this,r,[].concat(i))).onCreate=function(n){t.emit(e.RenderEvent.UnClick,n)},t.onMouseMove=function(n){t.emit(e.RenderEvent.Mousemove,n)},t.onMouseOut=function(n){t.emit(e.RenderEvent.Mouseout,n)},t.onMouseDown=function(n){t.emit(e.RenderEvent.Dragstart,n)},t.onDragging=function(n){t.emit(e.RenderEvent.Dragging,n)},t.onDragEnd=Jf((function(n){t.emit(e.RenderEvent.Dragend,n)}),0),t.onClick=function(n){t.emit(e.RenderEvent.Click,n)},t.onContextmenu=function(n){t.emit(e.RenderEvent.Contextmenu,n)},t}return gn(r,n),fn(r,[{key:`initLayers`,value:function(){var e=this.style,n=e.normal,r=e.hover,i=e.active,a=e.style,o=a===void 0?{}:a,s=e.options;return[new t.PointLayer(s??{}).source(Nn([])).size(`isHover*isActive`,(function(e,t){return t?i.size:e?r.size:n.size})).color(`isHover*isActive`,(function(e,t){return t?i.color:e?r.color:n.color})).shape(`isHover*isActive`,(function(e,t){return t?i.shape:e?r.shape:n.shape})).style(o)]}},{key:`enableCreate`,value:function(){this.disableCreate(),this.layers[0].on(e.LayerEvent.UnClick,this.onCreate)}},{key:`disableCreate`,value:function(){this.layers[0].off(e.LayerEvent.UnClick,this.onCreate)}},{key:`enableHover`,value:function(){var t,n;this.disableHover(),(t=this.layers[0])==null||t.on(e.LayerEvent.Mousemove,this.onMouseMove),(n=this.layers[0])==null||n.on(e.LayerEvent.Mouseout,this.onMouseOut)}},{key:`disableHover`,value:function(){var t,n;(t=this.layers[0])==null||t.off(e.LayerEvent.Mousemove,this.onMouseMove),(n=this.layers[0])==null||n.off(e.LayerEvent.Mouseout,this.onMouseOut)}},{key:`enableDrag`,value:function(){this.disableDrag(),this.layers[0].on(e.LayerEvent.Mousedown,this.onMouseDown),this.scene.on(e.SceneEvent.Dragging,this.onDragging),this.scene.on(e.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(e.SceneEvent.Dragend,this.onDragEnd)}},{key:`disableDrag`,value:function(){this.layers[0].off(e.LayerEvent.Mousedown,this.onMouseDown),this.scene.off(e.SceneEvent.Dragging,this.onDragging),this.scene.off(e.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(e.SceneEvent.Dragend,this.onDragEnd)}},{key:`enableClick`,value:function(){this.disableClick(),this.layers[0].on(e.LayerEvent.Click,this.onClick)}},{key:`disableClick`,value:function(){this.layers[0].off(e.LayerEvent.Click,this.onClick)}},{key:`enableContextMenu`,value:function(){this.disableContextMenu(),this.layers[0].on(e.LayerEvent.Contextmenu,this.onContextmenu)}},{key:`disableContextMenu`,value:function(){this.layers[0].off(e.LayerEvent.Contextmenu,this.onContextmenu)}}])}(vf),Qf=function(n){function r(){var t;un(this,r);for(var n=arguments.length,i=Array(n),a=0;n>a;a++)i[a]=arguments[a];return(t=ln(this,r,[].concat(i))).onMouseMove=function(n){t.emit(e.RenderEvent.Mousemove,n)},t.onMouseOut=function(n){t.emit(e.RenderEvent.Mouseout,n)},t.onMouseDown=function(n){t.emit(e.RenderEvent.Dragstart,n)},t.onDragging=function(n){t.emit(e.RenderEvent.Dragging,n)},t.onDragEnd=Jf((function(n){t.emit(e.RenderEvent.Dragend,n)}),0),t.onUnClick=function(n){t.emit(e.RenderEvent.UnClick,n)},t.enableHover=function(){var n,r;t.disableHover(),(n=t.layers[0])==null||n.on(e.LayerEvent.Mousemove,t.onMouseMove),(r=t.layers[0])==null||r.on(e.LayerEvent.Mouseout,t.onMouseOut)},t.disableHover=function(){var n,r;(n=t.layers[0])==null||n.off(e.LayerEvent.Mousemove,t.onMouseMove),(r=t.layers[0])==null||r.off(e.LayerEvent.Mouseout,t.onMouseOut)},t}return gn(r,n),fn(r,[{key:`initLayers`,value:function(){var e=this.style,n=e.normal,r=e.hover,i=e.active,a=e.style,o=e.options,s=new t.PolygonLayer(o??{});return s.source(Nn([])).color(`isHover*isActive`,(function(e,t){return t?i.color:e?r.color:n.color})).style(a),[s]}},{key:`enableDrag`,value:function(){this.disableDrag(),this.layers[0].on(e.LayerEvent.Mousedown,this.onMouseDown),this.scene.on(e.SceneEvent.Dragging,this.onDragging),this.scene.on(e.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(e.SceneEvent.Dragend,this.onDragEnd)}},{key:`disableDrag`,value:function(){this.layers[0].off(e.LayerEvent.Mousedown,this.onMouseDown),this.scene.off(e.SceneEvent.Dragging,this.onDragging),this.scene.off(e.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(e.SceneEvent.Dragend,this.onDragEnd)}},{key:`enableUnClick`,value:function(){this.disableUnClick(),this.layers[0].on(e.LayerEvent.UnClick,this.onUnClick)}},{key:`disableUnClick`,value:function(){this.layers[0].off(e.LayerEvent.UnClick,this.onUnClick)}}])}(vf),$f=function(t){function n(t){var r;return un(this,n),(r=ln(this,n)).scene=void 0,r.previousClick=void 0,r.onDblClick=function(t){var n=t.pixel??t.point??{},i=n.x,a=i===void 0?0:i,o=n.y,s=o===void 0?0:o,c=Date.now();if(r.previousClick){var l=r.previousClick,u=l.y;300>c-l.time&&5>Math.abs(a-l.x)&&5>Math.abs(s-u)&&r.emit(e.RenderEvent.DblClick,t)}r.previousClick={x:a,y:s,time:c}},r.onMouseMove=function(t){r.emit(e.RenderEvent.Mousemove,t)},r.onMouseDown=function(t){r.emit(e.RenderEvent.Dragstart,t)},r.onDragging=function(t){r.emit(e.RenderEvent.Dragging,t)},r.onDragEnd=Jf((function(t){r.emit(e.RenderEvent.Dragend,t)}),0),r.scene=t,r}return gn(n,t),fn(n,[{key:`enableDrag`,value:function(){this.disableDrag(),this.scene.on(e.SceneEvent.Mousedown,this.onMouseDown),this.scene.on(e.SceneEvent.Dragging,this.onDragging),this.scene.on(e.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(e.SceneEvent.Dragend,this.onDragEnd)}},{key:`disableDrag`,value:function(){this.scene.off(e.SceneEvent.Mousedown,this.onMouseDown),this.scene.off(e.SceneEvent.Dragging,this.onDragging),this.scene.off(e.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(e.SceneEvent.Dragend,this.onDragEnd)}},{key:`enableMouseMove`,value:function(){this.disableMouseMove(),this.scene.on(e.SceneEvent.Mousemove,this.onMouseMove)}},{key:`disableMouseMove`,value:function(){this.scene.off(e.SceneEvent.Mousemove,this.onMouseMove)}},{key:`enableDblClick`,value:function(){this.disableDblClick(),this.scene.on(e.SceneEvent.Mousedown,this.onDblClick)}},{key:`disableDblClick`,value:function(){this.scene.off(e.SceneEvent.Mousedown,this.onDblClick)}}])}(_f),ep=function(e){function n(){return un(this,n),ln(this,n,arguments)}return gn(n,e),fn(n,[{key:`initLayers`,value:function(){var e=this.style,n=e.normal,r=e.active,i=e.style,a=i===void 0?{}:i,o=e.options;return[new t.PointLayer(o??{}).source(Nn([])).size(`isActive`,(function(e){return e?r.size:n.size})).color(`isActive`,(function(e){return e?r.color:n.color})).shape(`text`,`text`).style(a)]}}])}(vf),tp={point:Zf,line:Yf,dashLine:yf,midPoint:Xf,text:ep,polygon:Qf},np=`#1990FF`,rp=`#ED9D48`,ip={blend:`normal`,pickingBuffer:5},ap={color:np,shape:`circle`,size:6},op={color:rp,shape:`circle`,size:6},sp={shape:`circle`,size:6,color:rp},cp={options:ip,normal:ap,hover:yn(yn({},ap),{},{size:8}),active:yn(yn({},ap),{},{size:8,color:rp}),style:{stroke:`#ffffff`,strokeWidth:2}},lp={options:ip,normal:op,hover:yn(yn({},op),{},{size:8}),active:yn(yn({},op),{},{size:8}),style:{stroke:`#ffffff`,strokeWidth:2}},up={color:np,size:12},dp={point:lp,line:{options:ip,normal:{color:np,size:2},hover:{color:np,size:2},active:{color:rp,size:2},style:{}},polygon:{options:ip,normal:{color:np},hover:{color:np},active:{color:rp},style:{opacity:.15}},midPoint:{options:ip,normal:sp},dashLine:{options:ip,normal:{color:rp,size:2},style:{lineType:`dash`,dashArray:[6,6]}},text:{options:ip,normal:up,active:yn(yn({},up),{},{color:rp}),style:{fontWeight:`800`,textOffset:[0,up.size+6],textAllowOverlap:!0,stroke:`#ffffff`,strokeWidth:2}}},fp={draw:`单击绘制点`,pointHover:`可拖拽调整点位置`,pointDrag:null},pp={draw:`单击绘制首个节点`,pointHover:`可拖拽调整节点位置`,pointDrag:null,lineHover:`可拖拽调整线位置`,lineDrag:null,midPointHover:`单击在该位置新增节点`,drawFinish:`单击继续绘制，双击结束绘制`},mp={draw:`单击绘制首个节点`,drawContinue:`单击继续绘制`,drawFinish:`单击继续绘制，双击结束绘制`,midPointHover:`单击在该位置新增节点`,pointHover:`可拖拽调整节点位置`,pointDrag:null,lineHover:`可拖拽调整面位置`,lineDrag:null,polygonHover:`可拖拽调整面位置`,polygonDrag:null},hp=yn(yn({},mp),{},{draw:`单击绘制首个节点`,drawFinish:`单击结束绘制`}),gp={draw:`拖拽开始绘制`,drawFinish:`松开鼠标结束绘制`},_p={lineHover:`可拖拽调整矩形位置`,polygonHover:`可拖拽调整矩形位置`},vp={lineHover:`可拖拽调整圆位置`,polygonHover:`可拖拽调整圆位置`},yp=function(e,t){return e===t||e!=e&&t!=t},bp=function(e,t){for(var n=e.length;n--;)if(yp(e[n][0],t))return n;return-1},xp=Array.prototype.splice,Sp=function(e){var t=this.__data__,n=bp(t,e);return n>=0&&(n==t.length-1?t.pop():xp.call(t,n,1),--this.size,!0)},Cp=function(e){var t=this.__data__,n=bp(t,e);return 0>n?void 0:t[n][1]},wp=function(e){return bp(this.__data__,e)>-1},Tp=function(e,t){var n=this.__data__,r=bp(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};function Ep(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ep.prototype.clear=function(){this.__data__=[],this.size=0},Ep.prototype.delete=Sp,Ep.prototype.get=Cp,Ep.prototype.has=wp,Ep.prototype.set=Tp;var Dp=Ep,Op=function(){this.__data__=new Dp,this.size=0},kp=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ap=function(e){return this.__data__.get(e)},jp=function(e){return this.__data__.has(e)},Mp,Np=function(e){if(!bf(e))return!1;var t=Rf(e);return t==`[object Function]`||t==`[object GeneratorFunction]`||t==`[object AsyncFunction]`||t==`[object Proxy]`},Pp=Cf[`__core-js_shared__`],Fp=(Mp=/[^.]+$/.exec(Pp&&Pp.keys&&Pp.keys.IE_PROTO||``))?`Symbol(src)_1.`+Mp:``,Ip=function(e){return!!Fp&&Fp in e},Lp=Function.prototype.toString,Rp=function(e){if(e!=null){try{return Lp.call(e)}catch{}try{return e+``}catch{}}return``},zp=/^\[object .+?Constructor\]$/,Bp=RegExp(`^`+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,`\\$&`).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,`$1.*?`)+`$`),Vp=function(e){return!(!bf(e)||Ip(e))&&(Np(e)?Bp:zp).test(Rp(e))},Hp=function(e,t){return e?.[t]},Up=function(e,t){var n=Hp(e,t);return Vp(n)?n:void 0},Wp=Up(Cf,`Map`),Gp=Up(Object,`create`),Kp=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},qp=Object.prototype.hasOwnProperty,Jp=function(e){var t=this.__data__;if(Gp){var n=t[e];return n===`__lodash_hash_undefined__`?void 0:n}return qp.call(t,e)?t[e]:void 0},Yp=Object.prototype.hasOwnProperty,Xp=function(e){var t=this.__data__;return Gp?t[e]!==void 0:Yp.call(t,e)},Zp=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Gp&&t===void 0?`__lodash_hash_undefined__`:t,this};function Qp(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Qp.prototype.clear=function(){this.__data__=Gp?Gp(null):{},this.size=0},Qp.prototype.delete=Kp,Qp.prototype.get=Jp,Qp.prototype.has=Xp,Qp.prototype.set=Zp;var $p=Qp,em=function(e){var t=typeof e;return t==`string`||t==`number`||t==`symbol`||t==`boolean`?e!==`__proto__`:e===null},tm=function(e,t){var n=e.__data__;return em(t)?n[typeof t==`string`?`string`:`hash`]:n.map},nm=function(e){var t=tm(this,e).delete(e);return this.size-=t?1:0,t},rm=function(e){return tm(this,e).get(e)},im=function(e){return tm(this,e).has(e)},am=function(e,t){var n=tm(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function om(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}om.prototype.clear=function(){this.size=0,this.__data__={hash:new $p,map:new(Wp||Dp),string:new $p}},om.prototype.delete=nm,om.prototype.get=rm,om.prototype.has=im,om.prototype.set=am;var sm=om,cm=function(e,t){var n=this.__data__;if(n instanceof Dp){var r=n.__data__;if(!Wp||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new sm(r)}return n.set(e,t),this.size=n.size,this};function lm(e){this.size=(this.__data__=new Dp(e)).size}lm.prototype.clear=Op,lm.prototype.delete=kp,lm.prototype.get=Ap,lm.prototype.has=jp,lm.prototype.set=cm;var um=lm,dm=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},fm=function(){try{var e=Up(Object,`defineProperty`);return e({},``,{}),e}catch{}}(),pm=function(e,t,n){t==`__proto__`&&fm?fm(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},mm=Object.prototype.hasOwnProperty,hm=function(e,t,n){var r=e[t];mm.call(e,t)&&yp(r,n)&&(n!==void 0||t in e)||pm(e,t,n)},gm=function(e,t,n,r){var i=!n;n||={};for(var a=-1,o=t.length;++a<o;){var s=t[a],c=r?r(n[s],e[s],s,n,e):void 0;c===void 0&&(c=e[s]),i?pm(n,s,c):hm(n,s,c)}return n},_m=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},vm=function(e){return zf(e)&&Rf(e)==`[object Arguments]`},ym=Object.prototype,bm=ym.hasOwnProperty,xm=ym.propertyIsEnumerable,Sm=vm(function(){return arguments}())?vm:function(e){return zf(e)&&bm.call(e,`callee`)&&!xm.call(e,`callee`)},Cm=Array.isArray,wm=function(){return!1},Tm=jr((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?Cf.Buffer:void 0;e.exports=(i?i.isBuffer:void 0)||wm})),Em=/^(?:0|[1-9]\d*)$/,Dm=function(e,t){var n=typeof e;return!!(t??=9007199254740991)&&(n==`number`||n!=`symbol`&&Em.test(e))&&e>-1&&e%1==0&&t>e},Om=function(e){return typeof e==`number`&&e>-1&&e%1==0&&9007199254740991>=e},km={};km[`[object Float32Array]`]=km[`[object Float64Array]`]=km[`[object Int8Array]`]=km[`[object Int16Array]`]=km[`[object Int32Array]`]=km[`[object Uint8Array]`]=km[`[object Uint8ClampedArray]`]=km[`[object Uint16Array]`]=km[`[object Uint32Array]`]=!0,km[`[object Arguments]`]=km[`[object Array]`]=km[`[object ArrayBuffer]`]=km[`[object Boolean]`]=km[`[object DataView]`]=km[`[object Date]`]=km[`[object Error]`]=km[`[object Function]`]=km[`[object Map]`]=km[`[object Number]`]=km[`[object Object]`]=km[`[object RegExp]`]=km[`[object Set]`]=km[`[object String]`]=km[`[object WeakMap]`]=!1;var Am=function(e){return zf(e)&&Om(e.length)&&!!km[Rf(e)]},jm=function(e){return function(t){return e(t)}},Mm=jr((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&xf.process;e.exports=function(){try{return r&&r.require&&r.require(`util`).types||i&&i.binding&&i.binding(`util`)}catch{}}()})),Nm=Mm&&Mm.isTypedArray,Pm=Nm?jm(Nm):Am,Fm=Object.prototype.hasOwnProperty,Im=function(e,t){var n=Cm(e),r=!n&&Sm(e),i=!n&&!r&&Tm(e),a=!n&&!r&&!i&&Pm(e),o=n||r||i||a,s=o?_m(e.length,String):[],c=s.length;for(var l in e)!t&&!Fm.call(e,l)||o&&(l==`length`||i&&(l==`offset`||l==`parent`)||a&&(l==`buffer`||l==`byteLength`||l==`byteOffset`)||Dm(l,c))||s.push(l);return s},Lm=Object.prototype,Rm=function(e){var t=e&&e.constructor;return e===(typeof t==`function`&&t.prototype||Lm)},zm=function(e,t){return function(n){return e(t(n))}},Bm=zm(Object.keys,Object),Vm=Object.prototype.hasOwnProperty,Hm=function(e){if(!Rm(e))return Bm(e);var t=[];for(var n in Object(e))Vm.call(e,n)&&n!=`constructor`&&t.push(n);return t},Um=function(e){return e!=null&&Om(e.length)&&!Np(e)},Wm=function(e){return Um(e)?Im(e):Hm(e)},Gm=function(e,t){return e&&gm(t,Wm(t),e)},Km=function(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t},qm=Object.prototype.hasOwnProperty,Jm=function(e){if(!bf(e))return Km(e);var t=Rm(e),n=[];for(var r in e)(r!=`constructor`||!t&&qm.call(e,r))&&n.push(r);return n},Ym=function(e){return Um(e)?Im(e,!0):Jm(e)},Xm=function(e,t){return e&&gm(t,Ym(t),e)},Zm=jr((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?Cf.Buffer:void 0,a=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}})),Qm=function(e,t){var n=-1,r=e.length;for(t||=Array(r);++n<r;)t[n]=e[n];return t},$m=function(e,t){for(var n=-1,r=e==null?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a},eh=function(){return[]},th=Object.prototype.propertyIsEnumerable,nh=Object.getOwnPropertySymbols,rh=nh?function(e){return e==null?[]:$m(nh(e=Object(e)),(function(t){return th.call(e,t)}))}:eh,ih=function(e,t){return gm(e,rh(e),t)},ah=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},oh=zm(Object.getPrototypeOf,Object),sh=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ah(t,rh(e)),e=oh(e);return t}:eh,ch=function(e,t){return gm(e,sh(e),t)},lh=function(e,t,n){var r=t(e);return Cm(e)?r:ah(r,n(e))},uh=function(e){return lh(e,Wm,rh)},dh=function(e){return lh(e,Ym,sh)},fh=Up(Cf,`DataView`),ph=Up(Cf,`Promise`),mh=Up(Cf,`Set`),hh=Up(Cf,`WeakMap`),gh=`[object Map]`,_h=`[object Promise]`,vh=`[object Set]`,yh=`[object WeakMap]`,bh=`[object DataView]`,xh=Rp(fh),Sh=Rp(Wp),Ch=Rp(ph),wh=Rp(mh),Th=Rp(hh),Eh=Rf;(fh&&Eh(new fh(new ArrayBuffer(1)))!=bh||Wp&&Eh(new Wp)!=gh||ph&&Eh(ph.resolve())!=_h||mh&&Eh(new mh)!=vh||hh&&Eh(new hh)!=yh)&&(Eh=function(e){var t=Rf(e),n=t==`[object Object]`?e.constructor:void 0,r=n?Rp(n):``;if(r)switch(r){case xh:return bh;case Sh:return gh;case Ch:return _h;case wh:return vh;case Th:return yh}return t});var Dh=Eh,Oh=Object.prototype.hasOwnProperty,kh=function(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]==`string`&&Oh.call(e,`index`)&&(n.index=e.index,n.input=e.input),n},Ah=Cf.Uint8Array,jh=function(e){var t=new e.constructor(e.byteLength);return new Ah(t).set(new Ah(e)),t},Mh=function(e,t){var n=t?jh(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},Nh=/\w*$/,Ph=function(e){var t=new e.constructor(e.source,Nh.exec(e));return t.lastIndex=e.lastIndex,t},Fh=kf?kf.prototype:void 0,Ih=Fh?Fh.valueOf:void 0,Lh=function(e){return Ih?Object(Ih.call(e)):{}},Rh=function(e,t){var n=t?jh(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},zh=function(e,t,n){var r=e.constructor;switch(t){case`[object ArrayBuffer]`:return jh(e);case`[object Boolean]`:case`[object Date]`:return new r(+e);case`[object DataView]`:return Mh(e,n);case`[object Float32Array]`:case`[object Float64Array]`:case`[object Int8Array]`:case`[object Int16Array]`:case`[object Int32Array]`:case`[object Uint8Array]`:case`[object Uint8ClampedArray]`:case`[object Uint16Array]`:case`[object Uint32Array]`:return Rh(e,n);case`[object Map]`:case`[object Set]`:return new r;case`[object Number]`:case`[object String]`:return new r(e);case`[object RegExp]`:return Ph(e);case`[object Symbol]`:return Lh(e)}},Bh=Object.create,Vh=function(){function e(){}return function(t){if(!bf(t))return{};if(Bh)return Bh(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),Hh=function(e){return typeof e.constructor!=`function`||Rm(e)?{}:Vh(oh(e))},Uh=function(e){return zf(e)&&Dh(e)==`[object Map]`},Wh=Mm&&Mm.isMap,Gh=Wh?jm(Wh):Uh,Kh=function(e){return zf(e)&&Dh(e)==`[object Set]`},qh=Mm&&Mm.isSet,Jh=qh?jm(qh):Kh,Yh=`[object Arguments]`,Xh=`[object Function]`,Zh=`[object Object]`,Qh={};Qh[Yh]=Qh[`[object Array]`]=Qh[`[object ArrayBuffer]`]=Qh[`[object DataView]`]=Qh[`[object Boolean]`]=Qh[`[object Date]`]=Qh[`[object Float32Array]`]=Qh[`[object Float64Array]`]=Qh[`[object Int8Array]`]=Qh[`[object Int16Array]`]=Qh[`[object Int32Array]`]=Qh[`[object Map]`]=Qh[`[object Number]`]=Qh[Zh]=Qh[`[object RegExp]`]=Qh[`[object Set]`]=Qh[`[object String]`]=Qh[`[object Symbol]`]=Qh[`[object Uint8Array]`]=Qh[`[object Uint8ClampedArray]`]=Qh[`[object Uint16Array]`]=Qh[`[object Uint32Array]`]=!0,Qh[`[object Error]`]=Qh[Xh]=Qh[`[object WeakMap]`]=!1;var $h=function e(t,n,r,i,a,o){var s,c=1&n,l=2&n,u=4&n;if(r&&(s=a?r(t,i,a,o):r(t)),s!==void 0)return s;if(!bf(t))return t;var d=Cm(t);if(d){if(s=kh(t),!c)return Qm(t,s)}else{var f=Dh(t),p=f==Xh||f==`[object GeneratorFunction]`;if(Tm(t))return Zm(t,c);if(f==Zh||f==Yh||p&&!a){if(s=l||p?{}:Hh(t),!c)return l?ch(t,Xm(s,t)):ih(t,Gm(s,t))}else{if(!Qh[f])return a?t:{};s=zh(t,f,c)}}o||=new um;var m=o.get(t);if(m)return m;o.set(t,s),Jh(t)?t.forEach((function(i){s.add(e(i,n,r,i,t,o))})):Gh(t)&&t.forEach((function(i,a){s.set(a,e(i,n,r,a,t,o))}));var h=d?void 0:(u?l?dh:uh:l?Ym:Wm)(t);return dm(h||t,(function(i,a){h&&(i=t[a=i]),hm(s,a,e(i,n,r,a,t,o))})),s},eg=function(e){return $h(e,5)},tg=function(e){for(var t=-1,n=e==null?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},ng=function(e){return this.__data__.set(e,`__lodash_hash_undefined__`),this},rg=function(e){return this.__data__.has(e)};function ig(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new sm;++t<n;)this.add(e[t])}ig.prototype.add=ig.prototype.push=ng,ig.prototype.has=rg;var ag=ig,og=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},sg=function(e,t){return e.has(t)},cg=function(e,t,n,r,i,a){var o=1&n,s=e.length,c=t.length;if(!(s==c||o&&c>s))return!1;var l=a.get(e),u=a.get(t);if(l&&u)return l==t&&u==e;var d=-1,f=!0,p=2&n?new ag:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var m=e[d],h=t[d];if(r)var g=o?r(h,m,d,t,e,a):r(m,h,d,e,t,a);if(g!==void 0){if(g)continue;f=!1;break}if(p){if(!og(t,(function(e,t){if(!sg(p,t)&&(m===e||i(m,e,n,r,a)))return p.push(t)}))){f=!1;break}}else if(m!==h&&!i(m,h,n,r,a)){f=!1;break}}return a.delete(e),a.delete(t),f},lg=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},ug=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},dg=kf?kf.prototype:void 0,fg=dg?dg.valueOf:void 0,pg=function(e,t,n,r,i,a,o){switch(n){case`[object DataView]`:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case`[object ArrayBuffer]`:return!(e.byteLength!=t.byteLength||!a(new Ah(e),new Ah(t)));case`[object Boolean]`:case`[object Date]`:case`[object Number]`:return yp(+e,+t);case`[object Error]`:return e.name==t.name&&e.message==t.message;case`[object RegExp]`:case`[object String]`:return e==t+``;case`[object Map]`:var s=lg;case`[object Set]`:if(s||=ug,e.size!=t.size&&!(1&r))return!1;var c=o.get(e);if(c)return c==t;r|=2,o.set(e,t);var l=cg(s(e),s(t),r,i,a,o);return o.delete(e),l;case`[object Symbol]`:if(fg)return fg.call(e)==fg.call(t)}return!1},mg=Object.prototype.hasOwnProperty,hg=function(e,t,n,r,i,a){var o=1&n,s=uh(e),c=s.length;if(c!=uh(t).length&&!o)return!1;for(var l=c;l--;){var u=s[l];if(!(o?u in t:mg.call(t,u)))return!1}var d=a.get(e),f=a.get(t);if(d&&f)return d==t&&f==e;var p=!0;a.set(e,t),a.set(t,e);for(var m=o;++l<c;){var h=e[u=s[l]],g=t[u];if(r)var _=o?r(g,h,u,t,e,a):r(h,g,u,e,t,a);if(!(_===void 0?h===g||i(h,g,n,r,a):_)){p=!1;break}m||=u==`constructor`}if(p&&!m){var v=e.constructor,y=t.constructor;v==y||!(`constructor`in e)||!(`constructor`in t)||typeof v==`function`&&v instanceof v&&typeof y==`function`&&y instanceof y||(p=!1)}return a.delete(e),a.delete(t),p},gg=`[object Arguments]`,_g=`[object Array]`,vg=`[object Object]`,yg=Object.prototype.hasOwnProperty,bg=function(e,t,n,r,i,a){var o=Cm(e),s=Cm(t),c=o?_g:Dh(e),l=s?_g:Dh(t),u=(c=c==gg?vg:c)==vg,d=(l=l==gg?vg:l)==vg,f=c==l;if(f&&Tm(e)){if(!Tm(t))return!1;o=!0,u=!1}if(f&&!u)return a||=new um,o||Pm(e)?cg(e,t,n,r,i,a):pg(e,t,c,n,r,i,a);if(!(1&n)){var p=u&&yg.call(e,`__wrapped__`),m=d&&yg.call(t,`__wrapped__`);if(p||m){var h=p?e.value():e,g=m?t.value():t;return a||=new um,i(h,g,n,r,a)}}return!!f&&(a||=new um,hg(e,t,n,r,i,a))},xg=function e(t,n,r,i,a){return t===n||(t==null||n==null||!zf(t)&&!zf(n)?t!=t&&n!=n:bg(t,n,r,i,e,a))},Sg=function(e,t){return xg(e,t)},Cg=function(e,t,n){(n!==void 0&&!yp(e[t],n)||n===void 0&&!(t in e))&&pm(e,t,n)},wg=function(e){return function(t,n,r){for(var i=-1,a=Object(t),o=r(t),s=o.length;s--;){var c=o[e?s:++i];if(!1===n(a[c],c,a))break}return t}}(),Tg=function(e){return zf(e)&&Um(e)},Eg=Function.prototype.toString,Dg=Object.prototype.hasOwnProperty,Og=Eg.call(Object),kg=function(e){if(!zf(e)||Rf(e)!=`[object Object]`)return!1;var t=oh(e);if(t===null)return!0;var n=Dg.call(t,`constructor`)&&t.constructor;return typeof n==`function`&&n instanceof n&&Eg.call(n)==Og},Ag=function(e,t){if((t!==`constructor`||typeof e[t]!=`function`)&&t!=`__proto__`)return e[t]},jg=function(e){return gm(e,Ym(e))},Mg=function(e,t,n,r,i,a,o){var s=Ag(e,n),c=Ag(t,n),l=o.get(c);if(l)Cg(e,n,l);else{var u=a?a(s,c,n+``,e,t,o):void 0,d=u===void 0;if(d){var f=Cm(c),p=!f&&Tm(c),m=!f&&!p&&Pm(c);u=c,f||p||m?Cm(s)?u=s:Tg(s)?u=Qm(s):p?(d=!1,u=Zm(c,!0)):m?(d=!1,u=Rh(c,!0)):u=[]:kg(c)||Sm(c)?(u=s,Sm(s)?u=jg(s):bf(s)&&!Np(s)||(u=Hh(c))):d=!1}d&&(o.set(c,u),i(u,c,r,a,o),o.delete(c)),Cg(e,n,u)}},Ng=function e(t,n,r,i,a){t!==n&&wg(n,(function(o,s){if(a||=new um,bf(o))Mg(t,n,s,r,e,i,a);else{var c=i?i(Ag(t,s),o,s+``,t,n,a):void 0;c===void 0&&(c=o),Cg(t,s,c)}}),Ym)},Pg=function(e){return e},Fg=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},Ig=Math.max,Lg=function(e,t,n){return t=Ig(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,a=Ig(r.length-t,0),o=Array(a);++i<a;)o[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(o),Fg(e,this,s)}},Rg=function(e){return function(){return e}},zg=Date.now,Bg=function(e){var t=0,n=0;return function(){var r=zg(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(fm?function(e,t){return fm(e,`toString`,{configurable:!0,enumerable:!1,value:Rg(t),writable:!0})}:Pg),Vg=function(e,t){return Bg(Lg(e,t,Pg),e+``)},Hg=function(e,t,n){if(!bf(n))return!1;var r=typeof t;return!!(r==`number`?Um(n)&&Dm(t,n.length):r==`string`&&t in n)&&yp(n[t],e)},Ug=function(e){return Vg((function(t,n){var r=-1,i=n.length,a=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(a=e.length>3&&typeof a==`function`?(i--,a):void 0,o&&Hg(n[0],n[1],o)&&(a=3>i?void 0:a,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,a)}return t}))}((function(e,t,n){Ng(e,t,n)})),Wg=function(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i},Gg=function(e,t){return Wg(t,(function(t){return[t,e[t]]}))},Kg=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n},qg=function(e){return function(t){var n=Dh(t);return n==`[object Map]`?lg(t):n==`[object Set]`?Kg(t):Gg(t,e(t))}}(Wm),Jg=jr((function(e){(function(t,n){if(t){for(var r,i={8:`backspace`,9:`tab`,13:`enter`,16:`shift`,17:`ctrl`,18:`alt`,20:`capslock`,27:`esc`,32:`space`,33:`pageup`,34:`pagedown`,35:`end`,36:`home`,37:`left`,38:`up`,39:`right`,40:`down`,45:`ins`,46:`del`,91:`meta`,93:`meta`,224:`meta`},a={106:`*`,107:`+`,109:`-`,110:`.`,111:`/`,186:`;`,187:`=`,188:`,`,189:`-`,190:`.`,191:`/`,192:"`",219:`[`,220:`\\`,221:`]`,222:`'`},o={"~":"`","!":`1`,"@":`2`,"#":`3`,$:`4`,"%":`5`,"^":`6`,"&":`7`,"*":`8`,"(":`9`,")":`0`,_:`-`,"+":`=`,":":`;`,'"':`'`,"<":`,`,">":`.`,"?":`/`,"|":`\\`},s={option:`alt`,command:`meta`,return:`enter`,escape:`esc`,plus:`+`,mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?`meta`:`ctrl`},c=1;20>c;++c)i[111+c]=`f`+c;for(c=0;9>=c;++c)i[c+96]=``+c;h.prototype.bind=function(e,t,n){var r=this;return r._bindMultiple.call(r,e=e instanceof Array?e:[e],t,n),r},h.prototype.unbind=function(e,t){return this.bind.call(this,e,(function(){}),t)},h.prototype.trigger=function(e,t){var n=this;return n._directMap[e+`:`+t]&&n._directMap[e+`:`+t]({},e),n},h.prototype.reset=function(){var e=this;return e._callbacks={},e._directMap={},e},h.prototype.stopCallback=function(e,t){if((` `+t.className+` `).indexOf(` mousetrap `)>-1||m(t,this.target))return!1;if(`composedPath`in e&&typeof e.composedPath==`function`){var n=e.composedPath()[0];n!==e.target&&(t=n)}return t.tagName==`INPUT`||t.tagName==`SELECT`||t.tagName==`TEXTAREA`||t.isContentEditable},h.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},h.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);r=null},h.init=function(){var e=h(n);for(var t in e)t.charAt(0)!==`_`&&(h[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},h.init(),t.Mousetrap=h,e.exports&&=h}function l(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent(`on`+t,n)}function u(e){if(e.type==`keypress`){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return i[e.which]?i[e.which]:a[e.which]?a[e.which]:String.fromCharCode(e.which).toLowerCase()}function d(e){return e==`shift`||e==`ctrl`||e==`alt`||e==`meta`}function f(e,t,n){return n||=function(){if(!r)for(var e in r={},i)e>95&&112>e||i.hasOwnProperty(e)&&(r[i[e]]=e);return r}()[e]?`keydown`:`keypress`,n==`keypress`&&t.length&&(n=`keydown`),n}function p(e,t){var n,r,i,a=[];for(n=function(e){return e===`+`?[`+`]:(e=e.replace(/\+{2}/g,`+plus`)).split(`+`)}(e),i=0;n.length>i;++i)s[r=n[i]]&&(r=s[r]),t&&t!=`keypress`&&o[r]&&(r=o[r],a.push(`shift`)),d(r)&&a.push(r);return{key:r,modifiers:a,action:t=f(r,a,t)}}function m(e,t){return e!==null&&e!==n&&(e===t||m(e.parentNode,t))}function h(e){var t=this;if(e||=n,!(t instanceof h))return new h(e);t.target=e,t._callbacks={},t._directMap={};var r,i={},a=!1,o=!1,s=!1;function c(e){e||={};var t,n=!1;for(t in i)e[t]?n=!0:i[t]=0;n||(s=!1)}function f(e,n,r,a,o,s){var c,l,u,f=[],p=r.type;if(!t._callbacks[e])return[];for(p==`keyup`&&d(e)&&(n=[e]),c=0;t._callbacks[e].length>c;++c)l=t._callbacks[e][c],(a||!l.seq||i[l.seq]==l.level)&&p==l.action&&(p==`keypress`&&!r.metaKey&&!r.ctrlKey||(u=l.modifiers,n.sort().join(`,`)===u.sort().join(`,`)))&&((!a&&l.combo==o||a&&l.seq==a&&l.level==s)&&t._callbacks[e].splice(c,1),f.push(l));return f}function m(e,n,r,i){t.stopCallback(n,n.target||n.srcElement,r,i)||!1===e(n,r)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(n),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(n))}function g(e){typeof e.which!=`number`&&(e.which=e.keyCode);var n=u(e);n&&(e.type!=`keyup`||a!==n?t.handleKey(n,function(e){var t=[];return e.shiftKey&&t.push(`shift`),e.altKey&&t.push(`alt`),e.ctrlKey&&t.push(`ctrl`),e.metaKey&&t.push(`meta`),t}(e),e):a=!1)}function _(e,t,n,o){function l(t){return function(){s=t,++i[e],clearTimeout(r),r=setTimeout(c,1e3)}}function d(t){m(n,t,e),o!==`keyup`&&(a=u(t)),setTimeout(c,10)}i[e]=0;for(var f=0;t.length>f;++f){var h=f+1===t.length?d:l(o||p(t[f+1]).action);v(t[f],h,o,e,f)}}function v(e,n,r,i,a){t._directMap[e+`:`+r]=n;var o,s=(e=e.replace(/\s+/g,` `)).split(` `);s.length>1?_(e,s,n,r):(o=p(e,r),t._callbacks[o.key]=t._callbacks[o.key]||[],f(o.key,o.modifiers,{type:o.action},i,e,a),t._callbacks[o.key][i?`unshift`:`push`]({callback:n,modifiers:o.modifiers,action:o.action,seq:i,level:a,combo:e}))}t._handleKey=function(e,t,n){var r,i=f(e,t,n),a={},l=0,u=!1;for(r=0;i.length>r;++r)i[r].seq&&(l=Math.max(l,i[r].level));for(r=0;i.length>r;++r)if(i[r].seq){if(i[r].level!=l)continue;u=!0,a[i[r].seq]=1,m(i[r].callback,n,i[r].combo,i[r].seq)}else u||m(i[r].callback,n,i[r].combo);var p=n.type==`keypress`&&o;n.type!=s||d(e)||p||c(a),o=u&&n.type==`keydown`},t._bindMultiple=function(e,t,n){for(var r=0;e.length>r;++r)v(e[r],t,n)},l(e,`keypress`,g),l(e,`keydown`,g),l(e,`keyup`,g)}})(typeof window<`u`?window:null,typeof window<`u`?document:null)})),Yg,Xg=function(e){return e&&e.length?e[0]:void 0},Zg=(Yg=1,function(e){return`${e}-${Yg++}`}),Qg=function(e,t){return!(!e||!t||e.properties?.id!==t.properties?.id)},$g=function(e){var t=e.target,n=e.targetHandler,r=e.otherHandler;return e.data.map((function(e,i){return(Qg(e,t)?n:r)?.(e,i)??e}))},e_=function(){return{id:Zg(`point`),isHover:!1,isActive:!1,isDrag:!1,createTime:Date.now()}},t_=function(){return{id:Zg(`line`),isHover:!1,isActive:!1,isDrag:!1,isDraw:!1,createTime:Date.now()}},n_=function(){return{id:Zg(`polygon`),isHover:!1,isActive:!1,isDrag:!1,isDraw:!1,createTime:Date.now()}},r_=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return An(e,yn(yn({},e_()),t))},i_=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return{type:`Feature`,properties:yn(yn({},t_()),{},{nodes:e},t),geometry:{type:`LineString`,coordinates:qn(Nn(e))}}},a_=function(e){return Mn(e,{id:Zg(`dashLine`)})},o_=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return{type:`Feature`,properties:yn(yn({},n_()),{},{nodes:e},t),geometry:{type:`Polygon`,coordinates:[qn(Nn([].concat(Sn(e),[Xg(e)])))]}}},s_=function(e){return e.forEach((function(e){e.bbox=tr(e)})),e},c_=function(e){return e.map((function(e,t){if(e.geometry.type.startsWith(`Multi`)){var n=e.geometry.type.replace(`Multi`,``);return e.geometry.coordinates.map((function(r){return{type:`Feature`,properties:yn(yn({},e.properties),{},{multiIndex:t}),geometry:{type:n,coordinates:r}}}))}return e})).flat()},l_=function(e){var t=[],n={};return e.forEach((function(e){var r=e.properties?.multiIndex;if(typeof r==`number`){var i=n[r];if(i)i.geometry.coordinates.push(e.geometry.coordinates);else{var a=`Multi${e.geometry.type}`,o={type:`Feature`,properties:yn({},e.properties),geometry:{type:a,coordinates:[e.geometry.coordinates]}};n[r]=o,t.push(o)}}else t.push(e)})),t},u_=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6;return Math.round(e*10**t)/10**t},d_=function(e){return function(e,t,n){n===void 0&&(n={});for(var r=ir(e).coordinates,i=0,a=0;r.length>a&&(i>t||a!==r.length-1);a++){if(i>=t){var o=t-i;if(o){var s=ei(r[a],r[a-1])-180;return $r(r[a],o,s,n)}return An(r[a])}i+=Zr(r[a],r[a+1],n)}return An(r[r.length-1])}(e,pf(e,{units:`meters`})/2,{units:`meters`})},f_=function(e,t){var n=t.format,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=[];if(t.showTotalDistance){var a=d_(e),o=pf(e,{units:`meters`}),s=qn(e).map((function(e){return An(e)}));a.properties=yn({id:Zg(`text`),isActive:!1,meters:o,text:n(o,s),type:`totalDistance`},r),i.push(a)}else for(var c=e.geometry.coordinates,l=0;c.length-1>l;l++){var u=An(c[l]),d=An(c[l+1]),f=Zr(u,d,{units:`meters`}),p=ti(Nn([u,d]));p.properties=yn({id:Zg(`text`),isActive:!1,meters:f,text:n(f,[u,d]),type:`distance`},r),i.push(p)}return i},p_=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=t.format,i=lf(e);return ri(e,{properties:yn({meters:i,text:r(i,e),type:`area`,isActive:!1},n)})},m_=function(e){var t=e.getContainer();return t?.querySelector(`.l7-marker-container`)??t?.querySelector(`.BMap_mask`)??t?.querySelector(`#tdt-L7`)??e.getMapCanvasContainer()??t?.querySelector(`.l7-scene`)??t?.querySelector(`.l7-control-container`)??t?.querySelector(`.l7-marker-container2`)??null},h_=function(e){return e.lngLat||e.lnglat||e.latlng},g_=function(e){var t=h_(e);return[t.lng,t.lat]},__=function(e){return[e.lng,e.lat]},v_=function(e){for(var t=2**53-1,n=0,r=e.length,i=0;r>i;i++)t>e[i]&&(t=e[i],n=i);return n},y_=function(e,t){var n=[],r=[];return e.forEach((function(e){Sg(e,t)?r.length&&(n.push(r),r=[]):r.push(e)})),r.length&&n.push(r),n},b_=function(e,t,n,r){var i=[];i=t.map((function(t){var n=t.properties?.line;return t.properties?.isActive&&n?y_(n.properties.nodes.map((function(e){return e.geometry.coordinates})),e).filter((function(e){return e.length>1})).map((function(e){return Mn(e)})):[n]})).flat().filter((function(e){return e})),i.length||t.forEach((function(e){var t=ar(e);if(/linestring/i.test(t)&&i.push(e),/polygon/i.test(t)){var n,r=mf(e);return(n=i).push.apply(n,Sn(r?.features??[r]))}}));var a=n.lineAdsorbPixel,o=xn(e,2),s=r.lngLatToPixel([o[0],o[1]]),c=s.x,l=s.y,u=i.filter((function(e){return qn(e).length>1})).map((function(t){return function(e,t,n){n===void 0&&(n={});var r=An([1/0,1/0],{dist:1/0}),i=0;return Xn(e,(function(e){for(var a=rr(e),o=0;a.length-1>o;o++){var s=An(a[o]);s.properties.dist=Zr(t,s,n);var c=An(a[o+1]);c.properties.dist=Zr(t,c,n);var l=Zr(s,c,n),u=Math.max(s.properties.dist,c.properties.dist),d=ei(s,c),f=$r(t,u,d+90,n),p=$r(t,u,d-90,n),m=of(Mn([f.geometry.coordinates,p.geometry.coordinates]),Mn([s.geometry.coordinates,c.geometry.coordinates])),h=null;m.features.length>0&&((h=m.features[0]).properties.dist=Zr(t,h,n),h.properties.location=i+Zr(s,h,n)),r.properties.dist>s.properties.dist&&((r=s).properties.index=o,r.properties.location=i),r.properties.dist>c.properties.dist&&((r=c).properties.index=o+1,r.properties.location=i+l),h&&r.properties.dist>h.properties.dist&&((r=h).properties.index=o),i+=l}})),r}(t,e)}));if(!u.length)return null;var d=u.map((function(e){var t=xn(e.geometry.coordinates,2),n=r.lngLatToPixel([t[0],t[1]]),i=n.y;return(c-n.x)**2+(l-i)**2})),f=v_(d);return d[f]**.5>a?null:u[f].geometry.coordinates},x_=function(e,t,n){var r=xn(e.bbox??s_([e])[0].bbox,4),i=r[2],a=r[3],o=t.lngLatToContainer([r[0],r[1]]),s=o.x,c=o.y,l=t.lngLatToContainer([i,a]),u=l.x,d=l.y,f=t.containerToLngLat([s-n,c+n]),p=f.lng,m=f.lat,h=t.containerToLngLat([u+n,d-n]),g=h.lng,_=h.lat;return[Math.min(p,g),Math.min(m,_),Math.max(p,g),Math.max(m,_)]},S_=function(e,t){var n=xn(t,4),r=n[0],i=n[1],a=n[2],o=n[3],s=xn(e,2),c=s[0],l=s[1];return!(r>c||c>a||i>l||l>o)},C_=function(e){var t=e.adsorbOptions,n=e.draw,r=e.position,i=e.scene,a=t.data,o=t.pointAdsorbPixel,s=t.lineAdsorbPixel,c=[];if(c=a===`allDrawData`?A_.instances.map((function(e){return e.getData(!0)})).flat():a===`drawData`?n.getData(!0):a instanceof Function?a(r):a,c=c.filter((function(e){return e.properties?.isActive||S_(r,x_(e,i,o))?!0:!!S_(r,x_(e,i,s))})),t.pointAdsorbPixel>0){var l=function(e,t,n,r){var i=n.pointAdsorbPixel,a=[];if(t.length&&(a=t.map((function(t){var n=t.properties??{},r=n.nodes,i=r===void 0?[]:r,a=n.isActive;return a!==void 0&&a?i.filter((function(t){return!Sg(t.geometry.coordinates,e)})):i})).flat().filter((function(e){return e}))),a.length||(a=qn(Nn(t)).map((function(e){return An(e)}))),a=a.filter((function(t){return S_(e,x_(t,r,i))})),!a.length)return null;var o=xn(e,2),s=r.lngLatToPixel([o[0],o[1]]),c=s.x,l=s.y,u=a.map((function(e){var t=xn(e.geometry.coordinates,2),n=r.lngLatToPixel([t[0],t[1]]),i=n.y;return(c-n.x)**2+(l-i)**2})),d=v_(u);return u[d]**.5>i?null:a[d].geometry.coordinates}(r,c,t,i);if(l)return l}if(t.lineAdsorbPixel>0){var u=b_(r,c,t,i);if(u)return u}return r},w_=function(e,t){var n=xn(t,2),r=n[0],i=n[1];e.lngLat&&={lng:r,lat:i},e.lnglat&&={lng:r,lat:i}},T_=function(){return fn((function e(t,n){un(this,e),this.container=void 0,this.cursor=null,this.options=void 0,this.container=m_(t),this.options=n}),[{key:`setCursor`,value:function(e){e!==this.cursor&&this.container&&(this.container.style.cursor=e?this.options[e]:``,this.cursor=e)}},{key:`destroy`,value:function(){this.setCursor(null)}}])}();function E_(e,t){t===void 0&&(t={});var n=t.insertAt;if(e&&typeof document<`u`){var r=document.head||document.getElementsByTagName(`head`)[0],i=document.createElement(`style`);i.type=`text/css`,n===`top`&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}E_(`.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(.54,1.5,.38,1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:transparent;border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}`),E_(`.tippy-box[data-theme~=light]{color:#26323d;box-shadow:0 0 20px 4px rgba(154,161,177,.15),0 4px 80px -8px rgba(36,40,47,.25),0 4px 4px -2px rgba(91,94,105,.15);background-color:#fff}.tippy-box[data-theme~=light][data-placement^=top]>.tippy-arrow:before{border-top-color:#fff}.tippy-box[data-theme~=light][data-placement^=bottom]>.tippy-arrow:before{border-bottom-color:#fff}.tippy-box[data-theme~=light][data-placement^=left]>.tippy-arrow:before{border-left-color:#fff}.tippy-box[data-theme~=light][data-placement^=right]>.tippy-arrow:before{border-right-color:#fff}.tippy-box[data-theme~=light]>.tippy-backdrop{background-color:#fff}.tippy-box[data-theme~=light]>.tippy-svg-arrow{fill:#fff}`);var D_=function(){return fn((function t(n,r){var i=this;un(this,t),this.content=``,this.tippy=void 0,this.scene=void 0,this.isMouseInner=!1,this.onMouseMove=function(){i.isMouseInner=!0,i.checkTippyShow()},this.onMouseOut=function(){i.isMouseInner=!1,i.checkTippyShow()},this.setContent=Jf((function(e){var t;i.content=e??``,(t=i.tippy)==null||t.setContent(e??``),i.checkTippyShow()}),16,{maxWait:16});var a=m_(n);this.scene=n,a&&(this.tippy=Ut(m_(n),yn(yn({},an),r)),this.tippy.hide(),n.on(e.SceneEvent.Mousemove,this.onMouseMove),n.on(e.SceneEvent.Mouseout,this.onMouseOut))}),[{key:`getContent`,value:function(){return this.content}},{key:`checkTippyShow`,value:function(){var e,t;this.content&&this.isMouseInner?(e=this.tippy)==null||e.show():(t=this.tippy)==null||t.hide()}},{key:`destroy`,value:function(){var t;this.scene.off(e.SceneEvent.Mousemove,this.onMouseMove),this.scene.off(e.SceneEvent.Mouseout,this.onMouseOut),(t=this.tippy)==null||t.destroy()}}])}(),O_=function(){return fn((function e(t){var n=t.config;un(this,e),this.historyList=[],this.historyIndex=0,this.config=void 0,this.config=n}),[{key:`save`,value:function(e){if(this.config){var t=this.config.maxSize;this.historyIndex&&=(this.historyList=this.historyList.slice(this.historyIndex),0),t>this.historyList.length||this.historyList.pop();var n=eg(e);return this.historyList.unshift(n),n}}},{key:`revert`,value:function(){if(this.historyList.length&&this.historyList.length-1>this.historyIndex){var e=this.historyList[++this.historyIndex];return e?eg(e):void 0}}},{key:`redo`,value:function(){if(this.historyList.length&&this.historyIndex>0){var e=this.historyList[--this.historyIndex];return e?eg(e):void 0}}}])}(),k_=function(t){function n(e){var t,i=e.data,a=e.render,o=e.history,s=e.scene,c=e.bbox;return un(this,n),(t=ln(this,n)).scene=void 0,t.render=void 0,t.data=eg(r),t.timeout=null,t.diffData={},t.enableBBox=void 0,t.featureType=void 0,t.history=void 0,t.scene=s,t.render=a,o&&(t.history=new O_({config:o})),i&&t.setData(i),t.featureType=a.polygon?`polygon`:a.line?`line`:`point`,t.enableBBox=c,t}return gn(n,t),fn(n,[{key:`saveHistory`,value:function(){return this.history?.save(this.data)}},{key:`revertHistory`,value:function(){var e=this.history?.revert();if(e)return this.setData(e),e}},{key:`redoHistory`,value:function(){var e=this.history?.redo();if(e)return this.setData(e),e}},{key:`setData`,value:function(t){var n,r=this;return Object.keys(t).length&&(this.enableBBox&&(n=t[this.featureType])!=null&&n.length&&(t[this.featureType]=s_(t[this.featureType])),this.data=yn(yn({},this.data),t),this.diffData=yn(yn({},this.diffData),t),this.timeout||=requestAnimationFrame((function(){return r.updateDiffData()})),this.emit(e.SourceEvent.Change,{data:this.data})),this.data}},{key:`getData`,value:function(){return this.data}},{key:`getRenderData`,value:function(e){return this.data[e]}},{key:`setRenderData`,value:function(t,n){var r=typeof n==`function`?n(this.getRenderData(t)):n;return this.setData(pn({},t,r)),this.emit(e.SourceEvent.Change,this.data),r}},{key:`updateDiffData`,value:function(){var t=this,n=Object.entries(this.diffData);n.length&&(n.forEach((function(e){var n,r=xn(e,2),i=r[0],a=r[1];Array.isArray(a)&&((n=t.getRender(i))==null||n.setData(a))})),this.emit(e.SourceEvent.Update,this.data,this.diffData),this.diffData={},this.timeout=null,requestAnimationFrame((function(){t.scene.render()})))}},{key:`getRender`,value:function(e){return this.render[e]}},{key:`clear`,value:function(){this.setData(tg(Object.keys(this.render).map((function(e){return[e,[]]}))))}}])}(_f),A_=function(t){function r(t,n){var i,a;un(this,r),(a=ln(this,r)).scene=void 0,a.source=void 0,a.render=void 0,a.cursor=void 0,a.options=void 0,a.enabled=!1,a.allowCreate=!1,a.sceneRender=void 0,a.mouseLngLat={lng:0,lat:0},a.popup=void 0,a.addCount=0,a.saveMouseLngLat=Jf((function(e){a.mouseLngLat=h_(e)}),100,{maxWait:100}),a.saveHistory=Jf((function(){a.options.history&&a.source.saveHistory()}),100),a.bindThis(),a.scene=t,a.sceneRender=new $f(t),a.options=Ug({},a.getDefaultOptions(n),n),a.render=a.initRender(),a.source=new k_({render:a.render,history:a.options.history||void 0,scene:t,bbox:(i=a.options.bbox)!=null&&i}),a.cursor=new T_(t,a.options.cursor);var o=a.options,s=o.initialData,c=o.popup;return s&&a.setData(s),c&&(a.popup=new D_(t,c instanceof Object?c:{})),a.saveHistory(),a.bindCommonEvent(),a.emit(e.DrawEvent.Init,a),a.bindEnableEvent(),r.instances.push(a),a}return gn(r,t),fn(r,[{key:`addable`,get:function(){var e=this.getData(),t=this.options,n=t.multiple,r=t.maxCount,i=e.find((function(e){return e.properties?.isDraw}));return!(!this.enabled||!this.allowCreate)&&(!!(n&&0>=r||i)||!(!n&&this.addCount>=1)&&(0>=r||r>e.length))}},{key:`getOptions`,value:function(){return this.options}},{key:`getEditItem`,value:function(){return this.editItem}},{key:`getDragItem`,value:function(){return this.dragItem}},{key:`setHelper`,value:function(e){var t,n=this.options.helper;if(n){var r=(e in n?n[e]:e)??null;(t=this.popup)==null||t.setContent(r)}}},{key:`isEnable`,value:function(){return this.enabled}},{key:`bindThis`,value:function(){this.initRender=this.initRender.bind(this),this.getData=this.getData.bind(this),this.setData=this.setData.bind(this),this.emitChangeEvent=this.emitChangeEvent.bind(this),this.saveHistory=this.saveHistory.bind(this),this.onSceneMouseMove=this.onSceneMouseMove.bind(this),this.revertHistory=this.revertHistory.bind(this),this.redoHistory=this.redoHistory.bind(this),this.removeActiveFeature=this.removeActiveFeature.bind(this),this.bindCommonEvent=this.bindCommonEvent.bind(this),this.bindEnableEvent=this.bindEnableEvent.bind(this),this.unbindEnableEvent=this.unbindEnableEvent.bind(this),this.setActiveFeature=this.setActiveFeature.bind(this)}},{key:`bindCommonEvent`,value:function(){var t=this;this.on(e.DrawEvent.Add,this.emitChangeEvent),this.on(e.DrawEvent.Add,(function(){t.addCount++})),this.on(e.DrawEvent.Edit,this.emitChangeEvent),this.on(e.DrawEvent.Remove,this.emitChangeEvent),this.on(e.DrawEvent.Clear,this.emitChangeEvent),this.on(e.DrawEvent.AddNode,this.saveHistory),this.on(e.DrawEvent.RemoveNode,this.emitChangeEvent),this.bindEmitSelectEvent(!0)}},{key:`bindEmitSelectEvent`,value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=null,i=function(){var n,i,a,o=t.getData(!0).find((function(e){return e.properties?.isActive}))||null;((n=r)==null||(i=n.properties)==null?void 0:i.id)!==(o==null||(a=o.properties)==null?void 0:a.id)&&(r=o,t.emit(e.DrawEvent.Select,o))};this.source.on(e.SourceEvent.Change,i),n&&i()}},{key:`bindEnableEvent`,value:function(){this.unbindKeyboardEvent(),this.scene.setMapStatus({doubleClickZoom:!1}),this.scene.on(e.SceneEvent.Mousemove,this.saveMouseLngLat),this.bindKeyboardEvent()}},{key:`unbindEnableEvent`,value:function(){this.scene.setMapStatus({doubleClickZoom:!0}),this.scene.off(e.SceneEvent.Mousemove,this.saveMouseLngLat),this.unbindKeyboardEvent()}},{key:`bindKeyboardEvent`,value:function(){var e=this,t=this.options.keyboard||{},n=t.revert,r=t.redo,i=t.remove;i&&Jg.bind(i,(function(){e.removeActiveFeature()})),this.options.history&&(n&&Jg.bind(n,this.revertHistory),r&&Jg.bind(r,this.redoHistory))}},{key:`unbindKeyboardEvent`,value:function(){var e=this.options.keyboard||{},t=e.revert,n=e.redo,r=e.remove;r&&Jg.unbind(r),this.options.history&&(t&&Jg.unbind(t),n&&Jg.unbind(n))}},{key:`emitChangeEvent`,value:function(){this.emit(e.DrawEvent.Change,this.getData()),this.saveHistory()}},{key:`revertHistory`,value:function(){this.enabled&&this.options.history&&this.source.revertHistory()&&(this.correctDrawItem(),this.emit(e.DrawEvent.Change,this.getData()))}},{key:`redoHistory`,value:function(){this.enabled&&this.options.history&&this.source.redoHistory()&&(this.correctDrawItem(),this.emit(e.DrawEvent.Change,this.getData()))}},{key:`getRenderLayers`,value:function(){return tg(qg(this.render).map((function(e){var t=xn(e,2);return[t[0],t[1].getLayers()]})))}},{key:`getTargetFeature`,value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getData(!0),n=null;return e&&(n=t.find((function(t){return t.properties?.id===(typeof e==`string`?e:e.properties?.id)}))??null,!n&&e instanceof Object&&(n=t.find((function(t){return Sg(e.geometry,t.geometry)}))??null)),n}},{key:`removeActiveFeature`,value:function(){var e=this.getData(!0).find((function(e){var t=e.properties??{};return t.isActive||t.isDraw}));return e&&this.removeFeature(e),e}},{key:`removeFeature`,value:function(t){var n=this.getData(!0),r=this.getTargetFeature(t);r&&(this.setData(n.filter((function(e){return!Qg(r,e)}))),this.emit(e.DrawEvent.Remove,t,this.getData()))}},{key:`correctDrawItem`,value:function(){this.getData(!0).find((function(e){return e.properties?.isDraw}))&&this.onSceneMouseMove({type:`mousemove`,lnglat:this.mouseLngLat,lngLat:this.mouseLngLat})}},{key:`initRender`,value:function(){var e,t={},n=function(e,t){var n=typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(!n){if(Array.isArray(e)||(n=Tn(e))||t&&e&&typeof e.length==`number`){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return e.length>r?{done:!1,value:e[r++]}:{done:!0}},e:function(e){throw e},f:i}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||n.return==null||n.return()}finally{if(s)throw a}}}}(this.getRenderTypes());try{for(n.s();!(e=n.n()).done;){var r=e.value;t[r]=new tp[r](this.scene,{style:this.options.style[r]})}}catch(e){n.e(e)}finally{n.f()}return t}},{key:`getCommonOptions`,value:function(e){return{initialData:[],autoActive:!0,cursor:eg(n),editable:!0,style:eg(dp),multiple:!0,history:eg(nn),keyboard:eg(rn),popup:!0,helper:{},maxCount:-1}}},{key:`setCursor`,value:function(e){this.cursor.setCursor(e)}},{key:`resetCursor`,value:function(){this.setCursor(this.addable?`draw`:null)}},{key:`enable`,value:function(){var t=this;this.allowCreate=0>=arguments.length||arguments[0]===void 0||arguments[0],this.addCount=0,this.enabled=!0,this.bindEnableEvent(),this.resetCursor(),this.setHelper(this.addable?`draw`:null),setTimeout((function(){t.emit(e.DrawEvent.Enable,t)}),0)}},{key:`disable`,value:function(){var t=this;this.resetFeatures(),this.enabled=!1,this.setCursor(null),this.unbindEnableEvent(),this.addCount=0,this.setHelper(null),setTimeout((function(){t.emit(e.DrawEvent.Disable,t)}),0)}},{key:`clear`,value:function(){var t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.source.clear(),this.emit(e.DrawEvent.Clear,this),t&&this.disable()}},{key:`show`,value:function(){return Object.values(this.render).forEach((function(e){e.show()}))}},{key:`hide`,value:function(){return Object.values(this.render).forEach((function(e){e.hide()}))}},{key:`destroy`,value:function(){var t,n=this;Object.values(this.render).forEach((function(e){e.destroy()})),Object.values(e.RenderEvent).forEach((function(e){Object.values(n.render).forEach((function(t){t.removeAllListeners(e)})),n.sceneRender.removeAllListeners(e)})),setTimeout((function(){Object.values(e.DrawEvent).forEach((function(e){n.removeAllListeners(e)}))}),0),(t=this.popup)==null||t.destroy(),this.cursor.destroy(),this.emit(e.DrawEvent.Destroy,this);var i=r.instances.indexOf(this);i>-1&&r.instances.splice(i,1)}}])}(_f);A_.instances=[];var j_=function(e){var t=e==null?0:e.length;return t?e[t-1]:void 0},M_=function(t){function n(){return un(this,n),ln(this,n,arguments)}return gn(n,t),fn(n,[{key:`pointRender`,get:function(){return this.render.point}},{key:`dragPoint`,get:function(){return this.getPointData().find((function(e){return e.properties.isDrag}))}},{key:`editPoint`,get:function(){return this.getPointData().find((function(e){return e.properties.isActive}))}},{key:`hoverPoint`,get:function(){return this.getPointData().find((function(e){return e.properties.isHover}))}},{key:`getDragPoint`,value:function(){return this.dragPoint}},{key:`getEditPoint`,value:function(){return this.editPoint}},{key:`getPointData`,value:function(){return this.source.getRenderData(`point`)}},{key:`setPointData`,value:function(e){return this.source.setRenderData(`point`,e)}},{key:`bindPointRenderEvent`,value:function(){var t,n,r,i,a,o;(t=this.pointRender)==null||t.on(e.RenderEvent.UnClick,this.onPointCreate.bind(this)),(n=this.pointRender)==null||n.on(e.RenderEvent.Mousemove,this.onPointMouseMove.bind(this)),(r=this.pointRender)==null||r.on(e.RenderEvent.Mouseout,this.onPointMouseOut.bind(this)),(i=this.pointRender)==null||i.on(e.RenderEvent.Dragstart,this.onPointDragStart.bind(this)),(a=this.pointRender)==null||a.on(e.RenderEvent.Dragging,this.onPointDragging.bind(this)),(o=this.pointRender)==null||o.on(e.RenderEvent.Dragend,this.onPointDragEnd.bind(this))}},{key:`handleCreatePoint`,value:function(e){var t=this.options,n=t.autoActive,r=t.editable,i=r_(e);return this.setPointData((function(e){return $g({target:i,data:[].concat(Sn(e),[i]),targetHandler:function(e){e.properties=yn(yn({},e.properties),{},{isHover:r,isActive:n&&r})},otherHandler:function(e){e.properties=yn(yn({},e.properties),{},{isHover:!1,isActive:!1,isDrag:!1})}})})),i}},{key:`handlePointHover`,value:function(e){return this.setCursor(`pointHover`),Qg(e,this.hoverPoint)||this.setPointData((function(t){return $g({target:e,data:t,targetHandler:function(e){e.properties.isHover=!0},otherHandler:function(e){e.properties.isHover=!1}})})),e}},{key:`handlePointUnHover`,value:function(e){return this.resetCursor(),this.setPointData((function(e){return e.map((function(e){return e.properties.isHover=!1,e}))})),e}},{key:`handlePointDragStart`,value:function(e){return this.setPointData((function(t){return $g({target:e,data:t,targetHandler:function(e){e.properties=yn(yn({},e.properties),{},{isDrag:!0,isActive:!0})},otherHandler:function(e){e.properties=yn(yn({},e.properties),{},{isDrag:!1,isActive:!1})}})})),this.scene.setMapStatus({dragEnable:!1}),this.setCursor(`pointDrag`),e}},{key:`handlePointDragging`,value:function(e,t){return this.setPointData((function(n){return $g({target:e,data:n,targetHandler:function(e){e.geometry.coordinates=__(t)}})})),this.scene.setMapStatus({dragEnable:!1}),this.setCursor(`pointDrag`),e}},{key:`handlePointDragEnd`,value:function(e){return this.setPointData((function(t){return $g({target:e,data:t,targetHandler:function(e){e.properties.isDrag=!1}})})),this.scene.setMapStatus({dragEnable:!0}),this.setCursor(`pointHover`),e}},{key:`onPointCreate`,value:function(e){return this.handleCreatePoint(__(h_(e)))}},{key:`onPointMouseMove`,value:function(e){return this.handlePointHover(e.feature)}},{key:`onPointMouseOut`,value:function(e){return this.handlePointUnHover(e.feature)}},{key:`onPointDragStart`,value:function(e){if(this.options.editable)return this.handlePointDragStart(e.feature)}},{key:`onPointDragging`,value:function(e){var t=this.dragPoint;if(this.options.editable&&t)return this.handlePointDragging(t,h_(e))}},{key:`onPointDragEnd`,value:function(e){var t=this.dragPoint;if(this.options.editable&&t)return this.handlePointDragEnd(t)}},{key:`enablePointRenderAction`,value:function(){var e,t,n,r,i=this.options.editable;this.enabled&&((t=this.pointRender)==null||t.enableCreate()),((e=this.pointRender)==null||e.enableClick(),i)&&((n=this.pointRender)==null||n.enableHover(),(r=this.pointRender)==null||r.enableDrag())}},{key:`disablePointRenderAction`,value:function(){var e,t,n,r;(e=this.pointRender)==null||e.disableCreate(),(t=this.pointRender)==null||t.disableHover(),(n=this.pointRender)==null||n.disableDrag(),(r=this.pointRender)==null||r.disableClick()}}])}(A_),N_=function(t){function n(){return un(this,n),ln(this,n,arguments)}return gn(n,t),fn(n,[{key:`midPointRender`,get:function(){return this.render.midPoint}},{key:`getCommonOptions`,value:function(e){return yn(yn({},mn(hn(n.prototype),`getCommonOptions`,this).call(this,e)),{},{showMidPoint:!0})}},{key:`bindMidPointRenderEvent`,value:function(){var t,n,r;(t=this.midPointRender)==null||t.on(e.RenderEvent.Click,this.onMidPointClick.bind(this)),(n=this.midPointRender)==null||n.on(e.RenderEvent.Mousemove,this.onMidPointHover.bind(this)),(r=this.midPointRender)==null||r.on(e.RenderEvent.Mouseout,this.onMidPointUnHover.bind(this))}},{key:`getMidPointData`,value:function(){return this.source.getRenderData(`midPoint`)}},{key:`setMidPointData`,value:function(e){return this.source.setRenderData(`midPoint`,e)}},{key:`getMidPointsByLine`,value:function(e){var t=e.properties.nodes;if(!this.options.showMidPoint||2>t.length)return[];for(var n=[],r=0;t.length-1>r;r++){var i=ti(Nn([t[r],t[r+1]]),{properties:{id:Zg(`midPoint`),startId:t[r].properties?.id??``,endId:t[r+1].properties?.id??``}});n.push(i)}return n}},{key:`onMidPointHover`,value:function(e){this.setCursor(`pointHover`)}},{key:`onMidPointUnHover`,value:function(e){this.resetCursor()}},{key:`enableMidPointRenderAction`,value:function(){var e,t;(e=this.midPointRender)==null||e.enableClick(),(t=this.midPointRender)==null||t.enableHover()}},{key:`disableMidPointRenderAction`,value:function(){var e,t;(e=this.midPointRender)==null||e.disableClick(),(t=this.midPointRender)==null||t.disableHover()}}])}(M_),P_=function(t){function n(){var e;un(this,n);for(var t=arguments.length,r=Array(t),i=0;t>i;i++)r[i]=arguments[i];return(e=ln(this,n,[].concat(r))).prevCreateTime=Date.now(),e.previousPosition=[0,0],e}return gn(n,t),fn(n,[{key:`isDragTrigger`,get:function(){return this.options.trigger===`drag`}},{key:`isClickTrigger`,get:function(){return this.options.trigger===`click`}},{key:`editLine`,get:function(){return this.getLineData().find((function(e){var t=e.properties;return!t.isDraw&&t.isActive}))}},{key:`lineRender`,get:function(){return this.render.line}},{key:`dragLine`,get:function(){return this.getLineData().find((function(e){return e.properties.isDrag}))}},{key:`drawLine`,get:function(){return this.getLineData().find((function(e){return e.properties.isDraw}))}},{key:`hoverLine`,get:function(){return this.getLineData().find((function(e){return e.properties.isHover}))}},{key:`getDragLine`,value:function(){return this.dragLine}},{key:`getDrawLine`,value:function(){return this.drawLine}},{key:`getEditLine`,value:function(){return this.editLine}},{key:`getDefaultOptions`,value:function(e){var t=yn(yn({},this.getCommonOptions(e)),{},{showMidPoint:!0,distanceOptions:!1,helper:eg(pp),dragOptions:eg(sn)});return e.distanceOptions&&(t.distanceOptions=yn(yn({},en),t.distanceOptions)),e.adsorbOptions&&(t.adsorbOptions=yn(yn({},on),t.adsorbOptions),t.bbox=!0),e.trigger===`drag`&&(t.autoActive=!1,t.helper=yn(yn({},t.helper),gp)),t}},{key:`getAdsorbPosition`,value:function(e){var t=this.options.adsorbOptions;return typeof t==`boolean`?e:C_({adsorbOptions:t,position:e,scene:this.scene,draw:this})}},{key:`bindSceneEvent`,value:function(){this.sceneRender.on(e.RenderEvent.Mousemove,this.onSceneMouseMove.bind(this))}},{key:`bindPointRenderEvent`,value:function(){var t;mn(hn(n.prototype),`bindPointRenderEvent`,this).call(this),(t=this.pointRender)==null||t.on(e.RenderEvent.Click,this.onPointClick.bind(this))}},{key:`bindLineRenderEvent`,value:function(){var t,n,r,i,a,o;(t=this.lineRender)==null||t.on(e.RenderEvent.UnClick,this.onLineUnClick.bind(this)),(n=this.lineRender)==null||n.on(e.RenderEvent.Mousemove,this.onLineMouseMove.bind(this)),(r=this.lineRender)==null||r.on(e.RenderEvent.Mouseout,this.onLineMouseOut.bind(this)),(i=this.lineRender)==null||i.on(e.RenderEvent.Dragstart,this.onLineDragStart.bind(this)),(a=this.lineRender)==null||a.on(e.RenderEvent.Dragging,this.onLineDragging.bind(this)),(o=this.lineRender)==null||o.on(e.RenderEvent.Dragend,this.onLineDragEnd.bind(this))}},{key:`getDashLineDistanceTexts`,value:function(e,t){var n=t.showTotalDistance,r=t.format;return t.showDashDistance?e.map((function(e){return f_(e,{showTotalDistance:n,format:r},{isActive:!0,type:`dash`})})).flat():[]}},{key:`getLineDistanceTexts`,value:function(e,t){var n=t.showTotalDistance,r=t.format,i=t.showWhen,a=[];if(i.includes(`active`)){var o=e.filter((function(e){return e.properties.isActive&&e.properties.nodes.length>1}));a.push.apply(a,Sn(o.map((function(e){return f_(e,{showTotalDistance:n,format:r},{isActive:!0})})).flat()))}if(i.includes(`normal`)){var s=e.filter((function(e){return!e.properties.isActive&&e.properties.nodes.length>1}));a.push.apply(a,Sn(s.map((function(e){return f_(e,{showTotalDistance:n,format:r})})).flat()))}return a}},{key:`getDistanceTexts`,value:function(){var e=this.options.distanceOptions;if(!e)return[];var t=[],n=e.showWhen,r=e.showDashDistance,i=e.format,a=e.showTotalDistance;return t.push.apply(t,Sn(this.getDashLineDistanceTexts(this.getDashLineData(),{showTotalDistance:!1,format:i,showDashDistance:r})).concat(Sn(this.getLineDistanceTexts(this.getLineData(),{showTotalDistance:a,format:i,showWhen:n})))),t}},{key:`getAllTexts`,value:function(){return this.getDistanceTexts()}},{key:`handleCreateLine`,value:function(e){var t=i_([e],{isActive:!0,isDraw:!0});return this.setLineData((function(e){return $g({target:t,data:[].concat(Sn(e),[t]),otherHandler:function(e){e.properties.isActive=!1}})})),this.setPointData([e]),this.setTextData(this.getAllTexts()),t}},{key:`syncLineNodes`,value:function(e,t){return e.properties.nodes=t,e.geometry.coordinates=qn(Nn(t)),this.setLineData((function(t){return t.map((function(t){return Qg(t,e)?e:t}))})),Qg(this.editLine,e)&&this.setMidPointData(this.getMidPointsByLine(e)),this.setPointData(e.properties.nodes),this.setTextData(this.getAllTexts()),e}},{key:`setActiveLine`,value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.setLineData((function(n){return $g({target:e,data:n,targetHandler:function(e){e.properties=yn(yn({},e.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},t)},otherHandler:function(e){e.properties=yn(yn({},e.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})})),this.setPointData(e.properties.nodes.map((function(e){return e.properties=yn(yn({},e.properties),{},{isHover:!1,isActive:!1}),e}))),this.setMidPointData(this.getMidPointsByLine(e)),this.setDashLineData([]),this.setTextData(this.getAllTexts()),e}},{key:`clearActiveLine`,value:function(){this.source.setData({point:[],line:this.getLineData().map((function(e){return e.properties=yn(yn({},e.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),e})),midPoint:[],text:this.getAllTexts()})}},{key:`handleLineUnClick`,value:function(e){return this.clearActiveLine(),e}},{key:`handleLineHover`,value:function(e){if(!this.drawLine)return this.setCursor(`lineHover`),Qg(e,this.hoverLine)||this.setLineData((function(t){return $g({target:e,data:t,targetHandler:function(e){e.properties.isHover=!0},otherHandler:function(e){e.properties.isHover=!1}})})),e}},{key:`handleLineUnHover`,value:function(e){if(!this.drawLine)return this.resetCursor(),this.setLineData((function(e){return e.map((function(e){return e.properties.isHover=!1,e}))})),e}},{key:`handleLineDragStart`,value:function(e){return this.setActiveLine(e,{isDrag:!0,isActive:!0}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor(`lineDrag`),e}},{key:`handleLineDragging`,value:function(e,t){var n=t.lng,r=t.lat,i=e.properties.nodes,a=xn(this.previousPosition,2),o=a[0],s=a[1];return i.forEach((function(e){var t=e.geometry.coordinates;e.geometry.coordinates=[u_(t[0]+n-o),u_(t[1]+r-s)]})),this.syncLineNodes(e,i),this.setActiveLine(e,{isDrag:!0}),this.setCursor(`lineDrag`),this.previousPosition=[n,r],e}},{key:`handleLineDragEnd`,value:function(e){return e.properties.isDrag=!1,this.setLineData((function(e){return e})),this.scene.setMapStatus({dragEnable:!0}),e}},{key:`resetAdsorbLngLat`,value:function(e){if(this.options.adsorbOptions){var t=this.getAdsorbPosition(__(h_(e)));return t&&w_(e,t),t}}},{key:`onPointCreate`,value:function(e){if(!this.editLine){this.resetAdsorbLngLat(e);var t=mn(hn(n.prototype),`onPointCreate`,this).call(this,e),r=this.drawLine;if(t)return r?(this.syncLineNodes(r,[].concat(Sn(r.properties.nodes),[t])),this.setDashLineData([])):this.handleCreateLine(t),t}}},{key:`onPointDragStart`,value:function(e){if(this.editLine)return this.setHelper(`pointDrag`),mn(hn(n.prototype),`onPointDragStart`,this).call(this,e)}},{key:`onPointDragging`,value:function(e){var t=mn(hn(n.prototype),`onPointDragging`,this).call(this,e);if(t){var r=this.resetAdsorbLngLat(e);r&&(t.geometry.coordinates=eg(r))}var i=this.editLine;return i&&t&&(this.syncLineNodes(i,i.properties.nodes.map((function(e){return Qg(t,e)?t:e}))),this.setActiveLine(i)),t}},{key:`onPointDragEnd`,value:function(e){if(this.editLine){var t=mn(hn(n.prototype),`onPointDragEnd`,this).call(this,e);return this.setPointData((function(e){return e.map((function(e){return e.properties.isActive=!1,e}))})),this.setHelper(`pointHover`),t}}},{key:`onLineUnClick`,value:function(e){var t=this.editLine;if(t)return this.handleLineUnClick(t)}},{key:`onLineMouseMove`,value:function(e){if(!this.drawLine)return this.dragLine||this.drawLine||!this.options.editable||this.setHelper(`lineHover`),this.handleLineHover(e.feature)}},{key:`onLineMouseOut`,value:function(e){if(!this.drawLine)return this.dragLine||this.drawLine||this.setHelper(this.addable?`draw`:null),this.handleLineUnHover(e.feature)}},{key:`onLineDragStart`,value:function(e){if(this.options.editable&&!this.drawLine)return this.previousPosition=g_(e),this.setHelper(`lineDrag`),this.handleLineDragStart(e.feature)}},{key:`onLineDragging`,value:function(e){var t=this.dragLine;if(t)return this.handleLineDragging(t,h_(e))}},{key:`onLineDragEnd`,value:function(e){var t=this.dragLine;if(t)return this.setHelper(`lineHover`),this.handleLineDragEnd(t)}},{key:`onPointMouseMove`,value:function(e){var t=mn(hn(n.prototype),`onPointMouseMove`,this).call(this,e);return this.dragLine||this.drawLine||this.dragPoint||this.setHelper(`pointHover`),t}},{key:`onPointMouseOut`,value:function(e){var t=mn(hn(n.prototype),`onPointMouseOut`,this).call(this,e);return this.dragLine||this.drawLine||this.dragPoint||this.setHelper(this.addable?`draw`:null),t}},{key:`onMidPointHover`,value:function(e){mn(hn(n.prototype),`onMidPointHover`,this).call(this,e),this.setHelper(`midPointHover`)}},{key:`onMidPointUnHover`,value:function(e){mn(hn(n.prototype),`onMidPointUnHover`,this).call(this,e),this.setHelper(null)}},{key:`onPointClick`,value:function(e){}},{key:`getLineData`,value:function(){return this.source.getRenderData(`line`)}},{key:`setLineData`,value:function(e){return this.source.setRenderData(`line`,e)}},{key:`getTextData`,value:function(){return this.source.getRenderData(`text`)}},{key:`setTextData`,value:function(e){return this.source.setRenderData(`text`,e)}},{key:`getDashLineData`,value:function(){return this.source.getRenderData(`dashLine`)}},{key:`setDashLineData`,value:function(e){return this.source.setRenderData(`dashLine`,e)}},{key:`onMidPointClick`,value:function(e){var t=this.editLine,n=e.feature;if(t&&n&&!this.dragPoint){var r=t.properties.nodes,i=n.properties,a=i.startId,o=i.endId,s=r.findIndex((function(e){return e.properties.id===a})),c=r.findIndex((function(e){return e.properties.id===o}));if(s>-1&&c>-1){var l=r_(n.geometry.coordinates,{isDrag:!0,isHover:!0});return this.setHelper(`pointDrag`),r.splice(c,0,l),t.geometry.coordinates=qn(Nn(r)),this.syncLineNodes(t,r),this.setActiveLine(t),l}}}},{key:`enableSceneRenderAction`,value:function(){this.sceneRender.enableDrag(),this.sceneRender.enableMouseMove(),this.sceneRender.enableDblClick()}},{key:`disableSceneRenderAction`,value:function(){this.sceneRender.disableDrag(),this.sceneRender.disableMouseMove(),this.sceneRender.disableDblClick()}},{key:`enableLineRenderAction`,value:function(){var e,t,n,r=this.options.editable;((e=this.lineRender)==null||e.enableUnClick(),r)&&((t=this.lineRender)==null||t.enableHover(),(n=this.lineRender)==null||n.enableDrag())}},{key:`disableLineRenderAction`,value:function(){var e,t,n;(e=this.lineRender)==null||e.disableUnClick(),(t=this.lineRender)==null||t.disableHover(),(n=this.lineRender)==null||n.disableDrag()}},{key:`onSceneDragStart`,value:function(t){this.isDragTrigger&&this.addable&&!this.dragPoint&&!this.editLine&&(this.scene.setMapStatus({dragEnable:!1}),this.onPointCreate(t),this.prevCreateTime=Date.now(),this.sceneRender.on(e.RenderEvent.Dragging,this.onSceneDragging))}},{key:`onSceneDragging`,value:function(e){var t=this.drawLine,n=Date.now(),r=yn(yn({},sn),this.options.dragOptions),i=r.dotDistance,a=r.dotDuration;if(this.isDragTrigger&&this.addable&&t&&(!a||n-this.prevCreateTime>=a)){var o=h_(e),s=o.lng,c=o.lat,l=j_(t.properties.nodes).geometry.coordinates,u=this.scene.lngLatToPixel([l[0],l[1]]),d=u.x,f=u.y,p=this.scene.lngLatToPixel([s,c]),m=p.x,h=p.y;i&&i**2>=(m-d)**2+(h-f)**2||(this.onPointCreate(e),this.prevCreateTime=n)}}},{key:`onSceneDragEnd`,value:function(e){}},{key:`bindSceneDragEvent`,value:function(){this.unbindSceneDragEvent(),this.sceneRender.on(e.RenderEvent.Dragstart,this.onSceneDragStart),this.sceneRender.on(e.RenderEvent.Dragging,this.onSceneDragging),this.sceneRender.on(e.RenderEvent.Dragend,this.onSceneDragEnd),this.scene.setMapStatus({dragEnable:!1})}},{key:`unbindSceneDragEvent`,value:function(){this.sceneRender.off(e.RenderEvent.Dragstart,this.onSceneDragStart),this.sceneRender.off(e.RenderEvent.Dragging,this.onSceneDragging),this.sceneRender.off(e.RenderEvent.Dragend,this.onSceneDragEnd),this.scene.setMapStatus({dragEnable:!0})}},{key:`bindEnableEvent`,value:function(){mn(hn(n.prototype),`bindEnableEvent`,this).call(this),this.isDragTrigger&&this.bindSceneDragEvent()}},{key:`unbindEnableEvent`,value:function(){mn(hn(n.prototype),`unbindEnableEvent`,this).call(this),this.isDragTrigger&&this.unbindSceneDragEvent()}},{key:`bindThis`,value:function(){mn(hn(n.prototype),`bindThis`,this).call(this),this.onSceneDragStart=this.onSceneDragStart.bind(this),this.onSceneDragging=this.onSceneDragging.bind(this),this.onSceneDragEnd=this.onSceneDragEnd.bind(this)}}])}(N_),F_=function(t){function n(){return un(this,n),ln(this,n,arguments)}return gn(n,t),fn(n,[{key:`dragItem`,get:function(){return this.dragPolygon}},{key:`editItem`,get:function(){return this.editPolygon}},{key:`polygonRender`,get:function(){return this.render.polygon}},{key:`dragPolygon`,get:function(){return this.getPolygonData().find((function(e){return e.properties.isDrag}))}},{key:`drawPolygon`,get:function(){return this.getPolygonData().find((function(e){return e.properties.isDraw}))}},{key:`editPolygon`,get:function(){return this.getPolygonData().find((function(e){var t=e.properties;return!t.isDraw&&t.isActive}))}},{key:`hoverPolygon`,get:function(){return this.getPolygonData().find((function(e){return e.properties.isHover}))}},{key:`getDragPolygon`,value:function(){return this.dragPolygon}},{key:`getDrawPolygon`,value:function(){return this.drawPolygon}},{key:`getEditPolygon`,value:function(){return this.editPolygon}},{key:`getRenderTypes`,value:function(){return[`polygon`,`line`,`dashLine`,`midPoint`,`point`,`text`]}},{key:`getData`,value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=this.getPolygonData();return e?t:l_(t)}},{key:`getMainLayer`,value:function(){return this.render.polygon?.getLayers()??[]}},{key:`getDefaultOptions`,value:function(e){var t=yn(yn({},mn(hn(n.prototype),`getDefaultOptions`,this).call(this,e)),{},{areaOptions:!1,helper:eg(mp)});return e.areaOptions&&(t.areaOptions=yn(yn({},tn),e.areaOptions)),t}},{key:`getAreaTexts`,value:function(e){var t=this.options.areaOptions;if(!t)return[];var n=t.format,r=t.showWhen,i=[],a=e.filter((function(e){return e.geometry.coordinates[0].length>=4}));return r.includes(`active`)&&a.filter((function(e){return e.properties.isActive})).forEach((function(e){i.push(p_(e,{format:n},{isActive:!0}))})),r.includes(`normal`)&&a.filter((function(e){return!e.properties.isActive})).forEach((function(e){i.push(p_(e,{format:n},{isActive:!1}))})),i}},{key:`getAllTexts`,value:function(){return[].concat(Sn(mn(hn(n.prototype),`getAllTexts`,this).call(this)),Sn(this.getAreaTexts(this.getPolygonData())))}},{key:`getPolygonData`,value:function(){return this.source.getRenderData(`polygon`)}},{key:`setPolygonData`,value:function(e){return this.source.setRenderData(`polygon`,e)}},{key:`handleCreatePolygon`,value:function(e,t){var n=o_(e,{nodes:e,line:t,isActive:!0,isDraw:!0});return this.setPolygonData((function(e){return $g({target:n,data:[].concat(Sn(e),[n]),otherHandler:function(e){e.properties.isActive=!1}})})),n}},{key:`handlePolygonUnClick`,value:function(e){return this.clearActivePolygon(),e}},{key:`handlePolygonHover`,value:function(e){return this.setCursor(`polygonHover`),Qg(e,this.hoverPolygon)||this.setPolygonData((function(t){return $g({target:e,data:t,targetHandler:function(e){e.properties.isHover=!0},otherHandler:function(e){e.properties.isHover=!1}})})),e}},{key:`handlePolygonUnHover`,value:function(){this.resetCursor(),this.setPolygonData((function(e){return e.map((function(e){return e.properties.isHover=!1,e}))}))}},{key:`handlePolygonDragStart`,value:function(e){return this.setActivePolygon(e,{isDrag:!0}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor(`polygonDrag`),e}},{key:`bindPolygonRenderEvent`,value:function(){var t,n,r,i;(t=this.polygonRender)==null||t.on(e.RenderEvent.UnClick,this.onPolygonUnClick.bind(this)),(n=this.polygonRender)==null||n.on(e.RenderEvent.Mousemove,this.onPolygonHover.bind(this)),(r=this.polygonRender)==null||r.on(e.RenderEvent.Mouseout,this.onPolygonUnHover.bind(this)),(i=this.polygonRender)==null||i.on(e.RenderEvent.Dragstart,this.onPolygonDragStart.bind(this))}},{key:`syncPolygonNodes`,value:function(e,t){var n=qn(Nn([].concat(Sn(t),[Xg(t)]))),r=e.properties.line;if(e.properties.nodes=t,e.geometry.coordinates=[gf(Mn(n))?n:n.reverse()],this.setPolygonData((function(t){return t.map((function(t){return Qg(t,e)?e:t}))})),!Qg(this.drawPolygon,e)){var i=r.properties.nodes,a=Sn(t),o=Xg(a);a.push(i.length===t.length?r_(o.geometry.coordinates):j_(i));var s=j_(a);Sg(o.geometry.coordinates,s.geometry.coordinates)||(s.geometry.coordinates=eg(o.geometry.coordinates)),this.syncLineNodes(r,a)}return e}},{key:`setActivePolygon`,value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.setActiveLine(e.properties.line,t),this.setPolygonData((function(n){return $g({target:e,data:n,targetHandler:function(e){e.properties=yn(yn({},e.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},t)},otherHandler:function(e){e.properties=yn(yn({},e.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})})),this.setTextData(this.getAllTexts()),e}},{key:`clearActivePolygon`,value:function(){this.setPolygonData((function(e){return e.map((function(e){return e.properties=yn(yn({},e.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),e}))})),this.clearActiveLine()}},{key:`onLineDragStart`,value:function(t){var r=mn(hn(n.prototype),`onLineDragStart`,this).call(this,t),i=this.getPolygonData().find((function(e){return Qg(e.properties.line,r)}));return i&&(this.setActivePolygon(i,{isDrag:!0}),this.emit(e.DrawEvent.DragStart,i,this.getPolygonData())),r}},{key:`onLineUnClick`,value:function(e){return this.editLine}},{key:`onLineDragEnd`,value:function(t){var r=mn(hn(n.prototype),`onLineDragEnd`,this).call(this,t),i=this.dragPolygon;return r&&i&&(i.properties.isDrag=!1,this.emit(e.DrawEvent.DragEnd,i,this.getPolygonData()),this.emit(e.DrawEvent.Edit,i,this.getPolygonData())),r}},{key:`onPolygonUnClick`,value:function(e){var t=this.editPolygon;if(t)return this.handlePolygonUnClick(t)}},{key:`onPolygonHover`,value:function(e){if(!this.drawPolygon)return this.dragPolygon||this.setHelper(`polygonHover`),this.handlePolygonHover(e.feature)}},{key:`onPolygonUnHover`,value:function(e){if(!this.drawPolygon)return this.setHelper(this.addable?`draw`:null),this.handlePolygonUnHover()}},{key:`onPolygonDragStart`,value:function(t){if(this.options.editable&&!this.drawPolygon){var n=t.feature;return this.previousPosition=g_(t),this.setHelper(`polygonDrag`),this.emit(e.DrawEvent.DragStart,n,this.getPolygonData()),this.handlePolygonDragStart(n)}}},{key:`onMidPointClick`,value:function(e){var t=this.editPolygon,r=mn(hn(n.prototype),`onMidPointClick`,this).call(this,e);if(r&&t){var i=t.properties.line.properties.nodes;this.syncPolygonNodes(t,i.slice(0,i.length-1)),this.setActivePolygon(t)}return r}},{key:`onPointDragEnd`,value:function(t){var r=this.editPolygon,i=mn(hn(n.prototype),`onPointDragEnd`,this).call(this,t);return i&&r&&this.emit(e.DrawEvent.Edit,r,this.getPolygonData()),i}},{key:`enablePolygonRenderAction`,value:function(){var e,t,n,r=this.options.editable;((e=this.polygonRender)==null||e.enableUnClick(),r)&&((t=this.polygonRender)==null||t.enableHover(),(n=this.polygonRender)==null||n.enableDrag())}},{key:`disablePolygonRenderAction`,value:function(){var e,t,n;(e=this.polygonRender)==null||e.disableUnClick(),(t=this.polygonRender)==null||t.disableHover(),(n=this.polygonRender)==null||n.disableDrag()}},{key:`bindEnableEvent`,value:function(){mn(hn(n.prototype),`bindEnableEvent`,this).call(this),this.enableSceneRenderAction(),this.enablePointRenderAction(),this.enableLineRenderAction(),this.enableMidPointRenderAction(),this.enablePolygonRenderAction()}},{key:`unbindEnableEvent`,value:function(){mn(hn(n.prototype),`unbindEnableEvent`,this).call(this),this.disableSceneRenderAction(),this.disablePointRenderAction(),this.disableLineRenderAction(),this.disableMidPointRenderAction(),this.disablePolygonRenderAction()}},{key:`bindThis`,value:function(){mn(hn(n.prototype),`bindThis`,this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this),this.bindSceneEvent=this.bindSceneEvent.bind(this),this.bindLineRenderEvent=this.bindLineRenderEvent.bind(this),this.bindMidPointRenderEvent=this.bindMidPointRenderEvent.bind(this),this.bindPolygonRenderEvent=this.bindPolygonRenderEvent.bind(this)}},{key:`setActiveFeature`,value:function(e){var t=this.getTargetFeature(e);t?this.setActivePolygon(t):this.clearActivePolygon()}},{key:`resetFeatures`,value:function(){var e=this.getPolygonData();this.drawPolygon&&(e=e.filter((function(e){return!e.properties.isDraw})),this.source.setData({point:[],dashLine:[],midPoint:[]}),this.setLineData((function(e){return e.filter((function(e){return!e.properties.isDraw}))})),this.setTextData((function(e){return e.filter((function(e){return!e.properties.isActive}))}))),this.editPolygon&&this.handlePolygonUnClick(this.editPolygon),this.setPolygonData(e.map((function(e){return e.properties=yn(yn({},e.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),e})))}}])}(P_),I_=function(t){function n(){return un(this,n),ln(this,n,arguments)}return gn(n,t),fn(n,[{key:`drawLine`,get:function(){return this.drawPolygon?.properties.line}},{key:`getDefaultOptions`,value:function(e){var t=yn(yn({},mn(hn(n.prototype),`getDefaultOptions`,this).call(this,e)),{},{showMidPoint:!1,trigger:`click`,autoActive:!1,helper:eg(hp)});return e.trigger===`drag`&&(t.helper=yn(yn({},t.helper),gp)),t}},{key:`getMidPointsByLine`,value:function(e){return[]}},{key:`handleCreatePolygon`,value:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=t.properties.nodes;return o_(r.slice(0,r.length-1),yn({nodes:e,line:t},n))}},{key:`handleFirstNodeCreate`,value:function(t){var n=r_(t.geometry.coordinates),r=this.handleCreatePolygonLine(t,n,{isDraw:!0,isActive:!0}),i=this.handleCreatePolygon([t,n],r,{isDraw:!0,isActive:!0});return this.setPolygonData((function(e){return $g({target:i,data:[].concat(Sn(e),[i]),targetHandler:function(e){e.properties=yn(yn({},e.properties),{},{isDraw:!0,isActive:!0})}})})),this.emit(e.DrawEvent.AddNode,t,this.drawPolygon,this.getPolygonData()),this.setHelper(`drawFinish`),t}},{key:`handleLastNodeCreate`,value:function(t){var n=this.options,r=n.autoActive,i=n.editable,a=this.drawPolygon;return a?(this.setLineData((function(e){return[].concat(Sn(e),[a.properties.line])})),this.setActivePolygon(a),r&&i||this.handlePolygonUnClick(a),this.emit(e.DrawEvent.Add,a,this.getPolygonData()),this.emit(e.DrawEvent.AddNode,a.properties.nodes[1],this.drawPolygon,this.getPolygonData()),this.setHelper(i?r?`pointHover`:`polygonHover`:this.addable?`draw`:null),t):t}},{key:`onPointCreate`,value:function(e){var t=this;if(this.addable&&!this.dragPoint&&!this.editLine&&this.isClickTrigger){var n=this.drawPolygon,r=g_(e),i=this.handleCreatePoint(r);return n?requestAnimationFrame((function(){t.handleLastNodeCreate(i)})):this.handleFirstNodeCreate(i),i}}},{key:`setActivePolygon`,value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.setActiveLine(e.properties.line,t),this.setPolygonData((function(n){return $g({target:e,data:n,targetHandler:function(e){e.properties=yn(yn({},e.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},t)},otherHandler:function(e){e.properties=yn(yn({},e.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})})),this.setPointData(e.properties.nodes),this.setDashLineData([]);var n=this.getAllTexts();return this.setTextData(n),e}},{key:`onPointDragging`,value:function(e){var t=this.dragPoint;if(t){var n=this.handlePointDragging(t,h_(e)),r=this.editPolygon;return n&&r&&(this.syncPolygonNodes(r,r.properties.nodes.map((function(e){return Qg(e,n)?n:e}))),this.setActivePolygon(r)),n}}},{key:`onSceneDragStart`,value:function(e){this.isDragTrigger&&this.addable&&!this.dragPoint&&!this.editLine&&(this.scene.setMapStatus({dragEnable:!1}),this.handleFirstNodeCreate(this.handleCreatePoint(g_(e))))}},{key:`onSceneDragEnd`,value:function(e){this.isDragTrigger&&this.addable&&!this.dragPoint&&!this.editLine&&this.drawPolygon&&(this.scene.setMapStatus({dragEnable:!1}),this.handleLastNodeCreate(this.handleCreatePoint(g_(e))))}},{key:`onSceneMouseMove`,value:function(e){var t=this.drawPolygon;if(t){var n=t.properties.nodes,r=Xg(n),i=j_(n);i.geometry.coordinates=g_(e),this.syncPolygonNodes(t,[r,i]),this.setDashLineData([t.properties.line]),this.setTextData(this.getAllTexts()),this.resetCursor()}}}])}(F_),L_=function(t){function n(e,t){var r;return un(this,n),(r=ln(this,n,[e,t])).bindPointRenderEvent(),r.bindSceneEvent(),r.bindMidPointRenderEvent(),r.bindLineRenderEvent(),r.bindPolygonRenderEvent(),r}return gn(n,t),fn(n,[{key:`getDefaultOptions`,value:function(e){var t=yn(yn({},mn(hn(n.prototype),`getDefaultOptions`,this).call(this,e)),{},{showMidPoint:!1,circleSteps:60});return t.distanceOptions&&(t.distanceOptions.showTotalDistance=!0,t.distanceOptions.showOnRadius===void 0&&(t.distanceOptions.showOnRadius=!0)),t.helper&&=yn(yn({},t.helper),vp),t}},{key:`getDistanceTexts`,value:function(){var e=this.options.distanceOptions;if(!e)return[];var t=[],n=e.showWhen,r=e.showDashDistance,i=e.format,a=e.showTotalDistance;return t.push.apply(t,Sn(this.getDashLineDistanceTexts(this.getDashLineData(),{showTotalDistance:!0,format:i,showDashDistance:r})).concat(Sn(this.getLineDistanceTexts(this.getLineData(),{showTotalDistance:a,format:i,showWhen:n})))),t}},{key:`setData`,value:function(e){var t=this,n=e.map((function(e){e.properties=yn(yn({},n_()),e.properties);var n=e.properties?.nodes;if(n?.length!==2){var r=xn(ti(e).geometry.coordinates,2),i=r[0],a=r[1],o=tr(e),s=o[2],c=(o[1]+o[3])/2;n=[r_([i,a]),r_([s,c])],e.properties.nodes=n}var l=n[0],u=n[1],d=!!e.properties?.isActive,f=e.properties.line;return f||(f=t.handleCreatePolygonLine(l,u,{isActive:d}),e.properties.line=f),t.handleCreatePolygon([l,u],f,yn(yn({},e.properties),{},{isActive:d}))}));this.source.setData({point:[],midPoint:[],dashLine:[],polygon:n,line:n.map((function(e){return e.properties.line}))}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:`handleCreatePolygonLine`,value:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return i_(this.getBoundaryPositions(e,t).map((function(e){return r_(e)})),n)}},{key:`syncPolygonNodes`,value:function(e,t){var n=e.properties.line,r=this.getBoundaryPositions(t[0],t[1]);return e.properties.nodes=t,e.geometry.coordinates=[r],this.setPolygonData((function(t){return t.map((function(t){return Qg(t,e)?e:t}))})),this.setPointData(e.properties.isDraw?[t[0]]:t),n.properties.nodes.forEach((function(e,t){e.geometry.coordinates=r[t]})),n.geometry.coordinates=r,e}},{key:`onLineDragging`,value:function(t){var r=this.dragPolygon,i=xn(this.previousPosition,2),a=i[0],o=i[1],s=mn(hn(n.prototype),`onLineDragging`,this).call(this,t);if(r){var c=xn(g_(t),2),l=c[0],u=c[1];r.properties.nodes.forEach((function(e){var t=xn(e.geometry.coordinates,2),n=t[1];e.geometry.coordinates=[u_(t[0]+l-a),u_(n+u-o)]})),this.syncPolygonNodes(r,r.properties.nodes),this.setActivePolygon(r,{isDrag:!0}),this.emit(e.DrawEvent.Dragging,r,this.getPolygonData())}return s}},{key:`getBoundaryPositions`,value:function(e,t){for(var n=this.options.circleSteps,r=Zr(e,t,{units:`meters`}),i=[],a=0;n>a;a++)i.push($r(e,r,-360*a/n,{units:`meters`}).geometry.coordinates.map((function(e){return u_(e,6)})));return i.push(i[0]),i}}])}(I_),R_=function(t){function n(t,r){var i;return un(this,n),(i=ln(this,n,[t,r])).drawLineFinish=function(){var t=i.drawLine,n=t?.properties.nodes??[];if(t&&n?.length>1){i.setActiveLine(t);var r=i.options,a=r.autoActive,o=r.editable;a&&o||i.handleLineUnClick(t),i.setHelper(o&&a?`pointHover`:i.addable?`draw`:null),i.emit(e.DrawEvent.Add,t,i.getLineData())}},i.sceneRender.on(e.RenderEvent.DblClick,i.drawLineFinish),i.bindPointRenderEvent(),i.bindSceneEvent(),i.bindMidPointRenderEvent(),i.bindLineRenderEvent(),i}return gn(n,t),fn(n,[{key:`dragItem`,get:function(){return this.dragLine}},{key:`editItem`,get:function(){return this.editLine}},{key:`getMainLayer`,value:function(){return this.render.line?.getLayers()??[]}},{key:`setData`,value:function(e){var t=c_(e).map((function(e){var t;return e.properties=yn(yn({},t_()),e.properties??{}),(t=e.properties.nodes)!=null&&t.length||(e.properties.nodes=qn(e).map((function(e){return r_(e)}))),e}));this.source.setData({point:[],midPoint:[],dashLine:[],line:t}),this.setTextData(this.getAllTexts()),this.editLine&&this.setActiveLine(this.editLine)}},{key:`getData`,value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=this.getLineData();return e?t:l_(t)}},{key:`getRenderTypes`,value:function(){return[`line`,`dashLine`,`midPoint`,`point`,`text`]}},{key:`bindPointRenderEvent`,value:function(){var t;mn(hn(n.prototype),`bindPointRenderEvent`,this).call(this),(t=this.pointRender)==null||t.on(e.RenderEvent.Contextmenu,this.onPointContextMenu.bind(this))}},{key:`onPointClick`,value:function(e){var t=this,n=this.drawLine?.properties.nodes??[],r=e.feature;if(Qg(r,j_(n)))requestAnimationFrame((function(){t.drawLineFinish()}));else{var i=xn(r.geometry.coordinates,2);e.lngLat={lng:i[0],lat:i[1]},this.onPointCreate(e)}}},{key:`removeNode`,value:function(t,n){var r=this.getTargetFeature(n),i=this.getTargetFeature(t,r?.properties.nodes??[]);if(r&&i){var a=r?.properties.nodes??[];if(3>a.length)return;this.syncLineNodes(r,a.filter((function(e){return!Qg(i,e)}))),this.emit(e.DrawEvent.RemoveNode,i,r,this.getLineData()),this.emit(e.DrawEvent.Edit,r,this.getLineData())}}},{key:`onPointContextMenu`,value:function(e){var t=this.editLine,n=e.feature,r=t?.properties.nodes??[];if(t&&r.length>=3)return this.removeNode(n,t),this.scene.setMapStatus({dragEnable:!0}),n}},{key:`onPointCreate`,value:function(t){if(this.addable){var r=mn(hn(n.prototype),`onPointCreate`,this).call(this,t);return r&&(this.setHelper(`drawFinish`),this.emit(e.DrawEvent.AddNode,r,this.drawLine,this.getLineData())),r}}},{key:`onPointDragEnd`,value:function(t){var r=this.editLine,i=mn(hn(n.prototype),`onPointDragEnd`,this).call(this,t);return r&&i&&this.emit(e.DrawEvent.Edit,r,this.getLineData()),i}},{key:`onLineDragStart`,value:function(t){var r=mn(hn(n.prototype),`onLineDragStart`,this).call(this,t);return r&&this.emit(e.DrawEvent.DragStart,r,this.getLineData()),r}},{key:`onLineDragging`,value:function(t){var r=mn(hn(n.prototype),`onLineDragging`,this).call(this,t);return r&&this.emit(e.DrawEvent.Dragging,r,this.getLineData()),r}},{key:`onLineDragEnd`,value:function(t){var r=mn(hn(n.prototype),`onLineDragEnd`,this).call(this,t);return r&&(this.emit(e.DrawEvent.DragEnd,r,this.getLineData()),this.emit(e.DrawEvent.Edit,r,this.getLineData())),r}},{key:`onMidPointClick`,value:function(t){var r=this.editLine,i=mn(hn(n.prototype),`onMidPointClick`,this).call(this,t);return r&&i&&(this.emit(e.DrawEvent.Edit,r,this.getLineData()),this.emit(e.DrawEvent.AddNode,i,r,this.getLineData())),i}},{key:`onSceneMouseMove`,value:function(e){var t=this.drawLine;if(t){var n=j_(t.properties.nodes),r=g_(e);this.options.adsorbOptions&&(r=this.getAdsorbPosition(r)??r),this.setDashLineData([a_([r,n.geometry.coordinates])]),this.setTextData(this.getAllTexts())}}},{key:`onSceneDragEnd`,value:function(e){this.isDragTrigger&&this.addable&&this.drawLine&&this.drawLineFinish()}},{key:`setActiveFeature`,value:function(e){var t=this.getTargetFeature(e);t?this.setActiveLine(t):this.clearActiveLine()}},{key:`resetFeatures`,value:function(){var e=this.getLineData();this.drawLine&&(e=e.filter((function(e){return!e.properties.isDraw})),this.source.setData({point:[],dashLine:[],midPoint:[]}),this.setTextData((function(e){return e.filter((function(e){return!e.properties.isActive}))}))),this.editLine&&this.handleLineUnClick(this.editLine),this.setLineData(e.map((function(e){return e.properties=yn(yn({},e.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),e})))}},{key:`enablePointRenderAction`,value:function(){var e;(mn(hn(n.prototype),`enablePointRenderAction`,this).call(this),this.options.editable)&&((e=this.pointRender)==null||e.enableContextMenu())}},{key:`disablePointRenderAction`,value:function(){var e;mn(hn(n.prototype),`disablePointRenderAction`,this).call(this),(e=this.pointRender)==null||e.disableContextMenu()}},{key:`bindEnableEvent`,value:function(){mn(hn(n.prototype),`bindEnableEvent`,this).call(this),this.enableSceneRenderAction(),this.enablePointRenderAction(),this.enableLineRenderAction(),this.enableMidPointRenderAction(),this.sceneRender.enableDblClick()}},{key:`unbindEnableEvent`,value:function(){mn(hn(n.prototype),`unbindEnableEvent`,this).call(this),this.disableSceneRenderAction(),this.disablePointRenderAction(),this.disableLineRenderAction(),this.disableMidPointRenderAction(),this.sceneRender.disableDblClick()}},{key:`bindThis`,value:function(){mn(hn(n.prototype),`bindThis`,this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this),this.bindSceneEvent=this.bindSceneEvent.bind(this),this.bindLineRenderEvent=this.bindLineRenderEvent.bind(this),this.bindMidPointRenderEvent=this.bindMidPointRenderEvent.bind(this)}}])}(P_),z_=function(t){function n(e,t){var r;return un(this,n),(r=ln(this,n,[e,t])).bindPointRenderEvent(),r}return gn(n,t),fn(n,[{key:`dragItem`,get:function(){return this.dragPoint}},{key:`editItem`,get:function(){return this.editPoint}},{key:`getDefaultOptions`,value:function(e){var t=yn(yn({},this.getCommonOptions(e)),{},{helper:eg(fp),initialData:e.initialData});return t.style.point=cp,t}},{key:`bindEnableEvent`,value:function(){mn(hn(n.prototype),`bindEnableEvent`,this).call(this),this.enablePointRenderAction()}},{key:`unbindEnableEvent`,value:function(){mn(hn(n.prototype),`unbindEnableEvent`,this).call(this),this.disablePointRenderAction()}},{key:`getRenderTypes`,value:function(){return[`point`]}},{key:`getMainLayer`,value:function(){return this.render.point?.getLayers()??[]}},{key:`setData`,value:function(e){this.setPointData(c_(e).map((function(e){return e.properties=yn(yn({},e_()),e.properties),e})))}},{key:`getData`,value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=this.getPointData();return e?t:l_(t)}},{key:`onPointCreate`,value:function(t){if(this.addable){var r=mn(hn(n.prototype),`onPointCreate`,this).call(this,t);if(r)return this.options.editable&&this.setHelper(`pointHover`),this.emit(e.DrawEvent.Add,r,this.getData()),r}else this.setPointData((function(e){return e.map((function(e){return e.properties=yn(yn({},e.properties),{},{isHover:!1,isActive:!1}),e}))}))}},{key:`onPointMouseMove`,value:function(e){var t=mn(hn(n.prototype),`onPointMouseMove`,this).call(this,e);return this.options.editable&&!this.dragPoint&&this.setHelper(`pointHover`),t}},{key:`onPointMouseOut`,value:function(e){var t=mn(hn(n.prototype),`onPointMouseOut`,this).call(this,e);return this.setHelper(this.addable?`draw`:null),t}},{key:`onPointDragStart`,value:function(t){var r=mn(hn(n.prototype),`onPointDragStart`,this).call(this,t);return this.setHelper(`pointDrag`),this.emit(e.DrawEvent.DragStart,r,this.getData()),r}},{key:`onPointDragging`,value:function(t){var r=mn(hn(n.prototype),`onPointDragging`,this).call(this,t);return r&&this.options.editable&&this.emit(e.DrawEvent.Dragging,r,this.getData()),r}},{key:`onPointDragEnd`,value:function(t){var r=mn(hn(n.prototype),`onPointDragEnd`,this).call(this,t);return r&&this.options.editable&&(this.setHelper(`pointHover`),this.emit(e.DrawEvent.DragEnd,r,this.getData()),this.emit(e.DrawEvent.Edit,r,this.getData())),r}},{key:`bindThis`,value:function(){mn(hn(n.prototype),`bindThis`,this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this)}},{key:`onSceneMouseMove`,value:function(e){}},{key:`setActiveFeature`,value:function(e){var t=this.getTargetFeature(e);this.setPointData((function(e){return e.map((function(e){return e.properties.isActive=Qg(t,e),e}))}))}},{key:`resetFeatures`,value:function(){this.setPointData((function(e){return e.map((function(e){return e.properties=yn(yn({},e.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),e}))}))}}])}(M_),B_=function(t){function n(t,r){var i;return un(this,n),(i=ln(this,n,[t,r])).drawPolygonFinish=function(){var t=i.drawPolygon,n=t?.properties.nodes??[];if(t&&n.length>=3){t.properties.isDraw=!1,i.syncPolygonNodes(t,n),i.setActivePolygon(t);var r=i.options,a=r.autoActive,o=r.editable;a&&o||i.handlePolygonUnClick(t),i.setHelper(o?a?`pointHover`:`polygonHover`:i.addable?`draw`:null),i.emit(e.DrawEvent.Add,t,i.getPolygonData())}},i.sceneRender.on(e.RenderEvent.DblClick,i.drawPolygonFinish),i.bindPointRenderEvent(),i.bindSceneEvent(),i.bindMidPointRenderEvent(),i.bindLineRenderEvent(),i.bindPolygonRenderEvent(),i}return gn(n,t),fn(n,[{key:`getDefaultOptions`,value:function(e){return yn(yn({},mn(hn(n.prototype),`getDefaultOptions`,this).call(this,e)),{},{liveUpdate:!1})}},{key:`setData`,value:function(e){var t=c_(e).map((function(e){if(e.properties=yn(yn({},n_()),e.properties??{}),!e.properties.nodes?.length){var t=qn(e);t=t.slice(0,t.length-1),e.properties.nodes=t.map((function(e){return r_(e)}))}if(!e.properties.line){var n=e.properties.nodes;e.properties.line=i_([].concat(Sn(n),[r_(Xg(n).geometry.coordinates)]))}return e}));this.source.setData({point:[],midPoint:[],dashLine:[],polygon:t,line:t.map((function(e){return e.properties.line}))}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:`onPointCreate`,value:function(t){if(this.addable&&!this.dragPoint){var r=mn(hn(n.prototype),`onPointCreate`,this).call(this,t),i=this.drawPolygon,a=this.drawLine;return r&&(i?(this.syncPolygonNodes(i,[].concat(Sn(i.properties.nodes),[r])),this.setDashLineData([a_([g_(t),i.properties.nodes[0].geometry.coordinates])]),i.properties.nodes.length>1&&this.setHelper(`drawFinish`)):a&&(this.handleCreatePolygon([r],a),this.setHelper(`drawContinue`)),this.emit(e.DrawEvent.AddNode,r,i,this.getPolygonData())),r}}},{key:`onPointClick`,value:function(e){var t=this,n=this.drawPolygon,r=e.feature;if(n){var i=n.properties.nodes;if(i.length<3||!Qg(Xg(i),r)&&!Qg(j_(i),r)){var a=xn(r.geometry.coordinates,2);e.lngLat={lng:a[0],lat:a[1]},this.onPointCreate(e)}else requestAnimationFrame((function(){t.drawPolygonFinish()}))}}},{key:`onPointDragging`,value:function(e){var t=this.dragPoint,r=this.editPolygon;if(t&&r){var i=r.properties.line;i.properties.nodes=i.properties.nodes.map((function(e){return Qg(e,t)?t:e}));var a=i.properties.nodes,o=a.slice(0,a.length-1),s=Xg(a),c=j_(a),l=Qg(s,t)||Qg(c,t);if(l&&(s.geometry.coordinates=c.geometry.coordinates=g_(e)),this.options.adsorbOptions&&l){var u=this.resetAdsorbLngLat(e);u&&(s.geometry.coordinates=c.geometry.coordinates=u)}mn(hn(n.prototype),`onPointDragging`,this).call(this,e),this.syncPolygonNodes(r,o),this.setActivePolygon(r)}return t}},{key:`onLineDragging`,value:function(t){var r=this.dragPolygon,i=mn(hn(n.prototype),`onLineDragging`,this).call(this,t);if(i&&r){var a=i.properties.nodes;this.syncPolygonNodes(r,a.slice(0,a.length-1)),this.emit(e.DrawEvent.Dragging,r,this.getPolygonData())}return i}},{key:`onMidPointClick`,value:function(t){var r=mn(hn(n.prototype),`onMidPointClick`,this).call(this,t),i=this.editPolygon;return r&&i&&(this.emit(e.DrawEvent.Edit,i,this.getPolygonData()),this.emit(e.DrawEvent.AddNode,r,i,this.getPolygonData())),r}},{key:`onSceneMouseMove`,value:function(e){var t=this.drawPolygon,n=t?.properties.nodes??[];if(t&&n.length){this.options.adsorbOptions&&this.resetAdsorbLngLat(e);var r=g_(e),i=[];if(i.push(a_([r,Xg(n).geometry.coordinates])),n.length>1&&i.push(a_([r,j_(n).geometry.coordinates])),this.options.liveUpdate&&n.length>=2){var a=qn(Nn(n));t.geometry.coordinates=[[].concat(Sn(a),[r,a[0]])],this.setPolygonData(this.getPolygonData())}this.setDashLineData(i),this.setTextData(this.getAllTexts())}}},{key:`onSceneDragEnd`,value:function(e){this.isDragTrigger&&this.addable&&this.drawLine&&this.drawPolygonFinish()}},{key:`removeNode`,value:function(t,n){var r=this.getTargetFeature(n),i=this.getTargetFeature(t,r?.properties.nodes??[]);if(r&&i){var a=r?.properties.nodes??[];if(4>a.length)return;this.syncPolygonNodes(r,a.filter((function(e){return!Qg(i,e)}))),this.emit(e.DrawEvent.RemoveNode,i,r,this.getLineData()),this.emit(e.DrawEvent.Edit,r,this.getPolygonData())}}},{key:`onPointContextMenu`,value:function(e){var t=this.editPolygon,n=e.feature,r=t?.properties.nodes??[];if(t&&r.length>=4)return r.find((function(e){return Qg(e,n)}))||(n=r[0]),this.removeNode(n,t),n}},{key:`bindPointRenderEvent`,value:function(){var t;mn(hn(n.prototype),`bindPointRenderEvent`,this).call(this),(t=this.pointRender)==null||t.on(e.RenderEvent.Contextmenu,this.onPointContextMenu.bind(this))}},{key:`enablePointRenderAction`,value:function(){var e;(mn(hn(n.prototype),`enablePointRenderAction`,this).call(this),this.options.editable)&&((e=this.pointRender)==null||e.enableContextMenu())}},{key:`disablePointRenderAction`,value:function(){var e;mn(hn(n.prototype),`disablePointRenderAction`,this).call(this),(e=this.pointRender)==null||e.disableContextMenu()}}])}(F_),V_=function(t){function n(e,t){var r;return un(this,n),(r=ln(this,n,[e,t])).bindPointRenderEvent(),r.bindSceneEvent(),r.bindMidPointRenderEvent(),r.bindLineRenderEvent(),r.bindPolygonRenderEvent(),r}return gn(n,t),fn(n,[{key:`getDefaultOptions`,value:function(e){var t=mn(hn(n.prototype),`getDefaultOptions`,this).call(this,e);return t.helper&&=yn(yn({},t.helper),_p),t}},{key:`setData`,value:function(e){var t=this,n=e.map((function(e){e.properties=yn(yn({},n_()),e.properties??{});var n=e.properties.nodes;if(n?.length!==2){var r=xn(tr(e),4),i=r[2],a=r[3];n=[r_([r[0],r[1]]),r_([i,a])],e.properties.nodes=n}var o=xn(n,2),s=o[0],c=o[1],l=!!e.properties?.isActive,u=e.properties.line;return u||(u=t.handleCreatePolygonLine(s,c,{isActive:l}),e.properties.line=u),t.handleCreatePolygon([s,c],u,yn(yn({},e.properties),{},{isActive:l}))}));this.source.setData({point:[],midPoint:[],dashLine:[],polygon:n,line:n.map((function(e){return e.properties.line}))}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:`handleCreatePolygonLine`,value:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return i_(qn(Qr(Nn([e,t]))).map((function(n,r){return r===0?e:r===2?t:r_(n)})),n)}},{key:`syncPolygonNodes`,value:function(e,t){var n=e.properties.line,r=qn(Qr(Nn(t)));e.properties.nodes=t,e.geometry.coordinates=[r],this.setPolygonData((function(t){return t.map((function(t){return Qg(t,e)?e:t}))})),this.setPointData(e.properties.isDraw?[t[0]]:t);var i=n.properties.nodes,a=r.filter((function(e){return!Sg(e,t[0].geometry.coordinates)&&!Sg(e,t[1].geometry.coordinates)}));return i.forEach((function(e,n){var r=[0,0];switch(n){case 0:r=t[0].geometry.coordinates;break;case 1:r=a[0];break;case 2:r=t[1].geometry.coordinates;break;case 3:r=a[1];break;case 4:r=eg(t[0].geometry.coordinates)}e.geometry.coordinates=r})),n.geometry.coordinates=r,e}},{key:`onLineDragging`,value:function(t){var r=mn(hn(n.prototype),`onLineDragging`,this).call(this,t),i=this.dragPolygon;if(r&&i){var a=i.properties.line.properties.nodes;this.syncPolygonNodes(i,[a[0],a[2]]),this.setActivePolygon(i,{isDrag:!0}),this.emit(e.DrawEvent.Dragging,i,this.getPolygonData())}return r}}])}(I_),H_=function(e,t){for(var n=e;n&&!Array.from(n.classList).includes(t);)n=n.parentElement;return n},U_=[`point`,`line`,`polygon`,`rect`,`circle`,`clear`],W_={point:`#l7draw-point`,line:`#l7draw-line`,polygon:`#l7draw-polygon`,rect:`#l7draw-rect`,circle:`#l7draw-circle`,clear:`#l7draw-qingkong`},G_={point:z_,line:R_,polygon:B_,rect:V_,circle:L_},K_=`data-draw-type`,q_=`l7-draw-control`,J_=`${q_}__btn`,Y_=`${J_}--active`;(function(e){var t,n,r,i,a,o=`<svg><symbol id="l7draw-qingkong" viewBox="0 0 1024 1024"><path d="M778.96777344 334.02148437h-148.31542969V284.58300781A71.78466797 71.78466797 0 0 0 556.49462891 215.36914062H467.50537109a71.78466797 71.78466797 0 0 0-74.15771484 69.11499024V334.02148437h-148.31542969a29.66308594 29.66308594 0 1 0 0 59.32617188h29.66308594v326.29394531A88.98925781 88.98925781 0 0 0 363.68457031 808.63085938h296.63085938a88.98925781 88.98925781 0 0 0 88.98925781-88.98925782V393.34765625h29.66308594a29.66308594 29.66308594 0 0 0 0-59.32617188zM452.67382812 284.58300781c0-4.74609375 6.22924805-9.78881836 14.83154297-9.78881836h88.98925782c8.60229492 0 14.83154297 5.04272461 14.83154296 9.78881836V334.02148437H452.67382812V284.53356934z m237.30468751 435.10803223a29.66308594 29.66308594 0 0 1-29.66308594 29.66308593H363.68457031a29.66308594 29.66308594 0 0 1-29.66308593-29.66308594V393.34765625h355.95703124v326.29394531z"  ></path><path d="M437.84228516 660.31542969c6.57531739 0 12.85400391-3.46069336 17.5012207-9.64050294A39.20471192 39.20471192 0 0 0 462.56152344 627.33996582V495.5369873a39.20471192 39.20471192 0 0 0-7.21801758-23.33496093A22.09899903 22.09899903 0 0 0 437.84228516 462.56152344c-6.57531739 0-12.85400391 3.46069336-17.50122071 9.64050293A39.20471192 39.20471192 0 0 0 413.12304687 495.5369873v131.80297853c0 8.75061036 2.62023926 17.15515137 7.21801758 23.33496092 4.6472168 6.17980958 10.92590333 9.64050293 17.50122071 9.64050294zM586.15771484 660.31542969c6.57531739 0 12.85400391-3.46069336 17.50122071-9.64050294a39.20471192 39.20471192 0 0 0 7.21801758-23.33496093V495.5369873a39.20471192 39.20471192 0 0 0-7.21801758-23.33496093A22.09899903 22.09899903 0 0 0 586.15771484 462.56152344c-6.57531739 0-12.85400391 3.46069336-17.5012207 9.64050293A39.20471192 39.20471192 0 0 0 561.43847656 495.5369873v131.80297853c0 8.75061036 2.62023926 17.15515137 7.21801758 23.33496092 4.6472168 6.17980958 10.92590333 9.64050293 17.5012207 9.64050294z"  ></path></symbol><symbol id="l7draw-rect" viewBox="0 0 1024 1024"><path d="M736.14 648.79V330c0-23.16-18.84-42-42-42H375.49c-11.07-19.13-31.74-32.01-55.43-32.01-35.35 0-64.01 28.66-64.01 64.01 0 23.69 12.88 44.36 32.01 55.43v318.8c0 23.16 18.84 42 42 42H648.7c11.07 19.13 31.74 32.01 55.43 32.01 35.35 0 64.01-28.66 64.01-64.01 0.01-23.7-12.87-44.37-32-55.44zM352.06 375.43A64.281 64.281 0 0 0 375.49 352h296.64v296.8a64.357 64.357 0 0 0-23.43 23.43H352.06v-296.8z"  ></path></symbol><symbol id="l7draw-circle" viewBox="0 0 1024 1024"><path d="M467.013228 557.765038a64.01 64.01 0 1 0 90.52223-90.52539 64.01 64.01 0 1 0-90.52223 90.52539Z"  ></path><path d="M832.16 512.22c0-26.06-15.58-48.46-37.93-58.45-11.21-54.67-38.11-104.92-78.48-145.3-54.42-54.42-126.78-84.4-203.75-84.4s-149.33 29.97-203.75 84.4c-54.42 54.42-84.4 126.79-84.4 203.75s29.97 149.33 84.4 203.75c54.42 54.42 126.78 84.4 203.75 84.4s149.33-29.97 203.75-84.4c40.37-40.37 67.28-90.62 78.48-145.3 22.35-9.98 37.93-32.39 37.93-58.45zM670.5 670.72c-42.34 42.34-98.62 65.65-158.5 65.65-59.87 0-116.16-23.32-158.5-65.65-42.34-42.34-65.65-98.62-65.65-158.5s23.32-116.16 65.65-158.5c42.34-42.34 98.62-65.65 158.5-65.65 59.87 0 116.16 23.32 158.5 65.65 29.9 29.9 50.3 66.77 59.71 106.95-15.81 11.66-26.07 30.4-26.07 51.55s10.26 39.9 26.07 51.55c-9.41 40.18-29.81 77.05-59.71 106.95z"  ></path></symbol><symbol id="l7draw-polygon" viewBox="0 0 1024 1024"><path d="M705.97 640.31c-5.79 0-11.39 0.78-16.72 2.22L381.94 336.66a64.079 64.079 0 0 0 2.14-16.43c0-35.35-28.66-64.01-64.01-64.01s-64.01 28.66-64.01 64.01c0 23.69 12.88 44.36 32.01 55.43V648.8c-19.13 11.07-32.01 31.74-32.01 55.43 0 35.35 28.66 64.01 64.01 64.01 23.69 0 44.35-12.87 55.42-32l275.05 0.07c11.07 19.14 31.74 32.03 55.44 32.03 35.35 0 64.01-28.66 64.01-64.01s-28.66-64.02-64.02-64.02z m-353.91 8.48V397.22L628.44 672.3l-252.94-0.07a64.411 64.411 0 0 0-23.44-23.44z"  ></path></symbol><symbol id="l7draw-line" viewBox="0 0 1024 1024"><path d="M832.16 449.21c0-35.35-28.66-64.01-64.01-64.01-29.2 0-53.81 19.56-61.5 46.28l-390.9 96.82 72.18-144.18c33.56-1.99 60.17-29.83 60.17-63.89 0-35.35-28.66-64.01-64.01-64.01s-64.01 28.66-64.01 64.01c0 13.04 3.91 25.17 10.61 35.28l-78.42 156.65c-33.58 1.97-60.21 29.81-60.21 63.89 0 35.35 28.66 64.01 64.01 64.01 29.2 0 53.81-19.56 61.5-46.28l390.8-96.79-71.97 143.34c-33.62 1.93-60.28 29.8-60.28 63.9 0 35.35 28.66 64.01 64.01 64.01s64.01-28.66 64.01-64.01c0-13-3.89-25.09-10.54-35.18l78.28-155.93c33.61-1.95 60.28-29.81 60.28-63.91z"  ></path></symbol><symbol id="l7draw-point" viewBox="0 0 1024 1024"><path d="M331.46 330.08m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path><path d="M384.12 735.84m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path><path d="M769.11 512.7m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path></symbol></svg>`,s=(s=document.getElementsByTagName(`script`))[s.length-1].getAttribute(`data-injectcss`);if(s&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write(`<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>`)}catch(e){console&&console.log(e)}}function c(){a||(a=!0,r())}t=function(){var e,t=document.createElement(`div`);t.innerHTML=o,o=null,(t=t.getElementsByTagName(`svg`)[0])&&(t.setAttribute(`aria-hidden`,`true`),t.style.position=`absolute`,t.style.width=0,t.style.height=0,t.style.overflow=`hidden`,(e=document.body).firstChild?function(e,t){t.parentNode.insertBefore(e,t)}(t,e.firstChild):e.appendChild(t))},document.addEventListener?~[`complete`,`loaded`,`interactive`].indexOf(document.readyState)?setTimeout(t,0):(n=function(){document.removeEventListener(`DOMContentLoaded`,n,!1),t()},document.addEventListener(`DOMContentLoaded`,n,!1)):document.attachEvent&&(r=t,i=e.document,a=!1,function e(){try{i.documentElement.doScroll(`left`)}catch{setTimeout(e,50);return}c()}(),i.onreadystatechange=function(){i.readyState==`complete`&&(i.onreadystatechange=null,c())})})(window),E_(`.l7-draw-control{display:flex;overflow:hidden;background:#fff;border-radius:2px;box-shadow:0 0 20px rgba(0,0,0,.14901960784313725)}.l7-draw-control__btn{display:inline-flex;align-items:center;justify-content:center;width:30px;height:30px;padding:0;text-align:center;background:transparent;border-width:0;border-right:1px solid #e0e0e0;outline:0;cursor:pointer;transition:background-color .3s}.l7-draw-control__btn svg{transition:color .3s}.l7-draw-control__btn:hover{background-color:#e5e5e5}.l7-draw-control__btn:hover svg{color:#000}.l7-draw-control__btn:last-child{border-right:0;border-bottom:0}.l7-draw-control__btn .l7-draw-icon{width:26px;height:26px;overflow:hidden;fill:currentColor}.l7-draw-control__btn--active,.l7-draw-control__btn--active:hover{background-color:#0370fe}.l7-draw-control__btn--active:hover svg,.l7-draw-control__btn--active svg{color:#fff}`);var X_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Z_=/^\w*$/,Q_=function(e,t){if(Cm(e))return!1;var n=typeof e;return!(n!=`number`&&n!=`symbol`&&n!=`boolean`&&e!=null&&!Bf(e))||Z_.test(e)||!X_.test(e)||t!=null&&e in Object(t)};function $_(e,t){if(typeof e!=`function`||t!=null&&typeof t!=`function`)throw TypeError(`Expected a function`);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=e.apply(this,r);return n.cache=a.set(i,o)||a,o};return n.cache=new($_.Cache||sm),n}$_.Cache=sm;var ev=$_,tv=function(e){var t=ev(e,(function(e){return n.size===500&&n.clear(),e})),n=t.cache;return t},nv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rv=/\\(\\)?/g,iv=tv((function(e){var t=[];return e.charCodeAt(0)===46&&t.push(``),e.replace(nv,(function(e,n,r,i){t.push(r?i.replace(rv,`$1`):n||e)})),t})),av=kf?kf.prototype:void 0,J=av?av.toString:void 0,ov=function e(t){if(typeof t==`string`)return t;if(Cm(t))return Wg(t,e)+``;if(Bf(t))return J?J.call(t):``;var n=t+``;return n==`0`&&1/t==-1/0?`-0`:n},sv=function(e){return e==null?``:ov(e)},Y=function(e,t){return Cm(e)?e:Q_(e,t)?[e]:iv(sv(e))},cv=function(e){if(typeof e==`string`||Bf(e))return e;var t=e+``;return t==`0`&&1/e==-1/0?`-0`:t},lv=function(e,t){for(var n=0,r=(t=Y(t,e)).length;e!=null&&r>n;)e=e[cv(t[n++])];return n&&n==r?e:void 0},uv=function(e,t,n){var r=-1,i=e.length;0>t&&(t=-t>i?0:i+t),0>(n=n>i?i:n)&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(i);++r<i;)a[r]=e[r+t];return a},X=function(e,t){return 2>t.length?e:lv(e,uv(t,0,-1))},dv=function(e,t){return t=Y(t,e),(e=X(e,t))==null||delete e[cv(j_(t))]},fv=function(e){return kg(e)?void 0:e},pv=kf?kf.isConcatSpreadable:void 0,mv=function(e){return Cm(e)||Sm(e)||!!(pv&&e&&e[pv])},hv=function e(t,n,r,i,a){var o=-1,s=t.length;for(r||=mv,a||=[];++o<s;){var c=t[o];n>0&&r(c)?n>1?e(c,n-1,r,i,a):ah(a,c):i||(a[a.length]=c)}return a},gv=function(e){return e!=null&&e.length?hv(e,1):[]},_v=function(e){return Bg(Lg(e,void 0,gv),e+``)}((function(e,t){var n={};if(e==null)return n;var r=!1;t=Wg(t,(function(t){return t=Y(t,e),r||=t.length>1,t})),gm(e,dh(e),n),r&&(n=$h(n,7,fv));for(var i=t.length;i--;)dv(n,t[i]);return n})),vv=function(n){function r(t){var n,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return un(this,r),(n=ln(this,r,[i])).controlOption=void 0,n.sceneInstance=void 0,n.drawMap={},n.btnMap={},n.activeType=null,n.emitDataChange=Jf((function(){n.emit(e.ControlEvent.DataChange,n.getDrawData())}),16),n.emitDrawSelect=function(t,r){n.emit(e.ControlEvent.DrawSelect,t,r)},n.sceneInstance=t,n.controlOption=yn(yn({},n.getDefault()),i||{}),n.onBtnClick=n.onBtnClick.bind(n),n}return gn(r,n),fn(r,[{key:`getActiveType`,value:function(){return this.activeType}},{key:`getDefault`,value:function(){return yn(yn({},mn(hn(r.prototype),`getDefault`,this).call(this)),{},{className:``,buttonClassName:``,activeButtonClassName:``,style:``,position:`topleft`,commonDrawOptions:{},drawConfig:{point:!0,line:!0,polygon:!0,rect:!0,circle:!0,clear:!0}})}},{key:`addTo`,value:function(e){return mn(hn(r.prototype),`addTo`,this).call(this,e),this.init(),this}},{key:`onAdd`,value:function(){var e=this.controlOption,n=e.className,r=e.style,i=t.DOM.create(`div`,`${q_} ${n}`);return r&&i.setAttribute(`style`,r),i}},{key:`onRemove`,value:function(){Object.values(this.drawMap).forEach((function(e){e.clear(!0)}))}},{key:`init`,value:function(){var t,n=this,r=[];Object.entries(this.controlOption.drawConfig).filter((function(e){return xn(e,2)[1]})).sort((function(e,t){var n=xn(e,2)[1],r=xn(t,2)[1],i=2**53-1;return(typeof n==`boolean`?i:n.order)-(typeof r==`boolean`?i:r.order)})).map((function(e){var t=xn(e,2),n=t[1];return[t[0],wn(n)===`object`?_v(n,`order`):n]})).forEach((function(t){var i=xn(t,2),a=i[0],o=i[1];if(wn(o)===`object`&&o.button){var s=o.button;s.classList.contains(`l7-draw-control__btn`)||s.classList.add(`l7-draw-control__btn`),n.btnMap[a]=s,r.push(s)}else if(o&&U_.includes(a)){var c=n.initBtn(a);c.addEventListener(`click`,n.onBtnClick),r.push(c),n.btnMap[a]=c;var l=G_[a];if(l&&n.sceneInstance){var u=new l(n.sceneInstance,yn(yn({},n.controlOption.commonDrawOptions),typeof o==`boolean`?{}:o));u.on(e.DrawEvent.Change,n.emitDataChange),u.on(e.DrawEvent.Select,(function(e){n.emitDrawSelect(a,e),e&&Object.values(n.drawMap).forEach((function(e){e!==u&&e.setActiveFeature(null)}))})),n.drawMap[a]=u}}})),(t=this.container).append.apply(t,r),this.controlOption.defaultActiveType&&this.onDrawClick(this.controlOption.defaultActiveType)}},{key:`getDrawData`,value:function(){return tg(qg(this.drawMap).map((function(e){var t=xn(e,2);return[t[0],t[1].getData()]})))}},{key:`getTypeDraw`,value:function(e){return this.drawMap[e]??null}},{key:`onBtnClick`,value:function(e){var t=H_(e.target,J_);if(t){var n=t.getAttribute(K_);n===`clear`?this.clearDrawData():this.onDrawClick(n)}}},{key:`setActiveType`,value:function(n){var r=null,i=this.activeType;if(i){var a,o=this.btnMap[i];if(o){t.DOM.removeClass(o,Y_);var s=this.controlOption.activeButtonClassName;s&&t.DOM.removeClass(o,s)}(a=this.drawMap[i])==null||a.disable(),r=null}if(i!==n&&n){var c;(c=this.drawMap[n])==null||c.enable();var l=this.btnMap[n];l&&t.DOM.addClass(l,`${Y_} ${this.controlOption.activeButtonClassName}`),r=n}this.activeType=r,this.emit(e.ControlEvent.DrawChange,r)}},{key:`onDrawClick`,value:function(e){this.setActiveType(e)}},{key:`clearDrawData`,value:function(){Object.values(this.drawMap).forEach((function(e){e?.clear()})),this.emit(e.ControlEvent.DrawClear)}},{key:`initBtn`,value:function(e){var n=t.DOM.create(`button`,`${J_} ${this.controlOption.buttonClassName}`);return n.innerHTML=`<svg class="l7-draw-icon" aria-hidden="true">
      <use xlink:href="${W_[e]}"></use>
    </svg>`,n.setAttribute(K_,e),n.type=`button`,n}}])}(t.Control);e.ACTIVE_COLOR=rp,e.BaseMode=A_,e.CircleDrawer=L_,e.DEFAULT_ADSORB_CONFIG=on,e.DEFAULT_AREA_OPTIONS=tn,e.DEFAULT_CIRCLE_HELPER_CONFIG=vp,e.DEFAULT_COMMON_OPTIONS=ip,e.DEFAULT_CURSOR_MAP=n,e.DEFAULT_DISTANCE_OPTIONS=en,e.DEFAULT_DRAG_OPTIONS=sn,e.DEFAULT_DRAG_POLYGON_HELPER_CONFIg=hp,e.DEFAULT_HISTORY_CONFIG=nn,e.DEFAULT_KEYBOARD_CONFIG=rn,e.DEFAULT_LINE_HELPER_CONFIG=pp,e.DEFAULT_MID_POINT_STYLE=sp,e.DEFAULT_NODE_NORMAL_STYLE=op,e.DEFAULT_NODE_STYLE=lp,e.DEFAULT_POINT_HELPER_CONFIG=fp,e.DEFAULT_POINT_NORMAL_STYLE=ap,e.DEFAULT_POINT_STYLE=cp,e.DEFAULT_POLYGON_HELPER_CONFIG=mp,e.DEFAULT_POPUP_CONFIG=an,e.DEFAULT_RECT_HELPER_CONFIG=_p,e.DEFAULT_SOURCE_DATA=r,e.DEFAULT_STYLE=dp,e.DEFAULT_TEXT_NORMAL_STYLE=up,e.DEFAULT_TRIGGER_DRAG_HELPER_CONFIG=gp,e.DashLineRender=yf,e.DragPolygonMode=I_,e.DrawCircle=L_,e.DrawControl=vv,e.DrawLine=R_,e.DrawPoint=z_,e.DrawPolygon=B_,e.DrawRect=V_,e.LayerRender=vf,e.LineDrawer=R_,e.LineMode=P_,e.LineRender=Yf,e.MidPointMode=N_,e.MidPointRender=Xf,e.NORMAL_COLOR=np,e.PointDrawer=z_,e.PointMode=M_,e.PointRender=Zf,e.PolygonDrawer=B_,e.PolygonMode=F_,e.PolygonRender=Qf,e.RENDER_MAP=tp,e.RectDrawer=V_,e.SceneRender=$f,e.Source=k_,e.TextRender=ep,e.calcAreaText=p_,e.calcDistanceTextsByLine=f_,e.createDashLine=a_,e.createLineFeature=i_,e.createPointFeature=r_,e.createPolygonFeature=o_,e.findMinIndex=v_,e.getAdsorbPosition=C_,e.getDefaultLineProperties=t_,e.getDefaultPointProperties=e_,e.getDefaultPolygonProperties=n_,e.getLineCenterPoint=d_,e.getLngLat=h_,e.getMapDom=m_,e.getParentByClassName=H_,e.getPixelExpandBBox=x_,e.getPosition=g_,e.getPrecisionNumber=u_,e.getSingleColorStyle=function(e){return{point:{normal:{color:e},hover:{color:e},active:{color:e}},line:{normal:{color:e},hover:{color:e},active:{color:e}},polygon:{normal:{color:e},hover:{color:e},active:{color:e},style:{opacity:.2}},text:{normal:{color:e},active:{color:e}},midPoint:{normal:{color:e}},dashLine:{normal:{color:e}}}},e.getUuid=Zg,e.injectFeaturesBBox=s_,e.isDev=!1,e.isPositionInBBox=S_,e.isSameFeature=Qg,e.joinMultiFeatures=l_,e.resetEventLngLat=w_,e.splitByPosition=y_,e.splitMultiFeatures=c_,e.transLngLat2Position=__,e.updateTargetFeature=$g,Object.defineProperty(e,`__esModule`,{value:!0})}))}))(),i6=null;function a6(e,t={}){let n={position:`topright`,drawStyles:{point:{fill:`#ff6b6b`,stroke:`#fff`,radius:8},line:{stroke:`#4ecdc4`,lineWidth:3},polygon:{fill:`#45b7d1`,fillOpacity:.3,stroke:`#45b7d1`,lineWidth:2}},...t},r=f.DomUtil.create(`div`,`draw-control`);r.innerHTML=`
    <div class="draw-buttons">
      <button class="draw-btn" data-mode="point" title="绘制点">
        <span>📍</span>
      </button>
      <button class="draw-btn" data-mode="line" title="绘制线">
        <span>📏</span>
      </button>
      <button class="draw-btn" data-mode="polygon" title="绘制面">
        <span>⬡</span>
      </button>
      <button class="draw-btn" data-mode="rect" title="绘制矩形">
        <span>⬜</span>
      </button>
      <button class="draw-btn" data-mode="circle" title="绘制圆">
        <span>⭕</span>
      </button>
      <button class="draw-btn" data-mode="delete" title="删除">
        <span>🗑️</span>
      </button>
    </div>
    <style>
      .draw-control {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.15);
        padding: 8px;
        z-index: 1000;
      }
      .draw-buttons {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .draw-btn {
        width: 36px;
        height: 36px;
        border: 1px solid #ddd;
        background: #fff;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }
      .draw-btn:hover {
        background: #f0f0f0;
        border-color: #667eea;
      }
      .draw-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
      }
    </style>
  `,f.DomEvent.disableClickPropagation(r);let i=new n6().addTo(e).getScene(),a=null,o=[];r.querySelectorAll(`.draw-btn`).forEach(e=>{e.addEventListener(`click`,t=>{let n=e.dataset.mode;s(n,i,e)})});function s(e,t,n){if(r.querySelectorAll(`.draw-btn`).forEach(e=>e.classList.remove(`active`)),a===e){i6&&=(i6.disable(),null),a=null;return}if(a=e,n.classList.add(`active`),e===`delete`){l(),a=null,n.classList.remove(`active`);return}c(e,t)}function c(e,t){i6&&=(i6.disable(),null);let r;switch(e){case`point`:r=r6.DrawPoint;break;case`line`:r=r6.DrawLine;break;case`polygon`:r=r6.DrawPolygon;break;case`rect`:r=r6.DrawRect;break;case`circle`:r=r6.DrawCircle;break;default:return}i6=new r(t,{style:n.drawStyles[e]||{}}),i6.enable(),i6.on(`drawend`,e=>{o.push(e.target)})}function l(){i6&&=(i6.disable(),null),o.forEach(e=>{e.remove&&e.remove()}),o.length=0,a=null}function u(){return o.map(e=>e.getSource&&e.getSource().getData?e.getSource().getData():null).filter(Boolean)}function d(){let e=[];return o.forEach(t=>{if(t.getSource&&t.getSource().getData){let n=t.getSource().getData();n&&n.features&&e.push(...n.features)}}),{type:`FeatureCollection`,features:e}}return{container:r,getDrawnData:u,exportToGeoJSON:d,clearAllFeatures:l}}var o6=new f.Map(`map`,{center:new f.LatLng(26.33280692289788,114.78515624999999),zoom:5});f.control.layers({geoqBlue:y,高德影像:_.addTo(o6),esrisat:A,MapQuest:g,谷歌影像:j,Mapbox:p,osm:m,MapQuest:h,图吧:v,geoqCommunity:b,geoqGray:x,geoColor:S,geoqWarm:C,geoqBound:w,geoqBoundonly:E,geoqWater:D,StamenToner:O,StamenWaterColor:k},{},{position:`topleft`}).addTo(o6);var s6=a6(o6);s6.container.style.position=`absolute`,s6.container.style.top=`100px`,s6.container.style.right=`300px`,document.getElementById(`map`).appendChild(s6.container),Oa(o6);